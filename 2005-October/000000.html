<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Simuze-svn] r1 - / trunk trunk/admin trunk/artiesten trunk/help trunk/img trunk/img/icons trunk/img/images trunk/img/movers trunk/img/news trunk/img/screenshots trunk/inc trunk/inc/db trunk/inc/external trunk/inc/external/getid3 trunk/inc/external/magpierss trunk/inc/external/magpierss/cache trunk/inc/external/magpierss/extlib trunk/inc/external/xspf trunk/js trunk/media trunk/media/avatar trunk/media/avatar/default trunk/media/flash trunk/media/playlist trunk/sql trunk/templates trunk/users
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/simuze-svn/2005-October/index.html" >
   <LINK REL="made" HREF="mailto:simuze-svn%40lists.berlios.de?Subject=Re%3A%20%5BSimuze-svn%5D%20r1%20-%20/%20trunk%20trunk/admin%20trunk/artiesten%20trunk/help%20trunk/img%20trunk/img/icons%20trunk/img/images%20trunk/img/movers%20trunk/img/news%20trunk/img/screenshots%20trunk/inc%20trunk/inc/db%20trunk/inc/external%20trunk/inc/external/getid3%20trunk/inc/external/magpierss%20trunk/inc/external/magpierss/cache%20trunk/inc/external/magpierss/extlib%20trunk/inc/external/xspf%20trunk/js%20trunk/media%20trunk/media/avatar%20trunk/media/avatar/default%20trunk/media/flash%20trunk/media/playlist%20trunk/sql%20trunk/templates%20trunk/users&In-Reply-To=%3C200510091845.j99IjMcp000333%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="000001.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Simuze-svn] r1 - / trunk trunk/admin trunk/artiesten trunk/help trunk/img trunk/img/icons trunk/img/images trunk/img/movers trunk/img/news trunk/img/screenshots trunk/inc trunk/inc/db trunk/inc/external trunk/inc/external/getid3 trunk/inc/external/magpierss trunk/inc/external/magpierss/cache trunk/inc/external/magpierss/extlib trunk/inc/external/xspf trunk/js trunk/media trunk/media/avatar trunk/media/avatar/default trunk/media/flash trunk/media/playlist trunk/sql trunk/templates trunk/users</H1>
    <B>Bjorn Wijers at BerliOS</B> 
    <A HREF="mailto:simuze-svn%40lists.berlios.de?Subject=Re%3A%20%5BSimuze-svn%5D%20r1%20-%20/%20trunk%20trunk/admin%20trunk/artiesten%20trunk/help%20trunk/img%20trunk/img/icons%20trunk/img/images%20trunk/img/movers%20trunk/img/news%20trunk/img/screenshots%20trunk/inc%20trunk/inc/db%20trunk/inc/external%20trunk/inc/external/getid3%20trunk/inc/external/magpierss%20trunk/inc/external/magpierss/cache%20trunk/inc/external/magpierss/extlib%20trunk/inc/external/xspf%20trunk/js%20trunk/media%20trunk/media/avatar%20trunk/media/avatar/default%20trunk/media/flash%20trunk/media/playlist%20trunk/sql%20trunk/templates%20trunk/users&In-Reply-To=%3C200510091845.j99IjMcp000333%40sheep.berlios.de%3E"
       TITLE="[Simuze-svn] r1 - / trunk trunk/admin trunk/artiesten trunk/help trunk/img trunk/img/icons trunk/img/images trunk/img/movers trunk/img/news trunk/img/screenshots trunk/inc trunk/inc/db trunk/inc/external trunk/inc/external/getid3 trunk/inc/external/magpierss trunk/inc/external/magpierss/cache trunk/inc/external/magpierss/extlib trunk/inc/external/xspf trunk/js trunk/media trunk/media/avatar trunk/media/avatar/default trunk/media/flash trunk/media/playlist trunk/sql trunk/templates trunk/users">bjornw at berlios.de
       </A><BR>
    <I>Sun Oct  9 20:45:22 CEST 2005</I>
    <P><UL>
        
        <LI>Next message: <A HREF="000001.html">[Simuze-svn] r2 - in trunk: . conf db db/revprops db/revs hooks locks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#0">[ date ]</a>
              <a href="thread.html#0">[ thread ]</a>
              <a href="subject.html#0">[ subject ]</a>
              <a href="author.html#0">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: bjornw
Date: 2005-10-09 20:44:56 +0200 (Sun, 09 Oct 2005)
New Revision: 1

Added:
   trunk/
   trunk/.htaccessbak
   trunk/.htpasswd
   trunk/admin/
   trunk/admin/create_moderator.php
   trunk/admin/moderate.php
   trunk/admin/musicplayer.swf
   trunk/admin/sm-create_moderators.php
   trunk/admin/sm-moderate.php
   trunk/admin/sm-moderate_backup.php
   trunk/allusers.php
   trunk/artiesten/
   trunk/artiesten/alternatief.php
   trunk/artiesten/genre.php
   trunk/artiesten/genre_all_artists.php
   trunk/artiesten/index.php
   trunk/artiesten/index_backup.php
   trunk/artiesten/overzicht.php
   trunk/artiesten/tag.php
   trunk/artiesten/tag_overzicht.php
   trunk/artiesten/template2.php
   trunk/artiesten/zoek.php
   trunk/class.phpmailer.bak.php
   trunk/colofon.php
   trunk/confirm.php
   trunk/disclaimer.php
   trunk/faq.php
   trunk/forms.css
   trunk/help/
   trunk/help/aanmelden.php
   trunk/help/ccinfo.php
   trunk/help/index.php
   trunk/help/muziekgegevens.php
   trunk/help/uploaden.php
   trunk/img/
   trunk/img/bg_pattern.gif
   trunk/img/footer.gif
   trunk/img/header.gif
   trunk/img/icons/
   trunk/img/icons/by.gif
   trunk/img/icons/cc_type1.gif
   trunk/img/icons/cc_type2.gif
   trunk/img/icons/cc_type3.gif
   trunk/img/icons/cc_type4.gif
   trunk/img/icons/cc_type5.gif
   trunk/img/icons/cc_type6.gif
   trunk/img/icons/chat.gif
   trunk/img/icons/column.gif
   trunk/img/icons/dl.gif
   trunk/img/icons/forum.gif
   trunk/img/icons/home.gif
   trunk/img/icons/min.gif
   trunk/img/icons/nc.gif
   trunk/img/icons/nd.gif
   trunk/img/icons/pd.gif
   trunk/img/icons/play.gif
   trunk/img/icons/plus.gif
   trunk/img/icons/sa.gif
   trunk/img/icons/speaker.gif
   trunk/img/images/
   trunk/img/images/DP_logo.gif
   trunk/img/images/alternatief.jpg
   trunk/img/images/balk1_kort.gif
   trunk/img/images/balk2_kort.gif
   trunk/img/images/bandvdweek.gif
   trunk/img/images/bar1.gif
   trunk/img/images/bar1_genres.gif
   trunk/img/images/bar1_onder.gif
   trunk/img/images/bar1_showprofile.gif
   trunk/img/images/barbie_backstage.jpg
   trunk/img/images/beeldmerk_rood_klein.gif
   trunk/img/images/bevestig_btn.gif
   trunk/img/images/bg_alleartiesten.gif
   trunk/img/images/bg_allecolumns_geel_top.gif
   trunk/img/images/bg_alleinterviews_geel_top.gif
   trunk/img/images/bg_artiesten.gif
   trunk/img/images/bg_artikelen.gif
   trunk/img/images/bg_audiobestanden.gif
   trunk/img/images/bg_bestandsinfo_geel.gif
   trunk/img/images/bg_blauw_240_mid.gif
   trunk/img/images/bg_blauw_240_onder.gif
   trunk/img/images/bg_blue_325_mid.gif
   trunk/img/images/bg_blue_325_onder.gif
   trunk/img/images/bg_blue_325_top.gif
   trunk/img/images/bg_concerts.gif
   trunk/img/images/bg_contactinfo.gif
   trunk/img/images/bg_donker.gif
   trunk/img/images/bg_donkergeel_295_mid.gif
   trunk/img/images/bg_donkergeel_295_onder.gif
   trunk/img/images/bg_downloads.gif
   trunk/img/images/bg_downloads_list.gif
   trunk/img/images/bg_formbottom.gif
   trunk/img/images/bg_formmid.gif
   trunk/img/images/bg_formtop.gif
   trunk/img/images/bg_geel_295_mid.gif
   trunk/img/images/bg_geel_295_onder.gif
   trunk/img/images/bg_info_geel.gif
   trunk/img/images/bg_info_geel_mid.gif
   trunk/img/images/bg_info_geel_onder.gif
   trunk/img/images/bg_interessant.gif
   trunk/img/images/bg_interviews.gif
   trunk/img/images/bg_laatsttoegevoegd.gif
   trunk/img/images/bg_licentiekiezen_geel.gif
   trunk/img/images/bg_licht.gif
   trunk/img/images/bg_links.gif
   trunk/img/images/bg_linksform.gif
   trunk/img/images/bg_login.gif
   trunk/img/images/bg_maak_playlist_aan.gif
   trunk/img/images/bg_mid2_shadow.gif
   trunk/img/images/bg_mid_shadow.gif
   trunk/img/images/bg_muzikantentips.gif
   trunk/img/images/bg_nieuw_geel_top.gif
   trunk/img/images/bg_nieuweuploads.gif
   trunk/img/images/bg_nieuweuploads_main.gif
   trunk/img/images/bg_nieuwkomers.gif
   trunk/img/images/bg_omschrijving_geel.gif
   trunk/img/images/bg_onder.gif
   trunk/img/images/bg_overig.gif
   trunk/img/images/bg_overzicht.gif
   trunk/img/images/bg_pattern.gif
   trunk/img/images/bg_playlisttop10.gif
   trunk/img/images/bg_profiel_aanraders.gif
   trunk/img/images/bg_profiel_bio.gif
   trunk/img/images/bg_profiel_com.gif
   trunk/img/images/bg_profiel_formmid.gif
   trunk/img/images/bg_profiel_formonder.gif
   trunk/img/images/bg_profiel_info.gif
   trunk/img/images/bg_profiel_links.gif
   trunk/img/images/bg_profiel_musica.gif
   trunk/img/images/bg_referenties_geel.gif
   trunk/img/images/bg_registerform.gif
   trunk/img/images/bg_reviews.gif
   trunk/img/images/bg_rood_295_mid.gif
   trunk/img/images/bg_rood_295_onder.gif
   trunk/img/images/bg_rood_600_mid.gif
   trunk/img/images/bg_rood_600_onder.gif
   trunk/img/images/bg_simuzeleden.gif
   trunk/img/images/bg_snelzoeken.gif
   trunk/img/images/bg_topdownloads.gif
   trunk/img/images/bg_uitgelicht.gif
   trunk/img/images/bg_uitgelicht_mid.gif
   trunk/img/images/bg_uitgelicht_musica.gif
   trunk/img/images/bg_uitgelicht_onder.gif
   trunk/img/images/bg_uitleg_geel_boven.gif
   trunk/img/images/bg_uitleg_geel_boven2.gif
   trunk/img/images/bg_uitleg_geel_mid.gif
   trunk/img/images/bg_uitleg_geel_onder.gif
   trunk/img/images/bg_uitleg_geel_onder2.gif
   trunk/img/images/bg_uitleg_geel_top.gif
   trunk/img/images/bg_wachtrij_geel_top.gif
   trunk/img/images/bg_wijzig_playlist.gif
   trunk/img/images/bg_zoek.gif
   trunk/img/images/bigbalk2_backstage.gif
   trunk/img/images/bigbalk2_musica.gif
   trunk/img/images/bigbalk_backstage.gif
   trunk/img/images/bigbalk_musica.gif
   trunk/img/images/bjorn.jpg
   trunk/img/images/blues.jpg
   trunk/img/images/boven_blauwwit.gif
   trunk/img/images/boven_blauwwitrood.gif
   trunk/img/images/boven_genres.gif
   trunk/img/images/boven_login.gif
   trunk/img/images/boven_nieuwsitems.gif
   trunk/img/images/btn_beluister_alle.gif
   trunk/img/images/btn_maak_lege_playlist.gif
   trunk/img/images/btn_maak_playlist.gif
   trunk/img/images/btn_maak_playlist_aan.gif
   trunk/img/images/btn_verras_me.gif
   trunk/img/images/btn_zoek_vergelijkbare.gif
   trunk/img/images/cc.gif
   trunk/img/images/country.jpg
   trunk/img/images/dezeweek.gif
   trunk/img/images/digitalepioniers.gif
   trunk/img/images/donkergeel_1.gif
   trunk/img/images/donkergeel_2.gif
   trunk/img/images/donkergeel_3.gif
   trunk/img/images/download_liefhebbers.gif
   trunk/img/images/download_pijl.gif
   trunk/img/images/dubbelpijltje_rood.gif
   trunk/img/images/electronisch.jpg
   trunk/img/images/error_down.gif
   trunk/img/images/experimenteel.jpg
   trunk/img/images/folk.jpg
   trunk/img/images/form_boven_geel.gif
   trunk/img/images/form_mid_blauw.gif
   trunk/img/images/form_mid_geel.gif
   trunk/img/images/form_onder_blauw.gif
   trunk/img/images/form_onder_geel.gif
   trunk/img/images/header.gif
   trunk/img/images/hiphop.jpg
   trunk/img/images/house.jpg
   trunk/img/images/index_06.gif
   trunk/img/images/index_07.gif
   trunk/img/images/index_08.gif
   trunk/img/images/index_09.gif
   trunk/img/images/index_10.gif
   trunk/img/images/index_11.gif
   trunk/img/images/index_12.gif
   trunk/img/images/index_13.gif
   trunk/img/images/index_14.gif
   trunk/img/images/jazz.jpg
   trunk/img/images/klassiek.jpg
   trunk/img/images/latin.jpg
   trunk/img/images/live_musica.jpg
   trunk/img/images/login.gif
   trunk/img/images/login_btn.gif
   trunk/img/images/logout_btn.gif
   trunk/img/images/marten.jpg
   trunk/img/images/meerweten.gif
   trunk/img/images/menurechts_boven.gif
   trunk/img/images/menurechts_onder.gif
   trunk/img/images/metal.jpg
   trunk/img/images/noggeenfoto.gif
   trunk/img/images/noggeenfoto_klein.gif
   trunk/img/images/onder_blauwwit_shadow.gif
   trunk/img/images/onder_blauwwitrood_shadow.gif
   trunk/img/images/onder_genres.gif
   trunk/img/images/onder_login.gif
   trunk/img/images/onder_nieuwsitems.gif
   trunk/img/images/pijltje_links.gif
   trunk/img/images/pijltje_rood.gif
   trunk/img/images/pijltje_rood2.gif
   trunk/img/images/pijltje_wit.gif
   trunk/img/images/pijltjes_wit_3.gif
   trunk/img/images/pop.jpg
   trunk/img/images/registreer_btn.gif
   trunk/img/images/rnb.jpg
   trunk/img/images/rock.jpg
   trunk/img/images/shadow.gif
   trunk/img/images/snelzoekknop.gif
   trunk/img/images/spacer.gif
   trunk/img/images/uitgelicht.gif
   trunk/img/images/uitleg.gif
   trunk/img/images/upload_muzikanten.gif
   trunk/img/images/upload_pijl.gif
   trunk/img/images/versturen_btn.gif
   trunk/img/images/verstuur_btn.gif
   trunk/img/images/voegcommentaartoe.gif
   trunk/img/images/wereld.jpg
   trunk/img/images/wijzig_nummer.gif
   trunk/img/images/wijzigen_btn.gif
   trunk/img/images/wordnulid.gif
   trunk/img/images/wordtlid_btn.gif
   trunk/img/images/xs4all_30mm.gif
   trunk/img/images/xs4all_60mm.gif
   trunk/img/images/yellowline.gif
   trunk/img/images/zij_artiesten.gif
   trunk/img/images/zij_backstage.gif
   trunk/img/images/zij_charts.gif
   trunk/img/images/zij_columns.gif
   trunk/img/images/zij_concertagenda.gif
   trunk/img/images/zij_home.gif
   trunk/img/images/zij_interviews.gif
   trunk/img/images/zij_meer.gif
   trunk/img/images/zij_moderatie.gif
   trunk/img/images/zij_musica.gif
   trunk/img/images/zij_muziek.gif
   trunk/img/images/zij_muziekgegevens.gif
   trunk/img/images/zij_muziekoverzicht.gif
   trunk/img/images/zij_muziekuploaden.gif
   trunk/img/images/zij_nieuw.gif
   trunk/img/images/zij_nieuws.gif
   trunk/img/images/zij_overzicht.gif
   trunk/img/images/zij_playlists.gif
   trunk/img/images/zij_profiel.gif
   trunk/img/images/zij_simuze.gif
   trunk/img/images/zij_tips.gif
   trunk/img/images/zij_uitgelicht.gif
   trunk/img/images/zij_views.gif
   trunk/img/images/zij_wie.gif
   trunk/img/images/zoekknop.gif
   trunk/img/logo.gif
   trunk/img/movers/
   trunk/img/movers/CSSleft.gif
   trunk/img/movers/CSSright.gif
   trunk/img/movers/menulinks.gif
   trunk/img/movers/menulinks_reviews.gif
   trunk/img/movers/menurechts.gif
   trunk/img/movers/menurechts_boven.gif
   trunk/img/movers/menurechts_onder.gif
   trunk/img/movers/news_industrie.gif
   trunk/img/movers/news_industrie_over.gif
   trunk/img/movers/news_live.gif
   trunk/img/movers/news_live_over.gif
   trunk/img/movers/news_remixes.gif
   trunk/img/movers/news_simuze.gif
   trunk/img/movers/subCSSleft.gif
   trunk/img/movers/subCSSright.gif
   trunk/img/news/
   trunk/img/news/sennen.jpg
   trunk/img/screenshots/
   trunk/img/screenshots/cc.gif
   trunk/img/screenshots/ftp_1.gif
   trunk/img/screenshots/ftp_2.gif
   trunk/img/screenshots/gegevens_stap1.gif
   trunk/img/screenshots/gegevens_stap2.gif
   trunk/img/screenshots/gegevens_stap3.gif
   trunk/img/screenshots/gegevens_stap4.gif
   trunk/img/screenshots/mainpage_wordnulid.gif
   trunk/img/screenshots/muziek_uploaden.gif
   trunk/img/screenshots/register.gif
   trunk/inc/
   trunk/inc/class.phpmailer.php
   trunk/inc/db/
   trunk/inc/db/db_search.php
   trunk/inc/external/
   trunk/inc/external/getid3/
   trunk/inc/external/getid3/extension.cache.dbm.php
   trunk/inc/external/getid3/extension.cache.mysql.php
   trunk/inc/external/getid3/getid3.lib.php
   trunk/inc/external/getid3/getid3.php
   trunk/inc/external/getid3/module.archive.rar.php
   trunk/inc/external/getid3/module.archive.szip.php
   trunk/inc/external/getid3/module.archive.zip.php
   trunk/inc/external/getid3/module.audio-video.asf.php
   trunk/inc/external/getid3/module.audio-video.bink.php
   trunk/inc/external/getid3/module.audio-video.matroska.php
   trunk/inc/external/getid3/module.audio-video.mpeg.php
   trunk/inc/external/getid3/module.audio-video.nsv.php
   trunk/inc/external/getid3/module.audio-video.quicktime.php
   trunk/inc/external/getid3/module.audio-video.real.php
   trunk/inc/external/getid3/module.audio-video.riff.php
   trunk/inc/external/getid3/module.audio-video.swf.php
   trunk/inc/external/getid3/module.audio.aac.php
   trunk/inc/external/getid3/module.audio.ac3.php
   trunk/inc/external/getid3/module.audio.au.php
   trunk/inc/external/getid3/module.audio.avr.php
   trunk/inc/external/getid3/module.audio.bonk.php
   trunk/inc/external/getid3/module.audio.flac.php
   trunk/inc/external/getid3/module.audio.la.php
   trunk/inc/external/getid3/module.audio.lpac.php
   trunk/inc/external/getid3/module.audio.midi.php
   trunk/inc/external/getid3/module.audio.mod.php
   trunk/inc/external/getid3/module.audio.monkey.php
   trunk/inc/external/getid3/module.audio.mp3.php
   trunk/inc/external/getid3/module.audio.mpc.php
   trunk/inc/external/getid3/module.audio.ogg.php
   trunk/inc/external/getid3/module.audio.optimfrog.php
   trunk/inc/external/getid3/module.audio.rkau.php
   trunk/inc/external/getid3/module.audio.shorten.php
   trunk/inc/external/getid3/module.audio.tta.php
   trunk/inc/external/getid3/module.audio.voc.php
   trunk/inc/external/getid3/module.audio.vqf.php
   trunk/inc/external/getid3/module.audio.wavpack.php
   trunk/inc/external/getid3/module.graphic.bmp.php
   trunk/inc/external/getid3/module.graphic.gif.php
   trunk/inc/external/getid3/module.graphic.jpg.php
   trunk/inc/external/getid3/module.graphic.pcd.php
   trunk/inc/external/getid3/module.graphic.png.php
   trunk/inc/external/getid3/module.graphic.tiff.php
   trunk/inc/external/getid3/module.misc.exe.php
   trunk/inc/external/getid3/module.misc.iso.php
   trunk/inc/external/getid3/module.tag.apetag.php
   trunk/inc/external/getid3/module.tag.id3v1.php
   trunk/inc/external/getid3/module.tag.id3v2.php
   trunk/inc/external/getid3/module.tag.lyrics3.php
   trunk/inc/external/getid3/write.apetag.php
   trunk/inc/external/getid3/write.id3v1.php
   trunk/inc/external/getid3/write.id3v2.php
   trunk/inc/external/getid3/write.lyrics3.php
   trunk/inc/external/getid3/write.metaflac.php
   trunk/inc/external/getid3/write.php
   trunk/inc/external/getid3/write.real.php
   trunk/inc/external/getid3/write.vorbiscomment.php
   trunk/inc/external/magpierss/
   trunk/inc/external/magpierss/cache/
   trunk/inc/external/magpierss/cache/8e99a8852dead559703e55398fe9606e
   trunk/inc/external/magpierss/extlib/
   trunk/inc/external/magpierss/extlib/Snoopy.class.inc
   trunk/inc/external/magpierss/rss_cache.inc
   trunk/inc/external/magpierss/rss_fetch.inc
   trunk/inc/external/magpierss/rss_parse.inc
   trunk/inc/external/magpierss/rss_utils.inc
   trunk/inc/external/xspf/
   trunk/inc/external/xspf/class.XSPF.php
   trunk/inc/external/xspf/class.XSPF_Track.php
   trunk/inc/marten_kweeries.php
   trunk/inc/sm-db-queries.php
   trunk/inc/sm-db-queries_backup.php
   trunk/inc/sm-db-settings.php
   trunk/inc/sm-fetchnews.php
   trunk/inc/sm-getprofile.php
   trunk/inc/sm-lib-functions.php
   trunk/inc/sm-lib-functions_backup.php
   trunk/inc/sm-lib-functions_backup2.php
   trunk/inc/sm-logout.php
   trunk/inc/sm-messages.php
   trunk/inc/sm-secure-level2.php
   trunk/inc/sm-secure.php
   trunk/index.php
   trunk/index_0.php
   trunk/index_1.php
   trunk/info_filmpje2.swf
   trunk/js/
   trunk/js/lib.js
   trunk/js/require.js
   trunk/js/sendit.js
   trunk/js/tableruler.js
   trunk/js/tcells.js
   trunk/leesvoer.php
   trunk/logged_in_menu.php
   trunk/lost.php
   trunk/main_sidebar.php
   trunk/mainstyle.css
   trunk/maintemplate.php
   trunk/media/
   trunk/media/avatar/
   trunk/media/avatar/default/
   trunk/media/avatar/default/default_avatar240x180.gif
   trunk/media/avatar/default/default_avatar40x30.gif
   trunk/media/flash/
   trunk/media/flash/musicplayer.swf
   trunk/media/flash/simuze_playerv01.swf
   trunk/media/playlist/
   trunk/media/playlist/temp/
   trunk/media/playlist/users/
   trunk/mustread.php
   trunk/mv_index.swf
   trunk/nbrief_false.php
   trunk/nbrief_true.php
   trunk/noprofile.php
   trunk/not_logged_in_menu.php
   trunk/oversimuze.php
   trunk/profile_view.php
   trunk/profilemusic_view.php
   trunk/profilenormal_view.php
   trunk/register.php
   trunk/searchform.php
   trunk/showprofile.php
   trunk/sidebar.php
   trunk/simTESTER.php
   trunk/simplemailer.php
   trunk/simuze_helpen.php
   trunk/sm-confirm.php
   trunk/sm-login.php
   trunk/sm-lost.php
   trunk/sm-nieuwsbrief.php
   trunk/sm-register.php
   trunk/sm-search.php
   trunk/sql/
   trunk/sql/sm_system.sql
   trunk/submenu.php
   trunk/tableruler.html
   trunk/template.php
   trunk/template_header.php
   trunk/template_header_search.php
   trunk/template_sidebar_footer.php
   trunk/template_sidebar_footer_main.php
   trunk/templates/
   trunk/templates/submenu.php
   trunk/templates/template.php
   trunk/templates/template2.php
   trunk/templates/template_header.php
   trunk/templates/template_sidebar_footer.php
   trunk/templates/template_sidebar_footer_main.php
   trunk/test.xspf
   trunk/users/
   trunk/users/.htaccess.bak
   trunk/users/change_settings.php
   trunk/users/edit_music.php
   trunk/users/edit_playlist.php
   trunk/users/hq.php
   trunk/users/hq_backup.php
   trunk/users/menurechts.php
   trunk/users/overview_music.php
   trunk/users/player.php
   trunk/users/playlist.php
   trunk/users/playlist_backup.php
   trunk/users/playlist_create.php
   trunk/users/profile.php
   trunk/users/sm-change_settings.php
   trunk/users/sm-edit-music.php
   trunk/users/sm-playlist_generate.php
   trunk/users/sm-profile.php
   trunk/users/sm-upload.php
   trunk/users/tag.php
   trunk/users/upload.php
   trunk/voorwaarden.php
Log:
the disorganized base from Simuze

Added: trunk/.htaccessbak
===================================================================
--- trunk/.htaccessbak	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/.htaccessbak	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,4 @@
+AuthType Basic
+AuthName &quot;Simuze Live&quot; 
+AuthUserFile /var/www/simuze.nl/live/.htpasswd
+Require user simuze


Property changes on: trunk/.htaccessbak
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/.htpasswd
===================================================================
--- trunk/.htpasswd	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/.htpasswd	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,2 @@
+simuze:9j92YwnWspOVI
+jaap:tLUbGrjflaHqI

Added: trunk/admin/create_moderator.php
===================================================================
--- trunk/admin/create_moderator.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/admin/create_moderator.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,62 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-secure-level2.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;template_header.php&quot;);
+
+$max = 300;
+$level = 1;
+$h = qGetUsers($max,$level);
+$nr = mysql_num_rows($h);
+$vieuw = null;
+
+
+
+if($nr &lt; 0) {
+	$vieuw .=&quot;Geen gebruikers gevonden&quot;;
+} else {
+	
+	$view .= &quot;&lt;table border=\&quot;0\&quot; bgcolor=\&quot;#F8E4B3\&quot; width=\&quot;500\&quot; cellpadding=\&quot;4\&quot; cellspacing=\&quot;1\&quot; id=\&quot;playlist\&quot;&gt;&quot;;
+	for($i=0;$i&lt;$nr;$i++) {
+		$row = mysql_fetch_array($h);
+		
+		$view .= &quot;&lt;tr&gt;&quot;;
+		$view .= &quot;&lt;td&gt;&lt;input type=\&quot;checkbox\&quot; name=\&quot;user[]\&quot; value=\&quot;$row[uid]\&quot;  /&gt;&lt;/td&gt;&quot;;
+		$view .= &quot;&lt;td&gt;&quot;;
+		$view .= &quot;$row[uname]&quot;;
+		$view .= &quot;&lt;/td&gt;&quot;;
+		$view .= &quot;&lt;td&gt;&quot;;
+		$view .= createSelectGenre($row['uid']);
+		$view .= &quot;&lt;/td&gt;&quot;;
+		$view .= &quot;&lt;/tr&gt;&quot;;
+	
+	}
+	$view .= &quot;&lt;/table&gt;&quot;;
+}
+
+
+
+
+?&gt;
+	&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				    &lt;div&gt;&lt;h1&gt;Moderators aanmaakpagina&lt;/h1&gt;&lt;/div&gt;
+                        &lt;p class=&quot;space&quot;&gt;
+                        	Hier kun je van een gebruiker met user-level 1 een moderator (user-level 2) maken. 
+                        &lt;/p&gt;
+						&lt;form action=&quot;admin/sm-create_moderators.php&quot; method=&quot;post&quot; name=&quot;create&quot; id=&quot;create&quot;&gt;
+						
+							&lt;?php echo $view;?&gt;
+							&lt;br /&gt;
+							&lt;br /&gt;
+							&lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;true&quot; class=&quot;hidden&quot; /&gt;
+							&lt;input type=&quot;image&quot; name=&quot;submit&quot; src=&quot;img/images/versturen_btn.gif&quot; value=&quot;Verstuur&quot;&gt;&lt;/p&gt;
+					
+						&lt;/form&gt;
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;

Added: trunk/admin/moderate.php
===================================================================
--- trunk/admin/moderate.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/admin/moderate.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,133 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-secure-level2.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+//set username
+$uname = $_SESSION['name'];
+
+//set log array
+$log = array();
+
+
+$flashplayer = '&lt;object classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; codebase=&quot;<A HREF="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0">http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0</A>&quot; width=&quot;17&quot; height=&quot;17&quot; id=&quot;musicplayer&quot; align=&quot;middle&quot;&gt;';
+$flashplayer.= '&lt;param name=&quot;allowScriptAccess&quot; value=&quot;sameDomain&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;movie&quot; value=&quot;admin/musicplayer.swf&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;loop&quot; value=&quot;false&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;menu&quot; value=&quot;false&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;quality&quot; value=&quot;high&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;flashvars&quot; value=&quot;song_url=##URL##&quot;';
+$flashplayer.= '&lt;param name=&quot;wmode&quot; value=&quot;transparent&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;bgcolor&quot; value=&quot;#f7f3e7&quot; /&gt;';
+$flashplayer.= '&lt;embed src=&quot;admin/musicplayer.swf&quot; flashvars=&quot;song_url=##URL##&quot;loop=&quot;false&quot; menu=&quot;false&quot; quality=&quot;high&quot; wmode=&quot;transparent&quot; bgcolor=&quot;#f7f3e7&quot; width=&quot;17&quot; height=&quot;17&quot; name=&quot;musicplayer&quot; align=&quot;middle&quot; allowScriptAccess=&quot;sameDomain&quot; type=&quot;application/x-shockwave-flash&quot; pluginspage=&quot;<A HREF="http://www.macromedia.com/go/getflashplayer">http://www.macromedia.com/go/getflashplayer</A>&quot; /&gt;';
+$flashplayer.= '&lt;/object&gt;';
+
+
+
+
+
+//get users uid
+$uname_h = qGetUserInfo($uname);
+if($nr_rows = mysql_num_rows ($uname_h) == 1) {
+    $row = mysql_fetch_array($uname_h);
+	//get moderator info
+	$mod_h = qGetGenreFromModerator($row['uid']);
+	if($nr_mod = mysql_num_rows ($mod_h) == 1) {
+		$mod = mysql_fetch_array($mod_h);
+		
+		// get the list
+		$modlist_h = qGetModList($mod['genre_id']);
+		$list_nr = mysql_num_rows($modlist_h);
+		
+			// Maximum word lenght is 25 chars
+			$chars  = str_word_count($filename,2);		
+			$nr_chars = 25;
+			for($j = 0; $j &lt; $nr_chars; $j++) {
+			$file_short .= $chars[$j] . &quot; &quot;;
+			}
+				
+		if($list_nr &gt; 0 ) {
+			for($i=0;$i&lt;$list_nr;$i++) {
+			$moditem = mysql_fetch_array($modlist_h);
+		    $filename = $moditem['audio_filename'];
+
+				  
+				$hi_path = rawurldecode($moditem['audio_hi_path']);
+				$the_hi_url = str_replace(&quot;/data/&quot;,&quot;<A HREF="http://www.simuze.nl/live/">http://www.simuze.nl/live/</A>&quot;,$hi_path);
+				//echo &quot;$the_hi_url&quot;;
+				$flash = str_replace(&quot;##URL##&quot;, $the_hi_url ,$flashplayer);
+				
+				
+				$arow .= &quot;&lt;tr&gt;\n&quot;;
+				$arow .= &quot;&lt;td bgcolor=\&quot;#EDD8BE\&quot;&gt;$filename&lt;/td&gt;\n&quot;; // verander $filename tot $file_short
+				$arow .= &quot;&lt;td bgcolor=\&quot;#EDD8BE\&quot;&gt;$moditem[audio_title]&lt;/td&gt;\n&quot;;
+				$arow .= &quot;&lt;td width=\&quot;55\&quot;&gt;$flash&lt;/td&gt;\n&quot;;
+				$arow .= &quot;&lt;td bgcolor=\&quot;#F8E4B3\&quot;&gt;&lt;a href=\&quot;admin/sm-moderate.php?action=add&amp;audio=$moditem[audio_id]\&quot; title=\&quot;nummer toevoegen aan Simuze\&quot;&gt;Voeg toe&lt;/a&gt;&lt;/td&gt;\n&quot;;
+				$arow .= &quot;&lt;td bgcolor=\&quot;#F8E4B3\&quot;&gt;&lt;a href=\&quot;admin/sm-moderate.php?action=reject&amp;audio=$moditem[audio_id]\&quot; title=\&quot;nummer afwijzen\&quot;&gt;Wijs af&lt;/a&gt;&lt;/td&gt;\n&quot;;
+				$arow .= &quot;&lt;td bgcolor=\&quot;#F8E4B3\&quot;&gt;&lt;a href=\&quot;admin/sm-moderate.php?action=return&amp;audio=$moditem[audio_id]\&quot; title=\&quot;nummer teruggeven aan gebruiker\&quot;&gt;Terug geven&lt;/a&gt;&lt;/td&gt;\n&quot;;
+				
+				$arow .= &quot;&lt;/tr&gt;\n&quot;;	
+			}
+		} else { 
+			 //no files found
+            array_push($log, &quot;geen bestanden gevonden&quot;);
+		}
+	
+	} else {
+		//too many files
+		 array_push($log, &quot;teveel&quot;);
+	} 	
+} else {
+	///go away
+  array_push($log, &quot;hee ga eens weg!&quot;);
+}
+
+require_once(&quot;template_header.php&quot;);
+?&gt;
+
+	&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_moderatie&quot;&gt;
+				    &lt;div&gt;&lt;h1&gt;Dit is de moderatie pagina van het genre: &lt;?php echo $mod['genre_name']?&gt;&lt;/h1&gt;&lt;/div&gt;
+                        &lt;p class=&quot;space&quot;&gt;
+                        	Op deze pagina kun je aangeven of een nummer toegevoegd mag worden aan Simuze of niet. 
+							Als een muziekstuk volgens jou niet toegevoegd mag worden aan Simuze moet je daar een reden op kunnen geven. Op zich mogen all soorten muziek op Simuze verschijnen, echter zijn er enkele leefregels waaraan je je dient te houden. Jij bent een van de mensen die deze leefregels in de gaten houdt. 
+                        &lt;/p&gt;
+						&lt;p class=&quot;space&quot;&gt;
+							De leefregels zijn eigenlijk erg simpel:
+						&lt;/p&gt;	
+						&lt;p class=&quot;space&quot;&gt;
+							&lt;ul&gt;
+								&lt;li&gt;
+									Geen muziek die overduidelijk auteursrechtelijk is beschermd en waar de maker zeer waarschijnlijk geen toestemming heeft gegeven om het op Simuze te plaatsen, zoals werk van Eminem, Madonna etc.
+								 &lt;/li&gt;
+								 &lt;li&gt;
+								 	Geen muziek die overduidelijk alleen maar haat verspreidt denk hierbij aan nazistische, racistische homefobe muziek. Gangsterrap ok, Stormkraft nee. Dit is natuurlijk enigszins subjectief en probeer hier een open mind bij te houden. Als je twijfelt overleg dan even met iemand of laat het doorgaan. Wanneer het overduidelijk alleen maar haatmuziek is dan kunnen luisteraars dit via de playlists eruit filteren
+								 &lt;/li&gt;
+							&lt;/ul&gt;
+						&lt;/p&gt;	
+						&lt;br /&gt;
+						&lt;div class=&quot;downloads_roundcont&quot;&gt;
+						&lt;div id=&quot;audiobestanden_kopje&quot;&gt;&lt;/div&gt;
+						
+							&lt;table border=&quot;0&quot; cellpadding=&quot;2&quot; cellspacing=&quot;2&quot; width=&quot;595&quot;&gt;
+								&lt;tr&gt;
+									&lt;th&gt;Bestandsnaam&lt;/th&gt;
+									&lt;th&gt;Titel&lt;/th&gt;
+									&lt;th colspan=&quot;4&quot;&gt;Beluister&lt;/th&gt;
+								&lt;/tr&gt;
+								&lt;?php echo $arow;
+							?&gt;
+							&lt;/table&gt;
+							&lt;p class=&quot;space&quot;&gt;
+							&lt;?php 
+								 foreach($log as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        } ?&gt;
+						&lt;/p&gt;
+						&lt;div class=&quot;downloads_roundbottom&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;

Added: trunk/admin/musicplayer.swf
===================================================================
(Binary files differ)


Property changes on: trunk/admin/musicplayer.swf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/admin/sm-create_moderators.php
===================================================================
--- trunk/admin/sm-create_moderators.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/admin/sm-create_moderators.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,52 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-secure-level2.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;template_header.php&quot;);
+
+//print_r($_POST);
+
+$user = $_POST['user'];
+$db = array();
+$moderator = array();
+$log = array();
+$level = 2;
+
+
+//	insert moderator info in moderator table 
+//	set user_level in user table. userlevel 2 means u r a moderator
+
+foreach($user as $ukey=&gt;$uval) {
+	$moderator['uid'] = $uval;
+	$moderator['genre_id'] = $_POST[$uval];
+	if($moderator['genre_id'] != 'default') {
+		$mod_id = qInsertModerator($moderator['uid'], $moderator['genre_id']);
+		array_push($log, &quot;Moderator aangemaakt id is: &lt;b&gt;$mod_id&lt;/b&gt;\n&quot;);
+		$user_id = qUpdateUserLevelByUID($moderator['uid'], $level);
+		array_push($log, &quot;User met id $moderator[uid] heeft nu userlevel $level\n&quot;);
+	}	
+}
+?&gt;
+	&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				    &lt;div&gt;&lt;h1&gt;Moderators aanmaak feedback&lt;/h1&gt;&lt;/div&gt;
+                        &lt;p class=&quot;space&quot;&gt;
+                        	Onderstaande is gedaan:
+                      
+							&lt;?php 
+							foreach($log as $k=&gt;$val) {
+								echo &quot;$val&lt;br /&gt;&quot;;	
+							}
+							?&gt;	
+							
+						&lt;/p&gt;
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
+
+

Added: trunk/admin/sm-moderate.php
===================================================================
--- trunk/admin/sm-moderate.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/admin/sm-moderate.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,136 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-secure-level2.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+
+
+$log = array();
+$feedback = array();
+
+
+//get userid of moderator
+$handle_mod = qGetUserInfo($_SESSION['name']);
+if($nr_mod = mysql_num_rows($handle_mod) == 1) {
+	$moderator = mysql_fetch_array($handle_mod);
+} else {
+	array_push($log, &quot;Kon geen moderatorinfo verkrijgen&quot;);
+}
+
+
+
+$action = $_GET['action'];
+$audio_id = $_GET['audio'];
+
+
+if(!empty($action) &amp;&amp; !empty($audio_id)) {
+	//get info from current file
+	$audio_handle = qGetAudioByID($audio_id);
+	if($nr_audio = mysql_num_rows($audio_handle) == 1) {
+		$audio = mysql_fetch_array($audio_handle);	
+		$user_handle = qGetUserByID($audio['uid']);	
+		if($nr_user = mysql_num_rows($user_handle) == 1) {
+			$userinfo = mysql_fetch_array($user_handle);
+			
+			switch($action) {
+				case 'add':
+				/*		
+				*	1. move file to /data/public/username/mp3hi and /data/public/username/mp3hi
+				*	2. update audio_status and paths
+				*	3. insert moderation_history
+				#   4. send feedback 2 user
+				*/
+				$status = &quot;public&quot;;
+				$username = $userinfo['uname'];
+				$fname = $audio['audio_filename'];
+				
+				$new_hi_path = HOMEDIR_PUBLIC . $username.&quot;/&quot; .HI_QUALITY_DIR .$fname;
+				$old_hi_path = rawurldecode($audio['audio_hi_path']);
+				
+				$new_lo_path = HOMEDIR_PUBLIC . $username.&quot;/&quot; .LO_QUALITY_DIR .$fname;
+				$old_lo_path = rawurldecode($audio['audio_lo_path']);
+				
+				$description = &quot;Geen bezwaar en dus nummer toevoegen&quot;;
+				
+				if(rename($old_hi_path, $new_hi_path)) {
+					if(rename($old_lo_path, $new_lo_path)) {
+						if(qUpdateAudio($status, $audio_id, rawurlencode($new_hi_path), rawurlencode($new_lo_path)) &gt;= 0) {
+							if(qInsertModerationHistory($audio_id, $moderator['uid'], $status, $description)) {
+								
+								$subject = &quot;Simuze moderatie voltooid&quot;; 
+								
+								$mod_msg .= &quot;Dit is een mailtje van Simuze.nl\n\n&quot;;
+								$mod_msg .= &quot;Het bestand $fname is verwerkt en staat nu op simuze.nl\n&quot;;
+								$mod_msg .= &quot;De directe link voor de hoge kwaliteit is <A HREF="http://www.simuze.nl/public/$username/">http://www.simuze.nl/public/$username/</A>&quot;.HI_QUALITY_DIR .$fname .&quot;\n&quot;; 
+								$mod_msg .= &quot;De directe link voor de lage kwaliteit is <A HREF="http://www.simuze.nl/public/$username/">http://www.simuze.nl/public/$username/</A>&quot;.LO_QUALITY_DIR .$fname .&quot;\n\n&quot;;
+								$mod_msg .= &quot;Het Simuze team&quot;;
+								
+
+								array_push($feedback, &quot;Moderatie geslaagd.\n&quot;);
+								if(sendFeedback($userinfo['email'], $subject, $mod_msg)) {
+									array_push($feedback, &quot;email met feedback aan gebruiker verzonden&quot;);
+								}
+							}
+							
+						} else { 
+								array_push($log, &quot;update mislukt&quot;);
+						}
+					} else {
+							array_push($log, &quot;Kon bestand niet verplaatsen van $old_lo_path naar $new_lo_path&quot;);
+					}
+				} else {
+						array_push($log, &quot;Kon bestand niet verplaatsen van $old_hi_path naar $new_hi_path&quot;);
+				}
+				break;
+				
+				case 'reject':
+				/*
+				*	1. move file to /data/reject/username/mp3hi and /data/reject/username/mp3lo /data/reject/username/ori
+				*	2. update audio_status and path
+				*	3. insert moderation_history
+				*	4. send feedback 2 user
+				*/
+				break;
+			
+				case 'return':
+				/*
+				*	1. insert moderation_history
+				*	2. send feedback 2 user
+				*/
+				break;		
+			}
+		} else { 
+			array_push($log, &quot;Kon geen gebruiker vinden&quot;, $nr_user);
+			
+		}
+	} else {
+		array_push($log, &quot;Kon geen db info verkrijgen&quot;);
+	} 
+} else {
+	array_push($log, &quot;Lege actie&quot;);
+}
+?&gt;
+&lt;?php require_once(&quot;../template_header.php&quot;);?&gt;
+&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Moderation status&lt;/h1&gt;
+                    &lt;p class=&quot;space&quot;&gt;
+                     &lt;?php
+                    if($continue) {
+                        foreach($feedback as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        }
+                    } else {
+                         foreach($log as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        }
+                    }
+                    ?&gt;                           
+                    &lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require_once(&quot;../template_sidebar_footer.php&quot;);?&gt;

Added: trunk/admin/sm-moderate_backup.php
===================================================================
--- trunk/admin/sm-moderate_backup.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/admin/sm-moderate_backup.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,135 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-secure-level2.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+
+
+$log = array();
+$feedback = array();
+
+
+//get userid of moderator
+$handle_mod = qGetUserInfo($_SESSION['name']);
+if($nr_mod = mysql_num_rows($handle_mod) == 1) {
+	$moderator = mysql_fetch_array($handle_mod);
+} else {
+	array_push($log, &quot;Kon geen moderatorinfo verkrijgen&quot;);
+}
+
+
+
+$action = $_GET['action'];
+$audio_id = $_GET['audio'];
+
+
+if(!empty($action) &amp;&amp; !empty($audio_id)) {
+	//get info from current file
+	$audio_handle = qGetAudioByID($audio_id);
+	if($nr_audio = mysql_num_rows($audio_handle) == 1) {
+		$audio = mysql_fetch_array($audio_handle);	
+		$user_handle = qGetUserByID($audio['uid']);	
+		if($nr_user = mysql_num_rows($user_handle) == 1) {
+			$userinfo = mysql_fetch_array($user_handle);
+			
+			switch($action) {
+				case 'add':
+				/*		
+				*	1. move file to /data/public/username/mp3hi and /data/public/username/mp3hi
+				*	2. update audio_status and paths
+				*	3. insert moderation_history
+				#   4. send feedback 2 user
+				*/
+				$status = &quot;public&quot;;
+				$username = $userinfo['uname'];
+				$fname = $audio['audio_filename'];
+				
+				$new_hi_path = HOMEDIR_PUBLIC . $username.&quot;/&quot; .HI_QUALITY_DIR .$fname;
+				$old_hi_path = rawurldecode($audio['audio_hi_path']);
+				
+				$new_lo_path = HOMEDIR_PUBLIC . $username.&quot;/&quot; .LO_QUALITY_DIR .$fname;
+				$old_lo_path = rawurldecode($audio['audio_lo_path']);
+				
+				$description = &quot;Geen bezwaar en dus nummer toevoegen&quot;;
+				
+				if(rename($old_hi_path, $new_hi_path)) {
+					if(rename($old_lo_path, $new_lo_path)) {
+						if(qUpdateAudio($status, $audio_id, rawurlencode($new_hi_path), rawurlencode($new_lo_path)) &gt;= 0) {
+							if(qInsertModerationHistory($audio_id, $moderator['uid'], $status, $description)) {
+								
+								$subject = &quot;Simuze moderatie voltooid&quot;; 
+								
+								$mod_msg .= &quot;Dit is een mailtje van Simuze.nl\n\n&quot;;
+								$mod_msg .= &quot;Het bestand $fname is verwerkt en staat nu op simuze.nl\n&quot;;
+								$mod_msg .= &quot;De directe link voor de hoge kwaliteit is <A HREF="http://www.simuze.nl/public/$username/">http://www.simuze.nl/public/$username/</A>&quot;.HI_QUALITY_DIR .$fname .&quot;\n&quot;; 
+								$mod_msg .= &quot;De directe link voor de lage kwaliteit is <A HREF="http://www.simuze.nl/public/$username/">http://www.simuze.nl/public/$username/</A>&quot;.LO_QUALITY_DIR .$fname .&quot;\n\n&quot;;
+								$mod_msg .= &quot;Het Simuze team&quot;;
+								
+
+								array_push($feedback, &quot;Moderatie geslaagd.\n&quot;);
+								if(sendFeedback($userinfo['email'], $subject, $mod_msg)) {
+									array_push($feedback, &quot;email met feedback aan gebruiker verzonden&quot;);
+								}
+							}
+							
+						} else { 
+								array_push($log, &quot;update mislukt&quot;);
+						}
+					} else {
+							array_push($log, &quot;Kon bestand niet verplaatsen van $old_lo_path naar $new_lo_path&quot;);
+					}
+				} else {
+						array_push($log, &quot;Kon bestand niet verplaatsen van $old_hi_path naar $new_hi_path&quot;);
+				}
+				break;
+				
+				case 'reject':
+				/*
+				*	1. move file to /data/reject/username/mp3hi and /data/reject/username/mp3lo /data/reject/username/ori
+				*	2. update audio_status and path
+				*	3. insert moderation_history
+				*	4. send feedback 2 user
+				*/
+				break;
+			
+				case 'return':
+				/*
+				*	1. insert moderation_history
+				*	2. send feedback 2 user
+				*/
+				break;		
+			}
+		} else { 
+			array_push($log, &quot;Kon geen gebruiker vinden&quot;);
+		}
+	} else {
+		array_push($log, &quot;Kon geen db info verkrijgen&quot;);
+	} 
+} else {
+	array_push($log, &quot;Lege actie&quot;);
+}
+?&gt;
+&lt;?php require_once(&quot;../template_header.php&quot;);?&gt;
+&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Moderation status&lt;/h1&gt;
+                    &lt;p class=&quot;space&quot;&gt;
+                     &lt;?php
+                    if($continue) {
+                        foreach($feedback as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        }
+                    } else {
+                         foreach($log as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        }
+                    }
+                    ?&gt;                           
+                    &lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require_once(&quot;../template_sidebar_footer.php&quot;);?&gt;

Added: trunk/allusers.php
===================================================================
--- trunk/allusers.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/allusers.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,64 @@
+&lt;?php
+require 'template_header.php'; 
+require('inc/marten_kweeries.php');
+	
+
+$handle = qGetAllUsers();
+$nr_rows = mysql_num_rows($handle);
+
+	for ($i = 0; $i &lt; $nr_rows; $i++) {
+			$user = mysql_fetch_array($handle);
+			
+			$user_tabel .= &quot;&lt;tr&gt;&quot;;
+			$user_tabel.= &quot;&lt;td bgcolor=\&quot;#EDD8BE\&quot;&gt;&quot;;
+			$user_tabel.= &quot;&lt;a href=\&quot;showprofile.php?username=$user[uname]\&quot; title=\&quot;bekijk het profiel van $user[uname]\&quot;&gt; $user[uname]&lt;/a&gt;&quot;;
+			$user_tabel .= &quot;&lt;/td&gt;&quot;;
+			$user_tabel.= &quot;&lt;td bgcolor=\&quot;#EDD8BE\&quot;&gt;&quot;;
+			$user_tabel .= $user['location'];
+			$user_tabel .= &quot;&lt;/td&gt;&quot;;
+			$user_tabel .= &quot;&lt;/tr&gt;&quot;;
+		
+	}
+?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_artiesten&quot;&gt;
+				
+					
+					&lt;h1&gt;Simuze leden overzicht:&lt;/h1&gt;
+						
+					
+							
+					
+					&lt;div class=&quot;downloads_roundcont&quot;&gt;
+						&lt;div id=&quot;simuzeleden_kopje&quot;&gt;&lt;/div&gt;
+					
+						&lt;center&gt;
+						&lt;table border=&quot;0&quot; width=&quot;596&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot;&gt;
+							&lt;tr&gt;	
+								&lt;td colspan=&quot;2&quot;&gt;er zijn &lt;b&gt;&lt;?php echo &quot;$nr_rows&quot;; ?&gt;&lt;/b&gt; gebruikers aangemeld bij Simuze die al een profiel hebben aangemaakt.&lt;/td&gt;
+							&lt;/tr&gt;	
+							&lt;tr&gt;
+								&lt;td&gt;&lt;b&gt;Gebruikers:&lt;/b&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;b&gt;Lokatie:&lt;/b&gt;&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;?php echo &quot;$user_tabel&quot;; ?&gt;
+						&lt;/table&gt;
+						&lt;/center&gt;
+						&lt;div class=&quot;downloads_roundbottom&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;
+					
+					
+					
+					
+					
+					&lt;p&gt; &nbsp;&lt;/p&gt;
+					
+							
+					
+			
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;		

Added: trunk/artiesten/alternatief.php
===================================================================
--- trunk/artiesten/alternatief.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/artiesten/alternatief.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,169 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require 'template_header.php'; 
+require('inc/marten_kweeries.php');
+	
+$h_latest = qGetLatestArtistByGenre(3);
+$nr_users = mysql_num_rows($h_latest);
+$latest_users = null;
+
+if( $nr_users &gt; 0) {
+	$latest_users = &quot;&lt;table border=\&quot;0\&quot; class=\&quot;ruler\&quot; id=\&quot;mytable\&quot;&gt;\n&quot;;
+	for($i = 0; $i &lt; $nr_users; $i++) {
+		$row = mysql_fetch_array($h_latest);
+		//prep path to avatar
+		$decoded_path = rawurldecode($row['avatar_path']);
+		$path = str_replace(&quot;/var/www/simuze.nl/live/&quot;,&quot;&quot;,$decoded_path); 
+        $imgsrc = $path . $row['avatar_filename_small'];
+		
+		$latest_users .= &quot;&lt;tr&gt;\n&quot;;
+		$latest_users .= &quot;&lt;td&gt;&lt;a href=\&quot;showprofile.php?username=$row[uname]\&quot; title=\&quot;bekijk het profiel van $row[uname]\&quot;&gt; Bekijk het profiel van artiest: $row[audio_artist]&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$latest_users .= &quot;&lt;td&gt;&lt;a href=\&quot;showprofile.php?username=$row[uname]\&quot; title=\&quot;bekijk het profiel van $row[audio_artist]\&quot;&gt;&lt;img alt=\&quot;avatar\&quot; src=\&quot;$imgsrc\&quot; /&gt;&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$latest_users .= &quot;&lt;/tr&gt;\n&quot;;
+	}
+$latest_users .= &quot;&lt;/table&gt;\n&quot;;
+	
+} else {
+	$latest_users = &quot;Er zijn op dit moment (nog) geen nieuwe artiesten gevonden&quot;;
+}
+
+
+/* code voor het weergeven van de artiesten */
+$handle = qGetArtistByGenre(3);
+$nr_rows = mysql_num_rows($handle);
+
+$artist = array();
+
+for($i = 0; $i &lt; $nr_rows; $i++) {
+	$row = mysql_fetch_array($handle);
+	array_push($artist, $row['audio_artist']);
+}
+
+$aantal_artiesten = count($artist);
+
+natcasesort($artist);
+
+
+/* code voor het weergeven van de nummers */
+$handle2 = qGetAudioByGenre(3);
+$nr_rows2 = mysql_num_rows($handle2);
+
+/* code voor het aanpassen van de path van het audiobestand */
+
+	
+for($i = 0; $i &lt; $nr_rows2; $i++) {
+	$nummer = mysql_fetch_array($handle2);
+	
+	$hi_path = rawurldecode($nummer['audio_hi_path']);
+	$the_hi_url = str_replace(&quot;/data/&quot;,&quot;<A HREF="http://www.simuze.nl/live/">http://www.simuze.nl/live/</A>&quot;,$hi_path);
+	//echo &quot;$the_hi_url&quot;;
+	
+	foreach($nummer as $key =&gt; $value)
+			{
+				$licentie = $nummer['cclicense_id'];
+				
+				if ($licentie == &quot;1&quot;)
+				{
+					$licentie_img = &quot;&lt;img src=\&quot;/live/img/icons/cc_type1.gif\&quot;&gt;&quot;; 
+				}
+				if ($licentie == &quot;2&quot;)
+				{
+					$licentie_img = &quot;&lt;img src=\&quot;/live/img/icons/cc_type2.gif\&quot;&gt;&quot;; 
+				}
+				if ($licentie == &quot;3&quot;)
+				{
+					$licentie_img = &quot;&lt;img src=\&quot;/live/img/icons/cc_type3.gif\&quot;&gt;&quot;; 
+				}
+				if ($licentie == &quot;4&quot;)
+				{
+					$licentie_img = &quot;&lt;img src=\&quot;/live/img/icons/cc_type4.gif\&quot;&gt;&quot;; 
+				}
+				if ($licentie == &quot;5&quot;)
+				{
+					$licentie_img = &quot;&lt;img src=\&quot;/live/img/icons/cc_type5.gif\&quot;&gt;&quot;; 
+				}
+				if ($licentie == &quot;6&quot;)
+				{
+					$licentie_img = &quot;&lt;img src=\&quot;/live/img/icons/cc_type6.gif\&quot;&gt;&quot;; 
+				}
+				
+			}
+			
+	$string .= &quot;&lt;tr bgcolor=\&quot;#EDD8BE\&quot;&gt;&quot;;
+	$string .= &quot;&lt;td&gt;&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;td&gt;&quot;;
+	$string .= &quot;&lt;a href=\&quot;$the_hi_url\&quot;&gt;&quot;;
+	$string .= $nummer['audio_title'];
+	$string .= &quot;&lt;/a&gt;&quot;;
+	$string .= &quot;&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;td&gt;&quot;;
+	$string .= $nummer['audio_artist'];
+	$string .= &quot;&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;td&gt;&quot;;
+	$string .= $licentie_img;
+	$string .= &quot;&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;/tr&gt;&quot;;
+	
+}
+
+//echo $string;
+
+
+?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_artiesten&quot;&gt;
+				
+					
+					&lt;h1&gt;Alternatief&lt;/h1&gt;
+						
+					&lt;div class=&quot;div_links&quot;&gt;
+					&lt;table border=&quot;0&quot; width=&quot;250&quot; cellpadding=&quot;2&quot; cellspacing=&quot;1&quot;&gt;
+						&lt;tr&gt;
+							&lt;td width=&quot;3&quot;&gt;&lt;/td&gt;
+							&lt;td&gt;&lt;a href=&quot;artiesten/alternatief_all.php&quot;&gt;Bevat &lt;b&gt;&lt;?php echo($aantal_artiesten); ?&gt;&lt;/b&gt; artiesten. &lt;img src=&quot;/live/img/images/dubbelpijltje_rood.gif&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&lt;/td&gt;
+						&lt;/tr&gt;	
+							
+						
+					&lt;/table&gt;
+					
+					
+					&lt;/div&gt;
+					
+					&lt;div class=&quot;div_rechts&quot;&gt;	
+						&lt;h2 class=&quot;nospace&quot;&gt;Nieuwe artiesten:&lt;/h2&gt;
+						&lt;?php echo &quot;$latest_users&quot;;?&gt;
+					&lt;/div&gt;
+					
+			&lt;/div&gt;
+			&lt;div class=&quot;bar1_genres&quot;&gt;&lt;/div&gt;
+			&lt;div class=&quot;kolom2_genres&quot;&gt;
+					&lt;div class=&quot;profiel_roundcont&quot;&gt;
+						&lt;div id=&quot;laatsttoegevoegd_kopje&quot;&gt;&lt;/div&gt;
+						&lt;p&gt;Hieronder een overzicht van de laatst toegevoegde nummers
+						&lt;/p&gt;
+					
+						&lt;table border=&quot;0&quot; width=&quot;600&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot;&gt;
+						&lt;tr&gt;
+							&lt;th width=&quot;20&quot;&gt; &lt;/th&gt;
+							&lt;th width=&quot;320&quot;&gt;Titel:&lt;/th&gt;
+							&lt;th&gt;Artiest:&lt;/th&gt;
+							&lt;th&gt;Licentie:&lt;/th&gt;
+						&lt;/tr&gt;	
+						
+						&lt;?php echo $string;
+						?&gt;
+				
+						&lt;/table&gt;
+						
+						&lt;div class=&quot;profiel_roundbottom&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;
+						
+					
+
+			
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require '../template_sidebar_footer.php'; ?&gt;		

Added: trunk/artiesten/genre.php
===================================================================
--- trunk/artiesten/genre.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/artiesten/genre.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,174 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once 'template_header.php'; 
+require_once('inc/sm-db-queries.php');
+
+
+$genre_id = $_GET['genre_id'];
+
+//flashplayer
+$flashplayer = '&lt;object classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; codebase=&quot;<A HREF="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0">http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0</A>&quot; width=&quot;17&quot; height=&quot;17&quot; id=&quot;musicplayer&quot; align=&quot;middle&quot;&gt;';
+$flashplayer.= '&lt;param name=&quot;allowScriptAccess&quot; value=&quot;sameDomain&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;movie&quot; value=&quot;/live/media/flash/musicplayer.swf&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;loop&quot; value=&quot;false&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;menu&quot; value=&quot;false&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;quality&quot; value=&quot;high&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;flashvars&quot; value=&quot;song_url=##URL##&quot;';
+$flashplayer.= '&lt;param name=&quot;wmode&quot; value=&quot;transparent&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;bgcolor&quot; value=&quot;#f7f3e7&quot; /&gt;';
+$flashplayer.= '&lt;embed src=&quot;/live/media/flash/musicplayer.swf&quot; flashvars=&quot;song_url=##URL##&quot; loop=&quot;false&quot; menu=&quot;false&quot; quality=&quot;high&quot; wmode=&quot;transparent&quot; bgcolor=&quot;#f7f3e7&quot; width=&quot;17&quot; height=&quot;17&quot; name=&quot;musicplayer&quot; align=&quot;middle&quot; allowScriptAccess=&quot;sameDomain&quot; type=&quot;application/x-shockwave-flash&quot; pluginspage=&quot;<A HREF="http://www.macromedia.com/go/getflashplayer">http://www.macromedia.com/go/getflashplayer</A>&quot; /&gt;';
+$flashplayer.= '&lt;/object&gt;';
+
+
+$h_latest = qGetLatestArtistByGenre($genre_id);
+$nr_users = mysql_num_rows($h_latest);
+$latest_users = null;
+
+if( $nr_users &gt; 0) {
+	$latest_users = &quot;&lt;table border=\&quot;0\&quot; class=\&quot;ruler\&quot; id=\&quot;mytable\&quot;&gt;\n&quot;;
+	for($i = 0; $i &lt; $nr_users; $i++) {
+		$row = mysql_fetch_array($h_latest);
+		//prep path to avatar
+		$decoded_path = rawurldecode($row['avatar_path']);
+		$path = str_replace(&quot;/var/www/simuze.nl/live/&quot;,&quot;&quot;,$decoded_path); 
+        $imgsrc = $path . $row['avatar_filename_small'];
+		
+		$latest_users .= &quot;&lt;tr&gt;\n&quot;;
+		$latest_users .= &quot;&lt;td&gt;&lt;a href=\&quot;showprofile.php?username=$row[uname]\&quot; title=\&quot;bekijk het profiel van $row[uname]\&quot;&gt; Bekijk het profiel van artiest: $row[audio_artist]&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$latest_users .= &quot;&lt;td&gt;&lt;a href=\&quot;showprofile.php?username=$row[uname]\&quot; title=\&quot;bekijk het profiel van $row[audio_artist]\&quot;&gt;&lt;img alt=\&quot;avatar\&quot; src=\&quot;$imgsrc\&quot; border=\&quot;0\&quot; /&gt;&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$latest_users .= &quot;&lt;/tr&gt;\n&quot;;
+	}
+$latest_users .= &quot;&lt;/table&gt;\n&quot;;
+	
+} else {
+	$latest_users = &quot;Er zijn op dit moment (nog) geen nieuwe artiesten gevonden&quot;;
+}
+
+
+/* code voor het weergeven van de artiesten */
+$handle = qGetArtistByGenre($genre_id);
+$nr_rows = mysql_num_rows($handle);
+
+$artist = array();
+
+for($j = 0; $j &lt; $nr_rows; $j++) {
+	$a_row = mysql_fetch_array($handle);
+		
+	array_push($artist, $a_row['audio_artist']);
+}
+
+
+
+$handle_genre = qGetGenreByID($genre_id);
+$g_row = mysql_fetch_array($handle_genre);
+
+$genre_name = $g_row['genre_name']; 
+$genre_omschrijving = $g_row['genre_omschrijving']; 
+$decoded_path = rawurldecode($g_row['genre_img']);
+$path = str_replace(&quot;/var/www/simuze.nl/live/&quot;,&quot;&quot;,$decoded_path); 
+
+
+
+
+/* code voor het weergeven van de nummers */
+$handle2 = qGetAudioByGenre($genre_id);
+$nr_rows2 = mysql_num_rows($handle2);
+
+/* code voor het aanpassen van de path van het audiobestand */
+
+	
+for($k = 0; $k &lt; $nr_rows2; $k++) {
+	$nummer = mysql_fetch_array($handle2);
+	
+	$hi_path = rawurldecode($nummer['audio_hi_path']);
+	$the_hi_url = str_replace(&quot;/data/&quot;,&quot;<A HREF="http://www.simuze.nl/live/">http://www.simuze.nl/live/</A>&quot;,$hi_path);
+	$flash = str_replace(&quot;##URL##&quot;, $the_hi_url ,$flashplayer);
+	
+	$licentie_nr = $nummer['cclicense_id'];
+	$licentie_path = $nummer['cclicense_image_path'];
+	$licentie_img = &quot;&lt;img src=\&quot;$licentie_path\&quot;&gt;&quot;;
+	//echo &quot;$the_hi_url&quot;;
+	
+	
+			
+	$string .= &quot;&lt;tr bgcolor=\&quot;#EDD8BE\&quot;&gt;&quot;;
+	$string .= &quot;&lt;td&gt;$flash&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;td&gt;&quot;;
+	$string .= &quot;&lt;a href=\&quot;$the_hi_url\&quot;&gt;&quot;;
+	$string .= $nummer['audio_title'];
+	$string .= &quot;&lt;/a&gt;&quot;;
+	$string .= &quot;&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;td&gt;&quot;;
+	$string .= &quot;&lt;a href=\&quot;showprofile.php?username=$nummer[uname]\&quot; title=\&quot;bekijk het profiel van $nummer[uname]\&quot;&gt; $nummer[audio_artist]&lt;/a&gt;&quot;;
+	$string .= &quot;&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;td&gt;&quot;;
+	$string .= $licentie_img;
+	$string .= &quot;&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;/tr&gt;&quot;;
+	
+}
+
+//echo $string;
+
+
+?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_artiesten&quot;&gt;
+				
+					
+					&lt;h1&gt;&lt;?php echo &quot;$genre_name&quot;; ?&gt;&lt;/h1&gt;
+						
+					&lt;div class=&quot;div_links&quot;&gt;
+					
+					&lt;table border=&quot;0&quot; width=&quot;250&quot; cellpadding=&quot;2&quot; cellspacing=&quot;1&quot;&gt;
+						&lt;tr&gt;
+							&lt;td width=&quot;3&quot;&gt;&lt;/td&gt;
+							&lt;td&gt;&lt;a href=&quot;artiesten/genre_all_artists.php&lt;?php echo &quot;?genre_id=$genre_id&quot; ?&gt;&quot;&gt;Bevat &lt;b&gt;&lt;?php echo($nr_rows); ?&gt;&lt;/b&gt; artiesten. &lt;img src=&quot;/live/img/images/dubbelpijltje_rood.gif&quot; border=&quot;0&quot;&gt;&lt;/a&gt;&lt;/td&gt;
+						&lt;/tr&gt;	
+						&lt;tr&gt;
+							&lt;td width=&quot;3&quot;&gt;&lt;/td&gt;
+							&lt;td&gt;&lt;img src=&quot;&lt;?php echo &quot;$path&quot;; ?&gt;&quot; class=&quot;alignleft&quot;&gt; &lt;?php echo &quot;$genre_omschrijving&quot;; ?&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+						
+					&lt;/table&gt;
+					
+					
+					&lt;/div&gt;
+					
+					&lt;div class=&quot;div_rechts&quot;&gt;	
+						&lt;h2 class=&quot;nospace&quot;&gt;Nieuwe artiesten:&lt;/h2&gt;
+						&lt;?php echo &quot;$latest_users&quot;;?&gt;
+					&lt;/div&gt;
+					
+			&lt;/div&gt;
+			&lt;div class=&quot;bar1_genres&quot;&gt;&lt;/div&gt;
+			&lt;div class=&quot;kolom2_genres&quot;&gt;
+					&lt;div class=&quot;profiel_roundcont&quot;&gt;
+						&lt;div id=&quot;artiesten_kopje&quot;&gt;&lt;/div&gt;
+						&lt;p&gt;Hieronder een overzicht van de laatst toegevoegde nummers
+						&lt;/p&gt;
+					
+						&lt;table border=&quot;0&quot; width=&quot;600&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot;&gt;
+						&lt;tr&gt;
+							&lt;th width=&quot;20&quot;&gt; &lt;/th&gt;
+							&lt;th width=&quot;320&quot;&gt;Titel:&lt;/th&gt;
+							&lt;th&gt;Artiest:&lt;/th&gt;
+							&lt;th&gt;Licentie:&lt;/th&gt;
+						&lt;/tr&gt;	
+						
+						&lt;?php echo $string;?&gt;
+				
+						&lt;/table&gt;
+						
+						&lt;div class=&quot;profiel_roundbottom&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;
+						
+					
+
+			
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require '../template_sidebar_footer.php'; ?&gt;		

Added: trunk/artiesten/genre_all_artists.php
===================================================================
--- trunk/artiesten/genre_all_artists.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/artiesten/genre_all_artists.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,69 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require 'template_header.php'; 
+require('inc/sm-db-queries.php');
+	
+$genre_id = $_GET['genre_id'];
+
+$handle = qGetArtistByGenre($genre_id);
+$nr_rows = mysql_num_rows($handle);
+
+
+	for ($i = 0; $i &lt; $nr_rows; $i++) {
+			$artist = mysql_fetch_array($handle);
+		
+			
+			$artist_tabel .= &quot;&lt;tr&gt;&quot;;
+			$artist_tabel.= &quot;&lt;td bgcolor=\&quot;#EDD8BE\&quot;&gt;&quot;;
+			$artist_tabel.= &quot;&lt;a href=\&quot;showprofile.php?username=$artist[uname]\&quot; title=\&quot;bekijk het profiel van $artist[uname]\&quot;&gt; $artist[audio_artist]&lt;/a&gt;&quot;;
+			$artist_tabel .= $artist['artist_name'];
+			$artist_tabel .= &quot;&lt;/a&gt;&quot;;
+			$artist_tabel .= &quot;&lt;/td&gt;&quot;;
+			$artist_tabel.= &quot;&lt;td bgcolor=\&quot;#EDD8BE\&quot;&gt;&quot;;
+			$artist_tabel .= $artist['location'];
+			$artist_tabel .= &quot;&lt;/td&gt;&quot;;
+			$artist_tabel .= &quot;&lt;/tr&gt;&quot;;
+		
+	}
+	
+$handle_genre = qGetGenreByID($genre_id);
+$g_row = mysql_fetch_array($handle_genre);
+
+$genre_name = $g_row['genre_name']; 
+$genre_omschrijving = $g_row['genre_omschrijving']; 
+$decoded_path = rawurldecode($g_row['genre_img']);
+$path = str_replace(&quot;/var/www/simuze.nl/live/&quot;,&quot;&quot;,$decoded_path); 
+
+?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_artiesten&quot;&gt;
+				
+					
+					&lt;h1&gt;Artiesten in &lt;?php echo &quot;$genre_name&quot;; ?&gt;&lt;/h1&gt;
+						
+					
+					&lt;div class=&quot;profiel_roundcont&quot;&gt;
+						&lt;div id=&quot;laatsttoegevoegd_kopje&quot;&gt;&lt;/div&gt;
+							&lt;center&gt;
+							&lt;table border=&quot;0&quot; width=&quot;590&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot;&gt;
+								&lt;tr&gt;	
+									&lt;td&gt;er zijn &lt;b&gt;&lt;?php echo &quot;$nr_rows&quot;; ?&gt;&lt;/b&gt; artiesten binnen het genre &lt;?php echo &quot;$genre_name&quot;; ?&gt;.&lt;/td&gt;
+								&lt;/tr&gt;	
+								&lt;tr&gt;
+									&lt;th&gt;Artiesten:&lt;/th&gt;
+								&lt;/tr&gt;
+								&lt;?php echo &quot;$artist_tabel&quot;; ?&gt;
+							&lt;/table&gt;
+							&lt;/center&gt;
+						
+				
+						&lt;div class=&quot;profiel_roundbottom&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;			
+					
+			
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require '../template_sidebar_footer.php'; ?&gt;		

Added: trunk/artiesten/index.php
===================================================================
--- trunk/artiesten/index.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/artiesten/index.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,279 @@
+&lt;?php 
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once 'template_header.php'; 
+require_once('inc/marten_kweeries.php');
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+
+
+//flashplayer
+$flashplayer = '&lt;object classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; codebase=&quot;<A HREF="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0">http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0</A>&quot; width=&quot;17&quot; height=&quot;17&quot; id=&quot;musicplayer&quot; align=&quot;middle&quot;&gt;';
+$flashplayer.= '&lt;param name=&quot;allowScriptAccess&quot; value=&quot;sameDomain&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;movie&quot; value=&quot;/live/media/flash/musicplayer.swf&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;loop&quot; value=&quot;false&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;menu&quot; value=&quot;false&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;quality&quot; value=&quot;high&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;flashvars&quot; value=&quot;song_url=##URL##&quot;';
+$flashplayer.= '&lt;param name=&quot;wmode&quot; value=&quot;transparent&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;bgcolor&quot; value=&quot;#f7f3e7&quot; /&gt;';
+$flashplayer.= '&lt;embed src=&quot;/live/media/flash/musicplayer.swf&quot; flashvars=&quot;song_url=##URL##&quot; loop=&quot;false&quot; menu=&quot;false&quot; quality=&quot;high&quot; wmode=&quot;transparent&quot; bgcolor=&quot;#f7f3e7&quot; width=&quot;17&quot; height=&quot;17&quot; name=&quot;musicplayer&quot; align=&quot;middle&quot; allowScriptAccess=&quot;sameDomain&quot; type=&quot;application/x-shockwave-flash&quot; pluginspage=&quot;<A HREF="http://www.macromedia.com/go/getflashplayer">http://www.macromedia.com/go/getflashplayer</A>&quot; /&gt;';
+$flashplayer.= '&lt;/object&gt;';
+
+/* code voor het weergeven van de nummers */
+$handle2 = qGetLatestAudio();
+$nr_rows2 = mysql_num_rows($handle2);
+for($i = 0; $i &lt; $nr_rows2; $i++) {
+	$nummer = mysql_fetch_array($handle2);
+	
+	$hi_path = rawurldecode($nummer['audio_hi_path']);
+	$the_hi_url = str_replace(&quot;/data/&quot;,&quot;<A HREF="http://www.simuze.nl/live/">http://www.simuze.nl/live/</A>&quot;,$hi_path);
+	$flash = str_replace(&quot;##URL##&quot;, $the_hi_url ,$flashplayer);
+	//echo &quot;$the_hi_url&quot;;
+	
+	$string .= &quot;&lt;tr bgcolor=\&quot;#EDD8BE\&quot;&gt;&quot;;
+	$string .= &quot;&lt;td&gt;$flash&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;td&gt;&quot;;
+	$string .= &quot;&lt;a href=\&quot;$the_hi_url\&quot;&gt;&quot;;
+	$string .= $nummer['audio_title'];
+	$string .= &quot;&lt;/a&gt;&quot;;
+	$string .= &quot;&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;td&gt;&quot;;
+	$string .= &quot;&lt;a href=\&quot;showprofile.php?username=$nummer[uname]\&quot; title=\&quot;bekijk het profiel van $nummer[uname]\&quot;&gt; $nummer[audio_artist]&lt;/a&gt;&quot;;
+	$string .= &quot;&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;/tr&gt;&quot;;
+}
+
+
+$nr_visual_cols = 2;
+$columns = array();
+$col1 = null;
+$col2 = null;
+
+$genre_handle = qGetGenre();
+$nr_genre_rows = mysql_num_rows($genre_handle);
+$page = &quot;genre.php&quot;;
+
+/* create the genrelist */
+for ($n = 0; $n &lt; $nr_genre_rows; $n++) {
+	$genre= mysql_fetch_array($genre_handle);
+	
+	$genre_list .= '&lt;li&gt;';
+	$genre_list .= &quot;&lt;a class=\&quot;help\&quot; href=\&quot;/live/artiesten/$page?genre_id=$genre[genre_id]\&quot;&gt;&quot;;
+	$genre_list .= &quot;$genre[genre_name]&quot;;
+	$genre_list .= &quot;&lt;/a&gt;&quot;;
+	$genre_list .= &quot;&lt;/li&gt;&quot;;
+	
+	if($n % $nr_visual_cols) {
+		$col1 .= $genre_list;
+		$genre_list = null;
+	} else {
+		$col2 .= $genre_list;
+		$genre_list = null;
+	}
+}
+
+// for the 'uitgelicht' section we're using a uid
+$uid = &quot;2327&quot;;
+
+//haal laatste nummer van artiest op
+$handle3 = qGetLatestAudioFromArtist($uid);
+$nr_rows3 = mysql_num_rows($handle3);
+
+for($j = 0; $j &lt; $nr_rows3; $j++) {
+	$laatste_nummer = mysql_fetch_array($handle3);
+	
+	$hi_path = rawurldecode($laatste_nummer['audio_hi_path']);
+	$the_hi_url = str_replace(&quot;/data/&quot;,&quot;<A HREF="http://www.simuze.nl/live/">http://www.simuze.nl/live/</A>&quot;,$hi_path);
+	//echo &quot;$the_hi_url&quot;;
+	$flash = str_replace(&quot;##URL##&quot;, $the_hi_url ,$flashplayer);
+	$titel = $laatste_nummer['audio_title'];
+	
+	
+}
+
+
+
+
+$artist_handle = qGetArtistInfoByUID($uid);
+$nr_artist_rows = mysql_num_rows($artist_handle);
+
+//haal de array op en decode path
+$row = mysql_fetch_array($artist_handle);
+$decoded_path = rawurldecode($row['avatar_path']);
+$path = str_replace(&quot;/var/www/simuze.nl/live/&quot;,&quot;&quot;,$decoded_path); 
+$imgsrc = $path . $row['avatar_filename_small'];
+
+	//tel de woorden van de bio
+	$str = $row['bio'];
+	$words  = str_word_count($str,1);
+	
+	$nr_words = 40;
+	for($k = 0; $k &lt; $nr_words; $k++) {
+	$html .= $words[$k] . &quot; &quot;;
+	}
+	
+		//opmaak van content voor &quot;uitgelicht&quot;
+		$html .= &quot;&lt;br /&gt;&lt;a href=\&quot;showprofile.php?username=$row[uname]\&quot; title=\&quot;bekijk het profiel van $row[uname]\&quot;&gt;...lees meer &lt;img src=\&quot;/live/img/images/pijltje_rood.gif\&quot; alt=\&quot;lees meer\&quot; border=\&quot;0\&quot;&gt;&lt;/a&gt;&quot;;
+		//echo &quot;$html&quot;;
+		
+		$artiest_uitgelicht = &quot;&lt;table border=\&quot;0\&quot; width=\&quot;275\&quot; &gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;tr&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td width=\&quot;10\&quot;&gt;&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td colspan=\&quot;2\&quot;&gt;&lt;h2 class=\&quot;nospace\&quot;&gt;$row[uname]&lt;/h2&gt;&lt;/td&gt;&quot;; 
+		$artiest_uitgelicht .= &quot;&lt;/tr&gt;\n&quot;;
+		
+		$artiest_uitgelicht .= &quot;&lt;tr&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td width=\&quot;10\&quot;&gt;&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td bgcolor=\&quot;#EDD8BE\&quot; width=\&quot;20\&quot;&gt;$flash&lt;/td&gt;&quot;; 
+		$artiest_uitgelicht .= &quot;&lt;td bgcolor=\&quot;#EDD8BE\&quot;&gt;&lt;a href=\&quot;$the_hi_url\&quot;&gt;$titel&lt;/a&gt;&lt;/td&gt;&quot;; 
+		$artiest_uitgelicht .= &quot;&lt;/tr&gt;\n&quot;;
+		
+		$artiest_uitgelicht .= &quot;&lt;tr&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td width=\&quot;10\&quot;&gt;&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td colspan=\&quot;2\&quot;&gt;
+		&lt;img alt=\&quot;avatar\&quot; src=\&quot;$imgsrc\&quot; class=\&quot;alignright\&quot; /&gt;$html&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;/tr&gt;\n&quot;;
+		
+		$artiest_uitgelicht .= &quot;&lt;tr&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td width=\&quot;10\&quot;&gt;&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td&gt;&lt;a href=\&quot;showprofile.php?username=$row[uname]\&quot; title=\&quot;bekijk het profiel van $row[uname]\&quot;&gt; profiel&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td&gt;&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;/tr&gt;\n&quot;;
+		
+		$artiest_uitgelicht .= &quot;&lt;/table&gt;&quot;;
+
+
+//genre
+$select_genre = createSelectGenre(&quot;snelzoeken&quot;);
+
+?&gt;
+
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_artiesten&quot;&gt;
+				
+					&lt;div class=&quot;div_links&quot;&gt;
+					&lt;h1&gt;Simuze muziek overzicht&lt;/h1&gt;
+					
+						&lt;p class=&quot;small&quot;&gt;
+						&lt;img src=&quot;/live/img/images/live_musica.jpg&quot; alt=&quot;simuze musica&quot; class=&quot;alignleft&quot;&gt;
+						Je vind hier een overzicht van de genres en de artiesten op Simuze, de laatst toegevoegde nummers, en meer. Je kan via de zoekmachine makkelijk en snel nieuwe muziek zoeken, en bij &quot;&lt;a href=&quot;/live/artiesten/tag_overzicht.php&quot;&gt;trefwoorden&lt;/a&gt;&quot; zie je een overzicht van de gebruikte trefwoorden voor de muziek op Simuze. De nummers kan je direct beluisteren door op de playknop de klikken.  
+						&lt;/p&gt;
+						&lt;/div&gt;
+					&lt;div class=&quot;div_rechts&quot;&gt;
+						&lt;div class=&quot;blauw_240&quot;&gt;
+						&lt;div id=&quot;snelzoeken_kopje&quot;&gt;&lt;/div&gt;
+						&lt;!--
+							&lt;p&gt;
+							&lt;form action=&quot;/live/artiesten/zoek.php&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; name=&quot;quicksearch&quot; id=&quot;quicksearch&quot;&gt;
+							&lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;true&quot; class=&quot;hidden&quot; /&gt;
+							&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;
+							&lt;tr&gt;
+								
+								&lt;td colspan=&quot;3&quot;&gt;
+									&lt;?php echo $select_genre; ?&gt;
+									&lt;/select&gt;
+									&lt;br /&gt; &lt;br /&gt;
+								&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td width=&quot;10&quot;&gt; &lt;/td&gt;
+								&lt;td width=&quot;20&quot; valign=&quot;top&quot;&gt;&lt;input type=&quot;checkbox&quot; name=&quot;commercieel&quot; class=&quot;form_checkbox&quot;&gt;&lt;/td&gt;
+								&lt;td&gt;ik wil de muziek direct voor commerciele doeleinden kunnen gebruiken&lt;br /&gt;&lt;br /&gt;&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td width=&quot;10&quot;&gt; &lt;/td&gt;
+								&lt;td width=&quot;20&quot; valign=&quot;top&quot;&gt;&lt;input type=&quot;checkbox&quot; name=&quot;bewerken&quot; class=&quot;form_checkbox&quot;&gt;&lt;/td&gt;
+								&lt;td&gt;ik wil de muziek direct kunnen bewerken&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;/table&gt;
+							
+							&lt;p&gt;
+							&lt;input type=&quot;image&quot; name=&quot;zoekstring&quot; src=&quot;/live/img/images/snelzoekknop.gif&quot; alt=&quot;inloggen&quot; value=&quot;true&quot; border=&quot;0&quot; class=&quot;nospace&quot; /&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;a href=&quot;#&quot;&gt;&gt;&gt; uitgebreid&lt;/a&gt;
+							&lt;/p&gt;
+							--&gt;
+							&lt;p&gt;
+							Binnenkort !
+							&lt;/p&gt;
+						&lt;div class=&quot;blauw_240_onder&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+					&lt;/div&gt;
+
+				&lt;/div&gt;
+				
+				&lt;div id=&quot;bar1_musica&quot;&gt;
+					&lt;div class=&quot;bar_links_groot&quot;&gt;
+					&lt;h2 class=&quot;bar1white&quot;&gt;Genres:&lt;/h2&gt;
+					&lt;/div&gt;
+				&lt;/div&gt;
+				&lt;div id=&quot;div_blue_musica&quot;&gt;
+					&lt;div class=&quot;div_links&quot;&gt;
+					&lt;p class=&quot;small_white2&quot;&gt;
+						&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;
+						&lt;tr&gt;
+							&lt;td&gt;
+								&lt;ul&gt;
+									&lt;?php echo $col2; ?&gt; 
+								&lt;/ul&gt;
+							&lt;/td&gt;	
+							&lt;td&gt;
+								&lt;ul&gt;
+									&lt;?php echo $col1; ?&gt;
+								&lt;/ul&gt;
+							&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;/table&gt;
+					&lt;/p&gt;
+					&lt;/div&gt;
+					
+					&lt;div class=&quot;div_rechts&quot;&gt;
+						&lt;p class=&quot;small_white&quot;&gt;
+							Simuze heeft bewust gekozen voor een beperkt aantal hoofdgenres. Meerdere (sub)genres leidt in onze ogen tot verwarring en onduidelijkheid. Als alternatief denken we dat muziek beter gevonden wordt door middel van de referenties, trefwoorden, de omschrijving van de muziek (emotie, tempo, etc.) en natuurlijk het Simuze radiostation.  
+						&lt;/p&gt;
+					&lt;/div&gt;
+					
+					
+					
+				&lt;/div&gt;
+				&lt;div id=&quot;bar2_musica&quot;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;a class=&quot;help&quot; href=&quot;#&quot;&gt;&gt; alle muziek&lt;/a&gt; &lt;/div&gt;
+				
+				&lt;div id=&quot;kolom2_artiesten&quot;&gt;
+					
+					&lt;div class=&quot;kopjelinks_roundcont&quot;&gt;
+						&lt;div id=&quot;musica_uitgelicht_kopje&quot;&gt;&lt;/div&gt;
+							
+							&lt;?php echo &quot;$artiest_uitgelicht&quot;;?&gt;
+							
+						&lt;div class=&quot;kopjerechts_onder&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+				
+					&lt;div class=&quot;kopjerechts_roundcont&quot;&gt;
+						&lt;div id=&quot;nieuweuploads_kopje&quot;&gt;&lt;/div&gt;
+							&lt;table border=&quot;0&quot; width=&quot;295&quot; cellpadding=&quot;2&quot; cellspacing=&quot;1&quot;&gt;
+								&lt;tr&gt;
+									&lt;th width=&quot;20&quot;&gt; &lt;/th&gt;
+									&lt;th width=&quot;150&quot;&gt;Titel:&lt;/th&gt;
+									&lt;th&gt;Artiest:&lt;/th&gt;
+								&lt;/tr&gt;	
+								
+								&lt;?php echo $string;?&gt;
+						
+							&lt;/table&gt;
+						&lt;div class=&quot;kopjerechts_onder&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+					&lt;br /&gt;&lt;br /&gt;
+				&lt;/div&gt;	
+				
+				&lt;div id=&quot;bar2&quot;&gt; &lt;/div&gt;
+				
+				&lt;div id=&quot;kolom1_playlists&quot;&gt;
+					&lt;div class=&quot;profiel_roundcont&quot;&gt;
+						&lt;div id=&quot;playlisttop10_kopje&quot;&gt;&lt;/div&gt;
+						&lt;p&gt;Hier onder komt binnenkort de playlist top 10. Of ook wel; de nummers die het meeste in alle playlists voorkomen. 
+						
+						&lt;div class=&quot;profiel_roundbottom&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require '../template_sidebar_footer.php'; ?&gt;		

Added: trunk/artiesten/index_backup.php
===================================================================
--- trunk/artiesten/index_backup.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/artiesten/index_backup.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,271 @@
+&lt;?php 
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require 'template_header.php'; 
+require('inc/marten_kweeries.php');
+
+
+//get user id
+$uid = &quot;2005&quot;;
+
+//flashplayer
+$flashplayer = '&lt;object classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; codebase=&quot;<A HREF="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0">http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0</A>&quot; width=&quot;17&quot; height=&quot;17&quot; id=&quot;musicplayer&quot; align=&quot;middle&quot;&gt;';
+$flashplayer.= '&lt;param name=&quot;allowScriptAccess&quot; value=&quot;sameDomain&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;movie&quot; value=&quot;/live/media/flash/musicplayer.swf&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;loop&quot; value=&quot;false&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;menu&quot; value=&quot;false&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;quality&quot; value=&quot;high&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;flashvars&quot; value=&quot;song_url=##URL##&quot;';
+$flashplayer.= '&lt;param name=&quot;wmode&quot; value=&quot;transparent&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;bgcolor&quot; value=&quot;#f7f3e7&quot; /&gt;';
+$flashplayer.= '&lt;embed src=&quot;/live/media/flash/musicplayer.swf&quot; flashvars=&quot;song_url=##URL##&quot; loop=&quot;false&quot; menu=&quot;false&quot; quality=&quot;high&quot; wmode=&quot;transparent&quot; bgcolor=&quot;#f7f3e7&quot; width=&quot;17&quot; height=&quot;17&quot; name=&quot;musicplayer&quot; align=&quot;middle&quot; allowScriptAccess=&quot;sameDomain&quot; type=&quot;application/x-shockwave-flash&quot; pluginspage=&quot;<A HREF="http://www.macromedia.com/go/getflashplayer">http://www.macromedia.com/go/getflashplayer</A>&quot; /&gt;';
+$flashplayer.= '&lt;/object&gt;';
+
+/* code voor het weergeven van de nummers */
+$handle2 = qGetLatestAudio();
+$nr_rows2 = mysql_num_rows($handle2);
+
+/* code voor het aanpassen van de path van het audiobestand */
+
+for($i = 0; $i &lt; $nr_rows2; $i++) {
+	$nummer = mysql_fetch_array($handle2);
+	
+	$hi_path = rawurldecode($nummer['audio_hi_path']);
+	$the_hi_url = str_replace(&quot;/data/&quot;,&quot;<A HREF="http://www.simuze.nl/live/">http://www.simuze.nl/live/</A>&quot;,$hi_path);
+	$flash = str_replace(&quot;##URL##&quot;, $the_hi_url ,$flashplayer);
+	//echo &quot;$the_hi_url&quot;;
+	
+	$string .= &quot;&lt;tr bgcolor=\&quot;#EDD8BE\&quot;&gt;&quot;;
+	$string .= &quot;&lt;td&gt;$flash&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;td&gt;&quot;;
+	$string .= &quot;&lt;a href=\&quot;$the_hi_url\&quot;&gt;&quot;;
+	$string .= $nummer['audio_title'];
+	$string .= &quot;&lt;/a&gt;&quot;;
+	$string .= &quot;&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;td&gt;&quot;;
+	$string .= &quot;&lt;a href=\&quot;showprofile.php?username=$nummer[uname]\&quot; title=\&quot;bekijk het profiel van $nummer[uname]\&quot;&gt; $nummer[audio_artist]&lt;/a&gt;&quot;;
+	$string .= &quot;&lt;/td&gt;&quot;;
+	$string .= &quot;&lt;/tr&gt;&quot;;
+}
+
+
+$genre_handle = qGetGenre();
+$nr_genre_rows = mysql_num_rows($genre_handle);
+
+$column_elements = 7;
+$columns = array();
+$counter = 0;
+
+/* create the genrelist */
+for ($i = 0; $i &lt; $nr_genre_rows; $i++) {
+		
+		$genre= mysql_fetch_array($genre_handle);
+		$page = &quot;genre.php&quot;;
+
+		if($counter == $column_elements) {
+			array_push($columns, $genre_list);	
+			$counter = 0;
+			$genre_list = null;
+		}
+	
+		$genre_list .= '&lt;li&gt;';
+		$genre_list .= &quot;&lt;a class=\&quot;help\&quot; href=\&quot;/live/artiesten/$page?genre_id=$genre[genre_id]\&quot;&gt;&quot;;
+		$genre_list .= &quot;$genre[genre_name]&quot;;
+		$genre_list .= &quot;&lt;/a&gt;&quot;;
+		$genre_list .= &quot;&lt;/li&gt;&quot;;
+		$counter++;
+		
+}
+
+//haal laatste nummer van artiest op
+$handle3 = qGetLatestAudioFromArtist($uid);
+$nr_rows3 = mysql_num_rows($handle3);
+
+for($i = 0; $i &lt; $nr_rows3; $i++) {
+	$laatste_nummer = mysql_fetch_array($handle3);
+	
+	$hi_path = rawurldecode($laatste_nummer['audio_hi_path']);
+	$the_hi_url = str_replace(&quot;/data/&quot;,&quot;<A HREF="http://www.simuze.nl/live/">http://www.simuze.nl/live/</A>&quot;,$hi_path);
+	//echo &quot;$the_hi_url&quot;;
+	$flash = str_replace(&quot;##URL##&quot;, $the_hi_url ,$flashplayer);
+	$titel = $laatste_nummer['audio_title'];
+	
+	
+}
+
+
+$artist_handle = qGetArtistInfoByUID($uid);
+$nr_artist_rows = mysql_num_rows($artist_handle);
+
+//haal de array op en decode path
+$row = mysql_fetch_array($artist_handle);
+$decoded_path = rawurldecode($row['avatar_path']);
+$path = str_replace(&quot;/var/www/simuze.nl/live/&quot;,&quot;&quot;,$decoded_path); 
+$imgsrc = $path . $row['avatar_filename_small'];
+
+	//tel de woorden van de bio
+	$str = $row['bio'];
+	$words  = str_word_count($str,1);
+	$nr_words = 40;
+	for($i = 0; $i &lt; $nr_words; $i++) {
+		$html .= $words[$i] . &quot; &quot;;
+	}
+	
+		//opmaak van content voor &quot;uitgelicht&quot;
+		$html .= &quot;&lt;br /&gt;&lt;a href=\&quot;showprofile.php?username=$row[uname]\&quot; title=\&quot;bekijk het profiel van $row[uname]\&quot;&gt;...lees meer &lt;img src=\&quot;/live/img/images/pijltje_rood.gif\&quot; alt=\&quot;lees meer\&quot; border=\&quot;0\&quot;&gt;&lt;/a&gt;&quot;;
+		//echo &quot;$html&quot;;
+		
+		$artiest_uitgelicht = &quot;&lt;table border=\&quot;0\&quot; width=\&quot;275\&quot; &gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;tr&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td width=\&quot;10\&quot;&gt;&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td colspan=\&quot;2\&quot;&gt;&lt;h2 class=\&quot;nospace\&quot;&gt;$row[uname]&lt;/h2&gt;&lt;/td&gt;&quot;; 
+		$artiest_uitgelicht .= &quot;&lt;/tr&gt;\n&quot;;
+		
+		$artiest_uitgelicht .= &quot;&lt;tr&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td width=\&quot;10\&quot;&gt;&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td bgcolor=\&quot;#EDD8BE\&quot; width=\&quot;20\&quot;&gt;$flash&lt;/td&gt;&quot;; 
+		$artiest_uitgelicht .= &quot;&lt;td bgcolor=\&quot;#EDD8BE\&quot;&gt;$titel&lt;/td&gt;&quot;; 
+		$artiest_uitgelicht .= &quot;&lt;/tr&gt;\n&quot;;
+		
+		$artiest_uitgelicht .= &quot;&lt;tr&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td width=\&quot;10\&quot;&gt;&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td colspan=\&quot;2\&quot;&gt;
+		&lt;img alt=\&quot;avatar\&quot; src=\&quot;$imgsrc\&quot; class=\&quot;alignright\&quot; /&gt;$html&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;/tr&gt;\n&quot;;
+		
+		$artiest_uitgelicht .= &quot;&lt;tr&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td width=\&quot;10\&quot;&gt;&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td&gt;&lt;a href=\&quot;showprofile.php?username=$row[uname]\&quot; title=\&quot;bekijk het profiel van $row[uname]\&quot;&gt; profiel&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;td&gt;&lt;/td&gt;\n&quot;;
+		$artiest_uitgelicht .= &quot;&lt;/tr&gt;\n&quot;;
+		
+		$artiest_uitgelicht .= &quot;&lt;/table&gt;&quot;;
+
+
+		
+
+?&gt;
+
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_artiesten&quot;&gt;
+				
+					&lt;div class=&quot;div_links&quot;&gt;
+					&lt;h1&gt;Simuze muziek overzicht&lt;/h1&gt;
+					
+						&lt;p class=&quot;small&quot;&gt;
+						&lt;img src=&quot;/live/img/images/live_musica.jpg&quot; alt=&quot;simuze musica&quot; class=&quot;alignleft&quot;&gt;
+						Je vind hier een overzicht van de artiesten op Simuze, de top downloads, de meest/minst gedraaide nummers en een concertagenda van de Simuze bands. Je kan via de zoekmachine makkelijk en snel nieuwe muziek zoeken.  
+						&lt;/p&gt;
+						&lt;/div&gt;
+					&lt;div class=&quot;div_rechts&quot;&gt;
+						&lt;div class=&quot;blauw_240&quot;&gt;
+						&lt;div id=&quot;snelzoeken_kopje&quot;&gt;&lt;/div&gt;
+							&lt;p&gt;
+							genre:
+							&lt;input type=&quot;text&quot; maxlength=&quot;50&quot; size=&quot;30&quot; class=&quot;form_tekstveld&quot; /&gt; 
+							referenties:
+							&lt;input type=&quot;text&quot; maxlength=&quot;50&quot; size=&quot;30&quot; class=&quot;form_tekstveld&quot; /&gt; 
+							&lt;/p&gt;
+							&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;
+							&lt;tr&gt;
+								&lt;td width=&quot;10&quot;&gt; &lt;/td&gt;
+								&lt;td width=&quot;20&quot; valign=&quot;top&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;form_tekstveld&quot;&gt;&lt;/td&gt;
+								&lt;td&gt;ik wil de muziek direct voor commerciele doeleinden kunnen gebruiken&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td width=&quot;10&quot;&gt; &lt;/td&gt;
+								&lt;td width=&quot;20&quot; valign=&quot;top&quot;&gt;&lt;input type=&quot;checkbox&quot; class=&quot;form_tekstveld&quot;&gt;&lt;/td&gt;
+								&lt;td&gt;ik wil de muziek direct kunnen bewerken&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;/table&gt;
+							
+							&lt;p&gt;
+							&lt;input type=&quot;image&quot; src=&quot;/live/img/images/snelzoekknop.gif&quot; alt=&quot;inloggen&quot; value=&quot;true&quot; border=&quot;0&quot; class=&quot;nospace&quot; /&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;a href=&quot;#&quot;&gt;&gt;&gt; uitgebreid&lt;/a&gt;
+							&lt;/p&gt;
+						&lt;div class=&quot;blauw_240_onder&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+					&lt;/div&gt;
+
+				&lt;/div&gt;
+				
+				&lt;div id=&quot;bar1_musica&quot;&gt;
+					&lt;div class=&quot;bar_links_groot&quot;&gt;
+					&lt;h2 class=&quot;bar1white&quot;&gt;Genres:&lt;/h2&gt;
+					&lt;/div&gt;
+				&lt;/div&gt;
+				&lt;div id=&quot;div_blue_musica&quot;&gt;
+					&lt;div class=&quot;div_links&quot;&gt;
+					&lt;p class=&quot;small_white2&quot;&gt;
+						&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot;&gt;
+						&lt;tr&gt;
+							&lt;td&gt;
+								&lt;ul&gt;
+									&lt;?php echo $columns[0]; ?&gt; 
+								&lt;/ul&gt;
+							&lt;/td&gt;	
+							&lt;td&gt;
+								&lt;ul&gt;
+									&lt;?php echo $columns[1]; ?&gt;
+								&lt;/ul&gt;
+							&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;/table&gt;
+					&lt;/p&gt;
+					&lt;/div&gt;
+					
+					&lt;div class=&quot;div_rechts&quot;&gt;
+						&lt;p class=&quot;small_white&quot;&gt;
+							Deze hoofdgenres zijn bewust gekozen. We zijn ons er van bewust dat er vele subgenres bestaan, 
+							maar deze hebben we achterwege gelaten. Meerdere genres leidt in onze ogen tot verwarring en onduidelijkheid.
+							In plaats van subgenres denken we dat muziek beter gevonden wordt door middel van de referenties, de omschrijving 
+							van de muziek (emotie, tempo, etc.) en natuurlijk het Simuze radiostation.  
+						&lt;/p&gt;
+					&lt;/div&gt;
+					
+					
+					
+				&lt;/div&gt;
+				&lt;div id=&quot;bar2_musica&quot;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;a class=&quot;help&quot; href=&quot;#&quot;&gt;&gt; alle muziek&lt;/a&gt; &lt;/div&gt;
+				
+				&lt;div id=&quot;kolom2_artiesten&quot;&gt;
+					
+					&lt;div class=&quot;kopjelinks_roundcont&quot;&gt;
+						&lt;div id=&quot;musica_uitgelicht_kopje&quot;&gt;&lt;/div&gt;
+							
+							&lt;?php echo &quot;$artiest_uitgelicht&quot;;?&gt;
+							
+						&lt;div class=&quot;kopjerechts_onder&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+				
+					&lt;div class=&quot;kopjerechts_roundcont&quot;&gt;
+						&lt;div id=&quot;nieuweuploads_kopje&quot;&gt;&lt;/div&gt;
+							&lt;table border=&quot;0&quot; width=&quot;295&quot; cellpadding=&quot;2&quot; cellspacing=&quot;1&quot;&gt;
+						&lt;tr&gt;
+							&lt;th width=&quot;20&quot;&gt; &lt;/th&gt;
+							&lt;th width=&quot;150&quot;&gt;Titel:&lt;/th&gt;
+							&lt;th&gt;Artiest:&lt;/th&gt;
+						&lt;/tr&gt;	
+						
+						&lt;?php echo $string;
+						?&gt;
+				
+						&lt;/table&gt;
+						&lt;div class=&quot;kopjerechts_onder&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+					&lt;br /&gt;&lt;br /&gt;
+				&lt;/div&gt;	
+				
+				&lt;div id=&quot;bar2&quot;&gt; &lt;/div&gt;
+				
+				&lt;div id=&quot;kolom3_artiesten&quot;&gt;
+					&lt;div class=&quot;profiel_roundcont&quot;&gt;
+						&lt;div id=&quot;playlisttop10_kopje&quot;&gt;&lt;/div&gt;
+						&lt;p&gt;Hier onder volgt de playlist top 10. Of ook wel; de nummers die het meeste in alle playlists voorkomen. 
+						
+						&lt;div class=&quot;profiel_roundbottom&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require '../template_sidebar_footer.php'; ?&gt;		

Added: trunk/artiesten/overzicht.php
===================================================================
--- trunk/artiesten/overzicht.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/artiesten/overzicht.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,59 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require 'template_header.php'; 
+require('inc/marten_kweeries.php');
+	
+
+$handle = qGetAllArtists();
+$nr_rows = mysql_num_rows($handle);
+
+	for ($i = 0; $i &lt; $nr_rows; $i++) {
+			$artist = mysql_fetch_array($handle);
+			
+			$artist_tabel .= &quot;&lt;tr&gt;&quot;;
+			$artist_tabel.= &quot;&lt;td bgcolor=\&quot;#EDD8BE\&quot;&gt;&quot;;
+			$artist_tabel.= &quot;&lt;a href=\&quot;showprofile.php?username=$artist[uname]\&quot; title=\&quot;bekijk het profiel van $artist[uname]\&quot;&gt; $artist[audio_artist]&lt;/a&gt;&quot;;
+			$artist_tabel .= $artist['artist_name'];
+			$artist_tabel .= &quot;&lt;/a&gt;&quot;;
+			$artist_tabel .= &quot;&lt;/td&gt;&quot;;
+			$artist_tabel.= &quot;&lt;td bgcolor=\&quot;#EDD8BE\&quot;&gt;&quot;;
+			$artist_tabel .= $artist['location'];
+			$artist_tabel .= &quot;&lt;/td&gt;&quot;;
+			$artist_tabel .= &quot;&lt;/tr&gt;&quot;;
+		
+	}
+?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_artiesten&quot;&gt;
+				
+					
+					&lt;h1&gt;Simuze artiesten:&lt;/h1&gt;
+						
+					&lt;div class=&quot;profiel_roundcont&quot;&gt;
+						&lt;div id=&quot;alleartiesten_kopje&quot;&gt;&lt;/div&gt;
+						&lt;center&gt;
+						&lt;table border=&quot;0&quot; width=&quot;596&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot;&gt;
+							&lt;tr&gt;	
+								&lt;td&gt;er staat muziek van &lt;b&gt;&lt;?php echo &quot;$nr_rows&quot;; ?&gt;&lt;/b&gt; artiesten op Simuze.&lt;/td&gt;
+								&lt;td&gt;&lt;/td&gt;
+							&lt;/tr&gt;	
+							&lt;tr&gt;
+								&lt;td&gt;&lt;b&gt;Artiest:&lt;/b&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;b&gt;Lokatie:&lt;/b&gt;&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;?php echo &quot;$artist_tabel&quot;; ?&gt;
+						&lt;/table&gt;
+						&lt;/center&gt;
+						&lt;p&gt; &nbsp;&lt;/p&gt;
+						
+					&lt;div class=&quot;profiel_roundbottom&quot;&gt;&lt;/div&gt;
+				&lt;/div&gt;
+							
+					
+			
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require '../template_sidebar_footer.php'; ?&gt;		

Added: trunk/artiesten/tag.php
===================================================================
--- trunk/artiesten/tag.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/artiesten/tag.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,49 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+
+require_once(&quot;template_header.php&quot;); 
+
+if(!empty($_GET['tag']) &amp;&amp; checkContainsAlfaNum($_GET['tag'])) {
+	$tag_name = $_GET['tag'];
+	$handle_tag = qGetTagByName($tag_name);
+	if($nr_tags = mysql_num_rows($handle_tag) == 1) {
+		$tag = mysql_fetch_array($handle_tag);
+		$handle_audio_id = qGetAudioIDByTagID($tag['tag_id']);
+		$nr_audio_id = mysql_num_rows($handle_audio_id);
+		for($i = 0; $i &lt; $nr_audio_id ; $i++) {
+			$audio = mysql_fetch_array($handle_audio_id);
+			$audio_handle = qGetAudiobyID($audio['audio_id']);
+			$nr_audio = mysql_num_rows($audio_handle);
+			for($j = 0; $j &lt; $nr_audio ; $j++) {
+				$track = mysql_fetch_array($audio_handle);
+				$hi_path = rawurldecode($track['audio_hi_path']);
+				$the_hi_url = str_replace(&quot;/data/&quot;,&quot;<A HREF="http://www.simuze.nl/live/">http://www.simuze.nl/live/</A>&quot;,$hi_path);
+					
+				$string .= &quot;&lt;li&gt;&lt;b&gt;&lt;a href='$the_hi_url'&gt;$track[audio_title]&lt;/a&gt;&lt;/b&gt; door &lt;a href=\&quot;showprofile.php?username=$track[uname]\&quot; title=\&quot;bekijk het profiel van $track[uname]\&quot;&gt;$track[audio_artist]&lt;/a&gt; &lt;/li&gt;&quot;;
+			
+			}
+		}
+	}
+}
+
+
+
+?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_artiesten&quot;&gt;
+					&lt;h1&gt;Nummers met het trefwoord: &quot;&lt;?php echo &quot;$tag_name&quot;; ?&gt;&quot;&lt;/h1&gt;
+					
+					&lt;ul&gt;
+						&lt;?php echo &quot;$string&quot;; ?&gt;
+					&lt;/ul&gt;
+					
+					&lt;p&gt; &nbsp;&lt;/p&gt;
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require_once(&quot;../template_sidebar_footer.php&quot;); ?&gt;

Added: trunk/artiesten/tag_overzicht.php
===================================================================
--- trunk/artiesten/tag_overzicht.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/artiesten/tag_overzicht.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,85 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;template_header.php&quot;); 
+
+
+
+/* minimum fontsize for a tag */
+$min_fontsize = 6;
+/* maximum fontsize for a tag */
+$max_fontsize = 20;
+/* the difference between the max and min fontsize */
+$divider = $max_fontsize - $min_fontsize; 
+
+/* array to keep track of the tags usage numbers */
+$usage_numbers = array();
+/* array to keep track of the tags names */
+$tag_name = array();
+
+
+$tag_handle = qGetAllTags();
+$tag_nr_rows = mysql_num_rows($tag_handle);
+for ($i = 0; $i &lt; $tag_nr_rows; $i++) {
+	$tag= mysql_fetch_array($tag_handle);
+	
+	$usage_handle = qGetUsageOfTagByID($tag['tag_id']);
+	if($usage_nr = mysql_num_rows($usage_handle) == 1) {
+		$usage = mysql_fetch_array($usage_handle);
+	}
+	$index = $tag['tag_id'];
+	$usage_numbers[$tag[tag_name]] = $usage[0];
+}		
+
+/* make a copy of the usage_numbers array to sort for easy access to min and max values */
+$max_min_values = $usage_numbers; 
+sort($max_min_values,SORT_NUMERIC);
+
+/* get the total number of tags */
+$nr_elements = count($usage_numbers);
+
+/* get the min usage value of a tag, this will be at least the smallest fontsize as defined in $min_fontsize */
+$min_usage_val = $max_min_values[0];
+
+/* get the max usage value of a tag, this will be the largest fontsize as defined in $max_fontsize */
+$max_usage_val = $max_min_values[$nr_elements - 1];
+
+/* get the stepfactor ie: define the multiplier so that the largest usage number equals the largest fontsize */
+$stepfactor = ($divider / $max_usage_val);
+
+/* debug, uncomment these 3 lines */
+//echo &quot;minimum usage number: $min_usage_val &lt;br /&gt;&quot;;
+//echo &quot;max usage number: $max_usage_val &lt;br /&gt;&quot;;
+//echo &quot;step $stepfactor &lt;br /&gt;&quot;;
+
+ksort($usage_numbers);
+
+/* key = tag_id, value = usagenr */
+foreach($usage_numbers as $key=&gt;$val) {
+	//echo &quot;tag_id: $key totaal gebruik: $val &lt;br /&gt;&quot;;
+	$fontsize = ($val * $stepfactor) + $min_fontsize .&quot;pt&quot;;	
+	//echo &quot;fontsize: $fontsize &lt;br /&gt;&quot;;
+	$string .= &quot;&lt;a href='/live/artiesten/tag.php?tag=$key' title='Bekijk al nummers met het trefwoord $key' style='font-size: $fontsize;'&gt;$key&lt;/a&gt; &quot;;
+}
+
+?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_artiesten&quot;&gt;
+					&lt;h1&gt;Trefwoorden:&lt;/h1&gt;
+					&lt;p class=&quot;space&quot;&gt;
+						Deze trefwoorden zijn gerangschikt op gebruik. Hoe groter het trefwoord, 
+						des te vaker een trefwoord voorkomt en des te meer muziek 
+						er onder dat trefwoord te vinden is.
+					&lt;/p&gt;	
+					&lt;p class=&quot;space&quot;&gt;
+						&lt;?php echo &quot;$string&quot;; ?&gt;
+					&lt;p&gt;
+					
+					&lt;p&gt; &nbsp;&lt;/p&gt;
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require_once(&quot;../template_sidebar_footer.php&quot;); ?&gt;		

Added: trunk/artiesten/template2.php
===================================================================
--- trunk/artiesten/template2.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/artiesten/template2.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,14 @@
+&lt;?php require '../template_header.php'; ?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Standaard template numero 2&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;Lorem ipsum dolor sit amet, consectetuer adipiscing elit.  Phasellus varius eleifend tellus. Suspendisse potenti. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos hymenaeos. Nulla facilisi. Sed wisi lectus, placerat nec, mollis quis, posuere eget, arcu.&lt;/p&gt;
+				
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require '../template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/artiesten/zoek.php
===================================================================
--- trunk/artiesten/zoek.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/artiesten/zoek.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,121 @@
+&#239;&#187;&#191;&lt;?php 
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require 'template_header.php'; 
+require('inc/db/db_search.php');
+
+if($_POST['submit']) 
+{
+   if(!is_numeric($genre)) {
+        $genre = 0; }
+    
+    $zoekstring = addslashes($_POST['zoekstring']); 
+    $genre = addslashes($_POST['genre']); 
+	$commercieel = addslashes($_POST['commercieel']); 
+	$bewerken = addslashes($_POST['bewerken']); 
+	$whereClause = fnWhereClause();
+	
+	 $h_artiesten = q_Search_Artist($zoekstring, $whereClause);
+
+    $nr_artiesten = mysql_num_rows($h_artiesten);
+	$list_artiesten = &quot;&lt;h2&gt;Artiesten&lt;/h2&gt;&lt;p class=\&quot;small\&quot;&gt;&quot;;
+	if( $nr_artiesten &gt; 0) {
+		$list_artiesten .= &quot;&lt;table border=\&quot;0\&quot; class=\&quot;ruler\&quot; id=\&quot;mytable\&quot;&gt;\n&quot;;
+		for($i = 0; $i &lt; $nr_artiesten; $i++) {
+			$row = mysql_fetch_array($h_artiesten);
+			//prep path to avatar
+			$list_artiesten .= fnMakeLink(&quot;$row[uname]&quot;, &quot;Bekijk het profiel van artiest: $row[audio_artist]&quot;, &quot;$row[avatar_filename_small]&quot;);
+		}
+		$list_artiesten .= &quot;&lt;/table&gt;\n&quot;;
+	} else {
+		$list_artiesten .= &quot;Geen artiesten gevonden&quot;;
+	}
+	$list_artiesten .= &quot;&lt;/p&gt;&lt;br/&gt;&quot;;
+
+    $h_title = q_Search_AudioTitle($zoekstring, $whereClause);
+    $nr_title = mysql_num_rows($h_title);
+	$list_titles = &quot;&lt;h2&gt;Audio tracks&lt;/h2&gt;&lt;p class=\&quot;small\&quot;&gt;&quot;;
+	if( $nr_title &gt; 0) {
+		$list_titles .= &quot;&lt;table border=\&quot;0\&quot; class=\&quot;ruler\&quot; id=\&quot;mytable\&quot;&gt;\n&quot;;
+		for($i = 0; $i &lt; $nr_title; $i++) {
+			$row = mysql_fetch_array($h_title);
+			$list_titles .= fnMakeLink(&quot;$row[uname]&quot;, &quot;Bekijk het profiel van artiest: $row[audio_artist], gevonden nummer: $row[audio_title]&quot;, &quot;$row[avatar_filename_small]&quot;);
+		}
+		$list_titles .= &quot;&lt;/table&gt;\n&quot;;
+	} else {
+		$list_titles .= &quot;Geen audio tracks gevonden&quot;;
+	}
+	$list_titles .= &quot;&lt;/p&gt;&lt;br/&gt;&quot;;
+	
+    $h_album = q_Search_AudioAlbum($zoekstring, $whereClause);
+    $nr_album = mysql_num_rows($h_album);
+	$list_album = &quot;&lt;h2&gt;Audio albums&lt;/h2&gt;&lt;p class=\&quot;small\&quot;&gt;&quot;;
+	if( $nr_album &gt; 0) {
+		$list_album .= &quot;&lt;table border=\&quot;0\&quot; class=\&quot;ruler\&quot; id=\&quot;mytable\&quot;&gt;\n&quot;;
+		for($i = 0; $i &lt; $nr_album; $i++) {
+			$row = mysql_fetch_array($h_album);
+			$list_album .= fnMakeLink(&quot;$row[uname]&quot;, &quot;Bekijk het profiel van artiest: $row[audio_artist], gevonden album: $row[audio_album]&quot;, &quot;$row[avatar_filename_small]&quot;);
+		}
+		$list_album .= &quot;&lt;/table&gt;\n&quot;;
+	} else {
+		$list_album .= &quot;Geen audio tracks gevonden&quot;;
+	}
+	$list_album .= &quot;&lt;/p&gt;&lt;br/&gt;&quot;;
+}
+	
+	//fnWhereClause - Generates the last part of the SQL query. For each request it's the same.
+	//Not a great way to solve, but workst fine for now. And to quote Jan Klopper:
+	// 'Don't be ashamed for your code, at least it's there' :D
+	function fnWhereClause()
+	{
+		$WhereClause = &quot;&quot;;
+		global $genre;
+		global $commercieel;
+		global $bewerken;
+	    if ( $genre &gt; 0)
+		{
+			$WhereClause = &quot; genre_id=$genre AND&quot;;
+		}
+		if ($commercieel == &quot;on&quot;)
+		{
+			$WhereClause =  $WhereClause .&quot; cclicense_id IN ('SELECT cclicense_id FROM cclicense WHERE cclicense_commercial=1') AND&quot;;
+		}
+		if ($bewerken == &quot;on&quot;)
+		{
+			$WhereClause = $WhereClause .&quot; cclicense_id IN ('SELECT cclicense_id FROM cclicense WHERE cclicense_derative&gt;0') AND&quot;;
+		}
+		// Now rip off the last 'and', used for multiple queries only. Last is obsolete.
+		return (rtrim($WhereClause, &quot;AND&quot;) );
+	}
+	
+	//fnMakeLink - Generates userlink including avatar
+	//TODO: Put this in an include and user it for the front page (so it's done @ only 1 place)
+	
+	function fnMakeLink($strUName, $strTitle, $avatar_filename_small)
+	{
+		$output = &quot;&quot;;
+		$path = str_replace(&quot;/var/www/simuze.nl/live/&quot;,&quot;&quot;,$decoded_path); 
+		$imgsrc = $path . $avatar_filename_small;
+		
+		$output .= &quot;&lt;tr&gt;\n&quot;;
+		$output .= &quot;&lt;td&gt;&lt;a href=\&quot;showprofile.php?username=$strUName\&quot; title=\&quot;$strTitle\&quot;&gt;$strTitle&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$output .= &quot;&lt;td&gt;&lt;a href=\&quot;showprofile.php?username=$strUName\&quot; title=\&quot;$strTitle\&quot;&gt;&lt;img alt=\&quot;avatar\&quot; src=\&quot;$imgsrc\&quot; /&gt;&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$output .= &quot;&lt;/tr&gt;\n&quot;;
+	
+		return ($output);
+	}
+	
+	
+
+?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;h1&gt;Zoekresultaten&lt;/h1&gt;
+				
+				&lt;?php echo &quot;$list_artiesten&quot;;?&gt;
+				&lt;?php echo &quot;$list_titles&quot;;?&gt;
+				&lt;?php echo &quot;$list_album&quot;;?&gt;
+
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require '../template_sidebar_footer.php'; ?&gt;		

Added: trunk/class.phpmailer.bak.php
===================================================================
--- trunk/class.phpmailer.bak.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/class.phpmailer.bak.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,1530 @@
+&lt;?php
+////////////////////////////////////////////////////
+// PHPMailer - PHP email class
+//
+// Class for sending email using either
+// sendmail, PHP mail(), or SMTP.  Methods are
+// based upon the standard AspEmail(tm) classes.
+//
+// Copyright (C) 2001 - 2003  Brent R. Matzelle
+//
+// License: LGPL, see LICENSE
+////////////////////////////////////////////////////
+
+/**
+ * PHPMailer - PHP email transport class
+ * @package PHPMailer
+ * @author Brent R. Matzelle
+ * @copyright 2001 - 2003 Brent R. Matzelle
+ */
+class PHPMailer
+{
+    /////////////////////////////////////////////////
+    // PUBLIC VARIABLES
+    /////////////////////////////////////////////////
+
+    /**
+     * Email priority (1 = High, 3 = Normal, 5 = low).
+     * @var int
+     */
+    var $Priority          = 3;
+
+    /**
+     * Sets the CharSet of the message.
+     * @var string
+     */
+    var $CharSet           = &quot;iso-8859-1&quot;;
+
+    /**
+     * Sets the Content-type of the message.
+     * @var string
+     */
+    var $ContentType        = &quot;text/plain&quot;;
+
+    /**
+     * Sets the Encoding of the message. Options for this are &quot;8bit&quot;,
+     * &quot;7bit&quot;, &quot;binary&quot;, &quot;base64&quot;, and &quot;quoted-printable&quot;.
+     * @var string
+     */
+    var $Encoding          = &quot;8bit&quot;;
+
+    /**
+     * Holds the most recent mailer error message.
+     * @var string
+     */
+    var $ErrorInfo         = &quot;&quot;;
+
+    /**
+     * Sets the From email address for the message.
+     * @var string
+     */
+    var $From               = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">root at localhost</A>&quot;;
+
+    /**
+     * Sets the From name of the message.
+     * @var string
+     */
+    var $FromName           = &quot;Root User&quot;;
+
+    /**
+     * Sets the Sender email (Return-Path) of the message.  If not empty,
+     * will be sent via -f to sendmail or as 'MAIL FROM' in smtp mode.
+     * @var string
+     */
+    var $Sender            = &quot;&quot;;
+
+    /**
+     * Sets the Subject of the message.
+     * @var string
+     */
+    var $Subject           = &quot;&quot;;
+
+    /**
+     * Sets the Body of the message.  This can be either an HTML or text body.
+     * If HTML then run IsHTML(true).
+     * @var string
+     */
+    var $Body               = &quot;&quot;;
+
+    /**
+     * Sets the text-only body of the message.  This automatically sets the
+     * email to multipart/alternative.  This body can be read by mail
+     * clients that do not have HTML email capability such as mutt. Clients
+     * that can read HTML will view the normal Body.
+     * @var string
+     */
+    var $AltBody           = &quot;&quot;;
+
+    /**
+     * Sets word wrapping on the body of the message to a given number of 
+     * characters.
+     * @var int
+     */
+    var $WordWrap          = 0;
+
+    /**
+     * Method to send mail: (&quot;mail&quot;, &quot;sendmail&quot;, or &quot;smtp&quot;).
+     * @var string
+     */
+    var $Mailer            = &quot;mail&quot;;
+
+    /**
+     * Sets the path of the sendmail program.
+     * @var string
+     */
+    var $Sendmail          = &quot;/usr/sbin/sendmail&quot;;
+    
+    /**
+     * Path to PHPMailer plugins.  This is now only useful if the SMTP class 
+     * is in a different directory than the PHP include path.  
+     * @var string
+     */
+    var $PluginDir         = &quot;&quot;;
+
+    /**
+     *  Holds PHPMailer version.
+     *  @var string
+     */
+    var $Version           = &quot;1.71&quot;;
+
+    /**
+     * Sets the email address that a reading confirmation will be sent.
+     * @var string
+     */
+    var $ConfirmReadingTo  = &quot;&quot;;
+
+    /**
+     *  Sets the hostname to use in Message-Id and Received headers
+     *  and as default HELO string. If empty, the value returned
+     *  by SERVER_NAME is used or 'localhost.localdomain'.
+     *  @var string
+     */
+    var $Hostname          = &quot;&quot;;
+
+
+    /////////////////////////////////////////////////
+    // SMTP VARIABLES
+    /////////////////////////////////////////////////
+
+    /**
+     *  Sets the SMTP hosts.  All hosts must be separated by a
+     *  semicolon.  You can also specify a different port
+     *  for each host by using this format: [hostname:port]
+     *  (e.g. &quot;smtp1.example.com:25;smtp2.example.com&quot;).
+     *  Hosts will be tried in order.
+     *  @var string
+     */
+    var $Host        = &quot;localhost&quot;;
+
+    /**
+     *  Sets the default SMTP server port.
+     *  @var int
+     */
+    var $Port        = 25;
+
+    /**
+     *  Sets the SMTP HELO of the message (Default is $Hostname).
+     *  @var string
+     */
+    var $Helo        = &quot;&quot;;
+
+    /**
+     *  Sets SMTP authentication. Utilizes the Username and Password variables.
+     *  @var bool
+     */
+    var $SMTPAuth     = false;
+
+    /**
+     *  Sets SMTP username.
+     *  @var string
+     */
+    var $Username     = &quot;&quot;;
+
+    /**
+     *  Sets SMTP password.
+     *  @var string
+     */
+    var $Password     = &quot;&quot;;
+
+    /**
+     *  Sets the SMTP server timeout in seconds. This function will not 
+     *  work with the win32 version.
+     *  @var int
+     */
+    var $Timeout      = 10;
+
+    /**
+     *  Sets SMTP class debugging on or off.
+     *  @var bool
+     */
+    var $SMTPDebug    = false;
+
+    /**
+     * Prevents the SMTP connection from being closed after each mail 
+     * sending.  If this is set to true then to close the connection 
+     * requires an explicit call to SmtpClose(). 
+     * @var bool
+     */
+    var $SMTPKeepAlive = false;
+
+    /**#@+
+     * @access private
+     */
+    var $smtp            = NULL;
+    var $to              = array();
+    var $cc              = array();
+    var $bcc             = array();
+    var $ReplyTo         = array();
+    var $attachment      = array();
+    var $CustomHeader    = array();
+    var $message_type    = &quot;&quot;;
+    var $boundary        = array();
+    var $language        = array();
+    var $error_count     = 0;
+    var $LE              = &quot;\n&quot;;
+    /**#@-*/
+    
+    /////////////////////////////////////////////////
+    // VARIABLE METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Sets message type to HTML.  
+     * @param bool $bool
+     * @return void
+     */
+    function IsHTML($bool) {
+        if($bool == true)
+            $this-&gt;ContentType = &quot;text/html&quot;;
+        else
+            $this-&gt;ContentType = &quot;text/plain&quot;;
+    }
+
+    /**
+     * Sets Mailer to send message using SMTP.
+     * @return void
+     */
+    function IsSMTP() {
+        $this-&gt;Mailer = &quot;smtp&quot;;
+    }
+
+    /**
+     * Sets Mailer to send message using PHP mail() function.
+     * @return void
+     */
+    function IsMail() {
+        $this-&gt;Mailer = &quot;mail&quot;;
+    }
+
+    /**
+     * Sets Mailer to send message using the $Sendmail program.
+     * @return void
+     */
+    function IsSendmail() {
+        $this-&gt;Mailer = &quot;sendmail&quot;;
+    }
+
+    /**
+     * Sets Mailer to send message using the qmail MTA. 
+     * @return void
+     */
+    function IsQmail() {
+        $this-&gt;Sendmail = &quot;/var/qmail/bin/sendmail&quot;;
+        $this-&gt;Mailer = &quot;sendmail&quot;;
+    }
+
+
+    /////////////////////////////////////////////////
+    // RECIPIENT METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Adds a &quot;To&quot; address.  
+     * @param string $address
+     * @param string $name
+     * @return void
+     */
+    function AddAddress($address, $name = &quot;&quot;) {
+        $cur = count($this-&gt;to);
+        $this-&gt;to[$cur][0] = trim($address);
+        $this-&gt;to[$cur][1] = $name;
+    }
+
+    /**
+     * Adds a &quot;Cc&quot; address. Note: this function works
+     * with the SMTP mailer on win32, not with the &quot;mail&quot;
+     * mailer.  
+     * @param string $address
+     * @param string $name
+     * @return void
+    */
+    function AddCC($address, $name = &quot;&quot;) {
+        $cur = count($this-&gt;cc);
+        $this-&gt;cc[$cur][0] = trim($address);
+        $this-&gt;cc[$cur][1] = $name;
+    }
+
+    /**
+     * Adds a &quot;Bcc&quot; address. Note: this function works
+     * with the SMTP mailer on win32, not with the &quot;mail&quot;
+     * mailer.  
+     * @param string $address
+     * @param string $name
+     * @return void
+     */
+    function AddBCC($address, $name = &quot;&quot;) {
+        $cur = count($this-&gt;bcc);
+        $this-&gt;bcc[$cur][0] = trim($address);
+        $this-&gt;bcc[$cur][1] = $name;
+    }
+
+    /**
+     * Adds a &quot;Reply-to&quot; address.  
+     * @param string $address
+     * @param string $name
+     * @return void
+     */
+    function AddReplyTo($address, $name = &quot;&quot;) {
+        $cur = count($this-&gt;ReplyTo);
+        $this-&gt;ReplyTo[$cur][0] = trim($address);
+        $this-&gt;ReplyTo[$cur][1] = $name;
+    }
+
+
+    /////////////////////////////////////////////////
+    // MAIL SENDING METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Creates message and assigns Mailer. If the message is
+     * not sent successfully then it returns false.  Use the ErrorInfo
+     * variable to view description of the error.  
+     * @return bool
+     */
+    function Send() {
+        $header = &quot;&quot;;
+        $body = &quot;&quot;;
+
+        if((count($this-&gt;to) + count($this-&gt;cc) + count($this-&gt;bcc)) &lt; 1)
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;provide_address&quot;));
+            return false;
+        }
+
+        // Set whether the message is multipart/alternative
+        if(!empty($this-&gt;AltBody))
+            $this-&gt;ContentType = &quot;multipart/alternative&quot;;
+
+        $this-&gt;SetMessageType();
+        $header .= $this-&gt;CreateHeader();
+        $body = $this-&gt;CreateBody();
+
+        if($body == &quot;&quot;) { return false; }
+
+        // Choose the mailer
+        if($this-&gt;Mailer == &quot;sendmail&quot;)
+        {
+          if(!$this-&gt;SendmailSend($header, $body))
+              return false;
+        }
+        elseif($this-&gt;Mailer == &quot;mail&quot;)
+        {
+          if(!$this-&gt;MailSend($header, $body))
+              return false;
+        }
+        elseif($this-&gt;Mailer == &quot;smtp&quot;)
+        {
+          if(!$this-&gt;SmtpSend($header, $body))
+              return false;
+        }
+        else
+        {
+            $this-&gt;SetError($this-&gt;Mailer . $this-&gt;Lang(&quot;mailer_not_supported&quot;));
+            return false;
+        }
+
+        return true;
+    }
+    
+    /**
+     * Sends mail using the $Sendmail program.  
+     * @access private
+     * @return bool
+     */
+    function SendmailSend($header, $body) {
+        if ($this-&gt;Sender != &quot;&quot;)
+            $sendmail = sprintf(&quot;%s -oi -f %s -t&quot;, $this-&gt;Sendmail, $this-&gt;Sender);
+        else
+            $sendmail = sprintf(&quot;%s -oi -t&quot;, $this-&gt;Sendmail);
+
+        if(!@$mail = popen($sendmail, &quot;w&quot;))
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;execute&quot;) . $this-&gt;Sendmail);
+            return false;
+        }
+
+        fputs($mail, $header);
+        fputs($mail, $body);
+        
+        $result = pclose($mail) &gt;&gt; 8 &amp; 0xFF;
+        if($result != 0)
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;execute&quot;) . $this-&gt;Sendmail);
+            return false;
+        }
+
+        return true;
+    }
+
+    /**
+     * Sends mail using the PHP mail() function.  
+     * @access private
+     * @return bool
+     */
+    function MailSend($header, $body) {
+        $to = &quot;&quot;;
+        for($i = 0; $i &lt; count($this-&gt;to); $i++)
+        {
+            if($i != 0) { $to .= &quot;, &quot;; }
+            $to .= $this-&gt;to[$i][0];
+        }
+
+        if ($this-&gt;Sender != &quot;&quot; &amp;&amp; strlen(ini_get(&quot;safe_mode&quot;))&lt; 1)
+        {
+            $old_from = ini_get(&quot;sendmail_from&quot;);
+            ini_set(&quot;sendmail_from&quot;, $this-&gt;Sender);
+            $params = sprintf(&quot;-oi -f %s&quot;, $this-&gt;Sender);
+            $rt = @mail($to, $this-&gt;EncodeHeader($this-&gt;Subject), $body, 
+                        $header, $params);
+        }
+        else
+            $rt = @mail($to, $this-&gt;EncodeHeader($this-&gt;Subject), $body, $header);
+
+        if (isset($old_from))
+            ini_set(&quot;sendmail_from&quot;, $old_from);
+
+        if(!$rt)
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;instantiate&quot;));
+            return false;
+        }
+
+        return true;
+    }
+
+    /**
+     * Sends mail via SMTP using PhpSMTP (Author:
+     * Chris Ryan).  Returns bool.  Returns false if there is a
+     * bad MAIL FROM, RCPT, or DATA input.
+     * @access private
+     * @return bool
+     */
+    function SmtpSend($header, $body) {
+        include_once($this-&gt;PluginDir . &quot;class.smtp.php&quot;);
+        $error = &quot;&quot;;
+        $bad_rcpt = array();
+
+        if(!$this-&gt;SmtpConnect())
+            return false;
+
+        $smtp_from = ($this-&gt;Sender == &quot;&quot;) ? $this-&gt;From : $this-&gt;Sender;
+        if(!$this-&gt;smtp-&gt;Mail($smtp_from))
+        {
+            $error = $this-&gt;Lang(&quot;from_failed&quot;) . $smtp_from;
+            $this-&gt;SetError($error);
+            $this-&gt;smtp-&gt;Reset();
+            return false;
+        }
+
+        // Attempt to send attach all recipients
+        for($i = 0; $i &lt; count($this-&gt;to); $i++)
+        {
+            if(!$this-&gt;smtp-&gt;Recipient($this-&gt;to[$i][0]))
+                $bad_rcpt[] = $this-&gt;to[$i][0];
+        }
+        for($i = 0; $i &lt; count($this-&gt;cc); $i++)
+        {
+            if(!$this-&gt;smtp-&gt;Recipient($this-&gt;cc[$i][0]))
+                $bad_rcpt[] = $this-&gt;cc[$i][0];
+        }
+        for($i = 0; $i &lt; count($this-&gt;bcc); $i++)
+        {
+            if(!$this-&gt;smtp-&gt;Recipient($this-&gt;bcc[$i][0]))
+                $bad_rcpt[] = $this-&gt;bcc[$i][0];
+        }
+
+        if(count($bad_rcpt) &gt; 0) // Create error message
+        {
+            for($i = 0; $i &lt; count($bad_rcpt); $i++)
+            {
+                if($i != 0) { $error .= &quot;, &quot;; }
+                $error .= $bad_rcpt[$i];
+            }
+            $error = $this-&gt;Lang(&quot;recipients_failed&quot;) . $error;
+            $this-&gt;SetError($error);
+            $this-&gt;smtp-&gt;Reset();
+            return false;
+        }
+
+        if(!$this-&gt;smtp-&gt;Data($header . $body))
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;data_not_accepted&quot;));
+            $this-&gt;smtp-&gt;Reset();
+            return false;
+        }
+        if($this-&gt;SMTPKeepAlive == true)
+            $this-&gt;smtp-&gt;Reset();
+        else
+            $this-&gt;SmtpClose();
+
+        return true;
+    }
+
+    /**
+     * Initiates a connection to an SMTP server.  Returns false if the 
+     * operation failed.
+     * @access private
+     * @return bool
+     */
+    function SmtpConnect() {
+        if($this-&gt;smtp == NULL) { $this-&gt;smtp = new SMTP(); }
+
+        $this-&gt;smtp-&gt;do_debug = $this-&gt;SMTPDebug;
+        $hosts = explode(&quot;;&quot;, $this-&gt;Host);
+        $index = 0;
+        $connection = ($this-&gt;smtp-&gt;Connected()); 
+
+        // Retry while there is no connection
+        while($index &lt; count($hosts) &amp;&amp; $connection == false)
+        {
+            if(strstr($hosts[$index], &quot;:&quot;))
+                list($host, $port) = explode(&quot;:&quot;, $hosts[$index]);
+            else
+            {
+                $host = $hosts[$index];
+                $port = $this-&gt;Port;
+            }
+
+            if($this-&gt;smtp-&gt;Connect($host, $port, $this-&gt;Timeout))
+            {
+                if ($this-&gt;Helo != '')
+                    $this-&gt;smtp-&gt;Hello($this-&gt;Helo);
+                else
+                    $this-&gt;smtp-&gt;Hello($this-&gt;ServerHostname());
+        
+                if($this-&gt;SMTPAuth)
+                {
+                    if(!$this-&gt;smtp-&gt;Authenticate($this-&gt;Username, 
+                                                  $this-&gt;Password))
+                    {
+                        $this-&gt;SetError($this-&gt;Lang(&quot;authenticate&quot;));
+                        $this-&gt;smtp-&gt;Reset();
+                        $connection = false;
+                    }
+                }
+                $connection = true;
+            }
+            $index++;
+        }
+        if(!$connection)
+            $this-&gt;SetError($this-&gt;Lang(&quot;connect_host&quot;));
+
+        return $connection;
+    }
+
+    /**
+     * Closes the active SMTP session if one exists.
+     * @return void
+     */
+    function SmtpClose() {
+        if($this-&gt;smtp != NULL)
+        {
+            if($this-&gt;smtp-&gt;Connected())
+            {
+                $this-&gt;smtp-&gt;Quit();
+                $this-&gt;smtp-&gt;Close();
+            }
+        }
+    }
+
+    /**
+     * Sets the language for all class error messages.  Returns false 
+     * if it cannot load the language file.  The default language type
+     * is English.
+     * @param string $lang_type Type of language (e.g. Portuguese: &quot;br&quot;)
+     * @param string $lang_path Path to the language file directory
+     * @access public
+     * @return bool
+     */
+    function SetLanguage($lang_type, $lang_path = &quot;&quot;) {
+        if(file_exists($lang_path.'phpmailer.lang-'.$lang_type.'.php'))
+            include($lang_path.'phpmailer.lang-'.$lang_type.'.php');
+        else if(file_exists($lang_path.'phpmailer.lang-en.php'))
+            include($lang_path.'phpmailer.lang-en.php');
+        else
+        {
+            $this-&gt;SetError(&quot;Could not load language file&quot;);
+            return false;
+        }
+        $this-&gt;language = $PHPMAILER_LANG;
+    
+        return true;
+    }
+
+    /////////////////////////////////////////////////
+    // MESSAGE CREATION METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Creates recipient headers.  
+     * @access private
+     * @return string
+     */
+    function AddrAppend($type, $addr) {
+        $addr_str = $type . &quot;: &quot;;
+        $addr_str .= $this-&gt;AddrFormat($addr[0]);
+        if(count($addr) &gt; 1)
+        {
+            for($i = 1; $i &lt; count($addr); $i++)
+                $addr_str .= &quot;, &quot; . $this-&gt;AddrFormat($addr[$i]);
+        }
+        $addr_str .= $this-&gt;LE;
+
+        return $addr_str;
+    }
+    
+    /**
+     * Formats an address correctly. 
+     * @access private
+     * @return string
+     */
+    function AddrFormat($addr) {
+        if(empty($addr[1]))
+            $formatted = $addr[0];
+        else
+        {
+            $formatted = $this-&gt;EncodeHeader($addr[1], 'phrase') . &quot; &lt;&quot; . 
+                         $addr[0] . &quot;&gt;&quot;;
+        }
+
+        return $formatted;
+    }
+
+    /**
+     * Wraps message for use with mailers that do not
+     * automatically perform wrapping and for quoted-printable.
+     * Original written by philippe.  
+     * @access private
+     * @return string
+     */
+    function WrapText($message, $length, $qp_mode = false) {
+        $soft_break = ($qp_mode) ? sprintf(&quot; =%s&quot;, $this-&gt;LE) : $this-&gt;LE;
+
+        $message = $this-&gt;FixEOL($message);
+        if (substr($message, -1) == $this-&gt;LE)
+            $message = substr($message, 0, -1);
+
+        $line = explode($this-&gt;LE, $message);
+        $message = &quot;&quot;;
+        for ($i=0 ;$i &lt; count($line); $i++)
+        {
+          $line_part = explode(&quot; &quot;, $line[$i]);
+          $buf = &quot;&quot;;
+          for ($e = 0; $e&lt;count($line_part); $e++)
+          {
+              $word = $line_part[$e];
+              if ($qp_mode and (strlen($word) &gt; $length))
+              {
+                $space_left = $length - strlen($buf) - 1;
+                if ($e != 0)
+                {
+                    if ($space_left &gt; 20)
+                    {
+                        $len = $space_left;
+                        if (substr($word, $len - 1, 1) == &quot;=&quot;)
+                          $len--;
+                        elseif (substr($word, $len - 2, 1) == &quot;=&quot;)
+                          $len -= 2;
+                        $part = substr($word, 0, $len);
+                        $word = substr($word, $len);
+                        $buf .= &quot; &quot; . $part;
+                        $message .= $buf . sprintf(&quot;=%s&quot;, $this-&gt;LE);
+                    }
+                    else
+                    {
+                        $message .= $buf . $soft_break;
+                    }
+                    $buf = &quot;&quot;;
+                }
+                while (strlen($word) &gt; 0)
+                {
+                    $len = $length;
+                    if (substr($word, $len - 1, 1) == &quot;=&quot;)
+                        $len--;
+                    elseif (substr($word, $len - 2, 1) == &quot;=&quot;)
+                        $len -= 2;
+                    $part = substr($word, 0, $len);
+                    $word = substr($word, $len);
+
+                    if (strlen($word) &gt; 0)
+                        $message .= $part . sprintf(&quot;=%s&quot;, $this-&gt;LE);
+                    else
+                        $buf = $part;
+                }
+              }
+              else
+              {
+                $buf_o = $buf;
+                $buf .= ($e == 0) ? $word : (&quot; &quot; . $word); 
+
+                if (strlen($buf) &gt; $length and $buf_o != &quot;&quot;)
+                {
+                    $message .= $buf_o . $soft_break;
+                    $buf = $word;
+                }
+              }
+          }
+          $message .= $buf . $this-&gt;LE;
+        }
+
+        return $message;
+    }
+    
+    /**
+     * Set the body wrapping.
+     * @access private
+     * @return void
+     */
+    function SetWordWrap() {
+        if($this-&gt;WordWrap &lt; 1)
+            return;
+            
+        switch($this-&gt;message_type)
+        {
+           case &quot;alt&quot;:
+              // fall through
+           case &quot;alt_attachment&quot;:
+              $this-&gt;AltBody = $this-&gt;WrapText($this-&gt;AltBody, $this-&gt;WordWrap);
+              break;
+           default:
+              $this-&gt;Body = $this-&gt;WrapText($this-&gt;Body, $this-&gt;WordWrap);
+              break;
+        }
+    }
+
+    /**
+     * Assembles message header.  
+     * @access private
+     * @return string
+     */
+    function CreateHeader() {
+        $result = &quot;&quot;;
+        
+        // Set the boundaries
+        $uniq_id = md5(uniqid(time()));
+        $this-&gt;boundary[1] = &quot;b1_&quot; . $uniq_id;
+        $this-&gt;boundary[2] = &quot;b2_&quot; . $uniq_id;
+
+        $result .= $this-&gt;Received();
+        $result .= $this-&gt;HeaderLine(&quot;Date&quot;, $this-&gt;RFCDate());
+        if($this-&gt;Sender == &quot;&quot;)
+            $result .= $this-&gt;HeaderLine(&quot;Return-Path&quot;, trim($this-&gt;From));
+        else
+            $result .= $this-&gt;HeaderLine(&quot;Return-Path&quot;, trim($this-&gt;Sender));
+        
+        // To be created automatically by mail()
+        if($this-&gt;Mailer != &quot;mail&quot;)
+        {
+            if(count($this-&gt;to) &gt; 0)
+                $result .= $this-&gt;AddrAppend(&quot;To&quot;, $this-&gt;to);
+            else if (count($this-&gt;cc) == 0)
+                $result .= $this-&gt;HeaderLine(&quot;To&quot;, &quot;undisclosed-recipients:;&quot;);
+            if(count($this-&gt;cc) &gt; 0)
+                $result .= $this-&gt;AddrAppend(&quot;Cc&quot;, $this-&gt;cc);
+        }
+
+        $from = array();
+        $from[0][0] = trim($this-&gt;From);
+        $from[0][1] = $this-&gt;FromName;
+        $result .= $this-&gt;AddrAppend(&quot;From&quot;, $from); 
+
+        // sendmail and mail() extract Bcc from the header before sending
+        if((($this-&gt;Mailer == &quot;sendmail&quot;) || ($this-&gt;Mailer == &quot;mail&quot;)) &amp;&amp; (count($this-&gt;bcc) &gt; 0))
+            $result .= $this-&gt;AddrAppend(&quot;Bcc&quot;, $this-&gt;bcc);
+
+        if(count($this-&gt;ReplyTo) &gt; 0)
+            $result .= $this-&gt;AddrAppend(&quot;Reply-to&quot;, $this-&gt;ReplyTo);
+
+        // mail() sets the subject itself
+        if($this-&gt;Mailer != &quot;mail&quot;)
+            $result .= $this-&gt;HeaderLine(&quot;Subject&quot;, $this-&gt;EncodeHeader(trim($this-&gt;Subject)));
+
+        $result .= sprintf(&quot;Message-ID: &lt;%s@%s&gt;%s&quot;, $uniq_id, $this-&gt;ServerHostname(), $this-&gt;LE);
+        $result .= $this-&gt;HeaderLine(&quot;X-Priority&quot;, $this-&gt;Priority);
+        $result .= $this-&gt;HeaderLine(&quot;X-Mailer&quot;, &quot;PHPMailer [version &quot; . $this-&gt;Version . &quot;]&quot;);
+        
+        if($this-&gt;ConfirmReadingTo != &quot;&quot;)
+        {
+            $result .= $this-&gt;HeaderLine(&quot;Disposition-Notification-To&quot;, 
+                       &quot;&lt;&quot; . trim($this-&gt;ConfirmReadingTo) . &quot;&gt;&quot;);
+        }
+
+        // Add custom headers
+        for($index = 0; $index &lt; count($this-&gt;CustomHeader); $index++)
+        {
+            $result .= $this-&gt;HeaderLine(trim($this-&gt;CustomHeader[$index][0]), 
+                       $this-&gt;EncodeHeader(trim($this-&gt;CustomHeader[$index][1])));
+        }
+        $result .= $this-&gt;HeaderLine(&quot;MIME-Version&quot;, &quot;1.0&quot;);
+
+        switch($this-&gt;message_type)
+        {
+            case &quot;plain&quot;:
+                $result .= $this-&gt;HeaderLine(&quot;Content-Transfer-Encoding&quot;, $this-&gt;Encoding);
+                $result .= sprintf(&quot;Content-Type: %s; charset=\&quot;%s\&quot;&quot;,
+                                    $this-&gt;ContentType, $this-&gt;CharSet);
+                break;
+            case &quot;attachments&quot;:
+                // fall through
+            case &quot;alt_attachments&quot;:
+                if($this-&gt;InlineImageExists())
+                {
+                    $result .= sprintf(&quot;Content-Type: %s;%s\ttype=\&quot;text/html\&quot;;%s\tboundary=\&quot;%s\&quot;%s&quot;, 
+                                    &quot;multipart/related&quot;, $this-&gt;LE, $this-&gt;LE, 
+                                    $this-&gt;boundary[1], $this-&gt;LE);
+                }
+                else
+                {
+                    $result .= $this-&gt;HeaderLine(&quot;Content-Type&quot;, &quot;multipart/mixed;&quot;);
+                    $result .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . '&quot;');
+                }
+                break;
+            case &quot;alt&quot;:
+                $result .= $this-&gt;HeaderLine(&quot;Content-Type&quot;, &quot;multipart/alternative;&quot;);
+                $result .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . '&quot;');
+                break;
+        }
+
+        if($this-&gt;Mailer != &quot;mail&quot;)
+            $result .= $this-&gt;LE.$this-&gt;LE;
+
+        return $result;
+    }
+
+    /**
+     * Assembles the message body.  Returns an empty string on failure.
+     * @access private
+     * @return string
+     */
+    function CreateBody() {
+        $result = &quot;&quot;;
+
+        $this-&gt;SetWordWrap();
+
+        switch($this-&gt;message_type)
+        {
+            case &quot;alt&quot;:
+                $result .= $this-&gt;GetBoundary($this-&gt;boundary[1], &quot;&quot;, 
+                                              &quot;text/plain&quot;, &quot;&quot;);
+                $result .= $this-&gt;EncodeString($this-&gt;AltBody, $this-&gt;Encoding);
+                $result .= $this-&gt;LE.$this-&gt;LE;
+                $result .= $this-&gt;GetBoundary($this-&gt;boundary[1], &quot;&quot;, 
+                                              &quot;text/html&quot;, &quot;&quot;);
+                
+                $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);
+                $result .= $this-&gt;LE.$this-&gt;LE;
+    
+                $result .= $this-&gt;EndBoundary($this-&gt;boundary[1]);
+                break;
+            case &quot;plain&quot;:
+                $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);
+                break;
+            case &quot;attachments&quot;:
+                $result .= $this-&gt;GetBoundary($this-&gt;boundary[1], &quot;&quot;, &quot;&quot;, &quot;&quot;);
+                $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);
+                $result .= $this-&gt;LE;
+     
+                $result .= $this-&gt;AttachAll();
+                break;
+            case &quot;alt_attachments&quot;:
+                $result .= sprintf(&quot;--%s%s&quot;, $this-&gt;boundary[1], $this-&gt;LE);
+                $result .= sprintf(&quot;Content-Type: %s;%s&quot; .
+                                   &quot;\tboundary=\&quot;%s\&quot;%s&quot;,
+                                   &quot;multipart/alternative&quot;, $this-&gt;LE, 
+                                   $this-&gt;boundary[2], $this-&gt;LE.$this-&gt;LE);
+    
+                // Create text body
+                $result .= $this-&gt;GetBoundary($this-&gt;boundary[2], &quot;&quot;, 
+                                              &quot;text/plain&quot;, &quot;&quot;) . $this-&gt;LE;
+
+                $result .= $this-&gt;EncodeString($this-&gt;AltBody, $this-&gt;Encoding);
+                $result .= $this-&gt;LE.$this-&gt;LE;
+    
+                // Create the HTML body
+                $result .= $this-&gt;GetBoundary($this-&gt;boundary[2], &quot;&quot;, 
+                                              &quot;text/html&quot;, &quot;&quot;) . $this-&gt;LE;
+    
+                $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);
+                $result .= $this-&gt;LE.$this-&gt;LE;
+
+                $result .= $this-&gt;EndBoundary($this-&gt;boundary[2]);
+                
+                $result .= $this-&gt;AttachAll();
+                break;
+        }
+        if($this-&gt;IsError())
+            $result = &quot;&quot;;
+
+        return $result;
+    }
+
+    /**
+     * Returns the start of a message boundary.
+     * @access private
+     */
+    function GetBoundary($boundary, $charSet, $contentType, $encoding) {
+        $result = &quot;&quot;;
+        if($charSet == &quot;&quot;) { $charSet = $this-&gt;CharSet; }
+        if($contentType == &quot;&quot;) { $contentType = $this-&gt;ContentType; }
+        if($encoding == &quot;&quot;) { $encoding = $this-&gt;Encoding; }
+
+        $result .= $this-&gt;TextLine(&quot;--&quot; . $boundary);
+        $result .= sprintf(&quot;Content-Type: %s; charset = \&quot;%s\&quot;&quot;, 
+                            $contentType, $charSet);
+        $result .= $this-&gt;LE;
+        $result .= $this-&gt;HeaderLine(&quot;Content-Transfer-Encoding&quot;, $encoding);
+        $result .= $this-&gt;LE;
+       
+        return $result;
+    }
+    
+    /**
+     * Returns the end of a message boundary.
+     * @access private
+     */
+    function EndBoundary($boundary) {
+        return $this-&gt;LE . &quot;--&quot; . $boundary . &quot;--&quot; . $this-&gt;LE; 
+    }
+    
+    /**
+     * Sets the message type.
+     * @access private
+     * @return void
+     */
+    function SetMessageType() {
+        if(count($this-&gt;attachment) &lt; 1 &amp;&amp; strlen($this-&gt;AltBody) &lt; 1)
+            $this-&gt;message_type = &quot;plain&quot;;
+        else
+        {
+            if(count($this-&gt;attachment) &gt; 0)
+                $this-&gt;message_type = &quot;attachments&quot;;
+            if(strlen($this-&gt;AltBody) &gt; 0 &amp;&amp; count($this-&gt;attachment) &lt; 1)
+                $this-&gt;message_type = &quot;alt&quot;;
+            if(strlen($this-&gt;AltBody) &gt; 0 &amp;&amp; count($this-&gt;attachment) &gt; 0)
+                $this-&gt;message_type = &quot;alt_attachments&quot;;
+        }
+    }
+
+    /**
+     * Returns a formatted header line.
+     * @access private
+     * @return string
+     */
+    function HeaderLine($name, $value) {
+        return $name . &quot;: &quot; . $value . $this-&gt;LE;
+    }
+
+    /**
+     * Returns a formatted mail line.
+     * @access private
+     * @return string
+     */
+    function TextLine($value) {
+        return $value . $this-&gt;LE;
+    }
+
+    /////////////////////////////////////////////////
+    // ATTACHMENT METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Adds an attachment from a path on the filesystem.
+     * Returns false if the file could not be found
+     * or accessed.
+     * @param string $path Path to the attachment.
+     * @param string $name Overrides the attachment name.
+     * @param string $encoding File encoding (see $Encoding).
+     * @param string $type File extension (MIME) type.
+     * @return bool
+     */
+    function AddAttachment($path, $name = &quot;&quot;, $encoding = &quot;base64&quot;, 
+                           $type = &quot;application/octet-stream&quot;) {
+        if(!@is_file($path))
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;file_access&quot;) . $path);
+            return false;
+        }
+
+        $filename = basename($path);
+        if($name == &quot;&quot;)
+            $name = $filename;
+
+        $cur = count($this-&gt;attachment);
+        $this-&gt;attachment[$cur][0] = $path;
+        $this-&gt;attachment[$cur][1] = $filename;
+        $this-&gt;attachment[$cur][2] = $name;
+        $this-&gt;attachment[$cur][3] = $encoding;
+        $this-&gt;attachment[$cur][4] = $type;
+        $this-&gt;attachment[$cur][5] = false; // isStringAttachment
+        $this-&gt;attachment[$cur][6] = &quot;attachment&quot;;
+        $this-&gt;attachment[$cur][7] = 0;
+
+        return true;
+    }
+
+    /**
+     * Attaches all fs, string, and binary attachments to the message.
+     * Returns an empty string on failure.
+     * @access private
+     * @return string
+     */
+    function AttachAll() {
+        // Return text of body
+        $mime = array();
+
+        // Add all attachments
+        for($i = 0; $i &lt; count($this-&gt;attachment); $i++)
+        {
+            // Check for string attachment
+            $bString = $this-&gt;attachment[$i][5];
+            if ($bString)
+                $string = $this-&gt;attachment[$i][0];
+            else
+                $path = $this-&gt;attachment[$i][0];
+
+            $filename    = $this-&gt;attachment[$i][1];
+            $name        = $this-&gt;attachment[$i][2];
+            $encoding    = $this-&gt;attachment[$i][3];
+            $type        = $this-&gt;attachment[$i][4];
+            $disposition = $this-&gt;attachment[$i][6];
+            $cid         = $this-&gt;attachment[$i][7];
+            
+            $mime[] = sprintf(&quot;--%s%s&quot;, $this-&gt;boundary[1], $this-&gt;LE);
+            $mime[] = sprintf(&quot;Content-Type: %s; name=\&quot;%s\&quot;%s&quot;, $type, $name, $this-&gt;LE);
+            $mime[] = sprintf(&quot;Content-Transfer-Encoding: %s%s&quot;, $encoding, $this-&gt;LE);
+
+            if($disposition == &quot;inline&quot;)
+                $mime[] = sprintf(&quot;Content-ID: &lt;%s&gt;%s&quot;, $cid, $this-&gt;LE);
+
+            $mime[] = sprintf(&quot;Content-Disposition: %s; filename=\&quot;%s\&quot;%s&quot;, 
+                              $disposition, $name, $this-&gt;LE.$this-&gt;LE);
+
+            // Encode as string attachment
+            if($bString)
+            {
+                $mime[] = $this-&gt;EncodeString($string, $encoding);
+                if($this-&gt;IsError()) { return &quot;&quot;; }
+                $mime[] = $this-&gt;LE.$this-&gt;LE;
+            }
+            else
+            {
+                $mime[] = $this-&gt;EncodeFile($path, $encoding);                
+                if($this-&gt;IsError()) { return &quot;&quot;; }
+                $mime[] = $this-&gt;LE.$this-&gt;LE;
+            }
+        }
+
+        $mime[] = sprintf(&quot;--%s--%s&quot;, $this-&gt;boundary[1], $this-&gt;LE);
+
+        return join(&quot;&quot;, $mime);
+    }
+    
+    /**
+     * Encodes attachment in requested format.  Returns an
+     * empty string on failure.
+     * @access private
+     * @return string
+     */
+    function EncodeFile ($path, $encoding = &quot;base64&quot;) {
+        if(!@$fd = fopen($path, &quot;rb&quot;))
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;file_open&quot;) . $path);
+            return &quot;&quot;;
+        }
+        $file_buffer = fread($fd, filesize($path));
+        $file_buffer = $this-&gt;EncodeString($file_buffer, $encoding);
+        fclose($fd);
+
+        return $file_buffer;
+    }
+
+    /**
+     * Encodes string to requested format. Returns an
+     * empty string on failure.
+     * @access private
+     * @return string
+     */
+    function EncodeString ($str, $encoding = &quot;base64&quot;) {
+        $encoded = &quot;&quot;;
+        switch(strtolower($encoding)) {
+          case &quot;base64&quot;:
+              // chunk_split is found in PHP &gt;= 3.0.6
+              $encoded = chunk_split(base64_encode($str), 76, $this-&gt;LE);
+              break;
+          case &quot;7bit&quot;:
+          case &quot;8bit&quot;:
+              $encoded = $this-&gt;FixEOL($str);
+              if (substr($encoded, -(strlen($this-&gt;LE))) != $this-&gt;LE)
+                $encoded .= $this-&gt;LE;
+              break;
+          case &quot;binary&quot;:
+              $encoded = $str;
+              break;
+          case &quot;quoted-printable&quot;:
+              $encoded = $this-&gt;EncodeQP($str);
+              break;
+          default:
+              $this-&gt;SetError($this-&gt;Lang(&quot;encoding&quot;) . $encoding);
+              break;
+        }
+        return $encoded;
+    }
+
+    /**
+     * Encode a header string to best of Q, B, quoted or none.  
+     * @access private
+     * @return string
+     */
+    function EncodeHeader ($str, $position = 'text') {
+      $x = 0;
+      
+      switch (strtolower($position)) {
+        case 'phrase':
+          if (!preg_match('/[\200-\377]/', $str)) {
+            // Can't use addslashes as we don't know what value has magic_quotes_sybase.
+            $encoded = addcslashes($str, &quot;\0..\37\177\\\&quot;&quot;);
+
+            if (($str == $encoded) &amp;&amp; !preg_match('/[^A-Za-z0-9!#$%&amp;\'*+\/=?^_`{|}~ -]/', $str))
+              return ($encoded);
+            else
+              return (&quot;\&quot;$encoded\&quot;&quot;);
+          }
+          $x = preg_match_all('/[^\040\041\043-\133\135-\176]/', $str, $matches);
+          break;
+        case 'comment':
+          $x = preg_match_all('/[()&quot;]/', $str, $matches);
+          // Fall-through
+        case 'text':
+        default:
+          $x += preg_match_all('/[\000-\010\013\014\016-\037\177-\377]/', $str, $matches);
+          break;
+      }
+
+      if ($x == 0)
+        return ($str);
+
+      $maxlen = 75 - 7 - strlen($this-&gt;CharSet);
+      // Try to select the encoding which should produce the shortest output
+      if (strlen($str)/3 &lt; $x) {
+        $encoding = 'B';
+        $encoded = base64_encode($str);
+        $maxlen -= $maxlen % 4;
+        $encoded = trim(chunk_split($encoded, $maxlen, &quot;\n&quot;));
+      } else {
+        $encoding = 'Q';
+        $encoded = $this-&gt;EncodeQ($str, $position);
+        $encoded = $this-&gt;WrapText($encoded, $maxlen, true);
+        $encoded = str_replace(&quot;=&quot;.$this-&gt;LE, &quot;\n&quot;, trim($encoded));
+      }
+
+      $encoded = preg_replace('/^(.*)$/m', &quot; =?&quot;.$this-&gt;CharSet.&quot;?$encoding?\\1?=&quot;, $encoded);
+      $encoded = trim(str_replace(&quot;\n&quot;, $this-&gt;LE, $encoded));
+      
+      return $encoded;
+    }
+    
+    /**
+     * Encode string to quoted-printable.  
+     * @access private
+     * @return string
+     */
+    function EncodeQP ($str) {
+        $encoded = $this-&gt;FixEOL($str);
+        if (substr($encoded, -(strlen($this-&gt;LE))) != $this-&gt;LE)
+            $encoded .= $this-&gt;LE;
+
+        // Replace every high ascii, control and = characters
+        $encoded = preg_replace('/([\000-\010\013\014\016-\037\075\177-\377])/e',
+                  &quot;'='.sprintf('%02X', ord('\\1'))&quot;, $encoded);
+        // Replace every spaces and tabs when it's the last character on a line
+        $encoded = preg_replace(&quot;/([\011\040])&quot;.$this-&gt;LE.&quot;/e&quot;,
+                  &quot;'='.sprintf('%02X', ord('\\1')).'&quot;.$this-&gt;LE.&quot;'&quot;, $encoded);
+
+        // Maximum line length of 76 characters before CRLF (74 + space + '=')
+        $encoded = $this-&gt;WrapText($encoded, 74, true);
+
+        return $encoded;
+    }
+
+    /**
+     * Encode string to q encoding.  
+     * @access private
+     * @return string
+     */
+    function EncodeQ ($str, $position = &quot;text&quot;) {
+        // There should not be any EOL in the string
+        $encoded = preg_replace(&quot;[\r\n]&quot;, &quot;&quot;, $str);
+
+        switch (strtolower($position)) {
+          case &quot;phrase&quot;:
+            $encoded = preg_replace(&quot;/([^A-Za-z0-9!*+\/ -])/e&quot;, &quot;'='.sprintf('%02X', ord('\\1'))&quot;, $encoded);
+            break;
+          case &quot;comment&quot;:
+            $encoded = preg_replace(&quot;/([\(\)\&quot;])/e&quot;, &quot;'='.sprintf('%02X', ord('\\1'))&quot;, $encoded);
+          case &quot;text&quot;:
+          default:
+            // Replace every high ascii, control =, ? and _ characters
+            $encoded = preg_replace('/([\000-\011\013\014\016-\037\075\077\137\177-\377])/e',
+                  &quot;'='.sprintf('%02X', ord('\\1'))&quot;, $encoded);
+            break;
+        }
+        
+        // Replace every spaces to _ (more readable than =20)
+        $encoded = str_replace(&quot; &quot;, &quot;_&quot;, $encoded);
+
+        return $encoded;
+    }
+
+    /**
+     * Adds a string or binary attachment (non-filesystem) to the list.
+     * This method can be used to attach ascii or binary data,
+     * such as a BLOB record from a database.
+     * @param string $string String attachment data.
+     * @param string $filename Name of the attachment.
+     * @param string $encoding File encoding (see $Encoding).
+     * @param string $type File extension (MIME) type.
+     * @return void
+     */
+    function AddStringAttachment($string, $filename, $encoding = &quot;base64&quot;, 
+                                 $type = &quot;application/octet-stream&quot;) {
+        // Append to $attachment array
+        $cur = count($this-&gt;attachment);
+        $this-&gt;attachment[$cur][0] = $string;
+        $this-&gt;attachment[$cur][1] = $filename;
+        $this-&gt;attachment[$cur][2] = $filename;
+        $this-&gt;attachment[$cur][3] = $encoding;
+        $this-&gt;attachment[$cur][4] = $type;
+        $this-&gt;attachment[$cur][5] = true; // isString
+        $this-&gt;attachment[$cur][6] = &quot;attachment&quot;;
+        $this-&gt;attachment[$cur][7] = 0;
+    }
+    
+    /**
+     * Adds an embedded attachment.  This can include images, sounds, and 
+     * just about any other document.  Make sure to set the $type to an 
+     * image type.  For JPEG images use &quot;image/jpeg&quot; and for GIF images 
+     * use &quot;image/gif&quot;.
+     * @param string $path Path to the attachment.
+     * @param string $cid Content ID of the attachment.  Use this to identify 
+     *        the Id for accessing the image in an HTML form.
+     * @param string $name Overrides the attachment name.
+     * @param string $encoding File encoding (see $Encoding).
+     * @param string $type File extension (MIME) type.  
+     * @return bool
+     */
+    function AddEmbeddedImage($path, $cid, $name = &quot;&quot;, $encoding = &quot;base64&quot;, 
+                              $type = &quot;application/octet-stream&quot;) {
+    
+        if(!@is_file($path))
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;file_access&quot;) . $path);
+            return false;
+        }
+
+        $filename = basename($path);
+        if($name == &quot;&quot;)
+            $name = $filename;
+
+        // Append to $attachment array
+        $cur = count($this-&gt;attachment);
+        $this-&gt;attachment[$cur][0] = $path;
+        $this-&gt;attachment[$cur][1] = $filename;
+        $this-&gt;attachment[$cur][2] = $name;
+        $this-&gt;attachment[$cur][3] = $encoding;
+        $this-&gt;attachment[$cur][4] = $type;
+        $this-&gt;attachment[$cur][5] = false; // isStringAttachment
+        $this-&gt;attachment[$cur][6] = &quot;inline&quot;;
+        $this-&gt;attachment[$cur][7] = $cid;
+    
+        return true;
+    }
+    
+    /**
+     * Returns true if an inline attachment is present.
+     * @access private
+     * @return bool
+     */
+    function InlineImageExists() {
+        $result = false;
+        for($i = 0; $i &lt; count($this-&gt;attachment); $i++)
+        {
+            if($this-&gt;attachment[$i][6] == &quot;inline&quot;)
+            {
+                $result = true;
+                break;
+            }
+        }
+        
+        return $result;
+    }
+
+    /////////////////////////////////////////////////
+    // MESSAGE RESET METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Clears all recipients assigned in the TO array.  Returns void.
+     * @return void
+     */
+    function ClearAddresses() {
+        $this-&gt;to = array();
+    }
+
+    /**
+     * Clears all recipients assigned in the CC array.  Returns void.
+     * @return void
+     */
+    function ClearCCs() {
+        $this-&gt;cc = array();
+    }
+
+    /**
+     * Clears all recipients assigned in the BCC array.  Returns void.
+     * @return void
+     */
+    function ClearBCCs() {
+        $this-&gt;bcc = array();
+    }
+
+    /**
+     * Clears all recipients assigned in the ReplyTo array.  Returns void.
+     * @return void
+     */
+    function ClearReplyTos() {
+        $this-&gt;ReplyTo = array();
+    }
+
+    /**
+     * Clears all recipients assigned in the TO, CC and BCC
+     * array.  Returns void.
+     * @return void
+     */
+    function ClearAllRecipients() {
+        $this-&gt;to = array();
+        $this-&gt;cc = array();
+        $this-&gt;bcc = array();
+    }
+
+    /**
+     * Clears all previously set filesystem, string, and binary
+     * attachments.  Returns void.
+     * @return void
+     */
+    function ClearAttachments() {
+        $this-&gt;attachment = array();
+    }
+
+    /**
+     * Clears all custom headers.  Returns void.
+     * @return void
+     */
+    function ClearCustomHeaders() {
+        $this-&gt;CustomHeader = array();
+    }
+
+
+    /////////////////////////////////////////////////
+    // MISCELLANEOUS METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Adds the error message to the error container.
+     * Returns void.
+     * @access private
+     * @return void
+     */
+    function SetError($msg) {
+        $this-&gt;error_count++;
+        $this-&gt;ErrorInfo = $msg;
+    }
+
+    /**
+     * Returns the proper RFC 822 formatted date. 
+     * @access private
+     * @return string
+     */
+    function RFCDate() {
+        $tz = date(&quot;Z&quot;);
+        $tzs = ($tz &lt; 0) ? &quot;-&quot; : &quot;+&quot;;
+        $tz = abs($tz);
+        $tz = ($tz/3600)*100 + ($tz%3600)/60;
+        $result = sprintf(&quot;%s %s%04d&quot;, date(&quot;D, j M Y H:i:s&quot;), $tzs, $tz);
+
+        return $result;
+    }
+
+    /**
+     * Returns Received header for message tracing. 
+     * @access private
+     * @return string
+     */
+    function Received() {
+        if ($this-&gt;ServerVar('SERVER_NAME') != '')
+        {
+            $protocol = ($this-&gt;ServerVar('HTTPS') == 'on') ? 'HTTPS' : 'HTTP';
+            $remote = $this-&gt;ServerVar('REMOTE_HOST');
+            if($remote == &quot;&quot;)
+                $remote = 'phpmailer';
+            $remote .= ' (['.$this-&gt;ServerVar('REMOTE_ADDR').'])';
+        }
+        else
+        {
+            $protocol = 'local';
+            $remote = $this-&gt;ServerVar('USER');
+            if($remote == '')
+                $remote = 'phpmailer';
+        }
+
+        $result = sprintf(&quot;Received: from %s %s\tby %s &quot; .
+                          &quot;with %s (PHPMailer);%s\t%s%s&quot;, $remote, $this-&gt;LE,
+                          $this-&gt;ServerHostname(), $protocol, $this-&gt;LE,
+                          $this-&gt;RFCDate(), $this-&gt;LE);
+
+        return $result;
+    }
+    
+    /**
+     * Returns the appropriate server variable.  Should work with both 
+     * PHP 4.1.0+ as well as older versions.  Returns an empty string 
+     * if nothing is found.
+     * @access private
+     * @return mixed
+     */
+    function ServerVar($varName) {
+        global $HTTP_SERVER_VARS;
+        global $HTTP_ENV_VARS;
+
+        if(!isset($_SERVER))
+        {
+            $_SERVER = $HTTP_SERVER_VARS;
+            if(!isset($_SERVER[&quot;REMOTE_ADDR&quot;]))
+                $_SERVER = $HTTP_ENV_VARS; // must be Apache
+        }
+        
+        if(isset($_SERVER[$varName]))
+            return $_SERVER[$varName];
+        else
+            return &quot;&quot;;
+    }
+
+    /**
+     * Returns the server hostname or 'localhost.localdomain' if unknown.
+     * @access private
+     * @return string
+     */
+    function ServerHostname() {
+        if ($this-&gt;Hostname != &quot;&quot;)
+            $result = $this-&gt;Hostname;
+        elseif ($this-&gt;ServerVar('SERVER_NAME') != &quot;&quot;)
+            $result = $this-&gt;ServerVar('SERVER_NAME');
+        else
+            $result = &quot;localhost.localdomain&quot;;
+
+        return $result;
+    }
+
+    /**
+     * Returns a message in the appropriate language.
+     * @access private
+     * @return string
+     */
+    function Lang($key) {
+        if(count($this-&gt;language) &lt; 1)
+            $this-&gt;SetLanguage(&quot;en&quot;); // set the default language
+    
+        if(isset($this-&gt;language[$key]))
+            return $this-&gt;language[$key];
+        else
+            return &quot;Language string failed to load: &quot; . $key;
+    }
+    
+    /**
+     * Returns true if an error occurred.
+     * @return bool
+     */
+    function IsError() {
+        return ($this-&gt;error_count &gt; 0);
+    }
+
+    /**
+     * Changes every end of line from CR or LF to CRLF.  
+     * @access private
+     * @return string
+     */
+    function FixEOL($str) {
+        $str = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $str);
+        $str = str_replace(&quot;\r&quot;, &quot;\n&quot;, $str);
+        $str = str_replace(&quot;\n&quot;, $this-&gt;LE, $str);
+        return $str;
+    }
+
+    /**
+     * Adds a custom header. 
+     * @return void
+     */
+    function AddCustomHeader($custom_header) {
+        $this-&gt;CustomHeader[] = explode(&quot;:&quot;, $custom_header, 2);
+    }
+}
+
+?&gt;

Added: trunk/colofon.php
===================================================================
--- trunk/colofon.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/colofon.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,87 @@
+&lt;?php require_once(&quot;template_header.php&quot;);?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Colofon&lt;/h1&gt;
+				
+				&lt;h1 class=&quot;small&quot;&gt;Marten Timan&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				besloot na zijn studie Multimedia Design &amp; Technology aan de Saxion Hogeschool
+				Enschede een Masters diploma aan de HKU te Hilversum te behalen met zijn project &quot;Simuze&quot;. Hij zette zijn afstudeerproject voort met enkele andere enthousiastelingen, en dat is inmiddels een voltijd baan geworden. Verder is Marten nog actief als bassist bij de band &lt;a href=&quot;<A HREF="http://www.wevsdeath.nl">http://www.wevsdeath.nl</A>&quot;&gt;We vs Death&lt;/a&gt; en toert behoorlijk wat af. Marten is een pragmatische idealist en zou zonder muziek niet kunnen leven.
+				&lt;/p&gt;
+				
+				&lt;br /&gt;&lt;br /&gt;
+				&lt;h1 class=&quot;small&quot;&gt;Bj&#246;rn Wijers&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				is Interaction Developer bij Waag Society te Amsterdam en houdt zich daar bezig met alle facetten van Nieuwe Media, van concept tot implementatie. Zowel binnen als buiten Waag Society is Bj&#246;rn betrokken bij de politieke, sociale, culturele en maatschappelijke kanten van software en media. Dit komt o.a. tot uiting in zijn betrokkenheid bij Creative Commons Nederland. Bj&#246;rn is een echte informatie- en muziek junk die vegetarisch voedsel toch wel het lekkerste vindt. Hij vindt stukjes schrijven in de derde persoon maar vreemd...:)	
+				&lt;/p&gt;
+				
+				&lt;br /&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Simuze is mede mogelijk gemaakt door:
+				&lt;/p&gt;
+				&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; bgcolor=&quot;#FDE8B5&quot;&gt;
+				&lt;tr&gt;
+					&lt;td&gt;
+					&lt;br /&gt;
+					&lt;h1 class=&quot;small&quot;&gt;Digitale Pioniers&lt;/h1&gt;
+					&lt;/td&gt;
+					&lt;td width=&quot;200px&quot;&gt;
+					&lt;/td&gt;
+				&lt;/tr&gt;
+				&lt;tr&gt;
+					&lt;td&gt;
+						&lt;p class=&quot;small&quot;&gt;
+						Stimuleringsregeling Digitale Pioniers heeft de afgelopen twee jaar uit 675 aanvragen uiteindelijk 100 kleinschalige maatschappelijke organisaties geselecteerd en ondersteund. De regeling richtte zich op vernieuwende internetinitiatieven die bijdragen aan participatie, meningsvorming en informatie-uitwisseling in het publieke domein.&lt;br /&gt;
+						website: &lt;a href=&quot;<A HREF="http://www.digitalepioniers.nl">http://www.digitalepioniers.nl</A>&quot;&gt;<A HREF="http://www.digitalepioniers.nl&lt;/a">http://www.digitalepioniers.nl&lt;/a</A>&gt;
+						&lt;/p&gt;
+					&lt;/td&gt;
+					&lt;td&gt;
+						&lt;img src=&quot;img/images/DP_logo.gif&quot; alt=&quot;Digitale Pioniers&quot; class=&quot;alignleft&quot; /&gt;
+					&lt;/td&gt;
+				&lt;/tr&gt;
+				&lt;tr&gt;
+					&lt;td&gt;
+					&lt;br /&gt;
+					&lt;h1 class=&quot;small&quot;&gt;XS4all&lt;/h1&gt;
+					&lt;/td&gt;
+					&lt;td width=&quot;200px&quot;&gt;
+					&lt;/td&gt;
+				&lt;/tr&gt;
+				&lt;tr&gt;
+					&lt;td&gt;
+					&lt;p class=&quot;small&quot;&gt;
+					Gezond eigenwijs en een tikje rebels. Technisch zeer betrouwbaar en met een sterk gevoel voor privacy en security. Op 1 mei 1993 ging XS4ALL open voor het publiek en was de eerste ISP in
+					Nederland een feit. In korte tijd heeft XS4ALL een enorme groei doorgemaakt.
+					Inmiddels zijn er ruim 200 medewerkers in dienst. Bijzonder is dat de organisatie
+					haar maatschappelijk gezicht en informele werkcultuur heeft weten te behouden.&lt;br /&gt;
+					website: &lt;a href=&quot;<A HREF="http://www.xs4all.nl">http://www.xs4all.nl</A>&quot;&gt;<A HREF="http://www.xs4all.nl&lt;/a">http://www.xs4all.nl&lt;/a</A>&gt;
+					&lt;/td&gt;
+					&lt;td&gt;
+						&lt;img src=&quot;img/images/xs4all_60mm.gif&quot; alt=&quot;XS4all&quot; class=&quot;alignleft&quot; /&gt;
+					&lt;/td&gt;
+				&lt;/tr&gt;
+				&lt;/table&gt;
+						
+	
+				
+				
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;a name=&quot;copyright&quot;&gt;Auteursrecht&lt;/a&gt;
+				Stichting Open Media (StOM) 
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;!-- Creative Commons Licentie --&gt;
+				&lt;a rel=&quot;license&quot; href=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-nd/2.0/nl/">http://creativecommons.org/licenses/by-nc-nd/2.0/nl/</A>&quot;&gt;&lt;img alt=&quot;Creative Commons Licentie&quot; border=&quot;0&quot; src=&quot;<A HREF="http://creativecommons.org/images/public/somerights20.gif">http://creativecommons.org/images/public/somerights20.gif</A>&quot; /&gt;&lt;/a&gt;&lt;br /&gt;
+				Op dit werk is de &lt;a rel=&quot;license&quot; href=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-nd/2.0/nl/">http://creativecommons.org/licenses/by-nc-nd/2.0/nl/</A>&quot;&gt;Creative Commons Licentie&lt;/a&gt; van toepassing.
+				&lt;!-- /Creative Commons Licentie --&gt;
+			
+				&lt;/p&gt;
+				
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require_once(&quot;template_sidebar_footer.php&quot;);?&gt;
\ No newline at end of file

Added: trunk/confirm.php
===================================================================
--- trunk/confirm.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/confirm.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,55 @@
+&lt;?php
+// +----------------------------------------------------------------------+
+// | Simuze                                                                              |
+// +----------------------------------------------------------------------+
+// | Copyright (c) 2004 Stichting Open Media or noted otherwise           |
+// +----------------------------------------------------------------------+
+// | License: See below code                                                        |
+// +----------------------------------------------------------------------+
+// | Author(s): Bjorn Wijers &lt;bwijers[AT]bdisfunctional[DOT]net&gt;        |
+// |                                                                                         |
+// +----------------------------------------------------------------------+
+//
+
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+
+// retrieve the md5 hash from the url
+// and set it as a hidden input.
+if($_GET['confirm']) { 
+    $confirm = strtolower(trim($_GET['confirm']));
+    if(CheckInputValid($confirm)) {
+        $code = $confirm;
+    } else {
+        $code = &quot;&quot;;
+    }
+}    
+?&gt;
+&lt;?php require_once(&quot;template_header.php&quot;);?&gt;
+
+	&lt;div id=&quot;container&quot;&gt;
+		&lt;div id=&quot;content&quot;&gt;
+			&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1 class=&quot;wide&quot;&gt;Bevestigen registratie&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Bevestig hier je registratie voor Simuze, door nogmaals in te loggen.
+				&lt;/p&gt;
+				&lt;form action=&quot;sm-confirm.php&quot; method=&quot;post&quot; name=&quot;confirm&quot; id=&quot;confirm&quot;&gt;
+				&lt;div class=&quot;roundcont&quot;&gt;
+					&lt;div class=&quot;roundtop&quot;&gt;&lt;/div&gt;
+					&lt;p class=&quot;space&quot;&gt;&lt;/p&gt;
+						&lt;fieldset&gt;
+							&lt;label for=&quot;uname&quot;&gt;gebruikersnaam:&lt;/label&gt; 
+							&lt;input type=&quot;text&quot; id=&quot;uname&quot; name=&quot;uname&quot; maxlength=&quot;16&quot; size=&quot;25&quot; class=&quot;form_tekstveld&quot; /&gt; 
+							&lt;label for=&quot;password&quot;&gt;wachtwoord:&lt;/label&gt; 
+							&lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; maxlength=&quot;16&quot; size=&quot;25&quot; class=&quot;form_tekstveld&quot; /&gt;
+							&lt;input type=&quot;hidden&quot; value=&quot;&lt;?php echo &quot;$code&quot;; ?&gt;&quot; name=&quot;confirm_code&quot; /&gt;
+						&lt;/fieldset&gt;
+					&lt;div class=&quot;roundbottom&quot;&gt;&lt;/div&gt;
+				&lt;/div&gt;	
+				&lt;p&gt;&lt;input type=&quot;image&quot; class=&quot;btn_big&quot; src=&quot;img/images/bevestig_btn.gif&quot; name=&quot;confirm&quot; alt=&quot;bevestig je aanmelding&quot; value=&quot;true&quot;  /&gt;&lt;/p&gt;		
+				&lt;/form&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+	
+&lt;?php require_once(&quot;template_sidebar_footer.php&quot;);?&gt;

Added: trunk/disclaimer.php
===================================================================
--- trunk/disclaimer.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/disclaimer.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,44 @@
+&lt;?php require_once(&quot;template_header.php&quot;);?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Disclaimer&lt;/h1&gt;
+				&lt;h2&gt;Auteursrecht&lt;/h2&gt;
+				&lt;p class=&quot;wide&quot;&gt;
+					Alle auteursrechten en andere intellectuele eigendomsrechten 
+					met betrekking tot de informatie die deze site bevat 
+					(waaronder maar niet beperkt tot tekst, muziek, afbeeldingen en software) 
+					zijn eigendom van Stichting Open Media of zijn opgenomen met toestemming 
+					van de desbetreffende rechthebbende en vallen onder de Creative Commons licentie 
+					(&lt;a href=&quot;<A HREF="http://creativecommons.org/licenses/by-nd-nc/2.0/nl/">http://creativecommons.org/licenses/by-nd-nc/2.0/nl/</A>&quot;&gt;<A HREF="http://creativecommons.org/licenses/by-nd-nc/2.0/nl/&lt;/a">http://creativecommons.org/licenses/by-nd-nc/2.0/nl/&lt;/a</A>&gt;), 
+					behalve waar anders vermeld, met de volgende voorwaarden:
+					
+					&lt;ul&gt;
+						&lt;li&gt;Naamsvermelding&lt;/li&gt;
+						&lt;li&gt;Geen Afgeleide Werken&lt;/li&gt;
+						&lt;li&gt;Niet Commercieel&lt;/li&gt;
+					&lt;/ul&gt;	
+					 
+					Alles van deze site mag worden verveelvoudigd of openbaar gemaakt,
+					in welke vorm of op welke wijze dan ook, of worden opgeslagen in een geautomatiseerd (gegevens) bestand,
+					mits de bepalingen van bovengenoemde licentie Creative Commons Licentie 
+					(&lt;a href=&quot;<A HREF="http://creativecommons.org/licenses/by-nd-nc/2.0/nl/">http://creativecommons.org/licenses/by-nd-nc/2.0/nl/</A>&quot;&gt;<A HREF="http://creativecommons.org/licenses/by-nd-nc/2.0/nl/&lt;/a">http://creativecommons.org/licenses/by-nd-nc/2.0/nl/&lt;/a</A>&gt;) worden 
+					nageleefd, behalve daar waar anders anders vermeld. 
+				&lt;/p&gt;
+				&lt;br /&gt;&lt;br /&gt;
+				&lt;h2&gt;Afwijzing van aansprakelijkheid&lt;/h2&gt;
+				&lt;p class=&quot;wide&quot;&gt;
+					Stichting Open Media streeft naar een zo zorgvuldig mogelijk beheer
+					van deze site, maar kan geen onmiddellijke controle uitoefenen op het materiaal 
+					dat derden publiceren via deze site. Beweringen en meningen, geuit op deze site zijn die van de betreffende gebruiker(s)
+					en niet (noodzakelijkerwijs) die van Stichting Open Media. Stichting Open Media
+					aanvaardt geen aansprakelijkheid voor schade, welke dan ook, die het gevolg is van onjuistheid
+					en/of onrechtmatigheid (inclusief onrechtmatig gebruik) van het materiaal dat derden op de site publiceren.
+				&lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+	&lt;?php require_once(&quot;template_sidebar_footer.php&quot;);?&gt;
\ No newline at end of file

Added: trunk/faq.php
===================================================================
--- trunk/faq.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/faq.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,156 @@
+&lt;?php require_once(&quot;template_header.php&quot;);?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				
+				
+				&lt;h1&gt; Enkele veel gestelde vragen:&lt;/h1&gt;&lt;br /&gt;	
+				&lt;p class=&quot;space&quot;&gt;	
+		
+				&lt;a href=&quot;faq.php#watissimuze&quot;&gt;Wat is Simuze?&lt;/a&gt;&lt;br /&gt;	
+				&lt;a href=&quot;faq.php#watisoc&quot;&gt;Wat is Open Content?&lt;/a&gt;&lt;br /&gt;
+				&lt;a href=&quot;faq.php#watdoetsimuze&quot;&gt;Wat is het doel van Simuze?&lt;/a&gt;&lt;br /&gt;
+				&lt;a href=&quot;faq.php#waaromviasimuze&quot;&gt;Waarom via Simuze?&lt;/a&gt;&lt;br /&gt;
+				&lt;a href=&quot;faq.php#muzikant&quot;&gt;Muziek uploaden onder mijn eigen voorwaarden?&lt;/a&gt;&lt;br /&gt;
+				&lt;a href=&quot;faq.php#verspreiden&quot;&gt;Kan ik de muziek op Simuze gratis en legaal downloaden EN verspreiden?&lt;/a&gt;&lt;br /&gt;
+				&lt;a href=&quot;faq.php#waaromvrijgeven&quot;&gt;Waarom zou ik een deel van mijn rechten vrijgeven als muzikant?&lt;/a&gt;&lt;br /&gt;
+				&lt;a href=&quot;faq.php#voorwaarden&quot;&gt;Wat zijn de voorwaarden van het gebruik van Simuze?&lt;/a&gt;&lt;br /&gt;
+				&lt;a href=&quot;faq.php#bumastemra&quot;&gt;Buma/Stemra en Simuze?&lt;/a&gt;
+		
+				
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;&nbsp;&lt;/p&gt;
+				
+				
+			
+			&lt;a name=&quot;watissimuze&quot;&gt;&lt;/a&gt;	
+			&lt;h2&gt;Wat is Simuze?&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Simuze is een open content muziek community voor muzikanten en muziekliefhebbers. Het is een plek waar muziek gratis wordt aangeboden door onafhankelijke muzikanten, en waar je als gebruiker makkelijk nieuwe muziek kan vinden die je gratis kan downloaden of beluisteren. Simuze stimuleert het downloaden en gebruiken van de aangeboden muziek en maakt geen onderscheid in genres. 
+				&lt;/p&gt;
+			
+				
+				&lt;a name=&quot;watisoc&quot;&gt;&lt;/a&gt;
+				&lt;h2&gt;Wat is Open Content?&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+		
+				Open Content in deze context kan het beste worden omschreven als content dat gepubliceerd 
+				wordt met de intentie dat anderen het gratis kunnen distribueren en/of gebruiken. Open Content licenties zorgen ervoor dat je wel bepaalde rechten behoudt maar het mogelijk maakt voor anderen om je werk gratis te verspreiden. Een organisatie die Open Content licenties gratis publiceert is &lt;a href=&quot;<A HREF="http://www.creativecommons.nl">http://www.creativecommons.nl</A>&quot;&gt;Creative Commons&lt;/a&gt;. 
+			
+			&lt;a name=&quot;watdoetsimuze&quot;&gt;&lt;/a&gt;	
+			&lt;h2&gt;Wat is het doel van Simuze?&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				 Het doel van Simuze is om de naam en muziek van de artiest optimaal te verspreiden,
+				 en om muzikant en muziekliefhebber dichter bij elkaar te brengen. De katalysator 
+				 van de community is een radiostation waar elke gebruiker van de aangeboden muziek 
+				 op Simuze zijn eigen playlists kan samenstellen, afspelen en delen. Simuze biedt iedere gebruiker de de mogelijkheid om persoonlijke informatie op te slaan en een eigen profiel te cre&#235;ren.  
+				&lt;/p&gt;
+				
+				
+			&lt;a name=&quot;muzikant&quot;&gt;&lt;/a&gt;	
+			&lt;h2&gt;Muziek uploaden onder mijn eigen voorwaarden?&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Elke gebruiker kan muziek uploaden onder een
+				licentie naar eigen keuze. Deze licenties, vrijgegeven door de organisatie 
+				&lt;a href=&quot;<A HREF="http://www.creativecommons.nl">http://www.creativecommons.nl</A>&quot;&gt;Creative Commons&lt;/a&gt;, bestaan uit een combinatie 
+				van aantal condities waarin je aangeeft welke rechten je over je werk wil behouden.
+				Je &lt;b&gt;naam&lt;/b&gt; moet altijd worden vermeld bij publicatie. Verder kun je aangeven 
+				of het werk &lt;b&gt;commercieel&lt;/b&gt; gebruikt mag worden, of het &lt;b&gt;bewerkt &lt;/b&gt;mag worden en zo ja, of het 
+				onder &lt;b&gt;dezelfde licentie&lt;/b&gt; moet vallen als waaronder je het werk hebt vrijgegeven. 
+				Deze meer open vorm van auteursrecht is volledig rechtsgeldig, en beschermt de 
+				artiest dus ook tegen uitbuiting. Simuze is ervan overtuigd dat deze licenties 
+				meer mogelijkheden bieden voor onafhankelijke muzikanten voor distributie en promotie 
+				van hun werk ten opzichte van de volledig beschermde ('alle rechten voorbehouden') vorm van auteursrecht.  
+				&lt;/p&gt;
+			
+			&lt;a name=&quot;verspreiden&quot;&gt;&lt;/a&gt;	
+			&lt;h2&gt;Kan ik de muziek op Simuze gratis en legaal downloaden EN verspreiden?&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Ja, zolang je je houdt aan de voorwaarden van de &lt;a href=&quot;<A HREF="http://www.creativecommons.nl">http://www.creativecommons.nl</A>&quot;&gt;Creative Commons&lt;/a&gt; licentie van het nummer. Elk icoon dat achter een nummer staat vermeld staat voor een voorwaarde. Er zijn vier verschillende voorwaarden, die gecombineerd kunnen worden tot zes verschillende soorten licenties. Zolang je het werk alleen maar download en verspreid (en er GEEN geld aan verdient of gebruikt/remixed in een ander werk) is het belangrijk dat je de NAAM van de artiest vermeld. Is dat alles? Dat is alles.  
+				&lt;/p&gt;
+			
+			
+				
+				
+			&lt;a name=&quot;waaromviasimuze&quot;&gt;&lt;/a&gt;	 
+			&lt;h2&gt;Waarom via Simuze?&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Simuze is een centrale plek waar mensen jouw muziek kunnen vinden, en jij anderen kunt 
+				vinden met dezelfde muzieksmaak of -stijl. Je kan elkaars werk remixen of uitvoeren,
+				en er kunnen zo samenwerkingen ontstaan met muzikanten. Je cre&#235;ert je eigen netwerk,
+				en kan via je playlists makkelijk in contact komen met (andere) muzikanten.
+				&lt;/p&gt;
+			
+			&lt;a name=&quot;waaromvrijgeven&quot;&gt;&lt;/a&gt;		
+			&lt;h2&gt;Waarom zou ik een deel van mijn rechten vrijgeven als muzikant?&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+		
+				 Het effectief distribueren van je muziek (en je naam) is een van de belangrijkste
+				 en de moeilijkste taken als muzikant. Met de opkomst van het Internet is voor het
+				 eerst globale communicatie mogelijk, en zijn er voor de muzikant meer mogelijkheden 
+				 ontstaan om zijn muziek te verspreiden zonder de noodzaak van een platenmaatschappij. 
+				 &lt;/p&gt;  
+				 &lt;p class=&quot;space&quot;&gt;
+				 Elk werk dat tegenwoordig digitaal gepubliceerd wordt (ook op het Internet) valt onder volledig copyright van de maker, en maakt het gebruik door anderen ervan illegaal. De reden dat Kazaa, Napster en vele individuen die van file-sharing applicaties gebruik maakten zijn aangeklaagd, is dat ze content 
+				 onder volledig copyright deelden of dit mogelijk maakten.
+				 &lt;/p&gt;
+				 &lt;p class=&quot;space&quot;&gt;
+				 Door een meer open vorm van copyright aan te nemen stimuleer je het gebruik en de 
+				 distributie van je muziek in plaats van dit tegen te gaan. De rechten die je behoudt 
+				 zorgen ervoor dat je naam verbonden blijft aan de muziek, of het werk wat uit je muziek 
+				 voortkomt. 
+				 &lt;/p&gt;
+				 
+			&lt;a name=&quot;bumastemra&quot;&gt;&lt;/a&gt;		
+			&lt;h2&gt;Buma/Stemra en Simuze?&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Als je ingeschreven staat bij &lt;a href=&quot;<A HREF="http://www.bumastemra.nl">http://www.bumastemra.nl</A>&quot;&gt;BUMA/STEMRA&lt;/a&gt; 
+				kun je je niet inschrijven bij Simuze. Op het moment dat je een contract ondertekend met BUMA/STEMRA
+				draag je je exploitatierecht over je muziek volledige over aan BUMA/STEMRA.
+				Dat betekent dat je geen zeggenschap meer hebt over de exploitatie van je muziek,
+				en dus ook niet meer volledig vrij bent om te doen met jouw eigen muziek wat je wilt.
+				Een artiest die zich inschrijft bij Simuze adopteert automatisch een Creative Commons licentie 
+				(naar eigen keuze) over zijn werk. Een artiest die ingeschreven staat bij BUMA/STEMRA zou dan in essentie 
+				contractbreuk plegen en kan daarom dus niet zijn muziek op Simuze zetten. 				
+	     		&lt;/p&gt;
+				
+				&lt;p class=&quot;space&quot;&gt;
+					&lt;em&gt;Wat als je nu wel je muziek op Simuze wilt zetten?&lt;/em&gt;&lt;br /&gt;&lt;br /&gt;
+					&lt;strong&gt;LET OP DIT IS GEEN JURIDISCH ADVIES! WIL JE JURIDISCH ADVIES NEEM CONTACT OP MET EEN ADVOCAAT&lt;/strong&gt;&lt;br /&gt;&lt;br /&gt;
+					
+					We raden je dan aan NIET lid te worden van BUMA/STEMRA zolang dit systeem van alles of niets bestaat. Ben je al 
+					wel lid van BUMA/STEMRA dan raden we je aan om BUMA/STEMRA te verzoeken haar contracten aan te passen aan de huidige tijd
+					waarbij het alles of niets systeem wordt geschrapt en de muzikant de keuze heeft om het oude systeem of nieuwe vormen zoals
+					Creative Commons licenties te gebruiken voor de bescherming van zijn of haar werken. Totdat BUMA/STEMRA haar contracten aanpast
+				    raden we je aan je lidmaatschap op te zeggen en de zeggenschap over je muziek terug te claimen.
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+					Wil of kun je dit advies niet opvolgen, maar wil je wel je muziek op Simuze plaatsen dan is er ook de mogelijkheid 
+					om schriftelijk teostemming te vragen om een uitzondering te maken op het exploitatie contract zoals dat door BUMA/STEMRA wordt
+					gehanteerd. Dit staat letterlijk vermeld in de exploitatiecontracten (als vaststeld d.d. 14 oktober 1992) van BUMA en STEMRA bij artikel 8 lid 3:
+				&lt;/p&gt;
+					&lt;blockquote&gt;
+						&quot;In afwijking van van het in lid 1 bepaalde kan Buma in door haar schriftelijk
+						bekend gemaakte uitzonderingsgevallen dan wel na schriftelijke overeenkomst met de auteur,
+						de auteur toestemming verlenen het aan Buma overgedragen muziekauteursrecht zelf te exploiteren en te handhaven&quot;
+					&lt;/blockquote&gt;
+				&lt;p class=&quot;space&quot;&gt;	
+					We stellen het op prijs als je ons op de hoogte stelt als je ervoor kiest je lidmaatschap op te zeggen en de eventuele reactie die
+					je hebt gekregen van BUMA/STEMRA. &lt;br /&gt;&lt;br /&gt;
+					
+					NB: We zijn NIET tegen BUMA/STEMRA. We zijn voor keuzevrijheid.
+				&lt;/p&gt;
+			&lt;a name=&quot;voorwaarden&quot;&gt;&lt;/a&gt;		
+			&lt;h2&gt;Wat zijn de voorwaarden van het gebruik van Simuze?&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+					Net zoals zovele andere initatieven heeft Simuze ook bepaalde voorwaarden. Deze staan beschreven in de 
+					&lt;a href=&quot;voorwaarden.php&quot; title=&quot;Simuze voorwaarden&quot;&gt;voorwaarden&lt;/a&gt; en &lt;a href=&quot;disclaimer.php&quot; title=&quot;Simuze disclaimer&quot;&gt;disclaimer&lt;/a&gt;. 
+	     		&lt;/p&gt; 
+				
+				
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/forms.css
===================================================================
--- trunk/forms.css	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/forms.css	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,307 @@
+fieldset
+{
+	display:block;
+	margin:0px 0px 15px 0px;
+	padding:0px;
+	border:none;
+}
+
+fieldset&gt;input
+{
+	float:left;
+}
+
+#zoekdiv
+{
+	margin:0px 0px 0px 0px;
+	padding:0px 0px 0px 0px;
+}
+
+#searchform 
+{
+margin: 0px ;
+margin-right: 2px;
+padding: 0px; 
+text-align: right;
+}
+
+#searchform #s 
+{
+background-color: #F7F3E7; 	
+border: 1px solid #990101;		
+margin: 0px;
+padding: 0px;
+color: #000;
+height: 14px;
+width: 150px;
+font-family: 'Trebuchet MS','Verdana','Times New Roman';
+font-size:8pt;
+}
+
+
+input.submit 
+{
+	padding: 0px;
+	margin: 0px;
+}
+
+#searchsubmit 
+{
+	border: 0px;			
+	color: #F7F3E7;
+	background: transparent;
+	padding: 0px;
+	height: 15px;
+	margin: 0px 0px 0px 0px;
+	margin-left: 5px;
+	margin-bottom: -3px;
+}
+
+
+form
+{
+	margin:0px;
+	padding:0px;
+}
+
+.zoek
+{
+	margin:0px;
+	padding:0px;
+}
+
+.register
+{
+	background: url(&quot;img/images/bg_registerform.gif&quot;) no-repeat top left;
+	margin:0px;
+	padding:0px;
+	width: 350px;
+	height: 200px;
+}
+
+input
+{
+	margin: 0px;
+	padding: 0px;
+	color: #000;
+}
+
+
+
+
+.form_tekstveld
+{
+	font-family: Verdana, sans-serif;
+	font-size: 11px;
+	border:1px solid #000;
+	display:block;
+	margin:3px;
+	padding:0px;
+	clear:right;
+}
+
+.form_checkbox
+{
+	border: 0px solid #000;
+	margin: 0px 5px 0px 0px;
+	padding: 0px 0px 0px 0px
+}
+
+.input_sidebar
+{
+	font-family: Verdana, sans-serif;
+	font-weight: normal;
+	font-size: 11px;
+	border:1px solid #000;
+	background-color: #F7F3E7;
+	color: #000;
+	display:block;
+	margin:3px;
+	margin-left: 10px;
+	padding:0px;
+	clear:right;
+	width: 110px;
+}
+
+.bio
+{
+	font-family: Verdana, sans-serif;
+	font-size: 11px;
+	padding:0px;
+	display:block;
+	margin:3px;
+	margin-left:190px;
+	padding:0px;
+	clear:right;
+}
+
+
+.upload
+{
+	font-family: Verdana, sans-serif;
+	font-size: 11px;
+	padding:0px;
+	display:block;
+	margin:3px;
+	padding:0px;
+	clear:right;
+}
+
+
+label
+{
+	display: block;
+	float:left;
+	clear:left;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 10px;
+	width: 100px;
+}
+
+label.wijd
+{
+	display: block;
+	float:left;
+	clear:left;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 10px;
+	width: 128px;
+}
+
+label.commentaar
+{
+	display: block;
+	float:left;
+	clear:left;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 10px;
+	width: 75px;
+}
+
+label.profiel
+{
+	display: block;
+	float:left;
+	clear:left;
+	margin: 0px 0px 0px 30px;
+	margin-left: 10px;
+	margin-right: 75px;
+	padding: 0px;
+	width: 100px;
+}
+
+label.zoekknop
+{
+	float:right;
+	clear:left;
+	margin: -13px 0px 0px 0px;
+	padding: 0px;
+	width: 40px;
+}
+
+select, file
+{
+	font-family: Verdana, sans-serif;
+	font-size: 11px;
+	border: 1px solid #000;
+	padding: 0px;
+	clear: right;
+	float: left;
+	margin:3px;
+}
+
+
+
+.btn
+{
+	display: block;
+	margin: 0px 0px .3em;
+	margin-right: 113px;
+	width: 100px;
+	height: 25px;
+}
+
+.btn_big
+{
+	display: block;
+	margin: 0px 0px .3em;
+	margin-right: 113px;
+	width: 200px;
+	height: 25px;
+}
+
+.profile_btn
+{
+	margin-right: 113px;
+	width: 100px;
+	height: 25px;
+}
+
+.commentaar_btn
+{
+	margin: 0px;
+	padding: 0px;
+	width: 150px;
+	height: 20px;
+}
+
+textarea, select, file
+{
+	border: 1px solid #000;
+	margin: 3px;
+}
+
+
+.hidden
+{
+	visibility: hidden;
+	height: 0px;
+	width: 0px;
+	padding: 0px 0px 0px 0px;
+	margin: 00px 0px 0px 0px;
+}
+
+
+.visible
+{
+	visibility: visible;
+}
+
+.entry form { /* This is mainly for password protected posts, makes them look better. */
+text-align:center;
+}
+
+/* de submit button bij het commentformulier */
+#commentform input
+{
+padding: 0px;
+margin: 0px 0px 0px 0px;
+}
+
+.commentaar_input
+{
+	font-family: Verdana, sans-serif;
+	font-size: 11px;
+	border:1px solid #000;
+	height:15px;
+	padding: 0px;
+	margin: 0px 0px 4px 10px;
+}
+
+#commentform textarea 
+{
+/* width moet op 468 staan anders verschuift het persoonlijke menu in exploder */
+width: 448px;
+padding: 0px;
+margin: 0px;	
+}
+
+#commentform #submit 
+{
+background-color: #81A3AB;
+color: #fff;
+margin: 0px;
+padding: 0px;
+float: right;
+}
+

Added: trunk/help/aanmelden.php
===================================================================
--- trunk/help/aanmelden.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/help/aanmelden.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,31 @@
+&lt;?php require_once(&quot;../template_header.php&quot;);?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Aanmelden bij Simuze&lt;/h1&gt;
+				
+				&lt;p class=&quot;space&quot;&gt;
+				
+				Rechts zie je een knop &quot;word nu lid&quot;. Als je daar op klikt kun je je &lt;a href=&quot;/live/register.php&quot;&gt;aanmelden&lt;/a&gt;.
+				
+				Kies een gebruikersnaam en wachtwoord en vul die in 
+				in de daarvoor bestemde velden. Voordat je lid word moet je wel akkoord zijn gegaan met de &lt;a href=&quot;/live/voorwaarden.php&quot;&gt;voorwaarden&lt;/a&gt; van Simuze.  
+				
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				 &lt;img src=&quot;/live/img/screenshots/mainpage_wordnulid.gif&quot; /&gt;
+				 &lt;br /&gt;&lt;br /&gt;&lt;img src=&quot;/live/img/screenshots/register.gif&quot; /&gt;&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Je krijgt een e-mail toegestuurd met je gegevens. Je aanmelding moet je bevestigen door op de link te klikken in de e-mail en in te loggen op de desbetreffende pagina. Je aanmelding is voltooid!
+				&lt;/p&gt;
+				
+				&lt;p class=&quot;space&quot;&gt;
+				Je kan nu in het vervolg direct inloggen op Simuze. zodra je dat verschijnt er een menu met verschillende opties. 
+				&lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+
+	&lt;?php require_once(&quot;../template_sidebar_footer.php&quot;);?&gt;
\ No newline at end of file

Added: trunk/help/ccinfo.php
===================================================================
--- trunk/help/ccinfo.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/help/ccinfo.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,19 @@
+&lt;?php require_once(&quot;../template_header.php&quot;);?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Creative Commons informatie&lt;/h1&gt;
+				
+				&lt;p class=&quot;space&quot;&gt;
+				Je hebt aangegeven meer informatie te willen omtrent de Creative Commons licenties. &lt;a href=&quot;<A HREF="http://www.creativecommons.nl">http://www.creativecommons.nl</A>&quot; title=&quot;Creative Commons Nederland&quot;&gt;Creative Commons Nederland&lt;/a&gt; heeft een uitgebreide &lt;a href=&quot;<A HREF="http://www.creativecommons.nl/meer/">http://www.creativecommons.nl/meer/</A>&quot; title=&quot;Meer weten&quot;&gt;FAQ&lt;/a&gt; online staan en we verwijzen je dan ook naar deze &lt;a href=&quot;<A HREF="http://www.creativecommons.nl/meer/">http://www.creativecommons.nl/meer/</A>&quot; title=&quot;Meer weten&quot;&gt;FAQ&lt;/a&gt;. &lt;a href=&quot;<A HREF="http://www.creativecommons.nl/meer/licenties/">http://www.creativecommons.nl/meer/licenties/</A>&quot; title=&quot;Licenties&quot;&gt;Specifieke licentie vragen en antwoorden&lt;/a&gt; kun je daar ook vinden. Voor vragen omtrent Simuze en Creative Commons zie de &lt;a href=&quot;<A HREF="http://www.simuze.nl/live/faq.php">http://www.simuze.nl/live/faq.php</A>&quot;&gt;Simuze FAQ&lt;/a&gt;.
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;img src=&quot;/live/img/screenshots/cc.gif&quot; /&gt;
+				&lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+
+	&lt;?php require_once(&quot;../template_sidebar_footer.php&quot;);?&gt;
\ No newline at end of file

Added: trunk/help/index.php
===================================================================
--- trunk/help/index.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/help/index.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,26 @@
+&lt;?php require_once(&quot;../template_header.php&quot;);?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Hulp nodig?&lt;/h1&gt;
+				
+				&lt;p class=&quot;space&quot;&gt;
+				Hieronder staat uitleg over een aantal onderwerpen met betrekking tot Simuze. Deze lijst zal verder worden uitgebreid. Suggesties? &lt;a href=&quot;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at simuze.nl</A>&quot;&gt;Mail ons&lt;/a&gt;. 
+				
+				&lt;/p&gt;
+				
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;ul&gt;
+				&lt;li&gt;&lt;a href=&quot;/live/help/aanmelden.php&quot;&gt;Aanmelden bij Simuze&lt;/a&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;/live/help/uploaden.php&quot;&gt;Muziek uploaden&lt;/a&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;/live/help/muziekgegevens.php&quot;&gt;Muziek gegevens toevoegen&lt;/a&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;/live/help/ccinfo.php&quot;&gt;Creative Commons licenties&lt;/a&gt;&lt;/li&gt;
+				&lt;/ul&gt;
+				&lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+
+	&lt;?php require_once(&quot;../template_sidebar_footer.php&quot;);?&gt;
\ No newline at end of file

Added: trunk/help/muziekgegevens.php
===================================================================
--- trunk/help/muziekgegevens.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/help/muziekgegevens.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,60 @@
+&lt;?php require_once(&quot;../template_header.php&quot;);?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Muziek gegevens toevoegen&lt;/h1&gt;
+				
+				&lt;p class=&quot;space&quot;&gt;
+				Nadat je jouw muziek hebt &lt;a href=&quot;/live/help/uploaden.php&quot;&gt;geupload&lt;/a&gt; kun je gegevens toevoegen aan je muziek zoals een titel, een licentie, etc. De muziek die je hebt geupload kan je vinden onder &quot;Muziek gegevens&quot; in je persoonlijke menu. Je kunt meer informatie meegeven aan de nummers in de tabel &lt;b&gt;nieuw&lt;/b&gt; door op &quot;Voeg gegevens toe&quot; te klikken rechts van de bestandsnaam. Als je dit doet zie je &lt;b&gt;4 stappen&lt;/b&gt; waar je informatie kan toevoegen aan jouw audiobestand. 
+				&lt;/p&gt;
+				
+				&lt;h2&gt;Stap 1&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Er wordt automatisch gechecked hoe je bestand heet, hoe groot het bestand is, hoe lang het duurt en wat voor bitrate het bestand heeft (bitrate is in dit geval het aantal bits wat per seconde wordt overgedragen). Deze worden dan ook al getoond. 
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Je kan bij stap 1 de Artiest vermelden van het nummer (per default is dat je eigen artiesttennaam), de titel van het nummer, het album waar het op staat, en het genre. Er zijn bewust maar een beperkt aantal hoofdgenres gekozen. Als je niet zeker weet onder welk genre je jouw muziek moet scharen, lees dan de beschrijvingen per genre even goed door. Alle velden behalve &quot;Album&quot; zijn verplicht in stap 1.
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;img src=&quot;/live/img/screenshots/gegevens_stap1.gif&quot; /&gt;
+				&lt;/p&gt;
+				
+				&lt;h2&gt;Stap 2&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Hier kan je jouw voorwaarden aangeven die je aan je muziek verbind. Dit wordt door Simuze direct vertaald naar een &lt;a href=&quot;/live/help/ccinfo.php&quot;&gt;Creative Commons licentie&lt;/a&gt; die deze voorwaarden &lt;a href=&quot;<A HREF="http://www.creativecommons.nl/meer/licenties/">http://www.creativecommons.nl/meer/licenties/</A>&quot;&gt;duidelijk aangeeft&lt;/a&gt; in de vorm van icoontjes. Deze icoontjes zullen ook getoond worden binnen Simuze. Vanaf het moment dat jij deze informatie hebt toegevoegd valt jouw werk onder een Creative commons licentie. 
+					
+				&lt;br /&gt;
+				&lt;br /&gt;
+				&lt;b&gt;Let op: deze licentie blijft aan je muziek verbonden, en is niet meer te wijzigen. Deze licenties zijn volledig rechtsgeldig en blijven gelden tot en met de officieel vastgestelde duur van een Auteursrechtelijk beschermd werk (tot en met 70 jaar na de dood van de maker). &lt;/b&gt;
+				
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;img src=&quot;/live/img/screenshots/gegevens_stap2.gif&quot; /&gt;
+				&lt;/p&gt;
+				&lt;h2&gt;Stap 3&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Bij de eerste drie velden kan je jouw voornaamste invloeden aangeven. Als je al de velden invult (met andere woorden als je zoveel mogelijk informatie meegeeft met je muziek) heb je meer kans om gevonden te worden. 
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Bij het vierde veld vul je trefwoorden in voor je muziek. Denk aan bijvoorbeeld &quot;instrumentaal&quot;, &quot;experimenteel&quot;, &quot;akoestisch&quot; of &quot;ingetogen&quot;. De trefwoorden schrijf je achter elkaar op zonder komma's of aanhalingstekens en gescheiden door een spatie. 
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;img src=&quot;/live/img/screenshots/gegevens_stap3.gif&quot; /&gt;
+				&lt;/p&gt;
+				&lt;h2&gt;Stap 4&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Ten slotte kun je naar eigen inzicht de globale waarden van je muziek aangeven binnen 5 categorieen (&lt;b&gt;emotie&lt;/b&gt;, &lt;b&gt;tempo&lt;/b&gt;, &lt;b&gt;dynamiek&lt;/b&gt;, &lt;b&gt;jaargetijde&lt;/b&gt;, en &lt;b&gt;tijd van de dag&lt;/b&gt;). Deze stap vinden we erg belangrijk omdat volgens ons bijna geen enkel nummer exact dezelfde karakteristiek heeft. 
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Er zijn voor elke categorie 5 waarden, waarvan standaard de optie &quot;neutraal&quot; is geselecteerd. Ga bij deze waardes uit van extremen: is jouw nummer bijvoorbeeld een &quot;beetje traag&quot; selecteer dan bij de categorie &lt;b&gt;tempo&lt;/b&gt; waarde 2, en niet waarde 1. 
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;img src=&quot;/live/img/screenshots/gegevens_stap4.gif&quot; /&gt;
+				&lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+
+	&lt;?php require_once(&quot;../template_sidebar_footer.php&quot;);?&gt;
\ No newline at end of file

Added: trunk/help/uploaden.php
===================================================================
--- trunk/help/uploaden.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/help/uploaden.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,63 @@
+&lt;?php require_once(&quot;../template_header.php&quot;);?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Muziek uploaden&lt;/h1&gt;
+				
+				&lt;p class=&quot;space&quot;&gt;
+				Je kan je muziek uploaden bij Simuze als je &lt;a href=&quot;/live/help/aanmelden.php&quot;&gt;lid&lt;/a&gt; bent geworden. Je mag alleen je eigen gemaakte muziek uploaden of je moet toestemming hebben van de maker(s). Als je lid bent geworden en bent ingelogd zie je in je persoonlijke menu (aan de rechterkant) een link met &quot;muziek uploaden&quot;. Je kan via deze pagina 1 nummer uploaden, of je kan ervoor kiezen om via een FTP programma meerdere nummers tegelijkertijd te uploaden. 
+				&lt;/p&gt;
+				&lt;h2&gt;Direct uploaden&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Je selecteert een bestand door op de knop &quot;bladeren&quot; te klikken en je bestand op te zoeken op je harde schijf. Klik daarna op de gele knop &quot;versturen&quot;. Het kan een paar minuten duren voordat je muziek geupload is (heb geduld!). 
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;img src=&quot;/live/img/screenshots/muziek_uploaden.gif&quot; /&gt;
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Je bestand is geupload! Deze wordt nu gecontroleerd en gechecked op virussen. Zodra dat gebeurd is komt het in een rij te staan onder &quot;&lt;a href=&quot;/live/help/muziekgegevens.php&quot;&gt;Muziek gegevens&lt;/a&gt;&quot; waar je gegevens kan toevoegen aan je muziek zoals een titel, licentie etc. 
+				&lt;/p&gt;
+				
+				&lt;a name=&quot;ftp&quot;&gt;&lt;/a&gt;
+				&lt;h2&gt;Uploaden via een FTP programma&lt;/h2&gt;
+				
+				&lt;p class=&quot;space&quot;&gt;
+				Met FTP (afkorting voor File Transfer Protocol) is het mogelijk files die zich op jouw computer bevinden over te brengen (te uploaden) naar de server van je webspace-aanbieder. Zo kun je dus je complete album dat op je eigen computer staat met behulp van het FTP-programma in zijn geheel uploaden. Dit scheelt veel tijd.
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;b&gt;Wat moet je doen&lt;/b&gt;
+				&lt;br /&gt;
+				Je moet allereerst een FTP programma downloaden en installeren op je computer. Een FTP programma dat wij adviseren is &lt;a href=&quot;<A HREF="http://sourceforge.net/projects/filezilla/">http://sourceforge.net/projects/filezilla/</A>&quot;&gt;Filezilla&lt;/a&gt; (een open-source FTP client met alles erop en eraan). 
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Nadat je het programma hebt ge&#239;nstalleerd, voeg je een nieuwe site toe. Dit doe je door naar &lt;b&gt;File &gt; Sitemanager&lt;/b&gt; te gaan, of &lt;b&gt; CTRL + S&lt;/b&gt; tegelijkertijd in te toetsen in het programma. Daarna klik je op &lt;b&gt; New Site&lt;/b&gt; links onderin het schermpje dat verschijnt en noemt de nieuwe site bijvoorbeeld &quot;SIMUZE&quot;. Je vult de velden als volgt in:
+				
+				&lt;ul&gt;
+				&lt;li&gt;1: bij &quot;Host&quot; vul je in &lt;b&gt; simuze.nl&lt;/b&gt;.&lt;/li&gt;
+				&lt;li&gt;2: bij &quot;Port&quot; vul je in &lt;b&gt; 21&lt;/b&gt; (dit staat als default als vermeld).&lt;/li&gt;
+				&lt;li&gt;3: bij &quot;Servertype&quot; vul je in &lt;b&gt;FTP&lt;/b&gt; (dit staat als default als vermeld).&lt;/li&gt;
+				&lt;li&gt;4: bij &quot;Logontype&quot; kies je &lt;b&gt;Normal&lt;/b&gt;.&lt;/li&gt;
+				&lt;li&gt;5: bij &quot;User&quot; vul je je &lt;b&gt;Simuze gebruikersnaam&lt;/b&gt; in.&lt;/li&gt;
+				&lt;li&gt;6: bij &quot;Password&quot; vul je je &lt;b&gt;Simuze wachtwoord&lt;/b&gt; in.&lt;/li&gt;
+				&lt;/ul&gt;
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;img src=&quot;/live/img/screenshots/ftp_1.gif&quot; /&gt;
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Na dit te hebben ingevuld klik je op &lt;b&gt;Connect&lt;/b&gt;. Je muziek zoek je op in het linkerscherm. Je ziet in het rechterscherm direct jouw directory waar je je nummers naartoe kan slepen. Het uploaden zelf kan enkele minuten duren (heb geduld!). 			
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;img src=&quot;/live/img/screenshots/ftp_2.gif&quot; /&gt;
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Je bestanden zijn geupload! Deze worden nu gecontroleerd en gechecked op virussen. Zodra dat gebeurd is komen ze in een rij te staan onder &quot;&lt;a href=&quot;/live/help/muziekgegevens.php&quot;&gt;Muziek gegevens&lt;/a&gt;&quot; waar je gegevens kan toevoegen aan je muziek zoals een titel, licentie etc.
+				&lt;/p&gt;
+				
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+
+	&lt;?php require_once(&quot;../template_sidebar_footer.php&quot;);?&gt;
\ No newline at end of file

Added: trunk/img/bg_pattern.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/bg_pattern.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/footer.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/footer.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/header.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/header.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/by.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/by.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/cc_type1.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/cc_type1.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/cc_type2.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/cc_type2.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/cc_type3.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/cc_type3.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/cc_type4.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/cc_type4.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/cc_type5.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/cc_type5.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/cc_type6.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/cc_type6.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/chat.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/chat.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/column.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/column.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/dl.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/dl.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/forum.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/forum.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/home.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/home.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/min.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/min.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/nc.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/nc.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/nd.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/nd.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/pd.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/pd.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/play.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/play.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/plus.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/plus.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/sa.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/sa.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/icons/speaker.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/icons/speaker.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/DP_logo.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/DP_logo.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/alternatief.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/alternatief.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/balk1_kort.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/balk1_kort.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/balk2_kort.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/balk2_kort.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bandvdweek.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bandvdweek.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bar1.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bar1.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bar1_genres.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bar1_genres.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bar1_onder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bar1_onder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bar1_showprofile.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bar1_showprofile.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/barbie_backstage.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/barbie_backstage.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/beeldmerk_rood_klein.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/beeldmerk_rood_klein.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bevestig_btn.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bevestig_btn.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_alleartiesten.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_alleartiesten.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_allecolumns_geel_top.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_allecolumns_geel_top.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_alleinterviews_geel_top.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_alleinterviews_geel_top.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_artiesten.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_artiesten.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_artikelen.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_artikelen.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_audiobestanden.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_audiobestanden.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_bestandsinfo_geel.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_bestandsinfo_geel.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_blauw_240_mid.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_blauw_240_mid.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_blauw_240_onder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_blauw_240_onder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_blue_325_mid.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_blue_325_mid.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_blue_325_onder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_blue_325_onder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_blue_325_top.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_blue_325_top.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_concerts.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_concerts.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_contactinfo.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_contactinfo.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_donker.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_donker.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_donkergeel_295_mid.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_donkergeel_295_mid.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_donkergeel_295_onder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_donkergeel_295_onder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_downloads.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_downloads.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_downloads_list.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_downloads_list.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_formbottom.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_formbottom.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_formmid.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_formmid.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_formtop.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_formtop.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_geel_295_mid.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_geel_295_mid.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_geel_295_onder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_geel_295_onder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_info_geel.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_info_geel.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_info_geel_mid.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_info_geel_mid.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_info_geel_onder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_info_geel_onder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_interessant.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_interessant.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_interviews.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_interviews.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_laatsttoegevoegd.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_laatsttoegevoegd.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_licentiekiezen_geel.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_licentiekiezen_geel.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_licht.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_licht.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_links.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_links.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_linksform.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_linksform.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_login.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_login.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_maak_playlist_aan.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_maak_playlist_aan.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_mid2_shadow.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_mid2_shadow.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_mid_shadow.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_mid_shadow.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_muzikantentips.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_muzikantentips.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_nieuw_geel_top.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_nieuw_geel_top.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_nieuweuploads.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_nieuweuploads.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_nieuweuploads_main.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_nieuweuploads_main.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_nieuwkomers.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_nieuwkomers.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_omschrijving_geel.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_omschrijving_geel.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_onder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_onder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_overig.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_overig.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_overzicht.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_overzicht.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_pattern.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_pattern.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_playlisttop10.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_playlisttop10.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_profiel_aanraders.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_profiel_aanraders.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_profiel_bio.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_profiel_bio.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_profiel_com.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_profiel_com.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_profiel_formmid.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_profiel_formmid.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_profiel_formonder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_profiel_formonder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_profiel_info.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_profiel_info.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_profiel_links.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_profiel_links.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_profiel_musica.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_profiel_musica.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_referenties_geel.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_referenties_geel.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_registerform.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_registerform.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_reviews.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_reviews.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_rood_295_mid.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_rood_295_mid.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_rood_295_onder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_rood_295_onder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_rood_600_mid.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_rood_600_mid.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_rood_600_onder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_rood_600_onder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_simuzeleden.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_simuzeleden.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_snelzoeken.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_snelzoeken.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_topdownloads.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_topdownloads.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_uitgelicht.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_uitgelicht.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_uitgelicht_mid.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_uitgelicht_mid.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_uitgelicht_musica.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_uitgelicht_musica.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_uitgelicht_onder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_uitgelicht_onder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_uitleg_geel_boven.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_uitleg_geel_boven.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_uitleg_geel_boven2.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_uitleg_geel_boven2.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_uitleg_geel_mid.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_uitleg_geel_mid.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_uitleg_geel_onder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_uitleg_geel_onder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_uitleg_geel_onder2.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_uitleg_geel_onder2.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_uitleg_geel_top.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_uitleg_geel_top.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_wachtrij_geel_top.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_wachtrij_geel_top.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_wijzig_playlist.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_wijzig_playlist.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bg_zoek.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bg_zoek.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bigbalk2_backstage.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bigbalk2_backstage.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bigbalk2_musica.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bigbalk2_musica.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bigbalk_backstage.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bigbalk_backstage.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bigbalk_musica.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bigbalk_musica.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/bjorn.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/bjorn.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/blues.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/blues.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/boven_blauwwit.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/boven_blauwwit.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/boven_blauwwitrood.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/boven_blauwwitrood.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/boven_genres.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/boven_genres.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/boven_login.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/boven_login.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/boven_nieuwsitems.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/boven_nieuwsitems.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/btn_beluister_alle.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/btn_beluister_alle.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/btn_maak_lege_playlist.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/btn_maak_lege_playlist.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/btn_maak_playlist.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/btn_maak_playlist.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/btn_maak_playlist_aan.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/btn_maak_playlist_aan.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/btn_verras_me.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/btn_verras_me.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/btn_zoek_vergelijkbare.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/btn_zoek_vergelijkbare.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/cc.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/cc.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/country.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/country.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/dezeweek.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/dezeweek.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/digitalepioniers.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/digitalepioniers.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/donkergeel_1.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/donkergeel_1.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/donkergeel_2.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/donkergeel_2.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/donkergeel_3.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/donkergeel_3.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/download_liefhebbers.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/download_liefhebbers.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/download_pijl.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/download_pijl.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/dubbelpijltje_rood.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/dubbelpijltje_rood.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/electronisch.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/electronisch.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/error_down.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/error_down.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/experimenteel.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/experimenteel.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/folk.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/folk.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/form_boven_geel.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/form_boven_geel.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/form_mid_blauw.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/form_mid_blauw.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/form_mid_geel.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/form_mid_geel.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/form_onder_blauw.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/form_onder_blauw.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/form_onder_geel.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/form_onder_geel.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/header.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/header.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/hiphop.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/hiphop.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/house.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/house.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/index_06.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/index_06.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/index_07.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/index_07.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/index_08.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/index_08.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/index_09.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/index_09.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/index_10.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/index_10.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/index_11.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/index_11.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/index_12.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/index_12.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/index_13.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/index_13.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/index_14.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/index_14.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/jazz.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/jazz.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/klassiek.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/klassiek.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/latin.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/latin.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/live_musica.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/live_musica.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/login.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/login.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/login_btn.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/login_btn.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/logout_btn.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/logout_btn.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/marten.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/marten.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/meerweten.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/meerweten.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/menurechts_boven.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/menurechts_boven.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/menurechts_onder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/menurechts_onder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/metal.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/metal.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/noggeenfoto.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/noggeenfoto.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/noggeenfoto_klein.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/noggeenfoto_klein.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/onder_blauwwit_shadow.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/onder_blauwwit_shadow.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/onder_blauwwitrood_shadow.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/onder_blauwwitrood_shadow.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/onder_genres.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/onder_genres.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/onder_login.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/onder_login.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/onder_nieuwsitems.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/onder_nieuwsitems.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/pijltje_links.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/pijltje_links.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/pijltje_rood.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/pijltje_rood.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/pijltje_rood2.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/pijltje_rood2.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/pijltje_wit.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/pijltje_wit.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/pijltjes_wit_3.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/pijltjes_wit_3.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/pop.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/pop.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/registreer_btn.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/registreer_btn.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/rnb.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/rnb.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/rock.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/rock.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/shadow.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/shadow.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/snelzoekknop.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/snelzoekknop.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/spacer.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/spacer.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/uitgelicht.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/uitgelicht.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/uitleg.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/uitleg.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/upload_muzikanten.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/upload_muzikanten.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/upload_pijl.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/upload_pijl.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/versturen_btn.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/versturen_btn.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/verstuur_btn.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/verstuur_btn.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/voegcommentaartoe.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/voegcommentaartoe.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/wereld.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/wereld.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/wijzig_nummer.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/wijzig_nummer.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/wijzigen_btn.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/wijzigen_btn.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/wordnulid.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/wordnulid.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/wordtlid_btn.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/wordtlid_btn.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/xs4all_30mm.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/xs4all_30mm.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/xs4all_60mm.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/xs4all_60mm.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/yellowline.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/yellowline.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_artiesten.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_artiesten.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_backstage.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_backstage.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_charts.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_charts.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_columns.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_columns.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_concertagenda.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_concertagenda.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_home.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_home.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_interviews.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_interviews.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_meer.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_meer.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_moderatie.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_moderatie.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_musica.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_musica.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_muziek.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_muziek.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_muziekgegevens.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_muziekgegevens.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_muziekoverzicht.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_muziekoverzicht.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_muziekuploaden.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_muziekuploaden.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_nieuw.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_nieuw.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_nieuws.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_nieuws.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_overzicht.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_overzicht.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_playlists.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_playlists.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_profiel.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_profiel.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_simuze.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_simuze.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_tips.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_tips.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_uitgelicht.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_uitgelicht.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_views.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_views.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zij_wie.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zij_wie.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/images/zoekknop.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/images/zoekknop.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/logo.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/logo.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/CSSleft.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/CSSleft.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/CSSright.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/CSSright.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/menulinks.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/menulinks.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/menulinks_reviews.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/menulinks_reviews.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/menurechts.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/menurechts.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/menurechts_boven.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/menurechts_boven.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/menurechts_onder.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/menurechts_onder.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/news_industrie.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/news_industrie.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/news_industrie_over.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/news_industrie_over.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/news_live.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/news_live.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/news_live_over.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/news_live_over.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/news_remixes.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/news_remixes.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/news_simuze.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/news_simuze.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/subCSSleft.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/subCSSleft.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/movers/subCSSright.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/movers/subCSSright.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/news/sennen.jpg
===================================================================
(Binary files differ)


Property changes on: trunk/img/news/sennen.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/screenshots/cc.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/screenshots/cc.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/screenshots/ftp_1.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/screenshots/ftp_1.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/screenshots/ftp_2.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/screenshots/ftp_2.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/screenshots/gegevens_stap1.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/screenshots/gegevens_stap1.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/screenshots/gegevens_stap2.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/screenshots/gegevens_stap2.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/screenshots/gegevens_stap3.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/screenshots/gegevens_stap3.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/screenshots/gegevens_stap4.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/screenshots/gegevens_stap4.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/screenshots/mainpage_wordnulid.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/screenshots/mainpage_wordnulid.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/screenshots/muziek_uploaden.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/screenshots/muziek_uploaden.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/img/screenshots/register.gif
===================================================================
(Binary files differ)


Property changes on: trunk/img/screenshots/register.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/inc/class.phpmailer.php
===================================================================
--- trunk/inc/class.phpmailer.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/class.phpmailer.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,1530 @@
+&lt;?php
+////////////////////////////////////////////////////
+// PHPMailer - PHP email class
+//
+// Class for sending email using either
+// sendmail, PHP mail(), or SMTP.  Methods are
+// based upon the standard AspEmail(tm) classes.
+//
+// Copyright (C) 2001 - 2003  Brent R. Matzelle
+//
+// License: LGPL, see LICENSE
+////////////////////////////////////////////////////
+
+/**
+ * PHPMailer - PHP email transport class
+ * @package PHPMailer
+ * @author Brent R. Matzelle
+ * @copyright 2001 - 2003 Brent R. Matzelle
+ */
+class PHPMailer
+{
+    /////////////////////////////////////////////////
+    // PUBLIC VARIABLES
+    /////////////////////////////////////////////////
+
+    /**
+     * Email priority (1 = High, 3 = Normal, 5 = low).
+     * @var int
+     */
+    var $Priority          = 3;
+
+    /**
+     * Sets the CharSet of the message.
+     * @var string
+     */
+    var $CharSet           = &quot;iso-8859-1&quot;;
+
+    /**
+     * Sets the Content-type of the message.
+     * @var string
+     */
+    var $ContentType        = &quot;text/plain&quot;;
+
+    /**
+     * Sets the Encoding of the message. Options for this are &quot;8bit&quot;,
+     * &quot;7bit&quot;, &quot;binary&quot;, &quot;base64&quot;, and &quot;quoted-printable&quot;.
+     * @var string
+     */
+    var $Encoding          = &quot;8bit&quot;;
+
+    /**
+     * Holds the most recent mailer error message.
+     * @var string
+     */
+    var $ErrorInfo         = &quot;&quot;;
+
+    /**
+     * Sets the From email address for the message.
+     * @var string
+     */
+    var $From               = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">root at localhost</A>&quot;;
+
+    /**
+     * Sets the From name of the message.
+     * @var string
+     */
+    var $FromName           = &quot;Root User&quot;;
+
+    /**
+     * Sets the Sender email (Return-Path) of the message.  If not empty,
+     * will be sent via -f to sendmail or as 'MAIL FROM' in smtp mode.
+     * @var string
+     */
+    var $Sender            = &quot;&quot;;
+
+    /**
+     * Sets the Subject of the message.
+     * @var string
+     */
+    var $Subject           = &quot;&quot;;
+
+    /**
+     * Sets the Body of the message.  This can be either an HTML or text body.
+     * If HTML then run IsHTML(true).
+     * @var string
+     */
+    var $Body               = &quot;&quot;;
+
+    /**
+     * Sets the text-only body of the message.  This automatically sets the
+     * email to multipart/alternative.  This body can be read by mail
+     * clients that do not have HTML email capability such as mutt. Clients
+     * that can read HTML will view the normal Body.
+     * @var string
+     */
+    var $AltBody           = &quot;&quot;;
+
+    /**
+     * Sets word wrapping on the body of the message to a given number of 
+     * characters.
+     * @var int
+     */
+    var $WordWrap          = 0;
+
+    /**
+     * Method to send mail: (&quot;mail&quot;, &quot;sendmail&quot;, or &quot;smtp&quot;).
+     * @var string
+     */
+    var $Mailer            = &quot;mail&quot;;
+
+    /**
+     * Sets the path of the sendmail program.
+     * @var string
+     */
+    var $Sendmail          = &quot;/usr/sbin/sendmail&quot;;
+    
+    /**
+     * Path to PHPMailer plugins.  This is now only useful if the SMTP class 
+     * is in a different directory than the PHP include path.  
+     * @var string
+     */
+    var $PluginDir         = &quot;&quot;;
+
+    /**
+     *  Holds PHPMailer version.
+     *  @var string
+     */
+    var $Version           = &quot;1.71&quot;;
+
+    /**
+     * Sets the email address that a reading confirmation will be sent.
+     * @var string
+     */
+    var $ConfirmReadingTo  = &quot;&quot;;
+
+    /**
+     *  Sets the hostname to use in Message-Id and Received headers
+     *  and as default HELO string. If empty, the value returned
+     *  by SERVER_NAME is used or 'localhost.localdomain'.
+     *  @var string
+     */
+    var $Hostname          = &quot;&quot;;
+
+
+    /////////////////////////////////////////////////
+    // SMTP VARIABLES
+    /////////////////////////////////////////////////
+
+    /**
+     *  Sets the SMTP hosts.  All hosts must be separated by a
+     *  semicolon.  You can also specify a different port
+     *  for each host by using this format: [hostname:port]
+     *  (e.g. &quot;smtp1.example.com:25;smtp2.example.com&quot;).
+     *  Hosts will be tried in order.
+     *  @var string
+     */
+    var $Host        = &quot;localhost&quot;;
+
+    /**
+     *  Sets the default SMTP server port.
+     *  @var int
+     */
+    var $Port        = 25;
+
+    /**
+     *  Sets the SMTP HELO of the message (Default is $Hostname).
+     *  @var string
+     */
+    var $Helo        = &quot;&quot;;
+
+    /**
+     *  Sets SMTP authentication. Utilizes the Username and Password variables.
+     *  @var bool
+     */
+    var $SMTPAuth     = false;
+
+    /**
+     *  Sets SMTP username.
+     *  @var string
+     */
+    var $Username     = &quot;&quot;;
+
+    /**
+     *  Sets SMTP password.
+     *  @var string
+     */
+    var $Password     = &quot;&quot;;
+
+    /**
+     *  Sets the SMTP server timeout in seconds. This function will not 
+     *  work with the win32 version.
+     *  @var int
+     */
+    var $Timeout      = 10;
+
+    /**
+     *  Sets SMTP class debugging on or off.
+     *  @var bool
+     */
+    var $SMTPDebug    = false;
+
+    /**
+     * Prevents the SMTP connection from being closed after each mail 
+     * sending.  If this is set to true then to close the connection 
+     * requires an explicit call to SmtpClose(). 
+     * @var bool
+     */
+    var $SMTPKeepAlive = false;
+
+    /**#@+
+     * @access private
+     */
+    var $smtp            = NULL;
+    var $to              = array();
+    var $cc              = array();
+    var $bcc             = array();
+    var $ReplyTo         = array();
+    var $attachment      = array();
+    var $CustomHeader    = array();
+    var $message_type    = &quot;&quot;;
+    var $boundary        = array();
+    var $language        = array();
+    var $error_count     = 0;
+    var $LE              = &quot;\n&quot;;
+    /**#@-*/
+    
+    /////////////////////////////////////////////////
+    // VARIABLE METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Sets message type to HTML.  
+     * @param bool $bool
+     * @return void
+     */
+    function IsHTML($bool) {
+        if($bool == true)
+            $this-&gt;ContentType = &quot;text/html&quot;;
+        else
+            $this-&gt;ContentType = &quot;text/plain&quot;;
+    }
+
+    /**
+     * Sets Mailer to send message using SMTP.
+     * @return void
+     */
+    function IsSMTP() {
+        $this-&gt;Mailer = &quot;smtp&quot;;
+    }
+
+    /**
+     * Sets Mailer to send message using PHP mail() function.
+     * @return void
+     */
+    function IsMail() {
+        $this-&gt;Mailer = &quot;mail&quot;;
+    }
+
+    /**
+     * Sets Mailer to send message using the $Sendmail program.
+     * @return void
+     */
+    function IsSendmail() {
+        $this-&gt;Mailer = &quot;sendmail&quot;;
+    }
+
+    /**
+     * Sets Mailer to send message using the qmail MTA. 
+     * @return void
+     */
+    function IsQmail() {
+        $this-&gt;Sendmail = &quot;/var/qmail/bin/sendmail&quot;;
+        $this-&gt;Mailer = &quot;sendmail&quot;;
+    }
+
+
+    /////////////////////////////////////////////////
+    // RECIPIENT METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Adds a &quot;To&quot; address.  
+     * @param string $address
+     * @param string $name
+     * @return void
+     */
+    function AddAddress($address, $name = &quot;&quot;) {
+        $cur = count($this-&gt;to);
+        $this-&gt;to[$cur][0] = trim($address);
+        $this-&gt;to[$cur][1] = $name;
+    }
+
+    /**
+     * Adds a &quot;Cc&quot; address. Note: this function works
+     * with the SMTP mailer on win32, not with the &quot;mail&quot;
+     * mailer.  
+     * @param string $address
+     * @param string $name
+     * @return void
+    */
+    function AddCC($address, $name = &quot;&quot;) {
+        $cur = count($this-&gt;cc);
+        $this-&gt;cc[$cur][0] = trim($address);
+        $this-&gt;cc[$cur][1] = $name;
+    }
+
+    /**
+     * Adds a &quot;Bcc&quot; address. Note: this function works
+     * with the SMTP mailer on win32, not with the &quot;mail&quot;
+     * mailer.  
+     * @param string $address
+     * @param string $name
+     * @return void
+     */
+    function AddBCC($address, $name = &quot;&quot;) {
+        $cur = count($this-&gt;bcc);
+        $this-&gt;bcc[$cur][0] = trim($address);
+        $this-&gt;bcc[$cur][1] = $name;
+    }
+
+    /**
+     * Adds a &quot;Reply-to&quot; address.  
+     * @param string $address
+     * @param string $name
+     * @return void
+     */
+    function AddReplyTo($address, $name = &quot;&quot;) {
+        $cur = count($this-&gt;ReplyTo);
+        $this-&gt;ReplyTo[$cur][0] = trim($address);
+        $this-&gt;ReplyTo[$cur][1] = $name;
+    }
+
+
+    /////////////////////////////////////////////////
+    // MAIL SENDING METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Creates message and assigns Mailer. If the message is
+     * not sent successfully then it returns false.  Use the ErrorInfo
+     * variable to view description of the error.  
+     * @return bool
+     */
+    function Send() {
+        $header = &quot;&quot;;
+        $body = &quot;&quot;;
+
+        if((count($this-&gt;to) + count($this-&gt;cc) + count($this-&gt;bcc)) &lt; 1)
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;provide_address&quot;));
+            return false;
+        }
+
+        // Set whether the message is multipart/alternative
+        if(!empty($this-&gt;AltBody))
+            $this-&gt;ContentType = &quot;multipart/alternative&quot;;
+
+        $this-&gt;SetMessageType();
+        $header .= $this-&gt;CreateHeader();
+        $body = $this-&gt;CreateBody();
+
+        if($body == &quot;&quot;) { return false; }
+
+        // Choose the mailer
+        if($this-&gt;Mailer == &quot;sendmail&quot;)
+        {
+          if(!$this-&gt;SendmailSend($header, $body))
+              return false;
+        }
+        elseif($this-&gt;Mailer == &quot;mail&quot;)
+        {
+          if(!$this-&gt;MailSend($header, $body))
+              return false;
+        }
+        elseif($this-&gt;Mailer == &quot;smtp&quot;)
+        {
+          if(!$this-&gt;SmtpSend($header, $body))
+              return false;
+        }
+        else
+        {
+            $this-&gt;SetError($this-&gt;Mailer . $this-&gt;Lang(&quot;mailer_not_supported&quot;));
+            return false;
+        }
+
+        return true;
+    }
+    
+    /**
+     * Sends mail using the $Sendmail program.  
+     * @access private
+     * @return bool
+     */
+    function SendmailSend($header, $body) {
+        if ($this-&gt;Sender != &quot;&quot;)
+            $sendmail = sprintf(&quot;%s -oi -f %s -t&quot;, $this-&gt;Sendmail, $this-&gt;Sender);
+        else
+            $sendmail = sprintf(&quot;%s -oi -t&quot;, $this-&gt;Sendmail);
+
+        if(!@$mail = popen($sendmail, &quot;w&quot;))
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;execute&quot;) . $this-&gt;Sendmail);
+            return false;
+        }
+
+        fputs($mail, $header);
+        fputs($mail, $body);
+        
+        $result = pclose($mail) &gt;&gt; 8 &amp; 0xFF;
+        if($result != 0)
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;execute&quot;) . $this-&gt;Sendmail);
+            return false;
+        }
+
+        return true;
+    }
+
+    /**
+     * Sends mail using the PHP mail() function.  
+     * @access private
+     * @return bool
+     */
+    function MailSend($header, $body) {
+        $to = &quot;&quot;;
+        for($i = 0; $i &lt; count($this-&gt;to); $i++)
+        {
+            if($i != 0) { $to .= &quot;, &quot;; }
+            $to .= $this-&gt;to[$i][0];
+        }
+
+        if ($this-&gt;Sender != &quot;&quot; &amp;&amp; strlen(ini_get(&quot;safe_mode&quot;))&lt; 1)
+        {
+            $old_from = ini_get(&quot;sendmail_from&quot;);
+            ini_set(&quot;sendmail_from&quot;, $this-&gt;Sender);
+            $params = sprintf(&quot;-oi -f %s&quot;, $this-&gt;Sender);
+            $rt = @mail($to, $this-&gt;EncodeHeader($this-&gt;Subject), $body, 
+                        $header, $params);
+        }
+        else
+            $rt = @mail($to, $this-&gt;EncodeHeader($this-&gt;Subject), $body, $header);
+
+        if (isset($old_from))
+            ini_set(&quot;sendmail_from&quot;, $old_from);
+
+        if(!$rt)
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;instantiate&quot;));
+            return false;
+        }
+
+        return true;
+    }
+
+    /**
+     * Sends mail via SMTP using PhpSMTP (Author:
+     * Chris Ryan).  Returns bool.  Returns false if there is a
+     * bad MAIL FROM, RCPT, or DATA input.
+     * @access private
+     * @return bool
+     */
+    function SmtpSend($header, $body) {
+        include_once($this-&gt;PluginDir . &quot;class.smtp.php&quot;);
+        $error = &quot;&quot;;
+        $bad_rcpt = array();
+
+        if(!$this-&gt;SmtpConnect())
+            return false;
+
+        $smtp_from = ($this-&gt;Sender == &quot;&quot;) ? $this-&gt;From : $this-&gt;Sender;
+        if(!$this-&gt;smtp-&gt;Mail($smtp_from))
+        {
+            $error = $this-&gt;Lang(&quot;from_failed&quot;) . $smtp_from;
+            $this-&gt;SetError($error);
+            $this-&gt;smtp-&gt;Reset();
+            return false;
+        }
+
+        // Attempt to send attach all recipients
+        for($i = 0; $i &lt; count($this-&gt;to); $i++)
+        {
+            if(!$this-&gt;smtp-&gt;Recipient($this-&gt;to[$i][0]))
+                $bad_rcpt[] = $this-&gt;to[$i][0];
+        }
+        for($i = 0; $i &lt; count($this-&gt;cc); $i++)
+        {
+            if(!$this-&gt;smtp-&gt;Recipient($this-&gt;cc[$i][0]))
+                $bad_rcpt[] = $this-&gt;cc[$i][0];
+        }
+        for($i = 0; $i &lt; count($this-&gt;bcc); $i++)
+        {
+            if(!$this-&gt;smtp-&gt;Recipient($this-&gt;bcc[$i][0]))
+                $bad_rcpt[] = $this-&gt;bcc[$i][0];
+        }
+
+        if(count($bad_rcpt) &gt; 0) // Create error message
+        {
+            for($i = 0; $i &lt; count($bad_rcpt); $i++)
+            {
+                if($i != 0) { $error .= &quot;, &quot;; }
+                $error .= $bad_rcpt[$i];
+            }
+            $error = $this-&gt;Lang(&quot;recipients_failed&quot;) . $error;
+            $this-&gt;SetError($error);
+            $this-&gt;smtp-&gt;Reset();
+            return false;
+        }
+
+        if(!$this-&gt;smtp-&gt;Data($header . $body))
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;data_not_accepted&quot;));
+            $this-&gt;smtp-&gt;Reset();
+            return false;
+        }
+        if($this-&gt;SMTPKeepAlive == true)
+            $this-&gt;smtp-&gt;Reset();
+        else
+            $this-&gt;SmtpClose();
+
+        return true;
+    }
+
+    /**
+     * Initiates a connection to an SMTP server.  Returns false if the 
+     * operation failed.
+     * @access private
+     * @return bool
+     */
+    function SmtpConnect() {
+        if($this-&gt;smtp == NULL) { $this-&gt;smtp = new SMTP(); }
+
+        $this-&gt;smtp-&gt;do_debug = $this-&gt;SMTPDebug;
+        $hosts = explode(&quot;;&quot;, $this-&gt;Host);
+        $index = 0;
+        $connection = ($this-&gt;smtp-&gt;Connected()); 
+
+        // Retry while there is no connection
+        while($index &lt; count($hosts) &amp;&amp; $connection == false)
+        {
+            if(strstr($hosts[$index], &quot;:&quot;))
+                list($host, $port) = explode(&quot;:&quot;, $hosts[$index]);
+            else
+            {
+                $host = $hosts[$index];
+                $port = $this-&gt;Port;
+            }
+
+            if($this-&gt;smtp-&gt;Connect($host, $port, $this-&gt;Timeout))
+            {
+                if ($this-&gt;Helo != '')
+                    $this-&gt;smtp-&gt;Hello($this-&gt;Helo);
+                else
+                    $this-&gt;smtp-&gt;Hello($this-&gt;ServerHostname());
+        
+                if($this-&gt;SMTPAuth)
+                {
+                    if(!$this-&gt;smtp-&gt;Authenticate($this-&gt;Username, 
+                                                  $this-&gt;Password))
+                    {
+                        $this-&gt;SetError($this-&gt;Lang(&quot;authenticate&quot;));
+                        $this-&gt;smtp-&gt;Reset();
+                        $connection = false;
+                    }
+                }
+                $connection = true;
+            }
+            $index++;
+        }
+        if(!$connection)
+            $this-&gt;SetError($this-&gt;Lang(&quot;connect_host&quot;));
+
+        return $connection;
+    }
+
+    /**
+     * Closes the active SMTP session if one exists.
+     * @return void
+     */
+    function SmtpClose() {
+        if($this-&gt;smtp != NULL)
+        {
+            if($this-&gt;smtp-&gt;Connected())
+            {
+                $this-&gt;smtp-&gt;Quit();
+                $this-&gt;smtp-&gt;Close();
+            }
+        }
+    }
+
+    /**
+     * Sets the language for all class error messages.  Returns false 
+     * if it cannot load the language file.  The default language type
+     * is English.
+     * @param string $lang_type Type of language (e.g. Portuguese: &quot;br&quot;)
+     * @param string $lang_path Path to the language file directory
+     * @access public
+     * @return bool
+     */
+    function SetLanguage($lang_type, $lang_path = &quot;&quot;) {
+        if(file_exists($lang_path.'phpmailer.lang-'.$lang_type.'.php'))
+            include($lang_path.'phpmailer.lang-'.$lang_type.'.php');
+        else if(file_exists($lang_path.'phpmailer.lang-en.php'))
+            include($lang_path.'phpmailer.lang-en.php');
+        else
+        {
+            $this-&gt;SetError(&quot;Could not load language file&quot;);
+            return false;
+        }
+        $this-&gt;language = $PHPMAILER_LANG;
+    
+        return true;
+    }
+
+    /////////////////////////////////////////////////
+    // MESSAGE CREATION METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Creates recipient headers.  
+     * @access private
+     * @return string
+     */
+    function AddrAppend($type, $addr) {
+        $addr_str = $type . &quot;: &quot;;
+        $addr_str .= $this-&gt;AddrFormat($addr[0]);
+        if(count($addr) &gt; 1)
+        {
+            for($i = 1; $i &lt; count($addr); $i++)
+                $addr_str .= &quot;, &quot; . $this-&gt;AddrFormat($addr[$i]);
+        }
+        $addr_str .= $this-&gt;LE;
+
+        return $addr_str;
+    }
+    
+    /**
+     * Formats an address correctly. 
+     * @access private
+     * @return string
+     */
+    function AddrFormat($addr) {
+        if(empty($addr[1]))
+            $formatted = $addr[0];
+        else
+        {
+            $formatted = $this-&gt;EncodeHeader($addr[1], 'phrase') . &quot; &lt;&quot; . 
+                         $addr[0] . &quot;&gt;&quot;;
+        }
+
+        return $formatted;
+    }
+
+    /**
+     * Wraps message for use with mailers that do not
+     * automatically perform wrapping and for quoted-printable.
+     * Original written by philippe.  
+     * @access private
+     * @return string
+     */
+    function WrapText($message, $length, $qp_mode = false) {
+        $soft_break = ($qp_mode) ? sprintf(&quot; =%s&quot;, $this-&gt;LE) : $this-&gt;LE;
+
+        $message = $this-&gt;FixEOL($message);
+        if (substr($message, -1) == $this-&gt;LE)
+            $message = substr($message, 0, -1);
+
+        $line = explode($this-&gt;LE, $message);
+        $message = &quot;&quot;;
+        for ($i=0 ;$i &lt; count($line); $i++)
+        {
+          $line_part = explode(&quot; &quot;, $line[$i]);
+          $buf = &quot;&quot;;
+          for ($e = 0; $e&lt;count($line_part); $e++)
+          {
+              $word = $line_part[$e];
+              if ($qp_mode and (strlen($word) &gt; $length))
+              {
+                $space_left = $length - strlen($buf) - 1;
+                if ($e != 0)
+                {
+                    if ($space_left &gt; 20)
+                    {
+                        $len = $space_left;
+                        if (substr($word, $len - 1, 1) == &quot;=&quot;)
+                          $len--;
+                        elseif (substr($word, $len - 2, 1) == &quot;=&quot;)
+                          $len -= 2;
+                        $part = substr($word, 0, $len);
+                        $word = substr($word, $len);
+                        $buf .= &quot; &quot; . $part;
+                        $message .= $buf . sprintf(&quot;=%s&quot;, $this-&gt;LE);
+                    }
+                    else
+                    {
+                        $message .= $buf . $soft_break;
+                    }
+                    $buf = &quot;&quot;;
+                }
+                while (strlen($word) &gt; 0)
+                {
+                    $len = $length;
+                    if (substr($word, $len - 1, 1) == &quot;=&quot;)
+                        $len--;
+                    elseif (substr($word, $len - 2, 1) == &quot;=&quot;)
+                        $len -= 2;
+                    $part = substr($word, 0, $len);
+                    $word = substr($word, $len);
+
+                    if (strlen($word) &gt; 0)
+                        $message .= $part . sprintf(&quot;=%s&quot;, $this-&gt;LE);
+                    else
+                        $buf = $part;
+                }
+              }
+              else
+              {
+                $buf_o = $buf;
+                $buf .= ($e == 0) ? $word : (&quot; &quot; . $word); 
+
+                if (strlen($buf) &gt; $length and $buf_o != &quot;&quot;)
+                {
+                    $message .= $buf_o . $soft_break;
+                    $buf = $word;
+                }
+              }
+          }
+          $message .= $buf . $this-&gt;LE;
+        }
+
+        return $message;
+    }
+    
+    /**
+     * Set the body wrapping.
+     * @access private
+     * @return void
+     */
+    function SetWordWrap() {
+        if($this-&gt;WordWrap &lt; 1)
+            return;
+            
+        switch($this-&gt;message_type)
+        {
+           case &quot;alt&quot;:
+              // fall through
+           case &quot;alt_attachment&quot;:
+              $this-&gt;AltBody = $this-&gt;WrapText($this-&gt;AltBody, $this-&gt;WordWrap);
+              break;
+           default:
+              $this-&gt;Body = $this-&gt;WrapText($this-&gt;Body, $this-&gt;WordWrap);
+              break;
+        }
+    }
+
+    /**
+     * Assembles message header.  
+     * @access private
+     * @return string
+     */
+    function CreateHeader() {
+        $result = &quot;&quot;;
+        
+        // Set the boundaries
+        $uniq_id = md5(uniqid(time()));
+        $this-&gt;boundary[1] = &quot;b1_&quot; . $uniq_id;
+        $this-&gt;boundary[2] = &quot;b2_&quot; . $uniq_id;
+
+        $result .= $this-&gt;Received();
+        $result .= $this-&gt;HeaderLine(&quot;Date&quot;, $this-&gt;RFCDate());
+        if($this-&gt;Sender == &quot;&quot;)
+            $result .= $this-&gt;HeaderLine(&quot;Return-Path&quot;, trim($this-&gt;From));
+        else
+            $result .= $this-&gt;HeaderLine(&quot;Return-Path&quot;, trim($this-&gt;Sender));
+        
+        // To be created automatically by mail()
+        if($this-&gt;Mailer != &quot;mail&quot;)
+        {
+            if(count($this-&gt;to) &gt; 0)
+                $result .= $this-&gt;AddrAppend(&quot;To&quot;, $this-&gt;to);
+            else if (count($this-&gt;cc) == 0)
+                $result .= $this-&gt;HeaderLine(&quot;To&quot;, &quot;undisclosed-recipients:;&quot;);
+            if(count($this-&gt;cc) &gt; 0)
+                $result .= $this-&gt;AddrAppend(&quot;Cc&quot;, $this-&gt;cc);
+        }
+
+        $from = array();
+        $from[0][0] = trim($this-&gt;From);
+        $from[0][1] = $this-&gt;FromName;
+        $result .= $this-&gt;AddrAppend(&quot;From&quot;, $from); 
+
+        // sendmail and mail() extract Bcc from the header before sending
+        if((($this-&gt;Mailer == &quot;sendmail&quot;) || ($this-&gt;Mailer == &quot;mail&quot;)) &amp;&amp; (count($this-&gt;bcc) &gt; 0))
+            $result .= $this-&gt;AddrAppend(&quot;Bcc&quot;, $this-&gt;bcc);
+
+        if(count($this-&gt;ReplyTo) &gt; 0)
+            $result .= $this-&gt;AddrAppend(&quot;Reply-to&quot;, $this-&gt;ReplyTo);
+
+        // mail() sets the subject itself
+        if($this-&gt;Mailer != &quot;mail&quot;)
+            $result .= $this-&gt;HeaderLine(&quot;Subject&quot;, $this-&gt;EncodeHeader(trim($this-&gt;Subject)));
+
+        $result .= sprintf(&quot;Message-ID: &lt;%s@%s&gt;%s&quot;, $uniq_id, $this-&gt;ServerHostname(), $this-&gt;LE);
+        $result .= $this-&gt;HeaderLine(&quot;X-Priority&quot;, $this-&gt;Priority);
+        $result .= $this-&gt;HeaderLine(&quot;X-Mailer&quot;, &quot;PHPMailer [version &quot; . $this-&gt;Version . &quot;]&quot;);
+        
+        if($this-&gt;ConfirmReadingTo != &quot;&quot;)
+        {
+            $result .= $this-&gt;HeaderLine(&quot;Disposition-Notification-To&quot;, 
+                       &quot;&lt;&quot; . trim($this-&gt;ConfirmReadingTo) . &quot;&gt;&quot;);
+        }
+
+        // Add custom headers
+        for($index = 0; $index &lt; count($this-&gt;CustomHeader); $index++)
+        {
+            $result .= $this-&gt;HeaderLine(trim($this-&gt;CustomHeader[$index][0]), 
+                       $this-&gt;EncodeHeader(trim($this-&gt;CustomHeader[$index][1])));
+        }
+        $result .= $this-&gt;HeaderLine(&quot;MIME-Version&quot;, &quot;1.0&quot;);
+
+        switch($this-&gt;message_type)
+        {
+            case &quot;plain&quot;:
+                $result .= $this-&gt;HeaderLine(&quot;Content-Transfer-Encoding&quot;, $this-&gt;Encoding);
+                $result .= sprintf(&quot;Content-Type: %s; charset=\&quot;%s\&quot;&quot;,
+                                    $this-&gt;ContentType, $this-&gt;CharSet);
+                break;
+            case &quot;attachments&quot;:
+                // fall through
+            case &quot;alt_attachments&quot;:
+                if($this-&gt;InlineImageExists())
+                {
+                    $result .= sprintf(&quot;Content-Type: %s;%s\ttype=\&quot;text/html\&quot;;%s\tboundary=\&quot;%s\&quot;%s&quot;, 
+                                    &quot;multipart/related&quot;, $this-&gt;LE, $this-&gt;LE, 
+                                    $this-&gt;boundary[1], $this-&gt;LE);
+                }
+                else
+                {
+                    $result .= $this-&gt;HeaderLine(&quot;Content-Type&quot;, &quot;multipart/mixed;&quot;);
+                    $result .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . '&quot;');
+                }
+                break;
+            case &quot;alt&quot;:
+                $result .= $this-&gt;HeaderLine(&quot;Content-Type&quot;, &quot;multipart/alternative;&quot;);
+                $result .= $this-&gt;TextLine(&quot;\tboundary=\&quot;&quot; . $this-&gt;boundary[1] . '&quot;');
+                break;
+        }
+
+        if($this-&gt;Mailer != &quot;mail&quot;)
+            $result .= $this-&gt;LE.$this-&gt;LE;
+
+        return $result;
+    }
+
+    /**
+     * Assembles the message body.  Returns an empty string on failure.
+     * @access private
+     * @return string
+     */
+    function CreateBody() {
+        $result = &quot;&quot;;
+
+        $this-&gt;SetWordWrap();
+
+        switch($this-&gt;message_type)
+        {
+            case &quot;alt&quot;:
+                $result .= $this-&gt;GetBoundary($this-&gt;boundary[1], &quot;&quot;, 
+                                              &quot;text/plain&quot;, &quot;&quot;);
+                $result .= $this-&gt;EncodeString($this-&gt;AltBody, $this-&gt;Encoding);
+                $result .= $this-&gt;LE.$this-&gt;LE;
+                $result .= $this-&gt;GetBoundary($this-&gt;boundary[1], &quot;&quot;, 
+                                              &quot;text/html&quot;, &quot;&quot;);
+                
+                $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);
+                $result .= $this-&gt;LE.$this-&gt;LE;
+    
+                $result .= $this-&gt;EndBoundary($this-&gt;boundary[1]);
+                break;
+            case &quot;plain&quot;:
+                $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);
+                break;
+            case &quot;attachments&quot;:
+                $result .= $this-&gt;GetBoundary($this-&gt;boundary[1], &quot;&quot;, &quot;&quot;, &quot;&quot;);
+                $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);
+                $result .= $this-&gt;LE;
+     
+                $result .= $this-&gt;AttachAll();
+                break;
+            case &quot;alt_attachments&quot;:
+                $result .= sprintf(&quot;--%s%s&quot;, $this-&gt;boundary[1], $this-&gt;LE);
+                $result .= sprintf(&quot;Content-Type: %s;%s&quot; .
+                                   &quot;\tboundary=\&quot;%s\&quot;%s&quot;,
+                                   &quot;multipart/alternative&quot;, $this-&gt;LE, 
+                                   $this-&gt;boundary[2], $this-&gt;LE.$this-&gt;LE);
+    
+                // Create text body
+                $result .= $this-&gt;GetBoundary($this-&gt;boundary[2], &quot;&quot;, 
+                                              &quot;text/plain&quot;, &quot;&quot;) . $this-&gt;LE;
+
+                $result .= $this-&gt;EncodeString($this-&gt;AltBody, $this-&gt;Encoding);
+                $result .= $this-&gt;LE.$this-&gt;LE;
+    
+                // Create the HTML body
+                $result .= $this-&gt;GetBoundary($this-&gt;boundary[2], &quot;&quot;, 
+                                              &quot;text/html&quot;, &quot;&quot;) . $this-&gt;LE;
+    
+                $result .= $this-&gt;EncodeString($this-&gt;Body, $this-&gt;Encoding);
+                $result .= $this-&gt;LE.$this-&gt;LE;
+
+                $result .= $this-&gt;EndBoundary($this-&gt;boundary[2]);
+                
+                $result .= $this-&gt;AttachAll();
+                break;
+        }
+        if($this-&gt;IsError())
+            $result = &quot;&quot;;
+
+        return $result;
+    }
+
+    /**
+     * Returns the start of a message boundary.
+     * @access private
+     */
+    function GetBoundary($boundary, $charSet, $contentType, $encoding) {
+        $result = &quot;&quot;;
+        if($charSet == &quot;&quot;) { $charSet = $this-&gt;CharSet; }
+        if($contentType == &quot;&quot;) { $contentType = $this-&gt;ContentType; }
+        if($encoding == &quot;&quot;) { $encoding = $this-&gt;Encoding; }
+
+        $result .= $this-&gt;TextLine(&quot;--&quot; . $boundary);
+        $result .= sprintf(&quot;Content-Type: %s; charset = \&quot;%s\&quot;&quot;, 
+                            $contentType, $charSet);
+        $result .= $this-&gt;LE;
+        $result .= $this-&gt;HeaderLine(&quot;Content-Transfer-Encoding&quot;, $encoding);
+        $result .= $this-&gt;LE;
+       
+        return $result;
+    }
+    
+    /**
+     * Returns the end of a message boundary.
+     * @access private
+     */
+    function EndBoundary($boundary) {
+        return $this-&gt;LE . &quot;--&quot; . $boundary . &quot;--&quot; . $this-&gt;LE; 
+    }
+    
+    /**
+     * Sets the message type.
+     * @access private
+     * @return void
+     */
+    function SetMessageType() {
+        if(count($this-&gt;attachment) &lt; 1 &amp;&amp; strlen($this-&gt;AltBody) &lt; 1)
+            $this-&gt;message_type = &quot;plain&quot;;
+        else
+        {
+            if(count($this-&gt;attachment) &gt; 0)
+                $this-&gt;message_type = &quot;attachments&quot;;
+            if(strlen($this-&gt;AltBody) &gt; 0 &amp;&amp; count($this-&gt;attachment) &lt; 1)
+                $this-&gt;message_type = &quot;alt&quot;;
+            if(strlen($this-&gt;AltBody) &gt; 0 &amp;&amp; count($this-&gt;attachment) &gt; 0)
+                $this-&gt;message_type = &quot;alt_attachments&quot;;
+        }
+    }
+
+    /**
+     * Returns a formatted header line.
+     * @access private
+     * @return string
+     */
+    function HeaderLine($name, $value) {
+        return $name . &quot;: &quot; . $value . $this-&gt;LE;
+    }
+
+    /**
+     * Returns a formatted mail line.
+     * @access private
+     * @return string
+     */
+    function TextLine($value) {
+        return $value . $this-&gt;LE;
+    }
+
+    /////////////////////////////////////////////////
+    // ATTACHMENT METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Adds an attachment from a path on the filesystem.
+     * Returns false if the file could not be found
+     * or accessed.
+     * @param string $path Path to the attachment.
+     * @param string $name Overrides the attachment name.
+     * @param string $encoding File encoding (see $Encoding).
+     * @param string $type File extension (MIME) type.
+     * @return bool
+     */
+    function AddAttachment($path, $name = &quot;&quot;, $encoding = &quot;base64&quot;, 
+                           $type = &quot;application/octet-stream&quot;) {
+        if(!@is_file($path))
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;file_access&quot;) . $path);
+            return false;
+        }
+
+        $filename = basename($path);
+        if($name == &quot;&quot;)
+            $name = $filename;
+
+        $cur = count($this-&gt;attachment);
+        $this-&gt;attachment[$cur][0] = $path;
+        $this-&gt;attachment[$cur][1] = $filename;
+        $this-&gt;attachment[$cur][2] = $name;
+        $this-&gt;attachment[$cur][3] = $encoding;
+        $this-&gt;attachment[$cur][4] = $type;
+        $this-&gt;attachment[$cur][5] = false; // isStringAttachment
+        $this-&gt;attachment[$cur][6] = &quot;attachment&quot;;
+        $this-&gt;attachment[$cur][7] = 0;
+
+        return true;
+    }
+
+    /**
+     * Attaches all fs, string, and binary attachments to the message.
+     * Returns an empty string on failure.
+     * @access private
+     * @return string
+     */
+    function AttachAll() {
+        // Return text of body
+        $mime = array();
+
+        // Add all attachments
+        for($i = 0; $i &lt; count($this-&gt;attachment); $i++)
+        {
+            // Check for string attachment
+            $bString = $this-&gt;attachment[$i][5];
+            if ($bString)
+                $string = $this-&gt;attachment[$i][0];
+            else
+                $path = $this-&gt;attachment[$i][0];
+
+            $filename    = $this-&gt;attachment[$i][1];
+            $name        = $this-&gt;attachment[$i][2];
+            $encoding    = $this-&gt;attachment[$i][3];
+            $type        = $this-&gt;attachment[$i][4];
+            $disposition = $this-&gt;attachment[$i][6];
+            $cid         = $this-&gt;attachment[$i][7];
+            
+            $mime[] = sprintf(&quot;--%s%s&quot;, $this-&gt;boundary[1], $this-&gt;LE);
+            $mime[] = sprintf(&quot;Content-Type: %s; name=\&quot;%s\&quot;%s&quot;, $type, $name, $this-&gt;LE);
+            $mime[] = sprintf(&quot;Content-Transfer-Encoding: %s%s&quot;, $encoding, $this-&gt;LE);
+
+            if($disposition == &quot;inline&quot;)
+                $mime[] = sprintf(&quot;Content-ID: &lt;%s&gt;%s&quot;, $cid, $this-&gt;LE);
+
+            $mime[] = sprintf(&quot;Content-Disposition: %s; filename=\&quot;%s\&quot;%s&quot;, 
+                              $disposition, $name, $this-&gt;LE.$this-&gt;LE);
+
+            // Encode as string attachment
+            if($bString)
+            {
+                $mime[] = $this-&gt;EncodeString($string, $encoding);
+                if($this-&gt;IsError()) { return &quot;&quot;; }
+                $mime[] = $this-&gt;LE.$this-&gt;LE;
+            }
+            else
+            {
+                $mime[] = $this-&gt;EncodeFile($path, $encoding);                
+                if($this-&gt;IsError()) { return &quot;&quot;; }
+                $mime[] = $this-&gt;LE.$this-&gt;LE;
+            }
+        }
+
+        $mime[] = sprintf(&quot;--%s--%s&quot;, $this-&gt;boundary[1], $this-&gt;LE);
+
+        return join(&quot;&quot;, $mime);
+    }
+    
+    /**
+     * Encodes attachment in requested format.  Returns an
+     * empty string on failure.
+     * @access private
+     * @return string
+     */
+    function EncodeFile ($path, $encoding = &quot;base64&quot;) {
+        if(!@$fd = fopen($path, &quot;rb&quot;))
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;file_open&quot;) . $path);
+            return &quot;&quot;;
+        }
+        $file_buffer = fread($fd, filesize($path));
+        $file_buffer = $this-&gt;EncodeString($file_buffer, $encoding);
+        fclose($fd);
+
+        return $file_buffer;
+    }
+
+    /**
+     * Encodes string to requested format. Returns an
+     * empty string on failure.
+     * @access private
+     * @return string
+     */
+    function EncodeString ($str, $encoding = &quot;base64&quot;) {
+        $encoded = &quot;&quot;;
+        switch(strtolower($encoding)) {
+          case &quot;base64&quot;:
+              // chunk_split is found in PHP &gt;= 3.0.6
+              $encoded = chunk_split(base64_encode($str), 76, $this-&gt;LE);
+              break;
+          case &quot;7bit&quot;:
+          case &quot;8bit&quot;:
+              $encoded = $this-&gt;FixEOL($str);
+              if (substr($encoded, -(strlen($this-&gt;LE))) != $this-&gt;LE)
+                $encoded .= $this-&gt;LE;
+              break;
+          case &quot;binary&quot;:
+              $encoded = $str;
+              break;
+          case &quot;quoted-printable&quot;:
+              $encoded = $this-&gt;EncodeQP($str);
+              break;
+          default:
+              $this-&gt;SetError($this-&gt;Lang(&quot;encoding&quot;) . $encoding);
+              break;
+        }
+        return $encoded;
+    }
+
+    /**
+     * Encode a header string to best of Q, B, quoted or none.  
+     * @access private
+     * @return string
+     */
+    function EncodeHeader ($str, $position = 'text') {
+      $x = 0;
+      
+      switch (strtolower($position)) {
+        case 'phrase':
+          if (!preg_match('/[\200-\377]/', $str)) {
+            // Can't use addslashes as we don't know what value has magic_quotes_sybase.
+            $encoded = addcslashes($str, &quot;\0..\37\177\\\&quot;&quot;);
+
+            if (($str == $encoded) &amp;&amp; !preg_match('/[^A-Za-z0-9!#$%&amp;\'*+\/=?^_`{|}~ -]/', $str))
+              return ($encoded);
+            else
+              return (&quot;\&quot;$encoded\&quot;&quot;);
+          }
+          $x = preg_match_all('/[^\040\041\043-\133\135-\176]/', $str, $matches);
+          break;
+        case 'comment':
+          $x = preg_match_all('/[()&quot;]/', $str, $matches);
+          // Fall-through
+        case 'text':
+        default:
+          $x += preg_match_all('/[\000-\010\013\014\016-\037\177-\377]/', $str, $matches);
+          break;
+      }
+
+      if ($x == 0)
+        return ($str);
+
+      $maxlen = 75 - 7 - strlen($this-&gt;CharSet);
+      // Try to select the encoding which should produce the shortest output
+      if (strlen($str)/3 &lt; $x) {
+        $encoding = 'B';
+        $encoded = base64_encode($str);
+        $maxlen -= $maxlen % 4;
+        $encoded = trim(chunk_split($encoded, $maxlen, &quot;\n&quot;));
+      } else {
+        $encoding = 'Q';
+        $encoded = $this-&gt;EncodeQ($str, $position);
+        $encoded = $this-&gt;WrapText($encoded, $maxlen, true);
+        $encoded = str_replace(&quot;=&quot;.$this-&gt;LE, &quot;\n&quot;, trim($encoded));
+      }
+
+      $encoded = preg_replace('/^(.*)$/m', &quot; =?&quot;.$this-&gt;CharSet.&quot;?$encoding?\\1?=&quot;, $encoded);
+      $encoded = trim(str_replace(&quot;\n&quot;, $this-&gt;LE, $encoded));
+      
+      return $encoded;
+    }
+    
+    /**
+     * Encode string to quoted-printable.  
+     * @access private
+     * @return string
+     */
+    function EncodeQP ($str) {
+        $encoded = $this-&gt;FixEOL($str);
+        if (substr($encoded, -(strlen($this-&gt;LE))) != $this-&gt;LE)
+            $encoded .= $this-&gt;LE;
+
+        // Replace every high ascii, control and = characters
+        $encoded = preg_replace('/([\000-\010\013\014\016-\037\075\177-\377])/e',
+                  &quot;'='.sprintf('%02X', ord('\\1'))&quot;, $encoded);
+        // Replace every spaces and tabs when it's the last character on a line
+        $encoded = preg_replace(&quot;/([\011\040])&quot;.$this-&gt;LE.&quot;/e&quot;,
+                  &quot;'='.sprintf('%02X', ord('\\1')).'&quot;.$this-&gt;LE.&quot;'&quot;, $encoded);
+
+        // Maximum line length of 76 characters before CRLF (74 + space + '=')
+        $encoded = $this-&gt;WrapText($encoded, 74, true);
+
+        return $encoded;
+    }
+
+    /**
+     * Encode string to q encoding.  
+     * @access private
+     * @return string
+     */
+    function EncodeQ ($str, $position = &quot;text&quot;) {
+        // There should not be any EOL in the string
+        $encoded = preg_replace(&quot;[\r\n]&quot;, &quot;&quot;, $str);
+
+        switch (strtolower($position)) {
+          case &quot;phrase&quot;:
+            $encoded = preg_replace(&quot;/([^A-Za-z0-9!*+\/ -])/e&quot;, &quot;'='.sprintf('%02X', ord('\\1'))&quot;, $encoded);
+            break;
+          case &quot;comment&quot;:
+            $encoded = preg_replace(&quot;/([\(\)\&quot;])/e&quot;, &quot;'='.sprintf('%02X', ord('\\1'))&quot;, $encoded);
+          case &quot;text&quot;:
+          default:
+            // Replace every high ascii, control =, ? and _ characters
+            $encoded = preg_replace('/([\000-\011\013\014\016-\037\075\077\137\177-\377])/e',
+                  &quot;'='.sprintf('%02X', ord('\\1'))&quot;, $encoded);
+            break;
+        }
+        
+        // Replace every spaces to _ (more readable than =20)
+        $encoded = str_replace(&quot; &quot;, &quot;_&quot;, $encoded);
+
+        return $encoded;
+    }
+
+    /**
+     * Adds a string or binary attachment (non-filesystem) to the list.
+     * This method can be used to attach ascii or binary data,
+     * such as a BLOB record from a database.
+     * @param string $string String attachment data.
+     * @param string $filename Name of the attachment.
+     * @param string $encoding File encoding (see $Encoding).
+     * @param string $type File extension (MIME) type.
+     * @return void
+     */
+    function AddStringAttachment($string, $filename, $encoding = &quot;base64&quot;, 
+                                 $type = &quot;application/octet-stream&quot;) {
+        // Append to $attachment array
+        $cur = count($this-&gt;attachment);
+        $this-&gt;attachment[$cur][0] = $string;
+        $this-&gt;attachment[$cur][1] = $filename;
+        $this-&gt;attachment[$cur][2] = $filename;
+        $this-&gt;attachment[$cur][3] = $encoding;
+        $this-&gt;attachment[$cur][4] = $type;
+        $this-&gt;attachment[$cur][5] = true; // isString
+        $this-&gt;attachment[$cur][6] = &quot;attachment&quot;;
+        $this-&gt;attachment[$cur][7] = 0;
+    }
+    
+    /**
+     * Adds an embedded attachment.  This can include images, sounds, and 
+     * just about any other document.  Make sure to set the $type to an 
+     * image type.  For JPEG images use &quot;image/jpeg&quot; and for GIF images 
+     * use &quot;image/gif&quot;.
+     * @param string $path Path to the attachment.
+     * @param string $cid Content ID of the attachment.  Use this to identify 
+     *        the Id for accessing the image in an HTML form.
+     * @param string $name Overrides the attachment name.
+     * @param string $encoding File encoding (see $Encoding).
+     * @param string $type File extension (MIME) type.  
+     * @return bool
+     */
+    function AddEmbeddedImage($path, $cid, $name = &quot;&quot;, $encoding = &quot;base64&quot;, 
+                              $type = &quot;application/octet-stream&quot;) {
+    
+        if(!@is_file($path))
+        {
+            $this-&gt;SetError($this-&gt;Lang(&quot;file_access&quot;) . $path);
+            return false;
+        }
+
+        $filename = basename($path);
+        if($name == &quot;&quot;)
+            $name = $filename;
+
+        // Append to $attachment array
+        $cur = count($this-&gt;attachment);
+        $this-&gt;attachment[$cur][0] = $path;
+        $this-&gt;attachment[$cur][1] = $filename;
+        $this-&gt;attachment[$cur][2] = $name;
+        $this-&gt;attachment[$cur][3] = $encoding;
+        $this-&gt;attachment[$cur][4] = $type;
+        $this-&gt;attachment[$cur][5] = false; // isStringAttachment
+        $this-&gt;attachment[$cur][6] = &quot;inline&quot;;
+        $this-&gt;attachment[$cur][7] = $cid;
+    
+        return true;
+    }
+    
+    /**
+     * Returns true if an inline attachment is present.
+     * @access private
+     * @return bool
+     */
+    function InlineImageExists() {
+        $result = false;
+        for($i = 0; $i &lt; count($this-&gt;attachment); $i++)
+        {
+            if($this-&gt;attachment[$i][6] == &quot;inline&quot;)
+            {
+                $result = true;
+                break;
+            }
+        }
+        
+        return $result;
+    }
+
+    /////////////////////////////////////////////////
+    // MESSAGE RESET METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Clears all recipients assigned in the TO array.  Returns void.
+     * @return void
+     */
+    function ClearAddresses() {
+        $this-&gt;to = array();
+    }
+
+    /**
+     * Clears all recipients assigned in the CC array.  Returns void.
+     * @return void
+     */
+    function ClearCCs() {
+        $this-&gt;cc = array();
+    }
+
+    /**
+     * Clears all recipients assigned in the BCC array.  Returns void.
+     * @return void
+     */
+    function ClearBCCs() {
+        $this-&gt;bcc = array();
+    }
+
+    /**
+     * Clears all recipients assigned in the ReplyTo array.  Returns void.
+     * @return void
+     */
+    function ClearReplyTos() {
+        $this-&gt;ReplyTo = array();
+    }
+
+    /**
+     * Clears all recipients assigned in the TO, CC and BCC
+     * array.  Returns void.
+     * @return void
+     */
+    function ClearAllRecipients() {
+        $this-&gt;to = array();
+        $this-&gt;cc = array();
+        $this-&gt;bcc = array();
+    }
+
+    /**
+     * Clears all previously set filesystem, string, and binary
+     * attachments.  Returns void.
+     * @return void
+     */
+    function ClearAttachments() {
+        $this-&gt;attachment = array();
+    }
+
+    /**
+     * Clears all custom headers.  Returns void.
+     * @return void
+     */
+    function ClearCustomHeaders() {
+        $this-&gt;CustomHeader = array();
+    }
+
+
+    /////////////////////////////////////////////////
+    // MISCELLANEOUS METHODS
+    /////////////////////////////////////////////////
+
+    /**
+     * Adds the error message to the error container.
+     * Returns void.
+     * @access private
+     * @return void
+     */
+    function SetError($msg) {
+        $this-&gt;error_count++;
+        $this-&gt;ErrorInfo = $msg;
+    }
+
+    /**
+     * Returns the proper RFC 822 formatted date. 
+     * @access private
+     * @return string
+     */
+    function RFCDate() {
+        $tz = date(&quot;Z&quot;);
+        $tzs = ($tz &lt; 0) ? &quot;-&quot; : &quot;+&quot;;
+        $tz = abs($tz);
+        $tz = ($tz/3600)*100 + ($tz%3600)/60;
+        $result = sprintf(&quot;%s %s%04d&quot;, date(&quot;D, j M Y H:i:s&quot;), $tzs, $tz);
+
+        return $result;
+    }
+
+    /**
+     * Returns Received header for message tracing. 
+     * @access private
+     * @return string
+     */
+    function Received() {
+        if ($this-&gt;ServerVar('SERVER_NAME') != '')
+        {
+            $protocol = ($this-&gt;ServerVar('HTTPS') == 'on') ? 'HTTPS' : 'HTTP';
+            $remote = $this-&gt;ServerVar('REMOTE_HOST');
+            if($remote == &quot;&quot;)
+                $remote = 'phpmailer';
+            $remote .= ' (['.$this-&gt;ServerVar('REMOTE_ADDR').'])';
+        }
+        else
+        {
+            $protocol = 'local';
+            $remote = $this-&gt;ServerVar('USER');
+            if($remote == '')
+                $remote = 'phpmailer';
+        }
+
+        $result = sprintf(&quot;Received: from %s %s\tby %s &quot; .
+                          &quot;with %s (PHPMailer);%s\t%s%s&quot;, $remote, $this-&gt;LE,
+                          $this-&gt;ServerHostname(), $protocol, $this-&gt;LE,
+                          $this-&gt;RFCDate(), $this-&gt;LE);
+
+        return $result;
+    }
+    
+    /**
+     * Returns the appropriate server variable.  Should work with both 
+     * PHP 4.1.0+ as well as older versions.  Returns an empty string 
+     * if nothing is found.
+     * @access private
+     * @return mixed
+     */
+    function ServerVar($varName) {
+        global $HTTP_SERVER_VARS;
+        global $HTTP_ENV_VARS;
+
+        if(!isset($_SERVER))
+        {
+            $_SERVER = $HTTP_SERVER_VARS;
+            if(!isset($_SERVER[&quot;REMOTE_ADDR&quot;]))
+                $_SERVER = $HTTP_ENV_VARS; // must be Apache
+        }
+        
+        if(isset($_SERVER[$varName]))
+            return $_SERVER[$varName];
+        else
+            return &quot;&quot;;
+    }
+
+    /**
+     * Returns the server hostname or 'localhost.localdomain' if unknown.
+     * @access private
+     * @return string
+     */
+    function ServerHostname() {
+        if ($this-&gt;Hostname != &quot;&quot;)
+            $result = $this-&gt;Hostname;
+        elseif ($this-&gt;ServerVar('SERVER_NAME') != &quot;&quot;)
+            $result = $this-&gt;ServerVar('SERVER_NAME');
+        else
+            $result = &quot;localhost.localdomain&quot;;
+
+        return $result;
+    }
+
+    /**
+     * Returns a message in the appropriate language.
+     * @access private
+     * @return string
+     */
+    function Lang($key) {
+        if(count($this-&gt;language) &lt; 1)
+            $this-&gt;SetLanguage(&quot;en&quot;); // set the default language
+    
+        if(isset($this-&gt;language[$key]))
+            return $this-&gt;language[$key];
+        else
+            return &quot;Language string failed to load: &quot; . $key;
+    }
+    
+    /**
+     * Returns true if an error occurred.
+     * @return bool
+     */
+    function IsError() {
+        return ($this-&gt;error_count &gt; 0);
+    }
+
+    /**
+     * Changes every end of line from CR or LF to CRLF.  
+     * @access private
+     * @return string
+     */
+    function FixEOL($str) {
+        $str = str_replace(&quot;\r\n&quot;, &quot;\n&quot;, $str);
+        $str = str_replace(&quot;\r&quot;, &quot;\n&quot;, $str);
+        $str = str_replace(&quot;\n&quot;, $this-&gt;LE, $str);
+        return $str;
+    }
+
+    /**
+     * Adds a custom header. 
+     * @return void
+     */
+    function AddCustomHeader($custom_header) {
+        $this-&gt;CustomHeader[] = explode(&quot;:&quot;, $custom_header, 2);
+    }
+}
+
+?&gt;

Added: trunk/inc/db/db_search.php
===================================================================
--- trunk/inc/db/db_search.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/db/db_search.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,44 @@
+&lt;?php
+
+require_once(&quot;inc/sm-db-settings.php&quot;);
+
+function q_Search_Artist($artists, $whereClause)
+{
+	if ( $artists == '')
+	{
+		$whereClause = &quot;u.uname like '$artists' $whereClause&quot;;
+	}
+	
+    $query = &quot;SELECT DISTINCT(u.uname), a.audio_artist, up.avatar_filename_small FROM audio AS a INNER JOIN user_profile  AS up ON up.uid=a.uid INNER JOIN user AS u ON u.uid=a.uid WHERE $whereClause&quot;;
+	echo $query;
+   $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function q_Search_AudioTitle($audiotitle, $whereClause)
+{
+    if ( $audiotitle == '')
+	{
+		$whereClause = &quot;a.audio_title like '$audiotitle' $whereClause&quot;;
+	}
+	
+ 	$query = &quot;SELECT DISTINCT(u.uname), a.audio_artist, a.audio_title, up.avatar_filename_small FROM audio AS a INNER JOIN user_profile AS up ON up.uid=a.uid INNER JOIN user AS u ON u.uid=a.uid WHERE $whereClause&quot;;
+	echo $query;
+   $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function q_Search_AudioAlbum($audio_album, $whereClause)
+{
+	if ( $audiotitle == '')
+	{
+		$whereClause = &quot;a.audio_album like '$audio_album' AND $whereClause&quot;;
+	}
+	
+    $query = &quot;SELECT DISTINCT(u.uname), a.audio_artist, a.audio_album, up.avatar_filename_small FROM audio AS a INNER JOIN user_profile AS up ON up.uid=a.uid INNER JOIN user AS u ON u.uid=a.uid WHERE $whereClause&quot;;
+	echo $query;
+   $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+?&gt;

Added: trunk/inc/external/getid3/extension.cache.dbm.php
===================================================================
--- trunk/inc/external/getid3/extension.cache.dbm.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/extension.cache.dbm.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,222 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// extension.cache.dbm.php - part of getID3()                  //
+// Please see readme.txt for more information                  //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// This extension written by Allan Hansen &lt;ah&#216;artemis*dk&gt;      //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+/**
+* This is a caching extension for getID3(). It works the exact same
+* way as the getID3 class, but return cached information very fast
+*
+* Example:
+*
+*    Normal getID3 usage (example):
+*
+*       require_once 'getid3/getid3.php';
+*       $getID3 = new getID3;
+*       $getID3-&gt;encoding = 'UTF-8';
+*       $info1 = $getID3-&gt;analyze('file1.flac');
+*       $info2 = $getID3-&gt;analyze('file2.wv');
+*
+*    getID3_cached usage:
+*
+*       require_once 'getid3/getid3.php';
+*       require_once 'getid3/getid3/extension.cache.dbm.php';
+*       $getID3 = new getID3_cached('db3', '/tmp/getid3_cache.dbm',
+*                                          '/tmp/getid3_cache.lock');
+*       $getID3-&gt;encoding = 'UTF-8';
+*       $info1 = $getID3-&gt;analyze('file1.flac');
+*       $info2 = $getID3-&gt;analyze('file2.wv');
+*
+*
+* Supported Cache Types
+*
+*   SQL Databases:          (use extension.cache.mysql)
+*
+*   cache_type          cache_options
+*   -------------------------------------------------------------------
+*   mysql               host, database, username, password
+*
+*
+*   DBM-Style Databases:    (this extension)
+*
+*   cache_type          cache_options
+*   -------------------------------------------------------------------
+*   gdbm                dbm_filename, lock_filename
+*   ndbm                dbm_filename, lock_filename
+*   db2                 dbm_filename, lock_filename
+*   db3                 dbm_filename, lock_filename
+*   db4                 dbm_filename, lock_filename  (PHP5 required)
+*
+*   PHP must have write access to both dbm_filename and lock_filename.
+*
+*
+* Recommended Cache Types
+*
+*   Infrequent updates, many reads      any DBM
+*   Frequent updates                    mysql
+*/
+
+
+class getID3_cached_dbm extends getID3
+{
+
+	// public: constructor - see top of this file for cache type and cache_options
+	function getID3_cached_dbm($cache_type, $dbm_filename, $lock_filename) {
+
+		// Check for dba extension
+		if (!extension_loaded('dba')) {
+			die('PHP is not compiled with dba support, required to use DBM style cache.');
+		}
+
+		// Check for specific dba driver
+		if (function_exists('dba_handlers')) {  // PHP 4.3.0+
+			if (!in_array('db3', dba_handlers())) {
+				die('PHP is not compiled --with '.$cache_type.' support, required to use DBM style cache.');
+			}
+		}
+		else { // PHP &lt;= 4.2.3
+			ob_start(); // nasty, buy the only way to check...
+			phpinfo();
+			$contents = ob_get_contents();
+			ob_end_clean();
+			if (!strstr($contents, $cache_type)) {
+				die('PHP is not compiled --with '.$cache_type.' support, required to use DBM style cache.');
+			}
+		}
+
+		// Create lock file if needed
+		if (!file_exists($lock_filename)) {
+			if (!touch($lock_filename)) {
+				die('failed to create lock file: ' . $lock_filename);
+			}
+		}
+
+		// Open lock file for writing
+		if (!is_writeable($lock_filename)) {
+			die('lock file: ' . $lock_filename . ' is not writable');
+		}
+		$this-&gt;lock = fopen($lock_filename, 'w');
+
+		// Acquire exclusive write lock to lock file
+		flock($this-&gt;lock, LOCK_EX);
+
+		// Create dbm-file if needed
+		if (!file_exists($dbm_filename)) {
+			if (!touch($dbm_filename)) {
+				die('failed to create dbm file: ' . $dbm_filename);
+			}
+		}
+
+		// Try to open dbm file for writing
+		$this-&gt;dba = @dba_open($dbm_filename, 'w', $cache_type);
+		if (!$this-&gt;dba) {
+
+			// Failed - create new dbm file
+			$this-&gt;dba = dba_open($dbm_filename, 'n', $cache_type);
+
+			if (!$this-&gt;dba) {
+				die('failed to create dbm file: ' . $dbm_filename);
+			}
+
+			// Insert getID3 version number
+			dba_insert(GETID3_VERSION, GETID3_VERSION, $this-&gt;dba);
+		}
+
+		// Init misc values
+		$this-&gt;cache_type   = $cache_type;
+		$this-&gt;dbm_filename = $dbm_filename;
+
+		// Register destructor
+		register_shutdown_function(array($this, '__destruct'));
+
+		// Check version number and clear cache if changed
+		if (dba_fetch(GETID3_VERSION, $this-&gt;dba) != GETID3_VERSION) {
+			$this-&gt;clear_cache();
+		}
+
+		parent::getID3();
+	}
+
+
+
+	// public: destuctor
+	function __destruct() {
+
+		// Close dbm file
+		@dba_close($this-&gt;dba);
+
+		// Release exclusive lock
+		@flock($this-&gt;lock, LOCK_UN);
+
+		// Close lock file
+		@fclose($this-&gt;lock);
+	}
+
+
+
+	// public: clear cache
+	function clear_cache() {
+
+		// Close dbm file
+		dba_close($this-&gt;dba);
+
+		// Create new dbm file
+		$this-&gt;dba = dba_open($this-&gt;dbm_filename, 'n', $this-&gt;cache_type);
+
+		if (!$this-&gt;dba) {
+			die('failed to clear cache/recreate dbm file: ' . $this-&gt;dbm_filename);
+		}
+
+		// Insert getID3 version number
+		dba_insert(GETID3_VERSION, GETID3_VERSION, $this-&gt;dba);
+
+		// Reregister shutdown function
+		register_shutdown_function(array($this, '__destruct'));
+	}
+
+
+
+	// public: analyze file
+	function analyze($filename) {
+
+		if (file_exists($filename)) {
+
+			// Calc key     filename::mod_time::size    - should be unique
+			$key = $filename . '::' . filemtime($filename) . '::' . filesize($filename);
+
+			// Loopup key
+			$result = dba_fetch($key, $this-&gt;dba);
+
+			// Hit
+			if ($result !== false) {
+				return unserialize($result);
+			}
+		}
+
+		// Miss
+		$result = parent::analyze($filename);
+
+		// Save result
+		if (file_exists($filename)) {
+			dba_insert($key, serialize($result), $this-&gt;dba);
+		}
+
+		return $result;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/extension.cache.dbm.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/extension.cache.mysql.php
===================================================================
--- trunk/inc/external/getid3/extension.cache.mysql.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/extension.cache.mysql.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,171 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// extension.cache.mysql.php - part of getID3()                //
+// Please see readme.txt for more information                  //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// This extension written by Allan Hansen &lt;ah&#216;artemis*dk&gt;      //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+/**
+* This is a caching extension for getID3(). It works the exact same
+* way as the getID3 class, but return cached information very fast
+*
+* Example:  (see also demo.cache.mysql.php in /demo/)
+*
+*    Normal getID3 usage (example):
+*
+*       require_once 'getid3/getid3.php';
+*       $getID3 = new getID3;
+*       $getID3-&gt;encoding = 'UTF-8';
+*       $info1 = $getID3-&gt;analyze('file1.flac');
+*       $info2 = $getID3-&gt;analyze('file2.wv');
+*
+*    getID3_cached usage:
+*
+*       require_once 'getid3/getid3.php';
+*       require_once 'getid3/getid3/extension.cache.mysql.php';
+*       $getID3 = new getID3_cached_mysql('localhost', 'database',
+*                                         'username', 'password');
+*       $getID3-&gt;encoding = 'UTF-8';
+*       $info1 = $getID3-&gt;analyze('file1.flac');
+*       $info2 = $getID3-&gt;analyze('file2.wv');
+*
+*
+* Supported Cache Types    (this extension)
+*
+*   SQL Databases:
+*
+*   cache_type          cache_options
+*   -------------------------------------------------------------------
+*   mysql               host, database, username, password
+*
+*
+*   DBM-Style Databases:    (use extension.cache.dbm)
+*
+*   cache_type          cache_options
+*   -------------------------------------------------------------------
+*   gdbm                dbm_filename, lock_filename
+*   ndbm                dbm_filename, lock_filename
+*   db2                 dbm_filename, lock_filename
+*   db3                 dbm_filename, lock_filename
+*   db4                 dbm_filename, lock_filename  (PHP5 required)
+*
+*   PHP must have write access to both dbm_filename and lock_filename.
+*
+*
+* Recommended Cache Types
+*
+*   Infrequent updates, many reads      any DBM
+*   Frequent updates                    mysql
+*/
+
+
+class getID3_cached_mysql extends getID3
+{
+
+	// private vars
+	var $cursor;
+	var $connection;
+
+
+	// public: constructor - see top of this file for cache type and cache_options
+	function getID3_cached_mysql($host, $database, $username, $password) {
+
+		// Check for mysql support
+		if (!function_exists('mysql_pconnect')) {
+			die('PHP not compiled with mysql support.');
+		}
+
+		// Connect to database
+		$this-&gt;connection = mysql_pconnect($host, $username, $password);
+		if (!$this-&gt;connection) {
+			die('mysql_pconnect() failed - check permissions and spelling.');
+		}
+
+		// Select database
+		if (!mysql_select_db($database, $this-&gt;connection)) {
+			die('Cannot use database '.$database);
+		}
+
+		// Create cache table if not exists
+		$this-&gt;create_table();
+
+		// Check version number and clear cache if changed
+		$this-&gt;cursor = mysql_query(&quot;SELECT `value` FROM `getid3_cache` WHERE (`filename` = '&quot;.GETID3_VERSION.&quot;') AND (`filesize` = '-1') AND (`filetime` = '-1') AND (`analyzetime` = '-1')&quot;, $this-&gt;connection);
+		list($version) = @mysql_fetch_array($this-&gt;cursor);
+		if ($version != GETID3_VERSION) {
+			$this-&gt;clear_cache();
+		}
+
+		parent::getID3();
+	}
+
+
+
+	// public: clear cache
+	function clear_cache() {
+
+		$this-&gt;cursor = mysql_query(&quot;DELETE FROM `getid3_cache`&quot;, $this-&gt;connection);
+		$this-&gt;cursor = mysql_query(&quot;INSERT INTO `getid3_cache` VALUES ('&quot;.GETID3_VERSION.&quot;', -1, -1, -1, '&quot;.GETID3_VERSION.&quot;')&quot;, $this-&gt;connection);
+	}
+
+
+
+	// public: analyze file
+	function analyze($filename) {
+
+		if (file_exists($filename)) {
+
+			// Short-hands
+			$filetime = filemtime($filename);
+			$filesize = filesize($filename);
+			$filenam2 = mysql_escape_string($filename);
+
+			// Loopup file
+			$this-&gt;cursor = mysql_query(&quot;SELECT `value` FROM `getid3_cache` WHERE (`filename`='&quot;.$filenam2.&quot;') AND (`filesize`='&quot;.$filesize.&quot;') AND (`filetime`='&quot;.$filetime.&quot;')&quot;, $this-&gt;connection);
+			list($result) = @mysql_fetch_array($this-&gt;cursor);
+
+			// Hit
+			if ($result) {
+				return unserialize($result);
+			}
+		}
+
+		// Miss
+		$result = parent::analyze($filename);
+
+		// Save result
+		if (file_exists($filename)) {
+			$res2 = mysql_escape_string(serialize($result));
+			$this-&gt;cursor = mysql_query(&quot;INSERT INTO `getid3_cache` (`filename`, `filesize`, `filetime`, `analyzetime`, `value`) VALUES ('&quot;.$filenam2.&quot;', '&quot;.$filesize.&quot;', '&quot;.$filetime.&quot;', '&quot;.time().&quot;', '&quot;.$res2.&quot;')&quot;, $this-&gt;connection);
+		}
+		return $result;
+	}
+
+
+
+	// private: (re)create sql table
+	function create_table($drop = false) {
+
+		$this-&gt;cursor = mysql_query(&quot;CREATE TABLE IF NOT EXISTS `getid3_cache` (
+			`filename` VARCHAR(255) NOT NULL DEFAULT '',
+			`filesize` INT(11) NOT NULL DEFAULT '0',
+			`filetime` INT(11) NOT NULL DEFAULT '0',
+			`analyzetime` INT(11) NOT NULL DEFAULT '0',
+			`value` TEXT NOT NULL,
+			PRIMARY KEY (`filename`,`filesize`,`filetime`)) TYPE=MyISAM&quot;, $this-&gt;connection);
+		echo mysql_error($this-&gt;connection);
+	}
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/extension.cache.mysql.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/getid3.lib.php
===================================================================
--- trunk/inc/external/getid3/getid3.lib.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/getid3.lib.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,1427 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// getid3.lib.php - part of getID3()                           //
+// See readme.txt for more details                             //
+//                                                             //
+/////////////////////////////////////////////////////////////////
+// getid3_lib::GetURLImageSize( $urlpic ) determines the       //
+// dimensions of local/remote URL pictures.                    //
+// returns array with ($width, $height, $type)                 //
+//                                                             //
+// Thanks to: Oyvind Hallsteinsen aka Gosub / ELq -            //
+// gosub&#216;elq*org  for the original size determining code       //
+//                                                             //
+// PHP Hack by Filipe Laborde-Basto Oct 21/2000                //
+// FREELY DISTRIBUTABLE -- use at your sole discretion! :)     //
+// Enjoy. (Not to be sold in commercial packages though,       //
+// keep it free!) Feel free to contact me at fil&#216;rezox*com     //
+// (<A HREF="http://www.rezox.com">http://www.rezox.com</A>)                                      //
+//                                                             //
+// Modified by James Heinrich &lt;getid3&#216;users*sourceforge*net&gt;   //
+// June 1, 2001 - created GetDataImageSize($imgData) by        //
+// seperating the fopen() stuff to GetURLImageSize($urlpic)    //
+// which then calls GetDataImageSize($imgData). The idea being //
+// you can call GetDataImageSize($imgData) with image data     //
+// from a database etc.                                        //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+define('GETID3_GIF_SIG',     &quot;\x47\x49\x46&quot;);  // 'GIF'
+define('GETID3_PNG_SIG',     &quot;\x89\x50\x4E\x47\x0D\x0A\x1A\x0A&quot;);
+define('GETID3_JPG_SIG',     &quot;\xFF\xD8\xFF&quot;);
+define('GETID3_JPG_SOS',     &quot;\xDA&quot;); // Start Of Scan - image data start
+define('GETID3_JPG_SOF0',    &quot;\xC0&quot;); // Start Of Frame N
+define('GETID3_JPG_SOF1',    &quot;\xC1&quot;); // N indicates which compression process
+define('GETID3_JPG_SOF2',    &quot;\xC2&quot;); // Only SOF0-SOF2 are now in common use
+define('GETID3_JPG_SOF3',    &quot;\xC3&quot;);
+// NB: codes C4 and CC are *not* SOF markers
+define('GETID3_JPG_SOF5',    &quot;\xC5&quot;);
+define('GETID3_JPG_SOF6',    &quot;\xC6&quot;);
+define('GETID3_JPG_SOF7',    &quot;\xC7&quot;);
+define('GETID3_JPG_SOF9',    &quot;\xC9&quot;);
+define('GETID3_JPG_SOF10',   &quot;\xCA&quot;);
+define('GETID3_JPG_SOF11',   &quot;\xCB&quot;);
+// NB: codes C4 and CC are *not* SOF markers
+define('GETID3_JPG_SOF13',   &quot;\xCD&quot;);
+define('GETID3_JPG_SOF14',   &quot;\xCE&quot;);
+define('GETID3_JPG_SOF15',   &quot;\xCF&quot;);
+define('GETID3_JPG_EOI',     &quot;\xD9&quot;); // End Of Image (end of datastream)
+
+
+
+class getid3_lib
+{
+
+	function PrintHexBytes($string, $hex=true, $spaces=true, $htmlsafe=true) {
+		$returnstring = '';
+		for ($i = 0; $i &lt; strlen($string); $i++) {
+			if ($hex) {
+				$returnstring .= str_pad(dechex(ord($string{$i})), 2, '0', STR_PAD_LEFT);
+			} else {
+				$returnstring .= ' '.(ereg(&quot;[\x20-\x7E]&quot;, $string{$i}) ? $string{$i} : '&#164;');
+			}
+			if ($spaces) {
+				$returnstring .= ' ';
+			}
+		}
+		if ($htmlsafe) {
+			$returnstring = htmlentities($returnstring);
+		}
+		return $returnstring;
+	}
+
+	function SafeStripSlashes($text) {
+		if (get_magic_quotes_gpc()) {
+			return stripslashes($text);
+		}
+		return $text;
+	}
+
+
+	function trunc($floatnumber) {
+		// truncates a floating-point number at the decimal point
+		// returns int (if possible, otherwise float)
+		if ($floatnumber &gt;= 1) {
+			$truncatednumber = floor($floatnumber);
+		} elseif ($floatnumber &lt;= -1) {
+			$truncatednumber = ceil($floatnumber);
+		} else {
+			$truncatednumber = 0;
+		}
+		if ($truncatednumber &lt;= pow(2, 30)) {
+			$truncatednumber = (int) $truncatednumber;
+		}
+		return $truncatednumber;
+	}
+
+
+	function CastAsInt($floatnum) {
+		// convert to float if not already
+		$floatnum = (float) $floatnum;
+
+		// convert a float to type int, only if possible
+		if (getid3_lib::trunc($floatnum) == $floatnum) {
+			// it's not floating point
+			if ($floatnum &lt;= pow(2, 30)) {
+				// it's within int range
+				$floatnum = (int) $floatnum;
+			}
+		}
+		return $floatnum;
+	}
+
+
+	function DecimalBinary2Float($binarynumerator) {
+		$numerator   = getid3_lib::Bin2Dec($binarynumerator);
+		$denominator = getid3_lib::Bin2Dec('1'.str_repeat('0', strlen($binarynumerator)));
+		return ($numerator / $denominator);
+	}
+
+
+	function NormalizeBinaryPoint($binarypointnumber, $maxbits=52) {
+		// <A HREF="http://www.scri.fsu.edu/~jac/MAD3401/Backgrnd/binary.html">http://www.scri.fsu.edu/~jac/MAD3401/Backgrnd/binary.html</A>
+		if (strpos($binarypointnumber, '.') === false) {
+			$binarypointnumber = '0.'.$binarypointnumber;
+		} elseif ($binarypointnumber{0} == '.') {
+			$binarypointnumber = '0'.$binarypointnumber;
+		}
+		$exponent = 0;
+		while (($binarypointnumber{0} != '1') || (substr($binarypointnumber, 1, 1) != '.')) {
+			if (substr($binarypointnumber, 1, 1) == '.') {
+				$exponent--;
+				$binarypointnumber = substr($binarypointnumber, 2, 1).'.'.substr($binarypointnumber, 3);
+			} else {
+				$pointpos = strpos($binarypointnumber, '.');
+				$exponent += ($pointpos - 1);
+				$binarypointnumber = str_replace('.', '', $binarypointnumber);
+				$binarypointnumber = $binarypointnumber{0}.'.'.substr($binarypointnumber, 1);
+			}
+		}
+		$binarypointnumber = str_pad(substr($binarypointnumber, 0, $maxbits + 2), $maxbits + 2, '0', STR_PAD_RIGHT);
+		return array('normalized'=&gt;$binarypointnumber, 'exponent'=&gt;(int) $exponent);
+	}
+
+
+	function Float2BinaryDecimal($floatvalue) {
+		// <A HREF="http://www.scri.fsu.edu/~jac/MAD3401/Backgrnd/binary.html">http://www.scri.fsu.edu/~jac/MAD3401/Backgrnd/binary.html</A>
+		$maxbits = 128; // to how many bits of precision should the calculations be taken?
+		$intpart   = getid3_lib::trunc($floatvalue);
+		$floatpart = abs($floatvalue - $intpart);
+		$pointbitstring = '';
+		while (($floatpart != 0) &amp;&amp; (strlen($pointbitstring) &lt; $maxbits)) {
+			$floatpart *= 2;
+			$pointbitstring .= (string) getid3_lib::trunc($floatpart);
+			$floatpart -= getid3_lib::trunc($floatpart);
+		}
+		$binarypointnumber = decbin($intpart).'.'.$pointbitstring;
+		return $binarypointnumber;
+	}
+
+
+	function Float2String($floatvalue, $bits) {
+		// <A HREF="http://www.scri.fsu.edu/~jac/MAD3401/Backgrnd/ieee-expl.html">http://www.scri.fsu.edu/~jac/MAD3401/Backgrnd/ieee-expl.html</A>
+		switch ($bits) {
+			case 32:
+				$exponentbits = 8;
+				$fractionbits = 23;
+				break;
+
+			case 64:
+				$exponentbits = 11;
+				$fractionbits = 52;
+				break;
+
+			default:
+				return false;
+				break;
+		}
+		if ($floatvalue &gt;= 0) {
+			$signbit = '0';
+		} else {
+			$signbit = '1';
+		}
+		$normalizedbinary  = getid3_lib::NormalizeBinaryPoint(getid3_lib::Float2BinaryDecimal($floatvalue), $fractionbits);
+		$biasedexponent    = pow(2, $exponentbits - 1) - 1 + $normalizedbinary['exponent']; // (127 or 1023) +/- exponent
+		$exponentbitstring = str_pad(decbin($biasedexponent), $exponentbits, '0', STR_PAD_LEFT);
+		$fractionbitstring = str_pad(substr($normalizedbinary['normalized'], 2), $fractionbits, '0', STR_PAD_RIGHT);
+
+		return getid3_lib::BigEndian2String(getid3_lib::Bin2Dec($signbit.$exponentbitstring.$fractionbitstring), $bits % 8, false);
+	}
+
+
+	function LittleEndian2Float($byteword) {
+		return getid3_lib::BigEndian2Float(strrev($byteword));
+	}
+
+
+	function BigEndian2Float($byteword) {
+		// ANSI/IEEE Standard 754-1985, Standard for Binary Floating Point Arithmetic
+		// <A HREF="http://www.psc.edu/general/software/packages/ieee/ieee.html">http://www.psc.edu/general/software/packages/ieee/ieee.html</A>
+		// <A HREF="http://www.scri.fsu.edu/~jac/MAD3401/Backgrnd/ieee.html">http://www.scri.fsu.edu/~jac/MAD3401/Backgrnd/ieee.html</A>
+
+		$bitword = getid3_lib::BigEndian2Bin($byteword);
+		$signbit = $bitword{0};
+
+		switch (strlen($byteword) * 8) {
+			case 32:
+				$exponentbits = 8;
+				$fractionbits = 23;
+				break;
+
+			case 64:
+				$exponentbits = 11;
+				$fractionbits = 52;
+				break;
+
+			case 80:
+				// 80-bit Apple SANE format
+				// <A HREF="http://www.mactech.com/articles/mactech/Vol.06/06.01/SANENormalized/">http://www.mactech.com/articles/mactech/Vol.06/06.01/SANENormalized/</A>
+				$exponentstring = substr($bitword, 1, 15);
+				$isnormalized = intval($bitword{16});
+				$fractionstring = substr($bitword, 17, 63);
+				$exponent = pow(2, getid3_lib::Bin2Dec($exponentstring) - 16383);
+				$fraction = $isnormalized + getid3_lib::DecimalBinary2Float($fractionstring);
+				$floatvalue = $exponent * $fraction;
+				if ($signbit == '1') {
+					$floatvalue *= -1;
+				}
+				return $floatvalue;
+				break;
+
+			default:
+				return false;
+				break;
+		}
+		$exponentstring = substr($bitword, 1, $exponentbits);
+		$fractionstring = substr($bitword, $exponentbits + 1, $fractionbits);
+		$exponent = getid3_lib::Bin2Dec($exponentstring);
+		$fraction = getid3_lib::Bin2Dec($fractionstring);
+
+		if (($exponent == (pow(2, $exponentbits) - 1)) &amp;&amp; ($fraction != 0)) {
+			// Not a Number
+			$floatvalue = false;
+		} elseif (($exponent == (pow(2, $exponentbits) - 1)) &amp;&amp; ($fraction == 0)) {
+			if ($signbit == '1') {
+				$floatvalue = '-infinity';
+			} else {
+				$floatvalue = '+infinity';
+			}
+		} elseif (($exponent == 0) &amp;&amp; ($fraction == 0)) {
+			if ($signbit == '1') {
+				$floatvalue = -0;
+			} else {
+				$floatvalue = 0;
+			}
+			$floatvalue = ($signbit ? 0 : -0);
+		} elseif (($exponent == 0) &amp;&amp; ($fraction != 0)) {
+			// These are 'unnormalized' values
+			$floatvalue = pow(2, (-1 * (pow(2, $exponentbits - 1) - 2))) * getid3_lib::DecimalBinary2Float($fractionstring);
+			if ($signbit == '1') {
+				$floatvalue *= -1;
+			}
+		} elseif ($exponent != 0) {
+			$floatvalue = pow(2, ($exponent - (pow(2, $exponentbits - 1) - 1))) * (1 + getid3_lib::DecimalBinary2Float($fractionstring));
+			if ($signbit == '1') {
+				$floatvalue *= -1;
+			}
+		}
+		return (float) $floatvalue;
+	}
+
+
+	function BigEndian2Int($byteword, $synchsafe=false, $signed=false) {
+		$intvalue = 0;
+		$bytewordlen = strlen($byteword);
+		for ($i = 0; $i &lt; $bytewordlen; $i++) {
+			if ($synchsafe) { // disregard MSB, effectively 7-bit bytes
+				$intvalue = $intvalue | (ord($byteword{$i}) &amp; 0x7F) &lt;&lt; (($bytewordlen - 1 - $i) * 7);
+			} else {
+				$intvalue += ord($byteword{$i}) * pow(256, ($bytewordlen - 1 - $i));
+			}
+		}
+		if ($signed &amp;&amp; !$synchsafe) {
+			// synchsafe ints are not allowed to be signed
+			switch ($bytewordlen) {
+				case 1:
+				case 2:
+				case 3:
+				case 4:
+					$signmaskbit = 0x80 &lt;&lt; (8 * ($bytewordlen - 1));
+					if ($intvalue &amp; $signmaskbit) {
+						$intvalue = 0 - ($intvalue &amp; ($signmaskbit - 1));
+					}
+					break;
+
+				default:
+					die('ERROR: Cannot have signed integers larger than 32-bits in getid3_lib::BigEndian2Int()');
+					break;
+			}
+		}
+		return getid3_lib::CastAsInt($intvalue);
+	}
+
+
+	function LittleEndian2Int($byteword, $signed=false) {
+		return getid3_lib::BigEndian2Int(strrev($byteword), false, $signed);
+	}
+
+
+	function BigEndian2Bin($byteword) {
+		$binvalue = '';
+		$bytewordlen = strlen($byteword);
+		for ($i = 0; $i &lt; $bytewordlen; $i++) {
+			$binvalue .= str_pad(decbin(ord($byteword{$i})), 8, '0', STR_PAD_LEFT);
+		}
+		return $binvalue;
+	}
+
+
+	function BigEndian2String($number, $minbytes=1, $synchsafe=false, $signed=false) {
+		if ($number &lt; 0) {
+			return false;
+		}
+		$maskbyte = (($synchsafe || $signed) ? 0x7F : 0xFF);
+		$intstring = '';
+		if ($signed) {
+			if ($minbytes &gt; 4) {
+				die('ERROR: Cannot have signed integers larger than 32-bits in getid3_lib::BigEndian2String()');
+			}
+			$number = $number &amp; (0x80 &lt;&lt; (8 * ($minbytes - 1)));
+		}
+		while ($number != 0) {
+			$quotient = ($number / ($maskbyte + 1));
+			$intstring = chr(ceil(($quotient - floor($quotient)) * $maskbyte)).$intstring;
+			$number = floor($quotient);
+		}
+		return str_pad($intstring, $minbytes, &quot;\x00&quot;, STR_PAD_LEFT);
+	}
+
+
+	function Dec2Bin($number) {
+		while ($number &gt;= 256) {
+			$bytes[] = (($number / 256) - (floor($number / 256))) * 256;
+			$number = floor($number / 256);
+		}
+		$bytes[] = $number;
+		$binstring = '';
+		for ($i = 0; $i &lt; count($bytes); $i++) {
+			$binstring = (($i == count($bytes) - 1) ? decbin($bytes[$i]) : str_pad(decbin($bytes[$i]), 8, '0', STR_PAD_LEFT)).$binstring;
+		}
+		return $binstring;
+	}
+
+
+	function Bin2Dec($binstring, $signed=false) {
+		$signmult = 1;
+		if ($signed) {
+			if ($binstring{0} == '1') {
+				$signmult = -1;
+			}
+			$binstring = substr($binstring, 1);
+		}
+		$decvalue = 0;
+		for ($i = 0; $i &lt; strlen($binstring); $i++) {
+			$decvalue += ((int) substr($binstring, strlen($binstring) - $i - 1, 1)) * pow(2, $i);
+		}
+		return getid3_lib::CastAsInt($decvalue * $signmult);
+	}
+
+
+	function Bin2String($binstring) {
+		// return 'hi' for input of '0110100001101001'
+		$string = '';
+		$binstringreversed = strrev($binstring);
+		for ($i = 0; $i &lt; strlen($binstringreversed); $i += 8) {
+			$string = chr(getid3_lib::Bin2Dec(strrev(substr($binstringreversed, $i, 8)))).$string;
+		}
+		return $string;
+	}
+
+
+	function LittleEndian2String($number, $minbytes=1, $synchsafe=false) {
+		$intstring = '';
+		while ($number &gt; 0) {
+			if ($synchsafe) {
+				$intstring = $intstring.chr($number &amp; 127);
+				$number &gt;&gt;= 7;
+			} else {
+				$intstring = $intstring.chr($number &amp; 255);
+				$number &gt;&gt;= 8;
+			}
+		}
+		return str_pad($intstring, $minbytes, &quot;\x00&quot;, STR_PAD_RIGHT);
+	}
+
+
+	function array_merge_clobber($array1, $array2) {
+		// written by kc&#216;hireability*com
+		// taken from <A HREF="http://www.php.net/manual/en/function.array-merge-recursive.php">http://www.php.net/manual/en/function.array-merge-recursive.php</A>
+		if (!is_array($array1) || !is_array($array2)) {
+			return false;
+		}
+		$newarray = $array1;
+		foreach ($array2 as $key =&gt; $val) {
+			if (is_array($val) &amp;&amp; isset($newarray[$key]) &amp;&amp; is_array($newarray[$key])) {
+				$newarray[$key] = getid3_lib::array_merge_clobber($newarray[$key], $val);
+			} else {
+				$newarray[$key] = $val;
+			}
+		}
+		return $newarray;
+	}
+
+
+	function array_merge_noclobber($array1, $array2) {
+		if (!is_array($array1) || !is_array($array2)) {
+			return false;
+		}
+		$newarray = $array1;
+		foreach ($array2 as $key =&gt; $val) {
+			if (is_array($val) &amp;&amp; isset($newarray[$key]) &amp;&amp; is_array($newarray[$key])) {
+				$newarray[$key] = getid3_lib::array_merge_noclobber($newarray[$key], $val);
+			} elseif (!isset($newarray[$key])) {
+				$newarray[$key] = $val;
+			}
+		}
+		return $newarray;
+	}
+
+
+	function fileextension($filename, $numextensions=1) {
+		if (strstr($filename, '.')) {
+			$reversedfilename = strrev($filename);
+			$offset = 0;
+			for ($i = 0; $i &lt; $numextensions; $i++) {
+				$offset = strpos($reversedfilename, '.', $offset + 1);
+				if ($offset === false) {
+					return '';
+				}
+			}
+			return strrev(substr($reversedfilename, 0, $offset));
+		}
+		return '';
+	}
+
+
+	function PlaytimeString($playtimeseconds) {
+		$contentseconds = round((($playtimeseconds / 60) - floor($playtimeseconds / 60)) * 60);
+		$contentminutes = floor($playtimeseconds / 60);
+		if ($contentseconds &gt;= 60) {
+			$contentseconds -= 60;
+			$contentminutes++;
+		}
+		return intval($contentminutes).':'.str_pad($contentseconds, 2, 0, STR_PAD_LEFT);
+	}
+
+
+	function image_type_to_mime_type($imagetypeid) {
+		// only available in PHP v4.3.0+
+		static $image_type_to_mime_type = array();
+		if (empty($image_type_to_mime_type)) {
+			$image_type_to_mime_type[1]  = 'image/gif';                     // GIF
+			$image_type_to_mime_type[2]  = 'image/jpeg';                    // JPEG
+			$image_type_to_mime_type[3]  = 'image/png';                     // PNG
+			$image_type_to_mime_type[4]  = 'application/x-shockwave-flash'; // Flash
+			$image_type_to_mime_type[5]  = 'image/psd';                     // PSD
+			$image_type_to_mime_type[6]  = 'image/bmp';                     // BMP
+			$image_type_to_mime_type[7]  = 'image/tiff';                    // TIFF: little-endian (Intel)
+			$image_type_to_mime_type[8]  = 'image/tiff';                    // TIFF: big-endian (Motorola)
+			//$image_type_to_mime_type[9]  = 'image/jpc';                   // JPC
+			//$image_type_to_mime_type[10] = 'image/jp2';                   // JPC
+			//$image_type_to_mime_type[11] = 'image/jpx';                   // JPC
+			//$image_type_to_mime_type[12] = 'image/jb2';                   // JPC
+			$image_type_to_mime_type[13] = 'application/x-shockwave-flash'; // Shockwave
+			$image_type_to_mime_type[14] = 'image/iff';                     // IFF
+		}
+		return (isset($image_type_to_mime_type[$imagetypeid]) ? $image_type_to_mime_type[$imagetypeid] : 'application/octet-stream');
+	}
+
+
+	function DateMac2Unix($macdate) {
+		// Macintosh timestamp: seconds since 00:00h January 1, 1904
+		// UNIX timestamp:      seconds since 00:00h January 1, 1970
+		return getid3_lib::CastAsInt($macdate - 2082844800);
+	}
+
+
+	function FixedPoint8_8($rawdata) {
+		return getid3_lib::BigEndian2Int(substr($rawdata, 0, 1)) + (float) (getid3_lib::BigEndian2Int(substr($rawdata, 1, 1)) / pow(2, 8));
+	}
+
+
+	function FixedPoint16_16($rawdata) {
+		return getid3_lib::BigEndian2Int(substr($rawdata, 0, 2)) + (float) (getid3_lib::BigEndian2Int(substr($rawdata, 2, 2)) / pow(2, 16));
+	}
+
+
+	function FixedPoint2_30($rawdata) {
+		$binarystring = getid3_lib::BigEndian2Bin($rawdata);
+		return getid3_lib::Bin2Dec(substr($binarystring, 0, 2)) + (float) (getid3_lib::Bin2Dec(substr($binarystring, 2, 30)) / pow(2, 30));
+	}
+
+
+	function CreateDeepArray($ArrayPath, $Separator, $Value) {
+		// assigns $Value to a nested array path:
+		//   $foo = getid3_lib::CreateDeepArray('/path/to/my', '/', 'file.txt')
+		// is the same as:
+		//   $foo = array('path'=&gt;array('to'=&gt;'array('my'=&gt;array('file.txt'))));
+		// or
+		//   $foo['path']['to']['my'] = 'file.txt';
+		while ($ArrayPath{0} == $Separator) {
+			$ArrayPath = substr($ArrayPath, 1);
+		}
+		if (($pos = strpos($ArrayPath, $Separator)) !== false) {
+			$ReturnedArray[substr($ArrayPath, 0, $pos)] = getid3_lib::CreateDeepArray(substr($ArrayPath, $pos + 1), $Separator, $Value);
+		} else {
+			$ReturnedArray[$ArrayPath] = $Value;
+		}
+		return $ReturnedArray;
+	}
+
+	function array_max($arraydata, $returnkey=false) {
+		$maxvalue = false;
+		$maxkey = false;
+		foreach ($arraydata as $key =&gt; $value) {
+			if (!is_array($value)) {
+				if ($value &gt; $maxvalue) {
+					$maxvalue = $value;
+					$maxkey = $key;
+				}
+			}
+		}
+		return ($returnkey ? $maxkey : $maxvalue);
+	}
+
+	function array_min($arraydata, $returnkey=false) {
+		$minvalue = false;
+		$minkey = false;
+		foreach ($arraydata as $key =&gt; $value) {
+			if (!is_array($value)) {
+				if ($value &gt; $minvalue) {
+					$minvalue = $value;
+					$minkey = $key;
+				}
+			}
+		}
+		return ($returnkey ? $minkey : $minvalue);
+	}
+
+
+	function md5_file($file) {
+
+		// md5_file() exists in PHP 4.2.0+.
+		if (function_exists('md5_file')) {
+			return md5_file($file);
+		}
+
+		if (GETID3_OS_ISWINDOWS) {
+
+			$RequiredFiles = array('cygwin1.dll', 'md5sum.exe');
+			foreach ($RequiredFiles as $required_file) {
+				if (!is_readable(GETID3_HELPERAPPSDIR.$required_file)) {
+					die(implode(' and ', $RequiredFiles).' are required in '.GETID3_HELPERAPPSDIR.' for getid3_lib::md5_file() to function under Windows in PHP &lt; v4.2.0');
+				}
+			}
+			$commandline = GETID3_HELPERAPPSDIR.'md5sum.exe &quot;'.str_replace('/', GETID3_OS_DIRSLASH, $file).'&quot;';
+			if (ereg(&quot;^[\\]?([0-9a-f]{32})&quot;, strtolower(`$commandline`), $r)) {
+				return $r[1];
+			}
+
+		} else {
+
+			// The following works under UNIX only
+			$file = str_replace('`', '\\`', $file);
+			if (ereg(&quot;^([0-9a-f]{32})[ \t\n\r]&quot;, `md5sum &quot;$file&quot;`, $r)) {
+				return $r[1];
+			}
+
+		}
+		return false;
+	}
+
+
+	function sha1_file($file) {
+
+		// sha1_file() exists in PHP 4.3.0+.
+		if (function_exists('sha1_file')) {
+			return sha1_file($file);
+		}
+
+		$file = str_replace('`', '\\`', $file);
+
+		if (GETID3_OS_ISWINDOWS) {
+
+			$RequiredFiles = array('cygwin1.dll', 'sha1sum.exe');
+			foreach ($RequiredFiles as $required_file) {
+				if (!is_readable(GETID3_HELPERAPPSDIR.$required_file)) {
+					die(implode(' and ', $RequiredFiles).' are required in '.GETID3_HELPERAPPSDIR.' for getid3_lib::sha1_file() to function under Windows in PHP &lt; v4.3.0');
+				}
+			}
+			$commandline = GETID3_HELPERAPPSDIR.'sha1sum.exe &quot;'.str_replace('/', GETID3_OS_DIRSLASH, $file).'&quot;';
+			if (ereg(&quot;^sha1=([0-9a-f]{40})&quot;, strtolower(`$commandline`), $r)) {
+				return $r[1];
+			}
+
+		} else {
+
+			$commandline = 'sha1sum &quot;'.$file.'&quot;';
+			if (ereg(&quot;^([0-9a-f]{40})[ \t\n\r]&quot;, strtolower(`$commandline`), $r)) {
+				return $r[1];
+			}
+
+		}
+
+		return false;
+	}
+
+
+	// Allan Hansen &lt;ah&#216;artemis*dk&gt;
+	// getid3_lib::md5_data() - returns md5sum for a file from startuing position to absolute end position
+	function hash_data($file, $offset, $end, $algorithm) {
+
+		switch ($algorithm) {
+			case 'md5':
+				$hash_function = 'md5_file';
+				$unix_call     = 'md5sum';
+				$windows_call  = 'md5sum.exe';
+				$hash_length   = 32;
+				break;
+
+			case 'sha1':
+				$hash_function = 'sha1_file';
+				$unix_call     = 'sha1sum';
+				$windows_call  = 'sha1sum.exe';
+				$hash_length   = 40;
+				break;
+
+			default:
+				die('Invalid algorithm ('.$algorithm.') in getid3_lib::hash_data()');
+				break;
+		}
+		$size = $end - $offset;
+		while (true) {
+			if (GETID3_OS_ISWINDOWS) {
+
+				// It seems that sha1sum.exe for Windows only works on physical files, does not accept piped data
+				// Fall back to create-temp-file method:
+				if ($algorithm == 'sha1') {
+					break;
+				}
+
+				$RequiredFiles = array('cygwin1.dll', 'head.exe', 'tail.exe', $windows_call);
+				foreach ($RequiredFiles as $required_file) {
+					if (!is_readable(GETID3_HELPERAPPSDIR.$required_file)) {
+						// helper apps not available - fall back to old method
+						break;
+					}
+				}
+				$commandline  = GETID3_HELPERAPPSDIR.'head.exe -c '.$end.' &quot;'.str_replace('/', GETID3_OS_DIRSLASH, $file).'&quot; | ';
+				$commandline .= GETID3_HELPERAPPSDIR.'tail.exe -c '.$size.' | ';
+				$commandline .= GETID3_HELPERAPPSDIR.$windows_call;
+
+			} else {
+
+				$commandline  = 'head -c '.$end.' &quot;'.$file.'&quot; | ';
+				$commandline .= 'tail -c '.$size.' | ';
+				$commandline .= $unix_call;
+
+			}
+			if ((bool) ini_get('safe_mode')) {
+				$ThisFileInfo['warning'][] = 'PHP running in Safe Mode - backtick operator not available, using slower non-system-call '.$algorithm.' algorithm';
+				break;
+			}
+			return substr(`$commandline`, 0, $hash_length);
+		}
+
+		// try to create a temporary file in the system temp directory - invalid dirname should force to system temp dir
+		if (($data_filename = tempnam('*', 'getID3')) === false) {
+			// can't find anywhere to create a temp file, just die
+			return false;
+		}
+
+		// Init
+		$result = false;
+
+		// copy parts of file
+		if ($fp = @fopen($file, 'rb')) {
+
+			if ($fp_data = @fopen($data_filename, 'wb')) {
+
+				fseek($fp, $offset, SEEK_SET);
+				$byteslefttowrite = $end - $offset;
+				while (($byteslefttowrite &gt; 0) &amp;&amp; ($buffer = fread($fp, GETID3_FREAD_BUFFER_SIZE))) {
+					$byteswritten = fwrite($fp_data, $buffer, $byteslefttowrite);
+					$byteslefttowrite -= $byteswritten;
+				}
+				fclose($fp_data);
+				$result = getid3_lib::$hash_function($data_filename);
+
+			}
+			fclose($fp);
+		}
+		unlink($data_filename);
+		return $result;
+	}
+
+
+	function iconv_fallback_int_utf8($charval) {
+		if ($charval &lt; 128) {
+			// 0bbbbbbb
+			$newcharstring = chr($charval);
+		} elseif ($charval &lt; 2048) {
+			// 110bbbbb 10bbbbbb
+			$newcharstring  = chr(($charval &gt;&gt; 6) | 0xC0);
+			$newcharstring .= chr(($charval &amp; 0x3F) | 0x80);
+		} elseif ($charval &lt; 65536) {
+			// 1110bbbb 10bbbbbb 10bbbbbb
+			$newcharstring  = chr(($charval &gt;&gt; 12) | 0xE0);
+			$newcharstring .= chr(($charval &gt;&gt;  6) | 0xC0);
+			$newcharstring .= chr(($charval &amp; 0x3F) | 0x80);
+		} else {
+			// 11110bbb 10bbbbbb 10bbbbbb 10bbbbbb
+			$newcharstring  = chr(($charval &gt;&gt; 18) | 0xF0);
+			$newcharstring .= chr(($charval &gt;&gt; 12) | 0xC0);
+			$newcharstring .= chr(($charval &gt;&gt;  6) | 0xC0);
+			$newcharstring .= chr(($charval &amp; 0x3F) | 0x80);
+		}
+		return $newcharstring;
+	}
+
+	// ISO-8859-1 =&gt; UTF-8
+	function iconv_fallback_iso88591_utf8($string, $bom=false) {
+		if (function_exists('utf8_encode')) {
+			return utf8_encode($string);
+		}
+		// utf8_encode() unavailable, use getID3()'s iconv_fallback() conversions (possibly PHP is compiled without XML support)
+		$newcharstring = '';
+		if ($bom) {
+			$newcharstring .= &quot;\xEF\xBB\xBF&quot;;
+		}
+		for ($i = 0; $i &lt; strlen($string); $i++) {
+			$charval = ord($string{$i});
+			$newcharstring .= getid3_lib::iconv_fallback_int_utf8($charval);
+		}
+		return $newcharstring;
+	}
+
+	// ISO-8859-1 =&gt; UTF-16BE
+	function iconv_fallback_iso88591_utf16be($string, $bom=false) {
+		$newcharstring = '';
+		if ($bom) {
+			$newcharstring .= &quot;\xFE\xFF&quot;;
+		}
+		for ($i = 0; $i &lt; strlen($string); $i++) {
+			$newcharstring .= &quot;\x00&quot;.$string{$i};
+		}
+		return $newcharstring;
+	}
+
+	// ISO-8859-1 =&gt; UTF-16LE
+	function iconv_fallback_iso88591_utf16le($string, $bom=false) {
+		$newcharstring = '';
+		if ($bom) {
+			$newcharstring .= &quot;\xFF\xFE&quot;;
+		}
+		for ($i = 0; $i &lt; strlen($string); $i++) {
+			$newcharstring .= $string{$i}.&quot;\x00&quot;;
+		}
+		return $newcharstring;
+	}
+
+	// ISO-8859-1 =&gt; UTF-16LE (BOM)
+	function iconv_fallback_iso88591_utf16($string) {
+		return getid3_lib::iconv_fallback_iso88591_utf16le($string, true);
+	}
+
+	// UTF-8 =&gt; ISO-8859-1
+	function iconv_fallback_utf8_iso88591($string) {
+		if (function_exists('utf8_decode')) {
+			return utf8_decode($string);
+		}
+		// utf8_decode() unavailable, use getID3()'s iconv_fallback() conversions (possibly PHP is compiled without XML support)
+		$newcharstring = '';
+		$offset = 0;
+		$stringlength = strlen($string);
+		while ($offset &lt; $stringlength) {
+			if ((ord($string{$offset}) &amp; 0x07) == 0xF7) {
+				// 11110bbb 10bbbbbb 10bbbbbb 10bbbbbb
+				$charval = ((ord($string{($offset + 0)}) &amp; 0x07) &lt;&lt; 18) &amp;
+				           ((ord($string{($offset + 1)}) &amp; 0x3F) &lt;&lt; 12) &amp;
+				           ((ord($string{($offset + 2)}) &amp; 0x3F) &lt;&lt;  6) &amp;
+				            (ord($string{($offset + 3)}) &amp; 0x3F);
+				$offset += 4;
+			} elseif ((ord($string{$offset}) &amp; 0x0F) == 0xEF) {
+				// 1110bbbb 10bbbbbb 10bbbbbb
+				$charval = ((ord($string{($offset + 0)}) &amp; 0x0F) &lt;&lt; 12) &amp;
+				           ((ord($string{($offset + 1)}) &amp; 0x3F) &lt;&lt;  6) &amp;
+				            (ord($string{($offset + 2)}) &amp; 0x3F);
+				$offset += 3;
+			} elseif ((ord($string{$offset}) &amp; 0x1F) == 0xDF) {
+				// 110bbbbb 10bbbbbb
+				$charval = ((ord($string{($offset + 0)}) &amp; 0x1F) &lt;&lt;  6) &amp;
+				            (ord($string{($offset + 1)}) &amp; 0x3F);
+				$offset += 2;
+			} elseif ((ord($string{$offset}) &amp; 0x7F) == 0x7F) {
+				// 0bbbbbbb
+				$charval = ord($string{$offset});
+				$offset += 1;
+			} else {
+				// error? throw some kind of warning here?
+				$charval = false;
+				$offset += 1;
+			}
+			if ($charval !== false) {
+				$newcharstring .= (($charval &lt; 256) ? chr($charval) : '?');
+			}
+		}
+		return $newcharstring;
+	}
+
+	// UTF-8 =&gt; UTF-16BE
+	function iconv_fallback_utf8_utf16be($string, $bom=false) {
+		$newcharstring = '';
+		if ($bom) {
+			$newcharstring .= &quot;\xFE\xFF&quot;;
+		}
+		$offset = 0;
+		$stringlength = strlen($string);
+		while ($offset &lt; $stringlength) {
+			if ((ord($string{$offset}) &amp; 0x07) == 0xF7) {
+				// 11110bbb 10bbbbbb 10bbbbbb 10bbbbbb
+				$charval = ((ord($string{($offset + 0)}) &amp; 0x07) &lt;&lt; 18) &amp;
+				           ((ord($string{($offset + 1)}) &amp; 0x3F) &lt;&lt; 12) &amp;
+				           ((ord($string{($offset + 2)}) &amp; 0x3F) &lt;&lt;  6) &amp;
+				            (ord($string{($offset + 3)}) &amp; 0x3F);
+				$offset += 4;
+			} elseif ((ord($string{$offset}) &amp; 0x0F) == 0xEF) {
+				// 1110bbbb 10bbbbbb 10bbbbbb
+				$charval = ((ord($string{($offset + 0)}) &amp; 0x0F) &lt;&lt; 12) &amp;
+				           ((ord($string{($offset + 1)}) &amp; 0x3F) &lt;&lt;  6) &amp;
+				            (ord($string{($offset + 2)}) &amp; 0x3F);
+				$offset += 3;
+			} elseif ((ord($string{$offset}) &amp; 0x1F) == 0xDF) {
+				// 110bbbbb 10bbbbbb
+				$charval = ((ord($string{($offset + 0)}) &amp; 0x1F) &lt;&lt;  6) &amp;
+				            (ord($string{($offset + 1)}) &amp; 0x3F);
+				$offset += 2;
+			} elseif ((ord($string{$offset}) &amp; 0x7F) == 0x7F) {
+				// 0bbbbbbb
+				$charval = ord($string{$offset});
+				$offset += 1;
+			} else {
+				// error? throw some kind of warning here?
+				$charval = false;
+				$offset += 1;
+			}
+			if ($charval !== false) {
+				$newcharstring .= (($charval &lt; 65536) ? getid3_lib::BigEndian2String($charval, 2) : &quot;\x00&quot;.'?');
+			}
+		}
+		return $newcharstring;
+	}
+
+	// UTF-8 =&gt; UTF-16LE
+	function iconv_fallback_utf8_utf16le($string, $bom=false) {
+		$newcharstring = '';
+		if ($bom) {
+			$newcharstring .= &quot;\xFF\xFE&quot;;
+		}
+		$offset = 0;
+		$stringlength = strlen($string);
+		while ($offset &lt; $stringlength) {
+			if ((ord($string{$offset}) &amp; 0x07) == 0xF7) {
+				// 11110bbb 10bbbbbb 10bbbbbb 10bbbbbb
+				$charval = ((ord($string{($offset + 0)}) &amp; 0x07) &lt;&lt; 18) &amp;
+				           ((ord($string{($offset + 1)}) &amp; 0x3F) &lt;&lt; 12) &amp;
+				           ((ord($string{($offset + 2)}) &amp; 0x3F) &lt;&lt;  6) &amp;
+				            (ord($string{($offset + 3)}) &amp; 0x3F);
+				$offset += 4;
+			} elseif ((ord($string{$offset}) &amp; 0x0F) == 0xEF) {
+				// 1110bbbb 10bbbbbb 10bbbbbb
+				$charval = ((ord($string{($offset + 0)}) &amp; 0x0F) &lt;&lt; 12) &amp;
+				           ((ord($string{($offset + 1)}) &amp; 0x3F) &lt;&lt;  6) &amp;
+				            (ord($string{($offset + 2)}) &amp; 0x3F);
+				$offset += 3;
+			} elseif ((ord($string{$offset}) &amp; 0x1F) == 0xDF) {
+				// 110bbbbb 10bbbbbb
+				$charval = ((ord($string{($offset + 0)}) &amp; 0x1F) &lt;&lt;  6) &amp;
+				            (ord($string{($offset + 1)}) &amp; 0x3F);
+				$offset += 2;
+			} elseif ((ord($string{$offset}) &amp; 0x7F) == 0x7F) {
+				// 0bbbbbbb
+				$charval = ord($string{$offset});
+				$offset += 1;
+			} else {
+				// error? maybe throw some warning here?
+				$charval = false;
+				$offset += 1;
+			}
+			if ($charval !== false) {
+				$newcharstring .= (($charval &lt; 65536) ? getid3_lib::LittleEndian2String($charval, 2) : '?'.&quot;\x00&quot;);
+			}
+		}
+		return $newcharstring;
+	}
+
+	// UTF-8 =&gt; UTF-16LE (BOM)
+	function iconv_fallback_utf8_utf16($string) {
+		return getid3_lib::iconv_fallback_utf8_utf16le($string, true);
+	}
+
+	// UTF-16BE =&gt; UTF-8
+	function iconv_fallback_utf16be_utf8($string) {
+		if (substr($string, 0, 2) == &quot;\xFE\xFF&quot;) {
+			// strip BOM
+			$string = substr($string, 2);
+		}
+		$newcharstring = '';
+		for ($i = 0; $i &lt; strlen($string); $i += 2) {
+			$charval = getid3_lib::BigEndian2Int(substr($string, $i, 2));
+			$newcharstring .= getid3_lib::iconv_fallback_int_utf8($charval);
+		}
+		return $newcharstring;
+	}
+
+	// UTF-16LE =&gt; UTF-8
+	function iconv_fallback_utf16le_utf8($string) {
+		if (substr($string, 0, 2) == &quot;\xFF\xFE&quot;) {
+			// strip BOM
+			$string = substr($string, 2);
+		}
+		$newcharstring = '';
+		for ($i = 0; $i &lt; strlen($string); $i += 2) {
+			$charval = getid3_lib::LittleEndian2Int(substr($string, $i, 2));
+			$newcharstring .= getid3_lib::iconv_fallback_int_utf8($charval);
+		}
+		return $newcharstring;
+	}
+
+	// UTF-16BE =&gt; ISO-8859-1
+	function iconv_fallback_utf16be_iso88591($string) {
+		if (substr($string, 0, 2) == &quot;\xFE\xFF&quot;) {
+			// strip BOM
+			$string = substr($string, 2);
+		}
+		$newcharstring = '';
+		for ($i = 0; $i &lt; strlen($string); $i += 2) {
+			$charval = getid3_lib::BigEndian2Int(substr($string, $i, 2));
+			$newcharstring .= (($charval &lt; 256) ? chr($charval) : '?');
+		}
+		return $newcharstring;
+	}
+
+	// UTF-16LE =&gt; ISO-8859-1
+	function iconv_fallback_utf16le_iso88591($string) {
+		if (substr($string, 0, 2) == &quot;\xFF\xFE&quot;) {
+			// strip BOM
+			$string = substr($string, 2);
+		}
+		$newcharstring = '';
+		for ($i = 0; $i &lt; strlen($string); $i += 2) {
+			$charval = getid3_lib::LittleEndian2Int(substr($string, $i, 2));
+			$newcharstring .= (($charval &lt; 256) ? chr($charval) : '?');
+		}
+		return $newcharstring;
+	}
+
+	// UTF-16 (BOM) =&gt; ISO-8859-1
+	function iconv_fallback_utf16_iso88591($string) {
+		$bom = substr($string, 0, 2);
+		if ($bom == &quot;\xFE\xFF&quot;) {
+			return getid3_lib::iconv_fallback_utf16be_iso88591(substr($string, 2));
+		} elseif ($bom == &quot;\xFF\xFE&quot;) {
+			return getid3_lib::iconv_fallback_utf16le_iso88591(substr($string, 2));
+		}
+		return $string;
+	}
+
+	// UTF-16 (BOM) =&gt; UTF-8
+	function iconv_fallback_utf16_utf8($string) {
+		$bom = substr($string, 0, 2);
+		if ($bom == &quot;\xFE\xFF&quot;) {
+			return getid3_lib::iconv_fallback_utf16be_utf8(substr($string, 2));
+		} elseif ($bom == &quot;\xFF\xFE&quot;) {
+			return getid3_lib::iconv_fallback_utf16le_utf8(substr($string, 2));
+		}
+		return $string;
+	}
+
+	function iconv_fallback($in_charset, $out_charset, $string) {
+
+		if ($in_charset == $out_charset) {
+			return $string;
+		}
+
+		static $iconv_broken_or_unavailable = array();
+		if (is_null(@$iconv_broken_or_unavailable[$in_charset.'_'.$out_charset])) {
+			$GETID3_ICONV_TEST_STRING = ' !&quot;#$%&amp;\'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~&#128;&#129;&#130;&#131;&#132;&#133;&#134;&#135;&#136;&#137;&#138;&#139;&#140;&#141;&#142;&#143;&#144;&#145;&#146;&#147;&#148;&#149;&#150;&#151;&#152;&#153;&#154;&#155;&#156;&#157;&#158;&#159; &#161;&#162;&#163;&#164;&#165;&#166;&#167;&#168;&#169;&#170;&#171;&#172;&#173;&#174;&#175;&#176;&#177;&#178;&#179;&#180;&#181;&#182;&#183;&#184;&#185;&#186;&#187;&#188;&#189;&#190;&#191;&#192;&#193;&#194;&#195;&#196;&#197;&#198;&#199;&#200;&#201;&#202;&#203;&#204;&#205;&#206;&#207;&#208;&#209;&#210;&#211;&#212;&#213;&#214;&#215;&#216;&#217;&#218;&#219;&#220;&#221;&#222;&#223;&#224;&#225;&#226;&#227;&#228;&#229;&#230;&#231;&#232;&#233;&#234;&#235;&#236;&#237;&#238;&#239;&#240;&#241;&#242;&#243;&#244;&#245;&#246;&#247;&#248;&#249;&#250;&#251;&#252;&#253;&#254;&#255;';
+
+			// Check iconv()
+			if (function_exists('iconv')) {
+				if (@iconv($in_charset, 'ISO-8859-1', @iconv('ISO-8859-1', $in_charset, $GETID3_ICONV_TEST_STRING)) == $GETID3_ICONV_TEST_STRING) {
+					if (@iconv($out_charset, 'ISO-8859-1', @iconv('ISO-8859-1', $out_charset, $GETID3_ICONV_TEST_STRING)) == $GETID3_ICONV_TEST_STRING) {
+						// everything works, use iconv()
+						$iconv_broken_or_unavailable[$in_charset.'_'.$out_charset] = false;
+					} else {
+						// iconv() available, but broken. Use getID3()'s iconv_fallback() conversions instead
+						// known issue in PHP v4.1.x
+						$iconv_broken_or_unavailable[$in_charset.'_'.$out_charset] = true;
+					}
+				} else {
+					// iconv() available, but broken. Use getID3()'s iconv_fallback() conversions instead
+					// known issue in PHP v4.1.x
+					$iconv_broken_or_unavailable[$in_charset.'_'.$out_charset] = true;
+				}
+			} else {
+				// iconv() unavailable, use getID3()'s iconv_fallback() conversions
+				$iconv_broken_or_unavailable[$in_charset.'_'.$out_charset] = true;
+			}
+		}
+
+		if ($iconv_broken_or_unavailable[$in_charset.'_'.$out_charset]) {
+			static $ConversionFunctionList = array();
+			if (empty($ConversionFunctionList)) {
+				$ConversionFunctionList['ISO-8859-1']['UTF-8']    = 'iconv_fallback_iso88591_utf8';
+				$ConversionFunctionList['ISO-8859-1']['UTF-16']   = 'iconv_fallback_iso88591_utf16';
+				$ConversionFunctionList['ISO-8859-1']['UTF-16BE'] = 'iconv_fallback_iso88591_utf16be';
+				$ConversionFunctionList['ISO-8859-1']['UTF-16LE'] = 'iconv_fallback_iso88591_utf16le';
+				$ConversionFunctionList['UTF-8']['ISO-8859-1']    = 'iconv_fallback_utf8_iso88591';
+				$ConversionFunctionList['UTF-8']['UTF-16']        = 'iconv_fallback_utf8_utf16';
+				$ConversionFunctionList['UTF-8']['UTF-16BE']      = 'iconv_fallback_utf8_utf16be';
+				$ConversionFunctionList['UTF-8']['UTF-16LE']      = 'iconv_fallback_utf8_utf16le';
+				$ConversionFunctionList['UTF-16']['ISO-8859-1']   = 'iconv_fallback_utf16_iso88591';
+				$ConversionFunctionList['UTF-16']['UTF-8']        = 'iconv_fallback_utf16_utf8';
+				$ConversionFunctionList['UTF-16LE']['ISO-8859-1'] = 'iconv_fallback_utf16le_iso88591';
+				$ConversionFunctionList['UTF-16LE']['UTF-8']      = 'iconv_fallback_utf16le_utf8';
+				$ConversionFunctionList['UTF-16BE']['ISO-8859-1'] = 'iconv_fallback_utf16be_iso88591';
+				$ConversionFunctionList['UTF-16BE']['UTF-8']      = 'iconv_fallback_utf16be_utf8';
+			}
+			if (isset($ConversionFunctionList[strtoupper($in_charset)][strtoupper($out_charset)])) {
+				$ConversionFunction = $ConversionFunctionList[strtoupper($in_charset)][strtoupper($out_charset)];
+				return getid3_lib::$ConversionFunction($string);
+			}
+			die('PHP does not have iconv() support - cannot convert from '.$in_charset.' to '.$out_charset);
+		}
+
+		if ($converted_string = @iconv($in_charset, $out_charset.'//TRANSLIT', $string)) {
+			switch ($out_charset) {
+				case 'ISO-8859-1':
+					$converted_string = rtrim($converted_string, &quot;\x00&quot;);
+					break;
+			}
+			return $converted_string;
+		}
+
+		// iconv() may sometimes fail with &quot;illegal character in input string&quot; error message
+		// and return an empty string, but returning the unconverted string is more useful
+		return $string;
+	}
+
+
+	function MultiByteCharString2HTML($string, $charset='ISO-8859-1') {
+		$HTMLstring = '';
+
+		switch ($charset) {
+			case 'ISO-8859-1':
+			case 'ISO8859-1':
+			case 'ISO-8859-15':
+			case 'ISO8859-15':
+			case 'cp866':
+			case 'ibm866':
+			case '866':
+			case 'cp1251':
+			case 'Windows-1251':
+			case 'win-1251':
+			case '1251':
+			case 'cp1252':
+			case 'Windows-1252':
+			case '1252':
+			case 'KOI8-R':
+			case 'koi8-ru':
+			case 'koi8r':
+			case 'BIG5':
+			case '950':
+			case 'GB2312':
+			case '936':
+			case 'BIG5-HKSCS':
+			case 'Shift_JIS':
+			case 'SJIS':
+			case '932':
+			case 'EUC-JP':
+			case 'EUCJP':
+				$HTMLstring = htmlentities($string, ENT_COMPAT, $charset);
+				break;
+
+			case 'UTF-8':
+				$strlen = strlen($string);
+				for ($i = 0; $i &lt; $strlen; $i++) {
+					$char_ord_val = ord($string{$i});
+					$charval = 0;
+					if ($char_ord_val &lt; 0x80) {
+						$charval = $char_ord_val;
+					} elseif ((($char_ord_val &amp; 0xF0) &gt;&gt; 4) == 0x0F) {
+						$charval  = (($char_ord_val &amp; 0x07) &lt;&lt; 18);
+						$charval += ((ord($string{++$i}) &amp; 0x3F) &lt;&lt; 12);
+						$charval += ((ord($string{++$i}) &amp; 0x3F) &lt;&lt; 6);
+						$charval +=  (ord($string{++$i}) &amp; 0x3F);
+					} elseif ((($char_ord_val &amp; 0xE0) &gt;&gt; 5) == 0x07) {
+						$charval  = (($char_ord_val &amp; 0x0F) &lt;&lt; 12);
+						$charval += ((ord($string{++$i}) &amp; 0x3F) &lt;&lt; 6);
+						$charval +=  (ord($string{++$i}) &amp; 0x3F);
+					} elseif ((($char_ord_val &amp; 0xC0) &gt;&gt; 6) == 0x03) {
+						$charval  = (($char_ord_val &amp; 0x1F) &lt;&lt; 6);
+						$charval += (ord($string{++$i}) &amp; 0x3F);
+					}
+					if (($charval &gt;= 32) &amp;&amp; ($charval &lt;= 127)) {
+						$HTMLstring .= chr($charval);
+					} else {
+						$HTMLstring .= '&amp;#'.$charval.';';
+					}
+				}
+				break;
+
+			case 'UTF-16LE':
+				for ($i = 0; $i &lt; strlen($string); $i += 2) {
+					$charval = getid3_lib::LittleEndian2Int(substr($string, $i, 2));
+					if (($charval &gt;= 32) &amp;&amp; ($charval &lt;= 127)) {
+						$HTMLstring .= chr($charval);
+					} else {
+						$HTMLstring .= '&amp;#'.$charval.';';
+					}
+				}
+				break;
+
+			case 'UTF-16BE':
+				for ($i = 0; $i &lt; strlen($string); $i += 2) {
+					$charval = getid3_lib::BigEndian2Int(substr($string, $i, 2));
+					if (($charval &gt;= 32) &amp;&amp; ($charval &lt;= 127)) {
+						$HTMLstring .= chr($charval);
+					} else {
+						$HTMLstring .= '&amp;#'.$charval.';';
+					}
+				}
+				break;
+
+			default:
+				$HTMLstring = 'ERROR: Character set &quot;'.$charset.'&quot; not supported in MultiByteCharString2HTML()';
+				break;
+		}
+		return $HTMLstring;
+	}
+
+
+
+	function RGADnameLookup($namecode) {
+		static $RGADname = array();
+		if (empty($RGADname)) {
+			$RGADname[0] = 'not set';
+			$RGADname[1] = 'Track Gain Adjustment';
+			$RGADname[2] = 'Album Gain Adjustment';
+		}
+
+		return (isset($RGADname[$namecode]) ? $RGADname[$namecode] : '');
+	}
+
+
+	function RGADoriginatorLookup($originatorcode) {
+		static $RGADoriginator = array();
+		if (empty($RGADoriginator)) {
+			$RGADoriginator[0] = 'unspecified';
+			$RGADoriginator[1] = 'pre-set by artist/producer/mastering engineer';
+			$RGADoriginator[2] = 'set by user';
+			$RGADoriginator[3] = 'determined automatically';
+		}
+
+		return (isset($RGADoriginator[$originatorcode]) ? $RGADoriginator[$originatorcode] : '');
+	}
+
+
+	function RGADadjustmentLookup($rawadjustment, $signbit) {
+		$adjustment = $rawadjustment / 10;
+		if ($signbit == 1) {
+			$adjustment *= -1;
+		}
+		return (float) $adjustment;
+	}
+
+
+	function RGADgainString($namecode, $originatorcode, $replaygain) {
+		if ($replaygain &lt; 0) {
+			$signbit = '1';
+		} else {
+			$signbit = '0';
+		}
+		$storedreplaygain = intval(round($replaygain * 10));
+		$gainstring  = str_pad(decbin($namecode), 3, '0', STR_PAD_LEFT);
+		$gainstring .= str_pad(decbin($originatorcode), 3, '0', STR_PAD_LEFT);
+		$gainstring .= $signbit;
+		$gainstring .= str_pad(decbin($storedreplaygain), 9, '0', STR_PAD_LEFT);
+
+		return $gainstring;
+	}
+
+	function RGADamplitude2dB($amplitude) {
+		return 20 * log10($amplitude);
+	}
+
+
+	function GetURLImageSize($urlpic) {
+		if ($fd = @fopen($urlpic, 'rb')){
+			$imgData = fread($fd, filesize($urlpic));
+			fclose($fd);
+			return getid3_lib::GetDataImageSize($imgData);
+		}
+		return array('', '', '');
+	}
+
+
+	function GetDataImageSize($imgData) {
+		$height = '';
+		$width  = '';
+		$type   = '';
+		if ((substr($imgData, 0, 3) == GETID3_GIF_SIG) &amp;&amp; (strlen($imgData) &gt; 10)) {
+			$dim = unpack('v2dim', substr($imgData, 6, 4));
+			$width  = $dim['dim1'];
+			$height = $dim['dim2'];
+			$type = 1;
+		} elseif ((substr($imgData, 0, 8) == GETID3_PNG_SIG) &amp;&amp; (strlen($imgData) &gt; 24)) {
+			$dim = unpack('N2dim', substr($imgData, 16, 8));
+			$width  = $dim['dim1'];
+			$height = $dim['dim2'];
+			$type = 3;
+		} elseif ((substr($imgData, 0, 3) == GETID3_JPG_SIG) &amp;&amp; (strlen($imgData) &gt; 4)) {
+			///////////////// JPG CHUNK SCAN ////////////////////
+			$imgPos = 2;
+			$type = 2;
+			$buffer = strlen($imgData) - 2;
+			while ($imgPos &lt; strlen($imgData)) {
+				// synchronize to the marker 0xFF
+				$imgPos = strpos($imgData, 0xFF, $imgPos) + 1;
+				$marker = $imgData[$imgPos];
+				do {
+					$marker = ord($imgData[$imgPos++]);
+				} while ($marker == 255);
+				// find dimensions of block
+				switch (chr($marker)) {
+					// Grab width/height from SOF segment (these are acceptable chunk types)
+					case GETID3_JPG_SOF0:
+					case GETID3_JPG_SOF1:
+					case GETID3_JPG_SOF2:
+					case GETID3_JPG_SOF3:
+					case GETID3_JPG_SOF5:
+					case GETID3_JPG_SOF6:
+					case GETID3_JPG_SOF7:
+					case GETID3_JPG_SOF9:
+					case GETID3_JPG_SOF10:
+					case GETID3_JPG_SOF11:
+					case GETID3_JPG_SOF13:
+					case GETID3_JPG_SOF14:
+					case GETID3_JPG_SOF15:
+						$dim = unpack('n2dim', substr($imgData, $imgPos + 3, 4));
+						$height = $dim['dim1'];
+						$width  = $dim['dim2'];
+						break 2; // found it so exit
+					case GETID3_JPG_EOI:
+					case GETID3_JPG_SOS:
+						return false;       // End loop in case we find one of these markers
+					default:            // We're not interested in other markers
+						$skiplen = (ord($imgData[$imgPos++]) &lt;&lt; 8) + ord($imgData[$imgPos++]) - 2;
+						// if the skip is more than what we've read in, read more
+						$buffer -= $skiplen;
+						if ($buffer &lt; 512) { // if the buffer of data is too low, read more file.
+							// $imgData .= fread($fd, $skiplen + 1024);
+							// $buffer += $skiplen + 1024;
+							return false; // End loop in case we find run out of data
+						}
+						$imgPos += $skiplen;
+						break;
+				} // endswitch check marker type
+			} // endif loop through JPG chunks
+		} // endif chk for valid file types
+
+		return array($width, $height, $type);
+	} // end function
+
+
+	function ImageTypesLookup($imagetypeid) {
+		static $ImageTypesLookup = array();
+		if (empty($ImageTypesLookup)) {
+			$ImageTypesLookup[1]  = 'gif';
+			$ImageTypesLookup[2]  = 'jpeg';
+			$ImageTypesLookup[3]  = 'png';
+			$ImageTypesLookup[4]  = 'swf';
+			$ImageTypesLookup[5]  = 'psd';
+			$ImageTypesLookup[6]  = 'bmp';
+			$ImageTypesLookup[7]  = 'tiff (little-endian)';
+			$ImageTypesLookup[8]  = 'tiff (big-endian)';
+			$ImageTypesLookup[9]  = 'jpc';
+			$ImageTypesLookup[10] = 'jp2';
+			$ImageTypesLookup[11] = 'jpx';
+			$ImageTypesLookup[12] = 'jb2';
+			$ImageTypesLookup[13] = 'swc';
+			$ImageTypesLookup[14] = 'iff';
+		}
+		return (isset($ImageTypesLookup[$imagetypeid]) ? $ImageTypesLookup[$imagetypeid] : '');
+	}
+
+	function CopyTagsToComments(&amp;$ThisFileInfo) {
+		// Copy all entries from ['tags'] into common ['comments'] and ['comments_html']
+		if (!empty($ThisFileInfo['tags'])) {
+			foreach ($ThisFileInfo['tags'] as $tagtype =&gt; $tagarray) {
+				foreach ($tagarray as $tagname =&gt; $tagdata) {
+					foreach ($tagdata as $key =&gt; $value) {
+						if (!empty($value)) {
+							if (empty($ThisFileInfo['comments'][$tagname])) {
+
+								// fall through and append value
+
+							} elseif ($tagtype == 'id3v1') {
+
+								$newvaluelength = strlen(trim($value));
+								foreach ($ThisFileInfo['comments'][$tagname] as $existingkey =&gt; $existingvalue) {
+									$oldvaluelength = strlen(trim($existingvalue));
+									if (($newvaluelength &lt;= $oldvaluelength) &amp;&amp; (substr($existingvalue, 0, $newvaluelength) == trim($value))) {
+										// new value is identical but shorter-than (or equal-length to) one already in comments - skip
+										break 2;
+									}
+								}
+
+							} else {
+
+								$newvaluelength = strlen(trim($value));
+								foreach ($ThisFileInfo['comments'][$tagname] as $existingkey =&gt; $existingvalue) {
+									$oldvaluelength = strlen(trim($existingvalue));
+									if (($newvaluelength &gt; $oldvaluelength) &amp;&amp; (substr(trim($value), 0, strlen($existingvalue)) == $existingvalue)) {
+										$ThisFileInfo['comments'][$tagname][$existingkey] = trim($value);
+										break 2;
+									}
+								}
+
+							}
+							if (empty($ThisFileInfo['comments'][$tagname]) || !in_array(trim($value), $ThisFileInfo['comments'][$tagname])) {
+								$ThisFileInfo['comments'][$tagname][] = trim($value);
+								if (isset($ThisFileInfo['tags_html'][$tagtype][$tagname][$key])) {
+									$ThisFileInfo['comments_html'][$tagname][] = $ThisFileInfo['tags_html'][$tagtype][$tagname][$key];
+								}
+							}
+						}
+					}
+				}
+			}
+		}
+	}
+
+
+	function EmbeddedLookup($key, $begin, $end, $file, $name) {
+
+		// Cached
+		static $cache;
+		if (isset($cache[$file][$name])) {
+			return @$cache[$file][$name][$key];
+		}
+
+		// Init
+		$keylength  = strlen($key);
+		$line_count = $end - $begin - 7;
+
+		// Open php file
+		$fp = fopen($file, 'r');
+
+		// Discard $begin lines
+		for ($i = 0; $i &lt; ($begin + 3); $i++) {
+			fgets($fp, 1024);
+		}
+
+		// Loop thru line
+		while (0 &lt; $line_count--) {
+
+			// Read line
+			$line = ltrim(fgets($fp, 1024), &quot;\t &quot;);
+
+			// METHOD A: only cache the matching key - less memory but slower on next lookup of not-previously-looked-up key
+			//$keycheck = substr($line, 0, $keylength);
+			//if ($key == $keycheck)  {
+			//	$cache[$file][$name][$keycheck] = substr($line, $keylength + 1);
+			//	break;
+			//}
+
+			// METHOD B: cache all keys in this lookup - more memory but faster on next lookup of not-previously-looked-up key
+			//$cache[$file][$name][substr($line, 0, $keylength)] = trim(substr($line, $keylength + 1));
+			list($ThisKey, $ThisValue) = explode(&quot;\t&quot;, $line, 2);
+			$cache[$file][$name][$ThisKey] = trim($ThisValue);
+		}
+
+		// Close and return
+		fclose($fp);
+		return @$cache[$file][$name][$key];
+	}
+
+	function IncludeDependency($filename, $sourcefile, $DieOnFailure=false) {
+		global $GETID3_ERRORARRAY;
+
+		if (file_exists($filename)) {
+			if (@include_once($filename)) {
+				return true;
+			} else {
+				$diemessage = basename($sourcefile).' depends on '.$filename.', which has errors';
+			}
+		} else {
+			$diemessage = basename($sourcefile).' depends on '.$filename.', which is missing';
+		}
+		if ($DieOnFailure) {
+			die($diemessage);
+		} else {
+			$GETID3_ERRORARRAY[] = $diemessage;
+		}
+		return false;
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/getid3.lib.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/getid3.php
===================================================================
--- trunk/inc/external/getid3/getid3.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/getid3.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,1220 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// Please see readme.txt for more information                  //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+// Defines
+define('GETID3_VERSION', '1.7.2');
+define('GETID3_FREAD_BUFFER_SIZE', 16384); // read buffer size in bytes
+
+
+
+class getID3
+{
+	// public: Settings
+	var $encoding                 = 'ISO-8859-1';     // CASE SENSITIVE! - i.e. (must be supported by iconv())
+	                                                  // Examples:  ISO-8859-1  UTF-8  UTF-16  UTF-16BE
+
+	var $encoding_id3v1           = 'ISO-8859-1';     // Should always be 'ISO-8859-1', but some tags may be written
+	                                                  // in other encodings such as 'EUC-CN'
+
+	// public: Optional tag checks - disable for speed.
+	var $option_tag_id3v1         = true;             // Read and process ID3v1 tags
+	var $option_tag_id3v2         = true;             // Read and process ID3v2 tags
+	var $option_tag_lyrics3       = true;             // Read and process Lyrics3 tags
+	var $option_tag_apetag        = true;             // Read and process APE tags
+	var $option_tags_process      = true;             // Copy tags to root key 'tags' and encode to $this-&gt;encoding
+	var $option_tags_html         = true;             // Copy tags to root key 'tags_html' properly translated from various encodings to HTML entities
+
+	// public: Optional tag/comment calucations
+	var $option_extra_info        = true;             // Calculate additional info such as bitrate, channelmode etc
+
+	// public: Optional calculations
+	var $option_md5_data          = false;            // Get MD5 sum of data part - slow
+	var $option_md5_data_source   = false;            // Use MD5 of source file if availble - only FLAC and OptimFROG
+	var $option_sha1_data         = false;            // Get SHA1 sum of data part - slow
+	var $option_max_2gb_check     = true;             // Check whether file is larger than 2 Gb and thus not supported by PHP
+
+	// private
+	var $filename;
+
+
+	// public: constructor
+	function getID3()
+	{
+
+		$this-&gt;startup_error = '';
+
+		// Check for PHP version &gt;= 4.1.0
+		if (phpversion() &lt; '4.1.0') {
+		    $this-&gt;startup_error .= 'getID3() requires PHP v4.1.0 or higher - you are running v'.phpversion();
+		}
+
+		// Check memory
+		$memory_limit = ini_get('memory_limit');
+		if (eregi('([0-9]+)M', $memory_limit, $matches)) {
+			// could be stored as &quot;16M&quot; rather than 16777216 for example
+			$memory_limit = $matches[1] * 1048576;
+		}
+		if ($memory_limit &lt;= 0) {
+			// memory limits probably disabled
+		} elseif ($memory_limit &lt;= 3145728) {
+	    	$this-&gt;startup_error .= 'PHP has less than 3MB available memory and will very likely run out. Increase memory_limit in php.ini';
+		} elseif ($memory_limit &lt;= 12582912) {
+	    	$this-&gt;startup_warning .= 'PHP has less than 12MB available memory and might run out if all modules are loaded. Increase memory_limit in php.ini';
+		}
+
+		// Check safe_mode off
+		if ((bool) ini_get('safe_mode')) {
+		    $this-&gt;warning('WARNING: Safe mode is on, shorten support disabled, md5data/sha1data for ogg vorbis disabled, ogg vorbos/flac tag writing disabled.');
+		}
+
+
+		// define a constant rather than looking up every time it is needed
+		if (!defined('GETID3_OS_ISWINDOWS')) {
+			if (strtoupper(substr(PHP_OS, 0, 3)) == 'WIN') {
+				define('GETID3_OS_ISWINDOWS', true);
+			} else {
+				define('GETID3_OS_ISWINDOWS', false);
+			}
+		}
+
+		// Get base path of getID3() - ONCE
+		if (!defined('GETID3_INCLUDEPATH')) {
+			define('GETID3_OS_DIRSLASH', (GETID3_OS_ISWINDOWS ? '\\' : '/'));
+
+			foreach (get_included_files() as $key =&gt; $val) {
+				if (basename($val) == 'getid3.php') {
+					define('GETID3_INCLUDEPATH', dirname($val).GETID3_OS_DIRSLASH);
+					break;
+				}
+			}
+		}
+
+		// Load support library
+		if (!include_once(GETID3_INCLUDEPATH.'getid3.lib.php')) {
+			$this-&gt;startup_error .= 'getid3.lib.php is missing or corrupt';
+		}
+
+
+		// Needed for Windows only:
+		// Define locations of helper applications for Shorten, VorbisComment, MetaFLAC
+		//   as well as other helper functions such as head, tail, md5sum, etc
+		// IMPORTANT: This path cannot have spaces in it. If neccesary, use the 8dot3 equivalent
+		//   ie for &quot;C:/Program Files/Apache/&quot; put &quot;C:/PROGRA~1/APACHE/&quot;
+		// IMPORTANT: This path must include the trailing slash
+		if (GETID3_OS_ISWINDOWS &amp;&amp; !defined('GETID3_HELPERAPPSDIR')) {
+
+			$helperappsdir = GETID3_INCLUDEPATH.'..'.GETID3_OS_DIRSLASH.'helperapps'; // must not have any space in this path
+
+			if (!is_dir($helperappsdir)) {
+				$this-&gt;startup_error .= '&quot;'.$helperappsdir.'&quot; cannot be defined as GETID3_HELPERAPPSDIR because it does not exist';
+			} elseif (strpos(realpath($helperappsdir), ' ') !== false) {
+				$DirPieces = explode(GETID3_OS_DIRSLASH, realpath($helperappsdir));
+				foreach ($DirPieces as $key =&gt; $value) {
+					if ((strpos($value, '.') !== false) &amp;&amp; (strpos($value, ' ') === false)) {
+						if (strpos($value, '.') &gt; 8) {
+							$value = substr($value, 0, 6).'~1';
+						}
+					} elseif ((strpos($value, ' ') !== false) || strlen($value) &gt; 8) {
+						$value = substr($value, 0, 6).'~1';
+					}
+					$DirPieces[$key] = strtoupper($value);
+				}
+				$this-&gt;startup_error .= 'GETID3_HELPERAPPSDIR must not have any spaces in it - use 8dot3 naming convention if neccesary (on this server that would be something like &quot;'.implode(GETID3_OS_DIRSLASH, $DirPieces).'&quot; - NOTE: this may or may not be the actual 8.3 equivalent of &quot;'.$helperappsdir.'&quot;, please double-check). You can run &quot;dir /x&quot; from the commandline to see the correct 8.3-style names. You need to edit the file &quot;'.GETID3_INCLUDEPATH.'/getid3.php&quot; around line '.(__LINE__ - 16);
+			}
+			define('GETID3_HELPERAPPSDIR', realpath($helperappsdir).GETID3_OS_DIRSLASH);
+		}
+
+	}
+
+
+
+	// public: analyze file - replaces GetAllFileInfo() and GetTagOnly()
+	function analyze($filename) {
+
+		if (!empty($this-&gt;startup_error)) {
+			return $this-&gt;error($this-&gt;startup_error);
+		}
+		if (!empty($this-&gt;startup_warning)) {
+			$this-&gt;warning($this-&gt;startup_warning);
+		}
+
+		// init result array and set parameters
+		$this-&gt;info = array();
+		$this-&gt;info['GETID3_VERSION'] = GETID3_VERSION;
+
+		// Check encoding/iconv support
+		if (!function_exists('iconv') &amp;&amp; !in_array($this-&gt;encoding, array('ISO-8859-1', 'UTF-8', 'UTF-16LE', 'UTF-16BE', 'UTF-16'))) {
+			$errormessage = 'iconv() support is needed for encodings other than ISO-8859-1, UTF-8, UTF-16LE, UTF16-BE, UTF-16. ';
+			if (GETID3_OS_ISWINDOWS) {
+				$errormessage .= 'PHP does not have iconv() support. Please enable php_iconv.dll in php.ini, and copy iconv.dll from c:/php/dlls to c:/windows/system32';
+			} else {
+				$errormessage .= 'PHP is not compiled with iconv() support. Please recompile with the --with-iconv switch';
+			}
+	    	return $this-&gt;error($errormessage);
+		}
+
+		// Disable magic_quotes_runtime, if neccesary
+		$old_magic_quotes_runtime = get_magic_quotes_runtime(); // store current setting of magic_quotes_runtime
+		if ($old_magic_quotes_runtime) {
+			set_magic_quotes_runtime(0);                        // turn off magic_quotes_runtime
+			if (get_magic_quotes_runtime()) {
+				return $this-&gt;error('Could not disable magic_quotes_runtime - getID3() cannot work properly with this setting enabled');
+			}
+		}
+
+		// remote files not supported
+		if (preg_match('/^(ht|f)tp:\/\//', $filename)) {
+			return $this-&gt;error('Remote files are not supported in this version of getID3() - please copy the file locally first');
+		}
+
+		// open local file
+		if (!$fp = @fopen($filename, 'rb')) {
+			return $this-&gt;error('Could not open file &quot;'.$filename.'&quot;');
+		}
+
+		// set parameters
+		$this-&gt;info['filesize'] = filesize($filename);
+
+		// option_max_2gb_check
+		if ($this-&gt;option_max_2gb_check) {
+			// PHP doesn't support integers larger than 31-bit (~2GB)
+			// filesize() simply returns (filesize % (pow(2, 32)), no matter the actual filesize
+			// ftell() returns 0 if seeking to the end is beyond the range of unsigned integer
+			fseek($fp, 0, SEEK_END);
+			if ((($this-&gt;info['filesize'] != 0) &amp;&amp; (ftell($fp) == 0)) ||
+				($this-&gt;info['filesize'] &lt; 0) ||
+				(ftell($fp) &lt; 0)) {
+					unset($this-&gt;info['filesize']);
+					fclose($fp);
+					return $this-&gt;error('File is most likely larger than 2GB and is not supported by PHP');
+			}
+		}
+
+		// set more parameters
+		$this-&gt;info['avdataoffset']        = 0;
+		$this-&gt;info['avdataend']           = $this-&gt;info['filesize'];
+		$this-&gt;info['fileformat']          = '';                // filled in later
+		$this-&gt;info['audio']['dataformat'] = '';                // filled in later, unset if not used
+		$this-&gt;info['video']['dataformat'] = '';                // filled in later, unset if not used
+		$this-&gt;info['tags']                = array();           // filled in later, unset if not used
+		$this-&gt;info['error']               = array();           // filled in later, unset if not used
+		$this-&gt;info['warning']             = array();           // filled in later, unset if not used
+		$this-&gt;info['comments']            = array();           // filled in later, unset if not used
+		$this-&gt;info['encoding']            = $this-&gt;encoding;   // required by id3v2 and iso modules - can be unset at the end if desired
+
+		// set redundant parameters - might be needed in some include file
+		$this-&gt;info['filename']            = basename($filename);
+		$this-&gt;info['filepath']            = str_replace('\\', '/', realpath(dirname($filename)));
+		$this-&gt;info['filenamepath']        = $this-&gt;info['filepath'].'/'.$this-&gt;info['filename'];
+
+
+		// handle ID3v2 tag - done first - already at beginning of file
+		// ID3v2 detection (even if not parsing) is always done otherwise fileformat is much harder to detect
+		if ($this-&gt;option_tag_id3v2) {
+
+			$GETID3_ERRORARRAY = &amp;$this-&gt;info['warning'];
+			if (getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.tag.id3v2.php', __FILE__, false)) {
+				$tag = new getid3_id3v2($fp, $this-&gt;info);
+			}
+
+		} else {
+
+			fseek($fp, 0, SEEK_SET);
+			$header = fread($fp, 10);
+			if (substr($header, 0, 3) == 'ID3') {
+				$this-&gt;info['id3v2']['header']           = true;
+				$this-&gt;info['id3v2']['majorversion']     = ord($header{3});
+				$this-&gt;info['id3v2']['minorversion']     = ord($header{4});
+				$this-&gt;info['id3v2']['headerlength']     = getid3_lib::BigEndian2Int(substr($header, 6, 4), 1) + 10; // length of ID3v2 tag in 10-byte header doesn't include 10-byte header length
+
+				$this-&gt;info['id3v2']['tag_offset_start'] = 0;
+				$this-&gt;info['id3v2']['tag_offset_end']   = $this-&gt;info['id3v2']['tag_offset_start'] + $this-&gt;info['id3v2']['headerlength'];
+				$this-&gt;info['avdataoffset']              = $this-&gt;info['id3v2']['tag_offset_end'];
+			}
+
+		}
+
+
+		// handle ID3v1 tag
+		if ($this-&gt;option_tag_id3v1) {
+			if (!@include_once(GETID3_INCLUDEPATH.'module.tag.id3v1.php')) {
+				return $this-&gt;error('module.tag.id3v1.php is missing - you may disable option_tag_id3v1.');
+			}
+			$tag = new getid3_id3v1($fp, $this-&gt;info);
+		}
+
+		// handle APE tag
+		if ($this-&gt;option_tag_apetag) {
+			if (!@include_once(GETID3_INCLUDEPATH.'module.tag.apetag.php')) {
+				return $this-&gt;error('module.tag.apetag.php is missing - you may disable option_tag_apetag.');
+			}
+			$tag = new getid3_apetag($fp, $this-&gt;info);
+		}
+
+		// handle lyrics3 tag
+		if ($this-&gt;option_tag_lyrics3) {
+			if (!@include_once(GETID3_INCLUDEPATH.'module.tag.lyrics3.php')) {
+				return $this-&gt;error('module.tag.lyrics3.php is missing - you may disable option_tag_lyrics3.');
+			}
+			$tag = new getid3_lyrics3($fp, $this-&gt;info);
+		}
+
+		// read 32 kb file data
+		fseek($fp, $this-&gt;info['avdataoffset'], SEEK_SET);
+		$formattest = fread($fp, 32774);
+
+		// determine format
+		$determined_format = $this-&gt;GetFileFormat($formattest, $filename);
+
+		// unable to determine file format
+		if (!$determined_format) {
+			fclose($fp);
+			return $this-&gt;error('unable to determine file format');
+		}
+
+		// check for illegal ID3 tags
+		if (isset($determined_format['fail_id3']) &amp;&amp; (in_array('id3v1', $this-&gt;info['tags']) || in_array('id3v2', $this-&gt;info['tags']))) {
+			if ($determined_format['fail_id3'] === 'ERROR') {
+				fclose($fp);
+				return $this-&gt;error('ID3 tags not allowed on this file type.');
+			} elseif ($determined_format['fail_id3'] === 'WARNING') {
+				$this-&gt;info['warning'][] = 'ID3 tags not allowed on this file type.';
+			}
+		}
+
+		// check for illegal APE tags
+		if (isset($determined_format['fail_ape']) &amp;&amp; in_array('ape', $this-&gt;info['tags'])) {
+			if ($determined_format['fail_ape'] === 'ERROR') {
+				fclose($fp);
+				return $this-&gt;error('APE tags not allowed on this file type.');
+			} elseif ($determined_format['fail_ape'] === 'WARNING') {
+				$this-&gt;info['warning'][] = 'APE tags not allowed on this file type.';
+			}
+		}
+
+		// set mime type
+		$this-&gt;info['mime_type'] = $determined_format['mime_type'];
+
+		// supported format signature pattern detected, but module deleted
+		if (!file_exists(GETID3_INCLUDEPATH.$determined_format['include'])) {
+			fclose($fp);
+			return $this-&gt;error('Format not supported, module, '.$determined_format['include'].', was removed.');
+		}
+
+		// module requires iconv support
+        if (!function_exists('iconv') &amp;&amp; @$determined_format['iconv_req']) {
+		    return $this-&gt;error('iconv support is required for this module ('.$determined_format['include'].').');
+		}
+
+		// include module
+		include_once(GETID3_INCLUDEPATH.$determined_format['include']);
+
+		// instantiate module class
+		$class_name = 'getid3_'.$determined_format['module'];
+		if (!class_exists($class_name)) {
+			return $this-&gt;error('Format not supported, module, '.$determined_format['include'].', is corrupt.');
+		}
+		if (isset($determined_format['option'])) {
+			$class = new $class_name($fp, $this-&gt;info, $determined_format['option']);
+		} else {
+			$class = new $class_name($fp, $this-&gt;info);
+		}
+
+		// close file
+		fclose($fp);
+
+		// process all tags - copy to 'tags' and convert charsets
+		if ($this-&gt;option_tags_process) {
+			$this-&gt;HandleAllTags();
+		}
+
+		// perform more calculations
+		if ($this-&gt;option_extra_info) {
+			$this-&gt;ChannelsBitratePlaytimeCalculations();
+			$this-&gt;CalculateCompressionRatioVideo();
+			$this-&gt;CalculateCompressionRatioAudio();
+			$this-&gt;CalculateReplayGain();
+			$this-&gt;ProcessAudioStreams();
+		}
+
+		// get the MD5 sum of the audio/video portion of the file - without ID3/APE/Lyrics3/etc header/footer tags
+		if ($this-&gt;option_md5_data) {
+			// do not cald md5_data if md5_data_source is present - set by flac only - future MPC/SV8 too
+			if (!$this-&gt;option_md5_data_source || empty($this-&gt;info['md5_data_source'])) {
+				$this-&gt;getHashdata('md5');
+			}
+		}
+
+		// get the SHA1 sum of the audio/video portion of the file - without ID3/APE/Lyrics3/etc header/footer tags
+		if ($this-&gt;option_sha1_data) {
+			$this-&gt;getHashdata('sha1');
+		}
+
+		// remove undesired keys
+		$this-&gt;CleanUp();
+
+		// restore magic_quotes_runtime setting
+		set_magic_quotes_runtime($old_magic_quotes_runtime);
+
+		// return info array
+		return $this-&gt;info;
+	}
+
+
+	// private: error handling
+	function error($message) {
+
+		$this-&gt;CleanUp();
+
+		$this-&gt;info['error'][] = $message;
+		return $this-&gt;info;
+	}
+
+
+	// private: warning handling
+	function warning($message) {
+		$this-&gt;info['warning'][] = $message;
+		return true;
+	}
+
+
+	// private: CleanUp
+	function CleanUp() {
+
+		// remove possible empty keys
+		$AVpossibleEmptyKeys = array('dataformat', 'bits_per_sample', 'encoder_options', 'streams');
+		foreach ($AVpossibleEmptyKeys as $key) {
+			if (empty($this-&gt;info['audio'][$key]) &amp;&amp; isset($this-&gt;info['audio'][$key])) {
+				unset($this-&gt;info['audio'][$key]);
+			}
+			if (empty($this-&gt;info['video'][$key]) &amp;&amp; isset($this-&gt;info['video'][$key])) {
+				unset($this-&gt;info['video'][$key]);
+			}
+		}
+
+		// remove empty root keys
+		if (!empty($this-&gt;info)) {
+			foreach ($this-&gt;info as $key =&gt; $value) {
+				if (empty($this-&gt;info[$key]) &amp;&amp; ($this-&gt;info[$key] !== 0) &amp;&amp; ($this-&gt;info[$key] !== '0')) {
+					unset($this-&gt;info[$key]);
+				}
+			}
+		}
+
+		// remove meaningless entries from unknown-format files
+		if (empty($this-&gt;info['fileformat'])) {
+			if (isset($this-&gt;info['avdataoffset'])) {
+				unset($this-&gt;info['avdataoffset']);
+			}
+			if (isset($this-&gt;info['avdataend'])) {
+				unset($this-&gt;info['avdataend']);
+			}
+		}
+	}
+
+
+	// return array containing information about all supported formats
+	function GetFileFormatArray() {
+		static $format_info = array();
+		if (empty($format_info)) {
+			$format_info = array(
+
+				// Audio formats
+
+				// AC-3   - audio      - Dolby AC-3 / Dolby Digital
+				'ac3'  =&gt; array(
+							'pattern'   =&gt; '^\x0B\x77',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'ac3',
+							'mime_type' =&gt; 'audio/ac3',
+						  ),
+
+				// AAC  - audio       - Advanced Audio Coding (AAC) - ADIF format
+				'adif' =&gt; array(
+							'pattern'   =&gt; '^ADIF',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'aac',
+							'option'    =&gt; 'adif',
+							'mime_type' =&gt; 'application/octet-stream',
+							'fail_ape'  =&gt; 'WARNING',
+						  ),
+
+
+				// AAC  - audio       - Advanced Audio Coding (AAC) - ADTS format (very similar to MP3)
+				'adts' =&gt; array(
+							'pattern'   =&gt; '^\xFF[\xF0-\xF1\xF8-\xF9]',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'aac',
+							'option'    =&gt; 'adts',
+							'mime_type' =&gt; 'application/octet-stream',
+							'fail_ape'  =&gt; 'WARNING',
+						  ),
+
+
+				// AU   - audio       - NeXT/Sun AUdio (AU)
+				'au'   =&gt; array(
+							'pattern'   =&gt; '^\.snd',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'au',
+							'mime_type' =&gt; 'audio/basic',
+						  ),
+
+				// AVR  - audio       - Audio Visual Research
+				'avr'  =&gt; array(
+							'pattern'   =&gt; '^2BIT',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'avr',
+							'mime_type' =&gt; 'application/octet-stream',
+						  ),
+
+				// BONK - audio       - Bonk v0.9+
+				'bonk' =&gt; array(
+							'pattern'   =&gt; '^\x00(BONK|INFO|META| ID3)',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'bonk',
+							'mime_type' =&gt; 'audio/xmms-bonk',
+						  ),
+
+				// FLAC - audio       - Free Lossless Audio Codec
+				'flac' =&gt; array(
+							'pattern'   =&gt; '^fLaC',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'flac',
+							'mime_type' =&gt; 'audio/x-flac',
+						  ),
+
+				// LA   - audio       - Lossless Audio (LA)
+				'la'   =&gt; array(
+							'pattern'   =&gt; '^LA0[2-4]',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'la',
+							'mime_type' =&gt; 'application/octet-stream',
+						  ),
+
+				// LPAC - audio       - Lossless Predictive Audio Compression (LPAC)
+				'lpac' =&gt; array(
+							'pattern'   =&gt; '^LPAC',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'lpac',
+							'mime_type' =&gt; 'application/octet-stream',
+						  ),
+
+				// MIDI - audio       - MIDI (Musical Instrument Digital Interface)
+				'midi' =&gt; array(
+							'pattern'   =&gt; '^MThd',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'midi',
+							'mime_type' =&gt; 'audio/midi',
+						  ),
+
+				// MAC  - audio       - Monkey's Audio Compressor
+				'mac'  =&gt; array(
+							'pattern'   =&gt; '^MAC ',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'monkey',
+							'mime_type' =&gt; 'application/octet-stream',
+						  ),
+
+				// MOD  - audio       - MODule (assorted sub-formats)
+				'mod'  =&gt; array(
+							'pattern'   =&gt; '^.{1080}(M.K.|[5-9]CHN|[1-3][0-9]CH)',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'mod',
+							'option'    =&gt; 'mod',
+							'mime_type' =&gt; 'audio/mod',
+						  ),
+
+				// MOD  - audio       - MODule (Impulse Tracker)
+				'it'   =&gt; array(
+							'pattern'   =&gt; '^IMPM',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'mod',
+							'option'    =&gt; 'it',
+							'mime_type' =&gt; 'audio/it',
+						  ),
+
+				// MOD  - audio       - MODule (eXtended Module, various sub-formats)
+				'xm'   =&gt; array(
+							'pattern'   =&gt; '^Extended Module',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'mod',
+							'option'    =&gt; 'xm',
+							'mime_type' =&gt; 'audio/xm',
+						  ),
+
+				// MOD  - audio       - MODule (ScreamTracker)
+				's3m'  =&gt; array(
+							'pattern'   =&gt; '^.{44}SCRM',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'mod',
+							'option'    =&gt; 's3m',
+							'mime_type' =&gt; 'audio/s3m',
+						  ),
+
+				// MPC  - audio       - Musepack / MPEGplus
+				'mpc'  =&gt; array(
+							'pattern'   =&gt; '^(MP\+|[\x00\x01\x10\x11\x40\x41\x50\x51\x80\x81\x90\x91\xC0\xC1\xD0\xD1][\x20-37][\x00\x20\x40\x60\x80\xA0\xC0\xE0])',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'mpc',
+							'mime_type' =&gt; 'application/octet-stream',
+						  ),
+
+				// MP3  - audio       - MPEG-audio Layer 3 (very similar to AAC-ADTS)
+				'mp3'  =&gt; array(
+							'pattern'   =&gt; '^\xFF[\xE2-\xE7\xF2-\xF7\xFA-\xFF][\x00-\xEB]',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'mp3',
+							'mime_type' =&gt; 'audio/mpeg',
+						  ),
+
+				// OFR  - audio       - OptimFROG
+				'ofr'  =&gt; array(
+							'pattern'   =&gt; '^(\*RIFF|OFR)',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'optimfrog',
+							'mime_type' =&gt; 'application/octet-stream',
+						  ),
+
+				// RKAU - audio       - RKive AUdio compressor
+				'rkau' =&gt; array(
+							'pattern'   =&gt; '^RKA',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'rkau',
+							'mime_type' =&gt; 'application/octet-stream',
+						  ),
+
+				// SHN  - audio       - Shorten
+				'shn'  =&gt; array(
+							'pattern'   =&gt; '^ajkg',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'shorten',
+							'mime_type' =&gt; 'audio/xmms-shn',
+							'fail_id3'  =&gt; 'ERROR',
+							'fail_ape'  =&gt; 'ERROR',
+						  ),
+
+				// TTA  - audio       - TTA Lossless Audio Compressor (<A HREF="http://tta.corecodec.org">http://tta.corecodec.org</A>)
+				'tta'  =&gt; array(
+							'pattern'   =&gt; '^TTA',  // could also be '^TTA(\x01|\x02|\x03|2|1)'
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'tta',
+							'mime_type' =&gt; 'application/octet-stream',
+						  ),
+
+				// VOC  - audio       - Creative Voice (VOC)
+				'voc'  =&gt; array(
+							'pattern'   =&gt; '^Creative Voice File',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'voc',
+							'mime_type' =&gt; 'audio/voc',
+						  ),
+
+				// VQF  - audio       - transform-domain weighted interleave Vector Quantization Format (VQF)
+				'vqf'  =&gt; array(
+							'pattern'   =&gt; '^TWIN',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'vqf',
+							'mime_type' =&gt; 'application/octet-stream',
+						  ),
+
+				// WV  - audio        - WavPack (v4.0+)
+				'wv'   =&gt; array(
+							'pattern'   =&gt; '^wvpk',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'wavpack',
+							'mime_type' =&gt; 'application/octet-stream',
+						  ),
+
+
+				// Audio-Video formats
+
+				// ASF  - audio/video - Advanced Streaming Format, Windows Media Video, Windows Media Audio
+				'asf'  =&gt; array(
+							'pattern'   =&gt; '^\x30\x26\xB2\x75\x8E\x66\xCF\x11\xA6\xD9\x00\xAA\x00\x62\xCE\x6C',
+							'group'     =&gt; 'audio-video',
+							'module'    =&gt; 'asf',
+							'mime_type' =&gt; 'video/x-ms-asf',
+							'iconv_req' =&gt; false,
+						  ),
+
+				// BINK  - audio/video - Bink / Smacker
+				'bink' =&gt; array(
+							'pattern'   =&gt; '^(BIK|SMK)',
+							'group'     =&gt; 'audio-video',
+							'module'    =&gt; 'bink',
+							'mime_type' =&gt; 'application/octet-stream',
+						  ),
+
+				// MKAV - audio/video - Mastroka
+				'matroska' =&gt; array(
+							'pattern'   =&gt; '^\x1A\x45\xDF\xA3',
+							'group'     =&gt; 'audio-video',
+							'module'    =&gt; 'matroska',
+							'mime_type' =&gt; 'application/octet-stream',
+						  ),
+
+				// MPEG - audio/video - MPEG (Moving Pictures Experts Group)
+				'mpeg' =&gt; array(
+							'pattern'   =&gt; '^\x00\x00\x01(\xBA|\xB3)',
+							'group'     =&gt; 'audio-video',
+							'module'    =&gt; 'mpeg',
+							'mime_type' =&gt; 'video/mpeg',
+						  ),
+
+				// NSV  - audio/video - Nullsoft Streaming Video (NSV)
+				'nsv'  =&gt; array(
+							'pattern'   =&gt; '^NSV[sf]',
+							'group'     =&gt; 'audio-video',
+							'module'    =&gt; 'nsv',
+							'mime_type' =&gt; 'application/octet-stream',
+						  ),
+
+				// Ogg  - audio/video - Ogg (Ogg-Vorbis, Ogg-FLAC, Speex, Ogg-Theora(*), Ogg-Tarkin(*))
+				'ogg'  =&gt; array(
+							'pattern'   =&gt; '^OggS',
+							'group'     =&gt; 'audio',
+							'module'    =&gt; 'ogg',
+							'mime_type' =&gt; 'application/ogg',
+							'fail_id3'  =&gt; 'WARNING',
+							'fail_ape'  =&gt; 'WARNING',
+						  ),
+
+				// QT   - audio/video - Quicktime
+				'quicktime' =&gt; array(
+							'pattern'   =&gt; '^.{4}(cmov|free|ftyp|mdat|moov|pnot|skip|wide)',
+							'group'     =&gt; 'audio-video',
+							'module'    =&gt; 'quicktime',
+							'mime_type' =&gt; 'video/quicktime',
+						  ),
+
+				// RIFF - audio/video - Resource Interchange File Format (RIFF) / WAV / AVI / CD-audio / SDSS = renamed variant used by SmartSound QuickTracks (www.smartsound.com) / FORM = Audio Interchange File Format (AIFF)
+				'riff' =&gt; array(
+							'pattern'   =&gt; '^(RIFF|SDSS|FORM)',
+							'group'     =&gt; 'audio-video',
+							'module'    =&gt; 'riff',
+							'mime_type' =&gt; 'audio/x-wave',
+							'fail_ape'  =&gt; 'WARNING',
+						  ),
+
+				// Real - audio/video - RealAudio, RealVideo
+				'real' =&gt; array(
+							'pattern'   =&gt; '^(\.RMF|.ra)',
+							'group'     =&gt; 'audio-video',
+							'module'    =&gt; 'real',
+							'mime_type' =&gt; 'audio/x-realaudio',
+						  ),
+
+				// SWF - audio/video - ShockWave Flash
+				'swf' =&gt; array(
+							'pattern'   =&gt; '^(F|C)WS',
+							'group'     =&gt; 'audio-video',
+							'module'    =&gt; 'swf',
+							'mime_type' =&gt; 'application/x-shockwave-flash',
+						  ),
+
+
+				// Still-Image formats
+
+				// BMP  - still image - Bitmap (Windows, OS/2; uncompressed, RLE8, RLE4)
+				'bmp'  =&gt; array(
+							'pattern'   =&gt; '^BM',
+							'group'     =&gt; 'graphic',
+							'module'    =&gt; 'bmp',
+							'mime_type' =&gt; 'image/bmp',
+							'fail_id3'  =&gt; 'ERROR',
+							'fail_ape'  =&gt; 'ERROR',
+						  ),
+
+				// GIF  - still image - Graphics Interchange Format
+				'gif'  =&gt; array(
+							'pattern'   =&gt; '^GIF',
+							'group'     =&gt; 'graphic',
+							'module'    =&gt; 'gif',
+							'mime_type' =&gt; 'image/gif',
+							'fail_id3'  =&gt; 'ERROR',
+							'fail_ape'  =&gt; 'ERROR',
+						  ),
+
+				// JPEG - still image - Joint Photographic Experts Group (JPEG)
+				'jpg'  =&gt; array(
+							'pattern'   =&gt; '^\xFF\xD8\xFF',
+							'group'     =&gt; 'graphic',
+							'module'    =&gt; 'jpg',
+							'mime_type' =&gt; 'image/jpeg',
+							'fail_id3'  =&gt; 'ERROR',
+							'fail_ape'  =&gt; 'ERROR',
+						  ),
+
+				// PCD  - still image - Kodak Photo CD
+				'pcd'  =&gt; array(
+							'pattern'   =&gt; '^.{2048}PCD_IPI\x00',
+							'group'     =&gt; 'graphic',
+							'module'    =&gt; 'pcd',
+							'mime_type' =&gt; 'image/x-photo-cd',
+							'fail_id3'  =&gt; 'ERROR',
+							'fail_ape'  =&gt; 'ERROR',
+						  ),
+
+
+				// PNG  - still image - Portable Network Graphics (PNG)
+				'png'  =&gt; array(
+							'pattern'   =&gt; '^\x89\x50\x4E\x47\x0D\x0A\x1A\x0A',
+							'group'     =&gt; 'graphic',
+							'module'    =&gt; 'png',
+							'mime_type' =&gt; 'image/png',
+							'fail_id3'  =&gt; 'ERROR',
+							'fail_ape'  =&gt; 'ERROR',
+						  ),
+
+
+				// TIFF  - still image - Tagged Information File Format (TIFF)
+				'tiff' =&gt; array(
+							'pattern'   =&gt; '^(II\x2A\x00|MM\x00\x2A)',
+							'group'     =&gt; 'graphic',
+							'module'    =&gt; 'tiff',
+							'mime_type' =&gt; 'image/tiff',
+							'fail_id3'  =&gt; 'ERROR',
+							'fail_ape'  =&gt; 'ERROR',
+						  ),
+
+
+				// Data formats
+
+				// ISO  - data        - International Standards Organization (ISO) CD-ROM Image
+				'iso'  =&gt; array(
+							'pattern'   =&gt; '^.{32769}CD001',
+							'group'     =&gt; 'misc',
+							'module'    =&gt; 'iso',
+							'mime_type' =&gt; 'application/octet-stream',
+							'fail_id3'  =&gt; 'ERROR',
+							'fail_ape'  =&gt; 'ERROR',
+							'iconv_req' =&gt; false,
+						  ),
+
+				// RAR  - data        - RAR compressed data
+				'rar'  =&gt; array(
+							'pattern'   =&gt; '^Rar\!',
+							'group'     =&gt; 'archive',
+							'module'    =&gt; 'rar',
+							'mime_type' =&gt; 'application/octet-stream',
+							'fail_id3'  =&gt; 'ERROR',
+							'fail_ape'  =&gt; 'ERROR',
+						  ),
+
+				// SZIP - audio       - SZIP compressed data
+				'szip' =&gt; array(
+							'pattern'   =&gt; '^SZ\x0A\x04',
+							'group'     =&gt; 'archive',
+							'module'    =&gt; 'szip',
+							'mime_type' =&gt; 'application/octet-stream',
+							'fail_id3'  =&gt; 'ERROR',
+							'fail_ape'  =&gt; 'ERROR',
+						  ),
+
+				// ZIP  - data        - ZIP compressed data
+				'zip'  =&gt; array(
+							'pattern'   =&gt; '^PK\x03\x04',
+							'group'     =&gt; 'archive',
+							'module'    =&gt; 'zip',
+							'mime_type' =&gt; 'application/zip',
+							'fail_id3'  =&gt; 'ERROR',
+							'fail_ape'  =&gt; 'ERROR',
+						  )
+			);
+		}
+
+		return $format_info;
+	}
+
+
+
+	function GetFileFormat(&amp;$filedata, $filename='') {
+		// this function will determine the format of a file based on usually
+		// the first 2-4 bytes of the file (8 bytes for PNG, 16 bytes for JPG,
+		// and in the case of ISO CD image, 6 bytes offset 32kb from the start
+		// of the file).
+
+		// Identify file format - loop through $format_info and detect with reg expr
+		foreach ($this-&gt;GetFileFormatArray() as $format_name =&gt; $info) {
+			// Using preg_match() instead of ereg() - much faster
+			// The /s switch on preg_match() forces preg_match() NOT to treat
+			// newline (0x0A) characters as special chars but do a binary match
+			if (preg_match('/'.$info['pattern'].'/s', $filedata)) {
+				$info['include'] = 'module.'.$info['group'].'.'.$info['module'].'.php';
+				return $info;
+			}
+		}
+
+		// Too many mp3 encoders on the market put gabage in front of mpeg files
+		// use assume format on these if format detection failed
+		if (preg_match('/\.mp[123a]$/i', $filename)) {
+			$GetFileFormatArray = $this-&gt;GetFileFormatArray();
+			$info = $GetFileFormatArray['mp3'];
+			$info['include'] = 'module.'.$info['group'].'.'.$info['module'].'.php';
+			return $info;
+		}
+
+		return false;
+	}
+
+
+	// converts array to $encoding charset from $this-&gt;encoding
+	function CharConvert(&amp;$array, $encoding) {
+
+		// identical encoding - end here
+		if ($encoding == $this-&gt;encoding) {
+			return;
+		}
+
+		// loop thru array
+		foreach ($array as $key =&gt; $value) {
+
+			// go recursive
+			if (is_array($value)) {
+				$this-&gt;CharConvert($array[$key], $encoding);
+			}
+
+			// convert string
+			elseif (is_string($value)) {
+				$array[$key] = trim(getid3_lib::iconv_fallback($encoding, $this-&gt;encoding, $value));
+			}
+		}
+	}
+
+
+	function HandleAllTags() {
+
+		// key name =&gt; array (tag name, character encoding)
+		static $tags;
+		if (empty($tags)) {
+			$tags = array(
+				'asf'       =&gt; array('asf'           , 'UTF-16LE'),
+				'midi'      =&gt; array('midi'          , 'ISO-8859-1'),
+				'nsv'       =&gt; array('nsv'           , 'ISO-8859-1'),
+				'ogg'       =&gt; array('vorbiscomment' , 'UTF-8'),
+				'png'       =&gt; array('png'           , 'UTF-8'),
+				'tiff'      =&gt; array('tiff'          , 'ISO-8859-1'),
+				'quicktime' =&gt; array('quicktime'     , 'ISO-8859-1'),
+				'real'      =&gt; array('real'          , 'ISO-8859-1'),
+				'vqf'       =&gt; array('vqf'           , 'ISO-8859-1'),
+				'zip'       =&gt; array('zip'           , 'ISO-8859-1'),
+				'riff'      =&gt; array('riff'          , 'ISO-8859-1'),
+				'lyrics3'   =&gt; array('lyrics3'       , 'ISO-8859-1'),
+				'id3v1'     =&gt; array('id3v1'         , $this-&gt;encoding_id3v1),
+				'id3v2'     =&gt; array('id3v2'         , 'UTF-8'), // not according to the specs (every frame can have a different encoding), but getID3() force-converts all encodings to UTF-8
+				'ape'       =&gt; array('ape'           , 'UTF-8')
+			);
+		}
+
+		// loop thru comments array
+		foreach ($tags as $comment_name =&gt; $tagname_encoding_array) {
+			list($tag_name, $encoding) = $tagname_encoding_array;
+
+			// fill in default encoding type if not already present
+			if (isset($this-&gt;info[$comment_name]) &amp;&amp; !isset($this-&gt;info[$comment_name]['encoding'])) {
+				$this-&gt;info[$comment_name]['encoding'] = $encoding;
+			}
+
+			// copy comments if key name set
+			if (!empty($this-&gt;info[$comment_name]['comments'])) {
+
+				foreach ($this-&gt;info[$comment_name]['comments'] as $tag_key =&gt; $valuearray) {
+					foreach ($valuearray as $key =&gt; $value) {
+						if (strlen(trim($value)) &gt; 0) {
+							$this-&gt;info['tags'][trim($tag_name)][trim($tag_key)][] = $value; // do not trim!! Unicode characters will get mangled if trailing nulls are removed!
+						}
+					}
+				}
+
+				if (!isset($this-&gt;info['tags'][$tag_name])) {
+					// comments are set but contain nothing but empty strings, so skip
+					continue;
+				}
+
+				if ($this-&gt;option_tags_html) {
+					foreach ($this-&gt;info['tags'][$tag_name] as $tag_key =&gt; $valuearray) {
+						foreach ($valuearray as $key =&gt; $value) {
+							if (is_string($value)) {
+								//$this-&gt;info['tags_html'][$tag_name][$tag_key][$key] = getid3_lib::MultiByteCharString2HTML($value, $encoding);
+								$this-&gt;info['tags_html'][$tag_name][$tag_key][$key] = str_replace('&#0;', '', getid3_lib::MultiByteCharString2HTML($value, $encoding));
+							} else {
+								$this-&gt;info['tags_html'][$tag_name][$tag_key][$key] = $value;
+							}
+						}
+					}
+				}
+
+				$this-&gt;CharConvert($this-&gt;info['tags'][$tag_name], $encoding);           // only copy gets converted!
+			}
+
+		}
+		return true;
+	}
+
+
+	function getHashdata($algorithm) {
+		switch ($algorithm) {
+			case 'md5':
+			case 'sha1':
+				break;
+
+			default:
+				return $this-&gt;error('bad algorithm &quot;'.$algorithm.'&quot; in getHashdata()');
+				break;
+		}
+
+		if ((@$this-&gt;info['fileformat'] == 'ogg') &amp;&amp; (@$this-&gt;info['audio']['dataformat'] == 'vorbis')) {
+
+			// We cannot get an identical md5_data value for Ogg files where the comments
+			// span more than 1 Ogg page (compared to the same audio data with smaller
+			// comments) using the normal getID3() method of MD5'ing the data between the
+			// end of the comments and the end of the file (minus any trailing tags),
+			// because the page sequence numbers of the pages that the audio data is on
+			// do not match. Under normal circumstances, where comments are smaller than
+			// the nominal 4-8kB page size, then this is not a problem, but if there are
+			// very large comments, the only way around it is to strip off the comment
+			// tags with vorbiscomment and MD5 that file.
+			// This procedure must be applied to ALL Ogg files, not just the ones with
+			// comments larger than 1 page, because the below method simply MD5's the
+			// whole file with the comments stripped, not just the portion after the
+			// comments block (which is the standard getID3() method.
+
+			// The above-mentioned problem of comments spanning multiple pages and changing
+			// page sequence numbers likely happens for OggSpeex and OggFLAC as well, but
+			// currently vorbiscomment only works on OggVorbis files.
+
+			if ((bool) ini_get('safe_mode')) {
+
+				$this-&gt;info['warning'][] = 'Failed making system call to vorbiscomment.exe - '.$algorithm.'_data is incorrect - error returned: PHP running in Safe Mode (backtick operator not available)';
+				$this-&gt;info[$algorithm.'_data']  = false;
+
+			} else {
+
+				// Prevent user from aborting script
+				$old_abort = ignore_user_abort(true);
+
+				// Create empty file
+				$empty = tempnam('*', 'getID3');
+				touch($empty);
+
+
+				// Use vorbiscomment to make temp file without comments
+				$temp = tempnam('*', 'getID3');
+				$file = $this-&gt;info['filenamepath'];
+
+				if (GETID3_OS_ISWINDOWS) {
+
+					if (file_exists(GETID3_HELPERAPPSDIR.'vorbiscomment.exe')) {
+
+						$commandline = '&quot;'.GETID3_HELPERAPPSDIR.'vorbiscomment.exe&quot; -w -c &quot;'.$empty.'&quot; &quot;'.$file.'&quot; &quot;'.$temp.'&quot;';
+						$VorbisCommentError = `$commandline`;
+
+					} else {
+
+						$VorbisCommentError = 'vorbiscomment.exe not found in '.GETID3_HELPERAPPSDIR;
+
+					}
+
+				} else {
+
+					$commandline = 'vorbiscomment -w -c &quot;'.$empty.'&quot; &quot;'.$file.'&quot; &quot;'.$temp.'&quot; 2&gt;&amp;1';
+					$VorbisCommentError = `$commandline`;
+
+				}
+
+				if (!empty($VorbisCommentError)) {
+
+					$this-&gt;info['warning'][]         = 'Failed making system call to vorbiscomment(.exe) - '.$algorithm.'_data will be incorrect. If vorbiscomment is unavailable, please download from <A HREF="http://www.vorbis.com/download.psp">http://www.vorbis.com/download.psp</A> and put in the getID3() directory. Error returned: '.$VorbisCommentError;
+					$this-&gt;info[$algorithm.'_data']  = false;
+
+				} else {
+
+					// Get hash of newly created file
+					switch ($algorithm) {
+						case 'md5':
+							$this-&gt;info[$algorithm.'_data'] = getid3_lib::md5_file($temp);
+							break;
+
+						case 'sha1':
+							$this-&gt;info[$algorithm.'_data'] = getid3_lib::sha1_file($temp);
+							break;
+					}
+				}
+
+				// Clean up
+				unlink($empty);
+				unlink($temp);
+
+				// Reset abort setting
+				ignore_user_abort($old_abort);
+
+			}
+
+		} else {
+
+			if (!empty($this-&gt;info['avdataoffset']) || (isset($this-&gt;info['avdataend']) &amp;&amp; ($this-&gt;info['avdataend'] &lt; $this-&gt;info['filesize']))) {
+
+				// get hash from part of file
+				$this-&gt;info[$algorithm.'_data'] = getid3_lib::hash_data($this-&gt;info['filenamepath'], $this-&gt;info['avdataoffset'], $this-&gt;info['avdataend'], $algorithm);
+
+			} else {
+
+				// get hash from whole file
+				switch ($algorithm) {
+					case 'md5':
+						$this-&gt;info[$algorithm.'_data'] = getid3_lib::md5_file($this-&gt;info['filenamepath']);
+						break;
+
+					case 'sha1':
+						$this-&gt;info[$algorithm.'_data'] = getid3_lib::sha1_file($this-&gt;info['filenamepath']);
+						break;
+				}
+			}
+
+		}
+		return true;
+	}
+
+
+	function ChannelsBitratePlaytimeCalculations() {
+
+		// set channelmode on audio
+		if (@$this-&gt;info['audio']['channels'] == '1') {
+			$this-&gt;info['audio']['channelmode'] = 'mono';
+		} elseif (@$this-&gt;info['audio']['channels'] == '2') {
+			$this-&gt;info['audio']['channelmode'] = 'stereo';
+		}
+
+		// Calculate combined bitrate - audio + video
+		$CombinedBitrate  = 0;
+		$CombinedBitrate += (isset($this-&gt;info['audio']['bitrate']) ? $this-&gt;info['audio']['bitrate'] : 0);
+		$CombinedBitrate += (isset($this-&gt;info['video']['bitrate']) ? $this-&gt;info['video']['bitrate'] : 0);
+		if (($CombinedBitrate &gt; 0) &amp;&amp; empty($this-&gt;info['bitrate'])) {
+			$this-&gt;info['bitrate'] = $CombinedBitrate;
+		}
+		//if ((isset($this-&gt;info['video']) &amp;&amp; !isset($this-&gt;info['video']['bitrate'])) || (isset($this-&gt;info['audio']) &amp;&amp; !isset($this-&gt;info['audio']['bitrate']))) {
+		//	// for example, VBR MPEG video files cannot determine video bitrate:
+		//	// should not set overall bitrate and playtime from audio bitrate only
+		//	unset($this-&gt;info['bitrate']);
+		//}
+
+		if (!isset($this-&gt;info['playtime_seconds']) &amp;&amp; !empty($this-&gt;info['bitrate'])) {
+			$this-&gt;info['playtime_seconds'] = (($this-&gt;info['avdataend'] - $this-&gt;info['avdataoffset']) * 8) / $this-&gt;info['bitrate'];
+		}
+
+		// Set playtime string
+		if (!empty($this-&gt;info['playtime_seconds']) &amp;&amp; empty($this-&gt;info['playtime_string'])) {
+			$this-&gt;info['playtime_string'] = getid3_lib::PlaytimeString($this-&gt;info['playtime_seconds']);
+		}
+	}
+
+
+	function CalculateCompressionRatioVideo() {
+		if (empty($this-&gt;info['video'])) {
+			return false;
+		}
+		if (empty($this-&gt;info['video']['resolution_x']) || empty($this-&gt;info['video']['resolution_y'])) {
+			return false;
+		}
+		if (empty($this-&gt;info['video']['bits_per_sample'])) {
+			return false;
+		}
+
+		switch ($this-&gt;info['video']['dataformat']) {
+			case 'bmp':
+			case 'gif':
+			case 'jpeg':
+			case 'jpg':
+			case 'png':
+			case 'tiff':
+				$FrameRate = 1;
+				$PlaytimeSeconds = 1;
+				$BitrateCompressed = $this-&gt;info['filesize'] * 8;
+				break;
+
+			default:
+				if (!empty($this-&gt;info['video']['frame_rate'])) {
+					$FrameRate = $this-&gt;info['video']['frame_rate'];
+				} else {
+					return false;
+				}
+				if (!empty($this-&gt;info['playtime_seconds'])) {
+					$PlaytimeSeconds = $this-&gt;info['playtime_seconds'];
+				} else {
+					return false;
+				}
+				if (!empty($this-&gt;info['video']['bitrate'])) {
+					$BitrateCompressed = $this-&gt;info['video']['bitrate'];
+				} else {
+					return false;
+				}
+				break;
+		}
+		$BitrateUncompressed = $this-&gt;info['video']['resolution_x'] * $this-&gt;info['video']['resolution_y'] * $this-&gt;info['video']['bits_per_sample'] * $FrameRate;
+
+		$this-&gt;info['video']['compression_ratio'] = $BitrateCompressed / $BitrateUncompressed;
+		return true;
+	}
+
+
+	function CalculateCompressionRatioAudio() {
+		if (empty($this-&gt;info['audio']['bitrate']) || empty($this-&gt;info['audio']['channels']) || empty($this-&gt;info['audio']['sample_rate'])) {
+			return false;
+		}
+		$this-&gt;info['audio']['compression_ratio'] = $this-&gt;info['audio']['bitrate'] / ($this-&gt;info['audio']['channels'] * $this-&gt;info['audio']['sample_rate'] * (!empty($this-&gt;info['audio']['bits_per_sample']) ? $this-&gt;info['audio']['bits_per_sample'] : 16));
+
+		if (!empty($this-&gt;info['audio']['streams'])) {
+			foreach ($this-&gt;info['audio']['streams'] as $streamnumber =&gt; $streamdata) {
+				if (!empty($streamdata['bitrate']) &amp;&amp; !empty($streamdata['channels']) &amp;&amp; !empty($streamdata['sample_rate'])) {
+					$this-&gt;info['audio']['streams'][$streamnumber]['compression_ratio'] = $streamdata['bitrate'] / ($streamdata['channels'] * $streamdata['sample_rate'] * (!empty($streamdata['bits_per_sample']) ? $streamdata['bits_per_sample'] : 16));
+				}
+			}
+		}
+		return true;
+	}
+
+
+	function CalculateReplayGain() {
+		if (isset($this-&gt;info['replay_gain'])) {
+			$this-&gt;info['replay_gain']['reference_volume'] = 89;
+			if (isset($this-&gt;info['replay_gain']['track']['adjustment'])) {
+				$this-&gt;info['replay_gain']['track']['volume'] = $this-&gt;info['replay_gain']['reference_volume'] - $this-&gt;info['replay_gain']['track']['adjustment'];
+			}
+			if (isset($this-&gt;info['replay_gain']['album']['adjustment'])) {
+				$this-&gt;info['replay_gain']['album']['volume'] = $this-&gt;info['replay_gain']['reference_volume'] - $this-&gt;info['replay_gain']['album']['adjustment'];
+			}
+
+			if (isset($this-&gt;info['replay_gain']['track']['peak'])) {
+				$this-&gt;info['replay_gain']['track']['max_noclip_gain'] = 0 - getid3_lib::RGADamplitude2dB($this-&gt;info['replay_gain']['track']['peak']);
+			}
+			if (isset($this-&gt;info['replay_gain']['album']['peak'])) {
+				$this-&gt;info['replay_gain']['album']['max_noclip_gain'] = 0 - getid3_lib::RGADamplitude2dB($this-&gt;info['replay_gain']['album']['peak']);
+			}
+		}
+		return true;
+	}
+
+	function ProcessAudioStreams() {
+		if (!empty($this-&gt;info['audio']['bitrate']) || !empty($this-&gt;info['audio']['channels']) || !empty($this-&gt;info['audio']['sample_rate'])) {
+			if (!isset($this-&gt;info['audio']['streams'])) {
+				foreach ($this-&gt;info['audio'] as $key =&gt; $value) {
+					if ($key != 'streams') {
+						$this-&gt;info['audio']['streams'][0][$key] = $value;
+					}
+				}
+			}
+		}
+		return true;
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/getid3.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.archive.rar.php
===================================================================
--- trunk/inc/external/getid3/module.archive.rar.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.archive.rar.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,32 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.archive.rar.php                                      //
+// module for analyzing RAR files                              //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_rar
+{
+
+	function getid3_rar(&amp;$fd, &amp;$ThisFileInfo) {
+
+		$ThisFileInfo['fileformat'] = 'rar';
+
+		$ThisFileInfo['error'][] = 'RAR parsing not enabled in this version of getID3()';
+		return false;
+
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.archive.rar.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.archive.szip.php
===================================================================
--- trunk/inc/external/getid3/module.archive.szip.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.archive.szip.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,97 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.archive.szip.php                                     //
+// module for analyzing SZIP compressed files                  //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_szip
+{
+
+	function getid3_szip(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$SZIPHeader = fread($fd, 6);
+		if (substr($SZIPHeader, 0, 4) != 'SZ'.&quot;\x0A\x04&quot;) {
+			$ThisFileInfo['error'][] = 'Expecting &quot;SZ[x0A][x04]&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.substr($SZIPHeader, 0, 4).'&quot;';
+			return false;
+		}
+
+		$ThisFileInfo['fileformat']            = 'szip';
+
+		$ThisFileInfo['szip']['major_version'] = getid3_lib::BigEndian2Int(substr($SZIPHeader, 4, 1));
+		$ThisFileInfo['szip']['minor_version'] = getid3_lib::BigEndian2Int(substr($SZIPHeader, 5, 1));
+
+		while (!feof($fd)) {
+			$NextBlockID = fread($fd, 2);
+			switch ($NextBlockID) {
+				case 'SZ':
+					// Note that szip files can be concatenated, this has the same effect as
+					// concatenating the files. this also means that global header blocks
+					// might be present between directory/data blocks.
+					fseek($fd, 4, SEEK_CUR);
+					break;
+
+				case 'BH':
+					$BHheaderbytes  = getid3_lib::BigEndian2Int(fread($fd, 3));
+					$BHheaderdata   = fread($fd, $BHheaderbytes);
+					$BHheaderoffset = 0;
+					while (strpos($BHheaderdata, &quot;\x00&quot;, $BHheaderoffset) &gt; 0) {
+						//filename as \0 terminated string  (empty string indicates end)
+						//owner as \0 terminated string (empty is same as last file)
+						//group as \0 terminated string (empty is same as last file)
+						//3 byte filelength in this block
+						//2 byte access flags
+						//4 byte creation time (like in unix)
+						//4 byte modification time (like in unix)
+						//4 byte access time (like in unix)
+
+						$BHdataArray['filename'] = substr($BHheaderdata, $BHheaderoffset, strcspn($BHheaderdata, &quot;\x00&quot;));
+						$BHheaderoffset += (strlen($BHdataArray['filename']) + 1);
+
+						$BHdataArray['owner'] = substr($BHheaderdata, $BHheaderoffset, strcspn($BHheaderdata, &quot;\x00&quot;));
+						$BHheaderoffset += (strlen($BHdataArray['owner']) + 1);
+
+						$BHdataArray['group'] = substr($BHheaderdata, $BHheaderoffset, strcspn($BHheaderdata, &quot;\x00&quot;));
+						$BHheaderoffset += (strlen($BHdataArray['group']) + 1);
+
+						$BHdataArray['filelength'] = getid3_lib::BigEndian2Int(substr($BHheaderdata, $BHheaderoffset, 3));
+						$BHheaderoffset += 3;
+
+						$BHdataArray['access_flags'] = getid3_lib::BigEndian2Int(substr($BHheaderdata, $BHheaderoffset, 2));
+						$BHheaderoffset += 2;
+
+						$BHdataArray['creation_time'] = getid3_lib::BigEndian2Int(substr($BHheaderdata, $BHheaderoffset, 4));
+						$BHheaderoffset += 4;
+
+						$BHdataArray['modification_time'] = getid3_lib::BigEndian2Int(substr($BHheaderdata, $BHheaderoffset, 4));
+						$BHheaderoffset += 4;
+
+						$BHdataArray['access_time'] = getid3_lib::BigEndian2Int(substr($BHheaderdata, $BHheaderoffset, 4));
+						$BHheaderoffset += 4;
+
+						$ThisFileInfo['szip']['BH'][] = $BHdataArray;
+					}
+					break;
+
+				default:
+					break 2;
+			}
+		}
+
+		return true;
+
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.archive.szip.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.archive.zip.php
===================================================================
--- trunk/inc/external/getid3/module.archive.zip.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.archive.zip.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,415 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.archive.zip.php                                      //
+// module for analyzing pkZip files                            //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_zip
+{
+
+	function getid3_zip(&amp;$fd, &amp;$ThisFileInfo) {
+
+		$ThisFileInfo['fileformat']      = 'zip';
+		$ThisFileInfo['zip']['encoding'] = 'ISO-8859-1';
+		$ThisFileInfo['zip']['files']    = array();
+
+		$ThisFileInfo['zip']['compressed_size']   = 0;
+		$ThisFileInfo['zip']['uncompressed_size'] = 0;
+		$ThisFileInfo['zip']['entries_count']     = 0;
+
+		$EOCDsearchData    = '';
+		$EOCDsearchCounter = 0;
+		while ($EOCDsearchCounter++ &lt; 512) {
+
+			fseek($fd, -128 * $EOCDsearchCounter, SEEK_END);
+			$EOCDsearchData = fread($fd, 128).$EOCDsearchData;
+
+			if (strstr($EOCDsearchData, 'PK'.&quot;\x05\x06&quot;)) {
+
+				$EOCDposition = strpos($EOCDsearchData, 'PK'.&quot;\x05\x06&quot;);
+				fseek($fd, (-128 * $EOCDsearchCounter) + $EOCDposition, SEEK_END);
+				$ThisFileInfo['zip']['end_central_directory'] = $this-&gt;ZIPparseEndOfCentralDirectory($fd);
+
+				fseek($fd, $ThisFileInfo['zip']['end_central_directory']['directory_offset'], SEEK_SET);
+				$ThisFileInfo['zip']['entries_count'] = 0;
+				while ($centraldirectoryentry = $this-&gt;ZIPparseCentralDirectory($fd)) {
+					$ThisFileInfo['zip']['central_directory'][] = $centraldirectoryentry;
+					$ThisFileInfo['zip']['entries_count']++;
+					$ThisFileInfo['zip']['compressed_size']   += $centraldirectoryentry['compressed_size'];
+					$ThisFileInfo['zip']['uncompressed_size'] += $centraldirectoryentry['uncompressed_size'];
+
+					if ($centraldirectoryentry['uncompressed_size'] &gt; 0) {
+						$ThisFileInfo['zip']['files'] = getid3_lib::array_merge_clobber($ThisFileInfo['zip']['files'], getid3_lib::CreateDeepArray($centraldirectoryentry['filename'], '/', $centraldirectoryentry['uncompressed_size']));
+					}
+				}
+
+				if ($ThisFileInfo['zip']['entries_count'] == 0) {
+					$ThisFileInfo['error'][] = 'No Central Directory entries found (truncated file?)';
+					return false;
+				}
+
+				if (!empty($ThisFileInfo['zip']['end_central_directory']['comment'])) {
+					$ThisFileInfo['zip']['comments']['comment'][] = $ThisFileInfo['zip']['end_central_directory']['comment'];
+				}
+
+				if (isset($ThisFileInfo['zip']['central_directory'][0]['compression_method'])) {
+					$ThisFileInfo['zip']['compression_method'] = $ThisFileInfo['zip']['central_directory'][0]['compression_method'];
+				}
+				if (isset($ThisFileInfo['zip']['central_directory'][0]['flags']['compression_speed'])) {
+					$ThisFileInfo['zip']['compression_speed']  = $ThisFileInfo['zip']['central_directory'][0]['flags']['compression_speed'];
+				}
+				if (isset($ThisFileInfo['zip']['compression_method']) &amp;&amp; ($ThisFileInfo['zip']['compression_method'] == 'store') &amp;&amp; !isset($ThisFileInfo['zip']['compression_speed'])) {
+					$ThisFileInfo['zip']['compression_speed']  = 'store';
+				}
+
+				return true;
+
+			}
+
+		}
+
+		if ($this-&gt;getZIPentriesFilepointer($fd, $ThisFileInfo)) {
+
+			// central directory couldn't be found and/or parsed
+			// scan through actual file data entries, recover as much as possible from probable trucated file
+			if ($ThisFileInfo['zip']['compressed_size'] &gt; ($ThisFileInfo['filesize'] - 46 - 22)) {
+				$ThisFileInfo['error'][] = 'Warning: Truncated file! - Total compressed file sizes ('.$ThisFileInfo['zip']['compressed_size'].' bytes) is greater than filesize minus Central Directory and End Of Central Directory structures ('.($ThisFileInfo['filesize'] - 46 - 22).' bytes)';
+			}
+			$ThisFileInfo['error'][] = 'Cannot find End Of Central Directory - returned list of files in [zip][entries] array may not be complete';
+			foreach ($ThisFileInfo['zip']['entries'] as $key =&gt; $valuearray) {
+				$ThisFileInfo['zip']['files'][$valuearray['filename']] = $valuearray['uncompressed_size'];
+			}
+			return true;
+
+		} else {
+
+			unset($ThisFileInfo['zip']);
+			$ThisFileInfo['fileformat'] = '';
+			$ThisFileInfo['error'][] = 'Cannot find End Of Central Directory (truncated file?)';
+			return false;
+
+		}
+	}
+
+
+	function getZIPHeaderFilepointerTopDown(&amp;$fd, &amp;$ThisFileInfo) {
+		$ThisFileInfo['fileformat'] = 'zip';
+
+		$ThisFileInfo['zip']['compressed_size']   = 0;
+		$ThisFileInfo['zip']['uncompressed_size'] = 0;
+		$ThisFileInfo['zip']['entries_count']     = 0;
+
+		rewind($fd);
+		while ($fileentry = $this-&gt;ZIPparseLocalFileHeader($fd)) {
+			$ThisFileInfo['zip']['entries'][] = $fileentry;
+			$ThisFileInfo['zip']['entries_count']++;
+		}
+		if ($ThisFileInfo['zip']['entries_count'] == 0) {
+			$ThisFileInfo['error'][] = 'No Local File Header entries found';
+			return false;
+		}
+
+		$ThisFileInfo['zip']['entries_count']     = 0;
+		while ($centraldirectoryentry = $this-&gt;ZIPparseCentralDirectory($fd)) {
+			$ThisFileInfo['zip']['central_directory'][] = $centraldirectoryentry;
+			$ThisFileInfo['zip']['entries_count']++;
+			$ThisFileInfo['zip']['compressed_size']   += $centraldirectoryentry['compressed_size'];
+			$ThisFileInfo['zip']['uncompressed_size'] += $centraldirectoryentry['uncompressed_size'];
+		}
+		if ($ThisFileInfo['zip']['entries_count'] == 0) {
+			$ThisFileInfo['error'][] = 'No Central Directory entries found (truncated file?)';
+			return false;
+		}
+
+		if ($EOCD = $this-&gt;ZIPparseEndOfCentralDirectory($fd)) {
+			$ThisFileInfo['zip']['end_central_directory'] = $EOCD;
+		} else {
+			$ThisFileInfo['error'][] = 'No End Of Central Directory entry found (truncated file?)';
+			return false;
+		}
+
+		if (!empty($ThisFileInfo['zip']['end_central_directory']['comment'])) {
+			$ThisFileInfo['zip']['comments']['comment'][] = $ThisFileInfo['zip']['end_central_directory']['comment'];
+		}
+
+		return true;
+	}
+
+
+	function getZIPentriesFilepointer(&amp;$fd, &amp;$ThisFileInfo) {
+		$ThisFileInfo['zip']['compressed_size']   = 0;
+		$ThisFileInfo['zip']['uncompressed_size'] = 0;
+		$ThisFileInfo['zip']['entries_count']     = 0;
+
+		rewind($fd);
+		while ($fileentry = $this-&gt;ZIPparseLocalFileHeader($fd)) {
+			$ThisFileInfo['zip']['entries'][] = $fileentry;
+			$ThisFileInfo['zip']['entries_count']++;
+			$ThisFileInfo['zip']['compressed_size']   += $fileentry['compressed_size'];
+			$ThisFileInfo['zip']['uncompressed_size'] += $fileentry['uncompressed_size'];
+		}
+		if ($ThisFileInfo['zip']['entries_count'] == 0) {
+			$ThisFileInfo['error'][] = 'No Local File Header entries found';
+			return false;
+		}
+
+		return true;
+	}
+
+
+	function ZIPparseLocalFileHeader(&amp;$fd) {
+		$LocalFileHeader['offset'] = ftell($fd);
+
+		$ZIPlocalFileHeader = fread($fd, 30);
+
+		$LocalFileHeader['raw']['signature']          = getid3_lib::LittleEndian2Int(substr($ZIPlocalFileHeader,  0, 4));
+		if ($LocalFileHeader['raw']['signature'] != 0x04034B50) {
+			// invalid Local File Header Signature
+			fseek($fd, $LocalFileHeader['offset'], SEEK_SET); // seek back to where filepointer originally was so it can be handled properly
+			return false;
+		}
+		$LocalFileHeader['raw']['extract_version']    = getid3_lib::LittleEndian2Int(substr($ZIPlocalFileHeader,  4, 2));
+		$LocalFileHeader['raw']['general_flags']      = getid3_lib::LittleEndian2Int(substr($ZIPlocalFileHeader,  6, 2));
+		$LocalFileHeader['raw']['compression_method'] = getid3_lib::LittleEndian2Int(substr($ZIPlocalFileHeader,  8, 2));
+		$LocalFileHeader['raw']['last_mod_file_time'] = getid3_lib::LittleEndian2Int(substr($ZIPlocalFileHeader, 10, 2));
+		$LocalFileHeader['raw']['last_mod_file_date'] = getid3_lib::LittleEndian2Int(substr($ZIPlocalFileHeader, 12, 2));
+		$LocalFileHeader['raw']['crc_32']             = getid3_lib::LittleEndian2Int(substr($ZIPlocalFileHeader, 14, 4));
+		$LocalFileHeader['raw']['compressed_size']    = getid3_lib::LittleEndian2Int(substr($ZIPlocalFileHeader, 18, 4));
+		$LocalFileHeader['raw']['uncompressed_size']  = getid3_lib::LittleEndian2Int(substr($ZIPlocalFileHeader, 22, 4));
+		$LocalFileHeader['raw']['filename_length']    = getid3_lib::LittleEndian2Int(substr($ZIPlocalFileHeader, 26, 2));
+		$LocalFileHeader['raw']['extra_field_length'] = getid3_lib::LittleEndian2Int(substr($ZIPlocalFileHeader, 28, 2));
+
+		$LocalFileHeader['extract_version']           = sprintf('%1.1f', $LocalFileHeader['raw']['extract_version'] / 10);
+		$LocalFileHeader['host_os']                   = $this-&gt;ZIPversionOSLookup(($LocalFileHeader['raw']['extract_version'] &amp; 0xFF00) &gt;&gt; 8);
+		$LocalFileHeader['compression_method']        = $this-&gt;ZIPcompressionMethodLookup($LocalFileHeader['raw']['compression_method']);
+		$LocalFileHeader['compressed_size']           = $LocalFileHeader['raw']['compressed_size'];
+		$LocalFileHeader['uncompressed_size']         = $LocalFileHeader['raw']['uncompressed_size'];
+		$LocalFileHeader['flags']                     = $this-&gt;ZIPparseGeneralPurposeFlags($LocalFileHeader['raw']['general_flags'], $LocalFileHeader['raw']['compression_method']);
+		$LocalFileHeader['last_modified_timestamp']   = $this-&gt;DOStime2UNIXtime($LocalFileHeader['raw']['last_mod_file_date'], $LocalFileHeader['raw']['last_mod_file_time']);
+
+		$FilenameExtrafieldLength = $LocalFileHeader['raw']['filename_length'] + $LocalFileHeader['raw']['extra_field_length'];
+		if ($FilenameExtrafieldLength &gt; 0) {
+			$ZIPlocalFileHeader .= fread($fd, $FilenameExtrafieldLength);
+
+			if ($LocalFileHeader['raw']['filename_length'] &gt; 0) {
+				$LocalFileHeader['filename']                    = substr($ZIPlocalFileHeader, 30, $LocalFileHeader['raw']['filename_length']);
+			}
+			if ($LocalFileHeader['raw']['extra_field_length'] &gt; 0) {
+				$LocalFileHeader['raw']['extra_field_data'] = substr($ZIPlocalFileHeader, 30 + $LocalFileHeader['raw']['filename_length'], $LocalFileHeader['raw']['extra_field_length']);
+			}
+		}
+
+		$LocalFileHeader['data_offset'] = ftell($fd);
+		//$LocalFileHeader['compressed_data'] = fread($fd, $LocalFileHeader['raw']['compressed_size']);
+		fseek($fd, $LocalFileHeader['raw']['compressed_size'], SEEK_CUR);
+
+		if ($LocalFileHeader['flags']['data_descriptor_used']) {
+			$DataDescriptor = fread($fd, 12);
+			$LocalFileHeader['data_descriptor']['crc_32']            = getid3_lib::LittleEndian2Int(substr($DataDescriptor,  0, 4));
+			$LocalFileHeader['data_descriptor']['compressed_size']   = getid3_lib::LittleEndian2Int(substr($DataDescriptor,  4, 4));
+			$LocalFileHeader['data_descriptor']['uncompressed_size'] = getid3_lib::LittleEndian2Int(substr($DataDescriptor,  8, 4));
+		}
+
+		return $LocalFileHeader;
+	}
+
+
+	function ZIPparseCentralDirectory(&amp;$fd) {
+		$CentralDirectory['offset'] = ftell($fd);
+
+		$ZIPcentralDirectory = fread($fd, 46);
+
+		$CentralDirectory['raw']['signature']            = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory,  0, 4));
+		if ($CentralDirectory['raw']['signature'] != 0x02014B50) {
+			// invalid Central Directory Signature
+			fseek($fd, $CentralDirectory['offset'], SEEK_SET); // seek back to where filepointer originally was so it can be handled properly
+			return false;
+		}
+		$CentralDirectory['raw']['create_version']       = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory,  4, 2));
+		$CentralDirectory['raw']['extract_version']      = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory,  6, 2));
+		$CentralDirectory['raw']['general_flags']        = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory,  8, 2));
+		$CentralDirectory['raw']['compression_method']   = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory, 10, 2));
+		$CentralDirectory['raw']['last_mod_file_time']   = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory, 12, 2));
+		$CentralDirectory['raw']['last_mod_file_date']   = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory, 14, 2));
+		$CentralDirectory['raw']['crc_32']               = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory, 16, 4));
+		$CentralDirectory['raw']['compressed_size']      = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory, 20, 4));
+		$CentralDirectory['raw']['uncompressed_size']    = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory, 24, 4));
+		$CentralDirectory['raw']['filename_length']      = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory, 28, 2));
+		$CentralDirectory['raw']['extra_field_length']   = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory, 30, 2));
+		$CentralDirectory['raw']['file_comment_length']  = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory, 32, 2));
+		$CentralDirectory['raw']['disk_number_start']    = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory, 34, 2));
+		$CentralDirectory['raw']['internal_file_attrib'] = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory, 36, 2));
+		$CentralDirectory['raw']['external_file_attrib'] = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory, 38, 4));
+		$CentralDirectory['raw']['local_header_offset']  = getid3_lib::LittleEndian2Int(substr($ZIPcentralDirectory, 42, 4));
+
+		$CentralDirectory['entry_offset']              = $CentralDirectory['raw']['local_header_offset'];
+		$CentralDirectory['create_version']            = sprintf('%1.1f', $CentralDirectory['raw']['create_version'] / 10);
+		$CentralDirectory['extract_version']           = sprintf('%1.1f', $CentralDirectory['raw']['extract_version'] / 10);
+		$CentralDirectory['host_os']                   = $this-&gt;ZIPversionOSLookup(($CentralDirectory['raw']['extract_version'] &amp; 0xFF00) &gt;&gt; 8);
+		$CentralDirectory['compression_method']        = $this-&gt;ZIPcompressionMethodLookup($CentralDirectory['raw']['compression_method']);
+		$CentralDirectory['compressed_size']           = $CentralDirectory['raw']['compressed_size'];
+		$CentralDirectory['uncompressed_size']         = $CentralDirectory['raw']['uncompressed_size'];
+		$CentralDirectory['flags']                     = $this-&gt;ZIPparseGeneralPurposeFlags($CentralDirectory['raw']['general_flags'], $CentralDirectory['raw']['compression_method']);
+		$CentralDirectory['last_modified_timestamp']   = $this-&gt;DOStime2UNIXtime($CentralDirectory['raw']['last_mod_file_date'], $CentralDirectory['raw']['last_mod_file_time']);
+
+		$FilenameExtrafieldCommentLength = $CentralDirectory['raw']['filename_length'] + $CentralDirectory['raw']['extra_field_length'] + $CentralDirectory['raw']['file_comment_length'];
+		if ($FilenameExtrafieldCommentLength &gt; 0) {
+			$FilenameExtrafieldComment = fread($fd, $FilenameExtrafieldCommentLength);
+
+			if ($CentralDirectory['raw']['filename_length'] &gt; 0) {
+				$CentralDirectory['filename']                  = substr($FilenameExtrafieldComment, 0, $CentralDirectory['raw']['filename_length']);
+			}
+			if ($CentralDirectory['raw']['extra_field_length'] &gt; 0) {
+				$CentralDirectory['raw']['extra_field_data']   = substr($FilenameExtrafieldComment, $CentralDirectory['raw']['filename_length'], $CentralDirectory['raw']['extra_field_length']);
+			}
+			if ($CentralDirectory['raw']['file_comment_length'] &gt; 0) {
+				$CentralDirectory['file_comment']              = substr($FilenameExtrafieldComment, $CentralDirectory['raw']['filename_length'] + $CentralDirectory['raw']['extra_field_length'], $CentralDirectory['raw']['file_comment_length']);
+			}
+		}
+
+		return $CentralDirectory;
+	}
+
+	function ZIPparseEndOfCentralDirectory(&amp;$fd) {
+		$EndOfCentralDirectory['offset'] = ftell($fd);
+
+		$ZIPendOfCentralDirectory = fread($fd, 22);
+
+		$EndOfCentralDirectory['signature']                   = getid3_lib::LittleEndian2Int(substr($ZIPendOfCentralDirectory,  0, 4));
+		if ($EndOfCentralDirectory['signature'] != 0x06054B50) {
+			// invalid End Of Central Directory Signature
+			fseek($fd, $EndOfCentralDirectory['offset'], SEEK_SET); // seek back to where filepointer originally was so it can be handled properly
+			return false;
+		}
+		$EndOfCentralDirectory['disk_number_current']         = getid3_lib::LittleEndian2Int(substr($ZIPendOfCentralDirectory,  4, 2));
+		$EndOfCentralDirectory['disk_number_start_directory'] = getid3_lib::LittleEndian2Int(substr($ZIPendOfCentralDirectory,  6, 2));
+		$EndOfCentralDirectory['directory_entries_this_disk'] = getid3_lib::LittleEndian2Int(substr($ZIPendOfCentralDirectory,  8, 2));
+		$EndOfCentralDirectory['directory_entries_total']     = getid3_lib::LittleEndian2Int(substr($ZIPendOfCentralDirectory, 10, 2));
+		$EndOfCentralDirectory['directory_size']              = getid3_lib::LittleEndian2Int(substr($ZIPendOfCentralDirectory, 12, 4));
+		$EndOfCentralDirectory['directory_offset']            = getid3_lib::LittleEndian2Int(substr($ZIPendOfCentralDirectory, 16, 4));
+		$EndOfCentralDirectory['comment_length']              = getid3_lib::LittleEndian2Int(substr($ZIPendOfCentralDirectory, 20, 2));
+
+		if ($EndOfCentralDirectory['comment_length'] &gt; 0) {
+			$EndOfCentralDirectory['comment']                 = fread($fd, $EndOfCentralDirectory['comment_length']);
+		}
+
+		return $EndOfCentralDirectory;
+	}
+
+
+	function ZIPparseGeneralPurposeFlags($flagbytes, $compressionmethod) {
+		$ParsedFlags['encrypted'] = (bool) ($flagbytes &amp; 0x0001);
+
+		switch ($compressionmethod) {
+			case 6:
+				$ParsedFlags['dictionary_size']    = (($flagbytes &amp; 0x0002) ? 8192 : 4096);
+				$ParsedFlags['shannon_fano_trees'] = (($flagbytes &amp; 0x0004) ? 3    : 2);
+				break;
+
+			case 8:
+			case 9:
+				switch (($flagbytes &amp; 0x0006) &gt;&gt; 1) {
+					case 0:
+						$ParsedFlags['compression_speed'] = 'normal';
+						break;
+					case 1:
+						$ParsedFlags['compression_speed'] = 'maximum';
+						break;
+					case 2:
+						$ParsedFlags['compression_speed'] = 'fast';
+						break;
+					case 3:
+						$ParsedFlags['compression_speed'] = 'superfast';
+						break;
+				}
+				break;
+		}
+		$ParsedFlags['data_descriptor_used']       = (bool) ($flagbytes &amp; 0x0008);
+
+		return $ParsedFlags;
+	}
+
+
+	function ZIPversionOSLookup($index) {
+		static $ZIPversionOSLookup = array(
+			0  =&gt; 'MS-DOS and OS/2 (FAT / VFAT / FAT32 file systems)',
+			1  =&gt; 'Amiga',
+			2  =&gt; 'OpenVMS',
+			3  =&gt; 'Unix',
+			4  =&gt; 'VM/CMS',
+			5  =&gt; 'Atari ST',
+			6  =&gt; 'OS/2 H.P.F.S.',
+			7  =&gt; 'Macintosh',
+			8  =&gt; 'Z-System',
+			9  =&gt; 'CP/M',
+			10 =&gt; 'Windows NTFS',
+			11 =&gt; 'MVS',
+			12 =&gt; 'VSE',
+			13 =&gt; 'Acorn Risc',
+			14 =&gt; 'VFAT',
+			15 =&gt; 'Alternate MVS',
+			16 =&gt; 'BeOS',
+			17 =&gt; 'Tandem'
+		);
+
+		return (isset($ZIPversionOSLookup[$index]) ? $ZIPversionOSLookup[$index] : '[unknown]');
+	}
+
+	function ZIPcompressionMethodLookup($index) {
+		static $ZIPcompressionMethodLookup = array(
+			0  =&gt; 'store',
+			1  =&gt; 'shrink',
+			2  =&gt; 'reduce-1',
+			3  =&gt; 'reduce-2',
+			4  =&gt; 'reduce-3',
+			5  =&gt; 'reduce-4',
+			6  =&gt; 'implode',
+			7  =&gt; 'tokenize',
+			8  =&gt; 'deflate',
+			9  =&gt; 'deflate64',
+			10 =&gt; 'PKWARE Date Compression Library Imploding'
+		);
+
+		return (isset($ZIPcompressionMethodLookup[$index]) ? $ZIPcompressionMethodLookup[$index] : '[unknown]');
+	}
+
+	function DOStime2UNIXtime($DOSdate, $DOStime) {
+		// wFatDate
+		// Specifies the MS-DOS date. The date is a packed 16-bit value with the following format:
+		// Bits      Contents
+		// 0-4    Day of the month (1-31)
+		// 5-8    Month (1 = January, 2 = February, and so on)
+		// 9-15   Year offset from 1980 (add 1980 to get actual year)
+
+		$UNIXday    =  ($DOSdate &amp; 0x001F);
+		$UNIXmonth  = (($DOSdate &amp; 0x01E0) &gt;&gt; 5);
+		$UNIXyear   = (($DOSdate &amp; 0xFE00) &gt;&gt; 9) + 1980;
+
+		// wFatTime
+		// Specifies the MS-DOS time. The time is a packed 16-bit value with the following format:
+		// Bits   Contents
+		// 0-4    Second divided by 2
+		// 5-10   Minute (0-59)
+		// 11-15  Hour (0-23 on a 24-hour clock)
+
+		$UNIXsecond =  ($DOStime &amp; 0x001F) * 2;
+		$UNIXminute = (($DOStime &amp; 0x07E0) &gt;&gt; 5);
+		$UNIXhour   = (($DOStime &amp; 0xF800) &gt;&gt; 11);
+
+		return mktime($UNIXhour, $UNIXminute, $UNIXsecond, $UNIXmonth, $UNIXday, $UNIXyear);
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.archive.zip.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio-video.asf.php
===================================================================
--- trunk/inc/external/getid3/module.audio-video.asf.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio-video.asf.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,1593 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio-video.asf.php                                  //
+// module for analyzing ASF, WMA and WMV files                 //
+// dependencies: module.audio-video.riff.php                   //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio-video.riff.php', __FILE__, true);
+
+$GUIDarray = getid3_asf::KnownGUIDs();
+foreach ($GUIDarray as $GUIDname =&gt; $hexstringvalue) {
+	// initialize all GUID constants
+	define($GUIDname, getid3_asf::GUIDtoBytestring($hexstringvalue));
+}
+
+
+
+class getid3_asf
+{
+
+	function getid3_asf(&amp;$fd, &amp;$ThisFileInfo) {
+
+		// Shortcuts
+		$thisfile_audio = &amp;$ThisFileInfo['audio'];
+		$thisfile_video = &amp;$ThisFileInfo['video'];
+		$ThisFileInfo['asf'] = array();
+		$thisfile_asf        = &amp;$ThisFileInfo['asf'];
+		$thisfile_asf['comments'] = array();
+		$thisfile_asf_comments    = &amp;$thisfile_asf['comments'];
+		$thisfile_asf['header_object'] = array();
+		$thisfile_asf_headerobject     = &amp;$thisfile_asf['header_object'];
+
+
+		// ASF structure:
+		// * Header Object [required]
+		//   * File Properties Object [required]   (global file attributes)
+		//   * Stream Properties Object [required] (defines media stream &amp; characteristics)
+		//   * Header Extension Object [required]  (additional functionality)
+		//   * Content Description Object          (bibliographic information)
+		//   * Script Command Object               (commands for during playback)
+		//   * Marker Object                       (named jumped points within the file)
+		// * Data Object [required]
+		//   * Data Packets
+		// * Index Object
+
+		// Header Object: (mandatory, one only)
+		// Field Name                   Field Type   Size (bits)
+		// Object ID                    GUID         128             // GUID for header object - GETID3_ASF_Header_Object
+		// Object Size                  QWORD        64              // size of header object, including 30 bytes of Header Object header
+		// Number of Header Objects     DWORD        32              // number of objects in header object
+		// Reserved1                    BYTE         8               // hardcoded: 0x01
+		// Reserved2                    BYTE         8               // hardcoded: 0x02
+
+		$ThisFileInfo['fileformat'] = 'asf';
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$HeaderObjectData = fread($fd, 30);
+
+		$thisfile_asf_headerobject['objectid']      = substr($HeaderObjectData, 0, 16);
+		$thisfile_asf_headerobject['objectid_guid'] = $this-&gt;BytestringToGUID($thisfile_asf_headerobject['objectid']);
+		if ($thisfile_asf_headerobject['objectid'] != GETID3_ASF_Header_Object) {
+			$ThisFileInfo['warning'][] = 'ASF header GUID {'.$this-&gt;BytestringToGUID($thisfile_asf_headerobject['objectid']).'} does not match expected &quot;GETID3_ASF_Header_Object&quot; GUID {'.$this-&gt;BytestringToGUID(GETID3_ASF_Header_Object).'}';
+			unset($ThisFileInfo['fileformat']);
+			unset($ThisFileInfo['asf']);
+			return false;
+			break;
+		}
+		$thisfile_asf_headerobject['objectsize']    = getid3_lib::LittleEndian2Int(substr($HeaderObjectData, 16, 8));
+		$thisfile_asf_headerobject['headerobjects'] = getid3_lib::LittleEndian2Int(substr($HeaderObjectData, 24, 4));
+		$thisfile_asf_headerobject['reserved1']     = getid3_lib::LittleEndian2Int(substr($HeaderObjectData, 28, 1));
+		$thisfile_asf_headerobject['reserved2']     = getid3_lib::LittleEndian2Int(substr($HeaderObjectData, 29, 1));
+
+		//$ASFHeaderData  = $HeaderObjectData;
+		$ASFHeaderData = fread($fd, $thisfile_asf_headerobject['objectsize'] - 30);
+		//$offset = 30;
+		$offset = 0;
+
+		for ($HeaderObjectsCounter = 0; $HeaderObjectsCounter &lt; $thisfile_asf_headerobject['headerobjects']; $HeaderObjectsCounter++) {
+			$NextObjectGUID     = substr($ASFHeaderData, $offset, 16);
+			$offset += 16;
+			$NextObjectGUIDtext = $this-&gt;BytestringToGUID($NextObjectGUID);
+			$NextObjectSize = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 8));
+			$offset += 8;
+			switch ($NextObjectGUID) {
+
+				case GETID3_ASF_File_Properties_Object:
+					// File Properties Object: (mandatory, one only)
+					// Field Name                   Field Type   Size (bits)
+					// Object ID                    GUID         128             // GUID for file properties object - GETID3_ASF_File_Properties_Object
+					// Object Size                  QWORD        64              // size of file properties object, including 104 bytes of File Properties Object header
+					// File ID                      GUID         128             // unique ID - identical to File ID in Data Object
+					// File Size                    QWORD        64              // entire file in bytes. Invalid if Broadcast Flag == 1
+					// Creation Date                QWORD        64              // date &amp; time of file creation. Maybe invalid if Broadcast Flag == 1
+					// Data Packets Count           QWORD        64              // number of data packets in Data Object. Invalid if Broadcast Flag == 1
+					// Play Duration                QWORD        64              // playtime, in 100-nanosecond units. Invalid if Broadcast Flag == 1
+					// Send Duration                QWORD        64              // time needed to send file, in 100-nanosecond units. Players can ignore this value. Invalid if Broadcast Flag == 1
+					// Preroll                      QWORD        64              // time to buffer data before starting to play file, in 1-millisecond units. If &lt;&gt; 0, PlayDuration and PresentationTime have been offset by this amount
+					// Flags                        DWORD        32              //
+					// * Broadcast Flag             bits         1  (0x01)       // file is currently being written, some header values are invalid
+					// * Seekable Flag              bits         1  (0x02)       // is file seekable
+					// * Reserved                   bits         30 (0xFFFFFFFC) // reserved - set to zero
+					// Minimum Data Packet Size     DWORD        32              // in bytes. should be same as Maximum Data Packet Size. Invalid if Broadcast Flag == 1
+					// Maximum Data Packet Size     DWORD        32              // in bytes. should be same as Minimum Data Packet Size. Invalid if Broadcast Flag == 1
+					// Maximum Bitrate              DWORD        32              // maximum instantaneous bitrate in bits per second for entire file, including all data streams and ASF overhead
+
+					// shortcut
+					$thisfile_asf['file_properties_object'] = array();
+					$thisfile_asf_filepropertiesobject      = &amp;$thisfile_asf['file_properties_object'];
+
+					$thisfile_asf_filepropertiesobject['objectid']           = $NextObjectGUID;
+					$thisfile_asf_filepropertiesobject['objectid_guid']      = $NextObjectGUIDtext;
+					$thisfile_asf_filepropertiesobject['objectsize']         = $NextObjectSize;
+					$thisfile_asf_filepropertiesobject['fileid']             = substr($ASFHeaderData, $offset, 16);
+					$offset += 16;
+					$thisfile_asf_filepropertiesobject['fileid_guid']        = $this-&gt;BytestringToGUID($thisfile_asf_filepropertiesobject['fileid']);
+					$thisfile_asf_filepropertiesobject['filesize']           = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 8));
+					$offset += 8;
+					$thisfile_asf_filepropertiesobject['creation_date']      = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 8));
+					$thisfile_asf_filepropertiesobject['creation_date_unix'] = $this-&gt;FILETIMEtoUNIXtime($thisfile_asf_filepropertiesobject['creation_date']);
+					$offset += 8;
+					$thisfile_asf_filepropertiesobject['data_packets']       = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 8));
+					$offset += 8;
+					$thisfile_asf_filepropertiesobject['play_duration']      = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 8));
+					$offset += 8;
+					$thisfile_asf_filepropertiesobject['send_duration']      = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 8));
+					$offset += 8;
+					$thisfile_asf_filepropertiesobject['preroll']            = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 8));
+					$offset += 8;
+					$ThisFileInfo['playtime_seconds'] = ($thisfile_asf_filepropertiesobject['play_duration'] / 10000000) - ($thisfile_asf_filepropertiesobject['preroll'] / 1000);
+					$thisfile_asf_filepropertiesobject['flags_raw']          = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+					$offset += 4;
+					$thisfile_asf_filepropertiesobject['flags']['broadcast'] = (bool) ($thisfile_asf_filepropertiesobject['flags_raw'] &amp; 0x0001);
+					$thisfile_asf_filepropertiesobject['flags']['seekable']  = (bool) ($thisfile_asf_filepropertiesobject['flags_raw'] &amp; 0x0002);
+
+					$thisfile_asf_filepropertiesobject['min_packet_size']    = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+					$offset += 4;
+					$thisfile_asf_filepropertiesobject['max_packet_size']    = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+					$offset += 4;
+					$thisfile_asf_filepropertiesobject['max_bitrate']        = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+					$offset += 4;
+					$ThisFileInfo['bitrate']                                 = $thisfile_asf_filepropertiesobject['max_bitrate'];
+					break;
+
+				case GETID3_ASF_Stream_Properties_Object:
+					// Stream Properties Object: (mandatory, one per media stream)
+					// Field Name                   Field Type   Size (bits)
+					// Object ID                    GUID         128             // GUID for stream properties object - GETID3_ASF_Stream_Properties_Object
+					// Object Size                  QWORD        64              // size of stream properties object, including 78 bytes of Stream Properties Object header
+					// Stream Type                  GUID         128             // GETID3_ASF_Audio_Media, GETID3_ASF_Video_Media or GETID3_ASF_Command_Media
+					// Error Correction Type        GUID         128             // GETID3_ASF_Audio_Spread for audio-only streams, GETID3_ASF_No_Error_Correction for other stream types
+					// Time Offset                  QWORD        64              // 100-nanosecond units. typically zero. added to all timestamps of samples in the stream
+					// Type-Specific Data Length    DWORD        32              // number of bytes for Type-Specific Data field
+					// Error Correction Data Length DWORD        32              // number of bytes for Error Correction Data field
+					// Flags                        WORD         16              //
+					// * Stream Number              bits         7 (0x007F)      // number of this stream.  1 &lt;= valid &lt;= 127
+					// * Reserved                   bits         8 (0x7F80)      // reserved - set to zero
+					// * Encrypted Content Flag     bits         1 (0x8000)      // stream contents encrypted if set
+					// Reserved                     DWORD        32              // reserved - set to zero
+					// Type-Specific Data           BYTESTREAM   variable        // type-specific format data, depending on value of Stream Type
+					// Error Correction Data        BYTESTREAM   variable        // error-correction-specific format data, depending on value of Error Correct Type
+
+					// There is one GETID3_ASF_Stream_Properties_Object for each stream (audio, video) but the
+					// stream number isn't known until halfway through decoding the structure, hence it
+					// it is decoded to a temporary variable and then stuck in the appropriate index later
+
+					$StreamPropertiesObjectData['objectid']           = $NextObjectGUID;
+					$StreamPropertiesObjectData['objectid_guid']      = $NextObjectGUIDtext;
+					$StreamPropertiesObjectData['objectsize']         = $NextObjectSize;
+					$StreamPropertiesObjectData['stream_type']        = substr($ASFHeaderData, $offset, 16);
+					$offset += 16;
+					$StreamPropertiesObjectData['stream_type_guid']   = $this-&gt;BytestringToGUID($StreamPropertiesObjectData['stream_type']);
+					$StreamPropertiesObjectData['error_correct_type'] = substr($ASFHeaderData, $offset, 16);
+					$offset += 16;
+					$StreamPropertiesObjectData['error_correct_guid'] = $this-&gt;BytestringToGUID($StreamPropertiesObjectData['error_correct_type']);
+					$StreamPropertiesObjectData['time_offset']        = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 8));
+					$offset += 8;
+					$StreamPropertiesObjectData['type_data_length']   = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+					$offset += 4;
+					$StreamPropertiesObjectData['error_data_length']  = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+					$offset += 4;
+					$StreamPropertiesObjectData['flags_raw']          = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					$StreamPropertiesObjectStreamNumber               = $StreamPropertiesObjectData['flags_raw'] &amp; 0x007F;
+					$StreamPropertiesObjectData['flags']['encrypted'] = (bool) ($StreamPropertiesObjectData['flags_raw'] &amp; 0x8000);
+
+					$offset += 4; // reserved - DWORD
+					$StreamPropertiesObjectData['type_specific_data'] = substr($ASFHeaderData, $offset, $StreamPropertiesObjectData['type_data_length']);
+					$offset += $StreamPropertiesObjectData['type_data_length'];
+					$StreamPropertiesObjectData['error_correct_data'] = substr($ASFHeaderData, $offset, $StreamPropertiesObjectData['error_data_length']);
+					$offset += $StreamPropertiesObjectData['error_data_length'];
+
+					switch ($StreamPropertiesObjectData['stream_type']) {
+
+						case GETID3_ASF_Audio_Media:
+							$thisfile_audio['dataformat']   = (!empty($thisfile_audio['dataformat'])   ? $thisfile_audio['dataformat']   : 'asf');
+							$thisfile_audio['bitrate_mode'] = (!empty($thisfile_audio['bitrate_mode']) ? $thisfile_audio['bitrate_mode'] : 'cbr');
+
+							$audiodata = getid3_riff::RIFFparseWAVEFORMATex(substr($StreamPropertiesObjectData['type_specific_data'], 0, 16));
+							unset($audiodata['raw']);
+							$thisfile_audio = getid3_lib::array_merge_noclobber($audiodata, $thisfile_audio);
+							break;
+
+						case GETID3_ASF_Video_Media:
+							$thisfile_video['dataformat']   = (!empty($thisfile_video['dataformat'])   ? $thisfile_video['dataformat']   : 'asf');
+							$thisfile_video['bitrate_mode'] = (!empty($thisfile_video['bitrate_mode']) ? $thisfile_video['bitrate_mode'] : 'cbr');
+							break;
+
+						case GETID3_ASF_Command_Media:
+						default:
+							// do nothing
+							break;
+
+					}
+
+					$thisfile_asf['stream_properties_object'][$StreamPropertiesObjectStreamNumber] = $StreamPropertiesObjectData;
+					unset($StreamPropertiesObjectData); // clear for next stream, if any
+					break;
+
+				case GETID3_ASF_Header_Extension_Object:
+					// Header Extension Object: (mandatory, one only)
+					// Field Name                   Field Type   Size (bits)
+					// Object ID                    GUID         128             // GUID for Header Extension object - GETID3_ASF_Header_Extension_Object
+					// Object Size                  QWORD        64              // size of Header Extension object, including 46 bytes of Header Extension Object header
+					// Reserved Field 1             GUID         128             // hardcoded: GETID3_ASF_Reserved_1
+					// Reserved Field 2             WORD         16              // hardcoded: 0x00000006
+					// Header Extension Data Size   DWORD        32              // in bytes. valid: 0, or &gt; 24. equals object size minus 46
+					// Header Extension Data        BYTESTREAM   variable        // array of zero or more extended header objects
+
+					// shortcut
+					$thisfile_asf['header_extension_object'] = array();
+					$thisfile_asf_headerextensionobject      = &amp;$thisfile_asf['header_extension_object'];
+
+					$thisfile_asf_headerextensionobject['objectid']            = $NextObjectGUID;
+					$thisfile_asf_headerextensionobject['objectid_guid']       = $NextObjectGUIDtext;
+					$thisfile_asf_headerextensionobject['objectsize']          = $NextObjectSize;
+					$thisfile_asf_headerextensionobject['reserved_1']          = substr($ASFHeaderData, $offset, 16);
+					$offset += 16;
+					$thisfile_asf_headerextensionobject['reserved_1_guid']     = $this-&gt;BytestringToGUID($thisfile_asf_headerextensionobject['reserved_1']);
+					if ($thisfile_asf_headerextensionobject['reserved_1'] != GETID3_ASF_Reserved_1) {
+						$ThisFileInfo['warning'][] = 'header_extension_object.reserved_1 GUID ('.$this-&gt;BytestringToGUID($thisfile_asf_headerextensionobject['reserved_1']).') does not match expected &quot;GETID3_ASF_Reserved_1&quot; GUID ('.$this-&gt;BytestringToGUID(GETID3_ASF_Reserved_1).')';
+						//return false;
+						break;
+					}
+					$thisfile_asf_headerextensionobject['reserved_2']          = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					if ($thisfile_asf_headerextensionobject['reserved_2'] != 6) {
+						$ThisFileInfo['warning'][] = 'header_extension_object.reserved_2 ('.getid3_lib::PrintHexBytes($thisfile_asf_headerextensionobject['reserved_2']).') does not match expected value of &quot;6&quot;';
+						//return false;
+						break;
+					}
+					$thisfile_asf_headerextensionobject['extension_data_size'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+					$offset += 4;
+					$thisfile_asf_headerextensionobject['extension_data']      =                              substr($ASFHeaderData, $offset, $thisfile_asf_headerextensionobject['extension_data_size']);
+					$offset += $thisfile_asf_headerextensionobject['extension_data_size'];
+					break;
+
+				case GETID3_ASF_Codec_List_Object:
+					// Codec List Object: (optional, one only)
+					// Field Name                   Field Type   Size (bits)
+					// Object ID                    GUID         128             // GUID for Codec List object - GETID3_ASF_Codec_List_Object
+					// Object Size                  QWORD        64              // size of Codec List object, including 44 bytes of Codec List Object header
+					// Reserved                     GUID         128             // hardcoded: 86D15241-311D-11D0-A3A4-00A0C90348F6
+					// Codec Entries Count          DWORD        32              // number of entries in Codec Entries array
+					// Codec Entries                array of:    variable        //
+					// * Type                       WORD         16              // 0x0001 = Video Codec, 0x0002 = Audio Codec, 0xFFFF = Unknown Codec
+					// * Codec Name Length          WORD         16              // number of Unicode characters stored in the Codec Name field
+					// * Codec Name                 WCHAR        variable        // array of Unicode characters - name of codec used to create the content
+					// * Codec Description Length   WORD         16              // number of Unicode characters stored in the Codec Description field
+					// * Codec Description          WCHAR        variable        // array of Unicode characters - description of format used to create the content
+					// * Codec Information Length   WORD         16              // number of Unicode characters stored in the Codec Information field
+					// * Codec Information          BYTESTREAM   variable        // opaque array of information bytes about the codec used to create the content
+
+					// shortcut
+					$thisfile_asf['codec_list_object'] = array();
+					$thisfile_asf_codeclistobject      = &amp;$thisfile_asf['codec_list_object'];
+
+					$thisfile_asf_codeclistobject['objectid']                  = $NextObjectGUID;
+					$thisfile_asf_codeclistobject['objectid_guid']             = $NextObjectGUIDtext;
+					$thisfile_asf_codeclistobject['objectsize']                = $NextObjectSize;
+					$thisfile_asf_codeclistobject['reserved']                  = substr($ASFHeaderData, $offset, 16);
+					$offset += 16;
+					$thisfile_asf_codeclistobject['reserved_guid']             = $this-&gt;BytestringToGUID($thisfile_asf_codeclistobject['reserved']);
+					if ($thisfile_asf_codeclistobject['reserved'] != $this-&gt;GUIDtoBytestring('86D15241-311D-11D0-A3A4-00A0C90348F6')) {
+						$ThisFileInfo['warning'][] = 'codec_list_object.reserved GUID {'.$this-&gt;BytestringToGUID($thisfile_asf_codeclistobject['reserved']).'} does not match expected &quot;GETID3_ASF_Reserved_1&quot; GUID {86D15241-311D-11D0-A3A4-00A0C90348F6}';
+						//return false;
+						break;
+					}
+					$thisfile_asf_codeclistobject['codec_entries_count'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+					$offset += 4;
+					for ($CodecEntryCounter = 0; $CodecEntryCounter &lt; $thisfile_asf_codeclistobject['codec_entries_count']; $CodecEntryCounter++) {
+						// shortcut
+						$thisfile_asf_codeclistobject['codec_entries'][$CodecEntryCounter] = array();
+						$thisfile_asf_codeclistobject_codecentries_current = &amp;$thisfile_asf_codeclistobject['codec_entries'][$CodecEntryCounter];
+
+						$thisfile_asf_codeclistobject_codecentries_current['type_raw'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+						$offset += 2;
+						$thisfile_asf_codeclistobject_codecentries_current['type'] = $this-&gt;ASFCodecListObjectTypeLookup($thisfile_asf_codeclistobject_codecentries_current['type_raw']);
+
+						$CodecNameLength = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2)) * 2; // 2 bytes per character
+						$offset += 2;
+						$thisfile_asf_codeclistobject_codecentries_current['name'] = substr($ASFHeaderData, $offset, $CodecNameLength);
+						$offset += $CodecNameLength;
+
+						$CodecDescriptionLength = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2)) * 2; // 2 bytes per character
+						$offset += 2;
+						$thisfile_asf_codeclistobject_codecentries_current['description'] = substr($ASFHeaderData, $offset, $CodecDescriptionLength);
+						$offset += $CodecDescriptionLength;
+
+						$CodecInformationLength = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+						$offset += 2;
+						$thisfile_asf_codeclistobject_codecentries_current['information'] = substr($ASFHeaderData, $offset, $CodecInformationLength);
+						$offset += $CodecInformationLength;
+
+						if ($thisfile_asf_codeclistobject_codecentries_current['type_raw'] == 2) {
+							// audio codec
+							if (strpos($thisfile_asf_codeclistobject_codecentries_current['description'], ',') === false) {
+								$ThisFileInfo['error'][] = '[asf][codec_list_object][codec_entries]['.$CodecEntryCounter.'][description] expected to contain comma-seperated list of parameters: &quot;'.$thisfile_asf_codeclistobject_codecentries_current['description'].'&quot;';
+								return false;
+							}
+							list($AudioCodecBitrate, $AudioCodecFrequency, $AudioCodecChannels) = explode(',', $this-&gt;TrimConvert($thisfile_asf_codeclistobject_codecentries_current['description']));
+							$thisfile_audio['codec'] = $this-&gt;TrimConvert($thisfile_asf_codeclistobject_codecentries_current['name']);
+
+							if (!isset($thisfile_audio['bitrate']) &amp;&amp; strstr($AudioCodecBitrate, 'kbps')) {
+								$thisfile_audio['bitrate'] = (int) (trim(str_replace('kbps', '', $AudioCodecBitrate)) * 1000);
+							}
+							if (!isset($thisfile_video['bitrate']) &amp;&amp; isset($thisfile_audio['bitrate']) &amp;&amp; isset($thisfile_asf['file_properties_object']['max_bitrate']) &amp;&amp; ($thisfile_asf_codeclistobject['codec_entries_count'] &gt; 1)) {
+								$thisfile_video['bitrate'] = $thisfile_asf['file_properties_object']['max_bitrate'] - $thisfile_audio['bitrate'];
+							}
+
+							$AudioCodecFrequency = (int) trim(str_replace('kHz', '', $AudioCodecFrequency));
+							switch ($AudioCodecFrequency) {
+								case 8:
+									$thisfile_audio['sample_rate'] = 8000;
+									break;
+
+								case 11:
+									$thisfile_audio['sample_rate'] = 11025;
+									break;
+
+								case 12:
+									$thisfile_audio['sample_rate'] = 12000;
+									break;
+
+								case 16:
+									$thisfile_audio['sample_rate'] = 16000;
+									break;
+
+								case 22:
+									$thisfile_audio['sample_rate'] = 22050;
+									break;
+
+								case 24:
+									$thisfile_audio['sample_rate'] = 24000;
+									break;
+
+								case 32:
+									$thisfile_audio['sample_rate'] = 32000;
+									break;
+
+								case 44:
+									$thisfile_audio['sample_rate'] = 44100;
+									break;
+
+								case 48:
+									$thisfile_audio['sample_rate'] = 48000;
+									break;
+
+								default:
+									$ThisFileInfo['warning'][] = 'unknown frequency: &quot;'.$AudioCodecFrequency.'&quot; ('.$this-&gt;TrimConvert($thisfile_asf_codeclistobject_codecentries_current['description']).')';
+	//                                return false;
+									break;
+							}
+
+							if (!isset($thisfile_audio['channels'])) {
+								if (strstr($AudioCodecChannels, 'stereo')) {
+									$thisfile_audio['channels'] = 2;
+								} elseif (strstr($AudioCodecChannels, 'mono')) {
+									$thisfile_audio['channels'] = 1;
+								}
+							}
+						}
+					}
+					break;
+
+				case GETID3_ASF_Script_Command_Object:
+					// Script Command Object: (optional, one only)
+					// Field Name                   Field Type   Size (bits)
+					// Object ID                    GUID         128             // GUID for Script Command object - GETID3_ASF_Script_Command_Object
+					// Object Size                  QWORD        64              // size of Script Command object, including 44 bytes of Script Command Object header
+					// Reserved                     GUID         128             // hardcoded: 4B1ACBE3-100B-11D0-A39B-00A0C90348F6
+					// Commands Count               WORD         16              // number of Commands structures in the Script Commands Objects
+					// Command Types Count          WORD         16              // number of Command Types structures in the Script Commands Objects
+					// Command Types                array of:    variable        //
+					// * Command Type Name Length   WORD         16              // number of Unicode characters for Command Type Name
+					// * Command Type Name          WCHAR        variable        // array of Unicode characters - name of a type of command
+					// Commands                     array of:    variable        //
+					// * Presentation Time          DWORD        32              // presentation time of that command, in milliseconds
+					// * Type Index                 WORD         16              // type of this command, as a zero-based index into the array of Command Types of this object
+					// * Command Name Length        WORD         16              // number of Unicode characters for Command Name
+					// * Command Name               WCHAR        variable        // array of Unicode characters - name of this command
+
+					// shortcut
+					$thisfile_asf['script_command_object'] = array();
+					$thisfile_asf_scriptcommandobject      = &amp;$thisfile_asf['script_command_object'];
+
+					$thisfile_asf_scriptcommandobject['objectid']             = $NextObjectGUID;
+					$thisfile_asf_scriptcommandobject['objectid_guid']        = $NextObjectGUIDtext;
+					$thisfile_asf_scriptcommandobject['objectsize']           = $NextObjectSize;
+					$thisfile_asf_scriptcommandobject['reserved']             = substr($ASFHeaderData, $offset, 16);
+					$offset += 16;
+					$thisfile_asf_scriptcommandobject['reserved_guid']        = $this-&gt;BytestringToGUID($thisfile_asf_scriptcommandobject['reserved']);
+					if ($thisfile_asf_scriptcommandobject['reserved'] != $this-&gt;GUIDtoBytestring('4B1ACBE3-100B-11D0-A39B-00A0C90348F6')) {
+						$ThisFileInfo['warning'][] = 'script_command_object.reserved GUID {'.$this-&gt;BytestringToGUID($thisfile_asf_scriptcommandobject['reserved']).'} does not match expected &quot;GETID3_ASF_Reserved_1&quot; GUID {4B1ACBE3-100B-11D0-A39B-00A0C90348F6}';
+						//return false;
+						break;
+					}
+					$thisfile_asf_scriptcommandobject['commands_count']       = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					$thisfile_asf_scriptcommandobject['command_types_count']  = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					for ($CommandTypesCounter = 0; $CommandTypesCounter &lt; $thisfile_asf_scriptcommandobject['command_types_count']; $CommandTypesCounter++) {
+						$CommandTypeNameLength = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2)) * 2; // 2 bytes per character
+						$offset += 2;
+						$thisfile_asf_scriptcommandobject['command_types'][$CommandTypesCounter]['name'] = substr($ASFHeaderData, $offset, $CommandTypeNameLength);
+						$offset += $CommandTypeNameLength;
+					}
+					for ($CommandsCounter = 0; $CommandsCounter &lt; $thisfile_asf_scriptcommandobject['commands_count']; $CommandsCounter++) {
+						$thisfile_asf_scriptcommandobject['commands'][$CommandsCounter]['presentation_time']  = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+						$offset += 4;
+						$thisfile_asf_scriptcommandobject['commands'][$CommandsCounter]['type_index']         = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+						$offset += 2;
+
+						$CommandTypeNameLength = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2)) * 2; // 2 bytes per character
+						$offset += 2;
+						$thisfile_asf_scriptcommandobject['commands'][$CommandsCounter]['name'] = substr($ASFHeaderData, $offset, $CommandTypeNameLength);
+						$offset += $CommandTypeNameLength;
+					}
+					break;
+
+				case GETID3_ASF_Marker_Object:
+					// Marker Object: (optional, one only)
+					// Field Name                   Field Type   Size (bits)
+					// Object ID                    GUID         128             // GUID for Marker object - GETID3_ASF_Marker_Object
+					// Object Size                  QWORD        64              // size of Marker object, including 48 bytes of Marker Object header
+					// Reserved                     GUID         128             // hardcoded: 4CFEDB20-75F6-11CF-9C0F-00A0C90349CB
+					// Markers Count                DWORD        32              // number of Marker structures in Marker Object
+					// Reserved                     WORD         16              // hardcoded: 0x0000
+					// Name Length                  WORD         16              // number of bytes in the Name field
+					// Name                         WCHAR        variable        // name of the Marker Object
+					// Markers                      array of:    variable        //
+					// * Offset                     QWORD        64              // byte offset into Data Object
+					// * Presentation Time          QWORD        64              // in 100-nanosecond units
+					// * Entry Length               WORD         16              // length in bytes of (Send Time + Flags + Marker Description Length + Marker Description + Padding)
+					// * Send Time                  DWORD        32              // in milliseconds
+					// * Flags                      DWORD        32              // hardcoded: 0x00000000
+					// * Marker Description Length  DWORD        32              // number of bytes in Marker Description field
+					// * Marker Description         WCHAR        variable        // array of Unicode characters - description of marker entry
+					// * Padding                    BYTESTREAM   variable        // optional padding bytes
+
+					// shortcut
+					$thisfile_asf['marker_object'] = array();
+					$thisfile_asf_markerobject     = &amp;$thisfile_asf['marker_object'];
+
+					$thisfile_asf_markerobject['objectid']             = $NextObjectGUID;
+					$thisfile_asf_markerobject['objectid_guid']        = $NextObjectGUIDtext;
+					$thisfile_asf_markerobject['objectsize']           = $NextObjectSize;
+					$thisfile_asf_markerobject['reserved']             = substr($ASFHeaderData, $offset, 16);
+					$offset += 16;
+					$thisfile_asf_markerobject['reserved_guid']        = $this-&gt;BytestringToGUID($thisfile_asf_markerobject['reserved']);
+					if ($thisfile_asf_markerobject['reserved'] != $this-&gt;GUIDtoBytestring('4CFEDB20-75F6-11CF-9C0F-00A0C90349CB')) {
+						$ThisFileInfo['warning'][] = 'marker_object.reserved GUID {'.$this-&gt;BytestringToGUID($thisfile_asf_markerobject['reserved_1']).'} does not match expected &quot;GETID3_ASF_Reserved_1&quot; GUID {4CFEDB20-75F6-11CF-9C0F-00A0C90349CB}';
+						break;
+					}
+					$thisfile_asf_markerobject['markers_count'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+					$offset += 4;
+					$thisfile_asf_markerobject['reserved_2'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					if ($thisfile_asf_markerobject['reserved_2'] != 0) {
+						$ThisFileInfo['warning'][] = 'marker_object.reserved_2 ('.getid3_lib::PrintHexBytes($thisfile_asf_markerobject['reserved_2']).') does not match expected value of &quot;0&quot;';
+						break;
+					}
+					$thisfile_asf_markerobject['name_length'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					$thisfile_asf_markerobject['name'] = substr($ASFHeaderData, $offset, $thisfile_asf_markerobject['name_length']);
+					$offset += $thisfile_asf_markerobject['name_length'];
+					for ($MarkersCounter = 0; $MarkersCounter &lt; $thisfile_asf_markerobject['markers_count']; $MarkersCounter++) {
+						$thisfile_asf_markerobject['markers'][$MarkersCounter]['offset']  = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 8));
+						$offset += 8;
+						$thisfile_asf_markerobject['markers'][$MarkersCounter]['presentation_time']         = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 8));
+						$offset += 8;
+						$thisfile_asf_markerobject['markers'][$MarkersCounter]['entry_length']              = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+						$offset += 2;
+						$thisfile_asf_markerobject['markers'][$MarkersCounter]['send_time']                 = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+						$offset += 4;
+						$thisfile_asf_markerobject['markers'][$MarkersCounter]['flags']                     = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+						$offset += 4;
+						$thisfile_asf_markerobject['markers'][$MarkersCounter]['marker_description_length'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+						$offset += 4;
+						$thisfile_asf_markerobject['markers'][$MarkersCounter]['marker_description']        = substr($ASFHeaderData, $offset, $thisfile_asf_markerobject['markers'][$MarkersCounter]['marker_description_length']);
+						$offset += $thisfile_asf_markerobject['markers'][$MarkersCounter]['marker_description_length'];
+						$PaddingLength = $thisfile_asf_markerobject['markers'][$MarkersCounter]['entry_length'] - 4 -  4 - 4 - $thisfile_asf_markerobject['markers'][$MarkersCounter]['marker_description_length'];
+						if ($PaddingLength &gt; 0) {
+							$thisfile_asf_markerobject['markers'][$MarkersCounter]['padding']               = substr($ASFHeaderData, $offset, $PaddingLength);
+							$offset += $PaddingLength;
+						}
+					}
+					break;
+
+				case GETID3_ASF_Bitrate_Mutual_Exclusion_Object:
+					// Bitrate Mutual Exclusion Object: (optional)
+					// Field Name                   Field Type   Size (bits)
+					// Object ID                    GUID         128             // GUID for Bitrate Mutual Exclusion object - GETID3_ASF_Bitrate_Mutual_Exclusion_Object
+					// Object Size                  QWORD        64              // size of Bitrate Mutual Exclusion object, including 42 bytes of Bitrate Mutual Exclusion Object header
+					// Exlusion Type                GUID         128             // nature of mutual exclusion relationship. one of: (GETID3_ASF_Mutex_Bitrate, GETID3_ASF_Mutex_Unknown)
+					// Stream Numbers Count         WORD         16              // number of video streams
+					// Stream Numbers               WORD         variable        // array of mutually exclusive video stream numbers. 1 &lt;= valid &lt;= 127
+
+					// shortcut
+					$thisfile_asf['bitrate_mutual_exclusion_object'] = array();
+					$thisfile_asf_bitratemutualexclusionobject       = &amp;$thisfile_asf['bitrate_mutual_exclusion_object'];
+
+					$thisfile_asf_bitratemutualexclusionobject['objectid']             = $NextObjectGUID;
+					$thisfile_asf_bitratemutualexclusionobject['objectid_guid']        = $NextObjectGUIDtext;
+					$thisfile_asf_bitratemutualexclusionobject['objectsize']           = $NextObjectSize;
+					$thisfile_asf_bitratemutualexclusionobject['reserved']             = substr($ASFHeaderData, $offset, 16);
+					$thisfile_asf_bitratemutualexclusionobject['reserved_guid']        = $this-&gt;BytestringToGUID($thisfile_asf_bitratemutualexclusionobject['reserved']);
+					$offset += 16;
+					if (($thisfile_asf_bitratemutualexclusionobject['reserved'] != GETID3_ASF_Mutex_Bitrate) &amp;&amp; ($thisfile_asf_bitratemutualexclusionobject['reserved'] != GETID3_ASF_Mutex_Unknown)) {
+						$ThisFileInfo['warning'][] = 'bitrate_mutual_exclusion_object.reserved GUID {'.$this-&gt;BytestringToGUID($thisfile_asf_bitratemutualexclusionobject['reserved']).'} does not match expected &quot;GETID3_ASF_Mutex_Bitrate&quot; GUID {'.$this-&gt;BytestringToGUID(GETID3_ASF_Mutex_Bitrate).'} or  &quot;GETID3_ASF_Mutex_Unknown&quot; GUID {'.$this-&gt;BytestringToGUID(GETID3_ASF_Mutex_Unknown).'}';
+						//return false;
+						break;
+					}
+					$thisfile_asf_bitratemutualexclusionobject['stream_numbers_count'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					for ($StreamNumberCounter = 0; $StreamNumberCounter &lt; $thisfile_asf_bitratemutualexclusionobject['stream_numbers_count']; $StreamNumberCounter++) {
+						$thisfile_asf_bitratemutualexclusionobject['stream_numbers'][$StreamNumberCounter] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+						$offset += 2;
+					}
+					break;
+
+				case GETID3_ASF_Error_Correction_Object:
+					// Error Correction Object: (optional, one only)
+					// Field Name                   Field Type   Size (bits)
+					// Object ID                    GUID         128             // GUID for Error Correction object - GETID3_ASF_Error_Correction_Object
+					// Object Size                  QWORD        64              // size of Error Correction object, including 44 bytes of Error Correction Object header
+					// Error Correction Type        GUID         128             // type of error correction. one of: (GETID3_ASF_No_Error_Correction, GETID3_ASF_Audio_Spread)
+					// Error Correction Data Length DWORD        32              // number of bytes in Error Correction Data field
+					// Error Correction Data        BYTESTREAM   variable        // structure depends on value of Error Correction Type field
+
+					// shortcut
+					$thisfile_asf['error_correction_object'] = array();
+					$thisfile_asf_errorcorrectionobject      = &amp;$thisfile_asf['error_correction_object'];
+
+					$thisfile_asf_errorcorrectionobject['objectid']              = $NextObjectGUID;
+					$thisfile_asf_errorcorrectionobject['objectid_guid']         = $NextObjectGUIDtext;
+					$thisfile_asf_errorcorrectionobject['objectsize']            = $NextObjectSize;
+					$thisfile_asf_errorcorrectionobject['error_correction_type'] = substr($ASFHeaderData, $offset, 16);
+					$offset += 16;
+					$thisfile_asf_errorcorrectionobject['error_correction_guid'] = $this-&gt;BytestringToGUID($thisfile_asf_errorcorrectionobject['error_correction_type']);
+					$thisfile_asf_errorcorrectionobject['error_correction_data_length'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+					$offset += 4;
+					switch ($thisfile_asf_errorcorrectionobject['error_correction_type']) {
+						case GETID3_ASF_No_Error_Correction:
+							// should be no data, but just in case there is, skip to the end of the field
+							$offset += $thisfile_asf_errorcorrectionobject['error_correction_data_length'];
+							break;
+
+						case GETID3_ASF_Audio_Spread:
+							// Field Name                   Field Type   Size (bits)
+							// Span                         BYTE         8               // number of packets over which audio will be spread.
+							// Virtual Packet Length        WORD         16              // size of largest audio payload found in audio stream
+							// Virtual Chunk Length         WORD         16              // size of largest audio payload found in audio stream
+							// Silence Data Length          WORD         16              // number of bytes in Silence Data field
+							// Silence Data                 BYTESTREAM   variable        // hardcoded: 0x00 * (Silence Data Length) bytes
+
+							$thisfile_asf_errorcorrectionobject['span']                  = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 1));
+							$offset += 1;
+							$thisfile_asf_errorcorrectionobject['virtual_packet_length'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+							$offset += 2;
+							$thisfile_asf_errorcorrectionobject['virtual_chunk_length']  = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+							$offset += 2;
+							$thisfile_asf_errorcorrectionobject['silence_data_length']   = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+							$offset += 2;
+							$thisfile_asf_errorcorrectionobject['silence_data']          = substr($ASFHeaderData, $offset, $thisfile_asf_errorcorrectionobject['silence_data_length']);
+							$offset += $thisfile_asf_errorcorrectionobject['silence_data_length'];
+							break;
+
+						default:
+							$ThisFileInfo['warning'][] = 'error_correction_object.error_correction_type GUID {'.$this-&gt;BytestringToGUID($thisfile_asf_errorcorrectionobject['reserved']).'} does not match expected &quot;GETID3_ASF_No_Error_Correction&quot; GUID {'.$this-&gt;BytestringToGUID(GETID3_ASF_No_Error_Correction).'} or  &quot;GETID3_ASF_Audio_Spread&quot; GUID {'.$this-&gt;BytestringToGUID(GETID3_ASF_Audio_Spread).'}';
+							//return false;
+							break;
+					}
+
+					break;
+
+				case GETID3_ASF_Content_Description_Object:
+					// Content Description Object: (optional, one only)
+					// Field Name                   Field Type   Size (bits)
+					// Object ID                    GUID         128             // GUID for Content Description object - GETID3_ASF_Content_Description_Object
+					// Object Size                  QWORD        64              // size of Content Description object, including 34 bytes of Content Description Object header
+					// Title Length                 WORD         16              // number of bytes in Title field
+					// Author Length                WORD         16              // number of bytes in Author field
+					// Copyright Length             WORD         16              // number of bytes in Copyright field
+					// Description Length           WORD         16              // number of bytes in Description field
+					// Rating Length                WORD         16              // number of bytes in Rating field
+					// Title                        WCHAR        16              // array of Unicode characters - Title
+					// Author                       WCHAR        16              // array of Unicode characters - Author
+					// Copyright                    WCHAR        16              // array of Unicode characters - Copyright
+					// Description                  WCHAR        16              // array of Unicode characters - Description
+					// Rating                       WCHAR        16              // array of Unicode characters - Rating
+
+					// shortcut
+					$thisfile_asf['content_description_object'] = array();
+					$thisfile_asf_contentdescriptionobject      = &amp;$thisfile_asf['content_description_object'];
+
+					$thisfile_asf_contentdescriptionobject['objectid']              = $NextObjectGUID;
+					$thisfile_asf_contentdescriptionobject['objectid_guid']         = $NextObjectGUIDtext;
+					$thisfile_asf_contentdescriptionobject['objectsize']            = $NextObjectSize;
+					$thisfile_asf_contentdescriptionobject['title_length']          = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					$thisfile_asf_contentdescriptionobject['author_length']         = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					$thisfile_asf_contentdescriptionobject['copyright_length']      = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					$thisfile_asf_contentdescriptionobject['description_length']    = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					$thisfile_asf_contentdescriptionobject['rating_length']         = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					$thisfile_asf_contentdescriptionobject['title']                 = substr($ASFHeaderData, $offset, $thisfile_asf_contentdescriptionobject['title_length']);
+					$offset += $thisfile_asf_contentdescriptionobject['title_length'];
+					$thisfile_asf_contentdescriptionobject['author']                = substr($ASFHeaderData, $offset, $thisfile_asf_contentdescriptionobject['author_length']);
+					$offset += $thisfile_asf_contentdescriptionobject['author_length'];
+					$thisfile_asf_contentdescriptionobject['copyright']             = substr($ASFHeaderData, $offset, $thisfile_asf_contentdescriptionobject['copyright_length']);
+					$offset += $thisfile_asf_contentdescriptionobject['copyright_length'];
+					$thisfile_asf_contentdescriptionobject['description']           = substr($ASFHeaderData, $offset, $thisfile_asf_contentdescriptionobject['description_length']);
+					$offset += $thisfile_asf_contentdescriptionobject['description_length'];
+					$thisfile_asf_contentdescriptionobject['rating']                = substr($ASFHeaderData, $offset, $thisfile_asf_contentdescriptionobject['rating_length']);
+					$offset += $thisfile_asf_contentdescriptionobject['rating_length'];
+
+					$ASFcommentKeysToCopy = array('title'=&gt;'title', 'author'=&gt;'artist', 'copyright'=&gt;'copyright', 'description'=&gt;'comment', 'rating'=&gt;'rating');
+					foreach ($ASFcommentKeysToCopy as $keytocopyfrom =&gt; $keytocopyto) {
+						if (!empty($thisfile_asf_contentdescriptionobject[$keytocopyfrom])) {
+							$thisfile_asf_comments[$keytocopyto][] = $this-&gt;TrimTerm($thisfile_asf_contentdescriptionobject[$keytocopyfrom]);
+						}
+					}
+					break;
+
+				case GETID3_ASF_Extended_Content_Description_Object:
+					// Extended Content Description Object: (optional, one only)
+					// Field Name                   Field Type   Size (bits)
+					// Object ID                    GUID         128             // GUID for Extended Content Description object - GETID3_ASF_Extended_Content_Description_Object
+					// Object Size                  QWORD        64              // size of ExtendedContent Description object, including 26 bytes of Extended Content Description Object header
+					// Content Descriptors Count    WORD         16              // number of entries in Content Descriptors list
+					// Content Descriptors          array of:    variable        //
+					// * Descriptor Name Length     WORD         16              // size in bytes of Descriptor Name field
+					// * Descriptor Name            WCHAR        variable        // array of Unicode characters - Descriptor Name
+					// * Descriptor Value Data Type WORD         16              // Lookup array:
+																					// 0x0000 = Unicode String (variable length)
+																					// 0x0001 = BYTE array     (variable length)
+																					// 0x0002 = BOOL           (DWORD, 32 bits)
+																					// 0x0003 = DWORD          (DWORD, 32 bits)
+																					// 0x0004 = QWORD          (QWORD, 64 bits)
+																					// 0x0005 = WORD           (WORD,  16 bits)
+					// * Descriptor Value Length    WORD         16              // number of bytes stored in Descriptor Value field
+					// * Descriptor Value           variable     variable        // value for Content Descriptor
+
+					// shortcut
+					$thisfile_asf['extended_content_description_object'] = array();
+					$thisfile_asf_extendedcontentdescriptionobject       = &amp;$thisfile_asf['extended_content_description_object'];
+
+					$thisfile_asf_extendedcontentdescriptionobject['objectid']                  = $NextObjectGUID;
+					$thisfile_asf_extendedcontentdescriptionobject['objectid_guid']             = $NextObjectGUIDtext;
+					$thisfile_asf_extendedcontentdescriptionobject['objectsize']                = $NextObjectSize;
+					$thisfile_asf_extendedcontentdescriptionobject['content_descriptors_count'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					for ($ExtendedContentDescriptorsCounter = 0; $ExtendedContentDescriptorsCounter &lt; $thisfile_asf_extendedcontentdescriptionobject['content_descriptors_count']; $ExtendedContentDescriptorsCounter++) {
+						// shortcut
+						$thisfile_asf_extendedcontentdescriptionobject['content_descriptors'][$ExtendedContentDescriptorsCounter] = array();
+						$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current                                  = &amp;$thisfile_asf_extendedcontentdescriptionobject['content_descriptors'][$ExtendedContentDescriptorsCounter];
+
+						$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['base_offset']  = $offset + 30;
+						$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['name_length']  = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+						$offset += 2;
+						$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['name']         = substr($ASFHeaderData, $offset, $thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['name_length']);
+						$offset += $thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['name_length'];
+						$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value_type']   = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+						$offset += 2;
+						$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value_length'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+						$offset += 2;
+						$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value']        = substr($ASFHeaderData, $offset, $thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value_length']);
+						$offset += $thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value_length'];
+						switch ($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value_type']) {
+							case 0x0000: // Unicode string
+								break;
+
+							case 0x0001: // BYTE array
+								// do nothing
+								break;
+
+							case 0x0002: // BOOL
+								$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value'] = (bool) getid3_lib::LittleEndian2Int($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value']);
+								break;
+
+							case 0x0003: // DWORD
+							case 0x0004: // QWORD
+							case 0x0005: // WORD
+								$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value'] = getid3_lib::LittleEndian2Int($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value']);
+								break;
+
+							default:
+								$ThisFileInfo['warning'][] = 'extended_content_description.content_descriptors.'.$ExtendedContentDescriptorsCounter.'.value_type is invalid ('.$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value_type'].')';
+								//return false;
+								break;
+						}
+						switch ($this-&gt;TrimConvert(strtolower($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['name']))) {
+
+							case 'wm/albumartist':
+							case 'artist':
+								$thisfile_asf_comments['artist'] = array($this-&gt;TrimTerm($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value']));
+								break;
+
+							case 'wm/albumtitle':
+							case 'album':
+								$thisfile_asf_comments['album']  = array($this-&gt;TrimTerm($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value']));
+								break;
+
+							case 'wm/genre':
+							case 'genre':
+								$thisfile_asf_comments['genre'] = array($this-&gt;TrimTerm($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value']));
+								break;
+
+							case 'wm/tracknumber':
+							case 'tracknumber':
+								$thisfile_asf_comments['track'] = array(intval($this-&gt;TrimTerm($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value'])));
+								break;
+
+							case 'wm/track':
+								if (empty($thisfile_asf_comments['track'])) {
+									$thisfile_asf_comments['track'] = array(1 + $this-&gt;TrimConvert($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value']));
+								}
+								break;
+
+							case 'wm/year':
+							case 'year':
+							case 'date':
+								$thisfile_asf_comments['year'] = array( $this-&gt;TrimTerm($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value']));
+								break;
+
+							case 'isvbr':
+								if ($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value']) {
+									$thisfile_audio['bitrate_mode'] = 'vbr';
+									$thisfile_video['bitrate_mode'] = 'vbr';
+								}
+								break;
+
+							case 'id3':
+								// id3v2 module might not be loaded
+								if (class_exists('getid3_id3v2')) {
+								    $tempfile         = tempnam('*', 'getID3');
+								    $tempfilehandle   = fopen($tempfile, &quot;wb&quot;);
+									$tempThisfileInfo = array('encoding'=&gt;$ThisFileInfo['encoding']);
+									fwrite($tempfilehandle, $thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value']);
+									fclose($tempfilehandle);
+									
+									$tempfilehandle = fopen($tempfile, &quot;rb&quot;);
+									$id3 = new getid3_id3v2($tempfilehandle, $tempThisfileInfo);
+									fclose($tempfilehandle);
+									unlink($tempfile);
+									
+									$ThisFileInfo['id3v2'] = $tempThisfileInfo['id3v2'];
+								}
+								break;
+
+							case 'wm/encodingtime':
+								$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['encoding_time_unix'] = $this-&gt;FILETIMEtoUNIXtime($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value']);
+								$thisfile_asf_comments['encoding_time_unix'] = array($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['encoding_time_unix']);
+								break;
+
+							case 'wm/picture':
+								//typedef struct _WMPicture{
+								//  LPWSTR  pwszMIMEType;
+								//  BYTE  bPictureType;
+								//  LPWSTR  pwszDescription;
+								//  DWORD  dwDataLen;
+								//  BYTE*  pbData;
+								//} WM_PICTURE;
+
+								$wm_picture_offset = 0;
+								$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['image_type_id'] = getid3_lib::LittleEndian2Int(substr($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value'], $wm_picture_offset, 1));
+								$wm_picture_offset += 1;
+								$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['image_type']    = $this-&gt;WMpictureTypeLookup($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['image_type_id']);
+								$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['image_size']    = getid3_lib::LittleEndian2Int(substr($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value'], $wm_picture_offset, 4));
+								$wm_picture_offset += 4;
+
+								$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['image_mime'] = '';
+								do {
+									$next_byte_pair = substr($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value'], $wm_picture_offset, 2);
+									$wm_picture_offset += 2;
+									$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['image_mime'] .= $next_byte_pair;
+								} while ($next_byte_pair !== &quot;\x00\x00&quot;);
+
+								$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['image_description'] = '';
+								do {
+									$next_byte_pair = substr($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value'], $wm_picture_offset, 2);
+									$wm_picture_offset += 2;
+									$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['image_description'] .= $next_byte_pair;
+								} while ($next_byte_pair !== &quot;\x00\x00&quot;);
+
+								$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['dataoffset'] = $wm_picture_offset;
+								$thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['data'] = substr($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value'], $wm_picture_offset);
+								unset($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value']);
+
+								break;
+
+							default:
+								switch ($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value_type']) {
+									case 0: // Unicode string
+										if (substr($this-&gt;TrimConvert($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['name']), 0, 3) == 'WM/') {
+											$thisfile_asf_comments[str_replace('wm/', '', strtolower($this-&gt;TrimConvert($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['name'])))] = array($this-&gt;TrimTerm($thisfile_asf_extendedcontentdescriptionobject_contentdescriptor_current['value']));
+										}
+										break;
+
+									case 1:
+										break;
+								}
+								break;
+						}
+
+					}
+					break;
+
+				case GETID3_ASF_Stream_Bitrate_Properties_Object:
+					// Stream Bitrate Properties Object: (optional, one only)
+					// Field Name                   Field Type   Size (bits)
+					// Object ID                    GUID         128             // GUID for Stream Bitrate Properties object - GETID3_ASF_Stream_Bitrate_Properties_Object
+					// Object Size                  QWORD        64              // size of Extended Content Description object, including 26 bytes of Stream Bitrate Properties Object header
+					// Bitrate Records Count        WORD         16              // number of records in Bitrate Records
+					// Bitrate Records              array of:    variable        //
+					// * Flags                      WORD         16              //
+					// * * Stream Number            bits         7  (0x007F)     // number of this stream
+					// * * Reserved                 bits         9  (0xFF80)     // hardcoded: 0
+					// * Average Bitrate            DWORD        32              // in bits per second
+
+					// shortcut
+					$thisfile_asf['stream_bitrate_properties_object'] = array();
+					$thisfile_asf_streambitratepropertiesobject       = &amp;$thisfile_asf['stream_bitrate_properties_object'];
+
+					$thisfile_asf_streambitrateproperties['objectid']                  = $NextObjectGUID;
+					$thisfile_asf_streambitrateproperties['objectid_guid']             = $NextObjectGUIDtext;
+					$thisfile_asf_streambitrateproperties['objectsize']                = $NextObjectSize;
+					$thisfile_asf_streambitrateproperties['bitrate_records_count']     = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+					$offset += 2;
+					for ($BitrateRecordsCounter = 0; $BitrateRecordsCounter &lt; $thisfile_asf_streambitrateproperties['bitrate_records_count']; $BitrateRecordsCounter++) {
+						$thisfile_asf_streambitrateproperties['bitrate_records'][$BitrateRecordsCounter]['flags_raw'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 2));
+						$offset += 2;
+						$thisfile_asf_streambitrateproperties['bitrate_records'][$BitrateRecordsCounter]['flags']['stream_number'] = $thisfile_asf_streambitrateproperties['bitrate_records'][$BitrateRecordsCounter]['flags_raw'] &amp; 0x007F;
+						$thisfile_asf_streambitrateproperties['bitrate_records'][$BitrateRecordsCounter]['bitrate'] = getid3_lib::LittleEndian2Int(substr($ASFHeaderData, $offset, 4));
+						$offset += 4;
+					}
+					break;
+
+				case GETID3_ASF_Padding_Object:
+					// Padding Object: (optional)
+					// Field Name                   Field Type   Size (bits)
+					// Object ID                    GUID         128             // GUID for Padding object - GETID3_ASF_Padding_Object
+					// Object Size                  QWORD        64              // size of Padding object, including 24 bytes of ASF Padding Object header
+					// Padding Data                 BYTESTREAM   variable        // ignore
+
+					// shortcut
+					$thisfile_asf['padding_object'] = array();
+					$thisfile_asf_paddingobject     = &amp;$thisfile_asf['padding_object'];
+
+					$thisfile_asf_paddingobject['objectid']                  = $NextObjectGUID;
+					$thisfile_asf_paddingobject['objectid_guid']             = $NextObjectGUIDtext;
+					$thisfile_asf_paddingobject['objectsize']                = $NextObjectSize;
+					$thisfile_asf_paddingobject['padding_length']            = $thisfile_asf_paddingobject['objectsize'] - 16 - 8;
+					$thisfile_asf_paddingobject['padding']                   = substr($ASFHeaderData, $offset, $thisfile_asf_paddingobject['padding_length']);
+					break;
+
+				case GETID3_ASF_Extended_Content_Encryption_Object:
+				case GETID3_ASF_Content_Encryption_Object:
+					// WMA DRM - just ignore
+					$offset += ($NextObjectSize - 16 - 8);
+					break;
+
+				default:
+					// Implementations shall ignore any standard or non-standard object that they do not know how to handle.
+					if ($this-&gt;GUIDname($NextObjectGUIDtext)) {
+						$ThisFileInfo['warning'][] = 'unhandled GUID &quot;'.$this-&gt;GUIDname($NextObjectGUIDtext).'&quot; {'.$NextObjectGUIDtext.'} in ASF header at offset '.($offset - 16 - 8);
+					} else {
+						$ThisFileInfo['warning'][] = 'unknown GUID {'.$NextObjectGUIDtext.'} in ASF header at offset '.($offset - 16 - 8);
+					}
+					$offset += ($NextObjectSize - 16 - 8);
+					break;
+			}
+		}
+		if (isset($thisfile_asf_streambitrateproperties['bitrate_records_count'])) {
+			$ASFbitrateAudio = 0;
+			$ASFbitrateVideo = 0;
+			for ($BitrateRecordsCounter = 0; $BitrateRecordsCounter &lt; $thisfile_asf_streambitrateproperties['bitrate_records_count']; $BitrateRecordsCounter++) {
+				if (isset($thisfile_asf_codeclistobject['codec_entries'][$BitrateRecordsCounter])) {
+					switch ($thisfile_asf_codeclistobject['codec_entries'][$BitrateRecordsCounter]['type_raw']) {
+						case 1:
+							$ASFbitrateVideo += $thisfile_asf_streambitrateproperties['bitrate_records'][$BitrateRecordsCounter]['bitrate'];
+							break;
+
+						case 2:
+							$ASFbitrateAudio += $thisfile_asf_streambitrateproperties['bitrate_records'][$BitrateRecordsCounter]['bitrate'];
+							break;
+
+						default:
+							// do nothing
+							break;
+					}
+				}
+			}
+			if ($ASFbitrateAudio &gt; 0) {
+				$thisfile_audio['bitrate']     = $ASFbitrateAudio;
+			}
+			if ($ASFbitrateVideo &gt; 0) {
+				$thisfile_video['bitrate']     = $ASFbitrateVideo;
+			}
+		}
+		if (isset($thisfile_asf['stream_properties_object']) &amp;&amp; is_array($thisfile_asf['stream_properties_object'])) {
+
+			foreach ($thisfile_asf['stream_properties_object'] as $streamnumber =&gt; $streamdata) {
+
+				switch ($streamdata['stream_type']) {
+					case GETID3_ASF_Audio_Media:
+						// Field Name                   Field Type   Size (bits)
+						// Codec ID / Format Tag        WORD         16              // unique ID of audio codec - defined as wFormatTag field of WAVEFORMATEX structure
+						// Number of Channels           WORD         16              // number of channels of audio - defined as nChannels field of WAVEFORMATEX structure
+						// Samples Per Second           DWORD        32              // in Hertz - defined as nSamplesPerSec field of WAVEFORMATEX structure
+						// Average number of Bytes/sec  DWORD        32              // bytes/sec of audio stream  - defined as nAvgBytesPerSec field of WAVEFORMATEX structure
+						// Block Alignment              WORD         16              // block size in bytes of audio codec - defined as nBlockAlign field of WAVEFORMATEX structure
+						// Bits per sample              WORD         16              // bits per sample of mono data. set to zero for variable bitrate codecs. defined as wBitsPerSample field of WAVEFORMATEX structure
+						// Codec Specific Data Size     WORD         16              // size in bytes of Codec Specific Data buffer - defined as cbSize field of WAVEFORMATEX structure
+						// Codec Specific Data          BYTESTREAM   variable        // array of codec-specific data bytes
+
+						// shortcut
+						$thisfile_asf['audio_media'][$streamnumber] = array();
+						$thisfile_asf_audiomedia_currentstream      = &amp;$thisfile_asf['audio_media'][$streamnumber];
+
+						$audiomediaoffset = 0;
+
+						$thisfile_asf_audiomedia_currentstream = getid3_riff::RIFFparseWAVEFORMATex(substr($streamdata['type_specific_data'], $audiomediaoffset, 16));
+						$audiomediaoffset += 16;
+
+						$thisfile_audio['lossless'] = false;
+						switch ($thisfile_asf_audiomedia_currentstream['raw']['wFormatTag']) {
+							case 0x0001: // PCM
+							case 0x0163: // WMA9 Lossless
+								$thisfile_audio['lossless'] = true;
+								break;
+						}
+
+						if (!isset($thisfile_audio['bitrate'])) {
+							$thisfile_audio['bitrate'] = $thisfile_asf_audiomedia_currentstream['bytes_sec'] * 8;
+						}
+						$thisfile_audio['streams'][$streamnumber]                = $thisfile_asf_audiomedia_currentstream;
+						$thisfile_audio['streams'][$streamnumber]['wformattag']  = $thisfile_asf_audiomedia_currentstream['raw']['wFormatTag'];
+						$thisfile_audio['streams'][$streamnumber]['lossless']    = $thisfile_audio['lossless'];
+						$thisfile_audio['streams'][$streamnumber]['bitrate']     = $thisfile_audio['bitrate'];
+						unset($thisfile_audio['streams'][$streamnumber]['raw']);
+
+						$thisfile_asf_audiomedia_currentstream['codec_data_size'] = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $audiomediaoffset, 2));
+						$audiomediaoffset += 2;
+						$thisfile_asf_audiomedia_currentstream['codec_data']      = substr($streamdata['type_specific_data'], $audiomediaoffset, $thisfile_asf_audiomedia_currentstream['codec_data_size']);
+						$audiomediaoffset += $thisfile_asf_audiomedia_currentstream['codec_data_size'];
+
+						break;
+
+					case GETID3_ASF_Video_Media:
+						// Field Name                   Field Type   Size (bits)
+						// Encoded Image Width          DWORD        32              // width of image in pixels
+						// Encoded Image Height         DWORD        32              // height of image in pixels
+						// Reserved Flags               BYTE         8               // hardcoded: 0x02
+						// Format Data Size             WORD         16              // size of Format Data field in bytes
+						// Format Data                  array of:    variable        //
+						// * Format Data Size           DWORD        32              // number of bytes in Format Data field, in bytes - defined as biSize field of BITMAPINFOHEADER structure
+						// * Image Width                LONG         32              // width of encoded image in pixels - defined as biWidth field of BITMAPINFOHEADER structure
+						// * Image Height               LONG         32              // height of encoded image in pixels - defined as biHeight field of BITMAPINFOHEADER structure
+						// * Reserved                   WORD         16              // hardcoded: 0x0001 - defined as biPlanes field of BITMAPINFOHEADER structure
+						// * Bits Per Pixel Count       WORD         16              // bits per pixel - defined as biBitCount field of BITMAPINFOHEADER structure
+						// * Compression ID             FOURCC       32              // fourcc of video codec - defined as biCompression field of BITMAPINFOHEADER structure
+						// * Image Size                 DWORD        32              // image size in bytes - defined as biSizeImage field of BITMAPINFOHEADER structure
+						// * Horizontal Pixels / Meter  DWORD        32              // horizontal resolution of target device in pixels per meter - defined as biXPelsPerMeter field of BITMAPINFOHEADER structure
+						// * Vertical Pixels / Meter    DWORD        32              // vertical resolution of target device in pixels per meter - defined as biYPelsPerMeter field of BITMAPINFOHEADER structure
+						// * Colors Used Count          DWORD        32              // number of color indexes in the color table that are actually used - defined as biClrUsed field of BITMAPINFOHEADER structure
+						// * Important Colors Count     DWORD        32              // number of color index required for displaying bitmap. if zero, all colors are required. defined as biClrImportant field of BITMAPINFOHEADER structure
+						// * Codec Specific Data        BYTESTREAM   variable        // array of codec-specific data bytes
+
+						// shortcut
+						$thisfile_asf['video_media'][$streamnumber] = array();
+						$thisfile_asf_videomedia_currentstream      = &amp;$thisfile_asf['video_media'][$streamnumber];
+
+						$videomediaoffset = 0;
+						$thisfile_asf_videomedia_currentstream['image_width']                     = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 4));
+						$videomediaoffset += 4;
+						$thisfile_asf_videomedia_currentstream['image_height']                    = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 4));
+						$videomediaoffset += 4;
+						$thisfile_asf_videomedia_currentstream['flags']                           = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 1));
+						$videomediaoffset += 1;
+						$thisfile_asf_videomedia_currentstream['format_data_size']                = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 2));
+						$videomediaoffset += 2;
+						$thisfile_asf_videomedia_currentstream['format_data']['format_data_size'] = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 4));
+						$videomediaoffset += 4;
+						$thisfile_asf_videomedia_currentstream['format_data']['image_width']      = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 4));
+						$videomediaoffset += 4;
+						$thisfile_asf_videomedia_currentstream['format_data']['image_height']     = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 4));
+						$videomediaoffset += 4;
+						$thisfile_asf_videomedia_currentstream['format_data']['reserved']         = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 2));
+						$videomediaoffset += 2;
+						$thisfile_asf_videomedia_currentstream['format_data']['bits_per_pixel']   = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 2));
+						$videomediaoffset += 2;
+						$thisfile_asf_videomedia_currentstream['format_data']['codec_fourcc']     = substr($streamdata['type_specific_data'], $videomediaoffset, 4);
+						$videomediaoffset += 4;
+						$thisfile_asf_videomedia_currentstream['format_data']['image_size']       = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 4));
+						$videomediaoffset += 4;
+						$thisfile_asf_videomedia_currentstream['format_data']['horizontal_pels']  = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 4));
+						$videomediaoffset += 4;
+						$thisfile_asf_videomedia_currentstream['format_data']['vertical_pels']    = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 4));
+						$videomediaoffset += 4;
+						$thisfile_asf_videomedia_currentstream['format_data']['colors_used']      = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 4));
+						$videomediaoffset += 4;
+						$thisfile_asf_videomedia_currentstream['format_data']['colors_important'] = getid3_lib::LittleEndian2Int(substr($streamdata['type_specific_data'], $videomediaoffset, 4));
+						$videomediaoffset += 4;
+						$thisfile_asf_videomedia_currentstream['format_data']['codec_data']       = substr($streamdata['type_specific_data'], $videomediaoffset);
+
+
+						$thisfile_asf_videomedia_currentstream['format_data']['codec'] = getid3_riff::RIFFfourccLookup($thisfile_asf_videomedia_currentstream['format_data']['codec_fourcc']);
+
+						$thisfile_video['fourcc']          = $thisfile_asf_videomedia_currentstream['format_data']['codec_fourcc'];
+						$thisfile_video['codec']           = $thisfile_asf_videomedia_currentstream['format_data']['codec'];
+						$thisfile_video['resolution_x']    = $thisfile_asf_videomedia_currentstream['image_width'];
+						$thisfile_video['resolution_y']    = $thisfile_asf_videomedia_currentstream['image_height'];
+						$thisfile_video['bits_per_sample'] = $thisfile_asf_videomedia_currentstream['format_data']['bits_per_pixel'];
+						break;
+
+					default:
+						break;
+				}
+			}
+		}
+
+		while (ftell($fd) &lt; $ThisFileInfo['avdataend']) {
+			$NextObjectDataHeader = fread($fd, 24);
+			$offset = 0;
+			$NextObjectGUID = substr($NextObjectDataHeader, 0, 16);
+			$offset += 16;
+			$NextObjectGUIDtext = $this-&gt;BytestringToGUID($NextObjectGUID);
+			$NextObjectSize = getid3_lib::LittleEndian2Int(substr($NextObjectDataHeader, $offset, 8));
+			$offset += 8;
+
+			switch ($NextObjectGUID) {
+				case GETID3_ASF_Data_Object:
+					// Data Object: (mandatory, one only)
+					// Field Name                       Field Type   Size (bits)
+					// Object ID                        GUID         128             // GUID for Data object - GETID3_ASF_Data_Object
+					// Object Size                      QWORD        64              // size of Data object, including 50 bytes of Data Object header. may be 0 if FilePropertiesObject.BroadcastFlag == 1
+					// File ID                          GUID         128             // unique identifier. identical to File ID field in Header Object
+					// Total Data Packets               QWORD        64              // number of Data Packet entries in Data Object. invalid if FilePropertiesObject.BroadcastFlag == 1
+					// Reserved                         WORD         16              // hardcoded: 0x0101
+
+					// shortcut
+					$thisfile_asf['data_object'] = array();
+					$thisfile_asf_dataobject     = &amp;$thisfile_asf['data_object'];
+
+					$DataObjectData = $NextObjectDataHeader.fread($fd, 50 - 24);
+					$offset = 24;
+
+					$thisfile_asf_dataobject['objectid']           = $NextObjectGUID;
+					$thisfile_asf_dataobject['objectid_guid']      = $NextObjectGUIDtext;
+					$thisfile_asf_dataobject['objectsize']         = $NextObjectSize;
+
+					$thisfile_asf_dataobject['fileid']             = substr($DataObjectData, $offset, 16);
+					$offset += 16;
+					$thisfile_asf_dataobject['fileid_guid']        = $this-&gt;BytestringToGUID($thisfile_asf_dataobject['fileid']);
+					$thisfile_asf_dataobject['total_data_packets'] = getid3_lib::LittleEndian2Int(substr($DataObjectData, $offset, 8));
+					$offset += 8;
+					$thisfile_asf_dataobject['reserved']           = getid3_lib::LittleEndian2Int(substr($DataObjectData, $offset, 2));
+					$offset += 2;
+					if ($thisfile_asf_dataobject['reserved'] != 0x0101) {
+						$ThisFileInfo['warning'][] = 'data_object.reserved ('.getid3_lib::PrintHexBytes($thisfile_asf_dataobject['reserved']).') does not match expected value of &quot;0x0101&quot;';
+						//return false;
+						break;
+					}
+
+					// Data Packets                     array of:    variable        //
+					// * Error Correction Flags         BYTE         8               //
+					// * * Error Correction Data Length bits         4               // if Error Correction Length Type == 00, size of Error Correction Data in bytes, else hardcoded: 0000
+					// * * Opaque Data Present          bits         1               //
+					// * * Error Correction Length Type bits         2               // number of bits for size of the error correction data. hardcoded: 00
+					// * * Error Correction Present     bits         1               // If set, use Opaque Data Packet structure, else use Payload structure
+					// * Error Correction Data
+
+					$ThisFileInfo['avdataoffset'] = ftell($fd);
+					fseek($fd, ($thisfile_asf_dataobject['objectsize'] - 50), SEEK_CUR); // skip actual audio/video data
+					$ThisFileInfo['avdataend'] = ftell($fd);
+					break;
+
+				case GETID3_ASF_Simple_Index_Object:
+					// Simple Index Object: (optional, recommended, one per video stream)
+					// Field Name                       Field Type   Size (bits)
+					// Object ID                        GUID         128             // GUID for Simple Index object - GETID3_ASF_Data_Object
+					// Object Size                      QWORD        64              // size of Simple Index object, including 56 bytes of Simple Index Object header
+					// File ID                          GUID         128             // unique identifier. may be zero or identical to File ID field in Data Object and Header Object
+					// Index Entry Time Interval        QWORD        64              // interval between index entries in 100-nanosecond units
+					// Maximum Packet Count             DWORD        32              // maximum packet count for all index entries
+					// Index Entries Count              DWORD        32              // number of Index Entries structures
+					// Index Entries                    array of:    variable        //
+					// * Packet Number                  DWORD        32              // number of the Data Packet associated with this index entry
+					// * Packet Count                   WORD         16              // number of Data Packets to sent at this index entry
+
+					// shortcut
+					$thisfile_asf['simple_index_object'] = array();
+					$thisfile_asf_simpleindexobject      = &amp;$thisfile_asf['simple_index_object'];
+
+					$SimpleIndexObjectData = $NextObjectDataHeader.fread($fd, 56 - 24);
+					$offset = 24;
+
+					$thisfile_asf_simpleindexobject['objectid']                  = $NextObjectGUID;
+					$thisfile_asf_simpleindexobject['objectid_guid']             = $NextObjectGUIDtext;
+					$thisfile_asf_simpleindexobject['objectsize']                = $NextObjectSize;
+
+					$thisfile_asf_simpleindexobject['fileid']                    =                  substr($SimpleIndexObjectData, $offset, 16);
+					$offset += 16;
+					$thisfile_asf_simpleindexobject['fileid_guid']               = $this-&gt;BytestringToGUID($thisfile_asf_simpleindexobject['fileid']);
+					$thisfile_asf_simpleindexobject['index_entry_time_interval'] = getid3_lib::LittleEndian2Int(substr($SimpleIndexObjectData, $offset, 8));
+					$offset += 8;
+					$thisfile_asf_simpleindexobject['maximum_packet_count']      = getid3_lib::LittleEndian2Int(substr($SimpleIndexObjectData, $offset, 4));
+					$offset += 4;
+					$thisfile_asf_simpleindexobject['index_entries_count']       = getid3_lib::LittleEndian2Int(substr($SimpleIndexObjectData, $offset, 4));
+					$offset += 4;
+
+					$IndexEntriesData = $SimpleIndexObjectData.fread($fd, 6 * $thisfile_asf_simpleindexobject['index_entries_count']);
+					for ($IndexEntriesCounter = 0; $IndexEntriesCounter &lt; $thisfile_asf_simpleindexobject['index_entries_count']; $IndexEntriesCounter++) {
+						$thisfile_asf_simpleindexobject['index_entries'][$IndexEntriesCounter]['packet_number'] = getid3_lib::LittleEndian2Int(substr($IndexEntriesData, $offset, 4));
+						$offset += 4;
+						$thisfile_asf_simpleindexobject['index_entries'][$IndexEntriesCounter]['packet_count']  = getid3_lib::LittleEndian2Int(substr($IndexEntriesData, $offset, 4));
+						$offset += 2;
+					}
+
+					break;
+
+				case GETID3_ASF_Index_Object:
+					// 6.2 ASF top-level Index Object (optional but recommended when appropriate, 0 or 1)
+					// Field Name                       Field Type   Size (bits)
+					// Object ID                        GUID         128             // GUID for the Index Object - GETID3_ASF_Index_Object
+					// Object Size                      QWORD        64              // Specifies the size, in bytes, of the Index Object, including at least 34 bytes of Index Object header
+					// Index Entry Time Interval        DWORD        32              // Specifies the time interval between each index entry in ms.
+					// Index Specifiers Count           WORD         16              // Specifies the number of Index Specifiers structures in this Index Object.
+					// Index Blocks Count               DWORD        32              // Specifies the number of Index Blocks structures in this Index Object.
+
+					// Index Entry Time Interval        DWORD        32              // Specifies the time interval between index entries in milliseconds.  This value cannot be 0.
+					// Index Specifiers Count           WORD         16              // Specifies the number of entries in the Index Specifiers list.  Valid values are 1 and greater.
+					// Index Specifiers                 array of:    varies          //
+					// * Stream Number                  WORD         16              // Specifies the stream number that the Index Specifiers refer to. Valid values are between 1 and 127.
+					// * Index Type                     WORD         16              // Specifies Index Type values as follows:
+																					//   1 = Nearest Past Data Packet - indexes point to the data packet whose presentation time is closest to the index entry time.
+																					//   2 = Nearest Past Media Object - indexes point to the closest data packet containing an entire object or first fragment of an object.
+																					//   3 = Nearest Past Cleanpoint. - indexes point to the closest data packet containing an entire object (or first fragment of an object) that has the Cleanpoint Flag set.
+																					//   Nearest Past Cleanpoint is the most common type of index.
+					// Index Entry Count                DWORD        32              // Specifies the number of Index Entries in the block.
+					// * Block Positions                QWORD        varies          // Specifies a list of byte offsets of the beginnings of the blocks relative to the beginning of the first Data Packet (i.e., the beginning of the Data Object + 50 bytes). The number of entries in this list is specified by the value of the Index Specifiers Count field. The order of those byte offsets is tied to the order in which Index Specifiers are listed.
+					// * Index Entries                  array of:    varies          //
+					// * * Offsets                      DWORD        varies          // An offset value of 0xffffffff indicates an invalid offset value
+
+					// shortcut
+					$thisfile_asf['asf_index_object'] = array();
+					$thisfile_asf_asfindexobject      = &amp;$thisfile_asf['asf_index_object'];
+
+					$ASFIndexObjectData = $NextObjectDataHeader.fread($fd, 34 - 24);
+					$offset = 24;
+
+					$thisfile_asf_asfindexobject['objectid']                  = $NextObjectGUID;
+					$thisfile_asf_asfindexobject['objectid_guid']             = $NextObjectGUIDtext;
+					$thisfile_asf_asfindexobject['objectsize']                = $NextObjectSize;
+
+					$thisfile_asf_asfindexobject['entry_time_interval']       = getid3_lib::LittleEndian2Int(substr($ASFIndexObjectData, $offset, 4));
+					$offset += 4;
+					$thisfile_asf_asfindexobject['index_specifiers_count']    = getid3_lib::LittleEndian2Int(substr($ASFIndexObjectData, $offset, 2));
+					$offset += 2;
+					$thisfile_asf_asfindexobject['index_blocks_count']        = getid3_lib::LittleEndian2Int(substr($ASFIndexObjectData, $offset, 4));
+					$offset += 4;
+
+					$ASFIndexObjectData .= fread($fd, 4 * $thisfile_asf_asfindexobject['index_specifiers_count']);
+					for ($IndexSpecifiersCounter = 0; $IndexSpecifiersCounter &lt; $thisfile_asf_asfindexobject['index_specifiers_count']; $IndexSpecifiersCounter++) {
+						$IndexSpecifierStreamNumber = getid3_lib::LittleEndian2Int(substr($ASFIndexObjectData, $offset, 2));
+						$offset += 2;
+						$thisfile_asf_asfindexobject['index_specifiers'][$IndexSpecifiersCounter]['stream_number']   = $IndexSpecifierStreamNumber;
+						$thisfile_asf_asfindexobject['index_specifiers'][$IndexSpecifiersCounter]['index_type']      = getid3_lib::LittleEndian2Int(substr($ASFIndexObjectData, $offset, 2));
+						$offset += 2;
+						$thisfile_asf_asfindexobject['index_specifiers'][$IndexSpecifiersCounter]['index_type_text'] = $this-&gt;ASFIndexObjectIndexTypeLookup($thisfile_asf_asfindexobject['index_specifiers'][$IndexSpecifiersCounter]['index_type']);
+					}
+
+					$ASFIndexObjectData .= fread($fd, 4);
+					$thisfile_asf_asfindexobject['index_entry_count'] = getid3_lib::LittleEndian2Int(substr($ASFIndexObjectData, $offset, 4));
+					$offset += 4;
+
+					$ASFIndexObjectData .= fread($fd, 8 * $thisfile_asf_asfindexobject['index_specifiers_count']);
+					for ($IndexSpecifiersCounter = 0; $IndexSpecifiersCounter &lt; $thisfile_asf_asfindexobject['index_specifiers_count']; $IndexSpecifiersCounter++) {
+						$thisfile_asf_asfindexobject['block_positions'][$IndexSpecifiersCounter] = getid3_lib::LittleEndian2Int(substr($ASFIndexObjectData, $offset, 8));
+						$offset += 8;
+					}
+
+					$ASFIndexObjectData .= fread($fd, 4 * $thisfile_asf_asfindexobject['index_specifiers_count'] * $thisfile_asf_asfindexobject['index_entry_count']);
+					for ($IndexEntryCounter = 0; $IndexEntryCounter &lt; $thisfile_asf_asfindexobject['index_entry_count']; $IndexEntryCounter++) {
+						for ($IndexSpecifiersCounter = 0; $IndexSpecifiersCounter &lt; $thisfile_asf_asfindexobject['index_specifiers_count']; $IndexSpecifiersCounter++) {
+							$thisfile_asf_asfindexobject['offsets'][$IndexSpecifiersCounter][$IndexEntryCounter] = getid3_lib::LittleEndian2Int(substr($ASFIndexObjectData, $offset, 4));
+							$offset += 4;
+						}
+					}
+					break;
+
+
+				default:
+					// Implementations shall ignore any standard or non-standard object that they do not know how to handle.
+					if ($this-&gt;GUIDname($NextObjectGUIDtext)) {
+						$ThisFileInfo['warning'][] = 'unhandled GUID &quot;'.$this-&gt;GUIDname($NextObjectGUIDtext).'&quot; {'.$NextObjectGUIDtext.'} in ASF body at offset '.($offset - 16 - 8);
+					} else {
+						$ThisFileInfo['warning'][] = 'unknown GUID {'.$NextObjectGUIDtext.'} in ASF body at offset '.(ftell($fd) - 16 - 8);
+					}
+					fseek($fd, ($NextObjectSize - 16 - 8), SEEK_CUR);
+					break;
+			}
+		}
+
+		if (isset($thisfile_asf_codeclistobject['codec_entries']) &amp;&amp; is_array($thisfile_asf_codeclistobject['codec_entries'])) {
+			foreach ($thisfile_asf_codeclistobject['codec_entries'] as $streamnumber =&gt; $streamdata) {
+				switch ($streamdata['information']) {
+					case 'WMV1':
+					case 'WMV2':
+					case 'WMV3':
+						$thisfile_video['dataformat'] = 'wmv';
+						$ThisFileInfo['mime_type']    = 'video/x-ms-wmv';
+						break;
+
+					case 'MP42':
+					case 'MP43':
+					case 'MP4S':
+					case 'mp4s':
+						$thisfile_video['dataformat'] = 'asf';
+						$ThisFileInfo['mime_type']    = 'video/x-ms-asf';
+						break;
+
+					default:
+						switch ($streamdata['type_raw']) {
+							case 1:
+								if (strstr($this-&gt;TrimConvert($streamdata['name']), 'Windows Media')) {
+									$thisfile_video['dataformat'] = 'wmv';
+									if ($ThisFileInfo['mime_type'] == 'video/x-ms-asf') {
+										$ThisFileInfo['mime_type'] = 'video/x-ms-wmv';
+									}
+								}
+								break;
+
+							case 2:
+								if (strstr($this-&gt;TrimConvert($streamdata['name']), 'Windows Media')) {
+									$thisfile_audio['dataformat'] = 'wma';
+									if ($ThisFileInfo['mime_type'] == 'video/x-ms-asf') {
+										$ThisFileInfo['mime_type'] = 'audio/x-ms-wma';
+									}
+								}
+								break;
+
+						}
+						break;
+				}
+			}
+		}
+
+		switch ($thisfile_audio['codec']) {
+			case 'MPEG Layer-3':
+				$thisfile_audio['dataformat'] = 'mp3';
+				break;
+
+			default:
+				break;
+		}
+
+		if (isset($thisfile_asf_codeclistobject['codec_entries'])) {
+			foreach ($thisfile_asf_codeclistobject['codec_entries'] as $streamnumber =&gt; $streamdata) {
+				switch ($streamdata['type_raw']) {
+
+					case 1: // video
+						$thisfile_video['encoder'] = $this-&gt;TrimConvert($thisfile_asf_codeclistobject['codec_entries'][$streamnumber]['name']);
+						break;
+
+					case 2: // audio
+						$thisfile_audio['encoder'] = $this-&gt;TrimConvert($thisfile_asf_codeclistobject['codec_entries'][$streamnumber]['name']);
+
+						// AH 2003-10-01
+						$thisfile_audio['encoder_options'] = $this-&gt;TrimConvert($thisfile_asf_codeclistobject['codec_entries'][0]['description']);
+
+						$thisfile_audio['codec']   = $thisfile_audio['encoder'];
+						break;
+
+					default:
+						$ThisFileInfo['warning'][] = 'Unknown streamtype: [codec_list_object][codec_entries]['.$streamnumber.'][type_raw] == '.$streamdata['type_raw'];
+						break;
+
+				}
+			}
+		}
+
+		if (isset($ThisFileInfo['audio'])) {
+			$thisfile_audio['lossless']           = (isset($thisfile_audio['lossless'])           ? $thisfile_audio['lossless']           : false);
+			$thisfile_audio['dataformat']         = (!empty($thisfile_audio['dataformat'])        ? $thisfile_audio['dataformat']         : 'asf');
+		}
+		if (!empty($thisfile_video['dataformat'])) {
+			$thisfile_video['lossless']           = (isset($thisfile_audio['lossless'])           ? $thisfile_audio['lossless']           : false);
+			$thisfile_video['pixel_aspect_ratio'] = (isset($thisfile_audio['pixel_aspect_ratio']) ? $thisfile_audio['pixel_aspect_ratio'] : (float) 1);
+			$thisfile_video['dataformat']         = (!empty($thisfile_video['dataformat'])        ? $thisfile_video['dataformat']         : 'asf');
+		}
+
+		return true;
+	}
+
+	function ASFCodecListObjectTypeLookup($CodecListType) {
+		static $ASFCodecListObjectTypeLookup = array();
+		if (empty($ASFCodecListObjectTypeLookup)) {
+			$ASFCodecListObjectTypeLookup[0x0001] = 'Video Codec';
+			$ASFCodecListObjectTypeLookup[0x0002] = 'Audio Codec';
+			$ASFCodecListObjectTypeLookup[0xFFFF] = 'Unknown Codec';
+		}
+
+		return (isset($ASFCodecListObjectTypeLookup[$CodecListType]) ? $ASFCodecListObjectTypeLookup[$CodecListType] : 'Invalid Codec Type');
+	}
+
+	function KnownGUIDs() {
+		static $GUIDarray = array();
+		if (empty($GUIDarray)) {
+			$GUIDarray['GETID3_ASF_Extended_Stream_Properties_Object']   = '14E6A5CB-C672-4332-8399-A96952065B5A';
+			$GUIDarray['GETID3_ASF_Padding_Object']                      = '1806D474-CADF-4509-A4BA-9AABCB96AAE8';
+			$GUIDarray['GETID3_ASF_Payload_Ext_Syst_Pixel_Aspect_Ratio'] = '1B1EE554-F9EA-4BC8-821A-376B74E4C4B8';
+			$GUIDarray['GETID3_ASF_Script_Command_Object']               = '1EFB1A30-0B62-11D0-A39B-00A0C90348F6';
+			$GUIDarray['GETID3_ASF_No_Error_Correction']                 = '20FB5700-5B55-11CF-A8FD-00805F5C442B';
+			$GUIDarray['GETID3_ASF_Content_Branding_Object']             = '2211B3FA-BD23-11D2-B4B7-00A0C955FC6E';
+			$GUIDarray['GETID3_ASF_Content_Encryption_Object']           = '2211B3FB-BD23-11D2-B4B7-00A0C955FC6E';
+			$GUIDarray['GETID3_ASF_Digital_Signature_Object']            = '2211B3FC-BD23-11D2-B4B7-00A0C955FC6E';
+			$GUIDarray['GETID3_ASF_Extended_Content_Encryption_Object']  = '298AE614-2622-4C17-B935-DAE07EE9289C';
+			$GUIDarray['GETID3_ASF_Simple_Index_Object']                 = '33000890-E5B1-11CF-89F4-00A0C90349CB';
+			$GUIDarray['GETID3_ASF_Degradable_JPEG_Media']               = '35907DE0-E415-11CF-A917-00805F5C442B';
+			$GUIDarray['GETID3_ASF_Payload_Extension_System_Timecode']   = '399595EC-8667-4E2D-8FDB-98814CE76C1E';
+			$GUIDarray['GETID3_ASF_Binary_Media']                        = '3AFB65E2-47EF-40F2-AC2C-70A90D71D343';
+			$GUIDarray['GETID3_ASF_Timecode_Index_Object']               = '3CB73FD0-0C4A-4803-953D-EDF7B6228F0C';
+			$GUIDarray['GETID3_ASF_Metadata_Library_Object']             = '44231C94-9498-49D1-A141-1D134E457054';
+			$GUIDarray['GETID3_ASF_Reserved_3']                          = '4B1ACBE3-100B-11D0-A39B-00A0C90348F6';
+			$GUIDarray['GETID3_ASF_Reserved_4']                          = '4CFEDB20-75F6-11CF-9C0F-00A0C90349CB';
+			$GUIDarray['GETID3_ASF_Command_Media']                       = '59DACFC0-59E6-11D0-A3AC-00A0C90348F6';
+			$GUIDarray['GETID3_ASF_Header_Extension_Object']             = '5FBF03B5-A92E-11CF-8EE3-00C00C205365';
+			$GUIDarray['GETID3_ASF_Media_Object_Index_Parameters_Obj']   = '6B203BAD-3F11-4E84-ACA8-D7613DE2CFA7';
+			$GUIDarray['GETID3_ASF_Header_Object']                       = '75B22630-668E-11CF-A6D9-00AA0062CE6C';
+			$GUIDarray['GETID3_ASF_Content_Description_Object']          = '75B22633-668E-11CF-A6D9-00AA0062CE6C';
+			$GUIDarray['GETID3_ASF_Error_Correction_Object']             = '75B22635-668E-11CF-A6D9-00AA0062CE6C';
+			$GUIDarray['GETID3_ASF_Data_Object']                         = '75B22636-668E-11CF-A6D9-00AA0062CE6C';
+			$GUIDarray['GETID3_ASF_Web_Stream_Media_Subtype']            = '776257D4-C627-41CB-8F81-7AC7FF1C40CC';
+			$GUIDarray['GETID3_ASF_Stream_Bitrate_Properties_Object']    = '7BF875CE-468D-11D1-8D82-006097C9A2B2';
+			$GUIDarray['GETID3_ASF_Language_List_Object']                = '7C4346A9-EFE0-4BFC-B229-393EDE415C85';
+			$GUIDarray['GETID3_ASF_Codec_List_Object']                   = '86D15240-311D-11D0-A3A4-00A0C90348F6';
+			$GUIDarray['GETID3_ASF_Reserved_2']                          = '86D15241-311D-11D0-A3A4-00A0C90348F6';
+			$GUIDarray['GETID3_ASF_File_Properties_Object']              = '8CABDCA1-A947-11CF-8EE4-00C00C205365';
+			$GUIDarray['GETID3_ASF_File_Transfer_Media']                 = '91BD222C-F21C-497A-8B6D-5AA86BFC0185';
+			$GUIDarray['GETID3_ASF_Old_RTP_Extension_Data']              = '96800C63-4C94-11D1-837B-0080C7A37F95';
+			$GUIDarray['GETID3_ASF_Advanced_Mutual_Exclusion_Object']    = 'A08649CF-4775-4670-8A16-6E35357566CD';
+			$GUIDarray['GETID3_ASF_Bandwidth_Sharing_Object']            = 'A69609E6-517B-11D2-B6AF-00C04FD908E9';
+			$GUIDarray['GETID3_ASF_Reserved_1']                          = 'ABD3D211-A9BA-11cf-8EE6-00C00C205365';
+			$GUIDarray['GETID3_ASF_Bandwidth_Sharing_Exclusive']         = 'AF6060AA-5197-11D2-B6AF-00C04FD908E9';
+			$GUIDarray['GETID3_ASF_Bandwidth_Sharing_Partial']           = 'AF6060AB-5197-11D2-B6AF-00C04FD908E9';
+			$GUIDarray['GETID3_ASF_JFIF_Media']                          = 'B61BE100-5B4E-11CF-A8FD-00805F5C442B';
+			$GUIDarray['GETID3_ASF_Stream_Properties_Object']            = 'B7DC0791-A9B7-11CF-8EE6-00C00C205365';
+			$GUIDarray['GETID3_ASF_Video_Media']                         = 'BC19EFC0-5B4D-11CF-A8FD-00805F5C442B';
+			$GUIDarray['GETID3_ASF_Audio_Spread']                        = 'BFC3CD50-618F-11CF-8BB2-00AA00B4E220';
+			$GUIDarray['GETID3_ASF_Metadata_Object']                     = 'C5F8CBEA-5BAF-4877-8467-AA8C44FA4CCA';
+			$GUIDarray['GETID3_ASF_Payload_Ext_Syst_Sample_Duration']    = 'C6BD9450-867F-4907-83A3-C77921B733AD';
+			$GUIDarray['GETID3_ASF_Group_Mutual_Exclusion_Object']       = 'D1465A40-5A79-4338-B71B-E36B8FD6C249';
+			$GUIDarray['GETID3_ASF_Extended_Content_Description_Object'] = 'D2D0A440-E307-11D2-97F0-00A0C95EA850';
+			$GUIDarray['GETID3_ASF_Stream_Prioritization_Object']        = 'D4FED15B-88D3-454F-81F0-ED5C45999E24';
+			$GUIDarray['GETID3_ASF_Payload_Ext_System_Content_Type']     = 'D590DC20-07BC-436C-9CF7-F3BBFBF1A4DC';
+			$GUIDarray['GETID3_ASF_Old_File_Properties_Object']          = 'D6E229D0-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_ASF_Header_Object']               = 'D6E229D1-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_ASF_Data_Object']                 = 'D6E229D2-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Index_Object']                        = 'D6E229D3-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Stream_Properties_Object']        = 'D6E229D4-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Content_Description_Object']      = 'D6E229D5-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Script_Command_Object']           = 'D6E229D6-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Marker_Object']                   = 'D6E229D7-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Component_Download_Object']       = 'D6E229D8-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Stream_Group_Object']             = 'D6E229D9-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Scalable_Object']                 = 'D6E229DA-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Prioritization_Object']           = 'D6E229DB-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Bitrate_Mutual_Exclusion_Object']     = 'D6E229DC-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Inter_Media_Dependency_Object']   = 'D6E229DD-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Rating_Object']                   = 'D6E229DE-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Index_Parameters_Object']             = 'D6E229DF-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Color_Table_Object']              = 'D6E229E0-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Language_List_Object']            = 'D6E229E1-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Audio_Media']                     = 'D6E229E2-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Video_Media']                     = 'D6E229E3-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Image_Media']                     = 'D6E229E4-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Timecode_Media']                  = 'D6E229E5-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Text_Media']                      = 'D6E229E6-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_MIDI_Media']                      = 'D6E229E7-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Command_Media']                   = 'D6E229E8-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_No_Error_Concealment']            = 'D6E229EA-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Scrambled_Audio']                 = 'D6E229EB-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_No_Color_Table']                  = 'D6E229EC-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_SMPTE_Time']                      = 'D6E229ED-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_ASCII_Text']                      = 'D6E229EE-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Unicode_Text']                    = 'D6E229EF-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_HTML_Text']                       = 'D6E229F0-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_URL_Command']                     = 'D6E229F1-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Filename_Command']                = 'D6E229F2-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_ACM_Codec']                       = 'D6E229F3-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_VCM_Codec']                       = 'D6E229F4-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_QuickTime_Codec']                 = 'D6E229F5-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_DirectShow_Transform_Filter']     = 'D6E229F6-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_DirectShow_Rendering_Filter']     = 'D6E229F7-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_No_Enhancement']                  = 'D6E229F8-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Unknown_Enhancement_Type']        = 'D6E229F9-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Temporal_Enhancement']            = 'D6E229FA-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Spatial_Enhancement']             = 'D6E229FB-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Quality_Enhancement']             = 'D6E229FC-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Number_of_Channels_Enhancement']  = 'D6E229FD-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Frequency_Response_Enhancement']  = 'D6E229FE-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Media_Object']                    = 'D6E229FF-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Mutex_Language']                      = 'D6E22A00-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Mutex_Bitrate']                       = 'D6E22A01-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Mutex_Unknown']                       = 'D6E22A02-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_ASF_Placeholder_Object']          = 'D6E22A0E-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Old_Data_Unit_Extension_Object']      = 'D6E22A0F-35DA-11D1-9034-00A0C90349BE';
+			$GUIDarray['GETID3_ASF_Web_Stream_Format']                   = 'DA1E6B13-8359-4050-B398-388E965BF00C';
+			$GUIDarray['GETID3_ASF_Payload_Ext_System_File_Name']        = 'E165EC0E-19ED-45D7-B4A7-25CBD1E28E9B';
+			$GUIDarray['GETID3_ASF_Marker_Object']                       = 'F487CD01-A951-11CF-8EE6-00C00C205365';
+			$GUIDarray['GETID3_ASF_Timecode_Index_Parameters_Object']    = 'F55E496D-9797-4B5D-8C8B-604DFE9BFB24';
+			$GUIDarray['GETID3_ASF_Audio_Media']                         = 'F8699E40-5B4D-11CF-A8FD-00805F5C442B';
+			$GUIDarray['GETID3_ASF_Media_Object_Index_Object']           = 'FEB103F8-12AD-4C64-840F-2A1D2F7AD48C';
+			$GUIDarray['GETID3_ASF_Alt_Extended_Content_Encryption_Obj'] = 'FF889EF1-ADEE-40DA-9E71-98704BB928CE';
+		}
+		return $GUIDarray;
+	}
+
+	function GUIDname($GUIDstring) {
+		static $GUIDarray = array();
+		if (empty($GUIDarray)) {
+			$GUIDarray = $this-&gt;KnownGUIDs();
+		}
+		return array_search($GUIDstring, $GUIDarray);
+	}
+
+	function ASFIndexObjectIndexTypeLookup($id) {
+		static $ASFIndexObjectIndexTypeLookup = array();
+		if (empty($ASFIndexObjectIndexTypeLookup)) {
+			$ASFIndexObjectIndexTypeLookup[1] = 'Nearest Past Data Packet';
+			$ASFIndexObjectIndexTypeLookup[2] = 'Nearest Past Media Object';
+			$ASFIndexObjectIndexTypeLookup[3] = 'Nearest Past Cleanpoint';
+		}
+		return (isset($ASFIndexObjectIndexTypeLookup[$id]) ? $ASFIndexObjectIndexTypeLookup[$id] : 'invalid');
+	}
+
+	function GUIDtoBytestring($GUIDstring) {
+		// Microsoft defines these 16-byte (128-bit) GUIDs in the strangest way:
+		// first 4 bytes are in little-endian order
+		// next 2 bytes are appended in little-endian order
+		// next 2 bytes are appended in little-endian order
+		// next 2 bytes are appended in big-endian order
+		// next 6 bytes are appended in big-endian order
+
+		// AaBbCcDd-EeFf-GgHh-IiJj-KkLlMmNnOoPp is stored as this 16-byte string:
+		// $Dd $Cc $Bb $Aa $Ff $Ee $Hh $Gg $Ii $Jj $Kk $Ll $Mm $Nn $Oo $Pp
+
+		$hexbytecharstring  = chr(hexdec(substr($GUIDstring,  6, 2)));
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring,  4, 2)));
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring,  2, 2)));
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring,  0, 2)));
+
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring, 11, 2)));
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring,  9, 2)));
+
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring, 16, 2)));
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring, 14, 2)));
+
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring, 19, 2)));
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring, 21, 2)));
+
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring, 24, 2)));
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring, 26, 2)));
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring, 28, 2)));
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring, 30, 2)));
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring, 32, 2)));
+		$hexbytecharstring .= chr(hexdec(substr($GUIDstring, 34, 2)));
+
+		return $hexbytecharstring;
+	}
+
+	function BytestringToGUID($Bytestring) {
+		$GUIDstring  = str_pad(dechex(ord($Bytestring{3})),  2, '0', STR_PAD_LEFT);
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{2})),  2, '0', STR_PAD_LEFT);
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{1})),  2, '0', STR_PAD_LEFT);
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{0})),  2, '0', STR_PAD_LEFT);
+		$GUIDstring .= '-';
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{5})),  2, '0', STR_PAD_LEFT);
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{4})),  2, '0', STR_PAD_LEFT);
+		$GUIDstring .= '-';
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{7})),  2, '0', STR_PAD_LEFT);
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{6})),  2, '0', STR_PAD_LEFT);
+		$GUIDstring .= '-';
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{8})),  2, '0', STR_PAD_LEFT);
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{9})),  2, '0', STR_PAD_LEFT);
+		$GUIDstring .= '-';
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{10})), 2, '0', STR_PAD_LEFT);
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{11})), 2, '0', STR_PAD_LEFT);
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{12})), 2, '0', STR_PAD_LEFT);
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{13})), 2, '0', STR_PAD_LEFT);
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{14})), 2, '0', STR_PAD_LEFT);
+		$GUIDstring .= str_pad(dechex(ord($Bytestring{15})), 2, '0', STR_PAD_LEFT);
+
+		return strtoupper($GUIDstring);
+	}
+
+	function FILETIMEtoUNIXtime($FILETIME, $round=true) {
+		// FILETIME is a 64-bit unsigned integer representing
+		// the number of 100-nanosecond intervals since January 1, 1601
+		// UNIX timestamp is number of seconds since January 1, 1970
+		// 116444736000000000 = 10000000 * 60 * 60 * 24 * 365 * 369 + 89 leap days
+		if ($round) {
+			return intval(round(($FILETIME - 116444736000000000) / 10000000));
+		}
+		return ($FILETIME - 116444736000000000) / 10000000;
+	}
+
+	function WMpictureTypeLookup($WMpictureType) {
+		static $WMpictureTypeLookup = array();
+		if (empty($WMpictureTypeLookup)) {
+			$WMpictureTypeLookup[0x03] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Front Cover');
+			$WMpictureTypeLookup[0x04] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Back Cover');
+			$WMpictureTypeLookup[0x00] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'User Defined');
+			$WMpictureTypeLookup[0x05] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Leaflet Page');
+			$WMpictureTypeLookup[0x06] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Media Label');
+			$WMpictureTypeLookup[0x07] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Lead Artist');
+			$WMpictureTypeLookup[0x08] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Artist');
+			$WMpictureTypeLookup[0x09] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Conductor');
+			$WMpictureTypeLookup[0x0A] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Band');
+			$WMpictureTypeLookup[0x0B] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Composer');
+			$WMpictureTypeLookup[0x0C] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Lyricist');
+			$WMpictureTypeLookup[0x0D] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Recording Location');
+			$WMpictureTypeLookup[0x0E] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'During Recording');
+			$WMpictureTypeLookup[0x0F] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'During Performance');
+			$WMpictureTypeLookup[0x10] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Video Screen Capture');
+			$WMpictureTypeLookup[0x12] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Illustration');
+			$WMpictureTypeLookup[0x13] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Band Logotype');
+			$WMpictureTypeLookup[0x14] = getid3_lib::iconv_fallback('ISO-8859-1', 'UTF-16LE', 'Publisher Logotype');
+		}
+		return @$WMpictureTypeLookup[$WMpictureType];
+	}
+
+
+	// Remove terminator 00 00 and convert UNICODE to Latin-1
+	function TrimConvert($string) {
+
+		// remove terminator, only if present (it should be, but...)
+		if (substr($string, strlen($string) - 2, 2) == &quot;\x00\x00&quot;) {
+			$string = substr($string, 0, strlen($string) - 2);
+		}
+
+		// convert
+		return trim(getid3_lib::iconv_fallback('UTF-16LE', 'ISO-8859-1', $string), ' ');
+	}
+
+
+	function TrimTerm($string) {
+
+		// remove terminator, only if present (it should be, but...)
+		if (substr($string, -2) == &quot;\x00\x00&quot;) {
+			$string = substr($string, 0, -2);
+		}
+		return $string;
+	}
+
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio-video.asf.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio-video.bink.php
===================================================================
--- trunk/inc/external/getid3/module.audio-video.bink.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio-video.bink.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,70 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.bink.php                                       //
+// module for analyzing Bink or Smacker audio-video files      //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_bink
+{
+
+	function getid3_bink(&amp;$fd, &amp;$ThisFileInfo) {
+
+$ThisFileInfo['error'][] = 'Bink / Smacker files not properly processed by this version of getID3()';
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$fileTypeID = fread($fd, 3);
+		switch ($fileTypeID) {
+			case 'BIK':
+				return $this-&gt;ParseBink($fd, $ThisFileInfo);
+				break;
+
+			case 'SMK':
+				return $this-&gt;ParseSmacker($fd, $ThisFileInfo);
+				break;
+
+			default:
+				$ThisFileInfo['error'][] = 'Expecting &quot;BIK&quot; or &quot;SMK&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.$fileTypeID.'&quot;';
+				return false;
+				break;
+		}
+
+		return true;
+
+	}
+
+	function ParseBink(&amp;$fd, &amp;$ThisFileInfo) {
+		$ThisFileInfo['fileformat']          = 'bink';
+		$ThisFileInfo['video']['dataformat'] = 'bink';
+
+		$fileData = 'BIK'.fread($fd, 13);
+
+		$ThisFileInfo['bink']['data_size']   = getid3_lib::LittleEndian2Int(substr($fileData, 4, 4));
+		$ThisFileInfo['bink']['frame_count'] = getid3_lib::LittleEndian2Int(substr($fileData, 8, 2));
+
+		if (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) != ($ThisFileInfo['bink']['data_size'] + 8)) {
+			$ThisFileInfo['error'][] = 'Probably truncated file: expecting '.$ThisFileInfo['bink']['data_size'].' bytes, found '.($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']);
+		}
+
+		return true;
+	}
+
+	function ParseSmacker(&amp;$fd, &amp;$ThisFileInfo) {
+		$ThisFileInfo['fileformat']          = 'smacker';
+		$ThisFileInfo['video']['dataformat'] = 'smacker';
+
+		return false;
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio-video.bink.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio-video.matroska.php
===================================================================
--- trunk/inc/external/getid3/module.audio-video.matroska.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio-video.matroska.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,78 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio-video.matriska.php                             //
+// module for analyzing Matroska containers                    //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_matroska
+{
+
+	function getid3_matroska(&amp;$fd, &amp;$ThisFileInfo) {
+
+		$ThisFileInfo['fileformat'] = 'matroska';
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+
+		//$ThisFileInfo['matroska']['raw']['a'] = $this-&gt;EBML2Int(fread($fd, 4));
+
+		$ThisFileInfo['error'][] = 'Mastroka parsing not enabled in this version of getID3()';
+		return false;
+
+	}
+
+
+	function EBML2Int($EBMLstring) {
+		// <A HREF="http://matroska.org/specs/">http://matroska.org/specs/</A>
+
+		// Element ID coded with an UTF-8 like system:
+		// 1xxx xxxx                                  - Class A IDs (2^7 -2 possible values) (base 0x8X)
+		// 01xx xxxx  xxxx xxxx                       - Class B IDs (2^14-2 possible values) (base 0x4X 0xXX)
+		// 001x xxxx  xxxx xxxx  xxxx xxxx            - Class C IDs (2^21-2 possible values) (base 0x2X 0xXX 0xXX)
+		// 0001 xxxx  xxxx xxxx  xxxx xxxx  xxxx xxxx - Class D IDs (2^28-2 possible values) (base 0x1X 0xXX 0xXX 0xXX)
+		// Values with all x at 0 and 1 are reserved (hence the -2).
+
+		// Data size, in octets, is also coded with an UTF-8 like system :
+		// 1xxx xxxx                                                                              - value 0 to  2^7-2
+		// 01xx xxxx  xxxx xxxx                                                                   - value 0 to 2^14-2
+		// 001x xxxx  xxxx xxxx  xxxx xxxx                                                        - value 0 to 2^21-2
+		// 0001 xxxx  xxxx xxxx  xxxx xxxx  xxxx xxxx                                             - value 0 to 2^28-2
+		// 0000 1xxx  xxxx xxxx  xxxx xxxx  xxxx xxxx  xxxx xxxx                                  - value 0 to 2^35-2
+		// 0000 01xx  xxxx xxxx  xxxx xxxx  xxxx xxxx  xxxx xxxx  xxxx xxxx                       - value 0 to 2^42-2
+		// 0000 001x  xxxx xxxx  xxxx xxxx  xxxx xxxx  xxxx xxxx  xxxx xxxx  xxxx xxxx            - value 0 to 2^49-2
+		// 0000 0001  xxxx xxxx  xxxx xxxx  xxxx xxxx  xxxx xxxx  xxxx xxxx  xxxx xxxx  xxxx xxxx - value 0 to 2^56-2
+
+		if (0x80 &amp; ord($EBMLstring{0})) {
+			$EBMLstring{0} = chr(ord($EBMLstring{0}) &amp; 0x7F);
+		} elseif (0x40 &amp; ord($EBMLstring{0})) {
+			$EBMLstring{0} = chr(ord($EBMLstring{0}) &amp; 0x3F);
+		} elseif (0x20 &amp; ord($EBMLstring{0})) {
+			$EBMLstring{0} = chr(ord($EBMLstring{0}) &amp; 0x1F);
+		} elseif (0x10 &amp; ord($EBMLstring{0})) {
+			$EBMLstring{0} = chr(ord($EBMLstring{0}) &amp; 0x0F);
+		} elseif (0x08 &amp; ord($EBMLstring{0})) {
+			$EBMLstring{0} = chr(ord($EBMLstring{0}) &amp; 0x07);
+		} elseif (0x04 &amp; ord($EBMLstring{0})) {
+			$EBMLstring{0} = chr(ord($EBMLstring{0}) &amp; 0x03);
+		} elseif (0x02 &amp; ord($EBMLstring{0})) {
+			$EBMLstring{0} = chr(ord($EBMLstring{0}) &amp; 0x01);
+		} elseif (0x01 &amp; ord($EBMLstring{0})) {
+			$EBMLstring{0} = chr(ord($EBMLstring{0}) &amp; 0x00);
+		} else {
+			return false;
+		}
+		return getid3_lib::BigEndian2Int($EBMLstring);
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio-video.matroska.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio-video.mpeg.php
===================================================================
--- trunk/inc/external/getid3/module.audio-video.mpeg.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio-video.mpeg.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,292 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio-video.mpeg.php                                 //
+// module for analyzing MPEG files                             //
+// dependencies: module.audio.mp3.php                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio.mp3.php', __FILE__, true);
+
+define('GETID3_MPEG_VIDEO_PICTURE_START',   &quot;\x00\x00\x01\x00&quot;);
+define('GETID3_MPEG_VIDEO_USER_DATA_START', &quot;\x00\x00\x01\xB2&quot;);
+define('GETID3_MPEG_VIDEO_SEQUENCE_HEADER', &quot;\x00\x00\x01\xB3&quot;);
+define('GETID3_MPEG_VIDEO_SEQUENCE_ERROR',  &quot;\x00\x00\x01\xB4&quot;);
+define('GETID3_MPEG_VIDEO_EXTENSION_START', &quot;\x00\x00\x01\xB5&quot;);
+define('GETID3_MPEG_VIDEO_SEQUENCE_END',    &quot;\x00\x00\x01\xB7&quot;);
+define('GETID3_MPEG_VIDEO_GROUP_START',     &quot;\x00\x00\x01\xB8&quot;);
+define('GETID3_MPEG_AUDIO_START',           &quot;\x00\x00\x01\xC0&quot;);
+
+
+class getid3_mpeg
+{
+
+	function getid3_mpeg(&amp;$fd, &amp;$ThisFileInfo) {
+		if ($ThisFileInfo['avdataend'] &lt;= $ThisFileInfo['avdataoffset']) {
+			$ThisFileInfo['error'][] = '&quot;avdataend&quot; ('.$ThisFileInfo['avdataend'].') is unexpectedly less-than-or-equal-to &quot;avdataoffset&quot; ('.$ThisFileInfo['avdataoffset'].')';
+			return false;
+		}
+		$ThisFileInfo['fileformat'] = 'mpeg';
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$MPEGstreamData       = fread($fd, min(100000, $ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']));
+		$MPEGstreamDataLength = strlen($MPEGstreamData);
+
+		$foundVideo = true;
+		$VideoChunkOffset = 0;
+		while (substr($MPEGstreamData, $VideoChunkOffset++, 4) !== GETID3_MPEG_VIDEO_SEQUENCE_HEADER) {
+			if ($VideoChunkOffset &gt;= $MPEGstreamDataLength) {
+				$foundVideo = false;
+				break;
+			}
+		}
+		if ($foundVideo) {
+
+			// Start code                       32 bits
+			// horizontal frame size            12 bits
+			// vertical frame size              12 bits
+			// pixel aspect ratio                4 bits
+			// frame rate                        4 bits
+			// bitrate                          18 bits
+			// marker bit                        1 bit
+			// VBV buffer size                  10 bits
+			// constrained parameter flag        1 bit
+			// intra quant. matrix flag          1 bit
+			// intra quant. matrix values      512 bits (present if matrix flag == 1)
+			// non-intra quant. matrix flag      1 bit
+			// non-intra quant. matrix values  512 bits (present if matrix flag == 1)
+
+			$ThisFileInfo['video']['dataformat'] = 'mpeg';
+
+			$VideoChunkOffset += (strlen(GETID3_MPEG_VIDEO_SEQUENCE_HEADER) - 1);
+
+			$FrameSizeDWORD = getid3_lib::BigEndian2Int(substr($MPEGstreamData, $VideoChunkOffset, 3));
+			$VideoChunkOffset += 3;
+
+			$AspectRatioFrameRateDWORD = getid3_lib::BigEndian2Int(substr($MPEGstreamData, $VideoChunkOffset, 1));
+			$VideoChunkOffset += 1;
+
+			$assortedinformation = getid3_lib::BigEndian2Bin(substr($MPEGstreamData, $VideoChunkOffset, 4));
+			$VideoChunkOffset += 4;
+
+			$ThisFileInfo['mpeg']['video']['raw']['framesize_horizontal'] = ($FrameSizeDWORD &amp; 0xFFF000) &gt;&gt; 12; // 12 bits for horizontal frame size
+			$ThisFileInfo['mpeg']['video']['raw']['framesize_vertical']   = ($FrameSizeDWORD &amp; 0x000FFF);       // 12 bits for vertical frame size
+			$ThisFileInfo['mpeg']['video']['raw']['pixel_aspect_ratio']   = ($AspectRatioFrameRateDWORD &amp; 0xF0) &gt;&gt; 4;
+			$ThisFileInfo['mpeg']['video']['raw']['frame_rate']           = ($AspectRatioFrameRateDWORD &amp; 0x0F);
+
+			$ThisFileInfo['mpeg']['video']['framesize_horizontal'] = $ThisFileInfo['mpeg']['video']['raw']['framesize_horizontal'];
+			$ThisFileInfo['mpeg']['video']['framesize_vertical']   = $ThisFileInfo['mpeg']['video']['raw']['framesize_vertical'];
+
+			$ThisFileInfo['mpeg']['video']['pixel_aspect_ratio']      = $this-&gt;MPEGvideoAspectRatioLookup($ThisFileInfo['mpeg']['video']['raw']['pixel_aspect_ratio']);
+			$ThisFileInfo['mpeg']['video']['pixel_aspect_ratio_text'] = $this-&gt;MPEGvideoAspectRatioTextLookup($ThisFileInfo['mpeg']['video']['raw']['pixel_aspect_ratio']);
+			$ThisFileInfo['mpeg']['video']['frame_rate']              = $this-&gt;MPEGvideoFramerateLookup($ThisFileInfo['mpeg']['video']['raw']['frame_rate']);
+
+			$ThisFileInfo['mpeg']['video']['raw']['bitrate']                =        getid3_lib::Bin2Dec(substr($assortedinformation,  0, 18));
+			$ThisFileInfo['mpeg']['video']['raw']['marker_bit']             = (bool) getid3_lib::Bin2Dec(substr($assortedinformation, 18,  1));
+			$ThisFileInfo['mpeg']['video']['raw']['vbv_buffer_size']        =        getid3_lib::Bin2Dec(substr($assortedinformation, 19, 10));
+			$ThisFileInfo['mpeg']['video']['raw']['constrained_param_flag'] = (bool) getid3_lib::Bin2Dec(substr($assortedinformation, 29,  1));
+			$ThisFileInfo['mpeg']['video']['raw']['intra_quant_flag']       = (bool) getid3_lib::Bin2Dec(substr($assortedinformation, 30,  1));
+			if ($ThisFileInfo['mpeg']['video']['raw']['intra_quant_flag']) {
+
+				// read 512 bits
+				$ThisFileInfo['mpeg']['video']['raw']['intra_quant']          = getid3_lib::BigEndian2Bin(substr($MPEGstreamData, $VideoChunkOffset, 64));
+				$VideoChunkOffset += 64;
+
+				$ThisFileInfo['mpeg']['video']['raw']['non_intra_quant_flag'] = (bool) getid3_lib::Bin2Dec(substr($ThisFileInfo['mpeg']['video']['raw']['intra_quant'], 511,  1));
+				$ThisFileInfo['mpeg']['video']['raw']['intra_quant']          =        getid3_lib::Bin2Dec(substr($assortedinformation, 31,  1)).substr(getid3_lib::BigEndian2Bin(substr($MPEGstreamData, $VideoChunkOffset, 64)), 0, 511);
+
+				if ($ThisFileInfo['mpeg']['video']['raw']['non_intra_quant_flag']) {
+					$ThisFileInfo['mpeg']['video']['raw']['non_intra_quant'] = substr($MPEGstreamData, $VideoChunkOffset, 64);
+					$VideoChunkOffset += 64;
+				}
+
+			} else {
+
+				$ThisFileInfo['mpeg']['video']['raw']['non_intra_quant_flag'] = (bool) getid3_lib::Bin2Dec(substr($assortedinformation, 31,  1));
+				if ($ThisFileInfo['mpeg']['video']['raw']['non_intra_quant_flag']) {
+					$ThisFileInfo['mpeg']['video']['raw']['non_intra_quant'] = substr($MPEGstreamData, $VideoChunkOffset, 64);
+					$VideoChunkOffset += 64;
+				}
+
+			}
+
+			if ($ThisFileInfo['mpeg']['video']['raw']['bitrate'] == 0x3FFFF) { // 18 set bits
+
+				$ThisFileInfo['warning'][] = 'This version of getID3() ['.GETID3_VERSION.'] cannot determine average bitrate of VBR MPEG video files';
+				$ThisFileInfo['mpeg']['video']['bitrate_mode'] = 'vbr';
+
+			} else {
+
+				$ThisFileInfo['mpeg']['video']['bitrate']      = $ThisFileInfo['mpeg']['video']['raw']['bitrate'] * 400;
+				$ThisFileInfo['mpeg']['video']['bitrate_mode'] = 'cbr';
+				$ThisFileInfo['video']['bitrate']              = $ThisFileInfo['mpeg']['video']['bitrate'];
+
+			}
+
+			$ThisFileInfo['video']['resolution_x']       = $ThisFileInfo['mpeg']['video']['framesize_horizontal'];
+			$ThisFileInfo['video']['resolution_y']       = $ThisFileInfo['mpeg']['video']['framesize_vertical'];
+			$ThisFileInfo['video']['frame_rate']         = $ThisFileInfo['mpeg']['video']['frame_rate'];
+			$ThisFileInfo['video']['bitrate_mode']       = $ThisFileInfo['mpeg']['video']['bitrate_mode'];
+			$ThisFileInfo['video']['pixel_aspect_ratio'] = $ThisFileInfo['mpeg']['video']['pixel_aspect_ratio'];
+			$ThisFileInfo['video']['lossless']           = false;
+			$ThisFileInfo['video']['bits_per_sample']    = 24;
+
+		} else {
+
+			$ThisFileInfo['error'][] = 'Could not find start of video block in the first 100,000 bytes (or before end of file) - this might not be an MPEG-video file?';
+
+		}
+
+		//0x000001B3 begins the sequence_header of every MPEG video stream.
+		//But in MPEG-2, this header must immediately be followed by an
+		//extension_start_code (0x000001B5) with a sequence_extension ID (1).
+		//(This extension contains all the additional MPEG-2 stuff.)
+		//MPEG-1 doesn't have this extension, so that's a sure way to tell the
+		//difference between MPEG-1 and MPEG-2 video streams.
+
+		if (substr($MPEGstreamData, $VideoChunkOffset, 4) == GETID3_MPEG_VIDEO_EXTENSION_START) {
+			$ThisFileInfo['video']['codec'] = 'MPEG-2';
+		} else {
+			$ThisFileInfo['video']['codec'] = 'MPEG-1';
+		}
+
+
+		$AudioChunkOffset = 0;
+		while (true) {
+			while (substr($MPEGstreamData, $AudioChunkOffset++, 4) !== GETID3_MPEG_AUDIO_START) {
+				if ($AudioChunkOffset &gt;= $MPEGstreamDataLength) {
+					break 2;
+				}
+			}
+
+			for ($i = 0; $i &lt;= 7; $i++) {
+				// some files have the MPEG-audio header 8 bytes after the end of the $00 $00 $01 $C0 signature, some have it up to 13 bytes (or more?) after
+				// I have no idea why or what the difference is, so this is a stupid hack.
+				// If anybody has any better idea of what's going on, please let me know - <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>
+
+				$dummy = $ThisFileInfo;
+				if (getid3_mp3::decodeMPEGaudioHeader($fd, ($AudioChunkOffset + 3) + 8 + $i, $dummy, false)) {
+					$ThisFileInfo = $dummy;
+					$ThisFileInfo['audio']['bitrate_mode']    = 'cbr';
+					$ThisFileInfo['audio']['lossless']        = false;
+					break 2;
+
+				}
+			}
+		}
+
+		// Temporary hack to account for interleaving overhead:
+		if (!empty($ThisFileInfo['video']['bitrate']) &amp;&amp; !empty($ThisFileInfo['audio']['bitrate'])) {
+			$ThisFileInfo['playtime_seconds'] = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / ($ThisFileInfo['video']['bitrate'] + $ThisFileInfo['audio']['bitrate']);
+
+			// Interleaved MPEG audio/video files have a certain amount of overhead that varies
+			// by both video and audio bitrates, and not in any sensible, linear/logarithmic patter
+			// Use interpolated lookup tables to approximately guess how much is overhead, because
+			// playtime is calculated as filesize / total-bitrate
+			$ThisFileInfo['playtime_seconds'] *= $this-&gt;MPEGsystemNonOverheadPercentage($ThisFileInfo['video']['bitrate'], $ThisFileInfo['audio']['bitrate']);
+
+			//switch ($ThisFileInfo['video']['bitrate']) {
+			//	case('5000000'):
+			//		$multiplier = 0.93292642112380355828048824319889;
+			//		break;
+			//	case('5500000'):
+			//		$multiplier = 0.93582895375200989965359777343219;
+			//		break;
+			//	case('6000000'):
+			//		$multiplier = 0.93796247714820932532911373859139;
+			//		break;
+			//	case('7000000'):
+			//		$multiplier = 0.9413264083635103463010117778776;
+			//		break;
+			//	default:
+			//		$multiplier = 1;
+			//		break;
+			//}
+			//$ThisFileInfo['playtime_seconds'] *= $multiplier;
+			//$ThisFileInfo['warning'][] = 'Interleaved MPEG audio/video playtime may be inaccurate. With current hack should be within a few seconds of accurate. Report to <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A> if off by more than 10 seconds.';
+			if ($ThisFileInfo['video']['bitrate'] &lt; 50000) {
+				$ThisFileInfo['warning'][] = 'Interleaved MPEG audio/video playtime may be slightly inaccurate for video bitrates below 100kbps. Except in extreme low-bitrate situations, error should be less than 1%. Report to <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A> if greater than this.';
+			}
+		}
+
+		return true;
+	}
+
+
+	function MPEGsystemNonOverheadPercentage($VideoBitrate, $AudioBitrate) {
+		$OverheadPercentage = 0;
+
+		$AudioBitrate = max(min($AudioBitrate / 1000,   384), 32); // limit to range of 32kbps - 384kbps (should be only legal bitrates, but maybe VBR?)
+		$VideoBitrate = max(min($VideoBitrate / 1000, 10000), 10); // limit to range of 10kbps -  10Mbps (beyond that curves flatten anyways, no big loss)
+
+
+		//OMBB[audiobitrate]              = array(video-10kbps,       video-100kbps,      video-1000kbps,     video-10000kbps)
+		$OverheadMultiplierByBitrate[32]  = array(0, 0.9676287944368530, 0.9802276264360310, 0.9844916183244460, 0.9852821845179940);
+		$OverheadMultiplierByBitrate[48]  = array(0, 0.9779100089209830, 0.9787770035359320, 0.9846738664076130, 0.9852683013799960);
+		$OverheadMultiplierByBitrate[56]  = array(0, 0.9731249855367600, 0.9776624308938040, 0.9832606361852130, 0.9843922606633340);
+		$OverheadMultiplierByBitrate[64]  = array(0, 0.9755642683275760, 0.9795256705493390, 0.9836573009193170, 0.9851122539404470);
+		$OverheadMultiplierByBitrate[96]  = array(0, 0.9788025247497290, 0.9798553314148700, 0.9822956869792560, 0.9834815119124690);
+		$OverheadMultiplierByBitrate[128] = array(0, 0.9816940050925480, 0.9821675936072120, 0.9829756927470870, 0.9839763420152050);
+		$OverheadMultiplierByBitrate[160] = array(0, 0.9825894094561180, 0.9820913399073960, 0.9823907143253970, 0.9832821783651570);
+		$OverheadMultiplierByBitrate[192] = array(0, 0.9832038474336260, 0.9825731694317960, 0.9821028622712400, 0.9828262076447620);
+		$OverheadMultiplierByBitrate[224] = array(0, 0.9836516298538770, 0.9824718601823890, 0.9818302180625380, 0.9823735101626480);
+		$OverheadMultiplierByBitrate[256] = array(0, 0.9845863022094920, 0.9837229411967540, 0.9824521662210830, 0.9828645172100790);
+		$OverheadMultiplierByBitrate[320] = array(0, 0.9849565280263180, 0.9837683142805110, 0.9822885275960400, 0.9824424382727190);
+		$OverheadMultiplierByBitrate[384] = array(0, 0.9856094774357600, 0.9844573394432720, 0.9825970399837330, 0.9824673808303890);
+
+		$BitrateToUseMin = 32;
+		$BitrateToUseMax = 32;
+		$previousBitrate = 32;
+		foreach ($OverheadMultiplierByBitrate as $key =&gt; $value) {
+			if ($AudioBitrate &gt;= $previousBitrate) {
+				$BitrateToUseMin = $previousBitrate;
+			}
+			if ($AudioBitrate &lt; $key) {
+				$BitrateToUseMax = $key;
+				break;
+			}
+			$previousBitrate = $key;
+		}
+		$FactorA = ($BitrateToUseMax - $AudioBitrate) / ($BitrateToUseMax - $BitrateToUseMin);
+
+		$VideoBitrateLog10 = log10($VideoBitrate);
+		$VideoFactorMin1 = $OverheadMultiplierByBitrate[$BitrateToUseMin][floor($VideoBitrateLog10)];
+		$VideoFactorMin2 = $OverheadMultiplierByBitrate[$BitrateToUseMax][floor($VideoBitrateLog10)];
+		$VideoFactorMax1 = $OverheadMultiplierByBitrate[$BitrateToUseMin][ceil($VideoBitrateLog10)];
+		$VideoFactorMax2 = $OverheadMultiplierByBitrate[$BitrateToUseMax][ceil($VideoBitrateLog10)];
+		$FactorV = $VideoBitrateLog10 - floor($VideoBitrateLog10);
+
+		$OverheadPercentage  = $VideoFactorMin1 *      $FactorA  *      $FactorV;
+		$OverheadPercentage += $VideoFactorMin2 * (1 - $FactorA) *      $FactorV;
+		$OverheadPercentage += $VideoFactorMax1 *      $FactorA  * (1 - $FactorV);
+		$OverheadPercentage += $VideoFactorMax2 * (1 - $FactorA) * (1 - $FactorV);
+
+		return $OverheadPercentage;
+	}
+
+
+	function MPEGvideoFramerateLookup($rawframerate) {
+		$MPEGvideoFramerateLookup = array(0, 23.976, 24, 25, 29.97, 30, 50, 59.94, 60);
+		return (isset($MPEGvideoFramerateLookup[$rawframerate]) ? (float) $MPEGvideoFramerateLookup[$rawframerate] : (float) 0);
+	}
+
+	function MPEGvideoAspectRatioLookup($rawaspectratio) {
+		$MPEGvideoAspectRatioLookup = array(0, 1, 0.6735, 0.7031, 0.7615, 0.8055, 0.8437, 0.8935, 0.9157, 0.9815, 1.0255, 1.0695, 1.0950, 1.1575, 1.2015, 0);
+		return (isset($MPEGvideoAspectRatioLookup[$rawaspectratio]) ? (float) $MPEGvideoAspectRatioLookup[$rawaspectratio] : (float) 0);
+	}
+
+	function MPEGvideoAspectRatioTextLookup($rawaspectratio) {
+		$MPEGvideoAspectRatioTextLookup = array('forbidden', 'square pixels', '0.6735', '16:9, 625 line, PAL', '0.7615', '0.8055', '16:9, 525 line, NTSC', '0.8935', '4:3, 625 line, PAL, CCIR601', '0.9815', '1.0255', '1.0695', '4:3, 525 line, NTSC, CCIR601', '1.1575', '1.2015', 'reserved');
+		return (isset($MPEGvideoAspectRatioTextLookup[$rawaspectratio]) ? $MPEGvideoAspectRatioTextLookup[$rawaspectratio] : '');
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio-video.mpeg.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio-video.nsv.php
===================================================================
--- trunk/inc/external/getid3/module.audio-video.nsv.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio-video.nsv.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,224 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.nsv.php                                        //
+// module for analyzing Nullsoft NSV files                     //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_nsv
+{
+
+	function getid3_nsv(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$NSVheader = fread($fd, 4);
+
+		switch ($NSVheader) {
+			case 'NSVs':
+				if ($this-&gt;getNSVsHeaderFilepointer($fd, $ThisFileInfo, 0)) {
+					$ThisFileInfo['fileformat']          = 'nsv';
+					$ThisFileInfo['audio']['dataformat'] = 'nsv';
+					$ThisFileInfo['video']['dataformat'] = 'nsv';
+					$ThisFileInfo['audio']['lossless']   = false;
+					$ThisFileInfo['video']['lossless']   = false;
+				}
+				break;
+
+			case 'NSVf':
+				if ($this-&gt;getNSVfHeaderFilepointer($fd, $ThisFileInfo, 0)) {
+					$ThisFileInfo['fileformat']          = 'nsv';
+					$ThisFileInfo['audio']['dataformat'] = 'nsv';
+					$ThisFileInfo['video']['dataformat'] = 'nsv';
+					$ThisFileInfo['audio']['lossless']   = false;
+					$ThisFileInfo['video']['lossless']   = false;
+					$this-&gt;getNSVsHeaderFilepointer($fd, $ThisFileInfo, $ThisFileInfo['nsv']['NSVf']['header_length']);
+				}
+				break;
+
+			default:
+				$ThisFileInfo['error'][] = 'Expecting &quot;NSVs&quot; or &quot;NSVf&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.$NSVheader.'&quot;';
+				return false;
+				break;
+		}
+
+		if (!isset($ThisFileInfo['nsv']['NSVf'])) {
+			$ThisFileInfo['warning'][] = 'NSVf header not present - cannot calculate playtime or bitrate';
+		}
+
+		return true;
+	}
+
+	function getNSVsHeaderFilepointer(&amp;$fd, &amp;$ThisFileInfo, $fileoffset) {
+		fseek($fd, $fileoffset, SEEK_SET);
+		$NSVsheader = fread($fd, 28);
+		$offset = 0;
+
+		$ThisFileInfo['nsv']['NSVs']['identifier']      =                  substr($NSVsheader, $offset, 4);
+		$offset += 4;
+
+		if ($ThisFileInfo['nsv']['NSVs']['identifier'] != 'NSVs') {
+			$ThisFileInfo['error'][] = 'expected &quot;NSVs&quot; at offset ('.$fileoffset.'), found &quot;'.$ThisFileInfo['nsv']['NSVs']['identifier'].'&quot; instead';
+			unset($ThisFileInfo['nsv']['NSVs']);
+			return false;
+		}
+
+		$ThisFileInfo['nsv']['NSVs']['offset']          = $fileoffset;
+
+		$ThisFileInfo['nsv']['NSVs']['video_codec']     =                              substr($NSVsheader, $offset, 4);
+		$offset += 4;
+		$ThisFileInfo['nsv']['NSVs']['audio_codec']     =                              substr($NSVsheader, $offset, 4);
+		$offset += 4;
+		$ThisFileInfo['nsv']['NSVs']['resolution_x']    = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 2));
+		$offset += 2;
+		$ThisFileInfo['nsv']['NSVs']['resolution_y']    = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 2));
+		$offset += 2;
+
+		$ThisFileInfo['nsv']['NSVs']['framerate_index'] = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 1));
+		$offset += 1;
+		//$ThisFileInfo['nsv']['NSVs']['unknown1b']       = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 1));
+		$offset += 1;
+		//$ThisFileInfo['nsv']['NSVs']['unknown1c']       = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 1));
+		$offset += 1;
+		//$ThisFileInfo['nsv']['NSVs']['unknown1d']       = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 1));
+		$offset += 1;
+		//$ThisFileInfo['nsv']['NSVs']['unknown2a']       = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 1));
+		$offset += 1;
+		//$ThisFileInfo['nsv']['NSVs']['unknown2b']       = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 1));
+		$offset += 1;
+		//$ThisFileInfo['nsv']['NSVs']['unknown2c']       = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 1));
+		$offset += 1;
+		//$ThisFileInfo['nsv']['NSVs']['unknown2d']       = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 1));
+		$offset += 1;
+
+		switch ($ThisFileInfo['nsv']['NSVs']['audio_codec']) {
+			case 'PCM ':
+				$ThisFileInfo['nsv']['NSVs']['bits_channel'] = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 1));
+				$offset += 1;
+				$ThisFileInfo['nsv']['NSVs']['channels']     = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 1));
+				$offset += 1;
+				$ThisFileInfo['nsv']['NSVs']['sample_rate']  = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 2));
+				$offset += 2;
+
+				$ThisFileInfo['audio']['sample_rate']        = $ThisFileInfo['nsv']['NSVs']['sample_rate'];
+				break;
+
+			case 'MP3 ':
+			case 'NONE':
+			default:
+				//$ThisFileInfo['nsv']['NSVs']['unknown3']     = getid3_lib::LittleEndian2Int(substr($NSVsheader, $offset, 4));
+				$offset += 4;
+				break;
+		}
+
+		$ThisFileInfo['video']['resolution_x']       = $ThisFileInfo['nsv']['NSVs']['resolution_x'];
+		$ThisFileInfo['video']['resolution_y']       = $ThisFileInfo['nsv']['NSVs']['resolution_y'];
+		$ThisFileInfo['nsv']['NSVs']['frame_rate']   = $this-&gt;NSVframerateLookup($ThisFileInfo['nsv']['NSVs']['framerate_index']);
+		$ThisFileInfo['video']['frame_rate']         = $ThisFileInfo['nsv']['NSVs']['frame_rate'];
+		$ThisFileInfo['video']['bits_per_sample']    = 24;
+		$ThisFileInfo['video']['pixel_aspect_ratio'] = (float) 1;
+
+		return true;
+	}
+
+	function getNSVfHeaderFilepointer(&amp;$fd, &amp;$ThisFileInfo, $fileoffset, $getTOCoffsets=false) {
+		fseek($fd, $fileoffset, SEEK_SET);
+		$NSVfheader = fread($fd, 28);
+		$offset = 0;
+
+		$ThisFileInfo['nsv']['NSVf']['identifier']    =                  substr($NSVfheader, $offset, 4);
+		$offset += 4;
+
+		if ($ThisFileInfo['nsv']['NSVf']['identifier'] != 'NSVf') {
+			$ThisFileInfo['error'][] = 'expected &quot;NSVf&quot; at offset ('.$fileoffset.'), found &quot;'.$ThisFileInfo['nsv']['NSVf']['identifier'].'&quot; instead';
+			unset($ThisFileInfo['nsv']['NSVf']);
+			return false;
+		}
+
+		$ThisFileInfo['nsv']['NSVs']['offset']        = $fileoffset;
+
+		$ThisFileInfo['nsv']['NSVf']['header_length'] = getid3_lib::LittleEndian2Int(substr($NSVfheader, $offset, 4));
+		$offset += 4;
+		$ThisFileInfo['nsv']['NSVf']['file_size']     = getid3_lib::LittleEndian2Int(substr($NSVfheader, $offset, 4));
+		$offset += 4;
+
+		if ($ThisFileInfo['nsv']['NSVf']['file_size'] &gt; $ThisFileInfo['avdataend']) {
+			$ThisFileInfo['warning'][] = 'truncated file - NSVf header indicates '.$ThisFileInfo['nsv']['NSVf']['file_size'].' bytes, file actually '.$ThisFileInfo['avdataend'].' bytes';
+		}
+
+		$ThisFileInfo['nsv']['NSVf']['playtime_ms']   = getid3_lib::LittleEndian2Int(substr($NSVfheader, $offset, 4));
+		$offset += 4;
+		$ThisFileInfo['nsv']['NSVf']['meta_size']     = getid3_lib::LittleEndian2Int(substr($NSVfheader, $offset, 4));
+		$offset += 4;
+		$ThisFileInfo['nsv']['NSVf']['TOC_entries_1'] = getid3_lib::LittleEndian2Int(substr($NSVfheader, $offset, 4));
+		$offset += 4;
+		$ThisFileInfo['nsv']['NSVf']['TOC_entries_2'] = getid3_lib::LittleEndian2Int(substr($NSVfheader, $offset, 4));
+		$offset += 4;
+
+		if ($ThisFileInfo['nsv']['NSVf']['playtime_ms'] == 0) {
+			$ThisFileInfo['error'][] = 'Corrupt NSV file: NSVf.playtime_ms == zero';
+			return false;
+		}
+
+		$NSVfheader .= fread($fd, $ThisFileInfo['nsv']['NSVf']['meta_size'] + (4 * $ThisFileInfo['nsv']['NSVf']['TOC_entries_1']) + (4 * $ThisFileInfo['nsv']['NSVf']['TOC_entries_2']));
+		$NSVfheaderlength = strlen($NSVfheader);
+		$ThisFileInfo['nsv']['NSVf']['metadata']      =                  substr($NSVfheader, $offset, $ThisFileInfo['nsv']['NSVf']['meta_size']);
+		$offset += $ThisFileInfo['nsv']['NSVf']['meta_size'];
+
+		if ($getTOCoffsets) {
+			$TOCcounter = 0;
+			while ($TOCcounter &lt; $ThisFileInfo['nsv']['NSVf']['TOC_entries_1']) {
+				if ($TOCcounter &lt; $ThisFileInfo['nsv']['NSVf']['TOC_entries_1']) {
+					$ThisFileInfo['nsv']['NSVf']['TOC_1'][$TOCcounter] = getid3_lib::LittleEndian2Int(substr($NSVfheader, $offset, 4));
+					$offset += 4;
+					$TOCcounter++;
+				}
+			}
+		}
+
+		if (trim($ThisFileInfo['nsv']['NSVf']['metadata']) != '') {
+			$ThisFileInfo['nsv']['NSVf']['metadata'] = str_replace('`', &quot;\x01&quot;, $ThisFileInfo['nsv']['NSVf']['metadata']);
+			$CommentPairArray = explode(&quot;\x01&quot;.' ', $ThisFileInfo['nsv']['NSVf']['metadata']);
+			foreach ($CommentPairArray as $CommentPair) {
+				if (strstr($CommentPair, '='.&quot;\x01&quot;)) {
+					list($key, $value) = explode('='.&quot;\x01&quot;, $CommentPair, 2);
+					$ThisFileInfo['nsv']['comments'][strtolower($key)][] = trim(str_replace(&quot;\x01&quot;, '', $value));
+				}
+			}
+		}
+
+		$ThisFileInfo['playtime_seconds'] = $ThisFileInfo['nsv']['NSVf']['playtime_ms'] / 1000;
+		$ThisFileInfo['bitrate']          = ($ThisFileInfo['nsv']['NSVf']['file_size'] * 8) / $ThisFileInfo['playtime_seconds'];
+
+		return true;
+	}
+
+
+	function NSVframerateLookup($framerateindex) {
+		if ($framerateindex &lt;= 127) {
+			return (float) $framerateindex;
+		}
+
+		static $NSVframerateLookup = array();
+		if (empty($NSVframerateLookup)) {
+			$NSVframerateLookup[129] = (float) 29.970;
+			$NSVframerateLookup[131] = (float) 23.976;
+			$NSVframerateLookup[133] = (float) 14.985;
+			$NSVframerateLookup[197] = (float) 59.940;
+			$NSVframerateLookup[199] = (float) 47.952;
+		}
+		return (isset($NSVframerateLookup[$framerateindex]) ? $NSVframerateLookup[$framerateindex] : false);
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio-video.nsv.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio-video.quicktime.php
===================================================================
--- trunk/inc/external/getid3/module.audio-video.quicktime.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio-video.quicktime.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,1292 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio-video.quicktime.php                            //
+// module for analyzing Quicktime and MP3-in-MP4 files         //
+// dependencies: module.audio.mp3.php                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio.mp3.php', __FILE__, true);
+
+class getid3_quicktime
+{
+
+	function getid3_quicktime(&amp;$fd, &amp;$ThisFileInfo, $ReturnAtomData=true, $ParseAllPossibleAtoms=false) {
+
+		$ThisFileInfo['fileformat'] = 'quicktime';
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+
+		$offset      = 0;
+		$atomcounter = 0;
+
+		while ($offset &lt; $ThisFileInfo['avdataend']) {
+			fseek($fd, $offset, SEEK_SET);
+			$AtomHeader = fread($fd, 8);
+
+			$atomsize = getid3_lib::BigEndian2Int(substr($AtomHeader, 0, 4));
+			$atomname =               substr($AtomHeader, 4, 4);
+			$ThisFileInfo['quicktime'][$atomname]['name']   = $atomname;
+			$ThisFileInfo['quicktime'][$atomname]['size']   = $atomsize;
+			$ThisFileInfo['quicktime'][$atomname]['offset'] = $offset;
+
+			if (($offset + $atomsize) &gt; $ThisFileInfo['avdataend']) {
+				$ThisFileInfo['error'][] = 'Atom at offset '.$offset.' claims to go beyond end-of-file (length: '.$atomsize.' bytes)';
+				return false;
+			}
+
+			if ($atomsize == 0) {
+				// Furthermore, for historical reasons the list of atoms is optionally
+				// terminated by a 32-bit integer set to 0. If you are writing a program
+				// to read user data atoms, you should allow for the terminating 0.
+				break;
+			}
+			switch ($atomname) {
+				case 'mdat': // Media DATa atom
+					// 'mdat' contains the actual data for the audio/video
+					if (($atomsize &gt; 8) &amp;&amp; (!isset($ThisFileInfo['avdataend_tmp']) || ($ThisFileInfo['quicktime'][$atomname]['size'] &gt; ($ThisFileInfo['avdataend_tmp'] - $ThisFileInfo['avdataoffset'])))) {
+
+						$ThisFileInfo['avdataoffset'] = $ThisFileInfo['quicktime'][$atomname]['offset'] + 8;
+						$OldAVDataEnd                 = $ThisFileInfo['avdataend'];
+						$ThisFileInfo['avdataend']    = $ThisFileInfo['quicktime'][$atomname]['offset'] + $ThisFileInfo['quicktime'][$atomname]['size'];
+
+						if (getid3_mp3::MPEGaudioHeaderValid(getid3_mp3::MPEGaudioHeaderDecode(fread($fd, 4)))) {
+							getid3_mp3::getOnlyMPEGaudioInfo($fd, $ThisFileInfo, $ThisFileInfo['avdataoffset'], false);
+							if (isset($ThisFileInfo['mpeg']['audio'])) {
+								$ThisFileInfo['audio']['dataformat']   = 'mp3';
+								$ThisFileInfo['audio']['codec']        = (!empty($ThisFileInfo['mpeg']['audio']['encoder']) ? $ThisFileInfo['mpeg']['audio']['encoder'] : (!empty($ThisFileInfo['mpeg']['audio']['codec']) ? $ThisFileInfo['mpeg']['audio']['codec'] : (!empty($ThisFileInfo['mpeg']['audio']['LAME']) ? 'LAME' :'mp3')));
+								$ThisFileInfo['audio']['sample_rate']  = $ThisFileInfo['mpeg']['audio']['sample_rate'];
+								$ThisFileInfo['audio']['channels']     = $ThisFileInfo['mpeg']['audio']['channels'];
+								$ThisFileInfo['audio']['bitrate']      = $ThisFileInfo['mpeg']['audio']['bitrate'];
+								$ThisFileInfo['audio']['bitrate_mode'] = strtolower($ThisFileInfo['mpeg']['audio']['bitrate_mode']);
+								$ThisFileInfo['bitrate']               = $ThisFileInfo['audio']['bitrate'];
+							}
+						}
+						$ThisFileInfo['avdataend'] = $OldAVDataEnd;
+						unset($OldAVDataEnd);
+
+					}
+					break;
+
+				case 'free': // FREE space atom
+				case 'skip': // SKIP atom
+				case 'wide': // 64-bit expansion placeholder atom
+					// 'free', 'skip' and 'wide' are just padding, contains no useful data at all
+					break;
+
+				default:
+					$atomHierarchy = array();
+					$ThisFileInfo['quicktime'][$atomname] = $this-&gt;QuicktimeParseAtom($atomname, $atomsize, fread($fd, $atomsize), $ThisFileInfo, $offset, $atomHierarchy, $ParseAllPossibleAtoms);
+					break;
+			}
+
+			$offset += $atomsize;
+			$atomcounter++;
+		}
+
+		if (!empty($ThisFileInfo['avdataend_tmp'])) {
+			// this value is assigned to a temp value and then erased because
+			// otherwise any atoms beyond the 'mdat' atom would not get parsed
+			$ThisFileInfo['avdataend'] = $ThisFileInfo['avdataend_tmp'];
+			unset($ThisFileInfo['avdataend_tmp']);
+		}
+
+		if (!isset($ThisFileInfo['bitrate']) &amp;&amp; isset($ThisFileInfo['playtime_seconds'])) {
+			$ThisFileInfo['bitrate'] = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['playtime_seconds'];
+		}
+		if (isset($ThisFileInfo['bitrate']) &amp;&amp; !isset($ThisFileInfo['audio']['bitrate']) &amp;&amp; !isset($ThisFileInfo['quicktime']['video'])) {
+			$ThisFileInfo['audio']['bitrate'] = $ThisFileInfo['bitrate'];
+		}
+
+		if (($ThisFileInfo['audio']['dataformat'] == 'mp4') &amp;&amp; empty($ThisFileInfo['video']['resolution_x'])) {
+			$ThisFileInfo['fileformat'] = 'mp4';
+			$ThisFileInfo['mime_type']  = 'audio/mp4';
+			unset($ThisFileInfo['video']['dataformat']);
+		}
+
+		if (!$ReturnAtomData) {
+			unset($ThisFileInfo['quicktime']['moov']);
+		}
+
+		if (empty($ThisFileInfo['audio']['dataformat']) &amp;&amp; !empty($ThisFileInfo['quicktime']['audio'])) {
+			$ThisFileInfo['audio']['dataformat'] = 'quicktime';
+		}
+		if (empty($ThisFileInfo['video']['dataformat']) &amp;&amp; !empty($ThisFileInfo['quicktime']['video'])) {
+			$ThisFileInfo['video']['dataformat'] = 'quicktime';
+		}
+
+		return true;
+	}
+
+	function QuicktimeParseAtom($atomname, $atomsize, $atomdata, &amp;$ThisFileInfo, $baseoffset, &amp;$atomHierarchy, $ParseAllPossibleAtoms) {
+		// <A HREF="http://developer.apple.com/techpubs/quicktime/qtdevdocs/APIREF/INDEX/atomalphaindex.htm">http://developer.apple.com/techpubs/quicktime/qtdevdocs/APIREF/INDEX/atomalphaindex.htm</A>
+
+		array_push($atomHierarchy, $atomname);
+		$atomstructure['hierarchy'] = implode(' ', $atomHierarchy);
+		$atomstructure['name']      = $atomname;
+		$atomstructure['size']      = $atomsize;
+		$atomstructure['offset']    = $baseoffset;
+
+		switch ($atomname) {
+			case 'moov': // MOVie container atom
+			case 'trak': // TRAcK container atom
+			case 'clip': // CLIPping container atom
+			case 'matt': // track MATTe container atom
+			case 'edts': // EDiTS container atom
+			case 'tref': // Track REFerence container atom
+			case 'mdia': // MeDIA container atom
+			case 'minf': // Media INFormation container atom
+			case 'dinf': // Data INFormation container atom
+			case 'udta': // User DaTA container atom
+			case 'stbl': // Sample TaBLe container atom
+			case 'cmov': // Compressed MOVie container atom
+			case 'rmra': // Reference Movie Record Atom
+			case 'rmda': // Reference Movie Descriptor Atom
+			case 'gmhd': // Generic Media info HeaDer atom (seen on QTVR)
+				$atomstructure['subatoms'] = $this-&gt;QuicktimeParseContainerAtom($atomdata, $ThisFileInfo, $baseoffset + 8, $atomHierarchy, $ParseAllPossibleAtoms);
+				break;
+
+
+			case '&#169;cpy':
+			case '&#169;day':
+			case '&#169;dir':
+			case '&#169;ed1':
+			case '&#169;ed2':
+			case '&#169;ed3':
+			case '&#169;ed4':
+			case '&#169;ed5':
+			case '&#169;ed6':
+			case '&#169;ed7':
+			case '&#169;ed8':
+			case '&#169;ed9':
+			case '&#169;fmt':
+			case '&#169;inf':
+			case '&#169;prd':
+			case '&#169;prf':
+			case '&#169;req':
+			case '&#169;src':
+			case '&#169;wrt':
+			case '&#169;nam':
+			case '&#169;cmt':
+			case '&#169;wrn':
+			case '&#169;hst':
+			case '&#169;mak':
+			case '&#169;mod':
+			case '&#169;PRD':
+			case '&#169;swr':
+			case '&#169;aut':
+			case '&#169;ART':
+			case '&#169;trk':
+			case '&#169;alb':
+			case '&#169;com':
+			case '&#169;gen':
+			case '&#169;ope':
+			case '&#169;url':
+			case '&#169;enc':
+				$atomstructure['data_length'] = getid3_lib::BigEndian2Int(substr($atomdata,  0, 2));
+				$atomstructure['language_id'] = getid3_lib::BigEndian2Int(substr($atomdata,  2, 2));
+				$atomstructure['data']        =                           substr($atomdata,  4);
+
+				$atomstructure['language']    = $this-&gt;QuicktimeLanguageLookup($atomstructure['language_id']);
+				if (empty($ThisFileInfo['comments']['language']) || (!in_array($atomstructure['language'], $ThisFileInfo['comments']['language']))) {
+					$ThisFileInfo['comments']['language'][] = $atomstructure['language'];
+				}
+				$this-&gt;CopyToAppropriateCommentsSection($atomname, $atomstructure['data'], $ThisFileInfo);
+				break;
+
+
+			case 'play': // auto-PLAY atom
+				$atomstructure['autoplay']             = (bool) getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+
+				$ThisFileInfo['quicktime']['autoplay'] = $atomstructure['autoplay'];
+				break;
+
+
+			case 'WLOC': // Window LOCation atom
+				$atomstructure['location_x']  = getid3_lib::BigEndian2Int(substr($atomdata,  0, 2));
+				$atomstructure['location_y']  = getid3_lib::BigEndian2Int(substr($atomdata,  2, 2));
+				break;
+
+
+			case 'LOOP': // LOOPing atom
+			case 'SelO': // play SELection Only atom
+			case 'AllF': // play ALL Frames atom
+				$atomstructure['data'] = getid3_lib::BigEndian2Int($atomdata);
+				break;
+
+
+			case 'name': //
+			case 'MCPS': // Media Cleaner PRo
+			case '@PRM': // adobe PReMiere version
+			case '@PRQ': // adobe PRemiere Quicktime version
+				$atomstructure['data'] = $atomdata;
+				break;
+
+
+			case 'cmvd': // Compressed MooV Data atom
+				// Code by ubergeek&#216;ubergeek*tv based on information from
+				// <A HREF="http://developer.apple.com/quicktime/icefloe/dispatch012.html">http://developer.apple.com/quicktime/icefloe/dispatch012.html</A>
+				$atomstructure['unCompressedSize'] = getid3_lib::BigEndian2Int(substr($atomdata, 0, 4));
+
+				$CompressedFileData = substr($atomdata, 4);
+				if ($UncompressedHeader = @gzuncompress($CompressedFileData)) {
+					$atomstructure['subatoms'] = $this-&gt;QuicktimeParseContainerAtom($UncompressedHeader, $ThisFileInfo, 0, $atomHierarchy, $ParseAllPossibleAtoms);
+				} else {
+					$ThisFileInfo['warning'][] = 'Error decompressing compressed MOV atom at offset '.$atomstructure['offset'];
+				}
+				break;
+
+
+			case 'dcom': // Data COMpression atom
+				$atomstructure['compression_id']   = $atomdata;
+				$atomstructure['compression_text'] = $this-&gt;QuicktimeDCOMLookup($atomdata);
+				break;
+
+
+			case 'rdrf': // Reference movie Data ReFerence atom
+				$atomstructure['version']                = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']              = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3));
+				$atomstructure['flags']['internal_data'] = (bool) ($atomstructure['flags_raw'] &amp; 0x000001);
+
+				$atomstructure['reference_type_name']    =                           substr($atomdata,  4, 4);
+				$atomstructure['reference_length']       = getid3_lib::BigEndian2Int(substr($atomdata,  8, 4));
+				switch ($atomstructure['reference_type_name']) {
+					case 'url ':
+						$atomstructure['url']            =       $this-&gt;NoNullString(substr($atomdata, 12));
+						break;
+
+					case 'alis':
+						$atomstructure['file_alias']     =                           substr($atomdata, 12);
+						break;
+
+					case 'rsrc':
+						$atomstructure['resource_alias'] =                           substr($atomdata, 12);
+						break;
+
+					default:
+						$atomstructure['data']           =                           substr($atomdata, 12);
+						break;
+				}
+				break;
+
+
+			case 'rmqu': // Reference Movie QUality atom
+				$atomstructure['movie_quality'] = getid3_lib::BigEndian2Int($atomdata);
+				break;
+
+
+			case 'rmcs': // Reference Movie Cpu Speed atom
+				$atomstructure['version']          = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']        = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['cpu_speed_rating'] = getid3_lib::BigEndian2Int(substr($atomdata,  4, 2));
+				break;
+
+
+			case 'rmvc': // Reference Movie Version Check atom
+				$atomstructure['version']            = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']          = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['gestalt_selector']   =                           substr($atomdata,  4, 4);
+				$atomstructure['gestalt_value_mask'] = getid3_lib::BigEndian2Int(substr($atomdata,  8, 4));
+				$atomstructure['gestalt_value']      = getid3_lib::BigEndian2Int(substr($atomdata, 12, 4));
+				$atomstructure['gestalt_check_type'] = getid3_lib::BigEndian2Int(substr($atomdata, 14, 2));
+				break;
+
+
+			case 'rmcd': // Reference Movie Component check atom
+				$atomstructure['version']                = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']              = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['component_type']         =                           substr($atomdata,  4, 4);
+				$atomstructure['component_subtype']      =                           substr($atomdata,  8, 4);
+				$atomstructure['component_manufacturer'] =                           substr($atomdata, 12, 4);
+				$atomstructure['component_flags_raw']    = getid3_lib::BigEndian2Int(substr($atomdata, 16, 4));
+				$atomstructure['component_flags_mask']   = getid3_lib::BigEndian2Int(substr($atomdata, 20, 4));
+				$atomstructure['component_min_version']  = getid3_lib::BigEndian2Int(substr($atomdata, 24, 4));
+				break;
+
+
+			case 'rmdr': // Reference Movie Data Rate atom
+				$atomstructure['version']       = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']     = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['data_rate']     = getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+
+				$atomstructure['data_rate_bps'] = $atomstructure['data_rate'] * 10;
+				break;
+
+
+			case 'rmla': // Reference Movie Language Atom
+				$atomstructure['version']     = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']   = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['language_id'] = getid3_lib::BigEndian2Int(substr($atomdata,  4, 2));
+
+				$atomstructure['language']    = $this-&gt;QuicktimeLanguageLookup($atomstructure['language_id']);
+				if (empty($ThisFileInfo['comments']['language']) || (!in_array($atomstructure['language'], $ThisFileInfo['comments']['language']))) {
+					$ThisFileInfo['comments']['language'][] = $atomstructure['language'];
+				}
+				break;
+
+
+			case 'rmla': // Reference Movie Language Atom
+				$atomstructure['version']   = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw'] = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['track_id']  = getid3_lib::BigEndian2Int(substr($atomdata,  4, 2));
+				break;
+
+
+			case 'ptv ': // Print To Video - defines a movie's full screen mode
+				// <A HREF="http://developer.apple.com/documentation/QuickTime/APIREF/SOURCESIV/at_ptv-_pg.htm">http://developer.apple.com/documentation/QuickTime/APIREF/SOURCESIV/at_ptv-_pg.htm</A>
+				$atomstructure['display_size_raw']  = getid3_lib::BigEndian2Int(substr($atomdata, 0, 2));
+				$atomstructure['reserved_1']        = getid3_lib::BigEndian2Int(substr($atomdata, 2, 2)); // hardcoded: 0x0000
+				$atomstructure['reserved_2']        = getid3_lib::BigEndian2Int(substr($atomdata, 4, 2)); // hardcoded: 0x0000
+				$atomstructure['slide_show_flag']   = getid3_lib::BigEndian2Int(substr($atomdata, 6, 1));
+				$atomstructure['play_on_open_flag'] = getid3_lib::BigEndian2Int(substr($atomdata, 7, 1));
+
+				$atomstructure['flags']['play_on_open'] = (bool) $atomstructure['play_on_open_flag'];
+				$atomstructure['flags']['slide_show']   = (bool) $atomstructure['slide_show_flag'];
+
+				$ptv_lookup[0] = 'normal';
+				$ptv_lookup[1] = 'double';
+				$ptv_lookup[2] = 'half';
+				$ptv_lookup[3] = 'full';
+				$ptv_lookup[4] = 'current';
+				if (isset($ptv_lookup[$atomstructure['display_size_raw']])) {
+					$atomstructure['display_size'] = $ptv_lookup[$atomstructure['display_size_raw']];
+				} else {
+					$ThisFileInfo['warning'][] = 'unknown &quot;ptv &quot; display constant ('.$atomstructure['display_size_raw'].')';
+				}
+				break;
+
+
+			case 'stsd': // Sample Table Sample Description atom
+				$atomstructure['version']        = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']      = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['number_entries'] = getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+				$stsdEntriesDataOffset = 8;
+				for ($i = 0; $i &lt; $atomstructure['number_entries']; $i++) {
+					$atomstructure['sample_description_table'][$i]['size']             = getid3_lib::BigEndian2Int(substr($atomdata, $stsdEntriesDataOffset, 4));
+					$stsdEntriesDataOffset += 4;
+					$atomstructure['sample_description_table'][$i]['data_format']      =                           substr($atomdata, $stsdEntriesDataOffset, 4);
+					$stsdEntriesDataOffset += 4;
+					$atomstructure['sample_description_table'][$i]['reserved']         = getid3_lib::BigEndian2Int(substr($atomdata, $stsdEntriesDataOffset, 6));
+					$stsdEntriesDataOffset += 6;
+					$atomstructure['sample_description_table'][$i]['reference_index']  = getid3_lib::BigEndian2Int(substr($atomdata, $stsdEntriesDataOffset, 2));
+					$stsdEntriesDataOffset += 2;
+					$atomstructure['sample_description_table'][$i]['data']             =                           substr($atomdata, $stsdEntriesDataOffset, ($atomstructure['sample_description_table'][$i]['size'] - 4 - 4 - 6 - 2));
+					$stsdEntriesDataOffset += ($atomstructure['sample_description_table'][$i]['size'] - 4 - 4 - 6 - 2);
+
+					$atomstructure['sample_description_table'][$i]['encoder_version']  = getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'],  0, 2));
+					$atomstructure['sample_description_table'][$i]['encoder_revision'] = getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'],  2, 2));
+					$atomstructure['sample_description_table'][$i]['encoder_vendor']   =                           substr($atomstructure['sample_description_table'][$i]['data'],  4, 4);
+
+					switch ($atomstructure['sample_description_table'][$i]['encoder_vendor']) {
+
+						case &quot;\x00\x00\x00\x00&quot;:
+							// audio atom
+							$atomstructure['sample_description_table'][$i]['audio_channels']       =   getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'],  8,  2));
+							$atomstructure['sample_description_table'][$i]['audio_bit_depth']      =   getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'], 10,  2));
+							$atomstructure['sample_description_table'][$i]['audio_compression_id'] =   getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'], 12,  2));
+							$atomstructure['sample_description_table'][$i]['audio_packet_size']    =   getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'], 14,  2));
+							$atomstructure['sample_description_table'][$i]['audio_sample_rate']    = getid3_lib::FixedPoint16_16(substr($atomstructure['sample_description_table'][$i]['data'], 16,  4));
+
+							switch ($atomstructure['sample_description_table'][$i]['data_format']) {
+								case 'mp4v':
+									$ThisFileInfo['fileformat'] = 'mp4';
+									$ThisFileInfo['error'][] = 'This version ('.GETID3_VERSION.') of getID3() does not fully support MPEG-4 audio/video streams';
+									break;
+
+								case 'qtvr':
+									$ThisFileInfo['video']['dataformat'] = 'quicktimevr';
+									break;
+
+								case 'mp4a':
+								default:
+									$ThisFileInfo['quicktime']['audio']['codec']       = $this-&gt;QuicktimeAudioCodecLookup($atomstructure['sample_description_table'][$i]['data_format']);
+									$ThisFileInfo['quicktime']['audio']['sample_rate'] = $atomstructure['sample_description_table'][$i]['audio_sample_rate'];
+									$ThisFileInfo['quicktime']['audio']['channels']    = $atomstructure['sample_description_table'][$i]['audio_channels'];
+									$ThisFileInfo['quicktime']['audio']['bit_depth']   = $atomstructure['sample_description_table'][$i]['audio_bit_depth'];
+									$ThisFileInfo['audio']['codec']                    = $ThisFileInfo['quicktime']['audio']['codec'];
+									$ThisFileInfo['audio']['sample_rate']              = $ThisFileInfo['quicktime']['audio']['sample_rate'];
+									$ThisFileInfo['audio']['channels']                 = $ThisFileInfo['quicktime']['audio']['channels'];
+									$ThisFileInfo['audio']['bits_per_sample']          = $ThisFileInfo['quicktime']['audio']['bit_depth'];
+									switch ($atomstructure['sample_description_table'][$i]['data_format']) {
+										case 'raw ': // PCM
+										case 'alac': // Apple Lossless Audio Codec
+											$ThisFileInfo['audio']['lossless'] = true;
+											break;
+										default:
+											$ThisFileInfo['audio']['lossless'] = false;
+											break;
+									}
+									break;
+							}
+							break;
+
+						default:
+							switch ($atomstructure['sample_description_table'][$i]['data_format']) {
+								case 'mp4s':
+									$ThisFileInfo['fileformat'] = 'mp4';
+									break;
+
+								default:
+									// video atom
+									$atomstructure['sample_description_table'][$i]['video_temporal_quality']  =   getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'],  8,  4));
+									$atomstructure['sample_description_table'][$i]['video_spatial_quality']   =   getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'], 12,  4));
+									$atomstructure['sample_description_table'][$i]['video_frame_width']       =   getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'], 16,  2));
+									$atomstructure['sample_description_table'][$i]['video_frame_height']      =   getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'], 18,  2));
+									$atomstructure['sample_description_table'][$i]['video_resolution_x']      = getid3_lib::FixedPoint16_16(substr($atomstructure['sample_description_table'][$i]['data'], 20,  4));
+									$atomstructure['sample_description_table'][$i]['video_resolution_y']      = getid3_lib::FixedPoint16_16(substr($atomstructure['sample_description_table'][$i]['data'], 24,  4));
+									$atomstructure['sample_description_table'][$i]['video_data_size']         =   getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'], 28,  4));
+									$atomstructure['sample_description_table'][$i]['video_frame_count']       =   getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'], 32,  2));
+									$atomstructure['sample_description_table'][$i]['video_encoder_name_len']  =   getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'], 34,  1));
+									$atomstructure['sample_description_table'][$i]['video_encoder_name']      =                             substr($atomstructure['sample_description_table'][$i]['data'], 35, $atomstructure['sample_description_table'][$i]['video_encoder_name_len']);
+									$atomstructure['sample_description_table'][$i]['video_pixel_color_depth'] =   getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'], 66,  2));
+									$atomstructure['sample_description_table'][$i]['video_color_table_id']    =   getid3_lib::BigEndian2Int(substr($atomstructure['sample_description_table'][$i]['data'], 68,  2));
+
+									$atomstructure['sample_description_table'][$i]['video_pixel_color_type']  = (($atomstructure['sample_description_table'][$i]['video_pixel_color_depth'] &gt; 32) ? 'grayscale' : 'color');
+									$atomstructure['sample_description_table'][$i]['video_pixel_color_name']  = $this-&gt;QuicktimeColorNameLookup($atomstructure['sample_description_table'][$i]['video_pixel_color_depth']);
+
+									if ($atomstructure['sample_description_table'][$i]['video_pixel_color_name'] != 'invalid') {
+										$ThisFileInfo['quicktime']['video']['codec_fourcc']        = $atomstructure['sample_description_table'][$i]['data_format'];
+										$ThisFileInfo['quicktime']['video']['codec_fourcc_lookup'] = $this-&gt;QuicktimeVideoCodecLookup($atomstructure['sample_description_table'][$i]['data_format']);
+										$ThisFileInfo['quicktime']['video']['codec']               = $atomstructure['sample_description_table'][$i]['video_encoder_name'];
+										$ThisFileInfo['quicktime']['video']['color_depth']         = $atomstructure['sample_description_table'][$i]['video_pixel_color_depth'];
+										$ThisFileInfo['quicktime']['video']['color_depth_name']    = $atomstructure['sample_description_table'][$i]['video_pixel_color_name'];
+
+										$ThisFileInfo['video']['codec']           = $ThisFileInfo['quicktime']['video']['codec'];
+										$ThisFileInfo['video']['bits_per_sample'] = $ThisFileInfo['quicktime']['video']['color_depth'];
+									}
+									$ThisFileInfo['video']['lossless']           = false;
+									$ThisFileInfo['video']['pixel_aspect_ratio'] = (float) 1;
+									break;
+							}
+							break;
+					}
+					switch (strtolower($atomstructure['sample_description_table'][$i]['data_format'])) {
+						case 'mp4a':
+							$ThisFileInfo['audio']['dataformat']         = 'mp4';
+							$ThisFileInfo['quicktime']['audio']['codec'] = 'mp4';
+							break;
+
+						case '3ivx':
+						case '3iv1':
+						case '3iv2':
+							$ThisFileInfo['video']['dataformat'] = '3ivx';
+							break;
+
+						case 'xvid':
+							$ThisFileInfo['video']['dataformat'] = 'xvid';
+							break;
+
+						case 'mp4v':
+							$ThisFileInfo['video']['dataformat'] = 'mpeg4';
+							break;
+
+						case 'divx':
+						case 'div1':
+						case 'div2':
+						case 'div3':
+						case 'div4':
+						case 'div5':
+						case 'div6':
+							$TDIVXileInfo['video']['dataformat'] = 'divx';
+							break;
+
+						default:
+							// do nothing
+							break;
+					}
+					unset($atomstructure['sample_description_table'][$i]['data']);
+				}
+				break;
+
+
+			case 'stts': // Sample Table Time-to-Sample atom
+				//if ($ParseAllPossibleAtoms) {
+					$atomstructure['version']        = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+					$atomstructure['flags_raw']      = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+					$atomstructure['number_entries'] = getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+					$sttsEntriesDataOffset = 8;
+					$FrameRateCalculatorArray = array();
+					for ($i = 0; $i &lt; $atomstructure['number_entries']; $i++) {
+						$atomstructure['time_to_sample_table'][$i]['sample_count']    = getid3_lib::BigEndian2Int(substr($atomdata, $sttsEntriesDataOffset, 4));
+						$sttsEntriesDataOffset += 4;
+						$atomstructure['time_to_sample_table'][$i]['sample_duration'] = getid3_lib::BigEndian2Int(substr($atomdata, $sttsEntriesDataOffset, 4));
+						$sttsEntriesDataOffset += 4;
+
+						if (!empty($ThisFileInfo['quicktime']['time_scale'])) {
+							$stts_new_framerate = $ThisFileInfo['quicktime']['time_scale'] / $atomstructure['time_to_sample_table'][$i]['sample_duration'];
+							if ($stts_new_framerate &lt;= 60) {
+								// some atoms have durations of &quot;1&quot; giving a very large framerate, which probably is not right
+								$ThisFileInfo['video']['frame_rate'] = max(@$ThisFileInfo['video']['frame_rate'], $stts_new_framerate);
+							}
+						}
+						//@$FrameRateCalculatorArray[($ThisFileInfo['quicktime']['time_scale'] / $atomstructure['time_to_sample_table'][$i]['sample_duration'])] += $atomstructure['time_to_sample_table'][$i]['sample_count'];
+					}
+					//$sttsFramesTotal  = 0;
+					//$sttsSecondsTotal = 0;
+					//foreach ($FrameRateCalculatorArray as $frames_per_second =&gt; $frame_count) {
+					//	if (($frames_per_second &gt; 60) || ($frames_per_second &lt; 1)) {
+					//		// not video FPS information, probably audio information
+					//		$sttsFramesTotal  = 0;
+					//		$sttsSecondsTotal = 0;
+					//		break;
+					//	}
+					//	$sttsFramesTotal  += $frame_count;
+					//	$sttsSecondsTotal += $frame_count / $frames_per_second;
+					//}
+					//if (($sttsFramesTotal &gt; 0) &amp;&amp; ($sttsSecondsTotal &gt; 0)) {
+					//	if (($sttsFramesTotal / $sttsSecondsTotal) &gt; @$ThisFileInfo['video']['frame_rate']) {
+					//		$ThisFileInfo['video']['frame_rate'] = $sttsFramesTotal / $sttsSecondsTotal;
+					//	}
+					//}
+				//}
+				break;
+
+
+			case 'stss': // Sample Table Sync Sample (key frames) atom
+				if ($ParseAllPossibleAtoms) {
+					$atomstructure['version']        = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+					$atomstructure['flags_raw']      = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+					$atomstructure['number_entries'] = getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+					$stssEntriesDataOffset = 8;
+					for ($i = 0; $i &lt; $atomstructure['number_entries']; $i++) {
+						$atomstructure['time_to_sample_table'][$i] = getid3_lib::BigEndian2Int(substr($atomdata, $stssEntriesDataOffset, 4));
+						$stssEntriesDataOffset += 4;
+					}
+				}
+				break;
+
+
+			case 'stsc': // Sample Table Sample-to-Chunk atom
+				if ($ParseAllPossibleAtoms) {
+					$atomstructure['version']        = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+					$atomstructure['flags_raw']      = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+					$atomstructure['number_entries'] = getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+					$stscEntriesDataOffset = 8;
+					for ($i = 0; $i &lt; $atomstructure['number_entries']; $i++) {
+						$atomstructure['sample_to_chunk_table'][$i]['first_chunk']        = getid3_lib::BigEndian2Int(substr($atomdata, $stscEntriesDataOffset, 4));
+						$stscEntriesDataOffset += 4;
+						$atomstructure['sample_to_chunk_table'][$i]['samples_per_chunk']  = getid3_lib::BigEndian2Int(substr($atomdata, $stscEntriesDataOffset, 4));
+						$stscEntriesDataOffset += 4;
+						$atomstructure['sample_to_chunk_table'][$i]['sample_description'] = getid3_lib::BigEndian2Int(substr($atomdata, $stscEntriesDataOffset, 4));
+						$stscEntriesDataOffset += 4;
+					}
+				}
+				break;
+
+
+			case 'stsz': // Sample Table SiZe atom
+				if ($ParseAllPossibleAtoms) {
+					$atomstructure['version']        = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+					$atomstructure['flags_raw']      = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+					$atomstructure['sample_size']    = getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+					$atomstructure['number_entries'] = getid3_lib::BigEndian2Int(substr($atomdata,  8, 4));
+					$stszEntriesDataOffset = 12;
+					if ($atomstructure['sample_size'] == 0) {
+						for ($i = 0; $i &lt; $atomstructure['number_entries']; $i++) {
+							$atomstructure['sample_size_table'][$i] = getid3_lib::BigEndian2Int(substr($atomdata, $stszEntriesDataOffset, 4));
+							$stszEntriesDataOffset += 4;
+						}
+					}
+				}
+				break;
+
+
+			case 'stco': // Sample Table Chunk Offset atom
+				if ($ParseAllPossibleAtoms) {
+					$atomstructure['version']        = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+					$atomstructure['flags_raw']      = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+					$atomstructure['number_entries'] = getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+					$stcoEntriesDataOffset = 8;
+					for ($i = 0; $i &lt; $atomstructure['number_entries']; $i++) {
+						$atomstructure['chunk_offset_table'][$i] = getid3_lib::BigEndian2Int(substr($atomdata, $stcoEntriesDataOffset, 4));
+						$stcoEntriesDataOffset += 4;
+					}
+				}
+				break;
+
+
+			case 'dref': // Data REFerence atom
+				$atomstructure['version']        = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']      = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['number_entries'] = getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+				$drefDataOffset = 8;
+				for ($i = 0; $i &lt; $atomstructure['number_entries']; $i++) {
+					$atomstructure['data_references'][$i]['size']                    = getid3_lib::BigEndian2Int(substr($atomdata, $drefDataOffset, 4));
+					$drefDataOffset += 4;
+					$atomstructure['data_references'][$i]['type']                    =               substr($atomdata, $drefDataOffset, 4);
+					$drefDataOffset += 4;
+					$atomstructure['data_references'][$i]['version']                 = getid3_lib::BigEndian2Int(substr($atomdata,  $drefDataOffset, 1));
+					$drefDataOffset += 1;
+					$atomstructure['data_references'][$i]['flags_raw']               = getid3_lib::BigEndian2Int(substr($atomdata,  $drefDataOffset, 3)); // hardcoded: 0x0000
+					$drefDataOffset += 3;
+					$atomstructure['data_references'][$i]['data']                    =               substr($atomdata, $drefDataOffset, ($atomstructure['data_references'][$i]['size'] - 4 - 4 - 1 - 3));
+					$drefDataOffset += ($atomstructure['data_references'][$i]['size'] - 4 - 4 - 1 - 3);
+
+					$atomstructure['data_references'][$i]['flags']['self_reference'] = (bool) ($atomstructure['data_references'][$i]['flags_raw'] &amp; 0x001);
+				}
+				break;
+
+
+			case 'gmin': // base Media INformation atom
+				$atomstructure['version']                = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']              = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['graphics_mode']          = getid3_lib::BigEndian2Int(substr($atomdata,  4, 2));
+				$atomstructure['opcolor_red']            = getid3_lib::BigEndian2Int(substr($atomdata,  6, 2));
+				$atomstructure['opcolor_green']          = getid3_lib::BigEndian2Int(substr($atomdata,  8, 2));
+				$atomstructure['opcolor_blue']           = getid3_lib::BigEndian2Int(substr($atomdata, 10, 2));
+				$atomstructure['balance']                = getid3_lib::BigEndian2Int(substr($atomdata, 12, 2));
+				$atomstructure['reserved']               = getid3_lib::BigEndian2Int(substr($atomdata, 14, 2));
+				break;
+
+
+			case 'smhd': // Sound Media information HeaDer atom
+				$atomstructure['version']                = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']              = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['balance']                = getid3_lib::BigEndian2Int(substr($atomdata,  4, 2));
+				$atomstructure['reserved']               = getid3_lib::BigEndian2Int(substr($atomdata,  6, 2));
+				break;
+
+
+			case 'vmhd': // Video Media information HeaDer atom
+				$atomstructure['version']                = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']              = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3));
+				$atomstructure['graphics_mode']          = getid3_lib::BigEndian2Int(substr($atomdata,  4, 2));
+				$atomstructure['opcolor_red']            = getid3_lib::BigEndian2Int(substr($atomdata,  6, 2));
+				$atomstructure['opcolor_green']          = getid3_lib::BigEndian2Int(substr($atomdata,  8, 2));
+				$atomstructure['opcolor_blue']           = getid3_lib::BigEndian2Int(substr($atomdata, 10, 2));
+
+				$atomstructure['flags']['no_lean_ahead'] = (bool) ($atomstructure['flags_raw'] &amp; 0x001);
+				break;
+
+
+			case 'hdlr': // HanDLeR reference atom
+				$atomstructure['version']                = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']              = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['component_type']         =                           substr($atomdata,  4, 4);
+				$atomstructure['component_subtype']      =                           substr($atomdata,  8, 4);
+				$atomstructure['component_manufacturer'] =                           substr($atomdata, 12, 4);
+				$atomstructure['component_flags_raw']    = getid3_lib::BigEndian2Int(substr($atomdata, 16, 4));
+				$atomstructure['component_flags_mask']   = getid3_lib::BigEndian2Int(substr($atomdata, 20, 4));
+				$atomstructure['component_name']         =      $this-&gt;Pascal2String(substr($atomdata, 24));
+
+				if (($atomstructure['component_subtype'] == 'STpn') &amp;&amp; ($atomstructure['component_manufacturer'] == 'zzzz')) {
+					$ThisFileInfo['video']['dataformat'] = 'quicktimevr';
+				}
+				break;
+
+
+			case 'mdhd': // MeDia HeaDer atom
+				$atomstructure['version']               = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']             = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['creation_time']         = getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+				$atomstructure['modify_time']           = getid3_lib::BigEndian2Int(substr($atomdata,  8, 4));
+				$atomstructure['time_scale']            = getid3_lib::BigEndian2Int(substr($atomdata, 12, 4));
+				$atomstructure['duration']              = getid3_lib::BigEndian2Int(substr($atomdata, 16, 4));
+				$atomstructure['language_id']           = getid3_lib::BigEndian2Int(substr($atomdata, 20, 2));
+				$atomstructure['quality']               = getid3_lib::BigEndian2Int(substr($atomdata, 22, 2));
+
+				if ($atomstructure['time_scale'] == 0) {
+					$ThisFileInfo['error'][] = 'Corrupt Quicktime file: mdhd.time_scale == zero';
+					return false;
+				}
+				$atomstructure['creation_time_unix']    = getid3_lib::DateMac2Unix($atomstructure['creation_time']);
+				$atomstructure['modify_time_unix']      = getid3_lib::DateMac2Unix($atomstructure['modify_time']);
+				$atomstructure['playtime_seconds']      = $atomstructure['duration'] / $atomstructure['time_scale'];
+				$atomstructure['language']              = $this-&gt;QuicktimeLanguageLookup($atomstructure['language_id']);
+				if (empty($ThisFileInfo['comments']['language']) || (!in_array($atomstructure['language'], $ThisFileInfo['comments']['language']))) {
+					$ThisFileInfo['comments']['language'][] = $atomstructure['language'];
+				}
+				break;
+
+
+			case 'pnot': // Preview atom
+				$atomstructure['modification_date']      = getid3_lib::BigEndian2Int(substr($atomdata,  0, 4)); // &quot;standard Macintosh format&quot;
+				$atomstructure['version_number']         = getid3_lib::BigEndian2Int(substr($atomdata,  4, 2)); // hardcoded: 0x00
+				$atomstructure['atom_type']              =               substr($atomdata,  6, 4);        // usually: 'PICT'
+				$atomstructure['atom_index']             = getid3_lib::BigEndian2Int(substr($atomdata, 10, 2)); // usually: 0x01
+
+				$atomstructure['modification_date_unix'] = getid3_lib::DateMac2Unix($atomstructure['modification_date']);
+				break;
+
+
+			case 'crgn': // Clipping ReGioN atom
+				$atomstructure['region_size']   = getid3_lib::BigEndian2Int(substr($atomdata,  0, 2)); // The Region size, Region boundary box,
+				$atomstructure['boundary_box']  = getid3_lib::BigEndian2Int(substr($atomdata,  2, 8)); // and Clipping region data fields
+				$atomstructure['clipping_data'] =               substr($atomdata, 10);           // constitute a QuickDraw region.
+				break;
+
+
+			case 'load': // track LOAD settings atom
+				$atomstructure['preload_start_time'] = getid3_lib::BigEndian2Int(substr($atomdata,  0, 4));
+				$atomstructure['preload_duration']   = getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+				$atomstructure['preload_flags_raw']  = getid3_lib::BigEndian2Int(substr($atomdata,  8, 4));
+				$atomstructure['default_hints_raw']  = getid3_lib::BigEndian2Int(substr($atomdata, 12, 4));
+
+				$atomstructure['default_hints']['double_buffer'] = (bool) ($atomstructure['default_hints_raw'] &amp; 0x0020);
+				$atomstructure['default_hints']['high_quality']  = (bool) ($atomstructure['default_hints_raw'] &amp; 0x0100);
+				break;
+
+
+			case 'tmcd': // TiMe CoDe atom
+			case 'chap': // CHAPter list atom
+			case 'sync': // SYNChronization atom
+			case 'scpt': // tranSCriPT atom
+			case 'ssrc': // non-primary SouRCe atom
+				for ($i = 0; $i &lt; (strlen($atomdata) % 4); $i++) {
+					$atomstructure['track_id'][$i] = getid3_lib::BigEndian2Int(substr($atomdata, $i * 4, 4));
+				}
+				break;
+
+
+			case 'elst': // Edit LiST atom
+				$atomstructure['version']        = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']      = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['number_entries'] = getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+				for ($i = 0; $i &lt; $atomstructure['number_entries']; $i++ ) {
+					$atomstructure['edit_list'][$i]['track_duration'] =   getid3_lib::BigEndian2Int(substr($atomdata, 8 + ($i * 12) + 0, 4));
+					$atomstructure['edit_list'][$i]['media_time']     =   getid3_lib::BigEndian2Int(substr($atomdata, 8 + ($i * 12) + 4, 4));
+					$atomstructure['edit_list'][$i]['media_rate']     = getid3_lib::FixedPoint16_16(substr($atomdata, 8 + ($i * 12) + 8, 4));
+				}
+				break;
+
+
+			case 'kmat': // compressed MATte atom
+				$atomstructure['version']        = getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']      = getid3_lib::BigEndian2Int(substr($atomdata,  1, 3)); // hardcoded: 0x0000
+				$atomstructure['matte_data_raw'] =               substr($atomdata,  4);
+				break;
+
+
+			case 'ctab': // Color TABle atom
+				$atomstructure['color_table_seed']   = getid3_lib::BigEndian2Int(substr($atomdata,  0, 4)); // hardcoded: 0x00000000
+				$atomstructure['color_table_flags']  = getid3_lib::BigEndian2Int(substr($atomdata,  4, 2)); // hardcoded: 0x8000
+				$atomstructure['color_table_size']   = getid3_lib::BigEndian2Int(substr($atomdata,  6, 2)) + 1;
+				for ($colortableentry = 0; $colortableentry &lt; $atomstructure['color_table_size']; $colortableentry++) {
+					$atomstructure['color_table'][$colortableentry]['alpha'] = getid3_lib::BigEndian2Int(substr($atomdata, 8 + ($colortableentry * 8) + 0, 2));
+					$atomstructure['color_table'][$colortableentry]['red']   = getid3_lib::BigEndian2Int(substr($atomdata, 8 + ($colortableentry * 8) + 2, 2));
+					$atomstructure['color_table'][$colortableentry]['green'] = getid3_lib::BigEndian2Int(substr($atomdata, 8 + ($colortableentry * 8) + 4, 2));
+					$atomstructure['color_table'][$colortableentry]['blue']  = getid3_lib::BigEndian2Int(substr($atomdata, 8 + ($colortableentry * 8) + 6, 2));
+				}
+				break;
+
+
+			case 'mvhd': // MoVie HeaDer atom
+				$atomstructure['version']            =   getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']          =   getid3_lib::BigEndian2Int(substr($atomdata,  1, 3));
+				$atomstructure['creation_time']      =   getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+				$atomstructure['modify_time']        =   getid3_lib::BigEndian2Int(substr($atomdata,  8, 4));
+				$atomstructure['time_scale']         =   getid3_lib::BigEndian2Int(substr($atomdata, 12, 4));
+				$atomstructure['duration']           =   getid3_lib::BigEndian2Int(substr($atomdata, 16, 4));
+				$atomstructure['preferred_rate']     = getid3_lib::FixedPoint16_16(substr($atomdata, 20, 4));
+				$atomstructure['preferred_volume']   =   getid3_lib::FixedPoint8_8(substr($atomdata, 24, 2));
+				$atomstructure['reserved']           =                             substr($atomdata, 26, 10);
+				$atomstructure['matrix_a']           = getid3_lib::FixedPoint16_16(substr($atomdata, 36, 4));
+				$atomstructure['matrix_b']           = getid3_lib::FixedPoint16_16(substr($atomdata, 40, 4));
+				$atomstructure['matrix_u']           = getid3_lib::FixedPoint16_16(substr($atomdata, 44, 4));
+				$atomstructure['matrix_c']           = getid3_lib::FixedPoint16_16(substr($atomdata, 48, 4));
+				$atomstructure['matrix_v']           = getid3_lib::FixedPoint16_16(substr($atomdata, 52, 4));
+				$atomstructure['matrix_d']           = getid3_lib::FixedPoint16_16(substr($atomdata, 56, 4));
+				$atomstructure['matrix_x']           =  getid3_lib::FixedPoint2_30(substr($atomdata, 60, 4));
+				$atomstructure['matrix_y']           =  getid3_lib::FixedPoint2_30(substr($atomdata, 64, 4));
+				$atomstructure['matrix_w']           =  getid3_lib::FixedPoint2_30(substr($atomdata, 68, 4));
+				$atomstructure['preview_time']       =   getid3_lib::BigEndian2Int(substr($atomdata, 72, 4));
+				$atomstructure['preview_duration']   =   getid3_lib::BigEndian2Int(substr($atomdata, 76, 4));
+				$atomstructure['poster_time']        =   getid3_lib::BigEndian2Int(substr($atomdata, 80, 4));
+				$atomstructure['selection_time']     =   getid3_lib::BigEndian2Int(substr($atomdata, 84, 4));
+				$atomstructure['selection_duration'] =   getid3_lib::BigEndian2Int(substr($atomdata, 88, 4));
+				$atomstructure['current_time']       =   getid3_lib::BigEndian2Int(substr($atomdata, 92, 4));
+				$atomstructure['next_track_id']      =   getid3_lib::BigEndian2Int(substr($atomdata, 96, 4));
+
+				if ($atomstructure['time_scale'] == 0) {
+					$ThisFileInfo['error'][] = 'Corrupt Quicktime file: mvhd.time_scale == zero';
+					return false;
+				}
+				$atomstructure['creation_time_unix']        = getid3_lib::DateMac2Unix($atomstructure['creation_time']);
+				$atomstructure['modify_time_unix']          = getid3_lib::DateMac2Unix($atomstructure['modify_time']);
+				$ThisFileInfo['quicktime']['time_scale']    = $atomstructure['time_scale'];
+				$ThisFileInfo['quicktime']['display_scale'] = $atomstructure['matrix_a'];
+				$ThisFileInfo['playtime_seconds']           = $atomstructure['duration'] / $atomstructure['time_scale'];
+				break;
+
+
+			case 'tkhd': // TracK HeaDer atom
+				$atomstructure['version']             =   getid3_lib::BigEndian2Int(substr($atomdata,  0, 1));
+				$atomstructure['flags_raw']           =   getid3_lib::BigEndian2Int(substr($atomdata,  1, 3));
+				$atomstructure['creation_time']       =   getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+				$atomstructure['modify_time']         =   getid3_lib::BigEndian2Int(substr($atomdata,  8, 4));
+				$atomstructure['trackid']             =   getid3_lib::BigEndian2Int(substr($atomdata, 12, 4));
+				$atomstructure['reserved1']           =   getid3_lib::BigEndian2Int(substr($atomdata, 16, 4));
+				$atomstructure['duration']            =   getid3_lib::BigEndian2Int(substr($atomdata, 20, 4));
+				$atomstructure['reserved2']           =   getid3_lib::BigEndian2Int(substr($atomdata, 24, 8));
+				$atomstructure['layer']               =   getid3_lib::BigEndian2Int(substr($atomdata, 32, 2));
+				$atomstructure['alternate_group']     =   getid3_lib::BigEndian2Int(substr($atomdata, 34, 2));
+				$atomstructure['volume']              =   getid3_lib::FixedPoint8_8(substr($atomdata, 36, 2));
+				$atomstructure['reserved3']           =   getid3_lib::BigEndian2Int(substr($atomdata, 38, 2));
+				$atomstructure['matrix_a']            = getid3_lib::FixedPoint16_16(substr($atomdata, 40, 4));
+				$atomstructure['matrix_b']            = getid3_lib::FixedPoint16_16(substr($atomdata, 44, 4));
+				$atomstructure['matrix_u']            = getid3_lib::FixedPoint16_16(substr($atomdata, 48, 4));
+				$atomstructure['matrix_c']            = getid3_lib::FixedPoint16_16(substr($atomdata, 52, 4));
+				$atomstructure['matrix_v']            = getid3_lib::FixedPoint16_16(substr($atomdata, 56, 4));
+				$atomstructure['matrix_d']            = getid3_lib::FixedPoint16_16(substr($atomdata, 60, 4));
+				$atomstructure['matrix_x']            =  getid3_lib::FixedPoint2_30(substr($atomdata, 64, 4));
+				$atomstructure['matrix_y']            =  getid3_lib::FixedPoint2_30(substr($atomdata, 68, 4));
+				$atomstructure['matrix_w']            =  getid3_lib::FixedPoint2_30(substr($atomdata, 72, 4));
+				$atomstructure['width']               = getid3_lib::FixedPoint16_16(substr($atomdata, 76, 4));
+				$atomstructure['height']              = getid3_lib::FixedPoint16_16(substr($atomdata, 80, 4));
+
+				$atomstructure['flags']['enabled']    = (bool) ($atomstructure['flags_raw'] &amp; 0x0001);
+				$atomstructure['flags']['in_movie']   = (bool) ($atomstructure['flags_raw'] &amp; 0x0002);
+				$atomstructure['flags']['in_preview'] = (bool) ($atomstructure['flags_raw'] &amp; 0x0004);
+				$atomstructure['flags']['in_poster']  = (bool) ($atomstructure['flags_raw'] &amp; 0x0008);
+				$atomstructure['creation_time_unix']  = getid3_lib::DateMac2Unix($atomstructure['creation_time']);
+				$atomstructure['modify_time_unix']    = getid3_lib::DateMac2Unix($atomstructure['modify_time']);
+
+				if (!isset($ThisFileInfo['video']['resolution_x']) || !isset($ThisFileInfo['video']['resolution_y'])) {
+					$ThisFileInfo['video']['resolution_x'] = $atomstructure['width'];
+					$ThisFileInfo['video']['resolution_y'] = $atomstructure['height'];
+				}
+				$ThisFileInfo['video']['resolution_x'] = max($ThisFileInfo['video']['resolution_x'], $atomstructure['width']);
+				$ThisFileInfo['video']['resolution_y'] = max($ThisFileInfo['video']['resolution_y'], $atomstructure['height']);
+				if (!empty($ThisFileInfo['video']['resolution_x']) &amp;&amp; !empty($ThisFileInfo['video']['resolution_y'])) {
+					$ThisFileInfo['quicktime']['video']['resolution_x'] = $ThisFileInfo['video']['resolution_x'];
+					$ThisFileInfo['quicktime']['video']['resolution_y'] = $ThisFileInfo['video']['resolution_y'];
+				} else {
+					unset($ThisFileInfo['video']['resolution_x']);
+					unset($ThisFileInfo['video']['resolution_y']);
+					unset($ThisFileInfo['quicktime']['video']);
+				}
+				break;
+
+
+			case 'meta': // METAdata atom
+				// <A HREF="http://www.geocities.com/xhelmboyx/quicktime/formats/qti-layout.txt">http://www.geocities.com/xhelmboyx/quicktime/formats/qti-layout.txt</A>
+				$NextTagPosition = strpos($atomdata, '&#169;');
+				while ($NextTagPosition &lt; strlen($atomdata)) {
+					$metaItemSize = getid3_lib::BigEndian2Int(substr($atomdata, $NextTagPosition - 4, 4)) - 4;
+					if ($metaItemSize == -4) {
+					    break;
+					}
+					$metaItemRaw  = substr($atomdata, $NextTagPosition, $metaItemSize);
+					$metaItemKey  = substr($metaItemRaw, 0, 4);
+					$metaItemData = substr($metaItemRaw, 20);
+					$NextTagPosition += $metaItemSize + 4;
+
+					$this-&gt;CopyToAppropriateCommentsSection($metaItemKey, $metaItemData, $ThisFileInfo);
+				}
+				break;
+
+			case 'ftyp': // FileTYPe (?) atom (for MP4 it seems)
+				$atomstructure['signature'] =                           substr($atomdata,  0, 4);
+				$atomstructure['unknown_1'] = getid3_lib::BigEndian2Int(substr($atomdata,  4, 4));
+				$atomstructure['fourcc']    =                           substr($atomdata,  8, 4);
+				break;
+
+			case 'mdat': // Media DATa atom
+			case 'free': // FREE space atom
+			case 'skip': // SKIP atom
+			case 'wide': // 64-bit expansion placeholder atom
+				// 'mdat' data is too big to deal with, contains no useful metadata
+				// 'free', 'skip' and 'wide' are just padding, contains no useful data at all
+
+				// When writing QuickTime files, it is sometimes necessary to update an atom's size.
+				// It is impossible to update a 32-bit atom to a 64-bit atom since the 32-bit atom
+				// is only 8 bytes in size, and the 64-bit atom requires 16 bytes. Therefore, QuickTime
+				// puts an 8-byte placeholder atom before any atoms it may have to update the size of.
+				// In this way, if the atom needs to be converted from a 32-bit to a 64-bit atom, the
+				// placeholder atom can be overwritten to obtain the necessary 8 extra bytes.
+				// The placeholder atom has a type of kWideAtomPlaceholderType ( 'wide' ).
+				break;
+
+
+			case 'nsav': // NoSAVe atom
+				// <A HREF="http://developer.apple.com/technotes/tn/tn2038.html">http://developer.apple.com/technotes/tn/tn2038.html</A>
+				$atomstructure['data'] = getid3_lib::BigEndian2Int(substr($atomdata,  0, 4));
+				break;
+
+			case 'ctyp': // Controller TYPe atom (seen on QTVR)
+				// <A HREF="http://homepages.slingshot.co.nz/~helmboy/quicktime/formats/qtm-layout.txt">http://homepages.slingshot.co.nz/~helmboy/quicktime/formats/qtm-layout.txt</A>
+				// some controller names are:
+				//   0x00 + 'std' for linear movie
+				//   'none' for no controls
+				$atomstructure['ctyp'] = substr($atomdata, 0, 4);
+				switch ($atomstructure['ctyp']) {
+					case 'qtvr':
+						$ThisFileInfo['video']['dataformat'] = 'quicktimevr';
+						break;
+				}
+				break;
+
+			case 'pano': // PANOrama track (seen on QTVR)
+				$atomstructure['pano'] = getid3_lib::BigEndian2Int(substr($atomdata,  0, 4));
+				break;
+
+			case 'imgt': // IMaGe Track reference (kQTVRImageTrackRefType) (seen on QTVR)
+				for ($i = 0; $i &lt; ($atomstructure['size'] - 8); $i += 4) {
+					$atomstructure['imgt'][] = getid3_lib::BigEndian2Int(substr($atomdata, $i, 4));
+				}
+				break;
+
+			case 'FXTC': // Something to do with Adobe After Effects (?)
+			case 'PrmA':
+			case 'code':
+			case 'FIEL': // this is NOT &quot;fiel&quot; (Field Ordering) as describe here: <A HREF="http://developer.apple.com/documentation/QuickTime/QTFF/QTFFChap3/chapter_4_section_2.html">http://developer.apple.com/documentation/QuickTime/QTFF/QTFFChap3/chapter_4_section_2.html</A>
+				// Observed-but-not-handled atom types are just listed here
+				// to prevent warnings being generated
+				$atomstructure['data'] = $atomdata;
+				break;
+
+			default:
+				$ThisFileInfo['warning'][] = 'Unknown QuickTime atom type: &quot;'.$atomname.'&quot; at offset '.$baseoffset;
+				$atomstructure['data'] = $atomdata;
+				break;
+		}
+		array_pop($atomHierarchy);
+		return $atomstructure;
+	}
+
+	function QuicktimeParseContainerAtom($atomdata, &amp;$ThisFileInfo, $baseoffset, &amp;$atomHierarchy, $ParseAllPossibleAtoms) {
+		$atomstructure  = false;
+		$subatomoffset  = 0;
+		$subatomcounter = 0;
+		if ((strlen($atomdata) == 4) &amp;&amp; (getid3_lib::BigEndian2Int($atomdata) == 0x00000000)) {
+			return false;
+		}
+		while ($subatomoffset &lt; strlen($atomdata)) {
+			$subatomsize = getid3_lib::BigEndian2Int(substr($atomdata, $subatomoffset + 0, 4));
+			$subatomname =               substr($atomdata, $subatomoffset + 4, 4);
+			$subatomdata =               substr($atomdata, $subatomoffset + 8, $subatomsize - 8);
+			if ($subatomsize == 0) {
+				// Furthermore, for historical reasons the list of atoms is optionally
+				// terminated by a 32-bit integer set to 0. If you are writing a program
+				// to read user data atoms, you should allow for the terminating 0.
+				return $atomstructure;
+			}
+
+			$atomstructure[$subatomcounter] = $this-&gt;QuicktimeParseAtom($subatomname, $subatomsize, $subatomdata, $ThisFileInfo, $baseoffset + $subatomoffset, $atomHierarchy, $ParseAllPossibleAtoms);
+
+			$subatomoffset += $subatomsize;
+			$subatomcounter++;
+		}
+		return $atomstructure;
+	}
+
+
+	function QuicktimeLanguageLookup($languageid) {
+		static $QuicktimeLanguageLookup = array();
+		if (empty($QuicktimeLanguageLookup)) {
+			$QuicktimeLanguageLookup[0]   = 'English';
+			$QuicktimeLanguageLookup[1]   = 'French';
+			$QuicktimeLanguageLookup[2]   = 'German';
+			$QuicktimeLanguageLookup[3]   = 'Italian';
+			$QuicktimeLanguageLookup[4]   = 'Dutch';
+			$QuicktimeLanguageLookup[5]   = 'Swedish';
+			$QuicktimeLanguageLookup[6]   = 'Spanish';
+			$QuicktimeLanguageLookup[7]   = 'Danish';
+			$QuicktimeLanguageLookup[8]   = 'Portuguese';
+			$QuicktimeLanguageLookup[9]   = 'Norwegian';
+			$QuicktimeLanguageLookup[10]  = 'Hebrew';
+			$QuicktimeLanguageLookup[11]  = 'Japanese';
+			$QuicktimeLanguageLookup[12]  = 'Arabic';
+			$QuicktimeLanguageLookup[13]  = 'Finnish';
+			$QuicktimeLanguageLookup[14]  = 'Greek';
+			$QuicktimeLanguageLookup[15]  = 'Icelandic';
+			$QuicktimeLanguageLookup[16]  = 'Maltese';
+			$QuicktimeLanguageLookup[17]  = 'Turkish';
+			$QuicktimeLanguageLookup[18]  = 'Croatian';
+			$QuicktimeLanguageLookup[19]  = 'Chinese (Traditional)';
+			$QuicktimeLanguageLookup[20]  = 'Urdu';
+			$QuicktimeLanguageLookup[21]  = 'Hindi';
+			$QuicktimeLanguageLookup[22]  = 'Thai';
+			$QuicktimeLanguageLookup[23]  = 'Korean';
+			$QuicktimeLanguageLookup[24]  = 'Lithuanian';
+			$QuicktimeLanguageLookup[25]  = 'Polish';
+			$QuicktimeLanguageLookup[26]  = 'Hungarian';
+			$QuicktimeLanguageLookup[27]  = 'Estonian';
+			$QuicktimeLanguageLookup[28]  = 'Lettish';
+			$QuicktimeLanguageLookup[28]  = 'Latvian';
+			$QuicktimeLanguageLookup[29]  = 'Saamisk';
+			$QuicktimeLanguageLookup[29]  = 'Lappish';
+			$QuicktimeLanguageLookup[30]  = 'Faeroese';
+			$QuicktimeLanguageLookup[31]  = 'Farsi';
+			$QuicktimeLanguageLookup[31]  = 'Persian';
+			$QuicktimeLanguageLookup[32]  = 'Russian';
+			$QuicktimeLanguageLookup[33]  = 'Chinese (Simplified)';
+			$QuicktimeLanguageLookup[34]  = 'Flemish';
+			$QuicktimeLanguageLookup[35]  = 'Irish';
+			$QuicktimeLanguageLookup[36]  = 'Albanian';
+			$QuicktimeLanguageLookup[37]  = 'Romanian';
+			$QuicktimeLanguageLookup[38]  = 'Czech';
+			$QuicktimeLanguageLookup[39]  = 'Slovak';
+			$QuicktimeLanguageLookup[40]  = 'Slovenian';
+			$QuicktimeLanguageLookup[41]  = 'Yiddish';
+			$QuicktimeLanguageLookup[42]  = 'Serbian';
+			$QuicktimeLanguageLookup[43]  = 'Macedonian';
+			$QuicktimeLanguageLookup[44]  = 'Bulgarian';
+			$QuicktimeLanguageLookup[45]  = 'Ukrainian';
+			$QuicktimeLanguageLookup[46]  = 'Byelorussian';
+			$QuicktimeLanguageLookup[47]  = 'Uzbek';
+			$QuicktimeLanguageLookup[48]  = 'Kazakh';
+			$QuicktimeLanguageLookup[49]  = 'Azerbaijani';
+			$QuicktimeLanguageLookup[50]  = 'AzerbaijanAr';
+			$QuicktimeLanguageLookup[51]  = 'Armenian';
+			$QuicktimeLanguageLookup[52]  = 'Georgian';
+			$QuicktimeLanguageLookup[53]  = 'Moldavian';
+			$QuicktimeLanguageLookup[54]  = 'Kirghiz';
+			$QuicktimeLanguageLookup[55]  = 'Tajiki';
+			$QuicktimeLanguageLookup[56]  = 'Turkmen';
+			$QuicktimeLanguageLookup[57]  = 'Mongolian';
+			$QuicktimeLanguageLookup[58]  = 'MongolianCyr';
+			$QuicktimeLanguageLookup[59]  = 'Pashto';
+			$QuicktimeLanguageLookup[60]  = 'Kurdish';
+			$QuicktimeLanguageLookup[61]  = 'Kashmiri';
+			$QuicktimeLanguageLookup[62]  = 'Sindhi';
+			$QuicktimeLanguageLookup[63]  = 'Tibetan';
+			$QuicktimeLanguageLookup[64]  = 'Nepali';
+			$QuicktimeLanguageLookup[65]  = 'Sanskrit';
+			$QuicktimeLanguageLookup[66]  = 'Marathi';
+			$QuicktimeLanguageLookup[67]  = 'Bengali';
+			$QuicktimeLanguageLookup[68]  = 'Assamese';
+			$QuicktimeLanguageLookup[69]  = 'Gujarati';
+			$QuicktimeLanguageLookup[70]  = 'Punjabi';
+			$QuicktimeLanguageLookup[71]  = 'Oriya';
+			$QuicktimeLanguageLookup[72]  = 'Malayalam';
+			$QuicktimeLanguageLookup[73]  = 'Kannada';
+			$QuicktimeLanguageLookup[74]  = 'Tamil';
+			$QuicktimeLanguageLookup[75]  = 'Telugu';
+			$QuicktimeLanguageLookup[76]  = 'Sinhalese';
+			$QuicktimeLanguageLookup[77]  = 'Burmese';
+			$QuicktimeLanguageLookup[78]  = 'Khmer';
+			$QuicktimeLanguageLookup[79]  = 'Lao';
+			$QuicktimeLanguageLookup[80]  = 'Vietnamese';
+			$QuicktimeLanguageLookup[81]  = 'Indonesian';
+			$QuicktimeLanguageLookup[82]  = 'Tagalog';
+			$QuicktimeLanguageLookup[83]  = 'MalayRoman';
+			$QuicktimeLanguageLookup[84]  = 'MalayArabic';
+			$QuicktimeLanguageLookup[85]  = 'Amharic';
+			$QuicktimeLanguageLookup[86]  = 'Tigrinya';
+			$QuicktimeLanguageLookup[87]  = 'Galla';
+			$QuicktimeLanguageLookup[87]  = 'Oromo';
+			$QuicktimeLanguageLookup[88]  = 'Somali';
+			$QuicktimeLanguageLookup[89]  = 'Swahili';
+			$QuicktimeLanguageLookup[90]  = 'Ruanda';
+			$QuicktimeLanguageLookup[91]  = 'Rundi';
+			$QuicktimeLanguageLookup[92]  = 'Chewa';
+			$QuicktimeLanguageLookup[93]  = 'Malagasy';
+			$QuicktimeLanguageLookup[94]  = 'Esperanto';
+			$QuicktimeLanguageLookup[128] = 'Welsh';
+			$QuicktimeLanguageLookup[129] = 'Basque';
+			$QuicktimeLanguageLookup[130] = 'Catalan';
+			$QuicktimeLanguageLookup[131] = 'Latin';
+			$QuicktimeLanguageLookup[132] = 'Quechua';
+			$QuicktimeLanguageLookup[133] = 'Guarani';
+			$QuicktimeLanguageLookup[134] = 'Aymara';
+			$QuicktimeLanguageLookup[135] = 'Tatar';
+			$QuicktimeLanguageLookup[136] = 'Uighur';
+			$QuicktimeLanguageLookup[137] = 'Dzongkha';
+			$QuicktimeLanguageLookup[138] = 'JavaneseRom';
+		}
+		return (isset($QuicktimeLanguageLookup[$languageid]) ? $QuicktimeLanguageLookup[$languageid] : 'invalid');
+	}
+
+	function QuicktimeVideoCodecLookup($codecid) {
+		static $QuicktimeVideoCodecLookup = array();
+		if (empty($QuicktimeVideoCodecLookup)) {
+			$QuicktimeVideoCodecLookup['3IVX'] = '3ivx MPEG-4';
+			$QuicktimeVideoCodecLookup['3IV1'] = '3ivx MPEG-4 v1';
+			$QuicktimeVideoCodecLookup['3IV2'] = '3ivx MPEG-4 v2';
+			$QuicktimeVideoCodecLookup['avr '] = 'AVR-JPEG';
+			$QuicktimeVideoCodecLookup['base'] = 'Base';
+			$QuicktimeVideoCodecLookup['WRLE'] = 'BMP';
+			$QuicktimeVideoCodecLookup['cvid'] = 'Cinepak';
+			$QuicktimeVideoCodecLookup['clou'] = 'Cloud';
+			$QuicktimeVideoCodecLookup['cmyk'] = 'CMYK';
+			$QuicktimeVideoCodecLookup['yuv2'] = 'ComponentVideo';
+			$QuicktimeVideoCodecLookup['yuvu'] = 'ComponentVideoSigned';
+			$QuicktimeVideoCodecLookup['yuvs'] = 'ComponentVideoUnsigned';
+			$QuicktimeVideoCodecLookup['dvc '] = 'DVC-NTSC';
+			$QuicktimeVideoCodecLookup['dvcp'] = 'DVC-PAL';
+			$QuicktimeVideoCodecLookup['dvpn'] = 'DVCPro-NTSC';
+			$QuicktimeVideoCodecLookup['dvpp'] = 'DVCPro-PAL';
+			$QuicktimeVideoCodecLookup['fire'] = 'Fire';
+			$QuicktimeVideoCodecLookup['flic'] = 'FLC';
+			$QuicktimeVideoCodecLookup['b48r'] = '48RGB';
+			$QuicktimeVideoCodecLookup['gif '] = 'GIF';
+			$QuicktimeVideoCodecLookup['smc '] = 'Graphics';
+			$QuicktimeVideoCodecLookup['h261'] = 'H261';
+			$QuicktimeVideoCodecLookup['h263'] = 'H263';
+			$QuicktimeVideoCodecLookup['IV41'] = 'Indeo4';
+			$QuicktimeVideoCodecLookup['jpeg'] = 'JPEG';
+			$QuicktimeVideoCodecLookup['PNTG'] = 'MacPaint';
+			$QuicktimeVideoCodecLookup['msvc'] = 'Microsoft Video1';
+			$QuicktimeVideoCodecLookup['mjpa'] = 'Motion JPEG-A';
+			$QuicktimeVideoCodecLookup['mjpb'] = 'Motion JPEG-B';
+			$QuicktimeVideoCodecLookup['myuv'] = 'MPEG YUV420';
+			$QuicktimeVideoCodecLookup['dmb1'] = 'OpenDML JPEG';
+			$QuicktimeVideoCodecLookup['kpcd'] = 'PhotoCD';
+			$QuicktimeVideoCodecLookup['8BPS'] = 'Planar RGB';
+			$QuicktimeVideoCodecLookup['png '] = 'PNG';
+			$QuicktimeVideoCodecLookup['qdrw'] = 'QuickDraw';
+			$QuicktimeVideoCodecLookup['qdgx'] = 'QuickDrawGX';
+			$QuicktimeVideoCodecLookup['raw '] = 'RAW';
+			$QuicktimeVideoCodecLookup['.SGI'] = 'SGI';
+			$QuicktimeVideoCodecLookup['b16g'] = '16Gray';
+			$QuicktimeVideoCodecLookup['b64a'] = '64ARGB';
+			$QuicktimeVideoCodecLookup['SVQ1'] = 'Sorenson Video 1';
+			$QuicktimeVideoCodecLookup['SVQ1'] = 'Sorenson Video 3';
+			$QuicktimeVideoCodecLookup['syv9'] = 'Sorenson YUV9';
+			$QuicktimeVideoCodecLookup['tga '] = 'Targa';
+			$QuicktimeVideoCodecLookup['b32a'] = '32AlphaGray';
+			$QuicktimeVideoCodecLookup['tiff'] = 'TIFF';
+			$QuicktimeVideoCodecLookup['path'] = 'Vector';
+			$QuicktimeVideoCodecLookup['rpza'] = 'Video';
+			$QuicktimeVideoCodecLookup['ripl'] = 'WaterRipple';
+			$QuicktimeVideoCodecLookup['WRAW'] = 'Windows RAW';
+			$QuicktimeVideoCodecLookup['y420'] = 'YUV420';
+		}
+		return (isset($QuicktimeVideoCodecLookup[$codecid]) ? $QuicktimeVideoCodecLookup[$codecid] : '');
+	}
+
+	function QuicktimeAudioCodecLookup($codecid) {
+		static $QuicktimeAudioCodecLookup = array();
+		if (empty($QuicktimeAudioCodecLookup)) {
+			$QuicktimeAudioCodecLookup['.mp3']          = 'Fraunhofer MPEG Layer-III alias';
+			$QuicktimeAudioCodecLookup['aac ']          = 'ISO/IEC 14496-3 AAC';
+			$QuicktimeAudioCodecLookup['agsm']          = 'Apple GSM 10:1';
+			$QuicktimeAudioCodecLookup['alac']          = 'Apple Lossless Audio Codec';
+			$QuicktimeAudioCodecLookup['alaw']          = 'A-law 2:1';
+			$QuicktimeAudioCodecLookup['conv']          = 'Sample Format';
+			$QuicktimeAudioCodecLookup['dvca']          = 'DV';
+			$QuicktimeAudioCodecLookup['dvi ']          = 'DV 4:1';
+			$QuicktimeAudioCodecLookup['eqal']          = 'Frequency Equalizer';
+			$QuicktimeAudioCodecLookup['fl32']          = '32-bit Floating Point';
+			$QuicktimeAudioCodecLookup['fl64']          = '64-bit Floating Point';
+			$QuicktimeAudioCodecLookup['ima4']          = 'Interactive Multimedia Association 4:1';
+			$QuicktimeAudioCodecLookup['in24']          = '24-bit Integer';
+			$QuicktimeAudioCodecLookup['in32']          = '32-bit Integer';
+			$QuicktimeAudioCodecLookup['lpc ']          = 'LPC 23:1';
+			$QuicktimeAudioCodecLookup['MAC3']          = 'Macintosh Audio Compression/Expansion (MACE) 3:1';
+			$QuicktimeAudioCodecLookup['MAC6']          = 'Macintosh Audio Compression/Expansion (MACE) 6:1';
+			$QuicktimeAudioCodecLookup['mixb']          = '8-bit Mixer';
+			$QuicktimeAudioCodecLookup['mixw']          = '16-bit Mixer';
+			$QuicktimeAudioCodecLookup['mp4a']          = 'ISO/IEC 14496-3 AAC';
+			$QuicktimeAudioCodecLookup['MS'.&quot;\x00\x02&quot;] = 'Microsoft ADPCM';
+			$QuicktimeAudioCodecLookup['MS'.&quot;\x00\x11&quot;] = 'DV IMA';
+			$QuicktimeAudioCodecLookup['MS'.&quot;\x00\x55&quot;] = 'Fraunhofer MPEG Layer III';
+			$QuicktimeAudioCodecLookup['NONE']          = 'No Encoding';
+			$QuicktimeAudioCodecLookup['Qclp']          = 'Qualcomm PureVoice';
+			$QuicktimeAudioCodecLookup['QDM2']          = 'QDesign Music 2';
+			$QuicktimeAudioCodecLookup['QDMC']          = 'QDesign Music 1';
+			$QuicktimeAudioCodecLookup['ratb']          = '8-bit Rate';
+			$QuicktimeAudioCodecLookup['ratw']          = '16-bit Rate';
+			$QuicktimeAudioCodecLookup['raw ']          = 'raw PCM';
+			$QuicktimeAudioCodecLookup['sour']          = 'Sound Source';
+			$QuicktimeAudioCodecLookup['sowt']          = 'signed/two\'s complement (Little Endian)';
+			$QuicktimeAudioCodecLookup['str1']          = 'Iomega MPEG layer II';
+			$QuicktimeAudioCodecLookup['str2']          = 'Iomega MPEG *layer II';
+			$QuicktimeAudioCodecLookup['str3']          = 'Iomega MPEG **layer II';
+			$QuicktimeAudioCodecLookup['str4']          = 'Iomega MPEG ***layer II';
+			$QuicktimeAudioCodecLookup['twos']          = 'signed/two\'s complement (Big Endian)';
+			$QuicktimeAudioCodecLookup['ulaw']          = 'mu-law 2:1';
+		}
+		return (isset($QuicktimeAudioCodecLookup[$codecid]) ? $QuicktimeAudioCodecLookup[$codecid] : '');
+	}
+
+	function QuicktimeDCOMLookup($compressionid) {
+		static $QuicktimeDCOMLookup = array();
+		if (empty($QuicktimeDCOMLookup)) {
+			$QuicktimeDCOMLookup['zlib'] = 'ZLib Deflate';
+			$QuicktimeDCOMLookup['adec'] = 'Apple Compression';
+		}
+		return (isset($QuicktimeDCOMLookup[$compressionid]) ? $QuicktimeDCOMLookup[$compressionid] : '');
+	}
+
+	function QuicktimeColorNameLookup($colordepthid) {
+		static $QuicktimeColorNameLookup = array();
+		if (empty($QuicktimeColorNameLookup)) {
+			$QuicktimeColorNameLookup[1]  = '2-color (monochrome)';
+			$QuicktimeColorNameLookup[2]  = '4-color';
+			$QuicktimeColorNameLookup[4]  = '16-color';
+			$QuicktimeColorNameLookup[8]  = '256-color';
+			$QuicktimeColorNameLookup[16] = 'thousands (16-bit color)';
+			$QuicktimeColorNameLookup[24] = 'millions (24-bit color)';
+			$QuicktimeColorNameLookup[32] = 'millions+ (32-bit color)';
+			$QuicktimeColorNameLookup[33] = 'black &amp; white';
+			$QuicktimeColorNameLookup[34] = '4-gray';
+			$QuicktimeColorNameLookup[36] = '16-gray';
+			$QuicktimeColorNameLookup[40] = '256-gray';
+		}
+		return (isset($QuicktimeColorNameLookup[$colordepthid]) ? $QuicktimeColorNameLookup[$colordepthid] : 'invalid');
+	}
+
+	function CopyToAppropriateCommentsSection($keyname, $data, &amp;$ThisFileInfo) {
+		static $handyatomtranslatorarray = array();
+		if (empty($handyatomtranslatorarray)) {
+			$handyatomtranslatorarray['&#169;cpy'] = 'copyright';
+			$handyatomtranslatorarray['&#169;day'] = 'creation_date';
+			$handyatomtranslatorarray['&#169;dir'] = 'director';
+			$handyatomtranslatorarray['&#169;ed1'] = 'edit1';
+			$handyatomtranslatorarray['&#169;ed2'] = 'edit2';
+			$handyatomtranslatorarray['&#169;ed3'] = 'edit3';
+			$handyatomtranslatorarray['&#169;ed4'] = 'edit4';
+			$handyatomtranslatorarray['&#169;ed5'] = 'edit5';
+			$handyatomtranslatorarray['&#169;ed6'] = 'edit6';
+			$handyatomtranslatorarray['&#169;ed7'] = 'edit7';
+			$handyatomtranslatorarray['&#169;ed8'] = 'edit8';
+			$handyatomtranslatorarray['&#169;ed9'] = 'edit9';
+			$handyatomtranslatorarray['&#169;fmt'] = 'format';
+			$handyatomtranslatorarray['&#169;inf'] = 'information';
+			$handyatomtranslatorarray['&#169;prd'] = 'producer';
+			$handyatomtranslatorarray['&#169;prf'] = 'performers';
+			$handyatomtranslatorarray['&#169;req'] = 'system_requirements';
+			$handyatomtranslatorarray['&#169;src'] = 'source_credit';
+			$handyatomtranslatorarray['&#169;wrt'] = 'writer';
+
+			// <A HREF="http://www.geocities.com/xhelmboyx/quicktime/formats/qtm-layout.txt">http://www.geocities.com/xhelmboyx/quicktime/formats/qtm-layout.txt</A>
+			$handyatomtranslatorarray['&#169;nam'] = 'title';
+			$handyatomtranslatorarray['&#169;cmt'] = 'comment';
+			$handyatomtranslatorarray['&#169;wrn'] = 'warning';
+			$handyatomtranslatorarray['&#169;hst'] = 'host_computer';
+			$handyatomtranslatorarray['&#169;mak'] = 'make';
+			$handyatomtranslatorarray['&#169;mod'] = 'model';
+			$handyatomtranslatorarray['&#169;PRD'] = 'product';
+			$handyatomtranslatorarray['&#169;swr'] = 'software';
+			$handyatomtranslatorarray['&#169;aut'] = 'author';
+			$handyatomtranslatorarray['&#169;ART'] = 'artist';
+			$handyatomtranslatorarray['&#169;trk'] = 'track';
+			$handyatomtranslatorarray['&#169;alb'] = 'album';
+			$handyatomtranslatorarray['&#169;com'] = 'comment';
+			$handyatomtranslatorarray['&#169;gen'] = 'genre';
+			$handyatomtranslatorarray['&#169;ope'] = 'composer';
+			$handyatomtranslatorarray['&#169;url'] = 'url';
+			$handyatomtranslatorarray['&#169;enc'] = 'encoder';
+		}
+		if (isset($handyatomtranslatorarray[$keyname])) {
+			$ThisFileInfo['quicktime']['comments'][$handyatomtranslatorarray[$keyname]][] = $data;
+		}
+
+		return true;
+	}
+
+	function NoNullString($nullterminatedstring) {
+		// remove the single null terminator on null terminated strings
+		if (substr($nullterminatedstring, strlen($nullterminatedstring) - 1, 1) === &quot;\x00&quot;) {
+			return substr($nullterminatedstring, 0, strlen($nullterminatedstring) - 1);
+		}
+		return $nullterminatedstring;
+	}
+
+	function Pascal2String($pascalstring) {
+		// Pascal strings have 1 unsigned byte at the beginning saying how many chars (1-255) are in the string
+		return substr($pascalstring, 1);
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio-video.quicktime.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio-video.real.php
===================================================================
--- trunk/inc/external/getid3/module.audio-video.real.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio-video.real.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,528 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio-video.real.php                                 //
+// module for analyzing Real Audio/Video files                 //
+// dependencies: module.audio-video.riff.php                   //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio-video.riff.php', __FILE__, true);
+
+class getid3_real
+{
+
+	function getid3_real(&amp;$fd, &amp;$ThisFileInfo) {
+		$ThisFileInfo['fileformat']       = 'real';
+		$ThisFileInfo['bitrate']          = 0;
+		$ThisFileInfo['playtime_seconds'] = 0;
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$ChunkCounter = 0;
+		while (ftell($fd) &lt; $ThisFileInfo['avdataend']) {
+			$ChunkData  = fread($fd, 8);
+			$ChunkName  =                           substr($ChunkData, 0, 4);
+			$ChunkSize  = getid3_lib::BigEndian2Int(substr($ChunkData, 4, 4));
+
+			if ($ChunkName == '.ra'.&quot;\xFD&quot;) {
+				$ChunkData .= fread($fd, $ChunkSize - 8);
+				if ($this-&gt;ParseOldRAheader(substr($ChunkData, 0, 128), $ThisFileInfo['real']['old_ra_header'])) {
+					$ThisFileInfo['audio']['dataformat']      = 'real';
+					$ThisFileInfo['audio']['lossless']        = false;
+					$ThisFileInfo['audio']['sample_rate']     = $ThisFileInfo['real']['old_ra_header']['sample_rate'];
+					$ThisFileInfo['audio']['bits_per_sample'] = $ThisFileInfo['real']['old_ra_header']['bits_per_sample'];
+					$ThisFileInfo['audio']['channels']        = $ThisFileInfo['real']['old_ra_header']['channels'];
+
+					$ThisFileInfo['playtime_seconds']         = 60 * ($ThisFileInfo['real']['old_ra_header']['audio_bytes'] / $ThisFileInfo['real']['old_ra_header']['bytes_per_minute']);
+					$ThisFileInfo['audio']['bitrate']         =  8 * ($ThisFileInfo['real']['old_ra_header']['audio_bytes'] / $ThisFileInfo['playtime_seconds']);
+					$ThisFileInfo['audio']['codec']           = $this-&gt;RealAudioCodecFourCClookup($ThisFileInfo['real']['old_ra_header']['fourcc'], $ThisFileInfo['audio']['bitrate']);
+
+					foreach ($ThisFileInfo['real']['old_ra_header']['comments'] as $key =&gt; $valuearray) {
+						if (strlen(trim($valuearray[0])) &gt; 0) {
+							$ThisFileInfo['real']['comments'][$key][] = trim($valuearray[0]);
+						}
+					}
+					return true;
+				}
+				$ThisFileInfo['error'][] = 'There was a problem parsing this RealAudio file. Please submit it for analysis to <A HREF="http://www.getid3.org/upload/">http://www.getid3.org/upload/</A> or <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>';
+				unset($ThisFileInfo['bitrate']);
+				unset($ThisFileInfo['playtime_seconds']);
+				return false;
+			}
+
+			// shortcut
+			$ThisFileInfo['real']['chunks'][$ChunkCounter] = array();
+			$thisfile_real_chunks_currentchunk = &amp;$ThisFileInfo['real']['chunks'][$ChunkCounter];
+
+			$thisfile_real_chunks_currentchunk['name']   = $ChunkName;
+			$thisfile_real_chunks_currentchunk['offset'] = ftell($fd) - 8;
+			$thisfile_real_chunks_currentchunk['length'] = $ChunkSize;
+			if (($thisfile_real_chunks_currentchunk['offset'] + $thisfile_real_chunks_currentchunk['length']) &gt; $ThisFileInfo['avdataend']) {
+				$ThisFileInfo['warning'][] = 'Chunk &quot;'.$thisfile_real_chunks_currentchunk['name'].'&quot; at offset '.$thisfile_real_chunks_currentchunk['offset'].' claims to be '.$thisfile_real_chunks_currentchunk['length'].' bytes long, which is beyond end of file';
+				return false;
+			}
+
+			if ($ChunkSize &gt; (GETID3_FREAD_BUFFER_SIZE + 8)) {
+
+				$ChunkData .= fread($fd, GETID3_FREAD_BUFFER_SIZE - 8);
+				fseek($fd, $thisfile_real_chunks_currentchunk['offset'] + $ChunkSize, SEEK_SET);
+
+			} else {
+
+				$ChunkData .= fread($fd, $ChunkSize - 8);
+
+			}
+			$offset = 8;
+
+			switch ($ChunkName) {
+
+				case '.RMF': // RealMedia File Header
+					$thisfile_real_chunks_currentchunk['object_version'] = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 2));
+					$offset += 2;
+					switch ($thisfile_real_chunks_currentchunk['object_version']) {
+
+						case 0:
+							$thisfile_real_chunks_currentchunk['file_version']  = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+							$offset += 4;
+							$thisfile_real_chunks_currentchunk['headers_count'] = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+							$offset += 4;
+							break;
+
+						default:
+							//$ThisFileInfo['warning'][] = 'Expected .RMF-object_version to be &quot;0&quot;, actual value is &quot;'.$thisfile_real_chunks_currentchunk['object_version'].'&quot; (should not be a problem)';
+							break;
+
+					}
+					break;
+
+
+				case 'PROP': // Properties Header
+					$thisfile_real_chunks_currentchunk['object_version']      = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 2));
+					$offset += 2;
+					if ($thisfile_real_chunks_currentchunk['object_version'] == 0) {
+						$thisfile_real_chunks_currentchunk['max_bit_rate']    = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['avg_bit_rate']    = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['max_packet_size'] = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['avg_packet_size'] = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['num_packets']     = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['duration']        = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['preroll']         = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['index_offset']    = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['data_offset']     = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['num_streams']     = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 2));
+						$offset += 2;
+						$thisfile_real_chunks_currentchunk['flags_raw']       = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 2));
+						$offset += 2;
+						$ThisFileInfo['playtime_seconds'] = $thisfile_real_chunks_currentchunk['duration'] / 1000;
+						if ($thisfile_real_chunks_currentchunk['duration'] &gt; 0) {
+							$ThisFileInfo['bitrate'] += $thisfile_real_chunks_currentchunk['avg_bit_rate'];
+						}
+						$thisfile_real_chunks_currentchunk['flags']['save_enabled']   = (bool) ($thisfile_real_chunks_currentchunk['flags_raw'] &amp; 0x0001);
+						$thisfile_real_chunks_currentchunk['flags']['perfect_play']   = (bool) ($thisfile_real_chunks_currentchunk['flags_raw'] &amp; 0x0002);
+						$thisfile_real_chunks_currentchunk['flags']['live_broadcast'] = (bool) ($thisfile_real_chunks_currentchunk['flags_raw'] &amp; 0x0004);
+					}
+					break;
+
+				case 'MDPR': // Media Properties Header
+					$thisfile_real_chunks_currentchunk['object_version']         = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 2));
+					$offset += 2;
+					if ($thisfile_real_chunks_currentchunk['object_version'] == 0) {
+						$thisfile_real_chunks_currentchunk['stream_number']      = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 2));
+						$offset += 2;
+						$thisfile_real_chunks_currentchunk['max_bit_rate']       = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['avg_bit_rate']       = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['max_packet_size']    = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['avg_packet_size']    = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['start_time']         = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['preroll']            = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['duration']           = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['stream_name_size']   = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 1));
+						$offset += 1;
+						$thisfile_real_chunks_currentchunk['stream_name']        = substr($ChunkData, $offset, $thisfile_real_chunks_currentchunk['stream_name_size']);
+						$offset += $thisfile_real_chunks_currentchunk['stream_name_size'];
+						$thisfile_real_chunks_currentchunk['mime_type_size']     = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 1));
+						$offset += 1;
+						$thisfile_real_chunks_currentchunk['mime_type']          = substr($ChunkData, $offset, $thisfile_real_chunks_currentchunk['mime_type_size']);
+						$offset += $thisfile_real_chunks_currentchunk['mime_type_size'];
+						$thisfile_real_chunks_currentchunk['type_specific_len']  = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['type_specific_data'] = substr($ChunkData, $offset, $thisfile_real_chunks_currentchunk['type_specific_len']);
+						$offset += $thisfile_real_chunks_currentchunk['type_specific_len'];
+
+						// shortcut
+						$thisfile_real_chunks_currentchunk_typespecificdata = &amp;$thisfile_real_chunks_currentchunk['type_specific_data'];
+
+						switch ($thisfile_real_chunks_currentchunk['mime_type']) {
+							case 'video/x-pn-realvideo':
+							case 'video/x-pn-multirate-realvideo':
+								// <A HREF="http://www.freelists.org/archives/matroska-devel/07-2003/msg00010.html">http://www.freelists.org/archives/matroska-devel/07-2003/msg00010.html</A>
+
+								// shortcut
+								$thisfile_real_chunks_currentchunk['video_info'] = array();
+								$thisfile_real_chunks_currentchunk_videoinfo     = &amp;$thisfile_real_chunks_currentchunk['video_info'];
+
+								$thisfile_real_chunks_currentchunk_videoinfo['dwSize']            = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata,  0, 4));
+								$thisfile_real_chunks_currentchunk_videoinfo['fourcc1']           =                           substr($thisfile_real_chunks_currentchunk_typespecificdata,  4, 4);
+								$thisfile_real_chunks_currentchunk_videoinfo['fourcc2']           =                           substr($thisfile_real_chunks_currentchunk_typespecificdata,  8, 4);
+								$thisfile_real_chunks_currentchunk_videoinfo['width']             = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 12, 2));
+								$thisfile_real_chunks_currentchunk_videoinfo['height']            = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 14, 2));
+								$thisfile_real_chunks_currentchunk_videoinfo['bits_per_sample']   = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 16, 2));
+								//$thisfile_real_chunks_currentchunk_videoinfo['unknown1']          = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 18, 2));
+								//$thisfile_real_chunks_currentchunk_videoinfo['unknown2']          = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 20, 2));
+								$thisfile_real_chunks_currentchunk_videoinfo['frames_per_second'] = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 22, 2));
+								//$thisfile_real_chunks_currentchunk_videoinfo['unknown3']          = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 24, 2));
+								//$thisfile_real_chunks_currentchunk_videoinfo['unknown4']          = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 26, 2));
+								//$thisfile_real_chunks_currentchunk_videoinfo['unknown5']          = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 28, 2));
+								//$thisfile_real_chunks_currentchunk_videoinfo['unknown6']          = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 30, 2));
+								//$thisfile_real_chunks_currentchunk_videoinfo['unknown7']          = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 32, 2));
+								//$thisfile_real_chunks_currentchunk_videoinfo['unknown8']          = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 34, 2));
+								//$thisfile_real_chunks_currentchunk_videoinfo['unknown9']          = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 36, 2));
+
+								$thisfile_real_chunks_currentchunk_videoinfo['codec'] = getid3_riff::RIFFfourccLookup($thisfile_real_chunks_currentchunk_videoinfo['fourcc2']);
+
+								$ThisFileInfo['video']['resolution_x']    =         $thisfile_real_chunks_currentchunk_videoinfo['width'];
+								$ThisFileInfo['video']['resolution_y']    =         $thisfile_real_chunks_currentchunk_videoinfo['height'];
+								$ThisFileInfo['video']['frame_rate']      = (float) $thisfile_real_chunks_currentchunk_videoinfo['frames_per_second'];
+								$ThisFileInfo['video']['codec']           =         $thisfile_real_chunks_currentchunk_videoinfo['codec'];
+								$ThisFileInfo['video']['bits_per_sample'] =         $thisfile_real_chunks_currentchunk_videoinfo['bits_per_sample'];
+								break;
+
+							case 'audio/x-pn-realaudio':
+							case 'audio/x-pn-multirate-realaudio':
+								$this-&gt;ParseOldRAheader($thisfile_real_chunks_currentchunk_typespecificdata, $thisfile_real_chunks_currentchunk['parsed_audio_data']);
+
+								$ThisFileInfo['audio']['sample_rate']     = $thisfile_real_chunks_currentchunk['parsed_audio_data']['sample_rate'];
+								$ThisFileInfo['audio']['bits_per_sample'] = $thisfile_real_chunks_currentchunk['parsed_audio_data']['bits_per_sample'];
+								$ThisFileInfo['audio']['channels']        = $thisfile_real_chunks_currentchunk['parsed_audio_data']['channels'];
+								if (!empty($ThisFileInfo['audio']['dataformat'])) {
+									foreach ($ThisFileInfo['audio'] as $key =&gt; $value) {
+										if ($key != 'streams') {
+											$ThisFileInfo['audio']['streams'][$thisfile_real_chunks_currentchunk['stream_number']][$key] = $value;
+										}
+									}
+								}
+								break;
+
+							case 'logical-fileinfo':
+								// shortcut
+								$thisfile_real_chunks_currentchunk['logical_fileinfo'] = array();
+								$thisfile_real_chunks_currentchunk_logicalfileinfo     = &amp;$thisfile_real_chunks_currentchunk['logical_fileinfo'];
+
+								$thisfile_real_chunks_currentchunk_logicalfileinfo_offset = 0;
+								$thisfile_real_chunks_currentchunk_logicalfileinfo['logical_fileinfo_length'] = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, $thisfile_real_chunks_currentchunk_logicalfileinfo_offset, 4));
+								$thisfile_real_chunks_currentchunk_logicalfileinfo_offset += 4;
+
+								//$thisfile_real_chunks_currentchunk_logicalfileinfo['unknown1']                = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, $thisfile_real_chunks_currentchunk_logicalfileinfo_offset, 4));
+								$thisfile_real_chunks_currentchunk_logicalfileinfo_offset += 4;
+
+								$thisfile_real_chunks_currentchunk_logicalfileinfo['num_tags']                = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, $thisfile_real_chunks_currentchunk_logicalfileinfo_offset, 4));
+								$thisfile_real_chunks_currentchunk_logicalfileinfo_offset += 4;
+
+								//$thisfile_real_chunks_currentchunk_logicalfileinfo['unknown2']                = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, $thisfile_real_chunks_currentchunk_logicalfileinfo_offset, 4));
+								$thisfile_real_chunks_currentchunk_logicalfileinfo_offset += 4;
+
+								//$thisfile_real_chunks_currentchunk_logicalfileinfo['d']                       = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, $thisfile_real_chunks_currentchunk_logicalfileinfo_offset, 1));
+
+								//$thisfile_real_chunks_currentchunk_logicalfileinfo['one_type'] = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata,     $thisfile_real_chunks_currentchunk_logicalfileinfo_offset, 4));
+								//$thisfile_real_chunks_currentchunk_logicalfileinfo_thislength  = getid3_lib::BigEndian2Int(substr($thisfile_real_chunks_currentchunk_typespecificdata, 4 + $thisfile_real_chunks_currentchunk_logicalfileinfo_offset, 2));
+								//$thisfile_real_chunks_currentchunk_logicalfileinfo['one']      =                           substr($thisfile_real_chunks_currentchunk_typespecificdata, 6 + $thisfile_real_chunks_currentchunk_logicalfileinfo_offset, $thisfile_real_chunks_currentchunk_logicalfileinfo_thislength);
+								//$thisfile_real_chunks_currentchunk_logicalfileinfo_offset += (6 + $thisfile_real_chunks_currentchunk_logicalfileinfo_thislength);
+
+								break;
+
+						}
+
+
+						if (empty($ThisFileInfo['playtime_seconds'])) {
+							$ThisFileInfo['playtime_seconds'] = max($ThisFileInfo['playtime_seconds'], ($thisfile_real_chunks_currentchunk['duration'] + $thisfile_real_chunks_currentchunk['start_time']) / 1000);
+						}
+						if ($thisfile_real_chunks_currentchunk['duration'] &gt; 0) {
+							switch ($thisfile_real_chunks_currentchunk['mime_type']) {
+								case 'audio/x-pn-realaudio':
+								case 'audio/x-pn-multirate-realaudio':
+									$ThisFileInfo['audio']['bitrate']    = (isset($ThisFileInfo['audio']['bitrate']) ? $ThisFileInfo['audio']['bitrate'] : 0) + $thisfile_real_chunks_currentchunk['avg_bit_rate'];
+									$ThisFileInfo['audio']['codec']      = $this-&gt;RealAudioCodecFourCClookup($thisfile_real_chunks_currentchunk['parsed_audio_data']['fourcc'], $ThisFileInfo['audio']['bitrate']);
+									$ThisFileInfo['audio']['dataformat'] = 'real';
+									$ThisFileInfo['audio']['lossless']   = false;
+									break;
+
+								case 'video/x-pn-realvideo':
+								case 'video/x-pn-multirate-realvideo':
+									$ThisFileInfo['video']['bitrate']            = (isset($ThisFileInfo['video']['bitrate']) ? $ThisFileInfo['video']['bitrate'] : 0) + $thisfile_real_chunks_currentchunk['avg_bit_rate'];
+									$ThisFileInfo['video']['bitrate_mode']       = 'cbr';
+									$ThisFileInfo['video']['dataformat']         = 'real';
+									$ThisFileInfo['video']['lossless']           = false;
+									$ThisFileInfo['video']['pixel_aspect_ratio'] = (float) 1;
+									break;
+
+								case 'audio/x-ralf-mpeg4-generic':
+									$ThisFileInfo['audio']['bitrate']    = (isset($ThisFileInfo['audio']['bitrate']) ? $ThisFileInfo['audio']['bitrate'] : 0) + $thisfile_real_chunks_currentchunk['avg_bit_rate'];
+									$ThisFileInfo['audio']['codec']      = 'RealAudio Lossless';
+									$ThisFileInfo['audio']['dataformat'] = 'real';
+									$ThisFileInfo['audio']['lossless']   = true;
+									break;
+							}
+							$ThisFileInfo['bitrate'] = (isset($ThisFileInfo['video']['bitrate']) ? $ThisFileInfo['video']['bitrate'] : 0) + (isset($ThisFileInfo['audio']['bitrate']) ? $ThisFileInfo['audio']['bitrate'] : 0);
+						}
+					}
+					break;
+
+				case 'CONT': // Content Description Header (text comments)
+					$thisfile_real_chunks_currentchunk['object_version'] = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 2));
+					$offset += 2;
+					if ($thisfile_real_chunks_currentchunk['object_version'] == 0) {
+						$thisfile_real_chunks_currentchunk['title_len'] = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 2));
+						$offset += 2;
+						$thisfile_real_chunks_currentchunk['title'] = (string) substr($ChunkData, $offset, $thisfile_real_chunks_currentchunk['title_len']);
+						$offset += $thisfile_real_chunks_currentchunk['title_len'];
+
+						$thisfile_real_chunks_currentchunk['artist_len'] = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 2));
+						$offset += 2;
+						$thisfile_real_chunks_currentchunk['artist'] = (string) substr($ChunkData, $offset, $thisfile_real_chunks_currentchunk['artist_len']);
+						$offset += $thisfile_real_chunks_currentchunk['artist_len'];
+
+						$thisfile_real_chunks_currentchunk['copyright_len'] = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 2));
+						$offset += 2;
+						$thisfile_real_chunks_currentchunk['copyright'] = (string) substr($ChunkData, $offset, $thisfile_real_chunks_currentchunk['copyright_len']);
+						$offset += $thisfile_real_chunks_currentchunk['copyright_len'];
+
+						$thisfile_real_chunks_currentchunk['comment_len'] = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 2));
+						$offset += 2;
+						$thisfile_real_chunks_currentchunk['comment'] = (string) substr($ChunkData, $offset, $thisfile_real_chunks_currentchunk['comment_len']);
+						$offset += $thisfile_real_chunks_currentchunk['comment_len'];
+
+
+						$commentkeystocopy = array('title'=&gt;'title', 'artist'=&gt;'artist', 'copyright'=&gt;'copyright', 'comment'=&gt;'comment');
+						foreach ($commentkeystocopy as $key =&gt; $val) {
+							if ($thisfile_real_chunks_currentchunk[$key]) {
+								$ThisFileInfo['real']['comments'][$val][] = trim($thisfile_real_chunks_currentchunk[$key]);
+							}
+						}
+
+					}
+					break;
+
+
+				case 'DATA': // Data Chunk Header
+					// do nothing
+					break;
+
+				case 'INDX': // Index Section Header
+					$thisfile_real_chunks_currentchunk['object_version']        = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 2));
+					$offset += 2;
+					if ($thisfile_real_chunks_currentchunk['object_version'] == 0) {
+						$thisfile_real_chunks_currentchunk['num_indices']       = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+						$thisfile_real_chunks_currentchunk['stream_number']     = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 2));
+						$offset += 2;
+						$thisfile_real_chunks_currentchunk['next_index_header'] = getid3_lib::BigEndian2Int(substr($ChunkData, $offset, 4));
+						$offset += 4;
+
+						if ($thisfile_real_chunks_currentchunk['next_index_header'] == 0) {
+							// last index chunk found, ignore rest of file
+							break 2;
+						} else {
+							// non-last index chunk, seek to next index chunk (skipping actual index data)
+							fseek($fd, $thisfile_real_chunks_currentchunk['next_index_header'], SEEK_SET);
+						}
+					}
+					break;
+
+				default:
+					$ThisFileInfo['warning'][] = 'Unhandled RealMedia chunk &quot;'.$ChunkName.'&quot; at offset '.$thisfile_real_chunks_currentchunk['offset'];
+					break;
+			}
+			$ChunkCounter++;
+		}
+
+		if (!empty($ThisFileInfo['audio']['streams'])) {
+			$ThisFileInfo['audio']['bitrate'] = 0;
+			foreach ($ThisFileInfo['audio']['streams'] as $key =&gt; $valuearray) {
+				$ThisFileInfo['audio']['bitrate'] += $valuearray['bitrate'];
+			}
+		}
+
+		return true;
+	}
+
+
+	function ParseOldRAheader($OldRAheaderData, &amp;$ParsedArray) {
+		// <A HREF="http://www.freelists.org/archives/matroska-devel/07-2003/msg00010.html">http://www.freelists.org/archives/matroska-devel/07-2003/msg00010.html</A>
+
+		$ParsedArray = array();
+		$ParsedArray['magic'] = substr($OldRAheaderData, 0, 4);
+		if ($ParsedArray['magic'] != '.ra'.&quot;\xFD&quot;) {
+			return false;
+		}
+		$ParsedArray['version1']         = getid3_lib::BigEndian2Int(substr($OldRAheaderData,  4, 2));
+
+		if ($ParsedArray['version1'] &lt; 3) {
+
+			return false;
+
+		} elseif ($ParsedArray['version1'] == 3) {
+
+			$ParsedArray['fourcc1']          = '.ra3';
+			$ParsedArray['bits_per_sample']  = 16;   // hard-coded for old versions?
+			$ParsedArray['sample_rate']      = 8000; // hard-coded for old versions?
+
+			$ParsedArray['header_size']      = getid3_lib::BigEndian2Int(substr($OldRAheaderData,  6, 2));
+			$ParsedArray['channels']         = getid3_lib::BigEndian2Int(substr($OldRAheaderData,  8, 2)); // always 1 (?)
+			//$ParsedArray['unknown1']         = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 10, 2));
+			//$ParsedArray['unknown2']         = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 12, 2));
+			//$ParsedArray['unknown3']         = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 14, 2));
+			$ParsedArray['bytes_per_minute'] = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 16, 2));
+			$ParsedArray['audio_bytes']      = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 18, 4));
+			$ParsedArray['comments_raw']     =                           substr($OldRAheaderData, 22, $ParsedArray['header_size'] - 22 + 1); // not including null terminator
+
+			$commentoffset = 0;
+			$commentlength = getid3_lib::BigEndian2Int(substr($ParsedArray['comments_raw'], $commentoffset++, 1));
+			$ParsedArray['comments']['title'][]     = substr($ParsedArray['comments_raw'], $commentoffset, $commentlength);
+			$commentoffset += $commentlength;
+
+			$commentlength = getid3_lib::BigEndian2Int(substr($ParsedArray['comments_raw'], $commentoffset++, 1));
+			$ParsedArray['comments']['artist'][]    = substr($ParsedArray['comments_raw'], $commentoffset, $commentlength);
+			$commentoffset += $commentlength;
+
+			$commentlength = getid3_lib::BigEndian2Int(substr($ParsedArray['comments_raw'], $commentoffset++, 1));
+			$ParsedArray['comments']['copyright'][] = substr($ParsedArray['comments_raw'], $commentoffset, $commentlength);
+			$commentoffset += $commentlength;
+
+			$commentoffset++; // final null terminator (?)
+			$commentoffset++; // fourcc length (?) should be 4
+			$ParsedArray['fourcc']           =                           substr($OldRAheaderData, 23 + $commentoffset, 4);
+
+		} elseif ($ParsedArray['version1'] &lt;= 5) {
+
+			//$ParsedArray['unknown1']         = getid3_lib::BigEndian2Int(substr($OldRAheaderData,  6, 2));
+			$ParsedArray['fourcc1']          =                           substr($OldRAheaderData,  8, 4);
+			$ParsedArray['file_size']        = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 12, 4));
+			$ParsedArray['version2']         = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 16, 2));
+			$ParsedArray['header_size']      = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 18, 4));
+			$ParsedArray['codec_flavor_id']  = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 22, 2));
+			$ParsedArray['coded_frame_size'] = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 24, 4));
+			$ParsedArray['audio_bytes']      = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 28, 4));
+			$ParsedArray['bytes_per_minute'] = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 32, 4));
+			//$ParsedArray['unknown5']         = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 36, 4));
+			$ParsedArray['sub_packet_h']     = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 40, 2));
+			$ParsedArray['frame_size']       = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 42, 2));
+			$ParsedArray['sub_packet_size']  = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 44, 2));
+			//$ParsedArray['unknown6']         = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 46, 2));
+
+			switch ($ParsedArray['version1']) {
+
+				case 4:
+					$ParsedArray['sample_rate']      = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 48, 2));
+					//$ParsedArray['unknown8']         = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 50, 2));
+					$ParsedArray['bits_per_sample']  = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 52, 2));
+					$ParsedArray['channels']         = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 54, 2));
+					$ParsedArray['length_fourcc2']   = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 56, 1));
+					$ParsedArray['fourcc2']          =                           substr($OldRAheaderData, 57, 4);
+					$ParsedArray['length_fourcc3']   = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 61, 1));
+					$ParsedArray['fourcc3']          =                           substr($OldRAheaderData, 62, 4);
+					//$ParsedArray['unknown9']         = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 66, 1));
+					//$ParsedArray['unknown10']        = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 67, 2));
+					$ParsedArray['comments_raw']     =                           substr($OldRAheaderData, 69, $ParsedArray['header_size'] - 69 + 16);
+
+					$commentoffset = 0;
+					$commentlength = getid3_lib::BigEndian2Int(substr($ParsedArray['comments_raw'], $commentoffset++, 1));
+					$ParsedArray['comments']['title'][]     = substr($ParsedArray['comments_raw'], $commentoffset, $commentlength);
+					$commentoffset += $commentlength;
+
+					$commentlength = getid3_lib::BigEndian2Int(substr($ParsedArray['comments_raw'], $commentoffset++, 1));
+					$ParsedArray['comments']['artist'][]    = substr($ParsedArray['comments_raw'], $commentoffset, $commentlength);
+					$commentoffset += $commentlength;
+
+					$commentlength = getid3_lib::BigEndian2Int(substr($ParsedArray['comments_raw'], $commentoffset++, 1));
+					$ParsedArray['comments']['copyright'][] = substr($ParsedArray['comments_raw'], $commentoffset, $commentlength);
+					$commentoffset += $commentlength;
+					break;
+
+				case 5:
+					$ParsedArray['sample_rate']      = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 48, 4));
+					$ParsedArray['sample_rate2']     = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 52, 4));
+					$ParsedArray['bits_per_sample']  = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 56, 4));
+					$ParsedArray['channels']         = getid3_lib::BigEndian2Int(substr($OldRAheaderData, 60, 2));
+					$ParsedArray['genr']             =                           substr($OldRAheaderData, 62, 4);
+					$ParsedArray['fourcc3']          =                           substr($OldRAheaderData, 66, 4);
+					$ParsedArray['comments']         = array();
+					break;
+			}
+			$ParsedArray['fourcc'] = $ParsedArray['fourcc3'];
+
+		}
+		foreach ($ParsedArray['comments'] as $key =&gt; $value) {
+			if ($ParsedArray['comments'][$key][0] === false) {
+				$ParsedArray['comments'][$key][0] = '';
+			}
+		}
+
+		return true;
+	}
+
+	function RealAudioCodecFourCClookup($fourcc, $bitrate) {
+		static $RealAudioCodecFourCClookup = array();
+		if (empty($RealAudioCodecFourCClookup)) {
+			// <A HREF="http://www.its.msstate.edu/net/real/reports/config/tags.stats">http://www.its.msstate.edu/net/real/reports/config/tags.stats</A>
+			// <A HREF="http://www.freelists.org/archives/matroska-devel/06-2003/fullthread18.html">http://www.freelists.org/archives/matroska-devel/06-2003/fullthread18.html</A>
+
+			$RealAudioCodecFourCClookup['14_4'][8000]  = 'RealAudio v2 (14.4kbps)';
+			$RealAudioCodecFourCClookup['14.4'][8000]  = 'RealAudio v2 (14.4kbps)';
+			$RealAudioCodecFourCClookup['lpcJ'][8000]  = 'RealAudio v2 (14.4kbps)';
+			$RealAudioCodecFourCClookup['28_8'][15200] = 'RealAudio v2 (28.8kbps)';
+			$RealAudioCodecFourCClookup['28.8'][15200] = 'RealAudio v2 (28.8kbps)';
+			$RealAudioCodecFourCClookup['sipr'][4933]  = 'RealAudio v4 (5kbps Voice)';
+			$RealAudioCodecFourCClookup['sipr'][6444]  = 'RealAudio v4 (6.5kbps Voice)';
+			$RealAudioCodecFourCClookup['sipr'][8444]  = 'RealAudio v4 (8.5kbps Voice)';
+			$RealAudioCodecFourCClookup['sipr'][16000] = 'RealAudio v4 (16kbps Wideband)';
+			$RealAudioCodecFourCClookup['dnet'][8000]  = 'RealAudio v3 (8kbps Music)';
+			$RealAudioCodecFourCClookup['dnet'][16000] = 'RealAudio v3 (16kbps Music Low Response)';
+			$RealAudioCodecFourCClookup['dnet'][15963] = 'RealAudio v3 (16kbps Music Mid/High Response)';
+			$RealAudioCodecFourCClookup['dnet'][20000] = 'RealAudio v3 (20kbps Music Stereo)';
+			$RealAudioCodecFourCClookup['dnet'][32000] = 'RealAudio v3 (32kbps Music Mono)';
+			$RealAudioCodecFourCClookup['dnet'][31951] = 'RealAudio v3 (32kbps Music Stereo)';
+			$RealAudioCodecFourCClookup['dnet'][39965] = 'RealAudio v3 (40kbps Music Mono)';
+			$RealAudioCodecFourCClookup['dnet'][40000] = 'RealAudio v3 (40kbps Music Stereo)';
+			$RealAudioCodecFourCClookup['dnet'][79947] = 'RealAudio v3 (80kbps Music Mono)';
+			$RealAudioCodecFourCClookup['dnet'][80000] = 'RealAudio v3 (80kbps Music Stereo)';
+
+			$RealAudioCodecFourCClookup['dnet'][0] = 'RealAudio v3';
+			$RealAudioCodecFourCClookup['sipr'][0] = 'RealAudio v4';
+			$RealAudioCodecFourCClookup['cook'][0] = 'RealAudio G2';
+			$RealAudioCodecFourCClookup['atrc'][0] = 'RealAudio 8';
+		}
+		$roundbitrate = intval(round($bitrate));
+		if (isset($RealAudioCodecFourCClookup[$fourcc][$roundbitrate])) {
+			return $RealAudioCodecFourCClookup[$fourcc][$roundbitrate];
+		} elseif (isset($RealAudioCodecFourCClookup[$fourcc][0])) {
+			return $RealAudioCodecFourCClookup[$fourcc][0];
+		}
+		return $fourcc;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio-video.real.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio-video.riff.php
===================================================================
--- trunk/inc/external/getid3/module.audio-video.riff.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio-video.riff.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,1995 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio-video.riff.php                                 //
+// module for analyzing RIFF files                             //
+// multiple formats supported by this module:                  //
+//    Wave, AVI, AIFF/AIFC, (MP3,AC3)/RIFF, Wavpack v3, 8SVX   //
+// dependencies: module.audio.mp3.php                          //
+//               module.audio.ac3.php (optional)               //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio.mp3.php', __FILE__, true);
+
+class getid3_riff
+{
+
+	function getid3_riff(&amp;$fd, &amp;$ThisFileInfo) {
+
+		// initialize these values to an empty array, otherwise they default to NULL
+		// and you can't append array values to a NULL value
+		$ThisFileInfo['riff'] = array('raw'=&gt;array());
+
+		// Shortcuts
+		$thisfile_riff             = &amp;$ThisFileInfo['riff'];
+		$thisfile_riff_raw         = &amp;$thisfile_riff['raw'];
+		$thisfile_audio            = &amp;$ThisFileInfo['audio'];
+		$thisfile_video            = &amp;$ThisFileInfo['video'];
+		$thisfile_avdataoffset     = &amp;$ThisFileInfo['avdataoffset'];
+		$thisfile_avdataend        = &amp;$ThisFileInfo['avdataend'];
+		$thisfile_audio_dataformat = &amp;$thisfile_audio['dataformat'];
+		$thisfile_riff_audio       = &amp;$thisfile_riff['audio'];
+		$thisfile_riff_video       = &amp;$thisfile_riff['video'];
+
+
+		$Original['avdataoffset'] = $thisfile_avdataoffset;
+		$Original['avdataend']    = $thisfile_avdataend;
+
+		fseek($fd, $thisfile_avdataoffset, SEEK_SET);
+		$RIFFheader = fread($fd, 12);
+		$RIFFsubtype = substr($RIFFheader, 8, 4);
+		switch (substr($RIFFheader, 0, 4)) {
+			case 'FORM':
+				$ThisFileInfo['fileformat']   = 'aiff';
+				$RIFFheaderSize               = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($RIFFheader, 4, 4));
+				$thisfile_riff[$RIFFsubtype]  = getid3_riff::ParseRIFF($fd, $thisfile_avdataoffset + 12, $thisfile_avdataoffset + $RIFFheaderSize, $ThisFileInfo);
+				$thisfile_riff['header_size'] = $RIFFheaderSize;
+				break;
+
+			case 'RIFF':
+			case 'SDSS':  // SDSS is identical to RIFF, just renamed. Used by SmartSound QuickTracks (www.smartsound.com)
+			case 'RMP3':  // RMP3 is identical to RIFF, just renamed. Used by [unknown program] when creating RIFF-MP3s
+				if ($RIFFsubtype == 'RMP3') {
+					// RMP3 is identical to WAVE, just renamed. Used by [unknown program] when creating RIFF-MP3s
+					$RIFFsubtype = 'WAVE';
+				}
+
+				$ThisFileInfo['fileformat']   = 'riff';
+				$RIFFheaderSize               = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($RIFFheader, 4, 4));
+				$thisfile_riff[$RIFFsubtype]  = getid3_riff::ParseRIFF($fd, $thisfile_avdataoffset + 12, $thisfile_avdataoffset + $RIFFheaderSize, $ThisFileInfo);
+				$thisfile_riff['header_size'] = $RIFFheaderSize;
+				if ($RIFFsubtype == 'WAVE') {
+					$thisfile_riff_WAVE = &amp;$thisfile_riff['WAVE'];
+				}
+				break;
+
+			default:
+				$ThisFileInfo['error'][] = 'Cannot parse RIFF (this is maybe not a RIFF / WAV / AVI file?) - expecting &quot;FORM|RIFF|SDSS|RMP3&quot; found &quot;'.$RIFFsubtype.'&quot; instead';
+				unset($ThisFileInfo['fileformat']);
+				return false;
+				break;
+		}
+
+		$streamindex = 0;
+		switch ($RIFFsubtype) {
+			case 'WAVE':
+				if (empty($thisfile_audio['bitrate_mode'])) {
+					$thisfile_audio['bitrate_mode'] = 'cbr';
+				}
+				if (empty($thisfile_audio_dataformat)) {
+					$thisfile_audio_dataformat = 'wav';
+				}
+
+				if (isset($thisfile_riff_WAVE['data'][0]['offset'])) {
+					$thisfile_avdataoffset = $thisfile_riff_WAVE['data'][0]['offset'] + 8;
+					$thisfile_avdataend    = $thisfile_avdataoffset + $thisfile_riff_WAVE['data'][0]['size'];
+				}
+				if (isset($thisfile_riff_WAVE['fmt '][0]['data'])) {
+
+					$thisfile_riff_audio[$streamindex] = getid3_riff::RIFFparseWAVEFORMATex($thisfile_riff_WAVE['fmt '][0]['data']);
+					$thisfile_audio['wformattag'] = $thisfile_riff_audio[$streamindex]['raw']['wFormatTag'];
+					if (@$thisfile_riff_audio[$streamindex]['bitrate'] == 0) {
+						$ThisFileInfo['error'][] = 'Corrupt RIFF file: bitrate_audio == zero';
+						return false;
+					}
+					$thisfile_riff_raw['fmt '] = $thisfile_riff_audio[$streamindex]['raw'];
+					unset($thisfile_riff_audio[$streamindex]['raw']);
+					$thisfile_audio['streams'][$streamindex] = $thisfile_riff_audio[$streamindex];
+
+					$thisfile_audio = getid3_lib::array_merge_noclobber($thisfile_audio, $thisfile_riff_audio[$streamindex]);
+					if (substr($thisfile_audio['codec'], 0, strlen('unknown: 0x')) == 'unknown: 0x') {
+						$ThisFileInfo['warning'][] = 'Audio codec = '.$thisfile_audio['codec'];
+					}
+					$thisfile_audio['bitrate'] = $thisfile_riff_audio[$streamindex]['bitrate'];
+
+					$ThisFileInfo['playtime_seconds'] = (float) ((($thisfile_avdataend - $thisfile_avdataoffset) * 8) / $thisfile_audio['bitrate']);
+
+					if (isset($thisfile_riff_WAVE['data'][0]['offset']) &amp;&amp; isset($thisfile_riff_raw['fmt ']['wFormatTag'])) {
+						$thisfile_audio['lossless'] = false;
+						switch ($thisfile_riff_raw['fmt ']['wFormatTag']) {
+
+							case 0x0001:  // PCM
+								$thisfile_audio['lossless'] = true;
+								break;
+
+							case 0x2000:  // AC-3
+								$thisfile_audio_dataformat = 'ac3';
+								break;
+
+							default:
+								// do nothing
+								break;
+
+						}
+					}
+					$thisfile_audio['streams'][$streamindex]['wformattag']   = $thisfile_audio['wformattag'];
+					$thisfile_audio['streams'][$streamindex]['bitrate_mode'] = $thisfile_audio['bitrate_mode'];
+					$thisfile_audio['streams'][$streamindex]['lossless']     = $thisfile_audio['lossless'];
+					$thisfile_audio['streams'][$streamindex]['dataformat']   = $thisfile_audio_dataformat;
+				}
+
+				if (isset($thisfile_riff_WAVE['rgad'][0]['data'])) {
+
+					// shortcuts
+					$rgadData = &amp;$thisfile_riff_WAVE['rgad'][0]['data'];
+					$thisfile_riff_raw['rgad']    = array('track'=&gt;array(), 'album'=&gt;array());
+					$thisfile_riff_raw_rgad       = &amp;$thisfile_riff_raw['rgad'];
+					$thisfile_riff_raw_rgad_track = &amp;$thisfile_riff_raw_rgad['track'];
+					$thisfile_riff_raw_rgad_album = &amp;$thisfile_riff_raw_rgad['album'];
+
+					$thisfile_riff_raw_rgad['fPeakAmplitude']      =               getid3_lib::LittleEndian2Float(substr($rgadData, 0, 4));
+					$thisfile_riff_raw_rgad['nRadioRgAdjust']      = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($rgadData, 4, 2));
+					$thisfile_riff_raw_rgad['nAudiophileRgAdjust'] = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($rgadData, 6, 2));
+
+					$nRadioRgAdjustBitstring      = str_pad(getid3_lib::Dec2Bin($thisfile_riff_raw_rgad['nRadioRgAdjust']), 16, '0', STR_PAD_LEFT);
+					$nAudiophileRgAdjustBitstring = str_pad(getid3_lib::Dec2Bin($thisfile_riff_raw_rgad['nAudiophileRgAdjust']), 16, '0', STR_PAD_LEFT);
+					$thisfile_riff_raw_rgad_track['name']       = getid3_lib::Bin2Dec(substr($nRadioRgAdjustBitstring, 0, 3));
+					$thisfile_riff_raw_rgad_track['originator'] = getid3_lib::Bin2Dec(substr($nRadioRgAdjustBitstring, 3, 3));
+					$thisfile_riff_raw_rgad_track['signbit']    = getid3_lib::Bin2Dec(substr($nRadioRgAdjustBitstring, 6, 1));
+					$thisfile_riff_raw_rgad_track['adjustment'] = getid3_lib::Bin2Dec(substr($nRadioRgAdjustBitstring, 7, 9));
+					$thisfile_riff_raw_rgad_album['name']       = getid3_lib::Bin2Dec(substr($nAudiophileRgAdjustBitstring, 0, 3));
+					$thisfile_riff_raw_rgad_album['originator'] = getid3_lib::Bin2Dec(substr($nAudiophileRgAdjustBitstring, 3, 3));
+					$thisfile_riff_raw_rgad_album['signbit']    = getid3_lib::Bin2Dec(substr($nAudiophileRgAdjustBitstring, 6, 1));
+					$thisfile_riff_raw_rgad_album['adjustment'] = getid3_lib::Bin2Dec(substr($nAudiophileRgAdjustBitstring, 7, 9));
+
+					$thisfile_riff['rgad']['peakamplitude'] = $thisfile_riff_raw_rgad['fPeakAmplitude'];
+					if (($thisfile_riff_raw_rgad_track['name'] != 0) &amp;&amp; ($thisfile_riff_raw_rgad_track['originator'] != 0)) {
+						$thisfile_riff['rgad']['track']['name']            = getid3_lib::RGADnameLookup($thisfile_riff_raw_rgad_track['name']);
+						$thisfile_riff['rgad']['track']['originator']      = getid3_lib::RGADoriginatorLookup($thisfile_riff_raw_rgad_track['originator']);
+						$thisfile_riff['rgad']['track']['adjustment']      = getid3_lib::RGADadjustmentLookup($thisfile_riff_raw_rgad_track['adjustment'], $thisfile_riff_raw_rgad_track['signbit']);
+					}
+					if (($thisfile_riff_raw_rgad_album['name'] != 0) &amp;&amp; ($thisfile_riff_raw_rgad_album['originator'] != 0)) {
+						$thisfile_riff['rgad']['album']['name']       = getid3_lib::RGADnameLookup($thisfile_riff_raw_rgad_album['name']);
+						$thisfile_riff['rgad']['album']['originator'] = getid3_lib::RGADoriginatorLookup($thisfile_riff_raw_rgad_album['originator']);
+						$thisfile_riff['rgad']['album']['adjustment'] = getid3_lib::RGADadjustmentLookup($thisfile_riff_raw_rgad_album['adjustment'], $thisfile_riff_raw_rgad_album['signbit']);
+					}
+				}
+
+				if (isset($thisfile_riff_WAVE['fact'][0]['data'])) {
+					$thisfile_riff_raw['fact']['NumberOfSamples'] = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($thisfile_riff_WAVE['fact'][0]['data'], 0, 4));
+
+					// This should be a good way of calculating exact playtime,
+					// but some sample files have had incorrect number of samples,
+					// so cannot use this method
+
+					// if (!empty($thisfile_riff_raw['fmt ']['nSamplesPerSec'])) {
+					//     $ThisFileInfo['playtime_seconds'] = (float) $thisfile_riff_raw['fact']['NumberOfSamples'] / $thisfile_riff_raw['fmt ']['nSamplesPerSec'];
+					// }
+				}
+				if (!empty($thisfile_riff_raw['fmt ']['nAvgBytesPerSec'])) {
+					$thisfile_audio['bitrate'] = getid3_lib::CastAsInt($thisfile_riff_raw['fmt ']['nAvgBytesPerSec'] * 8);
+				}
+
+				if (isset($thisfile_riff_WAVE['bext'][0]['data'])) {
+					// shortcut
+					$thisfile_riff_WAVE_bext_0 = &amp;$thisfile_riff_WAVE['bext'][0];
+
+					$thisfile_riff_WAVE_bext_0['title']          =                         trim(substr($thisfile_riff_WAVE_bext_0['data'],   0, 256));
+					$thisfile_riff_WAVE_bext_0['author']         =                         trim(substr($thisfile_riff_WAVE_bext_0['data'], 256,  32));
+					$thisfile_riff_WAVE_bext_0['reference']      =                         trim(substr($thisfile_riff_WAVE_bext_0['data'], 288,  32));
+					$thisfile_riff_WAVE_bext_0['origin_date']    =                              substr($thisfile_riff_WAVE_bext_0['data'], 320,  10);
+					$thisfile_riff_WAVE_bext_0['origin_time']    =                              substr($thisfile_riff_WAVE_bext_0['data'], 330,   8);
+					$thisfile_riff_WAVE_bext_0['time_reference'] = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE_bext_0['data'], 338,   8));
+					$thisfile_riff_WAVE_bext_0['bwf_version']    = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE_bext_0['data'], 346,   1));
+					$thisfile_riff_WAVE_bext_0['reserved']       = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE_bext_0['data'], 347, 254));
+					$thisfile_riff_WAVE_bext_0['coding_history'] =         explode(&quot;\r\n&quot;, trim(substr($thisfile_riff_WAVE_bext_0['data'], 601)));
+
+					$thisfile_riff_WAVE_bext_0['origin_date_unix'] = mktime(
+																				substr($thisfile_riff_WAVE_bext_0['origin_time'], 0, 2),
+																				substr($thisfile_riff_WAVE_bext_0['origin_time'], 3, 2),
+																				substr($thisfile_riff_WAVE_bext_0['origin_time'], 6, 2),
+																				substr($thisfile_riff_WAVE_bext_0['origin_date'], 5, 2),
+																				substr($thisfile_riff_WAVE_bext_0['origin_date'], 8, 2),
+																				substr($thisfile_riff_WAVE_bext_0['origin_date'], 0, 4));
+
+					$thisfile_riff['comments']['author'][] = $thisfile_riff_WAVE_bext_0['author'];
+					$thisfile_riff['comments']['title'][]  = $thisfile_riff_WAVE_bext_0['title'];
+				}
+
+				if (isset($thisfile_riff_WAVE['MEXT'][0]['data'])) {
+					// shortcut
+					$thisfile_riff_WAVE_MEXT_0 = &amp;$thisfile_riff_WAVE['MEXT'][0];
+
+					$thisfile_riff_WAVE_MEXT_0['raw']['sound_information']      = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE_MEXT_0['data'], 0, 2));
+					$thisfile_riff_WAVE_MEXT_0['flags']['homogenous']           = (bool) ($thisfile_riff_WAVE_MEXT_0['raw']['sound_information'] &amp; 0x0001);
+					if ($thisfile_riff_WAVE_MEXT_0['flags']['homogenous']) {
+						$thisfile_riff_WAVE_MEXT_0['flags']['padding']          = ($thisfile_riff_WAVE_MEXT_0['raw']['sound_information'] &amp; 0x0002) ? false : true;
+						$thisfile_riff_WAVE_MEXT_0['flags']['22_or_44']         =        (bool) ($thisfile_riff_WAVE_MEXT_0['raw']['sound_information'] &amp; 0x0004);
+						$thisfile_riff_WAVE_MEXT_0['flags']['free_format']      =        (bool) ($thisfile_riff_WAVE_MEXT_0['raw']['sound_information'] &amp; 0x0008);
+
+						$thisfile_riff_WAVE_MEXT_0['nominal_frame_size']        = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE_MEXT_0['data'], 2, 2));
+					}
+					$thisfile_riff_WAVE_MEXT_0['anciliary_data_length']         = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE_MEXT_0['data'], 6, 2));
+					$thisfile_riff_WAVE_MEXT_0['raw']['anciliary_data_def']     = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE_MEXT_0['data'], 8, 2));
+					$thisfile_riff_WAVE_MEXT_0['flags']['anciliary_data_left']  = (bool) ($thisfile_riff_WAVE_MEXT_0['raw']['anciliary_data_def'] &amp; 0x0001);
+					$thisfile_riff_WAVE_MEXT_0['flags']['anciliary_data_free']  = (bool) ($thisfile_riff_WAVE_MEXT_0['raw']['anciliary_data_def'] &amp; 0x0002);
+					$thisfile_riff_WAVE_MEXT_0['flags']['anciliary_data_right'] = (bool) ($thisfile_riff_WAVE_MEXT_0['raw']['anciliary_data_def'] &amp; 0x0004);
+				}
+
+				if (isset($thisfile_riff_WAVE['cart'][0]['data'])) {
+					// shortcut
+					$thisfile_riff_WAVE_cart_0 = &amp;$thisfile_riff_WAVE['cart'][0];
+
+					$thisfile_riff_WAVE_cart_0['version']              =                  substr($thisfile_riff_WAVE_cart_0['data'],    0,    4);
+					$thisfile_riff_WAVE_cart_0['title']                =             trim(substr($thisfile_riff_WAVE_cart_0['data'],    4,   64));
+					$thisfile_riff_WAVE_cart_0['artist']               =             trim(substr($thisfile_riff_WAVE_cart_0['data'],   68,   64));
+					$thisfile_riff_WAVE_cart_0['cut_id']               =             trim(substr($thisfile_riff_WAVE_cart_0['data'],  132,   64));
+					$thisfile_riff_WAVE_cart_0['client_id']            =             trim(substr($thisfile_riff_WAVE_cart_0['data'],  196,   64));
+					$thisfile_riff_WAVE_cart_0['category']             =             trim(substr($thisfile_riff_WAVE_cart_0['data'],  260,   64));
+					$thisfile_riff_WAVE_cart_0['classification']       =             trim(substr($thisfile_riff_WAVE_cart_0['data'],  324,   64));
+					$thisfile_riff_WAVE_cart_0['out_cue']              =             trim(substr($thisfile_riff_WAVE_cart_0['data'],  388,   64));
+					$thisfile_riff_WAVE_cart_0['start_date']           =             trim(substr($thisfile_riff_WAVE_cart_0['data'],  452,   10));
+					$thisfile_riff_WAVE_cart_0['start_time']           =             trim(substr($thisfile_riff_WAVE_cart_0['data'],  462,    8));
+					$thisfile_riff_WAVE_cart_0['end_date']             =             trim(substr($thisfile_riff_WAVE_cart_0['data'],  470,   10));
+					$thisfile_riff_WAVE_cart_0['end_time']             =             trim(substr($thisfile_riff_WAVE_cart_0['data'],  480,    8));
+					$thisfile_riff_WAVE_cart_0['producer_app_id']      =             trim(substr($thisfile_riff_WAVE_cart_0['data'],  488,   64));
+					$thisfile_riff_WAVE_cart_0['producer_app_version'] =             trim(substr($thisfile_riff_WAVE_cart_0['data'],  552,   64));
+					$thisfile_riff_WAVE_cart_0['user_defined_text']    =             trim(substr($thisfile_riff_WAVE_cart_0['data'],  616,   64));
+					$thisfile_riff_WAVE_cart_0['zero_db_reference']    = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE_cart_0['data'],  680,    4), true);
+					for ($i = 0; $i &lt; 8; $i++) {
+						$thisfile_riff_WAVE_cart_0['post_time'][$i]['usage_fourcc'] =                  substr($thisfile_riff_WAVE_cart_0['data'], 684 + ($i * 8), 4);
+						$thisfile_riff_WAVE_cart_0['post_time'][$i]['timer_value']  = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE_cart_0['data'], 684 + ($i * 8) + 4, 4));
+					}
+					$thisfile_riff_WAVE_cart_0['url']              =                 trim(substr($thisfile_riff_WAVE_cart_0['data'],  748, 1024));
+					$thisfile_riff_WAVE_cart_0['tag_text']         = explode(&quot;\r\n&quot;, trim(substr($thisfile_riff_WAVE_cart_0['data'], 1772)));
+
+					$thisfile_riff['comments']['artist'][] = $thisfile_riff_WAVE_cart_0['artist'];
+					$thisfile_riff['comments']['title'][]  = $thisfile_riff_WAVE_cart_0['title'];
+				}
+
+				if (!isset($thisfile_audio['bitrate']) &amp;&amp; isset($thisfile_riff_audio[$streamindex]['bitrate'])) {
+					$thisfile_audio['bitrate'] = $thisfile_riff_audio[$streamindex]['bitrate'];
+					$ThisFileInfo['playtime_seconds'] = (float) ((($thisfile_avdataend - $thisfile_avdataoffset) * 8) / $thisfile_audio['bitrate']);
+				}
+
+				if (!empty($ThisFileInfo['wavpack'])) {
+					$thisfile_audio_dataformat = 'wavpack';
+					$thisfile_audio['bitrate_mode'] = 'vbr';
+					$thisfile_audio['encoder']      = 'WavPack v'.$ThisFileInfo['wavpack']['version'];
+
+					// Reset to the way it was - RIFF parsing will have messed this up
+					$thisfile_avdataend        = $Original['avdataend'];
+					$thisfile_audio['bitrate'] = (($thisfile_avdataend - $thisfile_avdataoffset) * 8) / $ThisFileInfo['playtime_seconds'];
+
+					fseek($fd, $thisfile_avdataoffset - 44, SEEK_SET);
+					$RIFFdata = fread($fd, 44);
+					$OrignalRIFFheaderSize = getid3_lib::LittleEndian2Int(substr($RIFFdata,  4, 4)) +  8;
+					$OrignalRIFFdataSize   = getid3_lib::LittleEndian2Int(substr($RIFFdata, 40, 4)) + 44;
+
+					if ($OrignalRIFFheaderSize &gt; $OrignalRIFFdataSize) {
+						$thisfile_avdataend -= ($OrignalRIFFheaderSize - $OrignalRIFFdataSize);
+						fseek($fd, $thisfile_avdataend, SEEK_SET);
+						$RIFFdata .= fread($fd, $OrignalRIFFheaderSize - $OrignalRIFFdataSize);
+					}
+
+					// move the data chunk after all other chunks (if any)
+					// so that the RIFF parser doesn't see EOF when trying
+					// to skip over the data chunk
+					$RIFFdata = substr($RIFFdata, 0, 36).substr($RIFFdata, 44).substr($RIFFdata, 36, 8);
+					getid3_riff::ParseRIFFdata($RIFFdata, $ThisFileInfo);
+				}
+
+				if (isset($thisfile_riff_raw['fmt ']['wFormatTag'])) {
+					switch ($thisfile_riff_raw['fmt ']['wFormatTag']) {
+						case 0x08AE: // ClearJump LiteWave
+							$thisfile_audio['bitrate_mode'] = 'vbr';
+							$thisfile_audio_dataformat   = 'litewave';
+
+							//typedef struct tagSLwFormat {
+							//  WORD    m_wCompFormat;     // low byte defines compression method, high byte is compression flags
+							//  DWORD   m_dwScale;         // scale factor for lossy compression
+							//  DWORD   m_dwBlockSize;     // number of samples in encoded blocks
+							//  WORD    m_wQuality;        // alias for the scale factor
+							//  WORD    m_wMarkDistance;   // distance between marks in bytes
+							//  WORD    m_wReserved;
+							//
+							//  //following paramters are ignored if CF_FILESRC is not set
+							//  DWORD   m_dwOrgSize;       // original file size in bytes
+							//  WORD    m_bFactExists;     // indicates if 'fact' chunk exists in the original file
+							//  DWORD   m_dwRiffChunkSize; // riff chunk size in the original file
+							//
+							//  PCMWAVEFORMAT m_OrgWf;     // original wave format
+							// }SLwFormat, *PSLwFormat;
+
+							// shortcut
+							$thisfile_riff['litewave']['raw'] = array();
+							$thisfile_riff_litewave     = &amp;$thisfile_riff['litewave'];
+							$thisfile_riff_litewave_raw = &amp;$thisfile_riff_litewave['raw'];
+
+							$thisfile_riff_litewave_raw['compression_method'] = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE['fmt '][0]['data'], 18, 1));
+							$thisfile_riff_litewave_raw['compression_flags']  = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE['fmt '][0]['data'], 19, 1));
+							$thisfile_riff_litewave_raw['m_dwScale']          = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE['fmt '][0]['data'], 20, 4));
+							$thisfile_riff_litewave_raw['m_dwBlockSize']      = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE['fmt '][0]['data'], 24, 4));
+							$thisfile_riff_litewave_raw['m_wQuality']         = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE['fmt '][0]['data'], 28, 2));
+							$thisfile_riff_litewave_raw['m_wMarkDistance']    = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE['fmt '][0]['data'], 30, 2));
+							$thisfile_riff_litewave_raw['m_wReserved']        = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE['fmt '][0]['data'], 32, 2));
+							$thisfile_riff_litewave_raw['m_dwOrgSize']        = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE['fmt '][0]['data'], 34, 4));
+							$thisfile_riff_litewave_raw['m_bFactExists']      = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE['fmt '][0]['data'], 38, 2));
+							$thisfile_riff_litewave_raw['m_dwRiffChunkSize']  = getid3_lib::LittleEndian2Int(substr($thisfile_riff_WAVE['fmt '][0]['data'], 40, 4));
+
+							//$thisfile_riff_litewave['quality_factor'] = intval(round((2000 - $thisfile_riff_litewave_raw['m_dwScale']) / 20));
+							$thisfile_riff_litewave['quality_factor'] = $thisfile_riff_litewave_raw['m_wQuality'];
+
+							$thisfile_riff_litewave['flags']['raw_source']    = ($thisfile_riff_litewave_raw['compression_flags'] &amp; 0x01) ? false : true;
+							$thisfile_riff_litewave['flags']['vbr_blocksize'] = ($thisfile_riff_litewave_raw['compression_flags'] &amp; 0x02) ? false : true;
+							$thisfile_riff_litewave['flags']['seekpoints']    =        (bool) ($thisfile_riff_litewave_raw['compression_flags'] &amp; 0x04);
+
+							$thisfile_audio['lossless']        = (($thisfile_riff_litewave_raw['m_wQuality'] == 100) ? true : false);
+							$thisfile_audio['encoder_options'] = '-q'.$thisfile_riff_litewave['quality_factor'];
+							break;
+
+						default:
+							break;
+					}
+				}
+				if ($thisfile_avdataend &gt; $ThisFileInfo['filesize']) {
+					switch (@$thisfile_audio_dataformat) {
+						case 'wavpack': // WavPack
+						case 'lpac':    // LPAC
+						case 'ofr':     // OptimFROG
+						case 'ofs':     // OptimFROG DualStream
+							// lossless compressed audio formats that keep original RIFF headers - skip warning
+							break;
+
+						case 'litewave':
+							if (($thisfile_avdataend - $ThisFileInfo['filesize']) == 1) {
+								// LiteWave appears to incorrectly *not* pad actual output file
+								// to nearest WORD boundary so may appear to be short by one
+								// byte, in which case - skip warning
+							} else {
+								// Short by more than one byte, throw warning
+								$ThisFileInfo['warning'][] = 'Probably truncated file - expecting '.$thisfile_riff[$RIFFsubtype]['data'][0]['size'].' bytes of data, only found '.($ThisFileInfo['filesize'] - $thisfile_avdataoffset).' (short by '.($thisfile_riff[$RIFFsubtype]['data'][0]['size'] - ($ThisFileInfo['filesize'] - $thisfile_avdataoffset)).' bytes)';
+								$thisfile_avdataend = $ThisFileInfo['filesize'];
+							}
+							break;
+
+						default:
+							if ((($thisfile_avdataend - $ThisFileInfo['filesize']) == 1) &amp;&amp; (($thisfile_riff[$RIFFsubtype]['data'][0]['size'] % 2) == 0) &amp;&amp; ((($ThisFileInfo['filesize'] - $thisfile_avdataoffset) % 2) == 1)) {
+								// output file appears to be incorrectly *not* padded to nearest WORD boundary
+								// Output less severe warning
+								$ThisFileInfo['warning'][] = 'File should probably be padded to nearest WORD boundary, but it is not (expecting '.$thisfile_riff[$RIFFsubtype]['data'][0]['size'].' bytes of data, only found '.($ThisFileInfo['filesize'] - $thisfile_avdataoffset).' therefore short by '.($thisfile_riff[$RIFFsubtype]['data'][0]['size'] - ($ThisFileInfo['filesize'] - $thisfile_avdataoffset)).' bytes)';
+								$thisfile_avdataend = $ThisFileInfo['filesize'];
+								break;
+							}
+							// Short by more than one byte, throw warning
+							$ThisFileInfo['warning'][] = 'Probably truncated file - expecting '.$thisfile_riff[$RIFFsubtype]['data'][0]['size'].' bytes of data, only found '.($ThisFileInfo['filesize'] - $thisfile_avdataoffset).' (short by '.($thisfile_riff[$RIFFsubtype]['data'][0]['size'] - ($ThisFileInfo['filesize'] - $thisfile_avdataoffset)).' bytes)';
+							$thisfile_avdataend = $ThisFileInfo['filesize'];
+							break;
+					}
+				}
+				if (!empty($ThisFileInfo['mpeg']['audio']['LAME']['audio_bytes'])) {
+					if ((($thisfile_avdataend - $thisfile_avdataoffset) - $ThisFileInfo['mpeg']['audio']['LAME']['audio_bytes']) == 1) {
+						$thisfile_avdataend--;
+						$ThisFileInfo['warning'][] = 'Extra null byte at end of MP3 data assumed to be RIFF padding and therefore ignored';
+					}
+				}
+				if (@$thisfile_audio_dataformat == 'ac3') {
+					unset($thisfile_audio['bits_per_sample']);
+					if (!empty($ThisFileInfo['ac3']['bitrate']) &amp;&amp; ($ThisFileInfo['ac3']['bitrate'] != $thisfile_audio['bitrate'])) {
+						$thisfile_audio['bitrate'] = $ThisFileInfo['ac3']['bitrate'];
+					}
+				}
+				break;
+
+			case 'AVI ':
+				$thisfile_video['bitrate_mode'] = 'vbr'; // maybe not, but probably
+				$thisfile_video['dataformat']   = 'avi';
+				$ThisFileInfo['mime_type']      = 'video/avi';
+
+				if (isset($thisfile_riff[$RIFFsubtype]['movi']['offset'])) {
+					$thisfile_avdataoffset = $thisfile_riff[$RIFFsubtype]['movi']['offset'] + 8;
+					$thisfile_avdataend    = $thisfile_avdataoffset + $thisfile_riff[$RIFFsubtype]['movi']['size'];
+					if ($thisfile_avdataend &gt; $ThisFileInfo['filesize']) {
+						$ThisFileInfo['warning'][] = 'Probably truncated file - expecting '.$thisfile_riff[$RIFFsubtype]['movi']['size'].' bytes of data, only found '.($ThisFileInfo['filesize'] - $thisfile_avdataoffset).' (short by '.($thisfile_riff[$RIFFsubtype]['movi']['size'] - ($ThisFileInfo['filesize'] - $thisfile_avdataoffset)).' bytes)';
+						$thisfile_avdataend = $ThisFileInfo['filesize'];
+					}
+				}
+
+				if (isset($thisfile_riff['AVI ']['hdrl']['avih'][$streamindex]['data'])) {
+					$avihData = $thisfile_riff['AVI ']['hdrl']['avih'][$streamindex]['data'];
+
+					// shortcut
+					$thisfile_riff_raw['avih'] = array();
+					$thisfile_riff_raw_avih = &amp;$thisfile_riff_raw['avih'];
+
+					$thisfile_riff_raw_avih['dwMicroSecPerFrame']    = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData,  0, 4)); // frame display rate (or 0L)
+					if ($thisfile_riff_raw_avih['dwMicroSecPerFrame'] == 0) {
+						$ThisFileInfo['error'][] = 'Corrupt RIFF file: avih.dwMicroSecPerFrame == zero';
+						return false;
+					}
+					$thisfile_riff_raw_avih['dwMaxBytesPerSec']      = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData,  4, 4)); // max. transfer rate
+					$thisfile_riff_raw_avih['dwPaddingGranularity']  = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData,  8, 4)); // pad to multiples of this size; normally 2K.
+					$thisfile_riff_raw_avih['dwFlags']               = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData, 12, 4)); // the ever-present flags
+					$thisfile_riff_raw_avih['dwTotalFrames']         = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData, 16, 4)); // # frames in file
+					$thisfile_riff_raw_avih['dwInitialFrames']       = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData, 20, 4));
+					$thisfile_riff_raw_avih['dwStreams']             = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData, 24, 4));
+					$thisfile_riff_raw_avih['dwSuggestedBufferSize'] = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData, 28, 4));
+					$thisfile_riff_raw_avih['dwWidth']               = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData, 32, 4));
+					$thisfile_riff_raw_avih['dwHeight']              = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData, 36, 4));
+					$thisfile_riff_raw_avih['dwScale']               = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData, 40, 4));
+					$thisfile_riff_raw_avih['dwRate']                = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData, 44, 4));
+					$thisfile_riff_raw_avih['dwStart']               = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData, 48, 4));
+					$thisfile_riff_raw_avih['dwLength']              = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($avihData, 52, 4));
+
+					$thisfile_riff_raw_avih['flags']['hasindex']     = (bool) ($thisfile_riff_raw_avih['dwFlags'] &amp; 0x00000010);
+					$thisfile_riff_raw_avih['flags']['mustuseindex'] = (bool) ($thisfile_riff_raw_avih['dwFlags'] &amp; 0x00000020);
+					$thisfile_riff_raw_avih['flags']['interleaved']  = (bool) ($thisfile_riff_raw_avih['dwFlags'] &amp; 0x00000100);
+					$thisfile_riff_raw_avih['flags']['trustcktype']  = (bool) ($thisfile_riff_raw_avih['dwFlags'] &amp; 0x00000800);
+					$thisfile_riff_raw_avih['flags']['capturedfile'] = (bool) ($thisfile_riff_raw_avih['dwFlags'] &amp; 0x00010000);
+					$thisfile_riff_raw_avih['flags']['copyrighted']  = (bool) ($thisfile_riff_raw_avih['dwFlags'] &amp; 0x00020010);
+
+					// shortcut
+					$thisfile_riff_video[$streamindex] = array();
+					$thisfile_riff_video_current = &amp;$thisfile_riff_video[$streamindex];
+
+					if ($thisfile_riff_raw_avih['dwWidth'] &gt; 0) {
+						$thisfile_riff_video_current['frame_width'] = $thisfile_riff_raw_avih['dwWidth'];
+						$thisfile_video['resolution_x']             = $thisfile_riff_video_current['frame_width'];
+					}
+					if ($thisfile_riff_raw_avih['dwHeight'] &gt; 0) {
+						$thisfile_riff_video_current['frame_height'] = $thisfile_riff_raw_avih['dwHeight'];
+						$thisfile_video['resolution_y']              = $thisfile_riff_video_current['frame_height'];
+					}
+					if ($thisfile_riff_raw_avih['dwTotalFrames'] &gt; 0) {
+						$thisfile_riff_video_current['total_frames'] = $thisfile_riff_raw_avih['dwTotalFrames'];
+						$thisfile_video['total_frames']              = $thisfile_riff_video_current['total_frames'];
+					}
+
+					$thisfile_riff_video_current['frame_rate'] = round(1000000 / $thisfile_riff_raw_avih['dwMicroSecPerFrame'], 3);
+					$thisfile_video['frame_rate'] = $thisfile_riff_video_current['frame_rate'];
+				}
+				if (isset($thisfile_riff['AVI ']['hdrl']['strl']['strh'][0]['data'])) {
+					if (is_array($thisfile_riff['AVI ']['hdrl']['strl']['strh'])) {
+						for ($i = 0; $i &lt; count($thisfile_riff['AVI ']['hdrl']['strl']['strh']); $i++) {
+							if (isset($thisfile_riff['AVI ']['hdrl']['strl']['strh'][$i]['data'])) {
+								$strhData = $thisfile_riff['AVI ']['hdrl']['strl']['strh'][$i]['data'];
+								$strhfccType = substr($strhData,  0, 4);
+
+								if (isset($thisfile_riff['AVI ']['hdrl']['strl']['strf'][$i]['data'])) {
+									$strfData = $thisfile_riff['AVI ']['hdrl']['strl']['strf'][$i]['data'];
+
+									// shortcut
+									$thisfile_riff_raw_strf_strhfccType_streamindex = &amp;$thisfile_riff_raw['strf'][$strhfccType][$streamindex];
+
+									switch ($strhfccType) {
+										case 'auds':
+											$thisfile_audio['bitrate_mode'] = 'cbr';
+											$thisfile_audio_dataformat      = 'wav';
+											if (isset($thisfile_riff_audio) &amp;&amp; is_array($thisfile_riff_audio)) {
+												$streamindex = count($thisfile_riff_audio);
+											}
+
+											$thisfile_riff_audio[$streamindex] = getid3_riff::RIFFparseWAVEFORMATex($strfData);
+											$thisfile_audio['wformattag'] = $thisfile_riff_audio[$streamindex]['raw']['wFormatTag'];
+
+											// shortcut
+											$thisfile_audio['streams'][$streamindex] = $thisfile_riff_audio[$streamindex];
+											$thisfile_audio_streams_currentstream = &amp;$thisfile_audio['streams'][$streamindex];
+
+											if ($thisfile_audio_streams_currentstream['bits_per_sample'] == 0) {
+												unset($thisfile_audio_streams_currentstream['bits_per_sample']);
+											}
+											$thisfile_audio_streams_currentstream['wformattag'] = $thisfile_audio_streams_currentstream['raw']['wFormatTag'];
+											unset($thisfile_audio_streams_currentstream['raw']);
+
+											// shortcut
+											$thisfile_riff_raw['strf'][$strhfccType][$streamindex] = $thisfile_riff_audio[$streamindex]['raw'];
+
+											unset($thisfile_riff_audio[$streamindex]['raw']);
+											$thisfile_audio = getid3_lib::array_merge_noclobber($thisfile_audio, $thisfile_riff_audio[$streamindex]);
+
+											$thisfile_audio['lossless'] = false;
+											switch ($thisfile_riff_raw_strf_strhfccType_streamindex['wFormatTag']) {
+												case 0x0001:  // PCM
+													$thisfile_audio_dataformat  = 'wav';
+													$thisfile_audio['lossless'] = true;
+													break;
+
+												case 0x0050: // MPEG Layer 2 or Layer 1
+													$thisfile_audio_dataformat = 'mp2'; // Assume Layer-2
+													break;
+
+												case 0x0055: // MPEG Layer 3
+													$thisfile_audio_dataformat = 'mp3';
+													break;
+
+												case 0x00FF: // AAC
+													$thisfile_audio_dataformat = 'aac';
+													break;
+
+												case 0x0161: // Windows Media v7 / v8 / v9
+												case 0x0162: // Windows Media Professional v9
+												case 0x0163: // Windows Media Lossess v9
+													$thisfile_audio_dataformat = 'wma';
+													break;
+
+												case 0x2000: // AC-3
+													$thisfile_audio_dataformat = 'ac3';
+													break;
+
+												case 0x2001: // DTS
+													$thisfile_audio_dataformat = 'dts';
+													break;
+
+												default:
+													$thisfile_audio_dataformat = 'wav';
+													break;
+											}
+											$thisfile_audio_streams_currentstream['dataformat']   = $thisfile_audio_dataformat;
+											$thisfile_audio_streams_currentstream['lossless']     = $thisfile_audio['lossless'];
+											$thisfile_audio_streams_currentstream['bitrate_mode'] = $thisfile_audio['bitrate_mode'];
+											break;
+
+
+										case 'iavs':
+										case 'vids':
+											// shortcut
+											$thisfile_riff_raw['strh'][$i]                  = array();
+											$thisfile_riff_raw_strh_current                 = &amp;$thisfile_riff_raw['strh'][$i];
+
+											$thisfile_riff_raw_strh_current['fccType']               =                  substr($strhData,  0, 4);  // same as $strhfccType;
+											$thisfile_riff_raw_strh_current['fccHandler']            =                  substr($strhData,  4, 4);
+											$thisfile_riff_raw_strh_current['dwFlags']               = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strhData,  8, 4)); // Contains AVITF_* flags
+											$thisfile_riff_raw_strh_current['wPriority']             = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strhData, 12, 2));
+											$thisfile_riff_raw_strh_current['wLanguage']             = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strhData, 14, 2));
+											$thisfile_riff_raw_strh_current['dwInitialFrames']       = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strhData, 16, 4));
+											$thisfile_riff_raw_strh_current['dwScale']               = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strhData, 20, 4));
+											$thisfile_riff_raw_strh_current['dwRate']                = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strhData, 24, 4));
+											$thisfile_riff_raw_strh_current['dwStart']               = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strhData, 28, 4));
+											$thisfile_riff_raw_strh_current['dwLength']              = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strhData, 32, 4));
+											$thisfile_riff_raw_strh_current['dwSuggestedBufferSize'] = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strhData, 36, 4));
+											$thisfile_riff_raw_strh_current['dwQuality']             = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strhData, 40, 4));
+											$thisfile_riff_raw_strh_current['dwSampleSize']          = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strhData, 44, 4));
+											$thisfile_riff_raw_strh_current['rcFrame']               = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strhData, 48, 4));
+
+											$thisfile_riff_video_current['codec'] = getid3_riff::RIFFfourccLookup($thisfile_riff_raw_strh_current['fccHandler']);
+											$thisfile_video['fourcc']             = $thisfile_riff_raw_strh_current['fccHandler'];
+											if (!$thisfile_riff_video_current['codec'] &amp;&amp; isset($thisfile_riff_raw_strf_strhfccType_streamindex['fourcc']) &amp;&amp; getid3_riff::RIFFfourccLookup($thisfile_riff_raw_strf_strhfccType_streamindex['fourcc'])) {
+												$thisfile_riff_video_current['codec'] = getid3_riff::RIFFfourccLookup($thisfile_riff_raw_strf_strhfccType_streamindex['fourcc']);
+												$thisfile_video['fourcc']             = $thisfile_riff_raw_strf_strhfccType_streamindex['fourcc'];
+											}
+											$thisfile_video['codec']              = $thisfile_riff_video_current['codec'];
+											$thisfile_video['pixel_aspect_ratio'] = (float) 1;
+											switch ($thisfile_riff_raw_strh_current['fccHandler']) {
+												case 'HFYU': // Huffman Lossless Codec
+												case 'IRAW': // Intel YUV Uncompressed
+												case 'YUY2': // Uncompressed YUV 4:2:2
+													$thisfile_video['lossless'] = true;
+													break;
+
+												default:
+													$thisfile_video['lossless'] = false;
+													break;
+											}
+
+											switch ($strhfccType) {
+												case 'vids':
+													$thisfile_riff_raw_strf_strhfccType_streamindex['biSize']          = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strfData,  0, 4)); // number of bytes required by the BITMAPINFOHEADER structure
+													$thisfile_riff_raw_strf_strhfccType_streamindex['biWidth']         = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strfData,  4, 4)); // width of the bitmap in pixels
+													$thisfile_riff_raw_strf_strhfccType_streamindex['biHeight']        = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strfData,  8, 4)); // height of the bitmap in pixels. If biHeight is positive, the bitmap is a 'bottom-up' DIB and its origin is the lower left corner. If biHeight is negative, the bitmap is a 'top-down' DIB and its origin is the upper left corner
+													$thisfile_riff_raw_strf_strhfccType_streamindex['biPlanes']        = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strfData, 12, 2)); // number of color planes on the target device. In most cases this value must be set to 1
+													$thisfile_riff_raw_strf_strhfccType_streamindex['biBitCount']      = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strfData, 14, 2)); // Specifies the number of bits per pixels
+													$thisfile_riff_raw_strf_strhfccType_streamindex['fourcc']          =                                 substr($strfData, 16, 4);  //
+													$thisfile_riff_raw_strf_strhfccType_streamindex['biSizeImage']     = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strfData, 20, 4)); // size of the bitmap data section of the image (the actual pixel data, excluding BITMAPINFOHEADER and RGBQUAD structures)
+													$thisfile_riff_raw_strf_strhfccType_streamindex['biXPelsPerMeter'] = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strfData, 24, 4)); // horizontal resolution, in pixels per metre, of the target device
+													$thisfile_riff_raw_strf_strhfccType_streamindex['biYPelsPerMeter'] = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strfData, 28, 4)); // vertical resolution, in pixels per metre, of the target device
+													$thisfile_riff_raw_strf_strhfccType_streamindex['biClrUsed']       = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strfData, 32, 4)); // actual number of color indices in the color table used by the bitmap. If this value is zero, the bitmap uses the maximum number of colors corresponding to the value of the biBitCount member for the compression mode specified by biCompression
+													$thisfile_riff_raw_strf_strhfccType_streamindex['biClrImportant']  = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($strfData, 36, 4)); // number of color indices that are considered important for displaying the bitmap. If this value is zero, all colors are important
+
+													$thisfile_video['bits_per_sample'] = $thisfile_riff_raw_strf_strhfccType_streamindex['biBitCount'];
+
+													if ($thisfile_riff_video_current['codec'] == 'DV') {
+														$thisfile_riff_video_current['dv_type'] = 2;
+													}
+													break;
+
+												case 'iavs':
+													$thisfile_riff_video_current['dv_type'] = 1;
+													break;
+											}
+											break;
+
+										default:
+											$ThisFileInfo['warning'][] = 'Unhandled fccType for stream ('.$i.'): &quot;'.$strhfccType.'&quot;';
+											break;
+
+									}
+								}
+							}
+
+							if (isset($thisfile_riff_raw_strf_strhfccType_streamindex['fourcc']) &amp;&amp; getid3_riff::RIFFfourccLookup($thisfile_riff_raw_strf_strhfccType_streamindex['fourcc'])) {
+
+								$thisfile_riff_video_current['codec'] = getid3_riff::RIFFfourccLookup($thisfile_riff_raw_strf_strhfccType_streamindex['fourcc']);
+								$thisfile_video['codec']              = $thisfile_riff_video_current['codec'];
+								$thisfile_video['fourcc']             = $thisfile_riff_raw_strf_strhfccType_streamindex['fourcc'];
+
+								switch ($thisfile_riff_raw_strf_strhfccType_streamindex['fourcc']) {
+									case 'HFYU': // Huffman Lossless Codec
+									case 'IRAW': // Intel YUV Uncompressed
+									case 'YUY2': // Uncompressed YUV 4:2:2
+										$thisfile_video['lossless']        = true;
+										$thisfile_video['bits_per_sample'] = 24;
+										break;
+
+									default:
+										$thisfile_video['lossless']        = false;
+										$thisfile_video['bits_per_sample'] = 24;
+										break;
+								}
+
+							}
+						}
+					}
+				}
+				break;
+
+			case 'CDDA':
+				$thisfile_audio['bitrate_mode'] = 'cbr';
+				$thisfile_audio_dataformat      = 'cda';
+				$thisfile_audio['lossless']     = true;
+				unset($ThisFileInfo['mime_type']);
+
+				$thisfile_avdataoffset = 44;
+
+				if (isset($thisfile_riff['CDDA']['fmt '][0]['data'])) {
+					// shortcut
+					$thisfile_riff_CDDA_fmt_0 = &amp;$thisfile_riff['CDDA']['fmt '][0];
+
+					$thisfile_riff_CDDA_fmt_0['unknown1']           = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($thisfile_riff_CDDA_fmt_0['data'],  0, 2));
+					$thisfile_riff_CDDA_fmt_0['track_num']          = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($thisfile_riff_CDDA_fmt_0['data'],  2, 2));
+					$thisfile_riff_CDDA_fmt_0['disc_id']            = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($thisfile_riff_CDDA_fmt_0['data'],  4, 4));
+					$thisfile_riff_CDDA_fmt_0['start_offset_frame'] = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($thisfile_riff_CDDA_fmt_0['data'],  8, 4));
+					$thisfile_riff_CDDA_fmt_0['playtime_frames']    = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($thisfile_riff_CDDA_fmt_0['data'], 12, 4));
+					$thisfile_riff_CDDA_fmt_0['unknown6']           = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($thisfile_riff_CDDA_fmt_0['data'], 16, 4));
+					$thisfile_riff_CDDA_fmt_0['unknown7']           = getid3_riff::EitherEndian2Int($ThisFileInfo, substr($thisfile_riff_CDDA_fmt_0['data'], 20, 4));
+
+					$thisfile_riff_CDDA_fmt_0['start_offset_seconds'] = (float) $thisfile_riff_CDDA_fmt_0['start_offset_frame'] / 75;
+					$thisfile_riff_CDDA_fmt_0['playtime_seconds']     = (float) $thisfile_riff_CDDA_fmt_0['playtime_frames'] / 75;
+					$ThisFileInfo['comments']['track']                = $thisfile_riff_CDDA_fmt_0['track_num'];
+					$ThisFileInfo['playtime_seconds']                 = $thisfile_riff_CDDA_fmt_0['playtime_seconds'];
+
+					// hardcoded data for CD-audio
+					$thisfile_audio['sample_rate']     = 44100;
+					$thisfile_audio['channels']        = 2;
+					$thisfile_audio['bits_per_sample'] = 16;
+					$thisfile_audio['bitrate']         = $thisfile_audio['sample_rate'] * $thisfile_audio['channels'] * $thisfile_audio['bits_per_sample'];
+					$thisfile_audio['bitrate_mode']    = 'cbr';
+				}
+				break;
+
+
+			case 'AIFF':
+			case 'AIFC':
+				$thisfile_audio['bitrate_mode'] = 'cbr';
+				$thisfile_audio_dataformat      = 'aiff';
+				$thisfile_audio['lossless']     = true;
+				$ThisFileInfo['mime_type']      = 'audio/x-aiff';
+
+				if (isset($thisfile_riff[$RIFFsubtype]['SSND'][0]['offset'])) {
+					$thisfile_avdataoffset = $thisfile_riff[$RIFFsubtype]['SSND'][0]['offset'] + 8;
+					$thisfile_avdataend    = $thisfile_avdataoffset + $thisfile_riff[$RIFFsubtype]['SSND'][0]['size'];
+					if ($thisfile_avdataend &gt; $ThisFileInfo['filesize']) {
+						if (($thisfile_avdataend == ($ThisFileInfo['filesize'] + 1)) &amp;&amp; (($ThisFileInfo['filesize'] % 2) == 1)) {
+							// structures rounded to 2-byte boundary, but dumb encoders
+							// forget to pad end of file to make this actually work
+						} else {
+							$ThisFileInfo['warning'][] = 'Probable truncated AIFF file: expecting '.$thisfile_riff[$RIFFsubtype]['SSND'][0]['size'].' bytes of audio data, only '.($ThisFileInfo['filesize'] - $thisfile_avdataoffset).' bytes found';
+						}
+						$thisfile_avdataend = $ThisFileInfo['filesize'];
+					}
+				}
+
+				if (isset($thisfile_riff[$RIFFsubtype]['COMM'][0]['data'])) {
+
+					// shortcut
+					$thisfile_riff_RIFFsubtype_COMM_0_data = &amp;$thisfile_riff[$RIFFsubtype]['COMM'][0]['data'];
+
+					$thisfile_riff_audio['channels']         =         getid3_lib::BigEndian2Int(substr($thisfile_riff_RIFFsubtype_COMM_0_data,  0,  2), true);
+					$thisfile_riff_audio['total_samples']    =         getid3_lib::BigEndian2Int(substr($thisfile_riff_RIFFsubtype_COMM_0_data,  2,  4), false);
+					$thisfile_riff_audio['bits_per_sample']  =         getid3_lib::BigEndian2Int(substr($thisfile_riff_RIFFsubtype_COMM_0_data,  6,  2), true);
+					$thisfile_riff_audio['sample_rate']      = (int) getid3_lib::BigEndian2Float(substr($thisfile_riff_RIFFsubtype_COMM_0_data,  8, 10));
+
+					if ($thisfile_riff[$RIFFsubtype]['COMM'][0]['size'] &gt; 18) {
+						$thisfile_riff_audio['codec_fourcc'] =                                   substr($thisfile_riff_RIFFsubtype_COMM_0_data, 18,  4);
+						$CodecNameSize                       =         getid3_lib::BigEndian2Int(substr($thisfile_riff_RIFFsubtype_COMM_0_data, 22,  1), false);
+						$thisfile_riff_audio['codec_name']   =                                   substr($thisfile_riff_RIFFsubtype_COMM_0_data, 23,  $CodecNameSize);
+						switch ($thisfile_riff_audio['codec_name']) {
+							case 'NONE':
+								$thisfile_audio['codec']    = 'Pulse Code Modulation (PCM)';
+								$thisfile_audio['lossless'] = true;
+								break;
+
+							case '':
+								switch ($thisfile_riff_audio['codec_fourcc']) {
+									// <A HREF="http://developer.apple.com/qa/snd/snd07.html">http://developer.apple.com/qa/snd/snd07.html</A>
+									case 'sowt':
+										$thisfile_riff_audio['codec_name'] = 'Two\'s Compliment Little-Endian PCM';
+										$thisfile_audio['lossless'] = true;
+										break;
+
+									case 'twos':
+										$thisfile_riff_audio['codec_name'] = 'Two\'s Compliment Big-Endian PCM';
+										$thisfile_audio['lossless'] = true;
+										break;
+
+									default:
+										break;
+								}
+								break;
+
+							default:
+								$thisfile_audio['codec']    = $thisfile_riff_audio['codec_name'];
+								$thisfile_audio['lossless'] = false;
+								break;
+						}
+					}
+
+					$thisfile_audio['channels']        = $thisfile_riff_audio['channels'];
+					if ($thisfile_riff_audio['bits_per_sample'] &gt; 0) {
+						$thisfile_audio['bits_per_sample'] = $thisfile_riff_audio['bits_per_sample'];
+					}
+					$thisfile_audio['sample_rate']     = $thisfile_riff_audio['sample_rate'];
+					if ($thisfile_audio['sample_rate'] == 0) {
+						$ThisFileInfo['error'][] = 'Corrupted AIFF file: sample_rate == zero';
+						return false;
+					}
+					$ThisFileInfo['playtime_seconds'] = $thisfile_riff_audio['total_samples'] / $thisfile_audio['sample_rate'];
+				}
+
+				if (isset($thisfile_riff[$RIFFsubtype]['COMT'])) {
+					$offset = 0;
+					$CommentCount                                           = getid3_lib::BigEndian2Int(substr($thisfile_riff[$RIFFsubtype]['COMT'][0]['data'], $offset, 2), false);
+					$offset += 2;
+					for ($i = 0; $i &lt; $CommentCount; $i++) {
+						$ThisFileInfo['comments_raw'][$i]['timestamp']      = getid3_lib::BigEndian2Int(substr($thisfile_riff[$RIFFsubtype]['COMT'][0]['data'], $offset, 4), false);
+						$offset += 4;
+						$ThisFileInfo['comments_raw'][$i]['marker_id']      = getid3_lib::BigEndian2Int(substr($thisfile_riff[$RIFFsubtype]['COMT'][0]['data'], $offset, 2), true);
+						$offset += 2;
+						$CommentLength                                      = getid3_lib::BigEndian2Int(substr($thisfile_riff[$RIFFsubtype]['COMT'][0]['data'], $offset, 2), false);
+						$offset += 2;
+						$ThisFileInfo['comments_raw'][$i]['comment']        =                           substr($thisfile_riff[$RIFFsubtype]['COMT'][0]['data'], $offset, $CommentLength);
+						$offset += $CommentLength;
+
+						$ThisFileInfo['comments_raw'][$i]['timestamp_unix'] = getid3_lib::DateMac2Unix($ThisFileInfo['comments_raw'][$i]['timestamp']);
+						$thisfile_riff['comments']['comment'][] = $ThisFileInfo['comments_raw'][$i]['comment'];
+					}
+				}
+
+				$CommentsChunkNames = array('NAME'=&gt;'title', 'author'=&gt;'artist', '(c) '=&gt;'copyright', 'ANNO'=&gt;'comment');
+				foreach ($CommentsChunkNames as $key =&gt; $value) {
+					if (isset($thisfile_riff[$RIFFsubtype][$key][0]['data'])) {
+						$thisfile_riff['comments'][$value][] = $thisfile_riff[$RIFFsubtype][$key][0]['data'];
+					}
+				}
+				break;
+
+			case '8SVX':
+				$thisfile_audio['bitrate_mode']    = 'cbr';
+				$thisfile_audio_dataformat         = '8svx';
+				$thisfile_audio['bits_per_sample'] = 8;
+				$thisfile_audio['channels']        = 1; // overridden below, if need be
+				$ThisFileInfo['mime_type']                = 'audio/x-aiff';
+
+				if (isset($thisfile_riff[$RIFFsubtype]['BODY'][0]['offset'])) {
+					$thisfile_avdataoffset = $thisfile_riff[$RIFFsubtype]['BODY'][0]['offset'] + 8;
+					$thisfile_avdataend    = $thisfile_avdataoffset + $thisfile_riff[$RIFFsubtype]['BODY'][0]['size'];
+					if ($thisfile_avdataend &gt; $ThisFileInfo['filesize']) {
+						$ThisFileInfo['warning'][] = 'Probable truncated AIFF file: expecting '.$thisfile_riff[$RIFFsubtype]['BODY'][0]['size'].' bytes of audio data, only '.($ThisFileInfo['filesize'] - $thisfile_avdataoffset).' bytes found';
+					}
+				}
+
+				if (isset($thisfile_riff[$RIFFsubtype]['VHDR'][0]['offset'])) {
+					// shortcut
+					$thisfile_riff_RIFFsubtype_VHDR_0 = &amp;$thisfile_riff[$RIFFsubtype]['VHDR'][0];
+
+					$thisfile_riff_RIFFsubtype_VHDR_0['oneShotHiSamples']  =   getid3_lib::BigEndian2Int(substr($thisfile_riff_RIFFsubtype_VHDR_0['data'],  0, 4));
+					$thisfile_riff_RIFFsubtype_VHDR_0['repeatHiSamples']   =   getid3_lib::BigEndian2Int(substr($thisfile_riff_RIFFsubtype_VHDR_0['data'],  4, 4));
+					$thisfile_riff_RIFFsubtype_VHDR_0['samplesPerHiCycle'] =   getid3_lib::BigEndian2Int(substr($thisfile_riff_RIFFsubtype_VHDR_0['data'],  8, 4));
+					$thisfile_riff_RIFFsubtype_VHDR_0['samplesPerSec']     =   getid3_lib::BigEndian2Int(substr($thisfile_riff_RIFFsubtype_VHDR_0['data'], 12, 2));
+					$thisfile_riff_RIFFsubtype_VHDR_0['ctOctave']          =   getid3_lib::BigEndian2Int(substr($thisfile_riff_RIFFsubtype_VHDR_0['data'], 14, 1));
+					$thisfile_riff_RIFFsubtype_VHDR_0['sCompression']      =   getid3_lib::BigEndian2Int(substr($thisfile_riff_RIFFsubtype_VHDR_0['data'], 15, 1));
+					$thisfile_riff_RIFFsubtype_VHDR_0['Volume']            = getid3_lib::FixedPoint16_16(substr($thisfile_riff_RIFFsubtype_VHDR_0['data'], 16, 4));
+
+					$thisfile_audio['sample_rate'] = $thisfile_riff_RIFFsubtype_VHDR_0['samplesPerSec'];
+
+					switch ($thisfile_riff_RIFFsubtype_VHDR_0['sCompression']) {
+						case 0:
+							$thisfile_audio['codec']    = 'Pulse Code Modulation (PCM)';
+							$thisfile_audio['lossless'] = true;
+							$ActualBitsPerSample               = 8;
+							break;
+
+						case 1:
+							$thisfile_audio['codec']    = 'Fibonacci-delta encoding';
+							$thisfile_audio['lossless'] = false;
+							$ActualBitsPerSample               = 4;
+							break;
+
+						default:
+							$ThisFileInfo['warning'][] = 'Unexpected sCompression value in 8SVX.VHDR chunk - expecting 0 or 1, found &quot;'.sCompression.'&quot;';
+							break;
+					}
+				}
+
+				if (isset($thisfile_riff[$RIFFsubtype]['CHAN'][0]['data'])) {
+					$ChannelsIndex = getid3_lib::BigEndian2Int(substr($thisfile_riff[$RIFFsubtype]['CHAN'][0]['data'], 0, 4));
+					switch ($ChannelsIndex) {
+						case 6: // Stereo
+							$thisfile_audio['channels'] = 2;
+							break;
+
+						case 2: // Left channel only
+						case 4: // Right channel only
+							$thisfile_audio['channels'] = 1;
+							break;
+
+						default:
+							$ThisFileInfo['warning'][] = 'Unexpected value in 8SVX.CHAN chunk - expecting 2 or 4 or 6, found &quot;'.$ChannelsIndex.'&quot;';
+							break;
+					}
+
+				}
+
+				$CommentsChunkNames = array('NAME'=&gt;'title', 'author'=&gt;'artist', '(c) '=&gt;'copyright', 'ANNO'=&gt;'comment');
+				foreach ($CommentsChunkNames as $key =&gt; $value) {
+					if (isset($thisfile_riff[$RIFFsubtype][$key][0]['data'])) {
+						$thisfile_riff['comments'][$value][] = $thisfile_riff[$RIFFsubtype][$key][0]['data'];
+					}
+				}
+
+				$thisfile_audio['bitrate'] = $thisfile_audio['sample_rate'] * $ActualBitsPerSample * $thisfile_audio['channels'];
+				if (!empty($thisfile_audio['bitrate'])) {
+					$ThisFileInfo['playtime_seconds'] = ($thisfile_avdataend - $thisfile_avdataoffset) / ($thisfile_audio['bitrate'] / 8);
+				}
+				break;
+
+
+			case 'CDXA':
+				$ThisFileInfo['mime_type']      = 'video/mpeg';
+				if (!empty($thisfile_riff['CDXA']['data'][0]['size'])) {
+					$GETID3_ERRORARRAY = &amp;$ThisFileInfo['warning'];
+					if (getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio-video.mpeg.php', __FILE__, false)) {
+						$dummy = $ThisFileInfo;
+						$dummy['error'] = array();
+						$mpeg_scanner = new getid3_mpeg($fd, $dummy);
+						if (empty($dummy['error'])) {
+							$ThisFileInfo['audio']   = $dummy['audio'];
+							$ThisFileInfo['video']   = $dummy['video'];
+							$ThisFileInfo['mpeg']    = $dummy['mpeg'];
+							$ThisFileInfo['warning'] = $dummy['warning'];
+						}
+					}
+				}
+				break;
+
+
+			default:
+				$ThisFileInfo['error'][] = 'Unknown RIFF type: expecting one of (WAVE|RMP3|AVI |CDDA|AIFF|AIFC|8SVX|CDXA), found &quot;'.$RIFFsubtype.'&quot; instead';
+				unset($ThisFileInfo['fileformat']);
+				break;
+		}
+
+		if (isset($thisfile_riff_WAVE['DISP']) &amp;&amp; is_array($thisfile_riff_WAVE['DISP'])) {
+			$thisfile_riff['comments']['title'][] = trim(substr($thisfile_riff_WAVE['DISP'][count($thisfile_riff_WAVE['DISP']) - 1]['data'], 4));
+		}
+		if (isset($thisfile_riff_WAVE['INFO']) &amp;&amp; is_array($thisfile_riff_WAVE['INFO'])) {
+			$this-&gt;RIFFcommentsParse($thisfile_riff_WAVE['INFO'], $thisfile_riff['comments']);
+		}
+
+		if (empty($thisfile_audio['encoder']) &amp;&amp; !empty($ThisFileInfo['mpeg']['audio']['LAME']['short_version'])) {
+			$thisfile_audio['encoder'] = $ThisFileInfo['mpeg']['audio']['LAME']['short_version'];
+		}
+
+		if (!isset($ThisFileInfo['playtime_seconds'])) {
+			$ThisFileInfo['playtime_seconds'] = 0;
+		}
+		if (isset($thisfile_riff_raw['avih']['dwTotalFrames']) &amp;&amp; isset($thisfile_riff_raw['avih']['dwMicroSecPerFrame'])) {
+			$ThisFileInfo['playtime_seconds'] = $thisfile_riff_raw['avih']['dwTotalFrames'] * ($thisfile_riff_raw['avih']['dwMicroSecPerFrame'] / 1000000);
+		}
+
+		if ($ThisFileInfo['playtime_seconds'] &gt; 0) {
+			if (isset($thisfile_riff_audio) &amp;&amp; isset($thisfile_riff_video)) {
+
+				if (!isset($ThisFileInfo['bitrate'])) {
+					$ThisFileInfo['bitrate'] = ((($thisfile_avdataend - $thisfile_avdataoffset) / $ThisFileInfo['playtime_seconds']) * 8);
+				}
+
+			} elseif (isset($thisfile_riff_audio) &amp;&amp; !isset($thisfile_riff_video)) {
+
+				if (!isset($thisfile_audio['bitrate'])) {
+					$thisfile_audio['bitrate'] = ((($thisfile_avdataend - $thisfile_avdataoffset) / $ThisFileInfo['playtime_seconds']) * 8);
+				}
+
+			} elseif (!isset($thisfile_riff_audio) &amp;&amp; isset($thisfile_riff_video)) {
+
+				if (!isset($thisfile_video['bitrate'])) {
+					$thisfile_video['bitrate'] = ((($thisfile_avdataend - $thisfile_avdataoffset) / $ThisFileInfo['playtime_seconds']) * 8);
+				}
+
+			}
+		}
+
+
+		if (isset($thisfile_riff_video) &amp;&amp; isset($thisfile_audio['bitrate']) &amp;&amp; ($thisfile_audio['bitrate'] &gt; 0) &amp;&amp; ($ThisFileInfo['playtime_seconds'] &gt; 0)) {
+
+			$ThisFileInfo['bitrate'] = ((($thisfile_avdataend - $thisfile_avdataoffset) / $ThisFileInfo['playtime_seconds']) * 8);
+			$thisfile_audio['bitrate'] = 0;
+			$thisfile_video['bitrate'] = $ThisFileInfo['bitrate'];
+			foreach ($thisfile_riff_audio as $channelnumber =&gt; $audioinfoarray) {
+				$thisfile_video['bitrate'] -= $audioinfoarray['bitrate'];
+				$thisfile_audio['bitrate'] += $audioinfoarray['bitrate'];
+			}
+			if ($thisfile_video['bitrate'] &lt;= 0) {
+				unset($thisfile_video['bitrate']);
+			}
+			if ($thisfile_audio['bitrate'] &lt;= 0) {
+				unset($thisfile_audio['bitrate']);
+			}
+		}
+
+		if (isset($ThisFileInfo['mpeg']['audio'])) {
+			$thisfile_audio_dataformat      = 'mp'.$ThisFileInfo['mpeg']['audio']['layer'];
+			$thisfile_audio['sample_rate']  = $ThisFileInfo['mpeg']['audio']['sample_rate'];
+			$thisfile_audio['channels']     = $ThisFileInfo['mpeg']['audio']['channels'];
+			$thisfile_audio['bitrate']      = $ThisFileInfo['mpeg']['audio']['bitrate'];
+			$thisfile_audio['bitrate_mode'] = strtolower($ThisFileInfo['mpeg']['audio']['bitrate_mode']);
+			if (!empty($ThisFileInfo['mpeg']['audio']['codec'])) {
+				$thisfile_audio['codec'] = $ThisFileInfo['mpeg']['audio']['codec'].' '.$thisfile_audio['codec'];
+			}
+			if (!empty($thisfile_audio['streams'])) {
+				foreach ($thisfile_audio['streams'] as $streamnumber =&gt; $streamdata) {
+					if ($streamdata['dataformat'] == $thisfile_audio_dataformat) {
+						$thisfile_audio['streams'][$streamnumber]['sample_rate']  = $thisfile_audio['sample_rate'];
+						$thisfile_audio['streams'][$streamnumber]['channels']     = $thisfile_audio['channels'];
+						$thisfile_audio['streams'][$streamnumber]['bitrate']      = $thisfile_audio['bitrate'];
+						$thisfile_audio['streams'][$streamnumber]['bitrate_mode'] = $thisfile_audio['bitrate_mode'];
+						$thisfile_audio['streams'][$streamnumber]['codec']        = $thisfile_audio['codec'];
+					}
+				}
+			}
+			$thisfile_audio['encoder_options'] = getid3_mp3::GuessEncoderOptions($ThisFileInfo);
+		}
+
+
+		if (!empty($thisfile_riff_raw['fmt ']['wBitsPerSample']) &amp;&amp; ($thisfile_riff_raw['fmt ']['wBitsPerSample'] &gt; 0)) {
+			switch ($thisfile_audio_dataformat) {
+				case 'ac3':
+					// ignore bits_per_sample
+					break;
+
+				default:
+					$thisfile_audio['bits_per_sample'] = $thisfile_riff_raw['fmt ']['wBitsPerSample'];
+					break;
+			}
+		}
+
+
+		if (empty($thisfile_riff_raw)) {
+			unset($thisfile_riff['raw']);
+		}
+		if (empty($thisfile_riff_audio)) {
+			unset($thisfile_riff['audio']);
+		}
+		if (empty($thisfile_riff_video)) {
+			unset($thisfile_riff['video']);
+		}
+
+		return true;
+	}
+
+
+	function RIFFcommentsParse(&amp;$RIFFinfoArray, &amp;$CommentsTargetArray) {
+		$RIFFinfoKeyLookup = array(
+			'IARL'=&gt;'archivallocation',
+			'IART'=&gt;'artist',
+			'ICDS'=&gt;'costumedesigner',
+			'ICMS'=&gt;'commissionedby',
+			'ICMT'=&gt;'comment',
+			'ICNT'=&gt;'country',
+			'ICOP'=&gt;'copyright',
+			'ICRD'=&gt;'creationdate',
+			'IDIM'=&gt;'dimensions',
+			'IDIT'=&gt;'digitizationdate',
+			'IDPI'=&gt;'resolution',
+			'IDST'=&gt;'distributor',
+			'IEDT'=&gt;'editor',
+			'IENG'=&gt;'engineers',
+			'IFRM'=&gt;'accountofparts',
+			'IGNR'=&gt;'genre',
+			'IKEY'=&gt;'keywords',
+			'ILGT'=&gt;'lightness',
+			'ILNG'=&gt;'language',
+			'IMED'=&gt;'orignalmedium',
+			'IMUS'=&gt;'composer',
+			'INAM'=&gt;'title',
+			'IPDS'=&gt;'productiondesigner',
+			'IPLT'=&gt;'palette',
+			'IPRD'=&gt;'product',
+			'IPRO'=&gt;'producer',
+			'IPRT'=&gt;'part',
+			'IRTD'=&gt;'rating',
+			'ISBJ'=&gt;'subject',
+			'ISFT'=&gt;'software',
+			'ISGN'=&gt;'secondarygenre',
+			'ISHP'=&gt;'sharpness',
+			'ISRC'=&gt;'sourcesupplier',
+			'ISRF'=&gt;'digitizationsource',
+			'ISTD'=&gt;'productionstudio',
+			'ISTR'=&gt;'starring',
+			'ITCH'=&gt;'encoded_by',
+			'IWEB'=&gt;'url',
+			'IWRI'=&gt;'writer'
+		);
+		foreach ($RIFFinfoKeyLookup as $key =&gt; $value) {
+			if (isset($RIFFinfoArray[$key])) {
+				foreach ($RIFFinfoArray[$key] as $commentid =&gt; $commentdata) {
+					if (trim($commentdata['data']) != '') {
+						@$CommentsTargetArray[$value][] = trim($commentdata['data']);
+					}
+				}
+			}
+		}
+		return true;
+	}
+
+	function ParseRIFF(&amp;$fd, $startoffset, $maxoffset, &amp;$ThisFileInfo) {
+
+		$maxoffset = min($maxoffset, $ThisFileInfo['avdataend']);
+
+		$RIFFchunk = false;
+		
+		fseek($fd, $startoffset, SEEK_SET);
+		
+		while (ftell($fd) &lt; $maxoffset) {
+			$chunkname = fread($fd, 4);
+			if (strlen($chunkname) &lt; 4) {
+				$ThisFileInfo['error'][] = 'Expecting chunk name at offset '.(ftell($fd) - 4).' but found nothing. Aborting RIFF parsing.';
+				break;
+			}
+			
+			$chunksize = getid3_riff::EitherEndian2Int($ThisFileInfo, fread($fd, 4));
+			if ($chunksize == 0) {
+				$ThisFileInfo['error'][] = 'Chunk size at offset '.(ftell($fd) - 4).' is zero. Aborting RIFF parsing.';
+				break;
+			}
+			if (($chunksize % 2) != 0) {
+				// all structures are packed on word boundaries
+				$chunksize++;
+			}
+
+			switch ($chunkname) {
+				case 'LIST':
+					$listname = fread($fd, 4);
+					switch ($listname) {
+						case 'movi':
+						case 'rec ':
+							$RIFFchunk[$listname]['offset'] = ftell($fd) - 4;
+							$RIFFchunk[$listname]['size']   = $chunksize;
+
+							static $ParsedAudioStream = false;
+							if ($ParsedAudioStream) {
+
+								// skip over
+
+							} else {
+
+								$WhereWeWere = ftell($fd);
+								$AudioChunkHeader = fread($fd, 12);
+								$AudioChunkStreamNum  =                              substr($AudioChunkHeader, 0, 2);
+								$AudioChunkStreamType =                              substr($AudioChunkHeader, 2, 2);
+								$AudioChunkSize       = getid3_lib::LittleEndian2Int(substr($AudioChunkHeader, 4, 4));
+
+								if ($AudioChunkStreamType == 'wb') {
+									$FirstFourBytes = substr($AudioChunkHeader, 8, 4);
+									if (preg_match('/^\xFF[\xE2-\xE7\xF2-\xF7\xFA-\xFF][\x00-\xEB]/s', $FirstFourBytes)) {
+
+										// MP3
+										if (getid3_mp3::MPEGaudioHeaderBytesValid($FirstFourBytes)) {
+											$dummy = $ThisFileInfo;
+											$dummy['avdataoffset'] = ftell($fd) - 4;
+											$dummy['avdataend']    = ftell($fd) + $AudioChunkSize;
+											getid3_mp3::getOnlyMPEGaudioInfo($fd, $dummy, $dummy['avdataoffset'], false);
+											if (isset($dummy['mpeg']['audio'])) {
+												$ThisFileInfo = $dummy;
+												$ThisFileInfo['audio']['dataformat']   = 'mp'.$ThisFileInfo['mpeg']['audio']['layer'];
+												$ThisFileInfo['audio']['sample_rate']  = $ThisFileInfo['mpeg']['audio']['sample_rate'];
+												$ThisFileInfo['audio']['channels']     = $ThisFileInfo['mpeg']['audio']['channels'];
+												$ThisFileInfo['audio']['bitrate']      = $ThisFileInfo['mpeg']['audio']['bitrate'];
+												$ThisFileInfo['bitrate']               = $ThisFileInfo['audio']['bitrate'];
+												$ThisFileInfo['audio']['bitrate_mode'] = strtolower($ThisFileInfo['mpeg']['audio']['bitrate_mode']);
+											}
+										}
+
+									} elseif (preg_match('/^\x0B\x77/s', $FirstFourBytes)) {
+
+										// AC3
+										$GETID3_ERRORARRAY = &amp;$ThisFileInfo['warning'];
+										if (getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio.ac3.php', __FILE__, false)) {
+
+											$dummy = $ThisFileInfo;
+											$dummy['avdataoffset'] = ftell($fd) - 4;
+											$dummy['avdataend']    = ftell($fd) + $AudioChunkSize;
+											$dummy['error']        = array();
+											$ac3_tag = new getid3_ac3($fd, $dummy);
+											if (empty($dummy['error'])) {
+												$ThisFileInfo['audio']   = $dummy['audio'];
+												$ThisFileInfo['ac3']     = $dummy['ac3'];
+												$ThisFileInfo['warning'] = $dummy['warning'];
+											}
+
+										}
+
+									}
+
+								}
+
+								$ParsedAudioStream = true;
+								fseek($fd, $WhereWeWere, SEEK_SET);
+
+							}
+							fseek($fd, $chunksize - 4, SEEK_CUR);
+							break;
+
+						default:
+							if (!isset($RIFFchunk[$listname])) {
+								$RIFFchunk[$listname] = array();
+							}
+							$LISTchunkParent    = $listname;
+							$LISTchunkMaxOffset = ftell($fd) - 4 + $chunksize;
+							if ($parsedChunk = getid3_riff::ParseRIFF($fd, ftell($fd), ftell($fd) + $chunksize - 4, $ThisFileInfo)) {
+								$RIFFchunk[$listname] = array_merge_recursive($RIFFchunk[$listname], $parsedChunk);
+							}
+							break;
+					}
+					break;
+
+				default:
+					$thisindex = 0;
+					if (isset($RIFFchunk[$chunkname]) &amp;&amp; is_array($RIFFchunk[$chunkname])) {
+						$thisindex = count($RIFFchunk[$chunkname]);
+					}
+					$RIFFchunk[$chunkname][$thisindex]['offset'] = ftell($fd) - 8;
+					$RIFFchunk[$chunkname][$thisindex]['size']   = $chunksize;
+					switch ($chunkname) {
+						case 'data':
+							$ThisFileInfo['avdataoffset'] = ftell($fd);
+							$ThisFileInfo['avdataend']    = $ThisFileInfo['avdataoffset'] + $chunksize;
+
+							$RIFFdataChunkContentsTest = fread($fd, 36);
+
+							if ((strlen($RIFFdataChunkContentsTest) &gt; 0) &amp;&amp; preg_match('/^\xFF[\xE2-\xE7\xF2-\xF7\xFA-\xFF][\x00-\xEB]/s', substr($RIFFdataChunkContentsTest, 0, 4))) {
+
+								// Probably is MP3 data
+								if (getid3_mp3::MPEGaudioHeaderBytesValid(substr($RIFFdataChunkContentsTest, 0, 4))) {
+									getid3_mp3::getOnlyMPEGaudioInfo($fd, $ThisFileInfo, $RIFFchunk[$chunkname][$thisindex]['offset'], false);
+								}
+
+							} elseif ((strlen($RIFFdataChunkContentsTest) &gt; 0) &amp;&amp; (substr($RIFFdataChunkContentsTest, 0, 2) == &quot;\x0B\x77&quot;)) {
+
+								// This is probably AC-3 data
+								$GETID3_ERRORARRAY = &amp;$ThisFileInfo['warning'];
+								if (getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio.ac3.php', __FILE__, false)) {
+
+									$dummy = $ThisFileInfo;
+									$dummy['avdataoffset'] = $RIFFchunk[$chunkname][$thisindex]['offset'];
+									$dummy['avdataend']    = $dummy['avdataoffset'] + $RIFFchunk[$chunkname][$thisindex]['size'];
+									$dummy['error']        = array();
+
+									$ac3_tag = new getid3_ac3($fd, $dummy);
+									if (empty($dummy['error'])) {
+										$ThisFileInfo['audio']   = $dummy['audio'];
+										$ThisFileInfo['ac3']     = $dummy['ac3'];
+										$ThisFileInfo['warning'] = $dummy['warning'];
+									}
+
+								}
+
+							} elseif ((strlen($RIFFdataChunkContentsTest) &gt; 0) &amp;&amp; (substr($RIFFdataChunkContentsTest, 8, 2) == &quot;\x77\x0B&quot;)) {
+
+								// Dolby Digital WAV
+								// AC-3 content, but not encoded in same format as normal AC-3 file
+								// For one thing, byte order is swapped
+
+								$GETID3_ERRORARRAY = &amp;$ThisFileInfo['warning'];
+								if (getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio.ac3.php', __FILE__, false)) {
+
+									// ok to use tmpfile here - only 56 bytes
+									if ($fd_temp = tmpfile()) {
+
+										for ($i = 0; $i &lt; 28; $i += 2) {
+											// swap byte order
+											fwrite($fd_temp, substr($RIFFdataChunkContentsTest, 8 + $i + 1, 1));
+											fwrite($fd_temp, substr($RIFFdataChunkContentsTest, 8 + $i + 0, 1));
+										}
+
+										$dummy = $ThisFileInfo;
+										$dummy['avdataoffset'] = 0;
+										$dummy['avdataend']    = 20;
+										$dummy['error']        = array();
+										$ac3_tag = new getid3_ac3($fd_temp, $dummy);
+										fclose($fd_temp);
+										if (empty($dummy['error'])) {
+											$ThisFileInfo['audio']   = $dummy['audio'];
+											$ThisFileInfo['ac3']     = $dummy['ac3'];
+											$ThisFileInfo['warning'] = $dummy['warning'];
+										} else {
+											$ThisFileInfo['error'][] = 'Errors parsing DolbyDigital WAV: '.explode(';', $dummy['error']);
+										}
+
+									} else {
+
+										$ThisFileInfo['error'][] = 'Could not create temporary file to analyze DolbyDigital WAV';
+
+									}
+
+								}
+
+							} elseif ((strlen($RIFFdataChunkContentsTest) &gt; 0) &amp;&amp; (substr($RIFFdataChunkContentsTest, 0, 4) == 'wvpk')) {
+
+								// This is WavPack data
+								$ThisFileInfo['wavpack']['offset'] = $RIFFchunk[$chunkname][$thisindex]['offset'];
+								$ThisFileInfo['wavpack']['size']   = getid3_lib::LittleEndian2Int(substr($RIFFdataChunkContentsTest, 4, 4));
+								getid3_riff::RIFFparseWavPackHeader(substr($RIFFdataChunkContentsTest, 8, 28), $ThisFileInfo);
+
+							} else {
+
+								// This is some other kind of data (quite possibly just PCM)
+								// do nothing special, just skip it
+
+							}
+							fseek($fd, $RIFFchunk[$chunkname][$thisindex]['offset'] + 8 + $chunksize, SEEK_SET);
+							break;
+
+						case 'bext':
+						case 'cart':
+						case 'fmt ':
+						case 'MEXT':
+						case 'DISP':
+							// always read data in
+							$RIFFchunk[$chunkname][$thisindex]['data'] = fread($fd, $chunksize);
+							break;
+
+						default:
+							if (!empty($LISTchunkParent) &amp;&amp; (($RIFFchunk[$chunkname][$thisindex]['offset'] + $RIFFchunk[$chunkname][$thisindex]['size']) &lt;= $LISTchunkMaxOffset)) {
+								$RIFFchunk[$LISTchunkParent][$chunkname][$thisindex]['offset'] = $RIFFchunk[$chunkname][$thisindex]['offset'];
+								$RIFFchunk[$LISTchunkParent][$chunkname][$thisindex]['size']   = $RIFFchunk[$chunkname][$thisindex]['size'];
+								unset($RIFFchunk[$chunkname][$thisindex]['offset']);
+								unset($RIFFchunk[$chunkname][$thisindex]['size']);
+								if (isset($RIFFchunk[$chunkname][$thisindex]) &amp;&amp; empty($RIFFchunk[$chunkname][$thisindex])) {
+									unset($RIFFchunk[$chunkname][$thisindex]);
+								}
+								if (isset($RIFFchunk[$chunkname]) &amp;&amp; empty($RIFFchunk[$chunkname])) {
+									unset($RIFFchunk[$chunkname]);
+								}
+								$RIFFchunk[$LISTchunkParent][$chunkname][$thisindex]['data'] = fread($fd, $chunksize);
+							} elseif ($chunksize &lt; 2048) {
+								// only read data in if smaller than 2kB
+								$RIFFchunk[$chunkname][$thisindex]['data'] = fread($fd, $chunksize);
+							} else {
+								fseek($fd, $chunksize, SEEK_CUR);
+							}
+							break;
+					}
+					break;
+
+			}
+
+		}
+
+		return $RIFFchunk;
+	}
+
+
+	function ParseRIFFdata(&amp;$RIFFdata, &amp;$ThisFileInfo) {
+		if ($RIFFdata) {
+		
+		    $tempfile = tempnam('*', 'getID3');
+            $fp_temp  = fopen($tempfile, &quot;wb&quot;);
+			$RIFFdataLength = strlen($RIFFdata);
+			$NewLengthString = getid3_lib::LittleEndian2String($RIFFdataLength, 4);
+			for ($i = 0; $i &lt; 4; $i++) {
+				$RIFFdata{$i + 4} = $NewLengthString{$i};
+			}
+			fwrite($fp_temp, $RIFFdata);
+			fclose($fp_temp);
+			
+			$fp_temp  = fopen($tempfile, &quot;rb&quot;);
+			$dummy = array('filesize'=&gt;$RIFFdataLength, 'filenamepath'=&gt;$ThisFileInfo['filenamepath'], 'tags'=&gt;$ThisFileInfo['tags'], 'avdataoffset'=&gt;0, 'avdataend'=&gt;$RIFFdataLength, 'warning'=&gt;$ThisFileInfo['warning'], 'error'=&gt;$ThisFileInfo['error'], 'comments'=&gt;$ThisFileInfo['comments'], 'audio'=&gt;(isset($ThisFileInfo['audio']) ? $ThisFileInfo['audio'] : array()), 'video'=&gt;(isset($ThisFileInfo['video']) ? $ThisFileInfo['video'] : array()));
+			$riff = new getid3_riff($fp_temp, $dummy);
+			$ThisFileInfo['riff']     = $dummy['riff'];
+			$ThisFileInfo['warning']  = $dummy['warning'];
+			$ThisFileInfo['error']    = $dummy['error'];
+			$ThisFileInfo['tags']     = $dummy['tags'];
+			$ThisFileInfo['comments'] = $dummy['comments'];
+			fclose($fp_temp);
+			unlink($tempfile);
+			return true;
+		}
+		return false;
+	}
+
+
+	function RIFFparseWAVEFORMATex($WaveFormatExData) {
+		// shortcut
+		$WaveFormatEx['raw'] = array();
+		$WaveFormatEx_raw    = &amp;$WaveFormatEx['raw'];
+
+		$WaveFormatEx_raw['wFormatTag']      = getid3_lib::LittleEndian2Int(substr($WaveFormatExData,  0, 2));
+		$WaveFormatEx_raw['nChannels']       = getid3_lib::LittleEndian2Int(substr($WaveFormatExData,  2, 2));
+		$WaveFormatEx_raw['nSamplesPerSec']  = getid3_lib::LittleEndian2Int(substr($WaveFormatExData,  4, 4));
+		$WaveFormatEx_raw['nAvgBytesPerSec'] = getid3_lib::LittleEndian2Int(substr($WaveFormatExData,  8, 4));
+		$WaveFormatEx_raw['nBlockAlign']     = getid3_lib::LittleEndian2Int(substr($WaveFormatExData, 12, 2));
+		$WaveFormatEx_raw['wBitsPerSample']  = getid3_lib::LittleEndian2Int(substr($WaveFormatExData, 14, 2));
+		if (strlen($WaveFormatExData) &gt; 16) {
+			$WaveFormatEx_raw['cbSize']      = getid3_lib::LittleEndian2Int(substr($WaveFormatExData, 16, 2));
+		}
+
+		$WaveFormatEx['codec']           = getid3_riff::RIFFwFormatTagLookup($WaveFormatEx_raw['wFormatTag']);
+		$WaveFormatEx['channels']        = $WaveFormatEx_raw['nChannels'];
+		$WaveFormatEx['sample_rate']     = $WaveFormatEx_raw['nSamplesPerSec'];
+		$WaveFormatEx['bitrate']         = $WaveFormatEx_raw['nAvgBytesPerSec'] * 8;
+		$WaveFormatEx['bits_per_sample'] = $WaveFormatEx_raw['wBitsPerSample'];
+
+		return $WaveFormatEx;
+	}
+
+
+	function RIFFparseWavPackHeader($WavPackChunkData, &amp;$ThisFileInfo) {
+		// typedef struct {
+		//     char ckID [4];
+		//     long ckSize;
+		//     short version;
+		//     short bits;                // added for version 2.00
+		//     short flags, shift;        // added for version 3.00
+		//     long total_samples, crc, crc2;
+		//     char extension [4], extra_bc, extras [3];
+		// } WavpackHeader;
+
+		// shortcut
+		$ThisFileInfo['wavpack'] = array();
+		$thisfile_wavpack        = &amp;$ThisFileInfo['wavpack'];
+
+		$thisfile_wavpack['version']           = getid3_lib::LittleEndian2Int(substr($WavPackChunkData,  0, 2));
+		if ($thisfile_wavpack['version'] &gt;= 2) {
+			$thisfile_wavpack['bits']          = getid3_lib::LittleEndian2Int(substr($WavPackChunkData,  2, 2));
+		}
+		if ($thisfile_wavpack['version'] &gt;= 3) {
+			$thisfile_wavpack['flags_raw']     = getid3_lib::LittleEndian2Int(substr($WavPackChunkData,  4, 2));
+			$thisfile_wavpack['shift']         = getid3_lib::LittleEndian2Int(substr($WavPackChunkData,  6, 2));
+			$thisfile_wavpack['total_samples'] = getid3_lib::LittleEndian2Int(substr($WavPackChunkData,  8, 4));
+			$thisfile_wavpack['crc1']          = getid3_lib::LittleEndian2Int(substr($WavPackChunkData, 12, 4));
+			$thisfile_wavpack['crc2']          = getid3_lib::LittleEndian2Int(substr($WavPackChunkData, 16, 4));
+			$thisfile_wavpack['extension']     =                              substr($WavPackChunkData, 20, 4);
+			$thisfile_wavpack['extra_bc']      = getid3_lib::LittleEndian2Int(substr($WavPackChunkData, 24, 1));
+			for ($i = 0; $i &lt;= 2; $i++) {
+				$thisfile_wavpack['extras'][]  = getid3_lib::LittleEndian2Int(substr($WavPackChunkData, 25 + $i, 1));
+			}
+
+			// shortcut
+			$thisfile_wavpack['flags'] = array();
+			$thisfile_wavpack_flags = &amp;$thisfile_wavpack['flags'];
+
+			$thisfile_wavpack_flags['mono']                 = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x000001);
+			$thisfile_wavpack_flags['fast_mode']            = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x000002);
+			$thisfile_wavpack_flags['raw_mode']             = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x000004);
+			$thisfile_wavpack_flags['calc_noise']           = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x000008);
+			$thisfile_wavpack_flags['high_quality']         = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x000010);
+			$thisfile_wavpack_flags['3_byte_samples']       = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x000020);
+			$thisfile_wavpack_flags['over_20_bits']         = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x000040);
+			$thisfile_wavpack_flags['use_wvc']              = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x000080);
+			$thisfile_wavpack_flags['noiseshaping']         = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x000100);
+			$thisfile_wavpack_flags['very_fast_mode']       = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x000200);
+			$thisfile_wavpack_flags['new_high_quality']     = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x000400);
+			$thisfile_wavpack_flags['cancel_extreme']       = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x000800);
+			$thisfile_wavpack_flags['cross_decorrelation']  = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x001000);
+			$thisfile_wavpack_flags['new_decorrelation']    = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x002000);
+			$thisfile_wavpack_flags['joint_stereo']         = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x004000);
+			$thisfile_wavpack_flags['extra_decorrelation']  = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x008000);
+			$thisfile_wavpack_flags['override_noiseshape']  = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x010000);
+			$thisfile_wavpack_flags['override_jointstereo'] = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x020000);
+			$thisfile_wavpack_flags['copy_source_filetime'] = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x040000);
+			$thisfile_wavpack_flags['create_exe']           = (bool) ($thisfile_wavpack['flags_raw'] &amp; 0x080000);
+		}
+
+		return true;
+	}
+
+	function RIFFwFormatTagLookup($wFormatTag) {
+
+		$begin = __LINE__;
+
+		/** This is not a comment!
+
+			0x0000	Microsoft Unknown Wave Format
+			0x0001	Pulse Code Modulation (PCM)
+			0x0002	Microsoft ADPCM
+			0x0003	IEEE Float
+			0x0004	Compaq Computer VSELP
+			0x0005	IBM CVSD
+			0x0006	Microsoft A-Law
+			0x0007	Microsoft mu-Law
+			0x0008	Microsoft DTS
+			0x0010	OKI ADPCM
+			0x0011	Intel DVI/IMA ADPCM
+			0x0012	Videologic MediaSpace ADPCM
+			0x0013	Sierra Semiconductor ADPCM
+			0x0014	Antex Electronics G.723 ADPCM
+			0x0015	DSP Solutions DigiSTD
+			0x0016	DSP Solutions DigiFIX
+			0x0017	Dialogic OKI ADPCM
+			0x0018	MediaVision ADPCM
+			0x0019	Hewlett-Packard CU
+			0x0020	Yamaha ADPCM
+			0x0021	Speech Compression Sonarc
+			0x0022	DSP Group TrueSpeech
+			0x0023	Echo Speech EchoSC1
+			0x0024	Audiofile AF36
+			0x0025	Audio Processing Technology APTX
+			0x0026	AudioFile AF10
+			0x0027	Prosody 1612
+			0x0028	LRC
+			0x0030	Dolby AC2
+			0x0031	Microsoft GSM 6.10
+			0x0032	MSNAudio
+			0x0033	Antex Electronics ADPCME
+			0x0034	Control Resources VQLPC
+			0x0035	DSP Solutions DigiREAL
+			0x0036	DSP Solutions DigiADPCM
+			0x0037	Control Resources CR10
+			0x0038	Natural MicroSystems VBXADPCM
+			0x0039	Crystal Semiconductor IMA ADPCM
+			0x003A	EchoSC3
+			0x003B	Rockwell ADPCM
+			0x003C	Rockwell Digit LK
+			0x003D	Xebec
+			0x0040	Antex Electronics G.721 ADPCM
+			0x0041	G.728 CELP
+			0x0042	MSG723
+			0x0050	MPEG Layer-2 or Layer-1
+			0x0052	RT24
+			0x0053	PAC
+			0x0055	MPEG Layer-3
+			0x0059	Lucent G.723
+			0x0060	Cirrus
+			0x0061	ESPCM
+			0x0062	Voxware
+			0x0063	Canopus Atrac
+			0x0064	G.726 ADPCM
+			0x0065	G.722 ADPCM
+			0x0066	DSAT
+			0x0067	DSAT Display
+			0x0069	Voxware Byte Aligned
+			0x0070	Voxware AC8
+			0x0071	Voxware AC10
+			0x0072	Voxware AC16
+			0x0073	Voxware AC20
+			0x0074	Voxware MetaVoice
+			0x0075	Voxware MetaSound
+			0x0076	Voxware RT29HW
+			0x0077	Voxware VR12
+			0x0078	Voxware VR18
+			0x0079	Voxware TQ40
+			0x0080	Softsound
+			0x0081	Voxware TQ60
+			0x0082	MSRT24
+			0x0083	G.729A
+			0x0084	MVI MV12
+			0x0085	DF G.726
+			0x0086	DF GSM610
+			0x0088	ISIAudio
+			0x0089	Onlive
+			0x0091	SBC24
+			0x0092	Dolby AC3 SPDIF
+			0x0093	MediaSonic G.723
+			0x0094	Aculab PLC    Prosody 8kbps
+			0x0097	ZyXEL ADPCM
+			0x0098	Philips LPCBB
+			0x0099	Packed
+			0x00FF	AAC
+			0x0100	Rhetorex ADPCM
+			0x0101	IBM mu-law
+			0x0102	IBM A-law
+			0x0103	IBM AVC Adaptive Differential Pulse Code Modulation (ADPCM)
+			0x0111	Vivo G.723
+			0x0112	Vivo Siren
+			0x0123	Digital G.723
+			0x0125	Sanyo LD ADPCM
+			0x0130	Sipro Lab Telecom ACELP NET
+			0x0131	Sipro Lab Telecom ACELP 4800
+			0x0132	Sipro Lab Telecom ACELP 8V3
+			0x0133	Sipro Lab Telecom G.729
+			0x0134	Sipro Lab Telecom G.729A
+			0x0135	Sipro Lab Telecom Kelvin
+			0x0140	Windows Media Video V8
+			0x0150	Qualcomm PureVoice
+			0x0151	Qualcomm HalfRate
+			0x0155	Ring Zero Systems TUB GSM
+			0x0160	Microsoft Audio 1
+			0x0161	Windows Media Audio V7 / V8 / V9
+			0x0162	Windows Media Audio Professional V9
+			0x0163	Windows Media Audio Lossless V9
+			0x0200	Creative Labs ADPCM
+			0x0202	Creative Labs Fastspeech8
+			0x0203	Creative Labs Fastspeech10
+			0x0210	UHER Informatic GmbH ADPCM
+			0x0220	Quarterdeck
+			0x0230	I-link Worldwide VC
+			0x0240	Aureal RAW Sport
+			0x0250	Interactive Products HSX
+			0x0251	Interactive Products RPELP
+			0x0260	Consistent Software CS2
+			0x0270	Sony SCX
+			0x0300	Fujitsu FM Towns Snd
+			0x0400	BTV Digital
+			0x0401	Intel Music Coder
+			0x0450	QDesign Music
+			0x0680	VME VMPCM
+			0x0681	AT&amp;T Labs TPC
+			0x08AE	ClearJump LiteWave
+			0x1000	Olivetti GSM
+			0x1001	Olivetti ADPCM
+			0x1002	Olivetti CELP
+			0x1003	Olivetti SBC
+			0x1004	Olivetti OPR
+			0x1100	Lernout &amp; Hauspie Codec (0x1100)
+			0x1101	Lernout &amp; Hauspie CELP Codec (0x1101)
+			0x1102	Lernout &amp; Hauspie SBC Codec (0x1102)
+			0x1103	Lernout &amp; Hauspie SBC Codec (0x1103)
+			0x1104	Lernout &amp; Hauspie SBC Codec (0x1104)
+			0x1400	Norris
+			0x1401	AT&amp;T ISIAudio
+			0x1500	Soundspace Music Compression
+			0x181C	VoxWare RT24 Speech
+			0x1FC4	NCT Soft ALF2CD (www.nctsoft.com)
+			0x2000	Dolby AC3
+			0x2001	Dolby DTS
+			0x2002	WAVE_FORMAT_14_4
+			0x2003	WAVE_FORMAT_28_8
+			0x2004	WAVE_FORMAT_COOK
+			0x2005	WAVE_FORMAT_DNET
+			0x674F	Ogg Vorbis 1
+			0x6750	Ogg Vorbis 2
+			0x6751	Ogg Vorbis 3
+			0x676F	Ogg Vorbis 1+
+			0x6770	Ogg Vorbis 2+
+			0x6771	Ogg Vorbis 3+
+			0x7A21	GSM-AMR (CBR, no SID)
+			0x7A22	GSM-AMR (VBR, including SID)
+			0xFFFE	WAVE_FORMAT_EXTENSIBLE
+			0xFFFF	WAVE_FORMAT_DEVELOPMENT
+
+		*/
+
+		return getid3_lib::EmbeddedLookup('0x'.str_pad(strtoupper(dechex($wFormatTag)), 4, '0', STR_PAD_LEFT), $begin, __LINE__, __FILE__, 'riff-wFormatTag');
+
+	}
+
+
+	function RIFFfourccLookup($fourcc) {
+
+		$begin = __LINE__;
+
+		/** This is not a comment!
+
+			swot	<A HREF="http://developer.apple.com/qa/snd/snd07.html">http://developer.apple.com/qa/snd/snd07.html</A>
+			____	No Codec (____)
+			_BIT	BI_BITFIELDS (Raw RGB)
+			_JPG	JPEG compressed
+			_PNG	PNG compressed W3C/ISO/IEC (RFC-2083)
+			_RAW	Full Frames (Uncompressed)
+			_RGB	Raw RGB Bitmap
+			_RL4	RLE 4bpp RGB
+			_RL8	RLE 8bpp RGB
+			3IV1	3ivx MPEG-4 v1
+			3IV2	3ivx MPEG-4 v2
+			3IVX	3ivx MPEG-4
+			AASC	Autodesk Animator
+			ABYR	Kensington ?ABYR?
+			AEMI	Array Microsystems VideoONE MPEG1-I Capture
+			AFLC	Autodesk Animator FLC
+			AFLI	Autodesk Animator FLI
+			AMPG	Array Microsystems VideoONE MPEG
+			ANIM	Intel RDX (ANIM)
+			AP41	AngelPotion Definitive
+			ASV1	Asus Video v1
+			ASV2	Asus Video v2
+			ASVX	Asus Video 2.0 (audio)
+			AUR2	AuraVision Aura 2 Codec - YUV 4:2:2
+			AURA	AuraVision Aura 1 Codec - YUV 4:1:1
+			AVDJ	Independent JPEG Group\'s codec (AVDJ)
+			AVRN	Independent JPEG Group\'s codec (AVRN)
+			AYUV	4:4:4 YUV (AYUV)
+			AZPR	Quicktime Apple Video (AZPR)
+			BGR 	Raw RGB32
+			BLZ0	Blizzard DivX MPEG-4
+			BTVC	Conexant Composite Video
+			BINK	RAD Game Tools Bink Video
+			BT20	Conexant Prosumer Video
+			BTCV	Conexant Composite Video Codec
+			BW10	Data Translation Broadway MPEG Capture
+			CC12	Intel YUV12
+			CDVC	Canopus DV
+			CFCC	Digital Processing Systems DPS Perception
+			CGDI	Microsoft Office 97 Camcorder Video
+			CHAM	Winnov Caviara Champagne
+			CJPG	Creative WebCam JPEG
+			CLJR	Cirrus Logic YUV 4:1:1
+			CMYK	Common Data Format in Printing (Colorgraph)
+			CPLA	Weitek 4:2:0 YUV Planar
+			CRAM	Microsoft Video 1 (CRAM)
+			cvid	Radius Cinepak
+			CVID	Radius Cinepak
+			CWLT	Microsoft Color WLT DIB
+			CYUV	Creative Labs YUV
+			CYUY	ATI YUV
+			D261	H.261
+			D263	H.263
+			DIB 	Device Independent Bitmap
+			DIV1	FFmpeg OpenDivX
+			DIV2	Microsoft MPEG-4 v1/v2
+			DIV3	DivX ;-) MPEG-4 v3.x Low-Motion
+			DIV4	DivX ;-) MPEG-4 v3.x Fast-Motion
+			DIV5	DivX MPEG-4 v5.x
+			DIV6	DivX ;-) (MS MPEG-4 v3.x)
+			DIVX	DivX MPEG-4 v4 (OpenDivX / Project Mayo)
+			divx	DivX MPEG-4
+			DMB1	Matrox Rainbow Runner hardware MJPEG
+			DMB2	Paradigm MJPEG
+			DSVD	?DSVD?
+			DUCK	Duck TrueMotion 1.0
+			DPS0	DPS/Leitch Reality Motion JPEG
+			DPSC	DPS/Leitch PAR Motion JPEG
+			DV25	Matrox DVCPRO codec
+			DV50	Matrox DVCPRO50 codec
+			DVC 	IEC 61834 and SMPTE 314M (DVC/DV Video)
+			DVCP	IEC 61834 and SMPTE 314M (DVC/DV Video)
+			DVHD	IEC Standard DV 1125 lines @ 30fps / 1250 lines @ 25fps
+			DVMA	Darim Vision DVMPEG (dummy for MPEG compressor) (www.darvision.com)
+			DVSL	IEC Standard DV compressed in SD (SDL)
+			DVAN	?DVAN?
+			DVE2	InSoft DVE-2 Videoconferencing
+			dvsd	IEC 61834 and SMPTE 314M DVC/DV Video
+			DVSD	IEC 61834 and SMPTE 314M DVC/DV Video
+			DVX1	Lucent DVX1000SP Video Decoder
+			DVX2	Lucent DVX2000S Video Decoder
+			DVX3	Lucent DVX3000S Video Decoder
+			DX50	DivX v5
+			DXT1	Microsoft DirectX Compressed Texture (DXT1)
+			DXT2	Microsoft DirectX Compressed Texture (DXT2)
+			DXT3	Microsoft DirectX Compressed Texture (DXT3)
+			DXT4	Microsoft DirectX Compressed Texture (DXT4)
+			DXT5	Microsoft DirectX Compressed Texture (DXT5)
+			DXTC	Microsoft DirectX Compressed Texture (DXTC)
+			DXTn	Microsoft DirectX Compressed Texture (DXTn)
+			EM2V	Etymonix MPEG-2 I-frame (www.etymonix.com)
+			EKQ0	Elsa ?EKQ0?
+			ELK0	Elsa ?ELK0?
+			ESCP	Eidos Escape
+			ETV1	eTreppid Video ETV1
+			ETV2	eTreppid Video ETV2
+			ETVC	eTreppid Video ETVC
+			FLIC	Autodesk FLI/FLC Animation
+			FRWT	Darim Vision Forward Motion JPEG (www.darvision.com)
+			FRWU	Darim Vision Forward Uncompressed (www.darvision.com)
+			FLJP	D-Vision Field Encoded Motion JPEG
+			FRWA	SoftLab-Nsk Forward Motion JPEG w/ alpha channel
+			FRWD	SoftLab-Nsk Forward Motion JPEG
+			FVF1	Iterated Systems Fractal Video Frame
+			GLZW	Motion LZW (<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">gabest at freemail.hu</A>)
+			GPEG	Motion JPEG (<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">gabest at freemail.hu</A>)
+			GWLT	Microsoft Greyscale WLT DIB
+			H260	Intel ITU H.260 Videoconferencing
+			H261	Intel ITU H.261 Videoconferencing
+			H262	Intel ITU H.262 Videoconferencing
+			H263	Intel ITU H.263 Videoconferencing
+			H264	Intel ITU H.264 Videoconferencing
+			H265	Intel ITU H.265 Videoconferencing
+			H266	Intel ITU H.266 Videoconferencing
+			H267	Intel ITU H.267 Videoconferencing
+			H268	Intel ITU H.268 Videoconferencing
+			H269	Intel ITU H.269 Videoconferencing
+			HFYU	Huffman Lossless Codec
+			HMCR	Rendition Motion Compensation Format (HMCR)
+			HMRR	Rendition Motion Compensation Format (HMRR)
+			I263	FFmpeg I263 decoder
+			IF09	Indeo YVU9 (&quot;YVU9 with additional delta-frame info after the U plane&quot;)
+			IUYV	Interlaced version of UYVY (www.leadtools.com)
+			IY41	Interlaced version of Y41P (www.leadtools.com)
+			IYU1	12 bit format used in mode 2 of the IEEE 1394 Digital Camera 1.04 spec    IEEE standard
+			IYU2	24 bit format used in mode 2 of the IEEE 1394 Digital Camera 1.04 spec    IEEE standard
+			IYUV	Planar YUV format (8-bpp Y plane, followed by 8-bpp 2&#215;2 U and V planes)
+			i263	Intel ITU H.263 Videoconferencing (i263)
+			I420	Intel Indeo 4
+			IAN 	Intel Indeo 4 (RDX)
+			ICLB	InSoft CellB Videoconferencing
+			IGOR	Power DVD
+			IJPG	Intergraph JPEG
+			ILVC	Intel Layered Video
+			ILVR	ITU-T H.263+
+			IPDV	I-O Data Device Giga AVI DV Codec
+			IR21	Intel Indeo 2.1
+			IRAW	Intel YUV Uncompressed
+			IV30	Intel Indeo 3.0
+			IV31	Intel Indeo 3.1
+			IV32	Ligos Indeo 3.2
+			IV33	Ligos Indeo 3.3
+			IV34	Ligos Indeo 3.4
+			IV35	Ligos Indeo 3.5
+			IV36	Ligos Indeo 3.6
+			IV37	Ligos Indeo 3.7
+			IV38	Ligos Indeo 3.8
+			IV39	Ligos Indeo 3.9
+			IV40	Ligos Indeo Interactive 4.0
+			IV41	Ligos Indeo Interactive 4.1
+			IV42	Ligos Indeo Interactive 4.2
+			IV43	Ligos Indeo Interactive 4.3
+			IV44	Ligos Indeo Interactive 4.4
+			IV45	Ligos Indeo Interactive 4.5
+			IV46	Ligos Indeo Interactive 4.6
+			IV47	Ligos Indeo Interactive 4.7
+			IV48	Ligos Indeo Interactive 4.8
+			IV49	Ligos Indeo Interactive 4.9
+			IV50	Ligos Indeo Interactive 5.0
+			JBYR	Kensington ?JBYR?
+			JPEG	Still Image JPEG DIB
+			JPGL	Pegasus Lossless Motion JPEG
+			KMVC	Team17 Software Karl Morton\'s Video Codec
+			LSVM	Vianet Lighting Strike Vmail (Streaming) (www.vianet.com)
+			LEAD	LEAD Video Codec
+			Ljpg	LEAD MJPEG Codec
+			MDVD	Alex MicroDVD Video (hacked MS MPEG-4) (www.tiasoft.de)
+			MJPA	Morgan Motion JPEG (MJPA) (www.morgan-multimedia.com)
+			MJPB	Morgan Motion JPEG (MJPB) (www.morgan-multimedia.com)
+			MMES	Matrox MPEG-2 I-frame
+			MP2v	Microsoft S-Mpeg 4 version 1 (MP2v)
+			MP42	Microsoft S-Mpeg 4 version 2 (MP42)
+			MP43	Microsoft S-Mpeg 4 version 3 (MP43)
+			MP4S	Microsoft S-Mpeg 4 version 3 (MP4S)
+			MP4V	FFmpeg MPEG-4
+			MPG1	FFmpeg MPEG 1/2
+			MPG2	FFmpeg MPEG 1/2
+			MPG3	FFmpeg DivX ;-) (MS MPEG-4 v3)
+			MPG4	Microsoft MPEG-4
+			MPGI	Sigma Designs MPEG
+			MPNG	PNG images decoder
+			MSS1	Microsoft Windows Screen Video
+			MSZH	LCL (Lossless Codec Library) (www.geocities.co.jp/Playtown-Denei/2837/LRC.htm)
+			M261	Microsoft H.261
+			M263	Microsoft H.263
+			M4S2	Microsoft Fully Compliant MPEG-4 v2 simple profile (M4S2)
+			m4s2	Microsoft Fully Compliant MPEG-4 v2 simple profile (m4s2)
+			MC12	ATI Motion Compensation Format (MC12)
+			MCAM	ATI Motion Compensation Format (MCAM)
+			MJ2C	Morgan Multimedia Motion JPEG2000
+			mJPG	IBM Motion JPEG w/ Huffman Tables
+			MJPG	Microsoft Motion JPEG DIB
+			MP42	Microsoft MPEG-4 (low-motion)
+			MP43	Microsoft MPEG-4 (fast-motion)
+			MP4S	Microsoft MPEG-4 (MP4S)
+			mp4s	Microsoft MPEG-4 (mp4s)
+			MPEG	Chromatic Research MPEG-1 Video I-Frame
+			MPG4	Microsoft MPEG-4 Video High Speed Compressor
+			MPGI	Sigma Designs MPEG
+			MRCA	FAST Multimedia Martin Regen Codec
+			MRLE	Microsoft Run Length Encoding
+			MSVC	Microsoft Video 1
+			MTX1	Matrox ?MTX1?
+			MTX2	Matrox ?MTX2?
+			MTX3	Matrox ?MTX3?
+			MTX4	Matrox ?MTX4?
+			MTX5	Matrox ?MTX5?
+			MTX6	Matrox ?MTX6?
+			MTX7	Matrox ?MTX7?
+			MTX8	Matrox ?MTX8?
+			MTX9	Matrox ?MTX9?
+			MV12	Motion Pixels Codec (old)
+			MWV1	Aware Motion Wavelets
+			nAVI	SMR Codec (hack of Microsoft MPEG-4) (IRC #shadowrealm)
+			NT00	NewTek LightWave HDTV YUV w/ Alpha (www.newtek.com)
+			NUV1	NuppelVideo
+			NTN1	Nogatech Video Compression 1
+			NVS0	nVidia GeForce Texture (NVS0)
+			NVS1	nVidia GeForce Texture (NVS1)
+			NVS2	nVidia GeForce Texture (NVS2)
+			NVS3	nVidia GeForce Texture (NVS3)
+			NVS4	nVidia GeForce Texture (NVS4)
+			NVS5	nVidia GeForce Texture (NVS5)
+			NVT0	nVidia GeForce Texture (NVT0)
+			NVT1	nVidia GeForce Texture (NVT1)
+			NVT2	nVidia GeForce Texture (NVT2)
+			NVT3	nVidia GeForce Texture (NVT3)
+			NVT4	nVidia GeForce Texture (NVT4)
+			NVT5	nVidia GeForce Texture (NVT5)
+			PIXL	MiroXL, Pinnacle PCTV
+			PDVC	I-O Data Device Digital Video Capture DV codec
+			PGVV	Radius Video Vision
+			PHMO	IBM Photomotion
+			PIM1	MPEG Realtime (Pinnacle Cards)
+			PIM2	Pegasus Imaging ?PIM2?
+			PIMJ	Pegasus Imaging Lossless JPEG
+			PVEZ	Horizons Technology PowerEZ
+			PVMM	PacketVideo Corporation MPEG-4
+			PVW2	Pegasus Imaging Wavelet Compression
+			Q1.0	Q-Team\'s QPEG 1.0 (www.q-team.de)
+			Q1.1	Q-Team\'s QPEG 1.1 (www.q-team.de)
+			QPEG	Q-Team QPEG 1.0
+			qpeq	Q-Team QPEG 1.1
+			RGB 	Raw BGR32
+			RGBA	Raw RGB w/ Alpha
+			RMP4	REALmagic MPEG-4 (unauthorized XVID copy) (www.sigmadesigns.com)
+			ROQV	Id RoQ File Video Decoder
+			RPZA	Quicktime Apple Video (RPZA)
+			RUD0	Rududu video codec (<A HREF="http://rududu.ifrance.com/rududu/">http://rududu.ifrance.com/rududu/</A>)
+			RV10	RealVideo 1.0 (aka RealVideo 5.0)
+			RV13	RealVideo 1.0 (RV13)
+			RV20	RealVideo G2
+			RV30	RealVideo 8
+			RV40	RealVideo 9
+			RGBT	Raw RGB w/ Transparency
+			RLE 	Microsoft Run Length Encoder
+			RLE4	Run Length Encoded (4bpp, 16-color)
+			RLE8	Run Length Encoded (8bpp, 256-color)
+			RT21	Intel Indeo RealTime Video 2.1
+			rv20	RealVideo G2
+			rv30	RealVideo 8
+			RVX 	Intel RDX (RVX )
+			SMC 	Apple Graphics (SMC )
+			SP54	Logitech Sunplus Sp54 Codec for Mustek GSmart Mini 2
+			SPIG	Radius Spigot
+			SVQ3	Sorenson Video 3 (Apple Quicktime 5)
+			s422	Tekram VideoCap C210 YUV 4:2:2
+			SDCC	Sun Communication Digital Camera Codec
+			SFMC	CrystalNet Surface Fitting Method
+			SMSC	Radius SMSC
+			SMSD	Radius SMSD
+			smsv	WorldConnect Wavelet Video
+			SPIG	Radius Spigot
+			SPLC	Splash Studios ACM Audio Codec (www.splashstudios.net)
+			SQZ2	Microsoft VXTreme Video Codec V2
+			STVA	ST Microelectronics CMOS Imager Data (Bayer)
+			STVB	ST Microelectronics CMOS Imager Data (Nudged Bayer)
+			STVC	ST Microelectronics CMOS Imager Data (Bunched)
+			STVX	ST Microelectronics CMOS Imager Data (Extended CODEC Data Format)
+			STVY	ST Microelectronics CMOS Imager Data (Extended CODEC Data Format with Correction Data)
+			SV10	Sorenson Video R1
+			SVQ1	Sorenson Video
+			T420	Toshiba YUV 4:2:0
+			TM2A	Duck TrueMotion Archiver 2.0 (www.duck.com)
+			TVJP	Pinnacle/Truevision Targa 2000 board (TVJP)
+			TVMJ	Pinnacle/Truevision Targa 2000 board (TVMJ)
+			TY0N	Tecomac Low-Bit Rate Codec (www.tecomac.com)
+			TY2C	Trident Decompression Driver
+			TLMS	TeraLogic Motion Intraframe Codec (TLMS)
+			TLST	TeraLogic Motion Intraframe Codec (TLST)
+			TM20	Duck TrueMotion 2.0
+			TM2X	Duck TrueMotion 2X
+			TMIC	TeraLogic Motion Intraframe Codec (TMIC)
+			TMOT	Horizons Technology TrueMotion S
+			tmot	Horizons TrueMotion Video Compression
+			TR20	Duck TrueMotion RealTime 2.0
+			TSCC	TechSmith Screen Capture Codec
+			TV10	Tecomac Low-Bit Rate Codec
+			TY2N	Trident ?TY2N?
+			U263	UB Video H.263/H.263+/H.263++ Decoder
+			UMP4	UB Video MPEG 4 (www.ubvideo.com)
+			UYNV	Nvidia UYVY packed 4:2:2
+			UYVP	Evans &amp; Sutherland YCbCr 4:2:2 extended precision
+			UCOD	eMajix.com ClearVideo
+			ULTI	IBM Ultimotion
+			UYVY	UYVY packed 4:2:2
+			V261	Lucent VX2000S
+			VIFP	VFAPI Reader Codec (www.yks.ne.jp/~hori/)
+			VIV1	FFmpeg H263+ decoder
+			VIV2	Vivo H.263
+			VQC2	Vector-quantised codec 2 (research) <A HREF="http://eprints.ecs.soton.ac.uk/archive/00001310/01/VTC97-js.pdf">http://eprints.ecs.soton.ac.uk/archive/00001310/01/VTC97-js.pdf</A>)
+			VTLP	Alaris VideoGramPiX
+			VYU9	ATI YUV (VYU9)
+			VYUY	ATI YUV (VYUY)
+			V261	Lucent VX2000S
+			V422	Vitec Multimedia 24-bit YUV 4:2:2 Format
+			V655	Vitec Multimedia 16-bit YUV 4:2:2 Format
+			VCR1	ATI Video Codec 1
+			VCR2	ATI Video Codec 2
+			VCR3	ATI VCR 3.0
+			VCR4	ATI VCR 4.0
+			VCR5	ATI VCR 5.0
+			VCR6	ATI VCR 6.0
+			VCR7	ATI VCR 7.0
+			VCR8	ATI VCR 8.0
+			VCR9	ATI VCR 9.0
+			VDCT	Vitec Multimedia Video Maker Pro DIB
+			VDOM	VDOnet VDOWave
+			VDOW	VDOnet VDOLive (H.263)
+			VDTZ	Darim Vison VideoTizer YUV
+			VGPX	Alaris VideoGramPiX
+			VIDS	Vitec Multimedia YUV 4:2:2 CCIR 601 for V422
+			VIVO	Vivo H.263 v2.00
+			vivo	Vivo H.263
+			VIXL	Miro/Pinnacle Video XL
+			VLV1	VideoLogic/PURE Digital Videologic Capture
+			VP30	On2 VP3.0
+			VP31	On2 VP3.1
+			VX1K	Lucent VX1000S Video Codec
+			VX2K	Lucent VX2000S Video Codec
+			VXSP	Lucent VX1000SP Video Codec
+			WBVC	Winbond W9960
+			WHAM	Microsoft Video 1 (WHAM)
+			WINX	Winnov Software Compression
+			WJPG	AverMedia Winbond JPEG
+			WMV1	Windows Media Video V7
+			WMV2	Windows Media Video V8
+			WMV3	Windows Media Video V9
+			WNV1	Winnov Hardware Compression
+			XYZP	Extended PAL format XYZ palette (www.riff.org)
+			x263	Xirlink H.263
+			XLV0	NetXL Video Decoder
+			XMPG	Xing MPEG (I-Frame only)
+			XVID	XviD MPEG-4 (www.xvid.org)
+			XXAN	?XXAN?
+			Y422	ADS Technologies Copy of UYVY used in Pyro WebCam firewire camera
+			Y800	Simple, single Y plane for monochrome images
+			YU92	Intel YUV (YU92)
+			YUNV	Nvidia Uncompressed YUV 4:2:2
+			YUVP	Extended PAL format YUV palette (www.riff.org)
+			Y211	YUV 2:1:1 Packed
+			Y411	YUV 4:1:1 Packed
+			Y41B	Weitek YUV 4:1:1 Planar
+			Y41P	Brooktree PC1 YUV 4:1:1 Packed
+			Y41T	Brooktree PC1 YUV 4:1:1 with transparency
+			Y42B	Weitek YUV 4:2:2 Planar
+			Y42T	Brooktree UYUV 4:2:2 with transparency
+			Y8  	Grayscale video
+			YC12	Intel YUV 12 codec
+			YUV8	Winnov Caviar YUV8
+			YUV9	Intel YUV9
+			YUY2	Uncompressed YUV 4:2:2
+			YUYV	Canopus YUV
+			YV12	YVU12 Planar
+			YVU9	Intel YVU9 Planar (8-bpp Y plane, followed by 8-bpp 4x4 U and V planes)
+			YVYU	YVYU 4:2:2 Packed
+			ZLIB	Lossless Codec Library zlib compression (www.geocities.co.jp/Playtown-Denei/2837/LRC.htm)
+			ZPEG	Metheus Video Zipper
+
+		*/
+
+		return getid3_lib::EmbeddedLookup($fourcc, $begin, __LINE__, __FILE__, 'riff-fourcc');
+	}
+
+
+	function EitherEndian2Int(&amp;$ThisFileInfo, $byteword, $signed=false) {
+		if ($ThisFileInfo['fileformat'] == 'riff') {
+			return getid3_lib::LittleEndian2Int($byteword, $signed);
+		}
+		return getid3_lib::BigEndian2Int($byteword, false, $signed);
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio-video.riff.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio-video.swf.php
===================================================================
--- trunk/inc/external/getid3/module.audio-video.swf.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio-video.swf.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,141 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio-video.swf.php                                  //
+// module for analyzing Shockwave Flash files                  //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_swf
+{
+
+	function getid3_swf(&amp;$fd, &amp;$ThisFileInfo, $ReturnAllTagData=false) {
+		$ThisFileInfo['fileformat']          = 'swf';
+		$ThisFileInfo['video']['dataformat'] = 'swf';
+
+		// <A HREF="http://www.openswf.org/spec/SWFfileformat.html">http://www.openswf.org/spec/SWFfileformat.html</A>
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+
+		$SWFfileData = fread($fd, $ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']); // 8 + 2 + 2 + max(9) bytes NOT including Frame_Size RECT data
+
+		$ThisFileInfo['swf']['header']['signature']   = substr($SWFfileData, 0, 3);
+		switch ($ThisFileInfo['swf']['header']['signature']) {
+			case 'FWS':
+				$ThisFileInfo['swf']['header']['compressed'] = false;
+				break;
+
+			case 'CWS':
+				$ThisFileInfo['swf']['header']['compressed'] = true;
+				break;
+
+			default:
+				$ThisFileInfo['error'][] = 'Expecting &quot;FWS&quot; or &quot;CWS&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.$ThisFileInfo['swf']['header']['signature'].'&quot;';
+				unset($ThisFileInfo['swf']);
+				unset($ThisFileInfo['fileformat']);
+				return false;
+				break;
+		}
+		$ThisFileInfo['swf']['header']['version']      = getid3_lib::LittleEndian2Int(substr($SWFfileData, 3, 1));
+		$ThisFileInfo['swf']['header']['length']       = getid3_lib::LittleEndian2Int(substr($SWFfileData, 4, 4));
+
+		if ($ThisFileInfo['swf']['header']['compressed']) {
+
+			if ($UncompressedFileData = @gzuncompress(substr($SWFfileData, 8))) {
+
+				$SWFfileData = substr($SWFfileData, 0, 8).$UncompressedFileData;
+
+			} else {
+
+				$ThisFileInfo['error'][] = 'Error decompressing compressed SWF data';
+				return false;
+
+			}
+
+		}
+
+		$FrameSizeBitsPerValue = (ord(substr($SWFfileData, 8, 1)) &amp; 0xF8) &gt;&gt; 3;
+		$FrameSizeDataLength   = ceil((5 + (4 * $FrameSizeBitsPerValue)) / 8);
+		$FrameSizeDataString   = str_pad(decbin(ord(substr($SWFfileData, 8, 1)) &amp; 0x07), 3, '0', STR_PAD_LEFT);
+		for ($i = 1; $i &lt; $FrameSizeDataLength; $i++) {
+			$FrameSizeDataString .= str_pad(decbin(ord(substr($SWFfileData, 8 + $i, 1))), 8, '0', STR_PAD_LEFT);
+		}
+		list($X1, $X2, $Y1, $Y2) = explode(&quot;\n&quot;, wordwrap($FrameSizeDataString, $FrameSizeBitsPerValue, &quot;\n&quot;, 1));
+		$ThisFileInfo['swf']['header']['frame_width']  = getid3_lib::Bin2Dec($X2);
+		$ThisFileInfo['swf']['header']['frame_height'] = getid3_lib::Bin2Dec($Y2);
+
+		// <A HREF="http://www-lehre.informatik.uni-osnabrueck.de/~fbstark/diplom/docs/swf/Flash_Uncovered.htm">http://www-lehre.informatik.uni-osnabrueck.de/~fbstark/diplom/docs/swf/Flash_Uncovered.htm</A>
+		// Next in the header is the frame rate, which is kind of weird.
+		// It is supposed to be stored as a 16bit integer, but the first byte
+		// (or last depending on how you look at it) is completely ignored.
+		// Example: 0x000C  -&gt;  0x0C  -&gt;  12     So the frame rate is 12 fps.
+
+		// Byte at (8 + $FrameSizeDataLength) is always zero and ignored
+		$ThisFileInfo['swf']['header']['frame_rate']  = getid3_lib::LittleEndian2Int(substr($SWFfileData,  9 + $FrameSizeDataLength, 1));
+		$ThisFileInfo['swf']['header']['frame_count'] = getid3_lib::LittleEndian2Int(substr($SWFfileData, 10 + $FrameSizeDataLength, 2));
+
+		$ThisFileInfo['video']['frame_rate']         = $ThisFileInfo['swf']['header']['frame_rate'];
+		$ThisFileInfo['video']['resolution_x']       = intval(round($ThisFileInfo['swf']['header']['frame_width']  / 20));
+		$ThisFileInfo['video']['resolution_y']       = intval(round($ThisFileInfo['swf']['header']['frame_height'] / 20));
+		$ThisFileInfo['video']['pixel_aspect_ratio'] = (float) 1;
+
+		if (($ThisFileInfo['swf']['header']['frame_count'] &gt; 0) &amp;&amp; ($ThisFileInfo['swf']['header']['frame_rate'] &gt; 0)) {
+			$ThisFileInfo['playtime_seconds'] = $ThisFileInfo['swf']['header']['frame_count'] / $ThisFileInfo['swf']['header']['frame_rate'];
+		}
+
+
+		// SWF tags
+
+		$CurrentOffset = 12 + $FrameSizeDataLength;
+		$SWFdataLength = strlen($SWFfileData);
+
+		while ($CurrentOffset &lt; $SWFdataLength) {
+
+			$TagIDTagLength = getid3_lib::LittleEndian2Int(substr($SWFfileData, $CurrentOffset, 2));
+			$TagID     = ($TagIDTagLength &amp; 0xFFFC) &gt;&gt; 6;
+			$TagLength = ($TagIDTagLength &amp; 0x003F);
+			$CurrentOffset += 2;
+			if ($TagLength == 0x3F) {
+				$TagLength = getid3_lib::LittleEndian2Int(substr($SWFfileData, $CurrentOffset, 4));
+				$CurrentOffset += 4;
+			}
+
+			unset($TagData);
+			$TagData['offset'] = $CurrentOffset;
+			$TagData['size']   = $TagLength;
+			$TagData['id']     = $TagID;
+			$TagData['data']   = substr($SWFfileData, $CurrentOffset, $TagLength);
+			switch ($TagID) {
+				case 0: // end of movie
+					break 2;
+
+				case 9: // Set background color
+					//$ThisFileInfo['swf']['tags'][] = $TagData;
+					$ThisFileInfo['swf']['bgcolor'] = strtoupper(str_pad(dechex(getid3_lib::BigEndian2Int($TagData['data'])), 6, '0', STR_PAD_LEFT));
+					break;
+
+				default:
+					if ($ReturnAllTagData) {
+						$ThisFileInfo['swf']['tags'][] = $TagData;
+					}
+					break;
+			}
+
+			$CurrentOffset += $TagLength;
+		}
+
+		return true;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio-video.swf.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.aac.php
===================================================================
--- trunk/inc/external/getid3/module.audio.aac.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.aac.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,538 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.aac.php                                        //
+// module for analyzing AAC Audio files                        //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_aac
+{
+
+	// new combined constructor
+	function getid3_aac(&amp;$fd, &amp;$ThisFileInfo, $option) {
+
+		if ($option === 'adif') {
+			$this-&gt;getAACADIFheaderFilepointer($fd, $ThisFileInfo);
+		}
+		elseif ($option === 'adts') {
+			$this-&gt;getAACADTSheaderFilepointer($fd, $ThisFileInfo);
+		}
+	}
+
+
+
+	function getAACADIFheaderFilepointer(&amp;$fd, &amp;$ThisFileInfo) {
+		$ThisFileInfo['fileformat']          = 'aac';
+		$ThisFileInfo['audio']['dataformat'] = 'aac';
+		$ThisFileInfo['audio']['lossless']   = false;
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$AACheader = fread($fd, 1024);
+		$offset    = 0;
+
+		if (substr($AACheader, 0, 4) == 'ADIF') {
+
+			// <A HREF="http://faac.sourceforge.net/wiki/index.php?page=ADIF">http://faac.sourceforge.net/wiki/index.php?page=ADIF</A>
+
+			// <A HREF="http://libmpeg.org/mpeg4/doc/w2203tfs.pdf">http://libmpeg.org/mpeg4/doc/w2203tfs.pdf</A>
+			// adif_header() {
+			//     adif_id                                32
+			//     copyright_id_present                    1
+			//     if( copyright_id_present )
+			//         copyright_id                       72
+			//     original_copy                           1
+			//     home                                    1
+			//     bitstream_type                          1
+			//     bitrate                                23
+			//     num_program_config_elements             4
+			//     for (i = 0; i &lt; num_program_config_elements + 1; i++ ) {
+			//         if( bitstream_type == '0' )
+			//             adif_buffer_fullness           20
+			//         program_config_element()
+			//     }
+			// }
+
+			$AACheaderBitstream = getid3_lib::BigEndian2Bin($AACheader);
+			$bitoffset          = 0;
+
+			$ThisFileInfo['aac']['header_type']                   = 'ADIF';
+			$bitoffset += 32;
+			$ThisFileInfo['aac']['header']['mpeg_version']        = 4;
+
+			$ThisFileInfo['aac']['header']['copyright']           = (bool) (substr($AACheaderBitstream, $bitoffset, 1) == '1');
+			$bitoffset += 1;
+			if ($ThisFileInfo['aac']['header']['copyright']) {
+				$ThisFileInfo['aac']['header']['copyright_id']    = getid3_lib::Bin2String(substr($AACheaderBitstream, $bitoffset, 72));
+				$bitoffset += 72;
+			}
+			$ThisFileInfo['aac']['header']['original_copy']       = (bool) (substr($AACheaderBitstream, $bitoffset, 1) == '1');
+			$bitoffset += 1;
+			$ThisFileInfo['aac']['header']['home']                = (bool) (substr($AACheaderBitstream, $bitoffset, 1) == '1');
+			$bitoffset += 1;
+			$ThisFileInfo['aac']['header']['is_vbr']              = (bool) (substr($AACheaderBitstream, $bitoffset, 1) == '1');
+			$bitoffset += 1;
+			if ($ThisFileInfo['aac']['header']['is_vbr']) {
+				$ThisFileInfo['audio']['bitrate_mode']            = 'vbr';
+				$ThisFileInfo['aac']['header']['bitrate_max']     = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 23));
+				$bitoffset += 23;
+			} else {
+				$ThisFileInfo['audio']['bitrate_mode']            = 'cbr';
+				$ThisFileInfo['aac']['header']['bitrate']         = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 23));
+				$bitoffset += 23;
+				$ThisFileInfo['audio']['bitrate']                 = $ThisFileInfo['aac']['header']['bitrate'];
+			}
+			if ($ThisFileInfo['audio']['bitrate'] == 0) {
+				$ThisFileInfo['error'][] = 'Corrupt AAC file: bitrate_audio == zero';
+				return false;
+			}
+			$ThisFileInfo['aac']['header']['num_program_configs'] = 1 + getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+			$bitoffset += 4;
+
+			for ($i = 0; $i &lt; $ThisFileInfo['aac']['header']['num_program_configs']; $i++) {
+				// <A HREF="http://www.audiocoding.com/wiki/index.php?page=program_config_element">http://www.audiocoding.com/wiki/index.php?page=program_config_element</A>
+
+				// buffer_fullness                       20
+
+				// element_instance_tag                   4
+				// object_type                            2
+				// sampling_frequency_index               4
+				// num_front_channel_elements             4
+				// num_side_channel_elements              4
+				// num_back_channel_elements              4
+				// num_lfe_channel_elements               2
+				// num_assoc_data_elements                3
+				// num_valid_cc_elements                  4
+				// mono_mixdown_present                   1
+				// mono_mixdown_element_number            4   if mono_mixdown_present == 1
+				// stereo_mixdown_present                 1
+				// stereo_mixdown_element_number          4   if stereo_mixdown_present == 1
+				// matrix_mixdown_idx_present             1
+				// matrix_mixdown_idx                     2   if matrix_mixdown_idx_present == 1
+				// pseudo_surround_enable                 1   if matrix_mixdown_idx_present == 1
+				// for (i = 0; i &lt; num_front_channel_elements; i++) {
+				//     front_element_is_cpe[i]            1
+				//     front_element_tag_select[i]        4
+				// }
+				// for (i = 0; i &lt; num_side_channel_elements; i++) {
+				//     side_element_is_cpe[i]             1
+				//     side_element_tag_select[i]         4
+				// }
+				// for (i = 0; i &lt; num_back_channel_elements; i++) {
+				//     back_element_is_cpe[i]             1
+				//     back_element_tag_select[i]         4
+				// }
+				// for (i = 0; i &lt; num_lfe_channel_elements; i++) {
+				//     lfe_element_tag_select[i]          4
+				// }
+				// for (i = 0; i &lt; num_assoc_data_elements; i++) {
+				//     assoc_data_element_tag_select[i]   4
+				// }
+				// for (i = 0; i &lt; num_valid_cc_elements; i++) {
+				//     cc_element_is_ind_sw[i]            1
+				//     valid_cc_element_tag_select[i]     4
+				// }
+				// byte_alignment()                       VAR
+				// comment_field_bytes                    8
+				// for (i = 0; i &lt; comment_field_bytes; i++) {
+				//     comment_field_data[i]              8
+				// }
+
+				if (!$ThisFileInfo['aac']['header']['is_vbr']) {
+					$ThisFileInfo['aac']['program_configs'][$i]['buffer_fullness']        = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 20));
+					$bitoffset += 20;
+				}
+				$ThisFileInfo['aac']['program_configs'][$i]['element_instance_tag']       = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+				$bitoffset += 4;
+				$ThisFileInfo['aac']['program_configs'][$i]['object_type']                = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 2));
+				$bitoffset += 2;
+				$ThisFileInfo['aac']['program_configs'][$i]['sampling_frequency_index']   = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+				$bitoffset += 4;
+				$ThisFileInfo['aac']['program_configs'][$i]['num_front_channel_elements'] = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+				$bitoffset += 4;
+				$ThisFileInfo['aac']['program_configs'][$i]['num_side_channel_elements']  = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+				$bitoffset += 4;
+				$ThisFileInfo['aac']['program_configs'][$i]['num_back_channel_elements']  = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+				$bitoffset += 4;
+				$ThisFileInfo['aac']['program_configs'][$i]['num_lfe_channel_elements']   = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 2));
+				$bitoffset += 2;
+				$ThisFileInfo['aac']['program_configs'][$i]['num_assoc_data_elements']    = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 3));
+				$bitoffset += 3;
+				$ThisFileInfo['aac']['program_configs'][$i]['num_valid_cc_elements']      = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+				$bitoffset += 4;
+				$ThisFileInfo['aac']['program_configs'][$i]['mono_mixdown_present']       = (bool) getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 1));
+				$bitoffset += 1;
+				if ($ThisFileInfo['aac']['program_configs'][$i]['mono_mixdown_present']) {
+					$ThisFileInfo['aac']['program_configs'][$i]['mono_mixdown_element_number']    = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+					$bitoffset += 4;
+				}
+				$ThisFileInfo['aac']['program_configs'][$i]['stereo_mixdown_present']             = (bool) getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 1));
+				$bitoffset += 1;
+				if ($ThisFileInfo['aac']['program_configs'][$i]['stereo_mixdown_present']) {
+					$ThisFileInfo['aac']['program_configs'][$i]['stereo_mixdown_element_number']  = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+					$bitoffset += 4;
+				}
+				$ThisFileInfo['aac']['program_configs'][$i]['matrix_mixdown_idx_present']         = (bool) getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 1));
+				$bitoffset += 1;
+				if ($ThisFileInfo['aac']['program_configs'][$i]['matrix_mixdown_idx_present']) {
+					$ThisFileInfo['aac']['program_configs'][$i]['matrix_mixdown_idx']             = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 2));
+					$bitoffset += 2;
+					$ThisFileInfo['aac']['program_configs'][$i]['pseudo_surround_enable']         = (bool) getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 1));
+					$bitoffset += 1;
+				}
+				for ($j = 0; $j &lt; $ThisFileInfo['aac']['program_configs'][$i]['num_front_channel_elements']; $j++) {
+					$ThisFileInfo['aac']['program_configs'][$i]['front_element_is_cpe'][$j]     = (bool) getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 1));
+					$bitoffset += 1;
+					$ThisFileInfo['aac']['program_configs'][$i]['front_element_tag_select'][$j] = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+					$bitoffset += 4;
+				}
+				for ($j = 0; $j &lt; $ThisFileInfo['aac']['program_configs'][$i]['num_side_channel_elements']; $j++) {
+					$ThisFileInfo['aac']['program_configs'][$i]['side_element_is_cpe'][$j]     = (bool) getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 1));
+					$bitoffset += 1;
+					$ThisFileInfo['aac']['program_configs'][$i]['side_element_tag_select'][$j] = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+					$bitoffset += 4;
+				}
+				for ($j = 0; $j &lt; $ThisFileInfo['aac']['program_configs'][$i]['num_back_channel_elements']; $j++) {
+					$ThisFileInfo['aac']['program_configs'][$i]['back_element_is_cpe'][$j]     = (bool) getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 1));
+					$bitoffset += 1;
+					$ThisFileInfo['aac']['program_configs'][$i]['back_element_tag_select'][$j] = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+					$bitoffset += 4;
+				}
+				for ($j = 0; $j &lt; $ThisFileInfo['aac']['program_configs'][$i]['num_lfe_channel_elements']; $j++) {
+					$ThisFileInfo['aac']['program_configs'][$i]['lfe_element_tag_select'][$j] = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+					$bitoffset += 4;
+				}
+				for ($j = 0; $j &lt; $ThisFileInfo['aac']['program_configs'][$i]['num_assoc_data_elements']; $j++) {
+					$ThisFileInfo['aac']['program_configs'][$i]['assoc_data_element_tag_select'][$j] = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+					$bitoffset += 4;
+				}
+				for ($j = 0; $j &lt; $ThisFileInfo['aac']['program_configs'][$i]['num_valid_cc_elements']; $j++) {
+					$ThisFileInfo['aac']['program_configs'][$i]['cc_element_is_ind_sw'][$j]          = (bool) getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 1));
+					$bitoffset += 1;
+					$ThisFileInfo['aac']['program_configs'][$i]['valid_cc_element_tag_select'][$j]   = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+					$bitoffset += 4;
+				}
+
+				$bitoffset = ceil($bitoffset / 8) * 8;
+
+				$ThisFileInfo['aac']['program_configs'][$i]['comment_field_bytes'] = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 8));
+				$bitoffset += 8;
+				$ThisFileInfo['aac']['program_configs'][$i]['comment_field']       = getid3_lib::Bin2String(substr($AACheaderBitstream, $bitoffset, 8 * $ThisFileInfo['aac']['program_configs'][$i]['comment_field_bytes']));
+				$bitoffset += 8 * $ThisFileInfo['aac']['program_configs'][$i]['comment_field_bytes'];
+
+
+				$ThisFileInfo['aac']['header']['profile_text']                      = $this-&gt;AACprofileLookup($ThisFileInfo['aac']['program_configs'][$i]['object_type'], $ThisFileInfo['aac']['header']['mpeg_version']);
+				$ThisFileInfo['aac']['program_configs'][$i]['sampling_frequency']   = $this-&gt;AACsampleRateLookup($ThisFileInfo['aac']['program_configs'][$i]['sampling_frequency_index']);
+				$ThisFileInfo['audio']['sample_rate']                               = $ThisFileInfo['aac']['program_configs'][$i]['sampling_frequency'];
+				$ThisFileInfo['audio']['channels']                                  = $this-&gt;AACchannelCountCalculate($ThisFileInfo['aac']['program_configs'][$i]);
+				if ($ThisFileInfo['aac']['program_configs'][$i]['comment_field']) {
+					$ThisFileInfo['aac']['comments'][]                          = $ThisFileInfo['aac']['program_configs'][$i]['comment_field'];
+				}
+			}
+			$ThisFileInfo['playtime_seconds'] = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['audio']['bitrate'];
+
+			$ThisFileInfo['audio']['encoder_options'] = $ThisFileInfo['aac']['header_type'].' '.$ThisFileInfo['aac']['header']['profile_text'];
+
+
+
+			return true;
+
+		} else {
+
+			unset($ThisFileInfo['fileformat']);
+			unset($ThisFileInfo['aac']);
+			$ThisFileInfo['error'][] = 'AAC-ADIF synch not found at offset '.$ThisFileInfo['avdataoffset'].' (expected &quot;ADIF&quot;, found &quot;'.substr($AACheader, 0, 4).'&quot; instead)';
+			return false;
+
+		}
+
+	}
+
+
+	function getAACADTSheaderFilepointer(&amp;$fd, &amp;$ThisFileInfo, $MaxFramesToScan=1000000, $ReturnExtendedInfo=false) {
+		// based loosely on code from AACfile by Jurgen Faul  &lt;jfaul&#216;gmx.de&gt;
+		// <A HREF="http://jfaul.de/atl">http://jfaul.de/atl</A>  or  <A HREF="http://j-faul.virtualave.net/atl/atl.html">http://j-faul.virtualave.net/atl/atl.html</A>
+
+
+		// <A HREF="http://faac.sourceforge.net/wiki/index.php?page=ADTS">http://faac.sourceforge.net/wiki/index.php?page=ADTS</A>
+
+		// * ADTS Fixed Header: these don't change from frame to frame
+		// syncword                                       12    always: '111111111111'
+		// ID                                              1    0: MPEG-4, 1: MPEG-2
+		// layer                                           2    always: '00'
+		// protection_absent                               1
+		// profile                                         2
+		// sampling_frequency_index                        4
+		// private_bit                                     1
+		// channel_configuration                           3
+		// original/copy                                   1
+		// home                                            1
+		// emphasis                                        2    only if ID == 0 (ie MPEG-4)
+
+		// * ADTS Variable Header: these can change from frame to frame
+		// copyright_identification_bit                    1
+		// copyright_identification_start                  1
+		// aac_frame_length                               13    length of the frame including header (in bytes)
+		// adts_buffer_fullness                           11    0x7FF indicates VBR
+		// no_raw_data_blocks_in_frame                     2
+
+		// * ADTS Error check
+		// crc_check                                      16    only if protection_absent == 0
+
+		$byteoffset  = 0;
+		$framenumber = 0;
+
+		// Init bit pattern array
+		static $decbin = array();
+
+		// Populate $bindec
+		for ($i = 0; $i &lt; 256; $i++) {
+			$decbin[chr($i)] = str_pad(decbin($i), 8, '0', STR_PAD_LEFT);
+		}
+
+		// used to calculate bitrate below
+		static $BitrateCache = array();
+
+
+		while (true) {
+			// breaks out when end-of-file encountered, or invalid data found,
+			// or MaxFramesToScan frames have been scanned
+
+			fseek($fd, $byteoffset, SEEK_SET);
+
+			// First get substring
+			$substring = fread($fd, 10);
+			$substringlength = strlen($substring);
+			if ($substringlength != 10) {
+				$ThisFileInfo['error'][] = 'Failed to read 10 bytes at offset '.(ftell($fd) - $substringlength).' (only read '.$substringlength.' bytes)';
+				return false;
+			}
+
+			// Initialise $AACheaderBitstream
+			$AACheaderBitstream = '';
+
+			// Loop thru substring chars
+			for ($i = 0; $i &lt; 10; $i++) {
+				$AACheaderBitstream .= $decbin[$substring{$i}];
+			}
+
+			$bitoffset = 0;
+
+			$synctest = bindec(substr($AACheaderBitstream, $bitoffset, 12));
+
+			$bitoffset += 12;
+			if ($synctest != 0x0FFF) {
+				$ThisFileInfo['error'][] = 'Synch pattern (0x0FFF) not found at offset '.(ftell($fd) - 10).' (found 0x0'.strtoupper(dechex($synctest)).' instead)';
+				if ($ThisFileInfo['fileformat'] == 'aac') {
+					return true;
+				}
+				return false;
+			}
+
+			// Gather info for first frame only - this takes time to do 1000 times!
+			if ($framenumber &gt; 0) {
+
+				if (!$AACheaderBitstream[$bitoffset]) {
+
+					// MPEG-4
+					$bitoffset += 20;
+
+				} else {
+
+					// MPEG-2
+					$bitoffset += 18;
+
+				}
+
+			} else {
+
+				$ThisFileInfo['aac']['header_type']                      = 'ADTS';
+				$ThisFileInfo['aac']['header']['synch']                  = $synctest;
+				$ThisFileInfo['fileformat']                              = 'aac';
+				$ThisFileInfo['audio']['dataformat']                     = 'aac';
+
+				$ThisFileInfo['aac']['header']['mpeg_version']           = ((substr($AACheaderBitstream, $bitoffset, 1) == '0') ? 4 : 2);
+				$bitoffset += 1;
+				$ThisFileInfo['aac']['header']['layer']                  = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 2));
+				$bitoffset += 2;
+				if ($ThisFileInfo['aac']['header']['layer'] != 0) {
+					$ThisFileInfo['error'][] = 'Layer error - expected 0x00, found 0x'.dechex($ThisFileInfo['aac']['header']['layer']).' instead';
+					return false;
+				}
+				$ThisFileInfo['aac']['header']['crc_present']            = ((substr($AACheaderBitstream, $bitoffset, 1) == '0') ? true : false);
+				$bitoffset += 1;
+				$ThisFileInfo['aac']['header']['profile_id']             = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 2));
+				$bitoffset += 2;
+				$ThisFileInfo['aac']['header']['profile_text']           = $this-&gt;AACprofileLookup($ThisFileInfo['aac']['header']['profile_id'], $ThisFileInfo['aac']['header']['mpeg_version']);
+
+				$ThisFileInfo['aac']['header']['sample_frequency_index'] = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 4));
+				$bitoffset += 4;
+				$ThisFileInfo['aac']['header']['sample_frequency']       = $this-&gt;AACsampleRateLookup($ThisFileInfo['aac']['header']['sample_frequency_index']);
+				if ($ThisFileInfo['aac']['header']['sample_frequency'] == 0) {
+					$ThisFileInfo['error'][] = 'Corrupt AAC file: sample_frequency == zero';
+					return false;
+				}
+				$ThisFileInfo['audio']['sample_rate']                    = $ThisFileInfo['aac']['header']['sample_frequency'];
+
+				$ThisFileInfo['aac']['header']['private']                = (bool) getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 1));
+				$bitoffset += 1;
+				$ThisFileInfo['aac']['header']['channel_configuration']  = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 3));
+				$bitoffset += 3;
+				$ThisFileInfo['audio']['channels']                       = $ThisFileInfo['aac']['header']['channel_configuration'];
+				$ThisFileInfo['aac']['header']['original']               = (bool) getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 1));
+				$bitoffset += 1;
+				$ThisFileInfo['aac']['header']['home']                   = (bool) getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 1));
+				$bitoffset += 1;
+
+				if ($ThisFileInfo['aac']['header']['mpeg_version'] == 4) {
+					$ThisFileInfo['aac']['header']['emphasis']           = getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 2));
+					$bitoffset += 2;
+				}
+
+				if ($ReturnExtendedInfo) {
+
+					$ThisFileInfo['aac'][$framenumber]['copyright_id_bit']   = (bool) getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 1));
+					$bitoffset += 1;
+					$ThisFileInfo['aac'][$framenumber]['copyright_id_start'] = (bool) getid3_lib::Bin2Dec(substr($AACheaderBitstream, $bitoffset, 1));
+					$bitoffset += 1;
+
+				} else {
+
+					$bitoffset += 2;
+
+				}
+
+			}
+
+			$FrameLength = bindec(substr($AACheaderBitstream, $bitoffset, 13));
+
+			if (!isset($BitrateCache[$FrameLength])) {
+				$BitrateCache[$FrameLength] = ($ThisFileInfo['aac']['header']['sample_frequency'] / 1024) * $FrameLength * 8;
+			}
+			@$ThisFileInfo['aac']['bitrate_distribution'][$BitrateCache[$FrameLength]]++;
+
+			$ThisFileInfo['aac'][$framenumber]['aac_frame_length']     = $FrameLength;
+			$bitoffset += 13;
+			$ThisFileInfo['aac'][$framenumber]['adts_buffer_fullness'] = bindec(substr($AACheaderBitstream, $bitoffset, 11));
+			$bitoffset += 11;
+			if ($ThisFileInfo['aac'][$framenumber]['adts_buffer_fullness'] == 0x07FF) {
+				$ThisFileInfo['audio']['bitrate_mode'] = 'vbr';
+			} else {
+				$ThisFileInfo['audio']['bitrate_mode'] = 'cbr';
+			}
+			$ThisFileInfo['aac'][$framenumber]['num_raw_data_blocks']  = bindec(substr($AACheaderBitstream, $bitoffset, 2));
+			$bitoffset += 2;
+
+			if ($ThisFileInfo['aac']['header']['crc_present']) {
+				//$ThisFileInfo['aac'][$framenumber]['crc']              = bindec(substr($AACheaderBitstream, $bitoffset, 16));
+				$bitoffset += 16;
+			}
+
+			if (!$ReturnExtendedInfo) {
+				unset($ThisFileInfo['aac'][$framenumber]);
+			}
+
+			$byteoffset += $FrameLength;
+			if ((++$framenumber &lt; $MaxFramesToScan) &amp;&amp; (($byteoffset + 10) &lt; $ThisFileInfo['avdataend'])) {
+
+				// keep scanning
+
+			} else {
+
+				$ThisFileInfo['aac']['frames']    = $framenumber;
+				$ThisFileInfo['playtime_seconds'] = ($ThisFileInfo['avdataend'] / $byteoffset) * (($framenumber * 1024) / $ThisFileInfo['aac']['header']['sample_frequency']);  // (1 / % of file scanned) * (samples / (samples/sec)) = seconds
+				if ($ThisFileInfo['playtime_seconds'] == 0) {
+					$ThisFileInfo['error'][] = 'Corrupt AAC file: playtime_seconds == zero';
+					return false;
+				}
+				$ThisFileInfo['audio']['bitrate']    = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['playtime_seconds'];
+				ksort($ThisFileInfo['aac']['bitrate_distribution']);
+
+				$ThisFileInfo['audio']['encoder_options'] = $ThisFileInfo['aac']['header_type'].' '.$ThisFileInfo['aac']['header']['profile_text'];
+
+				return true;
+
+			}
+		}
+		// should never get here.
+	}
+
+	function AACsampleRateLookup($samplerateid) {
+		static $AACsampleRateLookup = array();
+		if (empty($AACsampleRateLookup)) {
+			$AACsampleRateLookup[0]  = 96000;
+			$AACsampleRateLookup[1]  = 88200;
+			$AACsampleRateLookup[2]  = 64000;
+			$AACsampleRateLookup[3]  = 48000;
+			$AACsampleRateLookup[4]  = 44100;
+			$AACsampleRateLookup[5]  = 32000;
+			$AACsampleRateLookup[6]  = 24000;
+			$AACsampleRateLookup[7]  = 22050;
+			$AACsampleRateLookup[8]  = 16000;
+			$AACsampleRateLookup[9]  = 12000;
+			$AACsampleRateLookup[10] = 11025;
+			$AACsampleRateLookup[11] = 8000;
+			$AACsampleRateLookup[12] = 0;
+			$AACsampleRateLookup[13] = 0;
+			$AACsampleRateLookup[14] = 0;
+			$AACsampleRateLookup[15] = 0;
+		}
+		return (isset($AACsampleRateLookup[$samplerateid]) ? $AACsampleRateLookup[$samplerateid] : 'invalid');
+	}
+
+	function AACprofileLookup($profileid, $mpegversion) {
+		static $AACprofileLookup = array();
+		if (empty($AACprofileLookup)) {
+			$AACprofileLookup[2][0]  = 'Main profile';
+			$AACprofileLookup[2][1]  = 'Low Complexity profile (LC)';
+			$AACprofileLookup[2][2]  = 'Scalable Sample Rate profile (SSR)';
+			$AACprofileLookup[2][3]  = '(reserved)';
+			$AACprofileLookup[4][0]  = 'AAC_MAIN';
+			$AACprofileLookup[4][1]  = 'AAC_LC';
+			$AACprofileLookup[4][2]  = 'AAC_SSR';
+			$AACprofileLookup[4][3]  = 'AAC_LTP';
+		}
+		return (isset($AACprofileLookup[$mpegversion][$profileid]) ? $AACprofileLookup[$mpegversion][$profileid] : 'invalid');
+	}
+
+	function AACchannelCountCalculate($program_configs) {
+		$channels = 0;
+		for ($i = 0; $i &lt; $program_configs['num_front_channel_elements']; $i++) {
+			$channels++;
+			if ($program_configs['front_element_is_cpe'][$i]) {
+				// each front element is channel pair (CPE = Channel Pair Element)
+				$channels++;
+			}
+		}
+		for ($i = 0; $i &lt; $program_configs['num_side_channel_elements']; $i++) {
+			$channels++;
+			if ($program_configs['side_element_is_cpe'][$i]) {
+				// each side element is channel pair (CPE = Channel Pair Element)
+				$channels++;
+			}
+		}
+		for ($i = 0; $i &lt; $program_configs['num_back_channel_elements']; $i++) {
+			$channels++;
+			if ($program_configs['back_element_is_cpe'][$i]) {
+				// each back element is channel pair (CPE = Channel Pair Element)
+				$channels++;
+			}
+		}
+		for ($i = 0; $i &lt; $program_configs['num_lfe_channel_elements']; $i++) {
+			$channels++;
+		}
+		return $channels;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.aac.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.ac3.php
===================================================================
--- trunk/inc/external/getid3/module.audio.ac3.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.ac3.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,497 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.ac3.php                                        //
+// module for analyzing AC-3 (aka Dolby Digital) audio files   //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_ac3
+{
+
+	function getid3_ac3(&amp;$fd, &amp;$ThisFileInfo) {
+
+		///AH
+		$ThisFileInfo['ac3']['raw']['bsi'] = array();
+		$thisfile_ac3                      = &amp;$ThisFileInfo['ac3'];
+		$thisfile_ac3_raw                  = &amp;$thisfile_ac3['raw'];
+		$thisfile_ac3_raw_bsi              = &amp;$thisfile_ac3_raw['bsi'];
+
+
+		// <A HREF="http://www.atsc.org/standards/a_52a.pdf">http://www.atsc.org/standards/a_52a.pdf</A>
+
+		$ThisFileInfo['fileformat']            = 'ac3';
+		$ThisFileInfo['audio']['dataformat']   = 'ac3';
+		$ThisFileInfo['audio']['bitrate_mode'] = 'cbr';
+		$ThisFileInfo['audio']['lossless']     = false;
+
+		// An AC-3 serial coded audio bit stream is made up of a sequence of synchronization frames
+		// Each synchronization frame contains 6 coded audio blocks (AB), each of which represent 256
+		// new audio samples per channel. A synchronization information (SI) header at the beginning
+		// of each frame contains information needed to acquire and maintain synchronization. A
+		// bit stream information (BSI) header follows SI, and contains parameters describing the coded
+		// audio service. The coded audio blocks may be followed by an auxiliary data (Aux) field. At the
+		// end of each frame is an error check field that includes a CRC word for error detection. An
+		// additional CRC word is located in the SI header, the use of which, by a decoder, is optional.
+		//
+		// syncinfo() | bsi() | AB0 | AB1 | AB2 | AB3 | AB4 | AB5 | Aux | CRC
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$AC3header['syncinfo'] = fread($fd, 5);
+		$thisfile_ac3_raw['synchinfo']['synchword'] = substr($AC3header['syncinfo'], 0, 2);
+
+		if ($thisfile_ac3_raw['synchinfo']['synchword'] != &quot;\x0B\x77&quot;) {
+
+			$ThisFileInfo['error'][] = 'Expecting &quot;\x0B\x77&quot; at offset '.$ThisFileInfo['avdataoffset'].', found \x'.strtoupper(dechex($AC3header['syncinfo']{0})).'\x'.strtoupper(dechex($AC3header['syncinfo']{1})).' instead';
+			unset($thisfile_ac3);
+			return false;
+
+		} else {
+
+			// syncinfo() {
+			// 	 syncword    16
+			// 	 crc1        16
+			// 	 fscod        2
+			// 	 frmsizecod   6
+			// } /* end of syncinfo */
+
+			$thisfile_ac3_raw['synchinfo']['crc1']       = getid3_lib::LittleEndian2Int(substr($AC3header['syncinfo'], 2, 2));
+			$ac3_synchinfo_fscod_frmsizecod                        = getid3_lib::LittleEndian2Int(substr($AC3header['syncinfo'], 4, 1));
+			$thisfile_ac3_raw['synchinfo']['fscod']      = ($ac3_synchinfo_fscod_frmsizecod &amp; 0xC0) &gt;&gt; 6;
+			$thisfile_ac3_raw['synchinfo']['frmsizecod'] = ($ac3_synchinfo_fscod_frmsizecod &amp; 0x3F);
+
+			$thisfile_ac3['sample_rate'] = $this-&gt;AC3sampleRateCodeLookup($thisfile_ac3_raw['synchinfo']['fscod']);
+			if ($thisfile_ac3_raw['synchinfo']['fscod'] &lt;= 3) {
+				$ThisFileInfo['audio']['sample_rate'] = $thisfile_ac3['sample_rate'];
+			}
+
+			$thisfile_ac3['frame_length'] = $this-&gt;AC3frameSizeLookup($thisfile_ac3_raw['synchinfo']['frmsizecod'], $thisfile_ac3_raw['synchinfo']['fscod']);
+			$thisfile_ac3['bitrate']      = $this-&gt;AC3bitrateLookup($thisfile_ac3_raw['synchinfo']['frmsizecod']);
+			$ThisFileInfo['audio']['bitrate'] = $thisfile_ac3['bitrate'];
+
+			$AC3header['bsi'] = getid3_lib::BigEndian2Bin(fread($fd, 15));
+			$ac3_bsi_offset = 0;
+
+			$thisfile_ac3_raw_bsi['bsid'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 5));
+			$ac3_bsi_offset += 5;
+			if ($thisfile_ac3_raw_bsi['bsid'] &gt; 8) {
+				// Decoders which can decode version 8 will thus be able to decode version numbers less than 8.
+				// If this standard is extended by the addition of additional elements or features, a value of bsid greater than 8 will be used.
+				// Decoders built to this version of the standard will not be able to decode versions with bsid greater than 8.
+				$ThisFileInfo['error'][] = 'Bit stream identification is version '.$thisfile_ac3_raw_bsi['bsid'].', but getID3() only understands up to version 8';
+				unset($thisfile_ac3);
+				return false;
+			}
+
+			$thisfile_ac3_raw_bsi['bsmod'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 3));
+			$ac3_bsi_offset += 3;
+			$thisfile_ac3_raw_bsi['acmod'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 3));
+			$ac3_bsi_offset += 3;
+
+			$thisfile_ac3['service_type'] = $this-&gt;AC3serviceTypeLookup($thisfile_ac3_raw_bsi['bsmod'], $thisfile_ac3_raw_bsi['acmod']);
+			$ac3_coding_mode = $this-&gt;AC3audioCodingModeLookup($thisfile_ac3_raw_bsi['acmod']);
+			foreach($ac3_coding_mode as $key =&gt; $value) {
+				$thisfile_ac3[$key] = $value;
+			}
+			switch ($thisfile_ac3_raw_bsi['acmod']) {
+				case 0:
+				case 1:
+					$ThisFileInfo['audio']['channelmode'] = 'mono';
+					break;
+				case 3:
+				case 4:
+					$ThisFileInfo['audio']['channelmode'] = 'stereo';
+					break;
+				default:
+					$ThisFileInfo['audio']['channelmode'] = 'surround';
+					break;
+			}
+			$ThisFileInfo['audio']['channels'] = $thisfile_ac3['num_channels'];
+
+			if ($thisfile_ac3_raw_bsi['acmod'] &amp; 0x01) {
+				// If the lsb of acmod is a 1, center channel is in use and cmixlev follows in the bit stream.
+				$thisfile_ac3_raw_bsi['cmixlev'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 2));
+				$ac3_bsi_offset += 2;
+				$thisfile_ac3['center_mix_level'] = $this-&gt;AC3centerMixLevelLookup($thisfile_ac3_raw_bsi['cmixlev']);
+			}
+
+			if ($thisfile_ac3_raw_bsi['acmod'] &amp; 0x04) {
+				// If the msb of acmod is a 1, surround channels are in use and surmixlev follows in the bit stream.
+				$thisfile_ac3_raw_bsi['surmixlev'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 2));
+				$ac3_bsi_offset += 2;
+				$thisfile_ac3['surround_mix_level'] = $this-&gt;AC3surroundMixLevelLookup($thisfile_ac3_raw_bsi['surmixlev']);
+			}
+
+			if ($thisfile_ac3_raw_bsi['acmod'] == 0x02) {
+				// When operating in the two channel mode, this 2-bit code indicates whether or not the program has been encoded in Dolby Surround.
+				$thisfile_ac3_raw_bsi['dsurmod'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 2));
+				$ac3_bsi_offset += 2;
+				$thisfile_ac3['dolby_surround_mode'] = $this-&gt;AC3dolbySurroundModeLookup($thisfile_ac3_raw_bsi['dsurmod']);
+			}
+
+			$thisfile_ac3_raw_bsi['lfeon'] = (bool) bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 1));
+			$ac3_bsi_offset += 1;
+			$thisfile_ac3['lfe_enabled'] = $thisfile_ac3_raw_bsi['lfeon'];
+			if ($thisfile_ac3_raw_bsi['lfeon']) {
+				//$ThisFileInfo['audio']['channels']++;
+				$ThisFileInfo['audio']['channels'] .= '.1';
+			}
+
+			$thisfile_ac3['channels_enabled'] = $this-&gt;AC3channelsEnabledLookup($thisfile_ac3_raw_bsi['acmod'], $thisfile_ac3_raw_bsi['lfeon']);
+
+			// This indicates how far the average dialogue level is below digital 100 percent. Valid values are 1&#150;31.
+			// The value of 0 is reserved. The values of 1 to 31 are interpreted as -1 dB to -31 dB with respect to digital 100 percent.
+			$thisfile_ac3_raw_bsi['dialnorm'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 5));
+			$ac3_bsi_offset += 5;
+			$thisfile_ac3['dialogue_normalization'] = '-'.$thisfile_ac3_raw_bsi['dialnorm'].'dB';
+
+			$thisfile_ac3_raw_bsi['compre_flag'] = (bool) bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 1));
+			$ac3_bsi_offset += 1;
+			if ($thisfile_ac3_raw_bsi['compre_flag']) {
+				$thisfile_ac3_raw_bsi['compr'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 8));
+				$ac3_bsi_offset += 8;
+				$thisfile_ac3['heavy_compression'] = $this-&gt;AC3heavyCompression($thisfile_ac3_raw_bsi['compr']);
+			}
+
+			$thisfile_ac3_raw_bsi['langcode_flag'] = (bool) bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 1));
+			$ac3_bsi_offset += 1;
+			if ($thisfile_ac3_raw_bsi['langcode_flag']) {
+				$thisfile_ac3_raw_bsi['langcod'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 8));
+				$ac3_bsi_offset += 8;
+			}
+
+			$thisfile_ac3_raw_bsi['audprodie'] = (bool) bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 1));
+			$ac3_bsi_offset += 1;
+			if ($thisfile_ac3_raw_bsi['audprodie']) {
+				$thisfile_ac3_raw_bsi['mixlevel'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 5));
+				$ac3_bsi_offset += 5;
+				$thisfile_ac3_raw_bsi['roomtyp']  = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 2));
+				$ac3_bsi_offset += 2;
+
+				$thisfile_ac3['mixing_level'] = (80 + $thisfile_ac3_raw_bsi['mixlevel']).'dB';
+				$thisfile_ac3['room_type']    = $this-&gt;AC3roomTypeLookup($thisfile_ac3_raw_bsi['roomtyp']);
+			}
+
+			if ($thisfile_ac3_raw_bsi['acmod'] == 0x00) {
+				// If acmod is 0, then two completely independent program channels (dual mono)
+				// are encoded into the bit stream, and are referenced as Ch1, Ch2. In this case,
+				// a number of additional items are present in BSI or audblk to fully describe Ch2.
+
+
+				// This indicates how far the average dialogue level is below digital 100 percent. Valid values are 1&#150;31.
+				// The value of 0 is reserved. The values of 1 to 31 are interpreted as -1 dB to -31 dB with respect to digital 100 percent.
+				$thisfile_ac3_raw_bsi['dialnorm2'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 5));
+				$ac3_bsi_offset += 5;
+				$thisfile_ac3['dialogue_normalization2'] = '-'.$thisfile_ac3_raw_bsi['dialnorm2'].'dB';
+
+				$thisfile_ac3_raw_bsi['compre_flag2'] = (bool) bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 1));
+				$ac3_bsi_offset += 1;
+				if ($thisfile_ac3_raw_bsi['compre_flag2']) {
+					$thisfile_ac3_raw_bsi['compr2'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 8));
+					$ac3_bsi_offset += 8;
+					$thisfile_ac3['heavy_compression2'] = $this-&gt;AC3heavyCompression($thisfile_ac3_raw_bsi['compr2']);
+				}
+
+				$thisfile_ac3_raw_bsi['langcode_flag2'] = (bool) bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 1));
+				$ac3_bsi_offset += 1;
+				if ($thisfile_ac3_raw_bsi['langcode_flag2']) {
+					$thisfile_ac3_raw_bsi['langcod2'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 8));
+					$ac3_bsi_offset += 8;
+				}
+
+				$thisfile_ac3_raw_bsi['audprodie2'] = (bool) bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 1));
+				$ac3_bsi_offset += 1;
+				if ($thisfile_ac3_raw_bsi['audprodie2']) {
+					$thisfile_ac3_raw_bsi['mixlevel2'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 5));
+					$ac3_bsi_offset += 5;
+					$thisfile_ac3_raw_bsi['roomtyp2']  = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 2));
+					$ac3_bsi_offset += 2;
+
+					$thisfile_ac3['mixing_level2'] = (80 + $thisfile_ac3_raw_bsi['mixlevel2']).'dB';
+					$thisfile_ac3['room_type2']    = $this-&gt;AC3roomTypeLookup($thisfile_ac3_raw_bsi['roomtyp2']);
+				}
+
+			}
+
+			$thisfile_ac3_raw_bsi['copyright'] = (bool) bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 1));
+			$ac3_bsi_offset += 1;
+
+			$thisfile_ac3_raw_bsi['original']  = (bool) bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 1));
+			$ac3_bsi_offset += 1;
+
+			$thisfile_ac3_raw_bsi['timecode1_flag'] = (bool) bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 1));
+			$ac3_bsi_offset += 1;
+			if ($thisfile_ac3_raw_bsi['timecode1_flag']) {
+				$thisfile_ac3_raw_bsi['timecode1'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 14));
+				$ac3_bsi_offset += 14;
+			}
+
+			$thisfile_ac3_raw_bsi['timecode2_flag'] = (bool) bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 1));
+			$ac3_bsi_offset += 1;
+			if ($thisfile_ac3_raw_bsi['timecode2_flag']) {
+				$thisfile_ac3_raw_bsi['timecode2'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 14));
+				$ac3_bsi_offset += 14;
+			}
+
+			$thisfile_ac3_raw_bsi['addbsi_flag'] = (bool) bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 1));
+			$ac3_bsi_offset += 1;
+			if ($thisfile_ac3_raw_bsi['addbsi_flag']) {
+				$thisfile_ac3_raw_bsi['addbsi_length'] = bindec(substr($AC3header['bsi'], $ac3_bsi_offset, 6));
+				$ac3_bsi_offset += 6;
+
+				$AC3header['bsi'] .= getid3_lib::BigEndian2Bin(fread($fd, $thisfile_ac3_raw_bsi['addbsi_length']));
+
+				$thisfile_ac3_raw_bsi['addbsi_data'] = substr($AC3header['bsi'], $ac3_bsi_offset, $thisfile_ac3_raw_bsi['addbsi_length'] * 8);
+				$ac3_bsi_offset += $thisfile_ac3_raw_bsi['addbsi_length'] * 8;
+			}
+
+		}
+
+		return true;
+	}
+
+
+	function AC3sampleRateCodeLookup($fscod) {
+		static $AC3sampleRateCodeLookup = array(
+			0 =&gt; 48000,
+			1 =&gt; 44100,
+			2 =&gt; 32000,
+			3 =&gt; 'reserved' // If the reserved code is indicated, the decoder should not attempt to decode audio and should mute.
+		);
+		return (isset($AC3sampleRateCodeLookup[$fscod]) ? $AC3sampleRateCodeLookup[$fscod] : false);
+	}
+
+	function AC3serviceTypeLookup($bsmod, $acmod) {
+		static $AC3serviceTypeLookup = array();
+		if (empty($AC3serviceTypeLookup)) {
+			for ($i = 0; $i &lt;= 7; $i++) {
+				$AC3serviceTypeLookup[0][$i] = 'main audio service: complete main (CM)';
+				$AC3serviceTypeLookup[1][$i] = 'main audio service: music and effects (ME)';
+				$AC3serviceTypeLookup[2][$i] = 'associated service: visually impaired (VI)';
+				$AC3serviceTypeLookup[3][$i] = 'associated service: hearing impaired (HI)';
+				$AC3serviceTypeLookup[4][$i] = 'associated service: dialogue (D)';
+				$AC3serviceTypeLookup[5][$i] = 'associated service: commentary (C)';
+				$AC3serviceTypeLookup[6][$i] = 'associated service: emergency (E)';
+			}
+
+			$AC3serviceTypeLookup[7][1]      = 'associated service: voice over (VO)';
+			for ($i = 2; $i &lt;= 7; $i++) {
+				$AC3serviceTypeLookup[7][$i] = 'main audio service: karaoke';
+			}
+		}
+		return (isset($AC3serviceTypeLookup[$bsmod][$acmod]) ? $AC3serviceTypeLookup[$bsmod][$acmod] : false);
+	}
+
+	function AC3audioCodingModeLookup($acmod) {
+		static $AC3audioCodingModeLookup = array();
+		if (empty($AC3audioCodingModeLookup)) {
+			// array(channel configuration, # channels (not incl LFE), channel order)
+			$AC3audioCodingModeLookup = array (
+				0 =&gt; array('channel_config'=&gt;'1+1', 'num_channels'=&gt;2, 'channel_order'=&gt;'Ch1,Ch2'),
+				1 =&gt; array('channel_config'=&gt;'1/0', 'num_channels'=&gt;1, 'channel_order'=&gt;'C'),
+				2 =&gt; array('channel_config'=&gt;'2/0', 'num_channels'=&gt;2, 'channel_order'=&gt;'L,R'),
+				3 =&gt; array('channel_config'=&gt;'3/0', 'num_channels'=&gt;3, 'channel_order'=&gt;'L,C,R'),
+				4 =&gt; array('channel_config'=&gt;'2/1', 'num_channels'=&gt;3, 'channel_order'=&gt;'L,R,S'),
+				5 =&gt; array('channel_config'=&gt;'3/1', 'num_channels'=&gt;4, 'channel_order'=&gt;'L,C,R,S'),
+				6 =&gt; array('channel_config'=&gt;'2/2', 'num_channels'=&gt;4, 'channel_order'=&gt;'L,R,SL,SR'),
+				7 =&gt; array('channel_config'=&gt;'3/2', 'num_channels'=&gt;5, 'channel_order'=&gt;'L,C,R,SL,SR')
+			);
+		}
+		return (isset($AC3audioCodingModeLookup[$acmod]) ? $AC3audioCodingModeLookup[$acmod] : false);
+	}
+
+	function AC3centerMixLevelLookup($cmixlev) {
+		static $AC3centerMixLevelLookup;
+		if (empty($AC3centerMixLevelLookup)) {
+			$AC3centerMixLevelLookup = array(
+				0 =&gt; pow(2, -3.0 / 6), // 0.707 (&#150;3.0 dB)
+				1 =&gt; pow(2, -4.5 / 6), // 0.595 (&#150;4.5 dB)
+				2 =&gt; pow(2, -6.0 / 6), // 0.500 (&#150;6.0 dB)
+				3 =&gt; 'reserved'
+			);
+		}
+		return (isset($AC3centerMixLevelLookup[$cmixlev]) ? $AC3centerMixLevelLookup[$cmixlev] : false);
+	}
+
+	function AC3surroundMixLevelLookup($surmixlev) {
+		static $AC3surroundMixLevelLookup;
+		if (empty($AC3surroundMixLevelLookup)) {
+			$AC3surroundMixLevelLookup = array(
+				0 =&gt; pow(2, -3.0 / 6),
+				1 =&gt; pow(2, -6.0 / 6),
+				2 =&gt; 0,
+				3 =&gt; 'reserved'
+			);
+		}
+		return (isset($AC3surroundMixLevelLookup[$surmixlev]) ? $AC3surroundMixLevelLookup[$surmixlev] : false);
+	}
+
+	function AC3dolbySurroundModeLookup($dsurmod) {
+		static $AC3dolbySurroundModeLookup = array(
+			0 =&gt; 'not indicated',
+			1 =&gt; 'Not Dolby Surround encoded',
+			2 =&gt; 'Dolby Surround encoded',
+			3 =&gt; 'reserved'
+		);
+		return (isset($AC3dolbySurroundModeLookup[$dsurmod]) ? $AC3dolbySurroundModeLookup[$dsurmod] : false);
+	}
+
+	function AC3channelsEnabledLookup($acmod, $lfeon) {
+		$AC3channelsEnabledLookup = array(
+			'ch1'=&gt;(bool) ($acmod == 0),
+			'ch2'=&gt;(bool) ($acmod == 0),
+			'left'=&gt;(bool) ($acmod &gt; 1),
+			'right'=&gt;(bool) ($acmod &gt; 1),
+			'center'=&gt;(bool) ($acmod &amp; 0x01),
+			'surround_mono'=&gt;false,
+			'surround_left'=&gt;false,
+			'surround_right'=&gt;false,
+			'lfe'=&gt;$lfeon);
+		switch ($acmod) {
+			case 4:
+			case 5:
+				$AC3channelsEnabledLookup['surround_mono']  = true;
+				break;
+			case 6:
+			case 7:
+				$AC3channelsEnabledLookup['surround_left']  = true;
+				$AC3channelsEnabledLookup['surround_right'] = true;
+				break;
+		}
+		return $AC3channelsEnabledLookup;
+	}
+
+	function AC3heavyCompression($compre) {
+		// The first four bits indicate gain changes in 6.02dB increments which can be
+		// implemented with an arithmetic shift operation. The following four bits
+		// indicate linear gain changes, and require a 5-bit multiply.
+		// We will represent the two 4-bit fields of compr as follows:
+		//   X0 X1 X2 X3 . Y4 Y5 Y6 Y7
+		// The meaning of the X values is most simply described by considering X to represent a 4-bit
+		// signed integer with values from &#150;8 to +7. The gain indicated by X is then (X + 1) * 6.02 dB. The
+		// following table shows this in detail.
+
+		// Meaning of 4 msb of compr
+		//  7    +48.16 dB
+		//  6    +42.14 dB
+		//  5    +36.12 dB
+		//  4    +30.10 dB
+		//  3    +24.08 dB
+		//  2    +18.06 dB
+		//  1    +12.04 dB
+		//  0     +6.02 dB
+		// -1         0 dB
+		// -2     &#150;6.02 dB
+		// -3    &#150;12.04 dB
+		// -4    &#150;18.06 dB
+		// -5    &#150;24.08 dB
+		// -6    &#150;30.10 dB
+		// -7    &#150;36.12 dB
+		// -8    &#150;42.14 dB
+
+		$fourbit = str_pad(decbin(($compre &amp; 0xF0) &gt;&gt; 4), 4, '0', STR_PAD_LEFT);
+		if ($fourbit{0} == '1') {
+			$log_gain = -8 + bindec(substr($fourbit, 1));
+		} else {
+			$log_gain = bindec(substr($fourbit, 1));
+		}
+		$log_gain = ($log_gain + 1) * getid3_lib::RGADamplitude2dB(2);
+
+		// The value of Y is a linear representation of a gain change of up to &#150;6 dB. Y is considered to
+		// be an unsigned fractional integer, with a leading value of 1, or: 0.1 Y4 Y5 Y6 Y7 (base 2). Y can
+		// represent values between 0.111112 (or 31/32) and 0.100002 (or 1/2). Thus, Y can represent gain
+		// changes from &#150;0.28 dB to &#150;6.02 dB.
+
+		$lin_gain = (16 + ($compre &amp; 0x0F)) / 32;
+
+		// The combination of X and Y values allows compr to indicate gain changes from
+		//  48.16 &#150; 0.28 = +47.89 dB, to
+		// &#150;42.14 &#150; 6.02 = &#150;48.16 dB.
+
+		return $log_gain - $lin_gain;
+	}
+
+	function AC3roomTypeLookup($roomtyp) {
+		static $AC3roomTypeLookup = array(
+			0 =&gt; 'not indicated',
+			1 =&gt; 'large room, X curve monitor',
+			2 =&gt; 'small room, flat monitor',
+			3 =&gt; 'reserved'
+		);
+		return (isset($AC3roomTypeLookup[$roomtyp]) ? $AC3roomTypeLookup[$roomtyp] : false);
+	}
+
+	function AC3frameSizeLookup($frmsizecod, $fscod) {
+		$padding     = (bool) ($frmsizecod % 2);
+		$framesizeid =   floor($frmsizecod / 2);
+
+		static $AC3frameSizeLookup = array();
+		if (empty($AC3frameSizeLookup)) {
+			$AC3frameSizeLookup = array (
+				0  =&gt; array(128, 138, 192),
+				1  =&gt; array(40, 160, 174, 240),
+				2  =&gt; array(48, 192, 208, 288),
+				3  =&gt; array(56, 224, 242, 336),
+				4  =&gt; array(64, 256, 278, 384),
+				5  =&gt; array(80, 320, 348, 480),
+				6  =&gt; array(96, 384, 416, 576),
+				7  =&gt; array(112, 448, 486, 672),
+				8  =&gt; array(128, 512, 556, 768),
+				9  =&gt; array(160, 640, 696, 960),
+				10 =&gt; array(192, 768, 834, 1152),
+				11 =&gt; array(224, 896, 974, 1344),
+				12 =&gt; array(256, 1024, 1114, 1536),
+				13 =&gt; array(320, 1280, 1392, 1920),
+				14 =&gt; array(384, 1536, 1670, 2304),
+				15 =&gt; array(448, 1792, 1950, 2688),
+				16 =&gt; array(512, 2048, 2228, 3072),
+				17 =&gt; array(576, 2304, 2506, 3456),
+				18 =&gt; array(640, 2560, 2786, 3840)
+			);
+		}
+		if (($fscod == 1) &amp;&amp; $padding) {
+			// frame lengths are padded by 1 word (16 bits) at 44100
+			$AC3frameSizeLookup[$frmsizecod] += 2;
+		}
+		return (isset($AC3frameSizeLookup[$framesizeid][$fscod]) ? $AC3frameSizeLookup[$framesizeid][$fscod] : false);
+	}
+
+	function AC3bitrateLookup($frmsizecod) {
+		$framesizeid =   floor($frmsizecod / 2);
+
+		static $AC3bitrateLookup = array(
+			0  =&gt; 32000,
+			1  =&gt; 40000,
+			2  =&gt; 48000,
+			3  =&gt; 56000,
+			4  =&gt; 64000,
+			5  =&gt; 80000,
+			6  =&gt; 96000,
+			7  =&gt; 112000,
+			8  =&gt; 128000,
+			9  =&gt; 160000,
+			10 =&gt; 192000,
+			11 =&gt; 224000,
+			12 =&gt; 256000,
+			13 =&gt; 320000,
+			14 =&gt; 384000,
+			15 =&gt; 448000,
+			16 =&gt; 512000,
+			17 =&gt; 576000,
+			18 =&gt; 640000
+		);
+		return (isset($AC3bitrateLookup[$framesizeid]) ? $AC3bitrateLookup[$framesizeid] : false);
+	}
+
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.ac3.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.au.php
===================================================================
--- trunk/inc/external/getid3/module.audio.au.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.au.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,163 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.au.php                                         //
+// module for analyzing AU files                               //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_au
+{
+
+	function getid3_au(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$AUheader  = fread($fd, 8);
+
+		if (substr($AUheader, 0, 4) != '.snd') {
+			$ThisFileInfo['error'][] = 'Expecting &quot;.snd&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.substr($AUheader, 0, 4).'&quot;';
+			return false;
+		}
+
+		// shortcut
+		$ThisFileInfo['au'] = array();
+		$thisfile_au        = &amp;$ThisFileInfo['au'];
+
+		$ThisFileInfo['fileformat']            = 'au';
+		$ThisFileInfo['audio']['dataformat']   = 'au';
+		$ThisFileInfo['audio']['bitrate_mode'] = 'cbr';
+		$thisfile_au['encoding']               = 'ISO-8859-1';
+
+		$thisfile_au['header_length']   = getid3_lib::BigEndian2Int(substr($AUheader,  4, 4));
+		$AUheader .= fread($fd, $thisfile_au['header_length'] - 8);
+		$ThisFileInfo['avdataoffset'] += $thisfile_au['header_length'];
+
+		$thisfile_au['data_size']             = getid3_lib::BigEndian2Int(substr($AUheader,  8, 4));
+		$thisfile_au['data_format_id']        = getid3_lib::BigEndian2Int(substr($AUheader, 12, 4));
+		$thisfile_au['sample_rate']           = getid3_lib::BigEndian2Int(substr($AUheader, 16, 4));
+		$thisfile_au['channels']              = getid3_lib::BigEndian2Int(substr($AUheader, 20, 4));
+		$thisfile_au['comments']['comment'][] =                      trim(substr($AUheader, 24));
+
+		$thisfile_au['data_format'] = $this-&gt;AUdataFormatNameLookup($thisfile_au['data_format_id']);
+		$thisfile_au['used_bits_per_sample'] = $this-&gt;AUdataFormatUsedBitsPerSampleLookup($thisfile_au['data_format_id']);
+		if ($thisfile_au['bits_per_sample'] = $this-&gt;AUdataFormatBitsPerSampleLookup($thisfile_au['data_format_id'])) {
+			$ThisFileInfo['audio']['bits_per_sample'] = $thisfile_au['bits_per_sample'];
+		} else {
+			unset($thisfile_au['bits_per_sample']);
+		}
+
+		$ThisFileInfo['audio']['sample_rate']  = $thisfile_au['sample_rate'];
+		$ThisFileInfo['audio']['channels']     = $thisfile_au['channels'];
+
+		if (($ThisFileInfo['avdataoffset'] + $thisfile_au['data_size']) &gt; $ThisFileInfo['avdataend']) {
+			$ThisFileInfo['warning'][] = 'Possible truncated file - expecting &quot;'.$thisfile_au['data_size'].'&quot; bytes of audio data, only found '.($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']).' bytes&quot;';
+		}
+
+		$ThisFileInfo['playtime_seconds'] = $thisfile_au['data_size'] / ($thisfile_au['sample_rate'] * $thisfile_au['channels'] * ($thisfile_au['used_bits_per_sample'] / 8));
+		$ThisFileInfo['audio']['bitrate'] = ($thisfile_au['data_size'] * 8) / $ThisFileInfo['playtime_seconds'];
+
+		return true;
+	}
+
+	function AUdataFormatNameLookup($id) {
+		static $AUdataFormatNameLookup = array(
+			0  =&gt; 'unspecified format',
+			1  =&gt; '8-bit mu-law',
+			2  =&gt; '8-bit linear',
+			3  =&gt; '16-bit linear',
+			4  =&gt; '24-bit linear',
+			5  =&gt; '32-bit linear',
+			6  =&gt; 'floating-point',
+			7  =&gt; 'double-precision float',
+			8  =&gt; 'fragmented sampled data',
+			9  =&gt; 'SUN_FORMAT_NESTED',
+			10 =&gt; 'DSP program',
+			11 =&gt; '8-bit fixed-point',
+			12 =&gt; '16-bit fixed-point',
+			13 =&gt; '24-bit fixed-point',
+			14 =&gt; '32-bit fixed-point',
+
+			16 =&gt; 'non-audio display data',
+			17 =&gt; 'SND_FORMAT_MULAW_SQUELCH',
+			18 =&gt; '16-bit linear with emphasis',
+			19 =&gt; '16-bit linear with compression',
+			20 =&gt; '16-bit linear with emphasis + compression',
+			21 =&gt; 'Music Kit DSP commands',
+			22 =&gt; 'SND_FORMAT_DSP_COMMANDS_SAMPLES',
+			23 =&gt; 'CCITT g.721 4-bit ADPCM',
+			24 =&gt; 'CCITT g.722 ADPCM',
+			25 =&gt; 'CCITT g.723 3-bit ADPCM',
+			26 =&gt; 'CCITT g.723 5-bit ADPCM',
+			27 =&gt; 'A-Law 8-bit'
+		);
+		return (isset($AUdataFormatNameLookup[$id]) ? $AUdataFormatNameLookup[$id] : false);
+	}
+
+	function AUdataFormatBitsPerSampleLookup($id) {
+		static $AUdataFormatBitsPerSampleLookup = array(
+			1  =&gt; 8,
+			2  =&gt; 8,
+			3  =&gt; 16,
+			4  =&gt; 24,
+			5  =&gt; 32,
+			6  =&gt; 32,
+			7  =&gt; 64,
+
+			11 =&gt; 8,
+			12 =&gt; 16,
+			13 =&gt; 24,
+			14 =&gt; 32,
+
+			18 =&gt; 16,
+			19 =&gt; 16,
+			20 =&gt; 16,
+
+			23 =&gt; 16,
+
+			25 =&gt; 16,
+			26 =&gt; 16,
+			27 =&gt; 8
+		);
+		return (isset($AUdataFormatBitsPerSampleLookup[$id]) ? $AUdataFormatBitsPerSampleLookup[$id] : false);
+	}
+
+	function AUdataFormatUsedBitsPerSampleLookup($id) {
+		static $AUdataFormatUsedBitsPerSampleLookup = array(
+			1  =&gt; 8,
+			2  =&gt; 8,
+			3  =&gt; 16,
+			4  =&gt; 24,
+			5  =&gt; 32,
+			6  =&gt; 32,
+			7  =&gt; 64,
+
+			11 =&gt; 8,
+			12 =&gt; 16,
+			13 =&gt; 24,
+			14 =&gt; 32,
+
+			18 =&gt; 16,
+			19 =&gt; 16,
+			20 =&gt; 16,
+
+			23 =&gt; 4,
+
+			25 =&gt; 3,
+			26 =&gt; 5,
+			27 =&gt; 8,
+		);
+		return (isset($AUdataFormatUsedBitsPerSampleLookup[$id]) ? $AUdataFormatUsedBitsPerSampleLookup[$id] : false);
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.au.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.avr.php
===================================================================
--- trunk/inc/external/getid3/module.audio.avr.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.avr.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,125 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.avr.php                                        //
+// module for analyzing AVR Audio files                        //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_avr
+{
+
+	function getid3_avr(&amp;$fd, &amp;$ThisFileInfo) {
+
+		// <A HREF="http://cui.unige.ch/OSG/info/AudioFormats/ap11.html">http://cui.unige.ch/OSG/info/AudioFormats/ap11.html</A>
+		// <A HREF="http://www.btinternet.com/~AnthonyJ/Atari/programming/avr_format.html">http://www.btinternet.com/~AnthonyJ/Atari/programming/avr_format.html</A>
+		// offset    type    length    name        comments
+		// ---------------------------------------------------------------------
+		// 0    char    4    ID        format ID == &quot;2BIT&quot;
+		// 4    char    8    name        sample name (unused space filled with 0)
+		// 12    short    1    mono/stereo    0=mono, -1 (0xFFFF)=stereo
+		//                     With stereo, samples are alternated,
+		//                     the first voice is the left :
+		//                     (LRLRLRLRLRLRLRLRLR...)
+		// 14    short    1    resolution    8, 12 or 16 (bits)
+		// 16    short    1    signed or not    0=unsigned, -1 (0xFFFF)=signed
+		// 18    short    1    loop or not    0=no loop, -1 (0xFFFF)=loop on
+		// 20    short    1    MIDI note    0xFFnn, where 0 &lt;= nn &lt;= 127
+		//                     0xFFFF means &quot;no MIDI note defined&quot;
+		// 22    byte    1    Replay speed    Frequence in the Replay software
+		//                     0=5.485 Khz, 1=8.084 Khz, 2=10.971 Khz,
+		//                     3=16.168 Khz, 4=21.942 Khz, 5=32.336 Khz
+		//                     6=43.885 Khz, 7=47.261 Khz
+		//                     -1 (0xFF)=no defined Frequence
+		// 23    byte    3    sample rate    in Hertz
+		// 26    long    1    size in bytes (2 * bytes in stereo)
+		// 30    long    1    loop begin    0 for no loop
+		// 34    long    1    loop size    equal to 'size' for no loop
+		// 38  short   2   Reserved, MIDI keyboard split */
+		// 40  short   2   Reserved, sample compression */
+		// 42  short   2   Reserved */
+		// 44  char   20;  Additional filename space, used if (name[7] != 0)
+		// 64    byte    64    user data
+		// 128    bytes    ?    sample data    (12 bits samples are coded on 16 bits:
+		//                     0000 xxxx xxxx xxxx)
+		// ---------------------------------------------------------------------
+
+		// Note that all values are in motorola (big-endian) format, and that long is
+		// assumed to be 4 bytes, and short 2 bytes.
+		// When reading the samples, you should handle both signed and unsigned data,
+		// and be prepared to convert 16-&gt;8 bit, or mono-&gt;stereo if needed. To convert
+		// 8-bit data between signed/unsigned just add 127 to the sample values.
+		// Simularly for 16-bit data you should add 32769
+
+		$ThisFileInfo['fileformat'] = 'avr';
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$AVRheader = fread($fd, 128);
+
+		$ThisFileInfo['avr']['raw']['magic']    =               substr($AVRheader,  0,  4);
+		if ($ThisFileInfo['avr']['raw']['magic'] != '2BIT') {
+			$ThisFileInfo['error'][] = 'Expecting &quot;2BIT&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.$ThisFileInfo['avr']['raw']['magic'].'&quot;';
+			unset($ThisFileInfo['fileformat']);
+			unset($ThisFileInfo['avr']);
+			return false;
+		}
+		$ThisFileInfo['avdataoffset'] += 128;
+
+		$ThisFileInfo['avr']['sample_name']        =         rtrim(substr($AVRheader,  4,  8));
+		$ThisFileInfo['avr']['raw']['mono']        = getid3_lib::BigEndian2Int(substr($AVRheader, 12,  2));
+		$ThisFileInfo['avr']['bits_per_sample']    = getid3_lib::BigEndian2Int(substr($AVRheader, 14,  2));
+		$ThisFileInfo['avr']['raw']['signed']      = getid3_lib::BigEndian2Int(substr($AVRheader, 16,  2));
+		$ThisFileInfo['avr']['raw']['loop']        = getid3_lib::BigEndian2Int(substr($AVRheader, 18,  2));
+		$ThisFileInfo['avr']['raw']['midi']        = getid3_lib::BigEndian2Int(substr($AVRheader, 20,  2));
+		$ThisFileInfo['avr']['raw']['replay_freq'] = getid3_lib::BigEndian2Int(substr($AVRheader, 22,  1));
+		$ThisFileInfo['avr']['sample_rate']        = getid3_lib::BigEndian2Int(substr($AVRheader, 23,  3));
+		$ThisFileInfo['avr']['sample_length']      = getid3_lib::BigEndian2Int(substr($AVRheader, 26,  4));
+		$ThisFileInfo['avr']['loop_start']         = getid3_lib::BigEndian2Int(substr($AVRheader, 30,  4));
+		$ThisFileInfo['avr']['loop_end']           = getid3_lib::BigEndian2Int(substr($AVRheader, 34,  4));
+		$ThisFileInfo['avr']['midi_split']         = getid3_lib::BigEndian2Int(substr($AVRheader, 38,  2));
+		$ThisFileInfo['avr']['sample_compression'] = getid3_lib::BigEndian2Int(substr($AVRheader, 40,  2));
+		$ThisFileInfo['avr']['reserved']           = getid3_lib::BigEndian2Int(substr($AVRheader, 42,  2));
+		$ThisFileInfo['avr']['sample_name_extra']  =         rtrim(substr($AVRheader, 44, 20));
+		$ThisFileInfo['avr']['comment']            =         rtrim(substr($AVRheader, 64, 64));
+
+		$ThisFileInfo['avr']['flags']['stereo'] = (($ThisFileInfo['avr']['raw']['mono']   == 0) ? false : true);
+		$ThisFileInfo['avr']['flags']['signed'] = (($ThisFileInfo['avr']['raw']['signed'] == 0) ? false : true);
+		$ThisFileInfo['avr']['flags']['loop']   = (($ThisFileInfo['avr']['raw']['loop']   == 0) ? false : true);
+
+		$ThisFileInfo['avr']['midi_notes'] = array();
+		if (($ThisFileInfo['avr']['raw']['midi'] &amp; 0xFF00) != 0xFF00) {
+			$ThisFileInfo['avr']['midi_notes'][] = ($ThisFileInfo['avr']['raw']['midi'] &amp; 0xFF00) &gt;&gt; 8;
+		}
+		if (($ThisFileInfo['avr']['raw']['midi'] &amp; 0x00FF) != 0x00FF) {
+			$ThisFileInfo['avr']['midi_notes'][] = ($ThisFileInfo['avr']['raw']['midi'] &amp; 0x00FF);
+		}
+
+		if (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) != ($ThisFileInfo['avr']['sample_length'] * (($ThisFileInfo['avr']['bits_per_sample'] == 8) ? 1 : 2))) {
+			$ThisFileInfo['warning'][] = 'Probable truncated file: expecting '.($ThisFileInfo['avr']['sample_length'] * (($ThisFileInfo['avr']['bits_per_sample'] == 8) ? 1 : 2)).' bytes of audio data, found '.($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']);
+		}
+
+		$ThisFileInfo['audio']['dataformat']      = 'avr';
+		$ThisFileInfo['audio']['lossless']        = true;
+		$ThisFileInfo['audio']['bitrate_mode']    = 'cbr';
+		$ThisFileInfo['audio']['bits_per_sample'] = $ThisFileInfo['avr']['bits_per_sample'];
+		$ThisFileInfo['audio']['sample_rate']     = $ThisFileInfo['avr']['sample_rate'];
+		$ThisFileInfo['audio']['channels']        = ($ThisFileInfo['avr']['flags']['stereo'] ? 2 : 1);
+		$ThisFileInfo['playtime_seconds']         = ($ThisFileInfo['avr']['sample_length'] / $ThisFileInfo['audio']['channels']) / $ThisFileInfo['avr']['sample_rate'];
+		$ThisFileInfo['audio']['bitrate']         = ($ThisFileInfo['avr']['sample_length'] * (($ThisFileInfo['avr']['bits_per_sample'] == 8) ? 8 : 16)) / $ThisFileInfo['playtime_seconds'];
+
+
+		return true;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.avr.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.bonk.php
===================================================================
--- trunk/inc/external/getid3/module.audio.bonk.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.bonk.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,213 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.la.php                                         //
+// module for analyzing BONK audio files                       //
+// dependencies: module.tag.id3v2.php (optional)               //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_bonk
+{
+	function getid3_bonk(&amp;$fd, &amp;$ThisFileInfo) {
+
+		// shortcut
+		$ThisFileInfo['bonk'] = array();
+		$thisfile_bonk        = &amp;$ThisFileInfo['bonk'];
+
+		$thisfile_bonk['dataoffset']      = $ThisFileInfo['avdataoffset'];
+		$thisfile_bonk['dataend']         = $ThisFileInfo['avdataend'];
+
+		// scan-from-end method, for v0.6 and higher
+		fseek($fd, $thisfile_bonk['dataend'] - 8, SEEK_SET);
+		$PossibleBonkTag = fread($fd, 8);
+		while ($this-&gt;BonkIsValidTagName(substr($PossibleBonkTag, 4, 4), true)) {
+			$BonkTagSize = getid3_lib::LittleEndian2Int(substr($PossibleBonkTag, 0, 4));
+			fseek($fd, 0 - $BonkTagSize, SEEK_CUR);
+			$BonkTagOffset = ftell($fd);
+			$TagHeaderTest = fread($fd, 5);
+			if (($TagHeaderTest{0} != &quot;\x00&quot;) || (substr($PossibleBonkTag, 4, 4) != strtolower(substr($PossibleBonkTag, 4, 4)))) {
+				$ThisFileInfo['error'][] = 'Expecting &quot;&#216;'.strtoupper(substr($PossibleBonkTag, 4, 4)).'&quot; at offset '.$BonkTagOffset.', found &quot;'.$TagHeaderTest.'&quot;';
+				return false;
+			}
+			$BonkTagName = substr($TagHeaderTest, 1, 4);
+
+			$thisfile_bonk[$BonkTagName]['size']   = $BonkTagSize;
+			$thisfile_bonk[$BonkTagName]['offset'] = $BonkTagOffset;
+			$this-&gt;HandleBonkTags($fd, $BonkTagName, $ThisFileInfo);
+			$NextTagEndOffset = $BonkTagOffset - 8;
+			if ($NextTagEndOffset &lt; $thisfile_bonk['dataoffset']) {
+				if (empty($ThisFileInfo['audio']['encoder'])) {
+					$ThisFileInfo['audio']['encoder'] = 'Extended BONK v0.9+';
+				}
+				return true;
+			}
+			fseek($fd, $NextTagEndOffset, SEEK_SET);
+			$PossibleBonkTag = fread($fd, 8);
+		}
+
+		// seek-from-beginning method for v0.4 and v0.5
+		if (empty($thisfile_bonk['BONK'])) {
+			fseek($fd, $thisfile_bonk['dataoffset'], SEEK_SET);
+			do {
+				$TagHeaderTest = fread($fd, 5);
+				switch ($TagHeaderTest) {
+					case &quot;\x00&quot;.'BONK':
+						if (empty($ThisFileInfo['audio']['encoder'])) {
+							$ThisFileInfo['audio']['encoder'] = 'BONK v0.4';
+						}
+						break;
+
+					case &quot;\x00&quot;.'INFO':
+						$ThisFileInfo['audio']['encoder'] = 'Extended BONK v0.5';
+						break;
+
+					default:
+						break 2;
+				}
+				$BonkTagName = substr($TagHeaderTest, 1, 4);
+				$thisfile_bonk[$BonkTagName]['size']   = $thisfile_bonk['dataend'] - $thisfile_bonk['dataoffset'];
+				$thisfile_bonk[$BonkTagName]['offset'] = $thisfile_bonk['dataoffset'];
+				$this-&gt;HandleBonkTags($fd, $BonkTagName, $ThisFileInfo);
+
+			} while (true);
+		}
+
+		// parse META block for v0.6 - v0.8
+		if (empty($thisfile_bonk['INFO']) &amp;&amp; isset($thisfile_bonk['META']['tags']['info'])) {
+			fseek($fd, $thisfile_bonk['META']['tags']['info'], SEEK_SET);
+			$TagHeaderTest = fread($fd, 5);
+			if ($TagHeaderTest == &quot;\x00&quot;.'INFO') {
+				$ThisFileInfo['audio']['encoder'] = 'Extended BONK v0.6 - v0.8';
+
+				$BonkTagName = substr($TagHeaderTest, 1, 4);
+				$thisfile_bonk[$BonkTagName]['size']   = $thisfile_bonk['dataend'] - $thisfile_bonk['dataoffset'];
+				$thisfile_bonk[$BonkTagName]['offset'] = $thisfile_bonk['dataoffset'];
+				$this-&gt;HandleBonkTags($fd, $BonkTagName, $ThisFileInfo);
+			}
+		}
+
+		if (empty($ThisFileInfo['audio']['encoder'])) {
+			$ThisFileInfo['audio']['encoder'] = 'Extended BONK v0.9+';
+		}
+		if (empty($thisfile_bonk['BONK'])) {
+			unset($ThisFileInfo['bonk']);
+		}
+		return true;
+
+	}
+
+	function HandleBonkTags(&amp;$fd, &amp;$BonkTagName, &amp;$ThisFileInfo) {
+
+		switch ($BonkTagName) {
+			case 'BONK':
+				// shortcut
+				$thisfile_bonk_BONK = &amp;$ThisFileInfo['bonk']['BONK'];
+
+				$BonkData = &quot;\x00&quot;.'BONK'.fread($fd, 17);
+				$thisfile_bonk_BONK['version']            =        getid3_lib::LittleEndian2Int(substr($BonkData,  5, 1));
+				$thisfile_bonk_BONK['number_samples']     =        getid3_lib::LittleEndian2Int(substr($BonkData,  6, 4));
+				$thisfile_bonk_BONK['sample_rate']        =        getid3_lib::LittleEndian2Int(substr($BonkData, 10, 4));
+
+				$thisfile_bonk_BONK['channels']           =        getid3_lib::LittleEndian2Int(substr($BonkData, 14, 1));
+				$thisfile_bonk_BONK['lossless']           = (bool) getid3_lib::LittleEndian2Int(substr($BonkData, 15, 1));
+				$thisfile_bonk_BONK['joint_stereo']       = (bool) getid3_lib::LittleEndian2Int(substr($BonkData, 16, 1));
+				$thisfile_bonk_BONK['number_taps']        =        getid3_lib::LittleEndian2Int(substr($BonkData, 17, 2));
+				$thisfile_bonk_BONK['downsampling_ratio'] =        getid3_lib::LittleEndian2Int(substr($BonkData, 19, 1));
+				$thisfile_bonk_BONK['samples_per_packet'] =        getid3_lib::LittleEndian2Int(substr($BonkData, 20, 2));
+
+				$ThisFileInfo['avdataoffset'] = $thisfile_bonk_BONK['offset'] + 5 + 17;
+				$ThisFileInfo['avdataend']    = $thisfile_bonk_BONK['offset'] + $thisfile_bonk_BONK['size'];
+
+				$ThisFileInfo['fileformat']               = 'bonk';
+				$ThisFileInfo['audio']['dataformat']      = 'bonk';
+				$ThisFileInfo['audio']['bitrate_mode']    = 'vbr'; // assumed
+				$ThisFileInfo['audio']['channels']        = $thisfile_bonk_BONK['channels'];
+				$ThisFileInfo['audio']['sample_rate']     = $thisfile_bonk_BONK['sample_rate'];
+				$ThisFileInfo['audio']['channelmode']     = ($thisfile_bonk_BONK['joint_stereo'] ? 'joint stereo' : 'stereo');
+				$ThisFileInfo['audio']['lossless']        = $thisfile_bonk_BONK['lossless'];
+				$ThisFileInfo['audio']['codec']           = 'bonk';
+
+				$ThisFileInfo['playtime_seconds'] = $thisfile_bonk_BONK['number_samples'] / ($thisfile_bonk_BONK['sample_rate'] * $thisfile_bonk_BONK['channels']);
+				if ($ThisFileInfo['playtime_seconds'] &gt; 0) {
+					$ThisFileInfo['audio']['bitrate'] = (($ThisFileInfo['bonk']['dataend'] - $ThisFileInfo['bonk']['dataoffset']) * 8) / $ThisFileInfo['playtime_seconds'];
+				}
+				break;
+
+			case 'INFO':
+				// shortcut
+				$thisfile_bonk_INFO = &amp;$ThisFileInfo['bonk']['INFO'];
+
+				$thisfile_bonk_INFO['version'] = getid3_lib::LittleEndian2Int(fread($fd, 1));
+				$thisfile_bonk_INFO['entries_count'] = 0;
+				$NextInfoDataPair = fread($fd, 5);
+				if (!$this-&gt;BonkIsValidTagName(substr($NextInfoDataPair, 1, 4))) {
+					while (!feof($fd)) {
+						//$CurrentSeekInfo['offset']  = getid3_lib::LittleEndian2Int(substr($NextInfoDataPair, 0, 4));
+						//$CurrentSeekInfo['nextbit'] = getid3_lib::LittleEndian2Int(substr($NextInfoDataPair, 4, 1));
+						//$thisfile_bonk_INFO[] = $CurrentSeekInfo;
+
+						$NextInfoDataPair = fread($fd, 5);
+						if ($this-&gt;BonkIsValidTagName(substr($NextInfoDataPair, 1, 4))) {
+							fseek($fd, -5, SEEK_CUR);
+							break;
+						}
+						$thisfile_bonk_INFO['entries_count']++;
+					}
+				}
+				break;
+
+			case 'META':
+				$BonkData = &quot;\x00&quot;.'META'.fread($fd, $ThisFileInfo['bonk']['META']['size'] - 5);
+				$ThisFileInfo['bonk']['META']['version'] = getid3_lib::LittleEndian2Int(substr($BonkData,  5, 1));
+
+				$MetaTagEntries = floor(((strlen($BonkData) - 8) - 6) / 8); // BonkData - xxxxmeta - &#216;META
+				$offset = 6;
+				for ($i = 0; $i &lt; $MetaTagEntries; $i++) {
+					$MetaEntryTagName   =                  substr($BonkData, $offset, 4);
+					$offset += 4;
+					$MetaEntryTagOffset = getid3_lib::LittleEndian2Int(substr($BonkData, $offset, 4));
+					$offset += 4;
+					$ThisFileInfo['bonk']['META']['tags'][$MetaEntryTagName] = $MetaEntryTagOffset;
+				}
+				break;
+
+			case ' ID3':
+				$ThisFileInfo['audio']['encoder'] = 'Extended BONK v0.9+';
+
+				// ID3v2 checking is optional
+				if (class_exists('getid3_id3v2')) {
+					$ThisFileInfo['bonk'][' ID3']['valid'] = new getid3_id3v2($fd, $ThisFileInfo, $ThisFileInfo['bonk'][' ID3']['offset'] + 2);
+				}
+				break;
+
+			default:
+				$ThisFileInfo['warning'][] = 'Unexpected Bonk tag &quot;'.$BonkTagName.'&quot; at offset '.$ThisFileInfo['bonk'][$BonkTagName]['offset'];
+				break;
+
+		}
+	}
+
+	function BonkIsValidTagName($PossibleBonkTag, $ignorecase=false) {
+		static $BonkIsValidTagName = array('BONK', 'INFO', ' ID3', 'META');
+		foreach ($BonkIsValidTagName as $validtagname) {
+			if ($validtagname == $PossibleBonkTag) {
+				return true;
+			} elseif ($ignorecase &amp;&amp; (strtolower($validtagname) == strtolower($PossibleBonkTag))) {
+				return true;
+			}
+		}
+		return false;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.bonk.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.flac.php
===================================================================
--- trunk/inc/external/getid3/module.audio.flac.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.flac.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,309 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.flac.php                                       //
+// module for analyzing FLAC and OggFLAC audio files           //
+// dependencies: module.audio.ogg.php                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio.ogg.php', __FILE__, true);
+
+class getid3_flac
+{
+
+	function getid3_flac(&amp;$fd, &amp;$ThisFileInfo) {
+		// <A HREF="http://flac.sourceforge.net/format.html">http://flac.sourceforge.net/format.html</A>
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$StreamMarker = fread($fd, 4);
+		if ($StreamMarker != 'fLaC') {
+			$ThisFileInfo['error'][] = 'Expecting &quot;fLaC&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.$StreamMarker.'&quot;';
+			return false;
+		}
+		$ThisFileInfo['fileformat']            = 'flac';
+		$ThisFileInfo['audio']['dataformat']   = 'flac';
+		$ThisFileInfo['audio']['bitrate_mode'] = 'vbr';
+		$ThisFileInfo['audio']['lossless']     = true;
+
+		return getid3_flac::FLACparseMETAdata($fd, $ThisFileInfo);
+	}
+
+
+	function FLACparseMETAdata(&amp;$fd, &amp;$ThisFileInfo) {
+
+		do {
+			$METAdataBlockOffset          = ftell($fd);
+			$METAdataBlockHeader          = fread($fd, 4);
+			$METAdataLastBlockFlag        = (bool) (getid3_lib::BigEndian2Int(substr($METAdataBlockHeader, 0, 1)) &amp; 0x80);
+			$METAdataBlockType            = getid3_lib::BigEndian2Int(substr($METAdataBlockHeader, 0, 1)) &amp; 0x7F;
+			$METAdataBlockLength          = getid3_lib::BigEndian2Int(substr($METAdataBlockHeader, 1, 3));
+			$METAdataBlockTypeText        = getid3_flac::FLACmetaBlockTypeLookup($METAdataBlockType);
+
+			if ($METAdataBlockLength &lt;= 0) {
+				$ThisFileInfo['error'][] = 'corrupt or invalid METADATA_BLOCK_HEADER.BLOCK_TYPE ('.$METAdataBlockType.') at offset '.$METAdataBlockOffset;
+				break;
+			}
+
+			$ThisFileInfo['flac'][$METAdataBlockTypeText]['raw'] = array();
+			$ThisFileInfo_flac_METAdataBlockTypeText_raw = &amp;$ThisFileInfo['flac'][$METAdataBlockTypeText]['raw'];
+
+			$ThisFileInfo_flac_METAdataBlockTypeText_raw['offset']          = $METAdataBlockOffset;
+			$ThisFileInfo_flac_METAdataBlockTypeText_raw['last_meta_block'] = $METAdataLastBlockFlag;
+			$ThisFileInfo_flac_METAdataBlockTypeText_raw['block_type']      = $METAdataBlockType;
+			$ThisFileInfo_flac_METAdataBlockTypeText_raw['block_type_text'] = $METAdataBlockTypeText;
+			$ThisFileInfo_flac_METAdataBlockTypeText_raw['block_length']    = $METAdataBlockLength;
+			$ThisFileInfo_flac_METAdataBlockTypeText_raw['block_data']      = fread($fd, $METAdataBlockLength);
+			$ThisFileInfo['avdataoffset'] = ftell($fd);
+
+			switch ($METAdataBlockTypeText) {
+
+				case 'STREAMINFO':
+					if (!getid3_flac::FLACparseSTREAMINFO($ThisFileInfo_flac_METAdataBlockTypeText_raw['block_data'], $ThisFileInfo)) {
+						return false;
+					}
+					break;
+
+				case 'PADDING':
+					// ignore
+					break;
+
+				case 'APPLICATION':
+					if (!getid3_flac::FLACparseAPPLICATION($ThisFileInfo_flac_METAdataBlockTypeText_raw['block_data'], $ThisFileInfo)) {
+						return false;
+					}
+					break;
+
+				case 'SEEKTABLE':
+					if (!getid3_flac::FLACparseSEEKTABLE($ThisFileInfo_flac_METAdataBlockTypeText_raw['block_data'], $ThisFileInfo)) {
+						return false;
+					}
+					break;
+
+				case 'VORBIS_COMMENT':
+					$OldOffset = ftell($fd);
+					fseek($fd, 0 - $METAdataBlockLength, SEEK_CUR);
+					getid3_ogg::ParseVorbisCommentsFilepointer($fd, $ThisFileInfo);
+					fseek($fd, $OldOffset, SEEK_SET);
+					break;
+
+				case 'CUESHEET':
+					if (!getid3_flac::FLACparseCUESHEET($ThisFileInfo_flac_METAdataBlockTypeText_raw['block_data'], $ThisFileInfo)) {
+						return false;
+					}
+					break;
+
+				default:
+					$ThisFileInfo['warning'][] = 'Unhandled METADATA_BLOCK_HEADER.BLOCK_TYPE ('.$METAdataBlockType.') at offset '.$METAdataBlockOffset;
+					break;
+			}
+
+		} while ($METAdataLastBlockFlag === false);
+
+
+		if (isset($ThisFileInfo['flac']['STREAMINFO'])) {
+			$ThisFileInfo['flac']['compressed_audio_bytes']   = $ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset'];
+			$ThisFileInfo['flac']['uncompressed_audio_bytes'] = $ThisFileInfo['flac']['STREAMINFO']['samples_stream'] * $ThisFileInfo['flac']['STREAMINFO']['channels'] * ($ThisFileInfo['flac']['STREAMINFO']['bits_per_sample'] / 8);
+			if ($ThisFileInfo['flac']['uncompressed_audio_bytes'] == 0) {
+				$ThisFileInfo['error'][] = 'Corrupt FLAC file: uncompressed_audio_bytes == zero';
+				return false;
+			}
+			$ThisFileInfo['flac']['compression_ratio']        = $ThisFileInfo['flac']['compressed_audio_bytes'] / $ThisFileInfo['flac']['uncompressed_audio_bytes'];
+		}
+
+		// set md5_data_source - built into flac 0.5+
+		if (isset($ThisFileInfo['flac']['STREAMINFO']['audio_signature'])) {
+
+			if ($ThisFileInfo['flac']['STREAMINFO']['audio_signature'] === str_repeat(&quot;\x00&quot;, 16)) {
+
+				$ThisFileInfo['warning'][] = 'FLAC STREAMINFO.audio_signature is null (known issue with libOggFLAC)';
+
+			} else {
+
+				$ThisFileInfo['md5_data_source'] = '';
+				$md5 = $ThisFileInfo['flac']['STREAMINFO']['audio_signature'];
+				for ($i = 0; $i &lt; strlen($md5); $i++) {
+					$ThisFileInfo['md5_data_source'] .= str_pad(dechex(ord($md5{$i})), 2, '00', STR_PAD_LEFT);
+				}
+				if (!preg_match('/^[0-9a-f]{32}$/', $ThisFileInfo['md5_data_source'])) {
+					unset($ThisFileInfo['md5_data_source']);
+				}
+
+			}
+
+		}
+
+		$ThisFileInfo['audio']['bits_per_sample'] = $ThisFileInfo['flac']['STREAMINFO']['bits_per_sample'];
+		if ($ThisFileInfo['audio']['bits_per_sample'] == 8) {
+			// special case
+			// must invert sign bit on all data bytes before MD5'ing to match FLAC's calculated value
+			// MD5sum calculates on unsigned bytes, but FLAC calculated MD5 on 8-bit audio data as signed
+			$ThisFileInfo['warning'][] = 'FLAC calculates MD5 data strangely on 8-bit audio, so the stored md5_data_source value will not match the decoded WAV file';
+		}
+		if (!empty($ThisFileInfo['ogg']['vendor'])) {
+			$ThisFileInfo['audio']['encoder'] = $ThisFileInfo['ogg']['vendor'];
+		}
+
+		return true;
+	}
+
+	function FLACmetaBlockTypeLookup($blocktype) {
+		static $FLACmetaBlockTypeLookup = array();
+		if (empty($FLACmetaBlockTypeLookup)) {
+			$FLACmetaBlockTypeLookup[0] = 'STREAMINFO';
+			$FLACmetaBlockTypeLookup[1] = 'PADDING';
+			$FLACmetaBlockTypeLookup[2] = 'APPLICATION';
+			$FLACmetaBlockTypeLookup[3] = 'SEEKTABLE';
+			$FLACmetaBlockTypeLookup[4] = 'VORBIS_COMMENT';
+			$FLACmetaBlockTypeLookup[5] = 'CUESHEET';
+		}
+		return (isset($FLACmetaBlockTypeLookup[$blocktype]) ? $FLACmetaBlockTypeLookup[$blocktype] : 'reserved');
+	}
+
+	function FLACapplicationIDLookup($applicationid) {
+		static $FLACapplicationIDLookup = array();
+		if (empty($FLACapplicationIDLookup)) {
+			// <A HREF="http://flac.sourceforge.net/id.html">http://flac.sourceforge.net/id.html</A>
+			$FLACapplicationIDLookup[0x46746F6C] = 'flac-tools';      // 'Ftol'
+			$FLACapplicationIDLookup[0x46746F6C] = 'Sound Font FLAC'; // 'SFFL'
+		}
+		return (isset($FLACapplicationIDLookup[$applicationid]) ? $FLACapplicationIDLookup[$applicationid] : 'reserved');
+	}
+
+	function FLACparseSTREAMINFO($METAdataBlockData, &amp;$ThisFileInfo) {
+		$offset = 0;
+		$ThisFileInfo['flac']['STREAMINFO']['min_block_size']  = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 2));
+		$offset += 2;
+		$ThisFileInfo['flac']['STREAMINFO']['max_block_size']  = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 2));
+		$offset += 2;
+		$ThisFileInfo['flac']['STREAMINFO']['min_frame_size']  = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 3));
+		$offset += 3;
+		$ThisFileInfo['flac']['STREAMINFO']['max_frame_size']  = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 3));
+		$offset += 3;
+
+		$SampleRateChannelsSampleBitsStreamSamples             = getid3_lib::BigEndian2Bin(substr($METAdataBlockData, $offset, 8));
+		$ThisFileInfo['flac']['STREAMINFO']['sample_rate']     = getid3_lib::Bin2Dec(substr($SampleRateChannelsSampleBitsStreamSamples,  0, 20));
+		$ThisFileInfo['flac']['STREAMINFO']['channels']        = getid3_lib::Bin2Dec(substr($SampleRateChannelsSampleBitsStreamSamples, 20,  3)) + 1;
+		$ThisFileInfo['flac']['STREAMINFO']['bits_per_sample'] = getid3_lib::Bin2Dec(substr($SampleRateChannelsSampleBitsStreamSamples, 23,  5)) + 1;
+		$ThisFileInfo['flac']['STREAMINFO']['samples_stream']  = getid3_lib::Bin2Dec(substr($SampleRateChannelsSampleBitsStreamSamples, 28, 36));
+		$offset += 8;
+
+		$ThisFileInfo['flac']['STREAMINFO']['audio_signature'] =               substr($METAdataBlockData, $offset, 16);
+		$offset += 16;
+
+		if (!empty($ThisFileInfo['flac']['STREAMINFO']['sample_rate'])) {
+
+			$ThisFileInfo['audio']['bitrate_mode']     = 'vbr';
+			$ThisFileInfo['audio']['sample_rate']      = $ThisFileInfo['flac']['STREAMINFO']['sample_rate'];
+			$ThisFileInfo['audio']['channels']         = $ThisFileInfo['flac']['STREAMINFO']['channels'];
+			$ThisFileInfo['audio']['bits_per_sample']  = $ThisFileInfo['flac']['STREAMINFO']['bits_per_sample'];
+			$ThisFileInfo['playtime_seconds']          = $ThisFileInfo['flac']['STREAMINFO']['samples_stream'] / $ThisFileInfo['flac']['STREAMINFO']['sample_rate'];
+			$ThisFileInfo['audio']['bitrate']          = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['playtime_seconds'];
+
+		} else {
+
+			$ThisFileInfo['error'][] = 'Corrupt METAdata block: STREAMINFO';
+			return false;
+
+		}
+		return true;
+	}
+
+
+	function FLACparseAPPLICATION($METAdataBlockData, &amp;$ThisFileInfo) {
+		$offset = 0;
+		$ApplicationID = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 4));
+		$offset += 4;
+		$ThisFileInfo['flac']['APPLICATION'][$ApplicationID]['name'] = getid3_flac::FLACapplicationIDLookup($ApplicationID);
+		$ThisFileInfo['flac']['APPLICATION'][$ApplicationID]['data'] = substr($METAdataBlockData, $offset);
+		$offset = $METAdataBlockLength;
+
+		return true;
+	}
+
+
+	function FLACparseSEEKTABLE($METAdataBlockData, &amp;$ThisFileInfo) {
+		$offset = 0;
+		$METAdataBlockLength = strlen($METAdataBlockData);
+		$placeholderpattern = str_repeat(&quot;\xFF&quot;, 8);
+		while ($offset &lt; $METAdataBlockLength) {
+			$SampleNumberString = substr($METAdataBlockData, $offset, 8);
+			$offset += 8;
+			if ($SampleNumberString == $placeholderpattern) {
+
+				// placeholder point
+				@$ThisFileInfo['flac']['SEEKTABLE']['placeholders']++;
+				$offset += 10;
+
+			} else {
+
+				$SampleNumber                                                = getid3_lib::BigEndian2Int($SampleNumberString);
+				$ThisFileInfo['flac']['SEEKTABLE'][$SampleNumber]['offset']  = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 8));
+				$offset += 8;
+				$ThisFileInfo['flac']['SEEKTABLE'][$SampleNumber]['samples'] = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 2));
+				$offset += 2;
+
+			}
+		}
+		return true;
+	}
+
+	function FLACparseCUESHEET($METAdataBlockData, &amp;$ThisFileInfo) {
+		$offset = 0;
+		$ThisFileInfo['flac']['CUESHEET']['media_catalog_number'] =          trim(substr($METAdataBlockData, $offset, 128), &quot;\0&quot;);
+		$offset += 128;
+		$ThisFileInfo['flac']['CUESHEET']['lead_in_samples']      = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 8));
+		$offset += 8;
+		$ThisFileInfo['flac']['CUESHEET']['flags']['is_cd']       = (bool) (getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 1)) &amp; 0x80);
+		$offset += 1;
+
+		$offset += 258; // reserved
+
+		$ThisFileInfo['flac']['CUESHEET']['number_tracks']        = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 1));
+		$offset += 1;
+
+		for ($track = 0; $track &lt; $ThisFileInfo['flac']['CUESHEET']['number_tracks']; $track++) {
+			$TrackSampleOffset = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 8));
+			$offset += 8;
+			$TrackNumber       = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 1));
+			$offset += 1;
+
+			$ThisFileInfo['flac']['CUESHEET']['tracks'][$TrackNumber]['sample_offset']         = $TrackSampleOffset;
+
+			$ThisFileInfo['flac']['CUESHEET']['tracks'][$TrackNumber]['isrc']                  =               substr($METAdataBlockData, $offset, 12);
+			$offset += 12;
+
+			$TrackFlagsRaw                                                                     = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 1));
+			$offset += 1;
+			$ThisFileInfo['flac']['CUESHEET']['tracks'][$TrackNumber]['flags']['is_audio']     = (bool) ($TrackFlagsRaw &amp; 0x80);
+			$ThisFileInfo['flac']['CUESHEET']['tracks'][$TrackNumber]['flags']['pre_emphasis'] = (bool) ($TrackFlagsRaw &amp; 0x40);
+
+			$offset += 13; // reserved
+
+			$ThisFileInfo['flac']['CUESHEET']['tracks'][$TrackNumber]['index_points']          = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 1));
+			$offset += 1;
+
+			for ($index = 0; $index &lt; $ThisFileInfo['flac']['CUESHEET']['tracks'][$TrackNumber]['index_points']; $index++) {
+				$IndexSampleOffset = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 8));
+				$offset += 8;
+				$IndexNumber       = getid3_lib::BigEndian2Int(substr($METAdataBlockData, $offset, 1));
+				$offset += 1;
+
+				$offset += 3; // reserved
+
+				$ThisFileInfo['flac']['CUESHEET']['tracks'][$TrackNumber]['indexes'][$IndexNumber] = $IndexSampleOffset;
+			}
+		}
+		return true;
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.flac.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.la.php
===================================================================
--- trunk/inc/external/getid3/module.audio.la.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.la.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,227 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.la.php                                         //
+// module for analyzing LA audio files                         //
+// dependencies: module.audio.riff.php                         //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio-video.riff.php', __FILE__, true);
+
+class getid3_la
+{
+
+	function getid3_la(&amp;$fd, &amp;$ThisFileInfo) {
+		$offset = 0;
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$rawdata = fread($fd, GETID3_FREAD_BUFFER_SIZE);
+
+		switch (substr($rawdata, $offset, 4)) {
+			case 'LA02':
+			case 'LA03':
+			case 'LA04':
+				$ThisFileInfo['fileformat']          = 'la';
+				$ThisFileInfo['audio']['dataformat'] = 'la';
+				$ThisFileInfo['audio']['lossless']   = true;
+
+				$ThisFileInfo['la']['version_major'] = (int) substr($rawdata, $offset + 2, 1);
+				$ThisFileInfo['la']['version_minor'] = (int) substr($rawdata, $offset + 3, 1);
+				$ThisFileInfo['la']['version']       = (float) $ThisFileInfo['la']['version_major'] + ($ThisFileInfo['la']['version_minor'] / 10);
+				$offset += 4;
+
+				$ThisFileInfo['la']['uncompressed_size'] = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 4));
+				$offset += 4;
+				if ($ThisFileInfo['la']['uncompressed_size'] == 0) {
+					$ThisFileInfo['error'][] = 'Corrupt LA file: uncompressed_size == zero';
+					return false;
+				}
+
+				$WAVEchunk = substr($rawdata, $offset, 4);
+				if ($WAVEchunk !== 'WAVE') {
+					$ThisFileInfo['error'][] = 'Expected &quot;WAVE&quot; ('.getid3_lib::PrintHexBytes('WAVE').') at offset '.$offset.', found &quot;'.$WAVEchunk.'&quot; ('.getid3_lib::PrintHexBytes($WAVEchunk).') instead.';
+					return false;
+				}
+				$offset += 4;
+
+				$ThisFileInfo['la']['fmt_size'] = 24;
+				if ($ThisFileInfo['la']['version'] &gt;= 0.3) {
+
+					$ThisFileInfo['la']['fmt_size']    = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 4));
+					$ThisFileInfo['la']['header_size'] = 49 + $ThisFileInfo['la']['fmt_size'] - 24;
+					$offset += 4;
+
+				} else {
+
+					// version 0.2 didn't support additional data blocks
+					$ThisFileInfo['la']['header_size'] = 41;
+
+				}
+
+				$fmt_chunk = substr($rawdata, $offset, 4);
+				if ($fmt_chunk !== 'fmt ') {
+					$ThisFileInfo['error'][] = 'Expected &quot;fmt &quot; ('.getid3_lib::PrintHexBytes('fmt ').') at offset '.$offset.', found &quot;'.$fmt_chunk.'&quot; ('.getid3_lib::PrintHexBytes($fmt_chunk).') instead.';
+					return false;
+				}
+				$offset += 4;
+				$fmt_size = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 4));
+				$offset += 4;
+
+				$ThisFileInfo['la']['raw']['format']  = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 2));
+				$offset += 2;
+
+				$ThisFileInfo['la']['channels']       = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 2));
+				$offset += 2;
+				if ($ThisFileInfo['la']['channels'] == 0) {
+					$ThisFileInfo['error'][] = 'Corrupt LA file: channels == zero';
+						return false;
+				}
+
+				$ThisFileInfo['la']['sample_rate'] = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 4));
+				$offset += 4;
+				if ($ThisFileInfo['la']['sample_rate'] == 0) {
+					$ThisFileInfo['error'][] = 'Corrupt LA file: sample_rate == zero';
+						return false;
+				}
+
+				$ThisFileInfo['la']['bytes_per_second']     = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 4));
+				$offset += 4;
+				$ThisFileInfo['la']['bytes_per_sample']     = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 2));
+				$offset += 2;
+				$ThisFileInfo['la']['bits_per_sample']      = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 2));
+				$offset += 2;
+
+				$ThisFileInfo['la']['samples']              = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 4));
+				$offset += 4;
+
+				$ThisFileInfo['la']['raw']['flags']         = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 1));
+				$offset += 1;
+				$ThisFileInfo['la']['flags']['seekable']             = (bool) ($ThisFileInfo['la']['raw']['flags'] &amp; 0x01);
+				if ($ThisFileInfo['la']['version'] &gt;= 0.4) {
+					$ThisFileInfo['la']['flags']['high_compression'] = (bool) ($ThisFileInfo['la']['raw']['flags'] &amp; 0x02);
+				}
+
+				$ThisFileInfo['la']['original_crc']         = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 4));
+				$offset += 4;
+
+				// mike&#216;bevin*de
+				// Basically, the blocksize/seekevery are 61440/19 in La0.4 and 73728/16
+				// in earlier versions. A seekpoint is added every blocksize * seekevery
+				// samples, so 4 * int(totalSamples / (blockSize * seekEvery)) should
+				// give the number of bytes used for the seekpoints. Of course, if seeking
+				// is disabled, there are no seekpoints stored.
+				if ($ThisFileInfo['la']['version'] &gt;= 0.4) {
+					$ThisFileInfo['la']['blocksize'] = 61440;
+					$ThisFileInfo['la']['seekevery'] = 19;
+				} else {
+					$ThisFileInfo['la']['blocksize'] = 73728;
+					$ThisFileInfo['la']['seekevery'] = 16;
+				}
+
+				$ThisFileInfo['la']['seekpoint_count'] = 0;
+				if ($ThisFileInfo['la']['flags']['seekable']) {
+					$ThisFileInfo['la']['seekpoint_count'] = floor($ThisFileInfo['la']['samples'] / ($ThisFileInfo['la']['blocksize'] * $ThisFileInfo['la']['seekevery']));
+
+					for ($i = 0; $i &lt; $ThisFileInfo['la']['seekpoint_count']; $i++) {
+						$ThisFileInfo['la']['seekpoints'][] = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 4));
+						$offset += 4;
+					}
+				}
+
+				if ($ThisFileInfo['la']['version'] &gt;= 0.3) {
+
+					// Following the main header information, the program outputs all of the
+					// seekpoints. Following these is what I called the 'footer start',
+					// i.e. the position immediately after the La audio data is finished.
+					$ThisFileInfo['la']['footerstart'] = getid3_lib::LittleEndian2Int(substr($rawdata, $offset, 4));
+					$offset += 4;
+
+					if ($ThisFileInfo['la']['footerstart'] &gt; $ThisFileInfo['filesize']) {
+						$ThisFileInfo['warning'][] = 'FooterStart value points to offset '.$ThisFileInfo['la']['footerstart'].' which is beyond end-of-file ('.$ThisFileInfo['filesize'].')';
+						$ThisFileInfo['la']['footerstart'] = $ThisFileInfo['filesize'];
+					}
+
+				} else {
+
+					// La v0.2 didn't have FooterStart value
+					$ThisFileInfo['la']['footerstart'] = $ThisFileInfo['avdataend'];
+
+				}
+
+				if ($ThisFileInfo['la']['footerstart'] &lt; $ThisFileInfo['avdataend']) {
+					if ($RIFFtempfilename = tempnam('*', 'id3')) {
+						if ($RIFF_fp = fopen($RIFFtempfilename, 'w+b')) {
+							$RIFFdata = 'WAVE';
+							if ($ThisFileInfo['la']['version'] == 0.2) {
+								$RIFFdata .= substr($rawdata, 12, 24);
+							} else {
+								$RIFFdata .= substr($rawdata, 16, 24);
+							}
+							if ($ThisFileInfo['la']['footerstart'] &lt; $ThisFileInfo['avdataend']) {
+								fseek($fd, $ThisFileInfo['la']['footerstart'], SEEK_SET);
+								$RIFFdata .= fread($fd, $ThisFileInfo['avdataend'] - $ThisFileInfo['la']['footerstart']);
+							}
+							$RIFFdata = 'RIFF'.getid3_lib::LittleEndian2String(strlen($RIFFdata), 4, false).$RIFFdata;
+							fwrite($RIFF_fp, $RIFFdata, strlen($RIFFdata));
+							$dummy = $ThisFileInfo;
+							$dummy['filesize']     = strlen($RIFFdata);
+							$dummy['avdataoffset'] = 0;
+							$dummy['avdataend']    = $dummy['filesize'];
+
+							$riff = new getid3_riff($RIFF_fp, $dummy);
+							if (empty($dummy['error'])) {
+								$ThisFileInfo['riff'] = $dummy['riff'];
+							} else {
+								$ThisFileInfo['warning'][] = 'Error parsing RIFF portion of La file: '.implode($dummy['error']);
+							}
+							unset($dummy);
+							fclose($RIFF_fp);
+						}
+						unlink($RIFFtempfilename);
+					}
+				}
+
+				// $ThisFileInfo['avdataoffset'] should be zero to begin with, but just in case it's not, include the addition anyway
+				$ThisFileInfo['avdataend']    = $ThisFileInfo['avdataoffset'] + $ThisFileInfo['la']['footerstart'];
+				$ThisFileInfo['avdataoffset'] = $ThisFileInfo['avdataoffset'] + $offset;
+
+				//$ThisFileInfo['la']['codec']                = RIFFwFormatTagLookup($ThisFileInfo['la']['raw']['format']);
+				$ThisFileInfo['la']['compression_ratio']    = (float) (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) / $ThisFileInfo['la']['uncompressed_size']);
+				$ThisFileInfo['playtime_seconds']           = (float) ($ThisFileInfo['la']['samples'] / $ThisFileInfo['la']['sample_rate']) / $ThisFileInfo['la']['channels'];
+				if ($ThisFileInfo['playtime_seconds'] == 0) {
+					$ThisFileInfo['error'][] = 'Corrupt LA file: playtime_seconds == zero';
+					return false;
+				}
+
+				$ThisFileInfo['audio']['bitrate']            = ($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8 / $ThisFileInfo['playtime_seconds'];
+				//$ThisFileInfo['audio']['codec']              = $ThisFileInfo['la']['codec'];
+				$ThisFileInfo['audio']['bits_per_sample']    = $ThisFileInfo['la']['bits_per_sample'];
+				break;
+
+			default:
+				if (substr($rawdata, $offset, 2) == 'LA') {
+					$ThisFileInfo['error'][] = 'This version of getID3() (v'.GETID3_VERSION.') doesn\'t support LA version '.substr($rawdata, $offset + 2, 1).'.'.substr($rawdata, $offset + 3, 1).' which this appears to be - check <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A> for updates.';
+				} else {
+					$ThisFileInfo['error'][] = 'Not a LA (Lossless-Audio) file';
+				}
+				return false;
+				break;
+		}
+
+		$ThisFileInfo['audio']['channels']    = $ThisFileInfo['la']['channels'];
+		$ThisFileInfo['audio']['sample_rate'] = (int) $ThisFileInfo['la']['sample_rate'];
+		$ThisFileInfo['audio']['encoder']     = 'LA v'.$ThisFileInfo['la']['version'];
+
+		return true;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.la.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.lpac.php
===================================================================
--- trunk/inc/external/getid3/module.audio.lpac.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.lpac.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,125 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.lpac.php                                       //
+// module for analyzing LPAC Audio files                       //
+// dependencies: module.audio-video.riff.php                   //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio-video.riff.php', __FILE__, true);
+
+class getid3_lpac
+{
+
+	function getid3_lpac(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$LPACheader = fread($fd, 14);
+		if (substr($LPACheader, 0, 4) != 'LPAC') {
+			$ThisFileInfo['error'][] = 'Expected &quot;LPAC&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.$StreamMarker.'&quot;';
+			return false;
+		}
+		$ThisFileInfo['avdataoffset'] += 14;
+
+		$ThisFileInfo['fileformat']            = 'lpac';
+		$ThisFileInfo['audio']['dataformat']   = 'lpac';
+		$ThisFileInfo['audio']['lossless']     = true;
+		$ThisFileInfo['audio']['bitrate_mode'] = 'vbr';
+
+		$ThisFileInfo['lpac']['file_version'] = getid3_lib::BigEndian2Int(substr($LPACheader,  4, 1));
+		$flags['audio_type']                  = getid3_lib::BigEndian2Int(substr($LPACheader,  5, 1));
+		$ThisFileInfo['lpac']['total_samples']= getid3_lib::BigEndian2Int(substr($LPACheader,  6, 4));
+		$flags['parameters']                  = getid3_lib::BigEndian2Int(substr($LPACheader, 10, 4));
+
+		$ThisFileInfo['lpac']['flags']['is_wave'] = (bool) ($flags['audio_type'] &amp; 0x40);
+		$ThisFileInfo['lpac']['flags']['stereo']  = (bool) ($flags['audio_type'] &amp; 0x04);
+		$ThisFileInfo['lpac']['flags']['24_bit']  = (bool) ($flags['audio_type'] &amp; 0x02);
+		$ThisFileInfo['lpac']['flags']['16_bit']  = (bool) ($flags['audio_type'] &amp; 0x01);
+
+		if ($ThisFileInfo['lpac']['flags']['24_bit'] &amp;&amp; $ThisFileInfo['lpac']['flags']['16_bit']) {
+			$ThisFileInfo['warning'][] = '24-bit and 16-bit flags cannot both be set';
+		}
+
+		$ThisFileInfo['lpac']['flags']['fast_compress']             =  (bool) ($flags['parameters'] &amp; 0x40000000);
+		$ThisFileInfo['lpac']['flags']['random_access']             =  (bool) ($flags['parameters'] &amp; 0x08000000);
+		$ThisFileInfo['lpac']['block_length']                       = pow(2, (($flags['parameters'] &amp; 0x07000000) &gt;&gt; 24)) * 256;
+		$ThisFileInfo['lpac']['flags']['adaptive_prediction_order'] =  (bool) ($flags['parameters'] &amp; 0x00800000);
+		$ThisFileInfo['lpac']['flags']['adaptive_quantization']     =  (bool) ($flags['parameters'] &amp; 0x00400000);
+		$ThisFileInfo['lpac']['flags']['joint_stereo']              =  (bool) ($flags['parameters'] &amp; 0x00040000);
+		$ThisFileInfo['lpac']['quantization']                       =         ($flags['parameters'] &amp; 0x00001F00) &gt;&gt; 8;
+		$ThisFileInfo['lpac']['max_prediction_order']               =         ($flags['parameters'] &amp; 0x0000003F);
+
+		if ($ThisFileInfo['lpac']['flags']['fast_compress'] &amp;&amp; ($ThisFileInfo['lpac']['max_prediction_order'] != 3)) {
+			$ThisFileInfo['warning'][] = 'max_prediction_order expected to be &quot;3&quot; if fast_compress is true, actual value is &quot;'.$ThisFileInfo['lpac']['max_prediction_order'].'&quot;';
+		}
+		switch ($ThisFileInfo['lpac']['file_version']) {
+			case 6:
+				if ($ThisFileInfo['lpac']['flags']['adaptive_quantization']) {
+					$ThisFileInfo['warning'][] = 'adaptive_quantization expected to be false in LPAC file stucture v6, actually true';
+				}
+				if ($ThisFileInfo['lpac']['quantization'] != 20) {
+					$ThisFileInfo['warning'][] = 'Quantization expected to be 20 in LPAC file stucture v6, actually '.$ThisFileInfo['lpac']['flags']['Q'];
+				}
+				break;
+
+			default:
+				//$ThisFileInfo['warning'][] = 'This version of getID3() only supports LPAC file format version 6, this file is version '.$ThisFileInfo['lpac']['file_version'].' - please report to <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>';
+				break;
+		}
+
+		$dummy = $ThisFileInfo;
+		$riff = new getid3_riff($fd, $dummy);
+		$ThisFileInfo['avdataoffset']                = $dummy['avdataoffset'];
+		$ThisFileInfo['riff']                        = $dummy['riff'];
+		$ThisFileInfo['error']                       = $dummy['error'];
+		$ThisFileInfo['warning']                     = $dummy['warning'];
+		$ThisFileInfo['lpac']['comments']['comment'] = $dummy['comments'];
+		$ThisFileInfo['audio']['sample_rate']        = $dummy['audio']['sample_rate'];
+
+		$ThisFileInfo['audio']['channels']    = ($ThisFileInfo['lpac']['flags']['stereo'] ? 2 : 1);
+
+		if ($ThisFileInfo['lpac']['flags']['24_bit']) {
+			$ThisFileInfo['audio']['bits_per_sample'] = $ThisFileInfo['riff']['audio'][0]['bits_per_sample'];
+		} elseif ($ThisFileInfo['lpac']['flags']['16_bit']) {
+			$ThisFileInfo['audio']['bits_per_sample'] = 16;
+		} else {
+			$ThisFileInfo['audio']['bits_per_sample'] = 8;
+		}
+
+		if ($ThisFileInfo['lpac']['flags']['fast_compress']) {
+			 // fast
+			$ThisFileInfo['audio']['encoder_options'] = '-1';
+		} else {
+			switch ($ThisFileInfo['lpac']['max_prediction_order']) {
+				case 20: // simple
+					$ThisFileInfo['audio']['encoder_options'] = '-2';
+					break;
+				case 30: // medium
+					$ThisFileInfo['audio']['encoder_options'] = '-3';
+					break;
+				case 40: // high
+					$ThisFileInfo['audio']['encoder_options'] = '-4';
+					break;
+				case 60: // extrahigh
+					$ThisFileInfo['audio']['encoder_options'] = '-5';
+					break;
+			}
+		}
+
+		$ThisFileInfo['playtime_seconds'] = $ThisFileInfo['lpac']['total_samples'] / $ThisFileInfo['audio']['sample_rate'];
+		$ThisFileInfo['audio']['bitrate'] = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['playtime_seconds'];
+
+		return true;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.lpac.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.midi.php
===================================================================
--- trunk/inc/external/getid3/module.audio.midi.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.midi.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,519 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.midi.php                                       //
+// module for Midi Audio files                                 //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_midi
+{
+
+	function getid3_midi(&amp;$fd, &amp;$ThisFileInfo, $scanwholefile=true) {
+
+		// shortcut
+		$ThisFileInfo['midi']['raw'] = array();
+		$thisfile_midi               = &amp;$ThisFileInfo['midi'];
+		$thisfile_midi_raw           = &amp;$thisfile_midi['raw'];
+
+		$ThisFileInfo['fileformat']          = 'midi';
+		$ThisFileInfo['audio']['dataformat'] = 'midi';
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$MIDIdata = fread($fd, GETID3_FREAD_BUFFER_SIZE);
+		$offset = 0;
+		$MIDIheaderID = substr($MIDIdata, $offset, 4); // 'MThd'
+		if ($MIDIheaderID != 'MThd') {
+			$ThisFileInfo['error'][] = 'Expecting &quot;MThd&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.$MIDIheaderID.'&quot;';
+			unset($ThisFileInfo['fileformat']);
+			return false;
+		}
+		$offset += 4;
+		$thisfile_midi_raw['headersize']    = getid3_lib::BigEndian2Int(substr($MIDIdata, $offset, 4));
+		$offset += 4;
+		$thisfile_midi_raw['fileformat']    = getid3_lib::BigEndian2Int(substr($MIDIdata, $offset, 2));
+		$offset += 2;
+		$thisfile_midi_raw['tracks']        = getid3_lib::BigEndian2Int(substr($MIDIdata, $offset, 2));
+		$offset += 2;
+		$thisfile_midi_raw['ticksperqnote'] = getid3_lib::BigEndian2Int(substr($MIDIdata, $offset, 2));
+		$offset += 2;
+
+		for ($i = 0; $i &lt; $thisfile_midi_raw['tracks']; $i++) {
+			if ((strlen($MIDIdata) - $offset) &lt; 8) {
+				$MIDIdata .= fread($fd, GETID3_FREAD_BUFFER_SIZE);
+			}
+			$trackID = substr($MIDIdata, $offset, 4);
+			$offset += 4;
+			if ($trackID == 'MTrk') {
+				$tracksize = getid3_lib::BigEndian2Int(substr($MIDIdata, $offset, 4));
+				$offset += 4;
+				// $thisfile_midi['tracks'][$i]['size'] = $tracksize;
+				$trackdataarray[$i] = substr($MIDIdata, $offset, $tracksize);
+				$offset += $tracksize;
+			} else {
+				$ThisFileInfo['error'][] = 'Expecting &quot;MTrk&quot; at '.$offset.', found '.$trackID.' instead';
+				return false;
+			}
+		}
+
+		if (!isset($trackdataarray) || !is_array($trackdataarray)) {
+			$ThisFileInfo['error'][] = 'Cannot find MIDI track information';
+			unset($thisfile_midi);
+			unset($ThisFileInfo['fileformat']);
+			return false;
+		}
+
+		if ($scanwholefile) { // this can take quite a long time, so have the option to bypass it if speed is very important
+			$thisfile_midi['totalticks']      = 0;
+			$ThisFileInfo['playtime_seconds'] = 0;
+			$CurrentMicroSecondsPerBeat       = 500000; // 120 beats per minute;  60,000,000 microseconds per minute -&gt; 500,000 microseconds per beat
+			$CurrentBeatsPerMinute            = 120;    // 120 beats per minute;  60,000,000 microseconds per minute -&gt; 500,000 microseconds per beat
+
+			foreach ($trackdataarray as $tracknumber =&gt; $trackdata) {
+
+				$eventsoffset               = 0;
+				$LastIssuedMIDIcommand      = 0;
+				$LastIssuedMIDIchannel      = 0;
+				$CumulativeDeltaTime        = 0;
+				$TicksAtCurrentBPM = 0;
+				while ($eventsoffset &lt; strlen($trackdata)) {
+					$eventid = 0;
+					if (isset($MIDIevents[$tracknumber]) &amp;&amp; is_array($MIDIevents[$tracknumber])) {
+						$eventid = count($MIDIevents[$tracknumber]);
+					}
+					$deltatime = 0;
+					for ($i = 0; $i &lt; 4; $i++) {
+						$deltatimebyte = ord(substr($trackdata, $eventsoffset++, 1));
+						$deltatime = ($deltatime &lt;&lt; 7) + ($deltatimebyte &amp; 0x7F);
+						if ($deltatimebyte &amp; 0x80) {
+							// another byte follows
+						} else {
+							break;
+						}
+					}
+					$CumulativeDeltaTime += $deltatime;
+					$TicksAtCurrentBPM   += $deltatime;
+					$MIDIevents[$tracknumber][$eventid]['deltatime'] = $deltatime;
+					$MIDI_event_channel                                  = ord(substr($trackdata, $eventsoffset++, 1));
+					if ($MIDI_event_channel &amp; 0x80) {
+						// OK, normal event - MIDI command has MSB set
+						$LastIssuedMIDIcommand = $MIDI_event_channel &gt;&gt; 4;
+						$LastIssuedMIDIchannel = $MIDI_event_channel &amp; 0x0F;
+					} else {
+						// running event - assume last command
+						$eventsoffset--;
+					}
+					$MIDIevents[$tracknumber][$eventid]['eventid']   = $LastIssuedMIDIcommand;
+					$MIDIevents[$tracknumber][$eventid]['channel']   = $LastIssuedMIDIchannel;
+					if ($MIDIevents[$tracknumber][$eventid]['eventid'] == 0x8) { // Note off (key is released)
+
+						$notenumber = ord(substr($trackdata, $eventsoffset++, 1));
+						$velocity   = ord(substr($trackdata, $eventsoffset++, 1));
+
+					} elseif ($MIDIevents[$tracknumber][$eventid]['eventid'] == 0x9) { // Note on (key is pressed)
+
+						$notenumber = ord(substr($trackdata, $eventsoffset++, 1));
+						$velocity   = ord(substr($trackdata, $eventsoffset++, 1));
+
+					} elseif ($MIDIevents[$tracknumber][$eventid]['eventid'] == 0xA) { // Key after-touch
+
+						$notenumber = ord(substr($trackdata, $eventsoffset++, 1));
+						$velocity   = ord(substr($trackdata, $eventsoffset++, 1));
+
+					} elseif ($MIDIevents[$tracknumber][$eventid]['eventid'] == 0xB) { // Control Change
+
+						$controllernum = ord(substr($trackdata, $eventsoffset++, 1));
+						$newvalue      = ord(substr($trackdata, $eventsoffset++, 1));
+
+					} elseif ($MIDIevents[$tracknumber][$eventid]['eventid'] == 0xC) { // Program (patch) change
+
+						$newprogramnum = ord(substr($trackdata, $eventsoffset++, 1));
+
+						$thisfile_midi_raw['track'][$tracknumber]['instrumentid'] = $newprogramnum;
+						if ($tracknumber == 10) {
+							$thisfile_midi_raw['track'][$tracknumber]['instrument'] = $this-&gt;GeneralMIDIpercussionLookup($newprogramnum);
+						} else {
+							$thisfile_midi_raw['track'][$tracknumber]['instrument'] = $this-&gt;GeneralMIDIinstrumentLookup($newprogramnum);
+						}
+
+					} elseif ($MIDIevents[$tracknumber][$eventid]['eventid'] == 0xD) { // Channel after-touch
+
+						$channelnumber = ord(substr($trackdata, $eventsoffset++, 1));
+
+					} elseif ($MIDIevents[$tracknumber][$eventid]['eventid'] == 0xE) { // Pitch wheel change (2000H is normal or no change)
+
+						$changeLSB = ord(substr($trackdata, $eventsoffset++, 1));
+						$changeMSB = ord(substr($trackdata, $eventsoffset++, 1));
+						$pitchwheelchange = (($changeMSB &amp; 0x7F) &lt;&lt; 7) &amp; ($changeLSB &amp; 0x7F);
+
+					} elseif (($MIDIevents[$tracknumber][$eventid]['eventid'] == 0xF) &amp;&amp; ($MIDIevents[$tracknumber][$eventid]['channel'] == 0xF)) {
+
+						$METAeventCommand = ord(substr($trackdata, $eventsoffset++, 1));
+						$METAeventLength  = ord(substr($trackdata, $eventsoffset++, 1));
+						$METAeventData    = substr($trackdata, $eventsoffset, $METAeventLength);
+						$eventsoffset += $METAeventLength;
+						switch ($METAeventCommand) {
+							case 0x00: // Set track sequence number
+								$track_sequence_number = getid3_lib::BigEndian2Int(substr($METAeventData, 0, $METAeventLength));
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['seqno'] = $track_sequence_number;
+								break;
+
+							case 0x01: // Text: generic
+								$text_generic = substr($METAeventData, 0, $METAeventLength);
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['text'] = $text_generic;
+								$thisfile_midi['comments']['comment'][] = $text_generic;
+								break;
+
+							case 0x02: // Text: copyright
+								$text_copyright = substr($METAeventData, 0, $METAeventLength);
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['copyright'] = $text_copyright;
+								$thisfile_midi['comments']['copyright'][] = $text_copyright;
+								break;
+
+							case 0x03: // Text: track name
+								$text_trackname = substr($METAeventData, 0, $METAeventLength);
+								$thisfile_midi_raw['track'][$tracknumber]['name'] = $text_trackname;
+								break;
+
+							case 0x04: // Text: track instrument name
+								$text_instrument = substr($METAeventData, 0, $METAeventLength);
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['instrument'] = $text_instrument;
+								break;
+
+							case 0x05: // Text: lyrics
+								$text_lyrics  = substr($METAeventData, 0, $METAeventLength);
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['lyrics'] = $text_lyrics;
+								if (!isset($thisfile_midi['lyrics'])) {
+									$thisfile_midi['lyrics'] = '';
+								}
+								$thisfile_midi['lyrics'] .= $text_lyrics.&quot;\n&quot;;
+								break;
+
+							case 0x06: // Text: marker
+								$text_marker = substr($METAeventData, 0, $METAeventLength);
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['marker'] = $text_marker;
+								break;
+
+							case 0x07: // Text: cue point
+								$text_cuepoint = substr($METAeventData, 0, $METAeventLength);
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['cuepoint'] = $text_cuepoint;
+								break;
+
+							case 0x2F: // End Of Track
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['EOT'] = $CumulativeDeltaTime;
+								break;
+
+							case 0x51: // Tempo: microseconds / quarter note
+								$CurrentMicroSecondsPerBeat = getid3_lib::BigEndian2Int(substr($METAeventData, 0, $METAeventLength));
+								if ($CurrentMicroSecondsPerBeat == 0) {
+									$ThisFileInfo['error'][] = 'Corrupt MIDI file: CurrentMicroSecondsPerBeat == zero';
+									return false;
+								}
+								$thisfile_midi_raw['events'][$tracknumber][$CumulativeDeltaTime]['us_qnote'] = $CurrentMicroSecondsPerBeat;
+								$CurrentBeatsPerMinute = (1000000 / $CurrentMicroSecondsPerBeat) * 60;
+								$MicroSecondsPerQuarterNoteAfter[$CumulativeDeltaTime] = $CurrentMicroSecondsPerBeat;
+								$TicksAtCurrentBPM = 0;
+								break;
+
+							case 0x58: // Time signature
+								$timesig_numerator   = getid3_lib::BigEndian2Int($METAeventData{0});
+								$timesig_denominator = pow(2, getid3_lib::BigEndian2Int($METAeventData{1})); // $02 -&gt; x/4, $03 -&gt; x/8, etc
+								$timesig_32inqnote   = getid3_lib::BigEndian2Int($METAeventData{2});         // number of 32nd notes to the quarter note
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['timesig_32inqnote']   = $timesig_32inqnote;
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['timesig_numerator']   = $timesig_numerator;
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['timesig_denominator'] = $timesig_denominator;
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['timesig_text']        = $timesig_numerator.'/'.$timesig_denominator;
+								$thisfile_midi['timesignature'][] = $timesig_numerator.'/'.$timesig_denominator;
+								break;
+
+							case 0x59: // Keysignature
+								$keysig_sharpsflats = getid3_lib::BigEndian2Int($METAeventData{0});
+								if ($keysig_sharpsflats &amp; 0x80) {
+									// (-7 -&gt; 7 flats, 0 -&gt;key of C, 7 -&gt; 7 sharps)
+									$keysig_sharpsflats -= 256;
+								}
+
+								$keysig_majorminor  = getid3_lib::BigEndian2Int($METAeventData{1}); // 0 -&gt; major, 1 -&gt; minor
+								$keysigs = array(-7=&gt;'Cb', -6=&gt;'Gb', -5=&gt;'Db', -4=&gt;'Ab', -3=&gt;'Eb', -2=&gt;'Bb', -1=&gt;'F', 0=&gt;'C', 1=&gt;'G', 2=&gt;'D', 3=&gt;'A', 4=&gt;'E', 5=&gt;'B', 6=&gt;'F#', 7=&gt;'C#');
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['keysig_sharps'] = (($keysig_sharpsflats &gt; 0) ? abs($keysig_sharpsflats) : 0);
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['keysig_flats']  = (($keysig_sharpsflats &lt; 0) ? abs($keysig_sharpsflats) : 0);
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['keysig_minor']  = (bool) $keysig_majorminor;
+								//$thisfile_midi_raw['events'][$tracknumber][$eventid]['keysig_text']   = $keysigs[$keysig_sharpsflats].' '.($thisfile_midi_raw['events'][$tracknumber][$eventid]['keysig_minor'] ? 'minor' : 'major');
+
+								// $keysigs[$keysig_sharpsflats] gets an int key (correct) - $keysigs[&quot;$keysig_sharpsflats&quot;] gets a string key (incorrect)
+								$thisfile_midi['keysignature'][] = $keysigs[$keysig_sharpsflats].' '.((bool) $keysig_majorminor ? 'minor' : 'major');
+								break;
+
+							case 0x7F: // Sequencer specific information
+								$custom_data = substr($METAeventData, 0, $METAeventLength);
+								break;
+
+							default:
+								$ThisFileInfo['warning'][] = 'Unhandled META Event Command: '.$METAeventCommand;
+								break;
+						}
+
+					} else {
+
+						$ThisFileInfo['warning'][] = 'Unhandled MIDI Event ID: '.$MIDIevents[$tracknumber][$eventid]['eventid'];
+
+					}
+				}
+				if (($tracknumber &gt; 0) || (count($trackdataarray) == 1)) {
+					$thisfile_midi['totalticks'] = max($thisfile_midi['totalticks'], $CumulativeDeltaTime);
+				}
+			}
+			$previoustickoffset = null;
+
+			foreach ($MicroSecondsPerQuarterNoteAfter as $tickoffset =&gt; $microsecondsperbeat) {
+				if (is_null($previoustickoffset)) {
+					$prevmicrosecondsperbeat = $microsecondsperbeat;
+					$previoustickoffset = $tickoffset;
+					continue;
+				}
+				if ($thisfile_midi['totalticks'] &gt; $tickoffset) {
+
+					if ($thisfile_midi_raw['ticksperqnote'] == 0) {
+						$ThisFileInfo['error'][] = 'Corrupt MIDI file: ticksperqnote == zero';
+						return false;
+					}
+
+					$ThisFileInfo['playtime_seconds'] += (($tickoffset - $previoustickoffset) / $thisfile_midi_raw['ticksperqnote']) * ($prevmicrosecondsperbeat / 1000000);
+
+					$prevmicrosecondsperbeat = $microsecondsperbeat;
+					$previoustickoffset = $tickoffset;
+				}
+			}
+			if ($thisfile_midi['totalticks'] &gt; $previoustickoffset) {
+
+				if ($thisfile_midi_raw['ticksperqnote'] == 0) {
+					$ThisFileInfo['error'][] = 'Corrupt MIDI file: ticksperqnote == zero';
+					return false;
+				}
+
+				$ThisFileInfo['playtime_seconds'] += (($thisfile_midi['totalticks'] - $previoustickoffset) / $thisfile_midi_raw['ticksperqnote']) * ($microsecondsperbeat / 1000000);
+
+			}
+		}
+
+		if ($ThisFileInfo['playtime_seconds'] &gt; 0) {
+			$ThisFileInfo['bitrate'] = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['playtime_seconds'];
+		}
+
+		if (!empty($thisfile_midi['lyrics'])) {
+			$thisfile_midi['comments']['lyrics'][] = $thisfile_midi['lyrics'];
+		}
+
+		return true;
+	}
+
+	function GeneralMIDIinstrumentLookup($instrumentid) {
+
+		$begin = __LINE__;
+
+		/** This is not a comment!
+
+			0	Acoustic Grand
+			1	Bright Acoustic
+			2	Electric Grand
+			3	Honky-Tonk
+			4	Electric Piano 1
+			5	Electric Piano 2
+			6	Harpsichord
+			7	Clavier
+			8	Celesta
+			9	Glockenspiel
+			10	Music Box
+			11	Vibraphone
+			12	Marimba
+			13	Xylophone
+			14	Tubular Bells
+			15	Dulcimer
+			16	Drawbar Organ
+			17	Percussive Organ
+			18	Rock Organ
+			19	Church Organ
+			20	Reed Organ
+			21	Accordian
+			22	Harmonica
+			23	Tango Accordian
+			24	Acoustic Guitar (nylon)
+			25	Acoustic Guitar (steel)
+			26	Electric Guitar (jazz)
+			27	Electric Guitar (clean)
+			28	Electric Guitar (muted)
+			29	Overdriven Guitar
+			30	Distortion Guitar
+			31	Guitar Harmonics
+			32	Acoustic Bass
+			33	Electric Bass (finger)
+			34	Electric Bass (pick)
+			35	Fretless Bass
+			36	Slap Bass 1
+			37	Slap Bass 2
+			38	Synth Bass 1
+			39	Synth Bass 2
+			40	Violin
+			41	Viola
+			42	Cello
+			43	Contrabass
+			44	Tremolo Strings
+			45	Pizzicato Strings
+			46	Orchestral Strings
+			47	Timpani
+			48	String Ensemble 1
+			49	String Ensemble 2
+			50	SynthStrings 1
+			51	SynthStrings 2
+			52	Choir Aahs
+			53	Voice Oohs
+			54	Synth Voice
+			55	Orchestra Hit
+			56	Trumpet
+			57	Trombone
+			58	Tuba
+			59	Muted Trumpet
+			60	French Horn
+			61	Brass Section
+			62	SynthBrass 1
+			63	SynthBrass 2
+			64	Soprano Sax
+			65	Alto Sax
+			66	Tenor Sax
+			67	Baritone Sax
+			68	Oboe
+			69	English Horn
+			70	Bassoon
+			71	Clarinet
+			72	Piccolo
+			73	Flute
+			74	Recorder
+			75	Pan Flute
+			76	Blown Bottle
+			77	Shakuhachi
+			78	Whistle
+			79	Ocarina
+			80	Lead 1 (square)
+			81	Lead 2 (sawtooth)
+			82	Lead 3 (calliope)
+			83	Lead 4 (chiff)
+			84	Lead 5 (charang)
+			85	Lead 6 (voice)
+			86	Lead 7 (fifths)
+			87	Lead 8 (bass + lead)
+			88	Pad 1 (new age)
+			89	Pad 2 (warm)
+			90	Pad 3 (polysynth)
+			91	Pad 4 (choir)
+			92	Pad 5 (bowed)
+			93	Pad 6 (metallic)
+			94	Pad 7 (halo)
+			95	Pad 8 (sweep)
+			96	FX 1 (rain)
+			97	FX 2 (soundtrack)
+			98	FX 3 (crystal)
+			99	FX 4 (atmosphere)
+			100	FX 5 (brightness)
+			101	FX 6 (goblins)
+			102	FX 7 (echoes)
+			103	FX 8 (sci-fi)
+			104	Sitar
+			105	Banjo
+			106	Shamisen
+			107	Koto
+			108	Kalimba
+			109	Bagpipe
+			110	Fiddle
+			111	Shanai
+			112	Tinkle Bell
+			113	Agogo
+			114	Steel Drums
+			115	Woodblock
+			116	Taiko Drum
+			117	Melodic Tom
+			118	Synth Drum
+			119	Reverse Cymbal
+			120	Guitar Fret Noise
+			121	Breath Noise
+			122	Seashore
+			123	Bird Tweet
+			124	Telephone Ring
+			125	Helicopter
+			126	Applause
+			127	Gunshot
+
+		*/
+
+		return getid3_lib::EmbeddedLookup($instrumentid, $begin, __LINE__, __FILE__, 'GeneralMIDIinstrument');
+	}
+
+	function GeneralMIDIpercussionLookup($instrumentid) {
+
+		$begin = __LINE__;
+
+		/** This is not a comment!
+
+			35	Acoustic Bass Drum
+			36	Bass Drum 1
+			37	Side Stick
+			38	Acoustic Snare
+			39	Hand Clap
+			40	Electric Snare
+			41	Low Floor Tom
+			42	Closed Hi-Hat
+			43	High Floor Tom
+			44	Pedal Hi-Hat
+			45	Low Tom
+			46	Open Hi-Hat
+			47	Low-Mid Tom
+			48	Hi-Mid Tom
+			49	Crash Cymbal 1
+			50	High Tom
+			51	Ride Cymbal 1
+			52	Chinese Cymbal
+			53	Ride Bell
+			54	Tambourine
+			55	Splash Cymbal
+			56	Cowbell
+			57	Crash Cymbal 2
+			59	Ride Cymbal 2
+			60	Hi Bongo
+			61	Low Bongo
+			62	Mute Hi Conga
+			63	Open Hi Conga
+			64	Low Conga
+			65	High Timbale
+			66	Low Timbale
+			67	High Agogo
+			68	Low Agogo
+			69	Cabasa
+			70	Maracas
+			71	Short Whistle
+			72	Long Whistle
+			73	Short Guiro
+			74	Long Guiro
+			75	Claves
+			76	Hi Wood Block
+			77	Low Wood Block
+			78	Mute Cuica
+			79	Open Cuica
+			80	Mute Triangle
+			81	Open Triangle
+
+		*/
+
+		return getid3_lib::EmbeddedLookup($instrumentid, $begin, __LINE__, __FILE__, 'GeneralMIDIpercussion');
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.midi.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.mod.php
===================================================================
--- trunk/inc/external/getid3/module.audio.mod.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.mod.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,101 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.mod.php                                        //
+// module for analyzing MOD Audio files                        //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_mod
+{
+
+	// new combined constructor
+	function getid3_mod(&amp;$fd, &amp;$ThisFileInfo, $option) {
+
+		if ($option === 'mod') {
+			$this-&gt;getMODheaderFilepointer($fd, $ThisFileInfo);
+		}
+		elseif ($option === 'xm') {
+			$this-&gt;getXMheaderFilepointer($fd, $ThisFileInfo);
+		}
+		elseif ($option === 'it') {
+			$this-&gt;getITheaderFilepointer($fd, $ThisFileInfo);
+		}
+		elseif ($option === 's3m') {
+			$this-&gt;getS3MheaderFilepointer($fd, $ThisFileInfo);
+		}
+	}
+
+
+	function getMODheaderFilepointer(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, $ThisFileInfo['avdataoffset'] + 1080);
+		$FormatID = fread($fd, 4);
+		if (!ereg('^(M.K.|[5-9]CHN|[1-3][0-9]CH)$', $FormatID)) {
+			$ThisFileInfo['error'][] = 'This is not a known type of MOD file';
+			return false;
+		}
+
+		$ThisFileInfo['fileformat'] = 'mod';
+
+		$ThisFileInfo['error'][] = 'MOD parsing not enabled in this version of getID3()';
+		return false;
+	}
+
+	function getXMheaderFilepointer(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, $ThisFileInfo['avdataoffset']);
+		$FormatID = fread($fd, 15);
+		if (!ereg('^Extended Module$', $FormatID)) {
+			$ThisFileInfo['error'][] = 'This is not a known type of XM-MOD file';
+			return false;
+		}
+
+		$ThisFileInfo['fileformat'] = 'xm';
+
+		$ThisFileInfo['error'][] = 'XM-MOD parsing not enabled in this version of getID3()';
+		return false;
+	}
+
+	function getS3MheaderFilepointer(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, $ThisFileInfo['avdataoffset'] + 44);
+		$FormatID = fread($fd, 4);
+		if (!ereg('^SCRM$', $FormatID)) {
+			$ThisFileInfo['error'][] = 'This is not a ScreamTracker MOD file';
+			return false;
+		}
+
+		$ThisFileInfo['fileformat'] = 's3m';
+
+		$ThisFileInfo['error'][] = 'ScreamTracker parsing not enabled in this version of getID3()';
+		return false;
+	}
+
+	function getITheaderFilepointer(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, $ThisFileInfo['avdataoffset']);
+		$FormatID = fread($fd, 4);
+		if (!ereg('^IMPM$', $FormatID)) {
+			$ThisFileInfo['error'][] = 'This is not an ImpulseTracker MOD file';
+			return false;
+		}
+
+		$ThisFileInfo['fileformat'] = 'it';
+
+		$ThisFileInfo['error'][] = 'ImpulseTracker parsing not enabled in this version of getID3()';
+		return false;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.mod.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.monkey.php
===================================================================
--- trunk/inc/external/getid3/module.audio.monkey.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.monkey.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,202 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.monkey.php                                     //
+// module for analyzing Monkey's Audio files                   //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_monkey
+{
+
+	function getid3_monkey(&amp;$fd, &amp;$ThisFileInfo) {
+		// based loosely on code from TMonkey by Jurgen Faul &lt;jfaul&#216;gmx*de&gt;
+		// <A HREF="http://jfaul.de/atl">http://jfaul.de/atl</A>  or  <A HREF="http://j-faul.virtualave.net/atl/atl.html">http://j-faul.virtualave.net/atl/atl.html</A>
+
+		$ThisFileInfo['fileformat']            = 'mac';
+		$ThisFileInfo['audio']['dataformat']   = 'mac';
+		$ThisFileInfo['audio']['bitrate_mode'] = 'vbr';
+		$ThisFileInfo['audio']['lossless']     = true;
+
+		$ThisFileInfo['monkeys_audio']['raw'] = array();
+		$thisfile_monkeysaudio                = &amp;$ThisFileInfo['monkeys_audio'];
+		$thisfile_monkeysaudio_raw            = &amp;$thisfile_monkeysaudio['raw'];
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$MACheaderData = fread($fd, 74);
+
+		$thisfile_monkeysaudio_raw['magic'] = substr($MACheaderData, 0, 4);
+		if ($thisfile_monkeysaudio_raw['magic'] != 'MAC ') {
+			$ThisFileInfo['error'][] = 'Expecting &quot;MAC&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.$thisfile_monkeysaudio_raw['magic'].'&quot;';
+			unset($ThisFileInfo['fileformat']);
+			return false;
+		}
+		$thisfile_monkeysaudio_raw['nVersion']             = getid3_lib::LittleEndian2Int(substr($MACheaderData, 4, 2)); // appears to be uint32 in 3.98+
+
+		if ($thisfile_monkeysaudio_raw['nVersion'] &lt; 3980) {
+			$thisfile_monkeysaudio_raw['nCompressionLevel']    = getid3_lib::LittleEndian2Int(substr($MACheaderData, 6, 2));
+			$thisfile_monkeysaudio_raw['nFormatFlags']         = getid3_lib::LittleEndian2Int(substr($MACheaderData, 8, 2));
+			$thisfile_monkeysaudio_raw['nChannels']            = getid3_lib::LittleEndian2Int(substr($MACheaderData, 10, 2));
+			$thisfile_monkeysaudio_raw['nSampleRate']          = getid3_lib::LittleEndian2Int(substr($MACheaderData, 12, 4));
+			$thisfile_monkeysaudio_raw['nHeaderDataBytes']     = getid3_lib::LittleEndian2Int(substr($MACheaderData, 16, 4));
+			$thisfile_monkeysaudio_raw['nWAVTerminatingBytes'] = getid3_lib::LittleEndian2Int(substr($MACheaderData, 20, 4));
+			$thisfile_monkeysaudio_raw['nTotalFrames']         = getid3_lib::LittleEndian2Int(substr($MACheaderData, 24, 4));
+			$thisfile_monkeysaudio_raw['nFinalFrameSamples']   = getid3_lib::LittleEndian2Int(substr($MACheaderData, 28, 4));
+			$thisfile_monkeysaudio_raw['nPeakLevel']           = getid3_lib::LittleEndian2Int(substr($MACheaderData, 32, 4));
+			$thisfile_monkeysaudio_raw['nSeekElements']        = getid3_lib::LittleEndian2Int(substr($MACheaderData, 38, 2));
+			$offset = 8;
+		} else {
+			$offset = 8;
+			// APE_DESCRIPTOR
+			$thisfile_monkeysaudio_raw['nDescriptorBytes']       = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset,  4));
+			$offset += 4;
+			$thisfile_monkeysaudio_raw['nHeaderBytes']           = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset,  4));
+			$offset += 4;
+			$thisfile_monkeysaudio_raw['nSeekTableBytes']        = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset,  4));
+			$offset += 4;
+			$thisfile_monkeysaudio_raw['nHeaderDataBytes']       = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset,  4));
+			$offset += 4;
+			$thisfile_monkeysaudio_raw['nAPEFrameDataBytes']     = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset,  4));
+			$offset += 4;
+			$thisfile_monkeysaudio_raw['nAPEFrameDataBytesHigh'] = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset,  4));
+			$offset += 4;
+			$thisfile_monkeysaudio_raw['nTerminatingDataBytes']  = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset,  4));
+			$offset += 4;
+			$thisfile_monkeysaudio_raw['cFileMD5']               =                              substr($MACheaderData, $offset, 16);
+			$offset += 16;
+
+			// APE_HEADER
+			$thisfile_monkeysaudio_raw['nCompressionLevel']    = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset, 2));
+			$offset += 2;
+			$thisfile_monkeysaudio_raw['nFormatFlags']         = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset, 2));
+			$offset += 2;
+			$thisfile_monkeysaudio_raw['nBlocksPerFrame']      = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset, 4));
+			$offset += 4;
+			$thisfile_monkeysaudio_raw['nFinalFrameBlocks']    = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset, 4));
+			$offset += 4;
+			$thisfile_monkeysaudio_raw['nTotalFrames']         = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset, 4));
+			$offset += 4;
+			$thisfile_monkeysaudio_raw['nBitsPerSample']       = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset, 2));
+			$offset += 2;
+			$thisfile_monkeysaudio_raw['nChannels']            = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset, 2));
+			$offset += 2;
+			$thisfile_monkeysaudio_raw['nSampleRate']          = getid3_lib::LittleEndian2Int(substr($MACheaderData, $offset, 4));
+			$offset += 4;
+		}
+
+		$thisfile_monkeysaudio['flags']['8-bit']         = (bool) ($thisfile_monkeysaudio_raw['nFormatFlags'] &amp; 0x0001);
+		$thisfile_monkeysaudio['flags']['crc-32']        = (bool) ($thisfile_monkeysaudio_raw['nFormatFlags'] &amp; 0x0002);
+		$thisfile_monkeysaudio['flags']['peak_level']    = (bool) ($thisfile_monkeysaudio_raw['nFormatFlags'] &amp; 0x0004);
+		$thisfile_monkeysaudio['flags']['24-bit']        = (bool) ($thisfile_monkeysaudio_raw['nFormatFlags'] &amp; 0x0008);
+		$thisfile_monkeysaudio['flags']['seek_elements'] = (bool) ($thisfile_monkeysaudio_raw['nFormatFlags'] &amp; 0x0010);
+		$thisfile_monkeysaudio['flags']['no_wav_header'] = (bool) ($thisfile_monkeysaudio_raw['nFormatFlags'] &amp; 0x0020);
+		$thisfile_monkeysaudio['version']                = $thisfile_monkeysaudio_raw['nVersion'] / 1000;
+		$thisfile_monkeysaudio['compression']            = $this-&gt;MonkeyCompressionLevelNameLookup($thisfile_monkeysaudio_raw['nCompressionLevel']);
+		if ($thisfile_monkeysaudio_raw['nVersion'] &lt; 3980) {
+			$thisfile_monkeysaudio['samples_per_frame']      = $this-&gt;MonkeySamplesPerFrame($thisfile_monkeysaudio_raw['nVersion'], $thisfile_monkeysaudio_raw['nCompressionLevel']);
+		}
+		$thisfile_monkeysaudio['bits_per_sample']        = ($thisfile_monkeysaudio['flags']['24-bit'] ? 24 : ($thisfile_monkeysaudio['flags']['8-bit'] ? 8 : 16));
+		$thisfile_monkeysaudio['channels']               = $thisfile_monkeysaudio_raw['nChannels'];
+		$ThisFileInfo['audio']['channels']               = $thisfile_monkeysaudio['channels'];
+		$thisfile_monkeysaudio['sample_rate']            = $thisfile_monkeysaudio_raw['nSampleRate'];
+		if ($thisfile_monkeysaudio['sample_rate'] == 0) {
+			$ThisFileInfo['error'][] = 'Corrupt MAC file: frequency == zero';
+			return false;
+		}
+		$ThisFileInfo['audio']['sample_rate']            = $thisfile_monkeysaudio['sample_rate'];
+		if ($thisfile_monkeysaudio['flags']['peak_level']) {
+			$thisfile_monkeysaudio['peak_level']         = $thisfile_monkeysaudio_raw['nPeakLevel'];
+			$thisfile_monkeysaudio['peak_ratio']         = $thisfile_monkeysaudio['peak_level'] / pow(2, $thisfile_monkeysaudio['bits_per_sample'] - 1);
+		}
+		if ($thisfile_monkeysaudio_raw['nVersion'] &gt;= 3980) {
+			$thisfile_monkeysaudio['samples']            = (($thisfile_monkeysaudio_raw['nTotalFrames'] - 1) * $thisfile_monkeysaudio_raw['nBlocksPerFrame']) + $thisfile_monkeysaudio_raw['nFinalFrameBlocks'];
+		} else {
+			$thisfile_monkeysaudio['samples']            = (($thisfile_monkeysaudio_raw['nTotalFrames'] - 1) * $thisfile_monkeysaudio['samples_per_frame']) + $thisfile_monkeysaudio_raw['nFinalFrameSamples'];
+		}
+		$thisfile_monkeysaudio['playtime']               = $thisfile_monkeysaudio['samples'] / $thisfile_monkeysaudio['sample_rate'];
+		if ($thisfile_monkeysaudio['playtime'] == 0) {
+			$ThisFileInfo['error'][] = 'Corrupt MAC file: playtime == zero';
+			return false;
+		}
+		$ThisFileInfo['playtime_seconds']                = $thisfile_monkeysaudio['playtime'];
+		$thisfile_monkeysaudio['compressed_size']        = $ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset'];
+		$thisfile_monkeysaudio['uncompressed_size']      = $thisfile_monkeysaudio['samples'] * $thisfile_monkeysaudio['channels'] * ($thisfile_monkeysaudio['bits_per_sample'] / 8);
+		if ($thisfile_monkeysaudio['uncompressed_size'] == 0) {
+			$ThisFileInfo['error'][] = 'Corrupt MAC file: uncompressed_size == zero';
+			return false;
+		}
+		$thisfile_monkeysaudio['compression_ratio']      = $thisfile_monkeysaudio['compressed_size'] / ($thisfile_monkeysaudio['uncompressed_size'] + $thisfile_monkeysaudio_raw['nHeaderDataBytes']);
+		$thisfile_monkeysaudio['bitrate']                = (($thisfile_monkeysaudio['samples'] * $thisfile_monkeysaudio['channels'] * $thisfile_monkeysaudio['bits_per_sample']) / $thisfile_monkeysaudio['playtime']) * $thisfile_monkeysaudio['compression_ratio'];
+		$ThisFileInfo['audio']['bitrate']                = $thisfile_monkeysaudio['bitrate'];
+
+		// add size of MAC header to avdataoffset
+		if ($thisfile_monkeysaudio_raw['nVersion'] &gt;= 3980) {
+			$ThisFileInfo['avdataoffset'] += $thisfile_monkeysaudio_raw['nDescriptorBytes'];
+			$ThisFileInfo['avdataoffset'] += $thisfile_monkeysaudio_raw['nHeaderBytes'];
+			$ThisFileInfo['avdataoffset'] += $thisfile_monkeysaudio_raw['nSeekTableBytes'];
+			$ThisFileInfo['avdataoffset'] += $thisfile_monkeysaudio_raw['nHeaderDataBytes'];
+
+			$ThisFileInfo['avdataend'] -= $thisfile_monkeysaudio_raw['nTerminatingDataBytes'];
+		} else {
+			$ThisFileInfo['avdataoffset'] += $offset;
+		}
+
+		if ($thisfile_monkeysaudio_raw['nVersion'] &gt;= 3980) {
+			if ($thisfile_monkeysaudio_raw['cFileMD5'] === str_repeat(&quot;\x00&quot;, 16)) {
+				//$ThisFileInfo['warning'][] = 'cFileMD5 is null';
+			} else {
+				$ThisFileInfo['md5_data_source'] = '';
+				$md5 = $thisfile_monkeysaudio_raw['cFileMD5'];
+				for ($i = 0; $i &lt; strlen($md5); $i++) {
+					$ThisFileInfo['md5_data_source'] .= str_pad(dechex(ord($md5{$i})), 2, '00', STR_PAD_LEFT);
+				}
+				if (!preg_match('/^[0-9a-f]{32}$/', $ThisFileInfo['md5_data_source'])) {
+					unset($ThisFileInfo['md5_data_source']);
+				}
+			}
+		}
+
+
+
+		$ThisFileInfo['audio']['bits_per_sample'] = $thisfile_monkeysaudio['bits_per_sample'];
+		$ThisFileInfo['audio']['encoder']         = 'MAC v'.number_format($thisfile_monkeysaudio['version'], 2);
+		$ThisFileInfo['audio']['encoder_options'] = ucfirst($thisfile_monkeysaudio['compression']).' compression';
+
+		return true;
+	}
+
+	function MonkeyCompressionLevelNameLookup($compressionlevel) {
+		static $MonkeyCompressionLevelNameLookup = array(
+			0     =&gt; 'unknown',
+			1000  =&gt; 'fast',
+			2000  =&gt; 'normal',
+			3000  =&gt; 'high',
+			4000  =&gt; 'extra-high',
+			5000  =&gt; 'insane'
+		);
+		return (isset($MonkeyCompressionLevelNameLookup[$compressionlevel]) ? $MonkeyCompressionLevelNameLookup[$compressionlevel] : 'invalid');
+	}
+
+	function MonkeySamplesPerFrame($versionid, $compressionlevel) {
+		if ($versionid &gt;= 3950) {
+			return 73728 * 4;
+		} elseif ($versionid &gt;= 3900) {
+			return 73728;
+		} elseif (($versionid &gt;= 3800) &amp;&amp; ($compressionlevel == 4000)) {
+			return 73728;
+		} else {
+			return 9216;
+		}
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.monkey.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.mp3.php
===================================================================
--- trunk/inc/external/getid3/module.audio.mp3.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.mp3.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,1944 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.mp3.php                                        //
+// module for analyzing MP3 files                              //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+// number of frames to scan to determine if MPEG-audio sequence is valid
+// Lower this number to 5-20 for faster scanning
+// Increase this number to 50+ for most accurate detection of valid VBR/CBR
+// mpeg-audio streams
+define('GETID3_MP3_VALID_CHECK_FRAMES', 35);
+
+
+class getid3_mp3
+{
+
+	var $allow_bruteforce = false; // forces getID3() to scan the file byte-by-byte and log all the valid audio frame headers - extremely slow, unrecommended, but may provide data from otherwise-unusuable files
+
+	function getid3_mp3(&amp;$fd, &amp;$ThisFileInfo) {
+
+		if (!$this-&gt;getOnlyMPEGaudioInfo($fd, $ThisFileInfo, $ThisFileInfo['avdataoffset'])) {
+			if ($this-&gt;allow_bruteforce) {
+				$ThisFileInfo['error'][] = 'Rescanning file in BruteForce mode';
+				$this-&gt;getOnlyMPEGaudioInfoBruteForce($fd, $ThisFileInfo);
+			}
+		}
+
+
+		if (isset($ThisFileInfo['mpeg']['audio']['bitrate_mode'])) {
+			$ThisFileInfo['audio']['bitrate_mode'] = strtolower($ThisFileInfo['mpeg']['audio']['bitrate_mode']);
+		}
+
+		if (((isset($ThisFileInfo['id3v2']['headerlength']) &amp;&amp; ($ThisFileInfo['avdataoffset'] &gt; $ThisFileInfo['id3v2']['headerlength'])) || (!isset($ThisFileInfo['id3v2']) &amp;&amp; ($ThisFileInfo['avdataoffset'] &gt; 0)))) {
+
+			$synchoffsetwarning = 'Unknown data before synch ';
+			if (isset($ThisFileInfo['id3v2']['headerlength'])) {
+				$synchoffsetwarning .= '(ID3v2 header ends at '.$ThisFileInfo['id3v2']['headerlength'].', then '.($ThisFileInfo['avdataoffset'] - $ThisFileInfo['id3v2']['headerlength']).' bytes garbage, ';
+			} else {
+				$synchoffsetwarning .= '(should be at beginning of file, ';
+			}
+			$synchoffsetwarning .= 'synch detected at '.$ThisFileInfo['avdataoffset'].')';
+			if ($ThisFileInfo['audio']['bitrate_mode'] == 'cbr') {
+
+				if (!empty($ThisFileInfo['id3v2']['headerlength']) &amp;&amp; (($ThisFileInfo['avdataoffset'] - $ThisFileInfo['id3v2']['headerlength']) == $ThisFileInfo['mpeg']['audio']['framelength'])) {
+
+					$synchoffsetwarning .= '. This is a known problem with some versions of LAME (3.90-3.92) DLL in CBR mode.';
+					$ThisFileInfo['audio']['codec'] = 'LAME';
+					$CurrentDataLAMEversionString = 'LAME3.';
+
+				} elseif (empty($ThisFileInfo['id3v2']['headerlength']) &amp;&amp; ($ThisFileInfo['avdataoffset'] == $ThisFileInfo['mpeg']['audio']['framelength'])) {
+
+					$synchoffsetwarning .= '. This is a known problem with some versions of LAME (3.90 - 3.92) DLL in CBR mode.';
+					$ThisFileInfo['audio']['codec'] = 'LAME';
+					$CurrentDataLAMEversionString = 'LAME3.';
+
+				}
+
+			}
+			$ThisFileInfo['warning'][] = $synchoffsetwarning;
+
+		}
+
+		if (isset($ThisFileInfo['mpeg']['audio']['LAME'])) {
+			$ThisFileInfo['audio']['codec'] = 'LAME';
+			if (!empty($ThisFileInfo['mpeg']['audio']['LAME']['long_version'])) {
+				$ThisFileInfo['audio']['encoder'] = rtrim($ThisFileInfo['mpeg']['audio']['LAME']['long_version'], &quot;\x00&quot;);
+			} elseif (!empty($ThisFileInfo['mpeg']['audio']['LAME']['short_version'])) {
+				$ThisFileInfo['audio']['encoder'] = rtrim($ThisFileInfo['mpeg']['audio']['LAME']['short_version'], &quot;\x00&quot;);
+			}
+		}
+
+		$CurrentDataLAMEversionString = (!empty($CurrentDataLAMEversionString) ? $CurrentDataLAMEversionString : @$ThisFileInfo['audio']['encoder']);
+		if (!empty($CurrentDataLAMEversionString) &amp;&amp; (substr($CurrentDataLAMEversionString, 0, 6) == 'LAME3.') &amp;&amp; !preg_match('[0-9\)]', substr($CurrentDataLAMEversionString, -1))) {
+			// a version number of LAME that does not end with a number like &quot;LAME3.92&quot;
+			// or with a closing parenthesis like &quot;LAME3.88 (alpha)&quot;
+			// or a version of LAME with the LAMEtag-not-filled-in-DLL-mode bug (3.90-3.92)
+
+			// not sure what the actual last frame length will be, but will be less than or equal to 1441
+			$PossiblyLongerLAMEversion_FrameLength = 1441;
+
+			// Not sure what version of LAME this is - look in padding of last frame for longer version string
+			$PossibleLAMEversionStringOffset = $ThisFileInfo['avdataend'] - $PossiblyLongerLAMEversion_FrameLength;
+			fseek($fd, $PossibleLAMEversionStringOffset);
+			$PossiblyLongerLAMEversion_Data = fread($fd, $PossiblyLongerLAMEversion_FrameLength);
+			switch (substr($CurrentDataLAMEversionString, -1)) {
+				case 'a':
+				case 'b':
+					// &quot;LAME3.94a&quot; will have a longer version string of &quot;LAME3.94 (alpha)&quot; for example
+					// need to trim off &quot;a&quot; to match longer string
+					$CurrentDataLAMEversionString = substr($CurrentDataLAMEversionString, 0, -1);
+					break;
+			}
+			if (($PossiblyLongerLAMEversion_String = strstr($PossiblyLongerLAMEversion_Data, $CurrentDataLAMEversionString)) !== false) {
+				if (substr($PossiblyLongerLAMEversion_String, 0, strlen($CurrentDataLAMEversionString)) == $CurrentDataLAMEversionString) {
+					$PossiblyLongerLAMEversion_NewString = substr($PossiblyLongerLAMEversion_String, 0, strspn($PossiblyLongerLAMEversion_String, 'LAME0123456789., (abcdefghijklmnopqrstuvwxyzJFSOND)')); //&quot;LAME3.90.3&quot;  &quot;LAME3.87 (beta 1, Sep 27 2000)&quot; &quot;LAME3.88 (beta)&quot;
+					if (strlen($PossiblyLongerLAMEversion_NewString) &gt; strlen(@$ThisFileInfo['audio']['encoder'])) {
+						$ThisFileInfo['audio']['encoder'] = $PossiblyLongerLAMEversion_NewString;
+					}
+				}
+			}
+		}
+		if (!empty($ThisFileInfo['audio']['encoder'])) {
+			$ThisFileInfo['audio']['encoder'] = rtrim($ThisFileInfo['audio']['encoder'], &quot;\x00 &quot;);
+		}
+
+		switch (@$ThisFileInfo['mpeg']['audio']['layer']) {
+			case 1:
+			case 2:
+				$ThisFileInfo['audio']['dataformat'] = 'mp'.$ThisFileInfo['mpeg']['audio']['layer'];
+				break;
+		}
+		if ($ThisFileInfo['fileformat'] == 'mp3') {
+			switch ($ThisFileInfo['audio']['dataformat']) {
+				case 'mp1':
+				case 'mp2':
+				case 'mp3':
+					$ThisFileInfo['fileformat'] = $ThisFileInfo['audio']['dataformat'];
+					break;
+
+				default:
+					$ThisFileInfo['warning'][] = 'Expecting [audio][dataformat] to be mp1/mp2/mp3 when fileformat == mp3, [audio][dataformat] actually &quot;'.$ThisFileInfo['audio']['dataformat'].'&quot;';
+					break;
+			}
+		}
+
+		if (empty($ThisFileInfo['fileformat'])) {
+			unset($ThisFileInfo['fileformat']);
+			unset($ThisFileInfo['audio']['bitrate_mode']);
+			unset($ThisFileInfo['avdataoffset']);
+			unset($ThisFileInfo['avdataend']);
+			return false;
+		}
+
+		$ThisFileInfo['mime_type']         = 'audio/mpeg';
+		$ThisFileInfo['audio']['lossless'] = false;
+
+		// Calculate playtime
+		if (!isset($ThisFileInfo['playtime_seconds']) &amp;&amp; isset($ThisFileInfo['audio']['bitrate']) &amp;&amp; ($ThisFileInfo['audio']['bitrate'] &gt; 0)) {
+			$ThisFileInfo['playtime_seconds'] = ($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8 / $ThisFileInfo['audio']['bitrate'];
+		}
+
+		$ThisFileInfo['audio']['encoder_options'] = $this-&gt;GuessEncoderOptions($ThisFileInfo);
+
+		return true;
+	}
+
+
+	function GuessEncoderOptions(&amp;$ThisFileInfo) {
+		// shortcuts
+		if (!empty($ThisFileInfo['mpeg']['audio'])) {
+			$thisfile_mpeg_audio = &amp;$ThisFileInfo['mpeg']['audio'];
+			if (!empty($thisfile_mpeg_audio['LAME'])) {
+				$thisfile_mpeg_audio_lame = &amp;$thisfile_mpeg_audio['LAME'];
+			}
+		}
+
+		$encoder_options = '';
+		static $NamedPresetBitrates = array(16, 24, 40, 56, 112, 128, 160, 192, 256);
+
+		if ((@$thisfile_mpeg_audio['VBR_method'] == 'Fraunhofer') &amp;&amp; !empty($thisfile_mpeg_audio['VBR_quality'])) {
+
+			$encoder_options = 'VBR q'.$thisfile_mpeg_audio['VBR_quality'];
+
+		} elseif (!empty($thisfile_mpeg_audio_lame['preset_used']) &amp;&amp; (!in_array($thisfile_mpeg_audio_lame['preset_used_id'], $NamedPresetBitrates))) {
+
+			$encoder_options = $thisfile_mpeg_audio_lame['preset_used'];
+
+		} elseif (!empty($thisfile_mpeg_audio_lame['vbr_quality'])) {
+
+			static $KnownEncoderValues = array();
+			if (empty($KnownEncoderValues)) {
+
+				//$KnownEncoderValues[abrbitrate_minbitrate][vbr_quality][raw_vbr_method][raw_noise_shaping][raw_stereo_mode][ath_type][lowpass_frequency] = 'preset name';
+				$KnownEncoderValues[0xFF][58][1][1][3][2][20500] = '--alt-preset insane';        // 3.90,   3.90.1, 3.92
+				$KnownEncoderValues[0xFF][58][1][1][3][2][20600] = '--alt-preset insane';        // 3.90.2, 3.90.3, 3.91
+				$KnownEncoderValues[0xFF][57][1][1][3][4][20500] = '--alt-preset insane';        // 3.94,   3.95
+				$KnownEncoderValues['**'][78][3][2][3][2][19500] = '--alt-preset extreme';       // 3.90,   3.90.1, 3.92
+				$KnownEncoderValues['**'][78][3][2][3][2][19600] = '--alt-preset extreme';       // 3.90.2, 3.91
+				$KnownEncoderValues['**'][78][3][1][3][2][19600] = '--alt-preset extreme';       // 3.90.3
+				$KnownEncoderValues['**'][78][4][2][3][2][19500] = '--alt-preset fast extreme';  // 3.90,   3.90.1, 3.92
+				$KnownEncoderValues['**'][78][4][2][3][2][19600] = '--alt-preset fast extreme';  // 3.90.2, 3.90.3, 3.91
+				$KnownEncoderValues['**'][78][3][2][3][4][19000] = '--alt-preset standard';      // 3.90,   3.90.1, 3.90.2, 3.91, 3.92
+				$KnownEncoderValues['**'][78][3][1][3][4][19000] = '--alt-preset standard';      // 3.90.3
+				$KnownEncoderValues['**'][78][4][2][3][4][19000] = '--alt-preset fast standard'; // 3.90,   3.90.1, 3.90.2, 3.91, 3.92
+				$KnownEncoderValues['**'][78][4][1][3][4][19000] = '--alt-preset fast standard'; // 3.90.3
+				$KnownEncoderValues['**'][88][4][1][3][3][19500] = '--r3mix';                    // 3.90,   3.90.1, 3.92
+				$KnownEncoderValues['**'][88][4][1][3][3][19600] = '--r3mix';                    // 3.90.2, 3.90.3, 3.91
+				$KnownEncoderValues['**'][67][4][1][3][4][18000] = '--r3mix';                    // 3.94,   3.95
+				$KnownEncoderValues['**'][68][3][2][3][4][18000] = '--alt-preset medium';        // 3.90.3
+				$KnownEncoderValues['**'][68][4][2][3][4][18000] = '--alt-preset fast medium';   // 3.90.3
+
+				$KnownEncoderValues[0xFF][99][1][1][1][2][0]     = '--preset studio';            // 3.90,   3.90.1, 3.90.2, 3.91, 3.92
+				$KnownEncoderValues[0xFF][58][2][1][3][2][20600] = '--preset studio';            // 3.90.3, 3.93.1
+				$KnownEncoderValues[0xFF][58][2][1][3][2][20500] = '--preset studio';            // 3.93
+				$KnownEncoderValues[0xFF][57][2][1][3][4][20500] = '--preset studio';            // 3.94,   3.95
+				$KnownEncoderValues[0xC0][88][1][1][1][2][0]     = '--preset cd';                // 3.90,   3.90.1, 3.90.2,   3.91, 3.92
+				$KnownEncoderValues[0xC0][58][2][2][3][2][19600] = '--preset cd';                // 3.90.3, 3.93.1
+				$KnownEncoderValues[0xC0][58][2][2][3][2][19500] = '--preset cd';                // 3.93
+				$KnownEncoderValues[0xC0][57][2][1][3][4][19500] = '--preset cd';                // 3.94,   3.95
+				$KnownEncoderValues[0xA0][78][1][1][3][2][18000] = '--preset hifi';              // 3.90,   3.90.1, 3.90.2,   3.91, 3.92
+				$KnownEncoderValues[0xA0][58][2][2][3][2][18000] = '--preset hifi';              // 3.90.3, 3.93,   3.93.1
+				$KnownEncoderValues[0xA0][57][2][1][3][4][18000] = '--preset hifi';              // 3.94,   3.95
+				$KnownEncoderValues[0x80][67][1][1][3][2][18000] = '--preset tape';              // 3.90,   3.90.1, 3.90.2,   3.91, 3.92
+				$KnownEncoderValues[0x80][67][1][1][3][2][15000] = '--preset radio';             // 3.90,   3.90.1, 3.90.2,   3.91, 3.92
+				$KnownEncoderValues[0x70][67][1][1][3][2][15000] = '--preset fm';                // 3.90,   3.90.1, 3.90.2,   3.91, 3.92
+				$KnownEncoderValues[0x70][58][2][2][3][2][16000] = '--preset tape/radio/fm';     // 3.90.3, 3.93,   3.93.1
+				$KnownEncoderValues[0x70][57][2][1][3][4][16000] = '--preset tape/radio/fm';     // 3.94,   3.95
+				$KnownEncoderValues[0x38][58][2][2][0][2][10000] = '--preset voice';             // 3.90.3, 3.93,   3.93.1
+				$KnownEncoderValues[0x38][57][2][1][0][4][15000] = '--preset voice';             // 3.94,   3.95
+				$KnownEncoderValues[0x38][57][2][1][0][4][16000] = '--preset voice';             // 3.94a14
+				$KnownEncoderValues[0x28][65][1][1][0][2][7500]  = '--preset mw-us';             // 3.90,   3.90.1, 3.92
+				$KnownEncoderValues[0x28][65][1][1][0][2][7600]  = '--preset mw-us';             // 3.90.2, 3.91
+				$KnownEncoderValues[0x28][58][2][2][0][2][7000]  = '--preset mw-us';             // 3.90.3, 3.93,   3.93.1
+				$KnownEncoderValues[0x28][57][2][1][0][4][10500] = '--preset mw-us';             // 3.94,   3.95
+				$KnownEncoderValues[0x28][57][2][1][0][4][11200] = '--preset mw-us';             // 3.94a14
+				$KnownEncoderValues[0x28][57][2][1][0][4][8800]  = '--preset mw-us';             // 3.94a15
+				$KnownEncoderValues[0x18][58][2][2][0][2][4000]  = '--preset phon+/lw/mw-eu/sw'; // 3.90.3, 3.93.1
+				$KnownEncoderValues[0x18][58][2][2][0][2][3900]  = '--preset phon+/lw/mw-eu/sw'; // 3.93
+				$KnownEncoderValues[0x18][57][2][1][0][4][5900]  = '--preset phon+/lw/mw-eu/sw'; // 3.94,   3.95
+				$KnownEncoderValues[0x18][57][2][1][0][4][6200]  = '--preset phon+/lw/mw-eu/sw'; // 3.94a14
+				$KnownEncoderValues[0x18][57][2][1][0][4][3200]  = '--preset phon+/lw/mw-eu/sw'; // 3.94a15
+				$KnownEncoderValues[0x10][58][2][2][0][2][3800]  = '--preset phone';             // 3.90.3, 3.93.1
+				$KnownEncoderValues[0x10][58][2][2][0][2][3700]  = '--preset phone';             // 3.93
+				$KnownEncoderValues[0x10][57][2][1][0][4][5600]  = '--preset phone';             // 3.94,   3.95
+			}
+
+			if (isset($KnownEncoderValues[$thisfile_mpeg_audio_lame['raw']['abrbitrate_minbitrate']][$thisfile_mpeg_audio_lame['vbr_quality']][$thisfile_mpeg_audio_lame['raw']['vbr_method']][$thisfile_mpeg_audio_lame['raw']['noise_shaping']][$thisfile_mpeg_audio_lame['raw']['stereo_mode']][$thisfile_mpeg_audio_lame['ath_type']][$thisfile_mpeg_audio_lame['lowpass_frequency']])) {
+
+				$encoder_options = $KnownEncoderValues[$thisfile_mpeg_audio_lame['raw']['abrbitrate_minbitrate']][$thisfile_mpeg_audio_lame['vbr_quality']][$thisfile_mpeg_audio_lame['raw']['vbr_method']][$thisfile_mpeg_audio_lame['raw']['noise_shaping']][$thisfile_mpeg_audio_lame['raw']['stereo_mode']][$thisfile_mpeg_audio_lame['ath_type']][$thisfile_mpeg_audio_lame['lowpass_frequency']];
+
+			} elseif (isset($KnownEncoderValues['**'][$thisfile_mpeg_audio_lame['vbr_quality']][$thisfile_mpeg_audio_lame['raw']['vbr_method']][$thisfile_mpeg_audio_lame['raw']['noise_shaping']][$thisfile_mpeg_audio_lame['raw']['stereo_mode']][$thisfile_mpeg_audio_lame['ath_type']][$thisfile_mpeg_audio_lame['lowpass_frequency']])) {
+
+				$encoder_options = $KnownEncoderValues['**'][$thisfile_mpeg_audio_lame['vbr_quality']][$thisfile_mpeg_audio_lame['raw']['vbr_method']][$thisfile_mpeg_audio_lame['raw']['noise_shaping']][$thisfile_mpeg_audio_lame['raw']['stereo_mode']][$thisfile_mpeg_audio_lame['ath_type']][$thisfile_mpeg_audio_lame['lowpass_frequency']];
+
+			} elseif ($ThisFileInfo['audio']['bitrate_mode'] == 'vbr') {
+
+				// <A HREF="http://gabriel.mp3-tech.org/mp3infotag.html">http://gabriel.mp3-tech.org/mp3infotag.html</A>
+				// int    Quality = (100 - 10 * gfp-&gt;VBR_q - gfp-&gt;quality)h
+
+
+				$LAME_V_value = 10 - ceil($thisfile_mpeg_audio_lame['vbr_quality'] / 10);
+				$LAME_q_value = 100 - $thisfile_mpeg_audio_lame['vbr_quality'] - ($LAME_V_value * 10);
+				$encoder_options = '-V'.$LAME_V_value.' -q'.$LAME_q_value;
+
+			} elseif ($ThisFileInfo['audio']['bitrate_mode'] == 'cbr') {
+
+				$encoder_options = strtoupper($ThisFileInfo['audio']['bitrate_mode']).ceil($ThisFileInfo['audio']['bitrate'] / 1000);
+
+			} else {
+
+				$encoder_options = strtoupper($ThisFileInfo['audio']['bitrate_mode']);
+
+			}
+
+		} elseif (!empty($thisfile_mpeg_audio_lame['bitrate_abr'])) {
+
+			$encoder_options = 'ABR'.$thisfile_mpeg_audio_lame['bitrate_abr'];
+
+		} elseif (!empty($ThisFileInfo['audio']['bitrate'])) {
+
+			if ($ThisFileInfo['audio']['bitrate_mode'] == 'cbr') {
+				$encoder_options = strtoupper($ThisFileInfo['audio']['bitrate_mode']).ceil($ThisFileInfo['audio']['bitrate'] / 1000);
+			} else {
+				$encoder_options = strtoupper($ThisFileInfo['audio']['bitrate_mode']);
+			}
+
+		}
+		if (!empty($thisfile_mpeg_audio_lame['bitrate_min'])) {
+			$encoder_options .= ' -b'.$thisfile_mpeg_audio_lame['bitrate_min'];
+		}
+
+		if (@$thisfile_mpeg_audio_lame['encoding_flags']['nogap_prev'] || @$thisfile_mpeg_audio_lame['encoding_flags']['nogap_next']) {
+			$encoder_options .= ' --nogap';
+		}
+
+		if (!empty($thisfile_mpeg_audio_lame['lowpass_frequency'])) {
+			$ExplodedOptions = explode(' ', $encoder_options, 4);
+			if ($ExplodedOptions[0] == '--r3mix') {
+				$ExplodedOptions[1] = 'r3mix';
+			}
+			switch ($ExplodedOptions[0]) {
+				case '--preset':
+				case '--alt-preset':
+				case '--r3mix':
+					if ($ExplodedOptions[1] == 'fast') {
+						$ExplodedOptions[1] .= ' '.$ExplodedOptions[2];
+					}
+					switch ($ExplodedOptions[1]) {
+						case 'portable':
+						case 'medium':
+						case 'standard':
+						case 'extreme':
+						case 'insane':
+						case 'fast portable':
+						case 'fast medium':
+						case 'fast standard':
+						case 'fast extreme':
+						case 'fast insane':
+						case 'r3mix':
+							static $ExpectedLowpass = array(
+									'insane|20500'        =&gt; 20500,
+									'insane|20600'        =&gt; 20600,  // 3.90.2, 3.90.3, 3.91
+									'medium|18000'        =&gt; 18000,
+									'fast medium|18000'   =&gt; 18000,
+									'extreme|19500'       =&gt; 19500,  // 3.90,   3.90.1, 3.92, 3.95
+									'extreme|19600'       =&gt; 19600,  // 3.90.2, 3.90.3, 3.91, 3.93.1
+									'fast extreme|19500'  =&gt; 19500,  // 3.90,   3.90.1, 3.92, 3.95
+									'fast extreme|19600'  =&gt; 19600,  // 3.90.2, 3.90.3, 3.91, 3.93.1
+									'standard|19000'      =&gt; 19000,
+									'fast standard|19000' =&gt; 19000,
+									'r3mix|19500'         =&gt; 19500,  // 3.90,   3.90.1, 3.92
+									'r3mix|19600'         =&gt; 19600,  // 3.90.2, 3.90.3, 3.91
+									'r3mix|18000'         =&gt; 18000); // 3.94,   3.95
+							if (!isset($ExpectedLowpass[$ExplodedOptions[1].'|'.$thisfile_mpeg_audio_lame['lowpass_frequency']])) {
+								$encoder_options .= ' --lowpass '.$thisfile_mpeg_audio_lame['lowpass_frequency'];
+							}
+							break;
+
+						default:
+							break;
+					}
+					break;
+			}
+		}
+
+		if (isset($thisfile_mpeg_audio_lame['raw']['source_sample_freq'])) {
+			if (($thisfile_mpeg_audio['sample_rate'] == 44100) &amp;&amp; ($thisfile_mpeg_audio_lame['raw']['source_sample_freq'] != 1)) {
+				$encoder_options .= ' --resample 44100';
+			} elseif (($thisfile_mpeg_audio['sample_rate'] == 48000) &amp;&amp; ($thisfile_mpeg_audio_lame['raw']['source_sample_freq'] != 2)) {
+				$encoder_options .= ' --resample 48000';
+			} elseif ($thisfile_mpeg_audio['sample_rate'] &lt; 44100) {
+				switch ($thisfile_mpeg_audio_lame['raw']['source_sample_freq']) {
+					case 0: // &lt;= 32000
+						// may or may not be same as source frequency - ignore
+						break;
+					case 1: // 44100
+					case 2: // 48000
+					case 3: // 48000+
+						$ExplodedOptions = explode(' ', $encoder_options, 4);
+						switch ($ExplodedOptions[0]) {
+							case '--preset':
+							case '--alt-preset':
+								switch ($ExplodedOptions[1]) {
+									case 'fast':
+									case 'portable':
+									case 'medium':
+									case 'standard':
+									case 'extreme':
+									case 'insane':
+										$encoder_options .= ' --resample '.$thisfile_mpeg_audio['sample_rate'];
+										break;
+
+									default:
+										static $ExpectedResampledRate = array(
+												'phon+/lw/mw-eu/sw|16000' =&gt; 16000,
+												'mw-us|24000'             =&gt; 24000, // 3.95
+												'mw-us|32000'             =&gt; 32000, // 3.93
+												'mw-us|16000'             =&gt; 16000, // 3.92
+												'phone|16000'             =&gt; 16000,
+												'phone|11025'             =&gt; 11025, // 3.94a15
+												'radio|32000'             =&gt; 32000, // 3.94a15
+												'fm/radio|32000'          =&gt; 32000, // 3.92
+												'fm|32000'                =&gt; 32000, // 3.90
+												'voice|32000'             =&gt; 32000);
+										if (!isset($ExpectedResampledRate[$ExplodedOptions[1].'|'.$thisfile_mpeg_audio['sample_rate']])) {
+											$encoder_options .= ' --resample '.$thisfile_mpeg_audio['sample_rate'];
+										}
+										break;
+								}
+								break;
+
+							case '--r3mix':
+							default:
+								$encoder_options .= ' --resample '.$thisfile_mpeg_audio['sample_rate'];
+								break;
+						}
+						break;
+				}
+			}
+		}
+		if (empty($encoder_options) &amp;&amp; !empty($ThisFileInfo['audio']['bitrate']) &amp;&amp; !empty($ThisFileInfo['audio']['bitrate_mode'])) {
+			//$encoder_options = strtoupper($ThisFileInfo['audio']['bitrate_mode']).ceil($ThisFileInfo['audio']['bitrate'] / 1000);
+			$encoder_options = strtoupper($ThisFileInfo['audio']['bitrate_mode']);
+		}
+
+		return $encoder_options;
+	}
+
+
+	function decodeMPEGaudioHeader($fd, $offset, &amp;$ThisFileInfo, $recursivesearch=true, $ScanAsCBR=false, $FastMPEGheaderScan=false) {
+
+		static $MPEGaudioVersionLookup;
+		static $MPEGaudioLayerLookup;
+		static $MPEGaudioBitrateLookup;
+		static $MPEGaudioFrequencyLookup;
+		static $MPEGaudioChannelModeLookup;
+		static $MPEGaudioModeExtensionLookup;
+		static $MPEGaudioEmphasisLookup;
+		if (empty($MPEGaudioVersionLookup)) {
+			$MPEGaudioVersionLookup       = getid3_mp3::MPEGaudioVersionArray();
+			$MPEGaudioLayerLookup         = getid3_mp3::MPEGaudioLayerArray();
+			$MPEGaudioBitrateLookup       = getid3_mp3::MPEGaudioBitrateArray();
+			$MPEGaudioFrequencyLookup     = getid3_mp3::MPEGaudioFrequencyArray();
+			$MPEGaudioChannelModeLookup   = getid3_mp3::MPEGaudioChannelModeArray();
+			$MPEGaudioModeExtensionLookup = getid3_mp3::MPEGaudioModeExtensionArray();
+			$MPEGaudioEmphasisLookup      = getid3_mp3::MPEGaudioEmphasisArray();
+		}
+
+		if ($offset &gt;= $ThisFileInfo['avdataend']) {
+			$ThisFileInfo['error'][] = 'end of file encounter looking for MPEG synch';
+			return false;
+		}
+		fseek($fd, $offset, SEEK_SET);
+		//$headerstring = fread($fd, 1441); // worst-case max length = 32kHz @ 320kbps layer 3 = 1441 bytes/frame
+		$headerstring = fread($fd, 226); // LAME header at offset 36 + 190 bytes of Xing/LAME data
+
+		// MP3 audio frame structure:
+		// $aa $aa $aa $aa [$bb $bb] $cc...
+		// where $aa..$aa is the four-byte mpeg-audio header (below)
+		// $bb $bb is the optional 2-byte CRC
+		// and $cc... is the audio data
+
+		$head4 = substr($headerstring, 0, 4);
+
+		static $MPEGaudioHeaderDecodeCache = array();
+		if (isset($MPEGaudioHeaderDecodeCache[$head4])) {
+			$MPEGheaderRawArray = $MPEGaudioHeaderDecodeCache[$head4];
+		} else {
+			$MPEGheaderRawArray = getid3_mp3::MPEGaudioHeaderDecode($head4);
+			$MPEGaudioHeaderDecodeCache[$head4] = $MPEGheaderRawArray;
+		}
+
+		static $MPEGaudioHeaderValidCache = array();
+
+		// Not in cache
+		if (!isset($MPEGaudioHeaderValidCache[$head4])) {
+			//$MPEGaudioHeaderValidCache[$head4] = getid3_mp3::MPEGaudioHeaderValid($MPEGheaderRawArray, false, true);  // allow badly-formatted freeformat (from LAME 3.90 - 3.93.1)
+			$MPEGaudioHeaderValidCache[$head4] = getid3_mp3::MPEGaudioHeaderValid($MPEGheaderRawArray, false, false);
+		}
+
+		// shortcut
+		if (!isset($ThisFileInfo['mpeg']['audio'])) {
+			$ThisFileInfo['mpeg']['audio'] = array();
+		}
+		$thisfile_mpeg_audio = &amp;$ThisFileInfo['mpeg']['audio'];
+
+
+		if ($MPEGaudioHeaderValidCache[$head4]) {
+			$thisfile_mpeg_audio['raw'] = $MPEGheaderRawArray;
+		} else {
+			$ThisFileInfo['error'][] = 'Invalid MPEG audio header at offset '.$offset;
+			return false;
+		}
+
+		if (!$FastMPEGheaderScan) {
+
+			$thisfile_mpeg_audio['version']       = $MPEGaudioVersionLookup[$thisfile_mpeg_audio['raw']['version']];
+			$thisfile_mpeg_audio['layer']         = $MPEGaudioLayerLookup[$thisfile_mpeg_audio['raw']['layer']];
+
+			$thisfile_mpeg_audio['channelmode']   = $MPEGaudioChannelModeLookup[$thisfile_mpeg_audio['raw']['channelmode']];
+			$thisfile_mpeg_audio['channels']      = (($thisfile_mpeg_audio['channelmode'] == 'mono') ? 1 : 2);
+			$thisfile_mpeg_audio['sample_rate']   = $MPEGaudioFrequencyLookup[$thisfile_mpeg_audio['version']][$thisfile_mpeg_audio['raw']['sample_rate']];
+			$thisfile_mpeg_audio['protection']    = !$thisfile_mpeg_audio['raw']['protection'];
+			$thisfile_mpeg_audio['private']       = (bool) $thisfile_mpeg_audio['raw']['private'];
+			$thisfile_mpeg_audio['modeextension'] = $MPEGaudioModeExtensionLookup[$thisfile_mpeg_audio['layer']][$thisfile_mpeg_audio['raw']['modeextension']];
+			$thisfile_mpeg_audio['copyright']     = (bool) $thisfile_mpeg_audio['raw']['copyright'];
+			$thisfile_mpeg_audio['original']      = (bool) $thisfile_mpeg_audio['raw']['original'];
+			$thisfile_mpeg_audio['emphasis']      = $MPEGaudioEmphasisLookup[$thisfile_mpeg_audio['raw']['emphasis']];
+
+			$ThisFileInfo['audio']['channels']    = $thisfile_mpeg_audio['channels'];
+			$ThisFileInfo['audio']['sample_rate'] = $thisfile_mpeg_audio['sample_rate'];
+
+			if ($thisfile_mpeg_audio['protection']) {
+				$thisfile_mpeg_audio['crc'] = getid3_lib::BigEndian2Int(substr($headerstring, 4, 2));
+			}
+
+		}
+
+		if ($thisfile_mpeg_audio['raw']['bitrate'] == 15) {
+			// <A HREF="http://www.hydrogenaudio.org/?act=ST&amp;f=16&amp;t=9682&amp;st=0">http://www.hydrogenaudio.org/?act=ST&amp;f=16&amp;t=9682&amp;st=0</A>
+			$ThisFileInfo['warning'][] = 'Invalid bitrate index (15), this is a known bug in free-format MP3s encoded by LAME v3.90 - 3.93.1';
+			$thisfile_mpeg_audio['raw']['bitrate'] = 0;
+		}
+		$thisfile_mpeg_audio['padding'] = (bool) $thisfile_mpeg_audio['raw']['padding'];
+		$thisfile_mpeg_audio['bitrate'] = $MPEGaudioBitrateLookup[$thisfile_mpeg_audio['version']][$thisfile_mpeg_audio['layer']][$thisfile_mpeg_audio['raw']['bitrate']];
+
+		if (($thisfile_mpeg_audio['bitrate'] == 'free') &amp;&amp; ($offset == $ThisFileInfo['avdataoffset'])) {
+			// only skip multiple frame check if free-format bitstream found at beginning of file
+			// otherwise is quite possibly simply corrupted data
+			$recursivesearch = false;
+		}
+
+		// For Layer 2 there are some combinations of bitrate and mode which are not allowed.
+		if (!$FastMPEGheaderScan &amp;&amp; ($thisfile_mpeg_audio['layer'] == '2')) {
+
+			$ThisFileInfo['audio']['dataformat'] = 'mp2';
+			switch ($thisfile_mpeg_audio['channelmode']) {
+
+				case 'mono':
+					if (($thisfile_mpeg_audio['bitrate'] == 'free') || ($thisfile_mpeg_audio['bitrate'] &lt;= 192000)) {
+						// these are ok
+					} else {
+						$ThisFileInfo['error'][] = $thisfile_mpeg_audio['bitrate'].'kbps not allowed in Layer 2, '.$thisfile_mpeg_audio['channelmode'].'.';
+						return false;
+					}
+					break;
+
+				case 'stereo':
+				case 'joint stereo':
+				case 'dual channel':
+					if (($thisfile_mpeg_audio['bitrate'] == 'free') || ($thisfile_mpeg_audio['bitrate'] == 64000) || ($thisfile_mpeg_audio['bitrate'] &gt;= 96000)) {
+						// these are ok
+					} else {
+						$ThisFileInfo['error'][] = intval(round($thisfile_mpeg_audio['bitrate'] / 1000)).'kbps not allowed in Layer 2, '.$thisfile_mpeg_audio['channelmode'].'.';
+						return false;
+					}
+					break;
+
+			}
+
+		}
+
+
+		if ($ThisFileInfo['audio']['sample_rate'] &gt; 0) {
+			$thisfile_mpeg_audio['framelength'] = getid3_mp3::MPEGaudioFrameLength($thisfile_mpeg_audio['bitrate'], $thisfile_mpeg_audio['version'], $thisfile_mpeg_audio['layer'], (int) $thisfile_mpeg_audio['padding'], $ThisFileInfo['audio']['sample_rate']);
+		}
+
+		$nextframetestoffset = $offset + 1;
+		if ($thisfile_mpeg_audio['bitrate'] != 'free') {
+
+			$ThisFileInfo['audio']['bitrate'] = $thisfile_mpeg_audio['bitrate'];
+
+			if (isset($thisfile_mpeg_audio['framelength'])) {
+				$nextframetestoffset = $offset + $thisfile_mpeg_audio['framelength'];
+			} else {
+				$ThisFileInfo['error'][] = 'Frame at offset('.$offset.') is has an invalid frame length.';
+				return false;
+			}
+
+		}
+
+		$ExpectedNumberOfAudioBytes = 0;
+
+		////////////////////////////////////////////////////////////////////////////////////
+		// Variable-bitrate headers
+
+		if (substr($headerstring, 4 + 32, 4) == 'VBRI') {
+			// Fraunhofer VBR header is hardcoded 'VBRI' at offset 0x24 (36)
+			// specs taken from <A HREF="http://minnie.tuhs.org/pipermail/mp3encoder/2001-January/001800.html">http://minnie.tuhs.org/pipermail/mp3encoder/2001-January/001800.html</A>
+
+			$thisfile_mpeg_audio['bitrate_mode'] = 'vbr';
+			$thisfile_mpeg_audio['VBR_method']   = 'Fraunhofer';
+			$ThisFileInfo['audio']['codec']                = 'Fraunhofer';
+
+			$SideInfoData = substr($headerstring, 4 + 2, 32);
+
+			$FraunhoferVBROffset = 36;
+
+			$thisfile_mpeg_audio['VBR_encoder_version']     = getid3_lib::BigEndian2Int(substr($headerstring, $FraunhoferVBROffset +  4, 2)); // VbriVersion
+			$thisfile_mpeg_audio['VBR_encoder_delay']       = getid3_lib::BigEndian2Int(substr($headerstring, $FraunhoferVBROffset +  6, 2)); // VbriDelay
+			$thisfile_mpeg_audio['VBR_quality']             = getid3_lib::BigEndian2Int(substr($headerstring, $FraunhoferVBROffset +  8, 2)); // VbriQuality
+			$thisfile_mpeg_audio['VBR_bytes']               = getid3_lib::BigEndian2Int(substr($headerstring, $FraunhoferVBROffset + 10, 4)); // VbriStreamBytes
+			$thisfile_mpeg_audio['VBR_frames']              = getid3_lib::BigEndian2Int(substr($headerstring, $FraunhoferVBROffset + 14, 4)); // VbriStreamFrames
+			$thisfile_mpeg_audio['VBR_seek_offsets']        = getid3_lib::BigEndian2Int(substr($headerstring, $FraunhoferVBROffset + 18, 2)); // VbriTableSize
+			$thisfile_mpeg_audio['VBR_seek_scale']          = getid3_lib::BigEndian2Int(substr($headerstring, $FraunhoferVBROffset + 20, 2)); // VbriTableScale
+			$thisfile_mpeg_audio['VBR_entry_bytes']         = getid3_lib::BigEndian2Int(substr($headerstring, $FraunhoferVBROffset + 22, 2)); // VbriEntryBytes
+			$thisfile_mpeg_audio['VBR_entry_frames']        = getid3_lib::BigEndian2Int(substr($headerstring, $FraunhoferVBROffset + 24, 2)); // VbriEntryFrames
+
+			$ExpectedNumberOfAudioBytes = $thisfile_mpeg_audio['VBR_bytes'];
+
+			$previousbyteoffset = $offset;
+			for ($i = 0; $i &lt; $thisfile_mpeg_audio['VBR_seek_offsets']; $i++) {
+				$Fraunhofer_OffsetN = getid3_lib::BigEndian2Int(substr($headerstring, $FraunhoferVBROffset, $thisfile_mpeg_audio['VBR_entry_bytes']));
+				$FraunhoferVBROffset += $thisfile_mpeg_audio['VBR_entry_bytes'];
+				$thisfile_mpeg_audio['VBR_offsets_relative'][$i] = ($Fraunhofer_OffsetN * $thisfile_mpeg_audio['VBR_seek_scale']);
+				$thisfile_mpeg_audio['VBR_offsets_absolute'][$i] = ($Fraunhofer_OffsetN * $thisfile_mpeg_audio['VBR_seek_scale']) + $previousbyteoffset;
+				$previousbyteoffset += $Fraunhofer_OffsetN;
+			}
+
+
+		} else {
+
+			// Xing VBR header is hardcoded 'Xing' at a offset 0x0D (13), 0x15 (21) or 0x24 (36)
+			// depending on MPEG layer and number of channels
+
+			$VBRidOffset = getid3_mp3::XingVBRidOffset($thisfile_mpeg_audio['version'], $thisfile_mpeg_audio['channelmode']);
+			$SideInfoData = substr($headerstring, 4 + 2, $VBRidOffset - 4);
+
+			if ((substr($headerstring, $VBRidOffset, strlen('Xing')) == 'Xing') || (substr($headerstring, $VBRidOffset, strlen('Info')) == 'Info')) {
+				// 'Xing' is traditional Xing VBR frame
+				// 'Info' is LAME-encoded CBR (This was done to avoid CBR files to be recognized as traditional Xing VBR files by some decoders.)
+				// 'Info' *can* legally be used to specify a VBR file as well, however.
+
+				// <A HREF="http://www.multiweb.cz/twoinches/MP3inside.htm">http://www.multiweb.cz/twoinches/MP3inside.htm</A>
+				//00..03 = &quot;Xing&quot; or &quot;Info&quot;
+				//04..07 = Flags:
+				//  0x01  Frames Flag     set if value for number of frames in file is stored
+				//  0x02  Bytes Flag      set if value for filesize in bytes is stored
+				//  0x04  TOC Flag        set if values for TOC are stored
+				//  0x08  VBR Scale Flag  set if values for VBR scale is stored
+				//08..11  Frames: Number of frames in file (including the first Xing/Info one)
+				//12..15  Bytes:  File length in Bytes
+				//16..115  TOC (Table of Contents):
+				//  Contains of 100 indexes (one Byte length) for easier lookup in file. Approximately solves problem with moving inside file.
+				//  Each Byte has a value according this formula:
+				//  (TOC[i] / 256) * fileLenInBytes
+				//  So if song lasts eg. 240 sec. and you want to jump to 60. sec. (and file is 5 000 000 Bytes length) you can use:
+				//  TOC[(60/240)*100] = TOC[25]
+				//  and corresponding Byte in file is then approximately at:
+				//  (TOC[25]/256) * 5000000
+				//116..119  VBR Scale
+
+
+				// should be safe to leave this at 'vbr' and let it be overriden to 'cbr' if a CBR preset/mode is used by LAME
+//				if (substr($headerstring, $VBRidOffset, strlen('Info')) == 'Xing') {
+					$thisfile_mpeg_audio['bitrate_mode'] = 'vbr';
+					$thisfile_mpeg_audio['VBR_method']   = 'Xing';
+//				} else {
+//					$ScanAsCBR = true;
+//					$thisfile_mpeg_audio['bitrate_mode'] = 'cbr';
+//				}
+
+				$thisfile_mpeg_audio['xing_flags_raw'] = getid3_lib::BigEndian2Int(substr($headerstring, $VBRidOffset + 4, 4));
+
+				$thisfile_mpeg_audio['xing_flags']['frames']    = (bool) ($thisfile_mpeg_audio['xing_flags_raw'] &amp; 0x00000001);
+				$thisfile_mpeg_audio['xing_flags']['bytes']     = (bool) ($thisfile_mpeg_audio['xing_flags_raw'] &amp; 0x00000002);
+				$thisfile_mpeg_audio['xing_flags']['toc']       = (bool) ($thisfile_mpeg_audio['xing_flags_raw'] &amp; 0x00000004);
+				$thisfile_mpeg_audio['xing_flags']['vbr_scale'] = (bool) ($thisfile_mpeg_audio['xing_flags_raw'] &amp; 0x00000008);
+
+				if ($thisfile_mpeg_audio['xing_flags']['frames']) {
+					$thisfile_mpeg_audio['VBR_frames'] = getid3_lib::BigEndian2Int(substr($headerstring, $VBRidOffset +  8, 4));
+					//$thisfile_mpeg_audio['VBR_frames']--; // don't count header Xing/Info frame
+				}
+				if ($thisfile_mpeg_audio['xing_flags']['bytes']) {
+					$thisfile_mpeg_audio['VBR_bytes']  = getid3_lib::BigEndian2Int(substr($headerstring, $VBRidOffset + 12, 4));
+				}
+
+				//if (($thisfile_mpeg_audio['bitrate'] == 'free') &amp;&amp; !empty($thisfile_mpeg_audio['VBR_frames']) &amp;&amp; !empty($thisfile_mpeg_audio['VBR_bytes'])) {
+				if (!empty($thisfile_mpeg_audio['VBR_frames']) &amp;&amp; !empty($thisfile_mpeg_audio['VBR_bytes'])) {
+
+					$framelengthfloat = $thisfile_mpeg_audio['VBR_bytes'] / $thisfile_mpeg_audio['VBR_frames'];
+
+					if ($thisfile_mpeg_audio['layer'] == '1') {
+						// BitRate = (((FrameLengthInBytes / 4) - Padding) * SampleRate) / 12
+						//$ThisFileInfo['audio']['bitrate'] = ((($framelengthfloat / 4) - intval($thisfile_mpeg_audio['padding'])) * $thisfile_mpeg_audio['sample_rate']) / 12;
+						$ThisFileInfo['audio']['bitrate'] = ($framelengthfloat / 4) * $thisfile_mpeg_audio['sample_rate'] * (2 / $ThisFileInfo['audio']['channels']) / 12;
+					} else {
+						// Bitrate = ((FrameLengthInBytes - Padding) * SampleRate) / 144
+						//$ThisFileInfo['audio']['bitrate'] = (($framelengthfloat - intval($thisfile_mpeg_audio['padding'])) * $thisfile_mpeg_audio['sample_rate']) / 144;
+						$ThisFileInfo['audio']['bitrate'] = $framelengthfloat * $thisfile_mpeg_audio['sample_rate'] * (2 / $ThisFileInfo['audio']['channels']) / 144;
+					}
+					$thisfile_mpeg_audio['framelength'] = floor($framelengthfloat);
+				}
+
+				if ($thisfile_mpeg_audio['xing_flags']['toc']) {
+					$LAMEtocData = substr($headerstring, $VBRidOffset + 16, 100);
+					for ($i = 0; $i &lt; 100; $i++) {
+						$thisfile_mpeg_audio['toc'][$i] = ord($LAMEtocData{$i});
+					}
+				}
+				if ($thisfile_mpeg_audio['xing_flags']['vbr_scale']) {
+					$thisfile_mpeg_audio['VBR_scale'] = getid3_lib::BigEndian2Int(substr($headerstring, $VBRidOffset + 116, 4));
+				}
+
+
+				// <A HREF="http://gabriel.mp3-tech.org/mp3infotag.html">http://gabriel.mp3-tech.org/mp3infotag.html</A>
+				if (substr($headerstring, $VBRidOffset + 120, 4) == 'LAME') {
+
+					// shortcut
+					$thisfile_mpeg_audio['LAME'] = array();
+					$thisfile_mpeg_audio_lame    = &amp;$thisfile_mpeg_audio['LAME'];
+
+
+					$thisfile_mpeg_audio_lame['long_version']  = substr($headerstring, $VBRidOffset + 120, 20);
+					$thisfile_mpeg_audio_lame['short_version'] = substr($thisfile_mpeg_audio_lame['long_version'], 0, 9);
+
+					if ($thisfile_mpeg_audio_lame['short_version'] &gt;= 'LAME3.90') {
+
+						// extra 11 chars are not part of version string when LAMEtag present
+						unset($thisfile_mpeg_audio_lame['long_version']);
+
+						// It the LAME tag was only introduced in LAME v3.90
+						// <A HREF="http://www.hydrogenaudio.org/?act=ST&amp;f=15&amp;t=9933">http://www.hydrogenaudio.org/?act=ST&amp;f=15&amp;t=9933</A>
+
+						// Offsets of various bytes in <A HREF="http://gabriel.mp3-tech.org/mp3infotag.html">http://gabriel.mp3-tech.org/mp3infotag.html</A>
+						// are assuming a 'Xing' identifier offset of 0x24, which is the case for
+						// MPEG-1 non-mono, but not for other combinations
+						$LAMEtagOffsetContant = $VBRidOffset - 0x24;
+
+						// shortcuts
+						$thisfile_mpeg_audio_lame['RGAD']    = array('track'=&gt;array(), 'album'=&gt;array());
+						$thisfile_mpeg_audio_lame_RGAD       = &amp;$thisfile_mpeg_audio_lame['RGAD'];
+						$thisfile_mpeg_audio_lame_RGAD_track = &amp;$thisfile_mpeg_audio_lame_RGAD['track'];
+						$thisfile_mpeg_audio_lame_RGAD_album = &amp;$thisfile_mpeg_audio_lame_RGAD['album'];
+						$thisfile_mpeg_audio_lame['raw'] = array();
+						$thisfile_mpeg_audio_lame_raw    = &amp;$thisfile_mpeg_audio_lame['raw'];
+
+						// byte $9B  VBR Quality
+						// This field is there to indicate a quality level, although the scale was not precised in the original Xing specifications.
+						// Actually overwrites original Xing bytes
+						unset($thisfile_mpeg_audio['VBR_scale']);
+						$thisfile_mpeg_audio_lame['vbr_quality'] = getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0x9B, 1));
+
+						// bytes $9C-$A4  Encoder short VersionString
+						$thisfile_mpeg_audio_lame['short_version'] = substr($headerstring, $LAMEtagOffsetContant + 0x9C, 9);
+
+						// byte $A5  Info Tag revision + VBR method
+						$LAMEtagRevisionVBRmethod = getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xA5, 1));
+
+						$thisfile_mpeg_audio_lame['tag_revision']      = ($LAMEtagRevisionVBRmethod &amp; 0xF0) &gt;&gt; 4;
+						$thisfile_mpeg_audio_lame_raw['vbr_method'] =  $LAMEtagRevisionVBRmethod &amp; 0x0F;
+						$thisfile_mpeg_audio_lame['vbr_method']        = getid3_mp3::LAMEvbrMethodLookup($thisfile_mpeg_audio_lame_raw['vbr_method']);
+						$thisfile_mpeg_audio['bitrate_mode']           = substr($thisfile_mpeg_audio_lame['vbr_method'], 0, 3); // usually either 'cbr' or 'vbr', but truncates 'vbr-old / vbr-rh' to 'vbr'
+
+						// byte $A6  Lowpass filter value
+						$thisfile_mpeg_audio_lame['lowpass_frequency'] = getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xA6, 1)) * 100;
+
+						// bytes $A7-$AE  Replay Gain
+						// <A HREF="http://privatewww.essex.ac.uk/~djmrob/replaygain/rg_data_format.html">http://privatewww.essex.ac.uk/~djmrob/replaygain/rg_data_format.html</A>
+						// bytes $A7-$AA : 32 bit floating point &quot;Peak signal amplitude&quot;
+						if ($thisfile_mpeg_audio_lame['short_version'] &gt;= 'LAME3.94b') {
+							// LAME 3.94a16 and later - 9.23 fixed point
+							// ie 0x0059E2EE / (2^23) = 5890798 / 8388608 = 0.7022378444671630859375
+							$thisfile_mpeg_audio_lame_RGAD['peak_amplitude'] = (float) ((getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xA7, 4))) / 8388608);
+						} else {
+							// LAME 3.94a15 and earlier - 32-bit floating point
+							// Actually 3.94a16 will fall in here too and be WRONG, but is hard to detect 3.94a16 vs 3.94a15
+							$thisfile_mpeg_audio_lame_RGAD['peak_amplitude'] = getid3_lib::LittleEndian2Float(substr($headerstring, $LAMEtagOffsetContant + 0xA7, 4));
+						}
+						if ($thisfile_mpeg_audio_lame_RGAD['peak_amplitude'] == 0) {
+							unset($thisfile_mpeg_audio_lame_RGAD['peak_amplitude']);
+						} else {
+							$thisfile_mpeg_audio_lame_RGAD['peak_db'] = getid3_lib::RGADamplitude2dB($thisfile_mpeg_audio_lame_RGAD['peak_amplitude']);
+						}
+
+						$thisfile_mpeg_audio_lame_raw['RGAD_track']      =   getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xAB, 2));
+						$thisfile_mpeg_audio_lame_raw['RGAD_album']      =   getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xAD, 2));
+
+
+						if ($thisfile_mpeg_audio_lame_raw['RGAD_track'] != 0) {
+
+							$thisfile_mpeg_audio_lame_RGAD_track['raw']['name']        = ($thisfile_mpeg_audio_lame_raw['RGAD_track'] &amp; 0xE000) &gt;&gt; 13;
+							$thisfile_mpeg_audio_lame_RGAD_track['raw']['originator']  = ($thisfile_mpeg_audio_lame_raw['RGAD_track'] &amp; 0x1C00) &gt;&gt; 10;
+							$thisfile_mpeg_audio_lame_RGAD_track['raw']['sign_bit']    = ($thisfile_mpeg_audio_lame_raw['RGAD_track'] &amp; 0x0200) &gt;&gt; 9;
+							$thisfile_mpeg_audio_lame_RGAD_track['raw']['gain_adjust'] =  $thisfile_mpeg_audio_lame_raw['RGAD_track'] &amp; 0x01FF;
+							$thisfile_mpeg_audio_lame_RGAD_track['name']       = getid3_lib::RGADnameLookup($thisfile_mpeg_audio_lame_RGAD_track['raw']['name']);
+							$thisfile_mpeg_audio_lame_RGAD_track['originator'] = getid3_lib::RGADoriginatorLookup($thisfile_mpeg_audio_lame_RGAD_track['raw']['originator']);
+							$thisfile_mpeg_audio_lame_RGAD_track['gain_db']    = getid3_lib::RGADadjustmentLookup($thisfile_mpeg_audio_lame_RGAD_track['raw']['gain_adjust'], $thisfile_mpeg_audio_lame_RGAD_track['raw']['sign_bit']);
+
+							if (!empty($thisfile_mpeg_audio_lame_RGAD['peak_amplitude'])) {
+								$ThisFileInfo['replay_gain']['track']['peak']   = $thisfile_mpeg_audio_lame_RGAD['peak_amplitude'];
+							}
+							$ThisFileInfo['replay_gain']['track']['originator'] = $thisfile_mpeg_audio_lame_RGAD_track['originator'];
+							$ThisFileInfo['replay_gain']['track']['adjustment'] = $thisfile_mpeg_audio_lame_RGAD_track['gain_db'];
+						} else {
+							unset($thisfile_mpeg_audio_lame_RGAD['track']);
+						}
+						if ($thisfile_mpeg_audio_lame_raw['RGAD_album'] != 0) {
+
+							$thisfile_mpeg_audio_lame_RGAD_album['raw']['name']        = ($thisfile_mpeg_audio_lame_raw['RGAD_album'] &amp; 0xE000) &gt;&gt; 13;
+							$thisfile_mpeg_audio_lame_RGAD_album['raw']['originator']  = ($thisfile_mpeg_audio_lame_raw['RGAD_album'] &amp; 0x1C00) &gt;&gt; 10;
+							$thisfile_mpeg_audio_lame_RGAD_album['raw']['sign_bit']    = ($thisfile_mpeg_audio_lame_raw['RGAD_album'] &amp; 0x0200) &gt;&gt; 9;
+							$thisfile_mpeg_audio_lame_RGAD_album['raw']['gain_adjust'] = $thisfile_mpeg_audio_lame_raw['RGAD_album'] &amp; 0x01FF;
+							$thisfile_mpeg_audio_lame_RGAD_album['name']       = getid3_lib::RGADnameLookup($thisfile_mpeg_audio_lame_RGAD_album['raw']['name']);
+							$thisfile_mpeg_audio_lame_RGAD_album['originator'] = getid3_lib::RGADoriginatorLookup($thisfile_mpeg_audio_lame_RGAD_album['raw']['originator']);
+							$thisfile_mpeg_audio_lame_RGAD_album['gain_db']    = getid3_lib::RGADadjustmentLookup($thisfile_mpeg_audio_lame_RGAD_album['raw']['gain_adjust'], $thisfile_mpeg_audio_lame_RGAD_album['raw']['sign_bit']);
+
+							if (!empty($thisfile_mpeg_audio_lame_RGAD['peak_amplitude'])) {
+								$ThisFileInfo['replay_gain']['album']['peak']   = $thisfile_mpeg_audio_lame_RGAD['peak_amplitude'];
+							}
+							$ThisFileInfo['replay_gain']['album']['originator'] = $thisfile_mpeg_audio_lame_RGAD_album['originator'];
+							$ThisFileInfo['replay_gain']['album']['adjustment'] = $thisfile_mpeg_audio_lame_RGAD_album['gain_db'];
+						} else {
+							unset($thisfile_mpeg_audio_lame_RGAD['album']);
+						}
+						if (empty($thisfile_mpeg_audio_lame_RGAD)) {
+							unset($thisfile_mpeg_audio_lame['RGAD']);
+						}
+
+
+						// byte $AF  Encoding flags + ATH Type
+						$EncodingFlagsATHtype = getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xAF, 1));
+						$thisfile_mpeg_audio_lame['encoding_flags']['nspsytune']   = (bool) ($EncodingFlagsATHtype &amp; 0x10);
+						$thisfile_mpeg_audio_lame['encoding_flags']['nssafejoint'] = (bool) ($EncodingFlagsATHtype &amp; 0x20);
+						$thisfile_mpeg_audio_lame['encoding_flags']['nogap_next']  = (bool) ($EncodingFlagsATHtype &amp; 0x40);
+						$thisfile_mpeg_audio_lame['encoding_flags']['nogap_prev']  = (bool) ($EncodingFlagsATHtype &amp; 0x80);
+						$thisfile_mpeg_audio_lame['ath_type']                      =         $EncodingFlagsATHtype &amp; 0x0F;
+
+						// byte $B0  if ABR {specified bitrate} else {minimal bitrate}
+						$thisfile_mpeg_audio_lame['raw']['abrbitrate_minbitrate'] = getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xB0, 1));
+						if ($thisfile_mpeg_audio_lame_raw['vbr_method'] == 2) { // Average BitRate (ABR)
+							$thisfile_mpeg_audio_lame['bitrate_abr'] = $thisfile_mpeg_audio_lame['raw']['abrbitrate_minbitrate'];
+						} elseif ($thisfile_mpeg_audio_lame_raw['vbr_method'] == 1) { // Constant BitRate (CBR)
+							// ignore
+						} elseif ($thisfile_mpeg_audio_lame['raw']['abrbitrate_minbitrate'] &gt; 0) { // Variable BitRate (VBR) - minimum bitrate
+							$thisfile_mpeg_audio_lame['bitrate_min'] = $thisfile_mpeg_audio_lame['raw']['abrbitrate_minbitrate'];
+						}
+
+						// bytes $B1-$B3  Encoder delays
+						$EncoderDelays = getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xB1, 3));
+						$thisfile_mpeg_audio_lame['encoder_delay'] = ($EncoderDelays &amp; 0xFFF000) &gt;&gt; 12;
+						$thisfile_mpeg_audio_lame['end_padding']   =  $EncoderDelays &amp; 0x000FFF;
+
+						// byte $B4  Misc
+						$MiscByte = getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xB4, 1));
+						$thisfile_mpeg_audio_lame_raw['noise_shaping']       = ($MiscByte &amp; 0x03);
+						$thisfile_mpeg_audio_lame_raw['stereo_mode']         = ($MiscByte &amp; 0x1C) &gt;&gt; 2;
+						$thisfile_mpeg_audio_lame_raw['not_optimal_quality'] = ($MiscByte &amp; 0x20) &gt;&gt; 5;
+						$thisfile_mpeg_audio_lame_raw['source_sample_freq']  = ($MiscByte &amp; 0xC0) &gt;&gt; 6;
+						$thisfile_mpeg_audio_lame['noise_shaping']       = $thisfile_mpeg_audio_lame_raw['noise_shaping'];
+						$thisfile_mpeg_audio_lame['stereo_mode']         = getid3_mp3::LAMEmiscStereoModeLookup($thisfile_mpeg_audio_lame_raw['stereo_mode']);
+						$thisfile_mpeg_audio_lame['not_optimal_quality'] = (bool) $thisfile_mpeg_audio_lame_raw['not_optimal_quality'];
+						$thisfile_mpeg_audio_lame['source_sample_freq']  = getid3_mp3::LAMEmiscSourceSampleFrequencyLookup($thisfile_mpeg_audio_lame_raw['source_sample_freq']);
+
+						// byte $B5  MP3 Gain
+						$thisfile_mpeg_audio_lame_raw['mp3_gain'] = getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xB5, 1), false, true);
+						$thisfile_mpeg_audio_lame['mp3_gain_db']     = (getid3_lib::RGADamplitude2dB(2) / 4) * $thisfile_mpeg_audio_lame_raw['mp3_gain'];
+						$thisfile_mpeg_audio_lame['mp3_gain_factor'] = pow(2, ($thisfile_mpeg_audio_lame['mp3_gain_db'] / 6));
+
+						// bytes $B6-$B7  Preset and surround info
+						$PresetSurroundBytes = getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xB6, 2));
+						// Reserved                                                    = ($PresetSurroundBytes &amp; 0xC000);
+						$thisfile_mpeg_audio_lame_raw['surround_info'] = ($PresetSurroundBytes &amp; 0x3800);
+						$thisfile_mpeg_audio_lame['surround_info']     = getid3_mp3::LAMEsurroundInfoLookup($thisfile_mpeg_audio_lame_raw['surround_info']);
+						$thisfile_mpeg_audio_lame['preset_used_id']    = ($PresetSurroundBytes &amp; 0x07FF);
+						$thisfile_mpeg_audio_lame['preset_used']       = getid3_mp3::LAMEpresetUsedLookup($thisfile_mpeg_audio_lame);
+						if (!empty($thisfile_mpeg_audio_lame['preset_used_id']) &amp;&amp; empty($thisfile_mpeg_audio_lame['preset_used'])) {
+							$ThisFileInfo['warning'][] = 'Unknown LAME preset used ('.$thisfile_mpeg_audio_lame['preset_used_id'].') - please report to <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>';
+						}
+						if (($thisfile_mpeg_audio_lame['short_version'] == 'LAME3.90.') &amp;&amp; !empty($thisfile_mpeg_audio_lame['preset_used_id'])) {
+							// this may change if 3.90.4 ever comes out
+							$thisfile_mpeg_audio_lame['short_version'] = 'LAME3.90.3';
+						}
+
+						// bytes $B8-$BB  MusicLength
+						$thisfile_mpeg_audio_lame['audio_bytes'] = getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xB8, 4));
+						$ExpectedNumberOfAudioBytes = (($thisfile_mpeg_audio_lame['audio_bytes'] &gt; 0) ? $thisfile_mpeg_audio_lame['audio_bytes'] : $thisfile_mpeg_audio['VBR_bytes']);
+
+						// bytes $BC-$BD  MusicCRC
+						$thisfile_mpeg_audio_lame['music_crc']    = getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xBC, 2));
+
+						// bytes $BE-$BF  CRC-16 of Info Tag
+						$thisfile_mpeg_audio_lame['lame_tag_crc'] = getid3_lib::BigEndian2Int(substr($headerstring, $LAMEtagOffsetContant + 0xBE, 2));
+
+
+						// LAME CBR
+						if ($thisfile_mpeg_audio_lame_raw['vbr_method'] == 1) {
+
+							$thisfile_mpeg_audio['bitrate_mode'] = 'cbr';
+							$thisfile_mpeg_audio['bitrate'] = getid3_mp3::ClosestStandardMP3Bitrate($thisfile_mpeg_audio['bitrate']);
+							$ThisFileInfo['audio']['bitrate'] = $thisfile_mpeg_audio['bitrate'];
+							//if (empty($thisfile_mpeg_audio['bitrate']) || (!empty($thisfile_mpeg_audio_lame['bitrate_min']) &amp;&amp; ($thisfile_mpeg_audio_lame['bitrate_min'] != 255))) {
+							//	$thisfile_mpeg_audio['bitrate'] = $thisfile_mpeg_audio_lame['bitrate_min'];
+							//}
+
+						}
+
+					}
+				}
+
+			} else {
+
+				// not Fraunhofer or Xing VBR methods, most likely CBR (but could be VBR with no header)
+				$thisfile_mpeg_audio['bitrate_mode'] = 'cbr';
+				if ($recursivesearch) {
+					$thisfile_mpeg_audio['bitrate_mode'] = 'vbr';
+					if (getid3_mp3::RecursiveFrameScanning($fd, $ThisFileInfo, $offset, $nextframetestoffset, true)) {
+						$recursivesearch = false;
+						$thisfile_mpeg_audio['bitrate_mode'] = 'cbr';
+					}
+					if ($thisfile_mpeg_audio['bitrate_mode'] == 'vbr') {
+						$ThisFileInfo['warning'][] = 'VBR file with no VBR header. Bitrate values calculated from actual frame bitrates.';
+					}
+				}
+
+			}
+
+		}
+
+		if (($ExpectedNumberOfAudioBytes &gt; 0) &amp;&amp; ($ExpectedNumberOfAudioBytes != ($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']))) {
+			if ($ExpectedNumberOfAudioBytes &gt; ($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset'])) {
+				if (($ExpectedNumberOfAudioBytes - ($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset'])) == 1) {
+					$ThisFileInfo['warning'][] = 'Last byte of data truncated (this is a known bug in Meracl ID3 Tag Writer before v1.3.5)';
+				} else {
+					$ThisFileInfo['warning'][] = 'Probable truncated file: expecting '.$ExpectedNumberOfAudioBytes.' bytes of audio data, only found '.($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']).' (short by '.($ExpectedNumberOfAudioBytes - ($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset'])).' bytes)';
+				}
+			} else {
+				if ((($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) - $ExpectedNumberOfAudioBytes) == 1) {
+				//	$prenullbytefileoffset = ftell($fd);
+				//	fseek($fd, $ThisFileInfo['avdataend'], SEEK_SET);
+				//	$PossibleNullByte = fread($fd, 1);
+				//	fseek($fd, $prenullbytefileoffset, SEEK_SET);
+				//	if ($PossibleNullByte === &quot;\x00&quot;) {
+						$ThisFileInfo['avdataend']--;
+				//		$ThisFileInfo['warning'][] = 'Extra null byte at end of MP3 data assumed to be RIFF padding and therefore ignored';
+				//	} else {
+				//		$ThisFileInfo['warning'][] = 'Too much data in file: expecting '.$ExpectedNumberOfAudioBytes.' bytes of audio data, found '.($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']).' ('.(($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) - $ExpectedNumberOfAudioBytes).' bytes too many)';
+				//	}
+				} else {
+					$ThisFileInfo['warning'][] = 'Too much data in file: expecting '.$ExpectedNumberOfAudioBytes.' bytes of audio data, found '.($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']).' ('.(($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) - $ExpectedNumberOfAudioBytes).' bytes too many)';
+				}
+			}
+		}
+
+		if (($thisfile_mpeg_audio['bitrate'] == 'free') &amp;&amp; empty($ThisFileInfo['audio']['bitrate'])) {
+			if (($offset == $ThisFileInfo['avdataoffset']) &amp;&amp; empty($thisfile_mpeg_audio['VBR_frames'])) {
+				$framebytelength = getid3_mp3::FreeFormatFrameLength($fd, $offset, $ThisFileInfo, true);
+				if ($framebytelength &gt; 0) {
+					$thisfile_mpeg_audio['framelength'] = $framebytelength;
+					if ($thisfile_mpeg_audio['layer'] == '1') {
+						// BitRate = (((FrameLengthInBytes / 4) - Padding) * SampleRate) / 12
+						$ThisFileInfo['audio']['bitrate'] = ((($framebytelength / 4) - intval($thisfile_mpeg_audio['padding'])) * $thisfile_mpeg_audio['sample_rate']) / 12;
+					} else {
+						// Bitrate = ((FrameLengthInBytes - Padding) * SampleRate) / 144
+						$ThisFileInfo['audio']['bitrate'] = (($framebytelength - intval($thisfile_mpeg_audio['padding'])) * $thisfile_mpeg_audio['sample_rate']) / 144;
+					}
+				} else {
+					$ThisFileInfo['error'][] = 'Error calculating frame length of free-format MP3 without Xing/LAME header';
+				}
+			}
+		}
+
+		if (!empty($thisfile_mpeg_audio['VBR_frames'])) {
+			switch ($thisfile_mpeg_audio['bitrate_mode']) {
+				case 'vbr':
+				case 'abr':
+					if (($thisfile_mpeg_audio['version'] == '1') &amp;&amp; ($thisfile_mpeg_audio['layer'] == 1)) {
+						$thisfile_mpeg_audio['VBR_bitrate'] = (($thisfile_mpeg_audio['VBR_bytes'] / $thisfile_mpeg_audio['VBR_frames']) * 8) * ($ThisFileInfo['audio']['sample_rate'] / 384);
+					} elseif ((($thisfile_mpeg_audio['version'] == '2') || ($thisfile_mpeg_audio['version'] == '2.5')) &amp;&amp; ($thisfile_mpeg_audio['layer'] == 3)) {
+						$thisfile_mpeg_audio['VBR_bitrate'] = (($thisfile_mpeg_audio['VBR_bytes'] / $thisfile_mpeg_audio['VBR_frames']) * 8) * ($ThisFileInfo['audio']['sample_rate'] / 576);
+					} else {
+						$thisfile_mpeg_audio['VBR_bitrate'] = (($thisfile_mpeg_audio['VBR_bytes'] / $thisfile_mpeg_audio['VBR_frames']) * 8) * ($ThisFileInfo['audio']['sample_rate'] / 1152);
+					}
+					if ($thisfile_mpeg_audio['VBR_bitrate'] &gt; 0) {
+						$ThisFileInfo['audio']['bitrate']         = $thisfile_mpeg_audio['VBR_bitrate'];
+						$thisfile_mpeg_audio['bitrate'] = $thisfile_mpeg_audio['VBR_bitrate']; // to avoid confusion
+					}
+					break;
+			}
+		}
+
+		// End variable-bitrate headers
+		////////////////////////////////////////////////////////////////////////////////////
+
+		if ($recursivesearch) {
+
+			if (!getid3_mp3::RecursiveFrameScanning($fd, $ThisFileInfo, $offset, $nextframetestoffset, $ScanAsCBR)) {
+				return false;
+			}
+
+		}
+
+
+		//if (false) {
+		//    // experimental side info parsing section - not returning anything useful yet
+		//
+		//    $SideInfoBitstream = getid3_lib::BigEndian2Bin($SideInfoData);
+		//    $SideInfoOffset = 0;
+		//
+		//    if ($thisfile_mpeg_audio['version'] == '1') {
+		//        if ($thisfile_mpeg_audio['channelmode'] == 'mono') {
+		//            // MPEG-1 (mono)
+		//            $thisfile_mpeg_audio['side_info']['main_data_begin'] = substr($SideInfoBitstream, $SideInfoOffset, 9);
+		//            $SideInfoOffset += 9;
+		//            $SideInfoOffset += 5;
+		//        } else {
+		//            // MPEG-1 (stereo, joint-stereo, dual-channel)
+		//            $thisfile_mpeg_audio['side_info']['main_data_begin'] = substr($SideInfoBitstream, $SideInfoOffset, 9);
+		//            $SideInfoOffset += 9;
+		//            $SideInfoOffset += 3;
+		//        }
+		//    } else { // 2 or 2.5
+		//        if ($thisfile_mpeg_audio['channelmode'] == 'mono') {
+		//            // MPEG-2, MPEG-2.5 (mono)
+		//            $thisfile_mpeg_audio['side_info']['main_data_begin'] = substr($SideInfoBitstream, $SideInfoOffset, 8);
+		//            $SideInfoOffset += 8;
+		//            $SideInfoOffset += 1;
+		//        } else {
+		//            // MPEG-2, MPEG-2.5 (stereo, joint-stereo, dual-channel)
+		//            $thisfile_mpeg_audio['side_info']['main_data_begin'] = substr($SideInfoBitstream, $SideInfoOffset, 8);
+		//            $SideInfoOffset += 8;
+		//            $SideInfoOffset += 2;
+		//        }
+		//    }
+		//
+		//    if ($thisfile_mpeg_audio['version'] == '1') {
+		//        for ($channel = 0; $channel &lt; $ThisFileInfo['audio']['channels']; $channel++) {
+		//            for ($scfsi_band = 0; $scfsi_band &lt; 4; $scfsi_band++) {
+		//                $thisfile_mpeg_audio['scfsi'][$channel][$scfsi_band] = substr($SideInfoBitstream, $SideInfoOffset, 1);
+		//                $SideInfoOffset += 2;
+		//            }
+		//        }
+		//    }
+		//    for ($granule = 0; $granule &lt; (($thisfile_mpeg_audio['version'] == '1') ? 2 : 1); $granule++) {
+		//        for ($channel = 0; $channel &lt; $ThisFileInfo['audio']['channels']; $channel++) {
+		//            $thisfile_mpeg_audio['part2_3_length'][$granule][$channel] = substr($SideInfoBitstream, $SideInfoOffset, 12);
+		//            $SideInfoOffset += 12;
+		//            $thisfile_mpeg_audio['big_values'][$granule][$channel] = substr($SideInfoBitstream, $SideInfoOffset, 9);
+		//            $SideInfoOffset += 9;
+		//            $thisfile_mpeg_audio['global_gain'][$granule][$channel] = substr($SideInfoBitstream, $SideInfoOffset, 8);
+		//            $SideInfoOffset += 8;
+		//            if ($thisfile_mpeg_audio['version'] == '1') {
+		//                $thisfile_mpeg_audio['scalefac_compress'][$granule][$channel] = substr($SideInfoBitstream, $SideInfoOffset, 4);
+		//                $SideInfoOffset += 4;
+		//            } else {
+		//                $thisfile_mpeg_audio['scalefac_compress'][$granule][$channel] = substr($SideInfoBitstream, $SideInfoOffset, 9);
+		//                $SideInfoOffset += 9;
+		//            }
+		//            $thisfile_mpeg_audio['window_switching_flag'][$granule][$channel] = substr($SideInfoBitstream, $SideInfoOffset, 1);
+		//            $SideInfoOffset += 1;
+		//
+		//            if ($thisfile_mpeg_audio['window_switching_flag'][$granule][$channel] == '1') {
+		//
+		//                $thisfile_mpeg_audio['block_type'][$granule][$channel] = substr($SideInfoBitstream, $SideInfoOffset, 2);
+		//                $SideInfoOffset += 2;
+		//                $thisfile_mpeg_audio['mixed_block_flag'][$granule][$channel] = substr($SideInfoBitstream, $SideInfoOffset, 1);
+		//                $SideInfoOffset += 1;
+		//
+		//                for ($region = 0; $region &lt; 2; $region++) {
+		//                    $thisfile_mpeg_audio['table_select'][$granule][$channel][$region] = substr($SideInfoBitstream, $SideInfoOffset, 5);
+		//                    $SideInfoOffset += 5;
+		//                }
+		//                $thisfile_mpeg_audio['table_select'][$granule][$channel][2] = 0;
+		//
+		//                for ($window = 0; $window &lt; 3; $window++) {
+		//                    $thisfile_mpeg_audio['subblock_gain'][$granule][$channel][$window] = substr($SideInfoBitstream, $SideInfoOffset, 3);
+		//                    $SideInfoOffset += 3;
+		//                }
+		//
+		//            } else {
+		//
+		//                for ($region = 0; $region &lt; 3; $region++) {
+		//                    $thisfile_mpeg_audio['table_select'][$granule][$channel][$region] = substr($SideInfoBitstream, $SideInfoOffset, 5);
+		//                    $SideInfoOffset += 5;
+		//                }
+		//
+		//                $thisfile_mpeg_audio['region0_count'][$granule][$channel] = substr($SideInfoBitstream, $SideInfoOffset, 4);
+		//                $SideInfoOffset += 4;
+		//                $thisfile_mpeg_audio['region1_count'][$granule][$channel] = substr($SideInfoBitstream, $SideInfoOffset, 3);
+		//                $SideInfoOffset += 3;
+		//                $thisfile_mpeg_audio['block_type'][$granule][$channel] = 0;
+		//            }
+		//
+		//            if ($thisfile_mpeg_audio['version'] == '1') {
+		//                $thisfile_mpeg_audio['preflag'][$granule][$channel] = substr($SideInfoBitstream, $SideInfoOffset, 1);
+		//                $SideInfoOffset += 1;
+		//            }
+		//            $thisfile_mpeg_audio['scalefac_scale'][$granule][$channel] = substr($SideInfoBitstream, $SideInfoOffset, 1);
+		//            $SideInfoOffset += 1;
+		//            $thisfile_mpeg_audio['count1table_select'][$granule][$channel] = substr($SideInfoBitstream, $SideInfoOffset, 1);
+		//            $SideInfoOffset += 1;
+		//        }
+		//    }
+		//}
+
+		return true;
+	}
+
+	function RecursiveFrameScanning(&amp;$fd, &amp;$ThisFileInfo, &amp;$offset, &amp;$nextframetestoffset, $ScanAsCBR) {
+		for ($i = 0; $i &lt; GETID3_MP3_VALID_CHECK_FRAMES; $i++) {
+			// check next GETID3_MP3_VALID_CHECK_FRAMES frames for validity, to make sure we haven't run across a false synch
+			if (($nextframetestoffset + 4) &gt;= $ThisFileInfo['avdataend']) {
+				// end of file
+				return true;
+			}
+
+			$nextframetestarray = array('error'=&gt;'', 'warning'=&gt;'', 'avdataend'=&gt;$ThisFileInfo['avdataend'], 'avdataoffset'=&gt;$ThisFileInfo['avdataoffset']);
+			if (getid3_mp3::decodeMPEGaudioHeader($fd, $nextframetestoffset, $nextframetestarray, false)) {
+				if ($ScanAsCBR) {
+					// force CBR mode, used for trying to pick out invalid audio streams with
+					// valid(?) VBR headers, or VBR streams with no VBR header
+					if (!isset($nextframetestarray['mpeg']['audio']['bitrate']) || !isset($ThisFileInfo['mpeg']['audio']['bitrate']) || ($nextframetestarray['mpeg']['audio']['bitrate'] != $ThisFileInfo['mpeg']['audio']['bitrate'])) {
+						return false;
+					}
+				}
+
+
+				// next frame is OK, get ready to check the one after that
+				if (isset($nextframetestarray['mpeg']['audio']['framelength']) &amp;&amp; ($nextframetestarray['mpeg']['audio']['framelength'] &gt; 0)) {
+					$nextframetestoffset += $nextframetestarray['mpeg']['audio']['framelength'];
+				} else {
+					$ThisFileInfo['error'][] = 'Frame at offset ('.$offset.') is has an invalid frame length.';
+					return false;
+				}
+
+			} else {
+
+				// next frame is not valid, note the error and fail, so scanning can contiue for a valid frame sequence
+				$ThisFileInfo['error'][] = 'Frame at offset ('.$offset.') is valid, but the next one at ('.$nextframetestoffset.') is not.';
+
+				return false;
+			}
+		}
+		return true;
+	}
+
+	function FreeFormatFrameLength($fd, $offset, &amp;$ThisFileInfo, $deepscan=false) {
+		fseek($fd, $offset, SEEK_SET);
+		$MPEGaudioData = fread($fd, 32768);
+
+		$SyncPattern1 = substr($MPEGaudioData, 0, 4);
+		// may be different pattern due to padding
+		$SyncPattern2 = $SyncPattern1{0}.$SyncPattern1{1}.chr(ord($SyncPattern1{2}) | 0x02).$SyncPattern1{3};
+		if ($SyncPattern2 === $SyncPattern1) {
+			$SyncPattern2 = $SyncPattern1{0}.$SyncPattern1{1}.chr(ord($SyncPattern1{2}) &amp; 0xFD).$SyncPattern1{3};
+		}
+
+		$framelength = false;
+		$framelength1 = strpos($MPEGaudioData, $SyncPattern1, 4);
+		$framelength2 = strpos($MPEGaudioData, $SyncPattern2, 4);
+		if ($framelength1 &gt; 4) {
+			$framelength = $framelength1;
+		}
+		if (($framelength2 &gt; 4) &amp;&amp; ($framelength2 &lt; $framelength1)) {
+			$framelength = $framelength2;
+		}
+		if (!$framelength) {
+
+			// LAME 3.88 has a different value for modeextension on the first frame vs the rest
+			$framelength1 = strpos($MPEGaudioData, substr($SyncPattern1, 0, 3), 4);
+			$framelength2 = strpos($MPEGaudioData, substr($SyncPattern2, 0, 3), 4);
+
+			if ($framelength1 &gt; 4) {
+				$framelength = $framelength1;
+			}
+			if (($framelength2 &gt; 4) &amp;&amp; ($framelength2 &lt; $framelength1)) {
+				$framelength = $framelength2;
+			}
+			if (!$framelength) {
+				$ThisFileInfo['error'][] = 'Cannot find next free-format synch pattern ('.getid3_lib::PrintHexBytes($SyncPattern1).' or '.getid3_lib::PrintHexBytes($SyncPattern2).') after offset '.$offset;
+				return false;
+			} else {
+				$ThisFileInfo['warning'][] = 'ModeExtension varies between first frame and other frames (known free-format issue in LAME 3.88)';
+				$ThisFileInfo['audio']['codec']   = 'LAME';
+				$ThisFileInfo['audio']['encoder'] = 'LAME3.88';
+				$SyncPattern1 = substr($SyncPattern1, 0, 3);
+				$SyncPattern2 = substr($SyncPattern2, 0, 3);
+			}
+		}
+
+		if ($deepscan) {
+
+			$ActualFrameLengthValues = array();
+			$nextoffset = $offset + $framelength;
+			while ($nextoffset &lt; ($ThisFileInfo['avdataend'] - 6)) {
+				fseek($fd, $nextoffset - 1, SEEK_SET);
+				$NextSyncPattern = fread($fd, 6);
+				if ((substr($NextSyncPattern, 1, strlen($SyncPattern1)) == $SyncPattern1) || (substr($NextSyncPattern, 1, strlen($SyncPattern2)) == $SyncPattern2)) {
+					// good - found where expected
+					$ActualFrameLengthValues[] = $framelength;
+				} elseif ((substr($NextSyncPattern, 0, strlen($SyncPattern1)) == $SyncPattern1) || (substr($NextSyncPattern, 0, strlen($SyncPattern2)) == $SyncPattern2)) {
+					// ok - found one byte earlier than expected (last frame wasn't padded, first frame was)
+					$ActualFrameLengthValues[] = ($framelength - 1);
+					$nextoffset--;
+				} elseif ((substr($NextSyncPattern, 2, strlen($SyncPattern1)) == $SyncPattern1) || (substr($NextSyncPattern, 2, strlen($SyncPattern2)) == $SyncPattern2)) {
+					// ok - found one byte later than expected (last frame was padded, first frame wasn't)
+					$ActualFrameLengthValues[] = ($framelength + 1);
+					$nextoffset++;
+				} else {
+					$ThisFileInfo['error'][] = 'Did not find expected free-format sync pattern at offset '.$nextoffset;
+					return false;
+				}
+				$nextoffset += $framelength;
+			}
+			if (count($ActualFrameLengthValues) &gt; 0) {
+				$framelength = intval(round(array_sum($ActualFrameLengthValues) / count($ActualFrameLengthValues)));
+			}
+		}
+		return $framelength;
+	}
+
+	function getOnlyMPEGaudioInfoBruteForce($fd, &amp;$ThisFileInfo) {
+
+		$MPEGaudioHeaderDecodeCache = array();
+		$MPEGaudioHeaderValidCache  = array();
+		$MPEGaudioHeaderLengthCache = array();
+		$MPEGaudioVersionLookup       = getid3_mp3::MPEGaudioVersionArray();
+		$MPEGaudioLayerLookup         = getid3_mp3::MPEGaudioLayerArray();
+		$MPEGaudioBitrateLookup       = getid3_mp3::MPEGaudioBitrateArray();
+		$MPEGaudioFrequencyLookup     = getid3_mp3::MPEGaudioFrequencyArray();
+		$MPEGaudioChannelModeLookup   = getid3_mp3::MPEGaudioChannelModeArray();
+		$MPEGaudioModeExtensionLookup = getid3_mp3::MPEGaudioModeExtensionArray();
+		$MPEGaudioEmphasisLookup      = getid3_mp3::MPEGaudioEmphasisArray();
+		$LongMPEGversionLookup   = array();
+		$LongMPEGlayerLookup     = array();
+		$LongMPEGbitrateLookup   = array();
+		$LongMPEGpaddingLookup   = array();
+		$LongMPEGfrequencyLookup = array();
+
+		$Distribution['bitrate']   = array();
+		$Distribution['frequency'] = array();
+		$Distribution['layer']     = array();
+		$Distribution['version']   = array();
+		$Distribution['padding']   = array();
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+
+		$previousvalidframe = $ThisFileInfo['avdataoffset'];
+		while (ftell($fd) &lt; $ThisFileInfo['avdataend']) {
+			set_time_limit(30);
+			$head4 = fread($fd, 4);
+			if (strlen($head4) &lt; 4) {
+				break;
+			}
+			if ($head4{0} != &quot;\xFF&quot;) {
+				for ($i = 1; $i &lt; 4; $i++) {
+					if ($head4{$i} == &quot;\xFF&quot;) {
+						fseek($fd, $i - 4, SEEK_CUR);
+						continue 2;
+					}
+				}
+				continue;
+			}
+			if (!isset($MPEGaudioHeaderDecodeCache[$head4])) {
+				$MPEGaudioHeaderDecodeCache[$head4] = getid3_mp3::MPEGaudioHeaderDecode($head4);
+			}
+			if (!isset($MPEGaudioHeaderValidCache[$head4])) {
+				$MPEGaudioHeaderValidCache[$head4] = getid3_mp3::MPEGaudioHeaderValid($MPEGaudioHeaderDecodeCache[$head4], false, false);
+			}
+			if ($MPEGaudioHeaderValidCache[$head4]) {
+
+				if (!isset($MPEGaudioHeaderLengthCache[$head4])) {
+					$LongMPEGversionLookup[$head4]   = $MPEGaudioVersionLookup[$MPEGaudioHeaderDecodeCache[$head4]['version']];
+					$LongMPEGlayerLookup[$head4]     = $MPEGaudioLayerLookup[$MPEGaudioHeaderDecodeCache[$head4]['layer']];
+					$LongMPEGbitrateLookup[$head4]   = $MPEGaudioBitrateLookup[$LongMPEGversionLookup[$head4]][$LongMPEGlayerLookup[$head4]][$MPEGaudioHeaderDecodeCache[$head4]['bitrate']];
+					$LongMPEGpaddingLookup[$head4]   = (bool) $MPEGaudioHeaderDecodeCache[$head4]['padding'];
+					$LongMPEGfrequencyLookup[$head4] = $MPEGaudioFrequencyLookup[$LongMPEGversionLookup[$head4]][$MPEGaudioHeaderDecodeCache[$head4]['sample_rate']];
+					$MPEGaudioHeaderLengthCache[$head4] = getid3_mp3::MPEGaudioFrameLength(
+						$LongMPEGbitrateLookup[$head4],
+						$LongMPEGversionLookup[$head4],
+						$LongMPEGlayerLookup[$head4],
+						$LongMPEGpaddingLookup[$head4],
+						$LongMPEGfrequencyLookup[$head4]);
+				}
+				if ($MPEGaudioHeaderLengthCache[$head4] &gt; 4) {
+					$WhereWeWere = ftell($fd);
+					fseek($fd, $MPEGaudioHeaderLengthCache[$head4] - 4, SEEK_CUR);
+					$next4 = fread($fd, 4);
+					if ($next4{0} == &quot;\xFF&quot;) {
+						if (!isset($MPEGaudioHeaderDecodeCache[$next4])) {
+							$MPEGaudioHeaderDecodeCache[$next4] = getid3_mp3::MPEGaudioHeaderDecode($next4);
+						}
+						if (!isset($MPEGaudioHeaderValidCache[$next4])) {
+							$MPEGaudioHeaderValidCache[$next4] = getid3_mp3::MPEGaudioHeaderValid($MPEGaudioHeaderDecodeCache[$next4], false, false);
+						}
+						if ($MPEGaudioHeaderValidCache[$next4]) {
+							fseek($fd, -4, SEEK_CUR);
+
+							@$Distribution['bitrate'][$LongMPEGbitrateLookup[$head4]]++;
+							@$Distribution['layer'][$LongMPEGlayerLookup[$head4]]++;
+							@$Distribution['version'][$LongMPEGversionLookup[$head4]]++;
+							@$Distribution['padding'][intval($LongMPEGpaddingLookup[$head4])]++;
+							@$Distribution['frequency'][$LongMPEGfrequencyLookup[$head4]]++;
+							continue;
+						}
+					}
+					unset($next4);
+					fseek($fd, $WhereWeWere - 3, SEEK_SET);
+				}
+
+			}
+		}
+		foreach ($Distribution as $key =&gt; $value) {
+			ksort($Distribution[$key], SORT_NUMERIC);
+		}
+		ksort($Distribution['version'], SORT_STRING);
+		$ThisFileInfo['mpeg']['audio']['bitrate_distribution']   = $Distribution['bitrate'];
+		$ThisFileInfo['mpeg']['audio']['frequency_distribution'] = $Distribution['frequency'];
+		$ThisFileInfo['mpeg']['audio']['layer_distribution']     = $Distribution['layer'];
+		$ThisFileInfo['mpeg']['audio']['version_distribution']   = $Distribution['version'];
+		$ThisFileInfo['mpeg']['audio']['padding_distribution']   = $Distribution['padding'];
+		if (count($Distribution['version']) &gt; 1) {
+			$ThisFileInfo['error'][] = 'Corrupt file - more than one MPEG version detected';
+		}
+		if (count($Distribution['layer']) &gt; 1) {
+			$ThisFileInfo['error'][] = 'Corrupt file - more than one MPEG layer detected';
+		}
+		if (count($Distribution['frequency']) &gt; 1) {
+			$ThisFileInfo['error'][] = 'Corrupt file - more than one MPEG sample rate detected';
+		}
+
+
+		$bittotal = 0;
+		foreach ($Distribution['bitrate'] as $bitratevalue =&gt; $bitratecount) {
+			if ($bitratevalue != 'free') {
+				$bittotal += ($bitratevalue * $bitratecount);
+			}
+		}
+		$ThisFileInfo['mpeg']['audio']['frame_count']  = array_sum($Distribution['bitrate']);
+		if ($ThisFileInfo['mpeg']['audio']['frame_count'] == 0) {
+			$ThisFileInfo['error'][] = 'no MPEG audio frames found';
+			return false;
+		}
+		$ThisFileInfo['mpeg']['audio']['bitrate']      = ($bittotal / $ThisFileInfo['mpeg']['audio']['frame_count']);
+		$ThisFileInfo['mpeg']['audio']['bitrate_mode'] = ((count($Distribution['bitrate']) &gt; 0) ? 'vbr' : 'cbr');
+		$ThisFileInfo['mpeg']['audio']['sample_rate']  = getid3_lib::array_max($Distribution['frequency'], true);
+
+		$ThisFileInfo['audio']['bitrate']      = $ThisFileInfo['mpeg']['audio']['bitrate'];
+		$ThisFileInfo['audio']['bitrate_mode'] = $ThisFileInfo['mpeg']['audio']['bitrate_mode'];
+		$ThisFileInfo['audio']['sample_rate']  = $ThisFileInfo['mpeg']['audio']['sample_rate'];
+		$ThisFileInfo['audio']['dataformat']   = 'mp'.getid3_lib::array_max($Distribution['layer'], true);
+		$ThisFileInfo['fileformat']            = $ThisFileInfo['audio']['dataformat'];
+
+		return true;
+	}
+
+
+	function getOnlyMPEGaudioInfo($fd, &amp;$ThisFileInfo, $avdataoffset, $BitrateHistogram=false) {
+		// looks for synch, decodes MPEG audio header
+
+		fseek($fd, $avdataoffset, SEEK_SET);
+		$header = '';
+		$SynchSeekOffset = 0;
+
+		static $MPEGaudioVersionLookup;
+		static $MPEGaudioLayerLookup;
+		static $MPEGaudioBitrateLookup;
+		if (empty($MPEGaudioVersionLookup)) {
+			$MPEGaudioVersionLookup = getid3_mp3::MPEGaudioVersionArray();
+			$MPEGaudioLayerLookup   = getid3_mp3::MPEGaudioLayerArray();
+			$MPEGaudioBitrateLookup = getid3_mp3::MPEGaudioBitrateArray();
+
+		}
+
+		$header_len = strlen($header) - intval(round(GETID3_FREAD_BUFFER_SIZE / 2));
+		while (true) {
+
+			if (($SynchSeekOffset &gt; $header_len) &amp;&amp; (($avdataoffset + $SynchSeekOffset)  &lt; $ThisFileInfo['avdataend']) &amp;&amp; !feof($fd)) {
+
+				if ($SynchSeekOffset &gt; 131072) {
+					// if a synch's not found within the first 128k bytes, then give up
+					$ThisFileInfo['error'][] = 'could not find valid MPEG audio synch within the first 128k bytes';
+					if (isset($ThisFileInfo['audio']['bitrate'])) {
+						unset($ThisFileInfo['audio']['bitrate']);
+					}
+					if (isset($ThisFileInfo['mpeg']['audio'])) {
+						unset($ThisFileInfo['mpeg']['audio']);
+					}
+					if (empty($ThisFileInfo['mpeg'])) {
+						unset($ThisFileInfo['mpeg']);
+					}
+					return false;
+
+				} elseif ($header .= fread($fd, GETID3_FREAD_BUFFER_SIZE)) {
+
+					// great
+					$header_len = strlen($header) - intval(round(GETID3_FREAD_BUFFER_SIZE / 2));
+
+				} else {
+
+					$ThisFileInfo['error'][] = 'could not find valid MPEG audio synch before end of file';
+					if (isset($ThisFileInfo['audio']['bitrate'])) {
+						unset($ThisFileInfo['audio']['bitrate']);
+					}
+					if (isset($ThisFileInfo['mpeg']['audio'])) {
+						unset($ThisFileInfo['mpeg']['audio']);
+					}
+					if (isset($ThisFileInfo['mpeg']) &amp;&amp; (!is_array($ThisFileInfo['mpeg']) || (count($ThisFileInfo['mpeg']) == 0))) {
+						unset($ThisFileInfo['mpeg']);
+					}
+					return false;
+
+				}
+			}
+
+			if (($SynchSeekOffset + 1) &gt;= strlen($header)) {
+				$ThisFileInfo['error'][] = 'could not find valid MPEG synch before end of file';
+				return false;
+			}
+
+			if (($header{$SynchSeekOffset} == &quot;\xFF&quot;) &amp;&amp; ($header{($SynchSeekOffset + 1)} &gt; &quot;\xE0&quot;)) { // synch detected
+
+				if (!isset($FirstFrameThisfileInfo) &amp;&amp; !isset($ThisFileInfo['mpeg']['audio'])) {
+					$FirstFrameThisfileInfo = $ThisFileInfo;
+					$FirstFrameAVDataOffset = $avdataoffset + $SynchSeekOffset;
+					if (!getid3_mp3::decodeMPEGaudioHeader($fd, $avdataoffset + $SynchSeekOffset, $FirstFrameThisfileInfo, false)) {
+						// if this is the first valid MPEG-audio frame, save it in case it's a VBR header frame and there's
+						// garbage between this frame and a valid sequence of MPEG-audio frames, to be restored below
+						unset($FirstFrameThisfileInfo);
+					}
+				}
+
+				$dummy = $ThisFileInfo; // only overwrite real data if valid header found
+				if (getid3_mp3::decodeMPEGaudioHeader($fd, $avdataoffset + $SynchSeekOffset, $dummy, true)) {
+					$ThisFileInfo = $dummy;
+					$ThisFileInfo['avdataoffset'] = $avdataoffset + $SynchSeekOffset;
+					switch ($ThisFileInfo['fileformat']) {
+						case '':
+						case 'id3':
+						case 'ape':
+						case 'mp3':
+							$ThisFileInfo['fileformat']          = 'mp3';
+							$ThisFileInfo['audio']['dataformat'] = 'mp3';
+							break;
+					}
+					if (isset($FirstFrameThisfileInfo['mpeg']['audio']['bitrate_mode']) &amp;&amp; ($FirstFrameThisfileInfo['mpeg']['audio']['bitrate_mode'] == 'vbr')) {
+						if (!(abs($ThisFileInfo['audio']['bitrate'] - $FirstFrameThisfileInfo['audio']['bitrate']) &lt;= 1)) {
+							// If there is garbage data between a valid VBR header frame and a sequence
+							// of valid MPEG-audio frames the VBR data is no longer discarded.
+							$ThisFileInfo = $FirstFrameThisfileInfo;
+							$ThisFileInfo['avdataoffset']        = $FirstFrameAVDataOffset;
+							$ThisFileInfo['fileformat']          = 'mp3';
+							$ThisFileInfo['audio']['dataformat'] = 'mp3';
+							$dummy                               = $ThisFileInfo;
+							unset($dummy['mpeg']['audio']);
+							$GarbageOffsetStart = $FirstFrameAVDataOffset + $FirstFrameThisfileInfo['mpeg']['audio']['framelength'];
+							$GarbageOffsetEnd   = $avdataoffset + $SynchSeekOffset;
+							if (getid3_mp3::decodeMPEGaudioHeader($fd, $GarbageOffsetEnd, $dummy, true, true)) {
+
+								$ThisFileInfo = $dummy;
+								$ThisFileInfo['avdataoffset'] = $GarbageOffsetEnd;
+								$ThisFileInfo['warning'][] = 'apparently-valid VBR header not used because could not find '.GETID3_MP3_VALID_CHECK_FRAMES.' consecutive MPEG-audio frames immediately after VBR header (garbage data for '.($GarbageOffsetEnd - $GarbageOffsetStart).' bytes between '.$GarbageOffsetStart.' and '.$GarbageOffsetEnd.'), but did find valid CBR stream starting at '.$GarbageOffsetEnd;
+
+							} else {
+
+								$ThisFileInfo['warning'][] = 'using data from VBR header even though could not find '.GETID3_MP3_VALID_CHECK_FRAMES.' consecutive MPEG-audio frames immediately after VBR header (garbage data for '.($GarbageOffsetEnd - $GarbageOffsetStart).' bytes between '.$GarbageOffsetStart.' and '.$GarbageOffsetEnd.')';
+
+							}
+						}
+					}
+					if (isset($ThisFileInfo['mpeg']['audio']['bitrate_mode']) &amp;&amp; ($ThisFileInfo['mpeg']['audio']['bitrate_mode'] == 'vbr') &amp;&amp; !isset($ThisFileInfo['mpeg']['audio']['VBR_method'])) {
+						// VBR file with no VBR header
+						$BitrateHistogram = true;
+					}
+
+					if ($BitrateHistogram) {
+
+						$ThisFileInfo['mpeg']['audio']['stereo_distribution']  = array('stereo'=&gt;0, 'joint stereo'=&gt;0, 'dual channel'=&gt;0, 'mono'=&gt;0);
+						$ThisFileInfo['mpeg']['audio']['version_distribution'] = array('1'=&gt;0, '2'=&gt;0, '2.5'=&gt;0);
+
+						if ($ThisFileInfo['mpeg']['audio']['version'] == '1') {
+							if ($ThisFileInfo['mpeg']['audio']['layer'] == 3) {
+								$ThisFileInfo['mpeg']['audio']['bitrate_distribution'] = array('free'=&gt;0, 32000=&gt;0, 40000=&gt;0, 48000=&gt;0, 56000=&gt;0, 64000=&gt;0, 80000=&gt;0, 96000=&gt;0, 112000=&gt;0, 128000=&gt;0, 160000=&gt;0, 192000=&gt;0, 224000=&gt;0, 256000=&gt;0, 320000=&gt;0);
+							} elseif ($ThisFileInfo['mpeg']['audio']['layer'] == 2) {
+								$ThisFileInfo['mpeg']['audio']['bitrate_distribution'] = array('free'=&gt;0, 32000=&gt;0, 48000=&gt;0, 56000=&gt;0, 64000=&gt;0, 80000=&gt;0, 96000=&gt;0, 112000=&gt;0, 128000=&gt;0, 160000=&gt;0, 192000=&gt;0, 224000=&gt;0, 256000=&gt;0, 320000=&gt;0, 384000=&gt;0);
+							} elseif ($ThisFileInfo['mpeg']['audio']['layer'] == 1) {
+								$ThisFileInfo['mpeg']['audio']['bitrate_distribution'] = array('free'=&gt;0, 32000=&gt;0, 64000=&gt;0, 96000=&gt;0, 128000=&gt;0, 160000=&gt;0, 192000=&gt;0, 224000=&gt;0, 256000=&gt;0, 288000=&gt;0, 320000=&gt;0, 352000=&gt;0, 384000=&gt;0, 416000=&gt;0, 448000=&gt;0);
+							}
+						} elseif ($ThisFileInfo['mpeg']['audio']['layer'] == 1) {
+							$ThisFileInfo['mpeg']['audio']['bitrate_distribution'] = array('free'=&gt;0, 32000=&gt;0, 48000=&gt;0, 56000=&gt;0, 64000=&gt;0, 80000=&gt;0, 96000=&gt;0, 112000=&gt;0, 128000=&gt;0, 144000=&gt;0, 160000=&gt;0, 176000=&gt;0, 192000=&gt;0, 224000=&gt;0, 256000=&gt;0);
+						} else {
+							$ThisFileInfo['mpeg']['audio']['bitrate_distribution'] = array('free'=&gt;0, 8000=&gt;0, 16000=&gt;0, 24000=&gt;0, 32000=&gt;0, 40000=&gt;0, 48000=&gt;0, 56000=&gt;0, 64000=&gt;0, 80000=&gt;0, 96000=&gt;0, 112000=&gt;0, 128000=&gt;0, 144000=&gt;0, 160000=&gt;0);
+						}
+
+						$dummy = array('error'=&gt;$ThisFileInfo['error'], 'warning'=&gt;$ThisFileInfo['warning'], 'avdataend'=&gt;$ThisFileInfo['avdataend'], 'avdataoffset'=&gt;$ThisFileInfo['avdataoffset']);
+						$synchstartoffset = $ThisFileInfo['avdataoffset'];
+
+						$FastMode = false;
+						$SynchErrorsFound = 0;
+						while (getid3_mp3::decodeMPEGaudioHeader($fd, $synchstartoffset, $dummy, false, false, $FastMode)) {
+							$FastMode = true;
+							$thisframebitrate = $MPEGaudioBitrateLookup[$MPEGaudioVersionLookup[$dummy['mpeg']['audio']['raw']['version']]][$MPEGaudioLayerLookup[$dummy['mpeg']['audio']['raw']['layer']]][$dummy['mpeg']['audio']['raw']['bitrate']];
+
+							if (empty($dummy['mpeg']['audio']['framelength'])) {
+								$SynchErrorsFound++;
+							} else {
+								$ThisFileInfo['mpeg']['audio']['bitrate_distribution'][$thisframebitrate]++;
+								$ThisFileInfo['mpeg']['audio']['stereo_distribution'][$dummy['mpeg']['audio']['channelmode']]++;
+								$ThisFileInfo['mpeg']['audio']['version_distribution'][$dummy['mpeg']['audio']['version']]++;
+
+								$synchstartoffset += $dummy['mpeg']['audio']['framelength'];
+							}
+						}
+						if ($SynchErrorsFound &gt; 0) {
+							$ThisFileInfo['warning'][] = 'Found '.$SynchErrorsFound.' synch errors in histogram analysis';
+							//return false;
+						}
+
+						$bittotal     = 0;
+						$framecounter = 0;
+						foreach ($ThisFileInfo['mpeg']['audio']['bitrate_distribution'] as $bitratevalue =&gt; $bitratecount) {
+							$framecounter += $bitratecount;
+							if ($bitratevalue != 'free') {
+								$bittotal += ($bitratevalue * $bitratecount);
+							}
+						}
+						if ($framecounter == 0) {
+							$ThisFileInfo['error'][] = 'Corrupt MP3 file: framecounter == zero';
+							return false;
+						}
+						$ThisFileInfo['mpeg']['audio']['frame_count'] = $framecounter;
+						$ThisFileInfo['mpeg']['audio']['bitrate']     = ($bittotal / $framecounter);
+
+						$ThisFileInfo['audio']['bitrate'] = $ThisFileInfo['mpeg']['audio']['bitrate'];
+
+
+						// Definitively set VBR vs CBR, even if the Xing/LAME/VBRI header says differently
+						$distinct_bitrates = 0;
+						foreach ($ThisFileInfo['mpeg']['audio']['bitrate_distribution'] as $bitrate_value =&gt; $bitrate_count) {
+							if ($bitrate_count &gt; 0) {
+								$distinct_bitrates++;
+							}
+						}
+						if ($distinct_bitrates &gt; 1) {
+							$ThisFileInfo['mpeg']['audio']['bitrate_mode'] = 'vbr';
+						} else {
+							$ThisFileInfo['mpeg']['audio']['bitrate_mode'] = 'cbr';
+						}
+						$ThisFileInfo['audio']['bitrate_mode'] = $ThisFileInfo['mpeg']['audio']['bitrate_mode'];
+
+					}
+
+					break; // exit while()
+				}
+			}
+
+			$SynchSeekOffset++;
+			if (($avdataoffset + $SynchSeekOffset) &gt;= $ThisFileInfo['avdataend']) {
+				// end of file/data
+
+				if (empty($ThisFileInfo['mpeg']['audio'])) {
+
+					$ThisFileInfo['error'][] = 'could not find valid MPEG synch before end of file';
+					if (isset($ThisFileInfo['audio']['bitrate'])) {
+						unset($ThisFileInfo['audio']['bitrate']);
+					}
+					if (isset($ThisFileInfo['mpeg']['audio'])) {
+						unset($ThisFileInfo['mpeg']['audio']);
+					}
+					if (isset($ThisFileInfo['mpeg']) &amp;&amp; (!is_array($ThisFileInfo['mpeg']) || empty($ThisFileInfo['mpeg']))) {
+						unset($ThisFileInfo['mpeg']);
+					}
+					return false;
+
+				}
+				break;
+			}
+
+		}
+		$ThisFileInfo['audio']['channels']        = $ThisFileInfo['mpeg']['audio']['channels'];
+		$ThisFileInfo['audio']['channelmode']     = $ThisFileInfo['mpeg']['audio']['channelmode'];
+		$ThisFileInfo['audio']['sample_rate']     = $ThisFileInfo['mpeg']['audio']['sample_rate'];
+		return true;
+	}
+
+
+	function MPEGaudioVersionArray() {
+		static $MPEGaudioVersion = array('2.5', false, '2', '1');
+		return $MPEGaudioVersion;
+	}
+
+	function MPEGaudioLayerArray() {
+		static $MPEGaudioLayer = array(false, 3, 2, 1);
+		return $MPEGaudioLayer;
+	}
+
+	function MPEGaudioBitrateArray() {
+		static $MPEGaudioBitrate;
+		if (empty($MPEGaudioBitrate)) {
+		    $MPEGaudioBitrate = array (
+			    '1'  =&gt;  array (1 =&gt; array('free', 32000, 64000, 96000, 128000, 160000, 192000, 224000, 256000, 288000, 320000, 352000, 384000, 416000, 448000),
+			                    2 =&gt; array('free', 32000, 48000, 56000,  64000,  80000,  96000, 112000, 128000, 160000, 192000, 224000, 256000, 320000, 384000),
+			                    3 =&gt; array('free', 32000, 40000, 48000,  56000,  64000,  80000,  96000, 112000, 128000, 160000, 192000, 224000, 256000, 320000)
+			                   ),
+
+			    '2'  =&gt;  array (1 =&gt; array('free', 32000, 48000, 56000,  64000,  80000,  96000, 112000, 128000, 144000, 160000, 176000, 192000, 224000, 256000),
+			                    2 =&gt; array('free',  8000, 16000, 24000,  32000,  40000,  48000,  56000,  64000,  80000,  96000, 112000, 128000, 144000, 160000),
+			                   )
+			);
+			$MPEGaudioBitrate['2'][3] = $MPEGaudioBitrate['2'][2];
+			$MPEGaudioBitrate['2.5']  = $MPEGaudioBitrate['2'];
+		}
+		return $MPEGaudioBitrate;
+	}
+
+	function MPEGaudioFrequencyArray() {
+		static $MPEGaudioFrequency;
+		if (empty($MPEGaudioFrequency)) {
+		    $MPEGaudioFrequency = array (
+			    '1'   =&gt; array(44100, 48000, 32000),
+			    '2'   =&gt; array(22050, 24000, 16000),
+			    '2.5' =&gt; array(11025, 12000,  8000)
+			);
+		}
+		return $MPEGaudioFrequency;
+	}
+
+	function MPEGaudioChannelModeArray() {
+		static $MPEGaudioChannelMode = array('stereo', 'joint stereo', 'dual channel', 'mono');
+		return $MPEGaudioChannelMode;
+	}
+
+	function MPEGaudioModeExtensionArray() {
+		static $MPEGaudioModeExtension;
+		if (empty($MPEGaudioModeExtension)) {
+		    $MPEGaudioModeExtension = array (
+			    1 =&gt; array('4-31', '8-31', '12-31', '16-31'),
+			    2 =&gt; array('4-31', '8-31', '12-31', '16-31'),
+			    3 =&gt; array('', 'IS', 'MS', 'IS+MS')
+			);
+		}
+		return $MPEGaudioModeExtension;
+	}
+
+	function MPEGaudioEmphasisArray() {
+		static $MPEGaudioEmphasis = array('none', '50/15ms', false, 'CCIT J.17');
+		return $MPEGaudioEmphasis;
+	}
+
+	function MPEGaudioHeaderBytesValid($head4, $allowBitrate15=false) {
+		return getid3_mp3::MPEGaudioHeaderValid(getid3_mp3::MPEGaudioHeaderDecode($head4), false, $allowBitrate15);
+	}
+
+	function MPEGaudioHeaderValid($rawarray, $echoerrors=false, $allowBitrate15=false) {
+		if (($rawarray['synch'] &amp; 0x0FFE) != 0x0FFE) {
+			return false;
+		}
+
+		static $MPEGaudioVersionLookup;
+		static $MPEGaudioLayerLookup;
+		static $MPEGaudioBitrateLookup;
+		static $MPEGaudioFrequencyLookup;
+		static $MPEGaudioChannelModeLookup;
+		static $MPEGaudioModeExtensionLookup;
+		static $MPEGaudioEmphasisLookup;
+		if (empty($MPEGaudioVersionLookup)) {
+			$MPEGaudioVersionLookup       = getid3_mp3::MPEGaudioVersionArray();
+			$MPEGaudioLayerLookup         = getid3_mp3::MPEGaudioLayerArray();
+			$MPEGaudioBitrateLookup       = getid3_mp3::MPEGaudioBitrateArray();
+			$MPEGaudioFrequencyLookup     = getid3_mp3::MPEGaudioFrequencyArray();
+			$MPEGaudioChannelModeLookup   = getid3_mp3::MPEGaudioChannelModeArray();
+			$MPEGaudioModeExtensionLookup = getid3_mp3::MPEGaudioModeExtensionArray();
+			$MPEGaudioEmphasisLookup      = getid3_mp3::MPEGaudioEmphasisArray();
+		}
+
+		if (isset($MPEGaudioVersionLookup[$rawarray['version']])) {
+			$decodedVersion = $MPEGaudioVersionLookup[$rawarray['version']];
+		} else {
+			if ($echoerrors) {
+				echo &quot;\n&quot;.'invalid Version ('.$rawarray['version'].')';
+			}
+			return false;
+		}
+		if (isset($MPEGaudioLayerLookup[$rawarray['layer']])) {
+			$decodedLayer = $MPEGaudioLayerLookup[$rawarray['layer']];
+		} else {
+			if ($echoerrors) {
+				echo &quot;\n&quot;.'invalid Layer ('.$rawarray['layer'].')';
+			}
+			return false;
+		}
+		if (!isset($MPEGaudioBitrateLookup[$decodedVersion][$decodedLayer][$rawarray['bitrate']])) {
+			if ($echoerrors) {
+				echo &quot;\n&quot;.'invalid Bitrate ('.$rawarray['bitrate'].')';
+			}
+			if ($rawarray['bitrate'] == 15) {
+				// known issue in LAME 3.90 - 3.93.1 where free-format has bitrate ID of 15 instead of 0
+				// let it go through here otherwise file will not be identified
+				if (!$allowBitrate15) {
+					return false;
+				}
+			} else {
+				return false;
+			}
+		}
+		if (!isset($MPEGaudioFrequencyLookup[$decodedVersion][$rawarray['sample_rate']])) {
+			if ($echoerrors) {
+				echo &quot;\n&quot;.'invalid Frequency ('.$rawarray['sample_rate'].')';
+			}
+			return false;
+		}
+		if (!isset($MPEGaudioChannelModeLookup[$rawarray['channelmode']])) {
+			if ($echoerrors) {
+				echo &quot;\n&quot;.'invalid ChannelMode ('.$rawarray['channelmode'].')';
+			}
+			return false;
+		}
+		if (!isset($MPEGaudioModeExtensionLookup[$decodedLayer][$rawarray['modeextension']])) {
+			if ($echoerrors) {
+				echo &quot;\n&quot;.'invalid Mode Extension ('.$rawarray['modeextension'].')';
+			}
+			return false;
+		}
+		if (!isset($MPEGaudioEmphasisLookup[$rawarray['emphasis']])) {
+			if ($echoerrors) {
+				echo &quot;\n&quot;.'invalid Emphasis ('.$rawarray['emphasis'].')';
+			}
+			return false;
+		}
+		// These are just either set or not set, you can't mess that up :)
+		// $rawarray['protection'];
+		// $rawarray['padding'];
+		// $rawarray['private'];
+		// $rawarray['copyright'];
+		// $rawarray['original'];
+
+		return true;
+	}
+
+	function MPEGaudioHeaderDecode($Header4Bytes) {
+		// AAAA AAAA  AAAB BCCD  EEEE FFGH  IIJJ KLMM
+		// A - Frame sync (all bits set)
+		// B - MPEG Audio version ID
+		// C - Layer description
+		// D - Protection bit
+		// E - Bitrate index
+		// F - Sampling rate frequency index
+		// G - Padding bit
+		// H - Private bit
+		// I - Channel Mode
+		// J - Mode extension (Only if Joint stereo)
+		// K - Copyright
+		// L - Original
+		// M - Emphasis
+
+		if (strlen($Header4Bytes) != 4) {
+			return false;
+		}
+
+		$MPEGrawHeader['synch']         = (getid3_lib::BigEndian2Int(substr($Header4Bytes, 0, 2)) &amp; 0xFFE0) &gt;&gt; 4;
+		$MPEGrawHeader['version']       = (ord($Header4Bytes{1}) &amp; 0x18) &gt;&gt; 3; //    BB
+		$MPEGrawHeader['layer']         = (ord($Header4Bytes{1}) &amp; 0x06) &gt;&gt; 1; //      CC
+		$MPEGrawHeader['protection']    = (ord($Header4Bytes{1}) &amp; 0x01);      //        D
+		$MPEGrawHeader['bitrate']       = (ord($Header4Bytes{2}) &amp; 0xF0) &gt;&gt; 4; // EEEE
+		$MPEGrawHeader['sample_rate']   = (ord($Header4Bytes{2}) &amp; 0x0C) &gt;&gt; 2; //     FF
+		$MPEGrawHeader['padding']       = (ord($Header4Bytes{2}) &amp; 0x02) &gt;&gt; 1; //       G
+		$MPEGrawHeader['private']       = (ord($Header4Bytes{2}) &amp; 0x01);      //        H
+		$MPEGrawHeader['channelmode']   = (ord($Header4Bytes{3}) &amp; 0xC0) &gt;&gt; 6; // II
+		$MPEGrawHeader['modeextension'] = (ord($Header4Bytes{3}) &amp; 0x30) &gt;&gt; 4; //   JJ
+		$MPEGrawHeader['copyright']     = (ord($Header4Bytes{3}) &amp; 0x08) &gt;&gt; 3; //     K
+		$MPEGrawHeader['original']      = (ord($Header4Bytes{3}) &amp; 0x04) &gt;&gt; 2; //      L
+		$MPEGrawHeader['emphasis']      = (ord($Header4Bytes{3}) &amp; 0x03);      //       MM
+
+		return $MPEGrawHeader;
+	}
+
+	function MPEGaudioFrameLength(&amp;$bitrate, &amp;$version, &amp;$layer, $padding, &amp;$samplerate) {
+		static $AudioFrameLengthCache = array();
+
+		if (!isset($AudioFrameLengthCache[$bitrate][$version][$layer][$padding][$samplerate])) {
+			$AudioFrameLengthCache[$bitrate][$version][$layer][$padding][$samplerate] = false;
+			if ($bitrate != 'free') {
+
+				if ($version == '1') {
+
+					if ($layer == '1') {
+
+						// For Layer I slot is 32 bits long
+						$FrameLengthCoefficient = 48;
+						$SlotLength = 4;
+
+					} else { // Layer 2 / 3
+
+						// for Layer 2 and Layer 3 slot is 8 bits long.
+						$FrameLengthCoefficient = 144;
+						$SlotLength = 1;
+
+					}
+
+				} else { // MPEG-2 / MPEG-2.5
+
+					if ($layer == '1') {
+
+						// For Layer I slot is 32 bits long
+						$FrameLengthCoefficient = 24;
+						$SlotLength = 4;
+
+					} elseif ($layer == '2') {
+
+						// for Layer 2 and Layer 3 slot is 8 bits long.
+						$FrameLengthCoefficient = 144;
+						$SlotLength = 1;
+
+					} else { // layer 3
+
+						// for Layer 2 and Layer 3 slot is 8 bits long.
+						$FrameLengthCoefficient = 72;
+						$SlotLength = 1;
+
+					}
+
+				}
+
+				// FrameLengthInBytes = ((Coefficient * BitRate) / SampleRate) + Padding
+				if ($samplerate &gt; 0) {
+					$NewFramelength  = ($FrameLengthCoefficient * $bitrate) / $samplerate;
+					$NewFramelength  = floor($NewFramelength / $SlotLength) * $SlotLength; // round to next-lower multiple of SlotLength (1 byte for Layer 2/3, 4 bytes for Layer I)
+					if ($padding) {
+						$NewFramelength += $SlotLength;
+					}
+					$AudioFrameLengthCache[$bitrate][$version][$layer][$padding][$samplerate] = (int) $NewFramelength;
+				}
+			}
+		}
+		return $AudioFrameLengthCache[$bitrate][$version][$layer][$padding][$samplerate];
+	}
+
+	function ClosestStandardMP3Bitrate($bitrate) {
+		static $StandardBitrates = array(320000, 256000, 224000, 192000, 160000, 128000, 112000, 96000, 80000, 64000, 56000, 48000, 40000, 32000, 24000, 16000, 8000);
+		static $BitrateTable = array(0=&gt;'-');
+		$roundbitrate = intval(round($bitrate, -3));
+		if (!isset($BitrateTable[$roundbitrate])) {
+			if ($roundbitrate &gt; 320000) {
+				$BitrateTable[$roundbitrate] = round($bitrate, -4);
+			} else {
+				$LastBitrate = 320000;
+				foreach ($StandardBitrates as $StandardBitrate) {
+					$BitrateTable[$roundbitrate] = $StandardBitrate;
+					if ($roundbitrate &gt;= $StandardBitrate - (($LastBitrate - $StandardBitrate) / 2)) {
+						break;
+					}
+					$LastBitrate = $StandardBitrate;
+				}
+			}
+		}
+		return $BitrateTable[$roundbitrate];
+	}
+
+	function XingVBRidOffset($version, $channelmode) {
+		static $XingVBRidOffsetCache = array();
+		if (empty($XingVBRidOffset)) {
+			$XingVBRidOffset = array (
+			    '1'   =&gt; array ('mono'          =&gt; 0x15, // 4 + 17 = 21
+			                    'stereo'        =&gt; 0x24, // 4 + 32 = 36
+			                    'joint stereo'  =&gt; 0x24,
+			                    'dual channel'  =&gt; 0x24
+			                   ),
+
+			    '2'   =&gt; array ('mono'          =&gt; 0x0D, // 4 +  9 = 13
+			                    'stereo'        =&gt; 0x15, // 4 + 17 = 21
+			                    'joint stereo'  =&gt; 0x15,
+			                    'dual channel'  =&gt; 0x15
+			                   ),
+
+			    '2.5' =&gt; array ('mono'          =&gt; 0x15,
+			                    'stereo'        =&gt; 0x15,
+			                    'joint stereo'  =&gt; 0x15,
+			                    'dual channel'  =&gt; 0x15
+			                   )
+		    );
+		}
+		return $XingVBRidOffset[$version][$channelmode];
+	}
+
+	function LAMEvbrMethodLookup($VBRmethodID) {
+		static $LAMEvbrMethodLookup = array(
+			0x00 =&gt; 'unknown',
+			0x01 =&gt; 'cbr',
+			0x02 =&gt; 'abr',
+			0x03 =&gt; 'vbr-old / vbr-rh',
+			0x04 =&gt; 'vbr-new / vbr-mtrh',
+			0x05 =&gt; 'vbr-mt',
+			0x06 =&gt; 'Full VBR Method 4',
+			0x08 =&gt; 'constant bitrate 2 pass',
+			0x09 =&gt; 'abr 2 pass',
+			0x0F =&gt; 'reserved'
+		);
+		return (isset($LAMEvbrMethodLookup[$VBRmethodID]) ? $LAMEvbrMethodLookup[$VBRmethodID] : '');
+	}
+
+	function LAMEmiscStereoModeLookup($StereoModeID) {
+		static $LAMEmiscStereoModeLookup = array(
+			0 =&gt; 'mono',
+			1 =&gt; 'stereo',
+			2 =&gt; 'dual mono',
+			3 =&gt; 'joint stereo',
+			4 =&gt; 'forced stereo',
+			5 =&gt; 'auto',
+			6 =&gt; 'intensity stereo',
+			7 =&gt; 'other'
+		);
+		return (isset($LAMEmiscStereoModeLookup[$StereoModeID]) ? $LAMEmiscStereoModeLookup[$StereoModeID] : '');
+	}
+
+	function LAMEmiscSourceSampleFrequencyLookup($SourceSampleFrequencyID) {
+		static $LAMEmiscSourceSampleFrequencyLookup = array(
+			0 =&gt; '&lt;= 32 kHz',
+			1 =&gt; '44.1 kHz',
+			2 =&gt; '48 kHz',
+			3 =&gt; '&gt; 48kHz'
+		);
+		return (isset($LAMEmiscSourceSampleFrequencyLookup[$SourceSampleFrequencyID]) ? $LAMEmiscSourceSampleFrequencyLookup[$SourceSampleFrequencyID] : '');
+	}
+
+	function LAMEsurroundInfoLookup($SurroundInfoID) {
+		static $LAMEsurroundInfoLookup = array(
+			0 =&gt; 'no surround info',
+			1 =&gt; 'DPL encoding',
+			2 =&gt; 'DPL2 encoding',
+			3 =&gt; 'Ambisonic encoding'
+		);
+		return (isset($LAMEsurroundInfoLookup[$SurroundInfoID]) ? $LAMEsurroundInfoLookup[$SurroundInfoID] : 'reserved');
+	}
+
+	function LAMEpresetUsedLookup($LAMEtag) {
+		if ($LAMEtag['preset_used_id'] == 0) {
+			// no preset used (LAME &gt;=3.93)
+			// no preset recorded (LAME &lt;3.93)
+			return '';
+		}
+		static $LAMEpresetUsedLookup = array();
+		if (empty($LAMEpresetUsedLookup)) {
+			for ($i = 8; $i &lt;= 320; $i++) {
+				switch ($LAMEtag['vbr_method']) {
+					case 'cbr':
+						$LAMEpresetUsedLookup[$i] = '--alt-preset '.$LAMEtag['vbr_method'].' '.$i;
+						break;
+					case 'abr':
+					default: // other VBR modes shouldn't be here(?)
+						$LAMEpresetUsedLookup[$i] = '--alt-preset '.$i;
+						break;
+				}
+			}
+
+			// named old-style presets (studio, phone, voice, etc) are handled in GuessEncoderOptions()
+
+			// named alt-presets
+			$LAMEpresetUsedLookup[1000] = '--r3mix';
+			$LAMEpresetUsedLookup[1001] = '--alt-preset standard';
+			$LAMEpresetUsedLookup[1002] = '--alt-preset extreme';
+			$LAMEpresetUsedLookup[1003] = '--alt-preset insane';
+			$LAMEpresetUsedLookup[1004] = '--alt-preset fast standard';
+			$LAMEpresetUsedLookup[1005] = '--alt-preset fast extreme';
+			$LAMEpresetUsedLookup[1006] = '--alt-preset medium';
+			$LAMEpresetUsedLookup[1007] = '--alt-preset fast medium';
+
+			// LAME 3.94 additions/changes
+			$LAMEpresetUsedLookup[1010] = '--preset portable';                                                           // 3.94a15 Oct 21 2003
+			$LAMEpresetUsedLookup[1015] = '--preset radio';                                                              // 3.94a15 Oct 21 2003
+
+			$LAMEpresetUsedLookup[320]  = '--preset insane';                                                             // 3.94a15 Nov 12 2003
+			$LAMEpresetUsedLookup[430]  = '--preset radio';                                                              // 3.94a15 Nov 12 2003
+			$LAMEpresetUsedLookup[450]  = '--preset '.(($LAMEtag['raw']['vbr_method'] == 4) ? 'fast ' : '').'portable';  // 3.94a15 Nov 12 2003
+			$LAMEpresetUsedLookup[460]  = '--preset '.(($LAMEtag['raw']['vbr_method'] == 4) ? 'fast ' : '').'medium';    // 3.94a15 Nov 12 2003
+			$LAMEpresetUsedLookup[470]  = '--r3mix';                                                                     // 3.94b1  Dec 18 2003
+			$LAMEpresetUsedLookup[480]  = '--preset '.(($LAMEtag['raw']['vbr_method'] == 4) ? 'fast ' : '').'standard';  // 3.94a15 Nov 12 2003
+			$LAMEpresetUsedLookup[500]  = '--preset '.(($LAMEtag['raw']['vbr_method'] == 4) ? 'fast ' : '').'extreme';   // 3.94a15 Nov 12 2003
+		}
+		return (isset($LAMEpresetUsedLookup[$LAMEtag['preset_used_id']]) ? $LAMEpresetUsedLookup[$LAMEtag['preset_used_id']] : 'new/unknown preset: '.$LAMEtag['preset_used_id'].' - report to <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>');
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.mp3.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.mpc.php
===================================================================
--- trunk/inc/external/getid3/module.audio.mpc.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.mpc.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,296 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.mpc.php                                        //
+// module for analyzing Musepack/MPEG+ Audio files             //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_mpc
+{
+
+	function getid3_mpc(&amp;$fd, &amp;$ThisFileInfo) {
+		// <A HREF="http://www.uni-jena.de/~pfk/mpp/sv8/header.html">http://www.uni-jena.de/~pfk/mpp/sv8/header.html</A>
+
+		$ThisFileInfo['mpc']['header'] = array();
+		$thisfile_mpc_header           = &amp;$ThisFileInfo['mpc']['header'];
+
+		$ThisFileInfo['fileformat']               = 'mpc';
+		$ThisFileInfo['audio']['dataformat']      = 'mpc';
+		$ThisFileInfo['audio']['bitrate_mode']    = 'vbr';
+		$ThisFileInfo['audio']['channels']        = 2;  // the format appears to be hardcoded for stereo only
+		$ThisFileInfo['audio']['lossless']        = false;
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+
+		$thisfile_mpc_header['size'] = 28;
+		$MPCheaderData = fread($fd, $thisfile_mpc_header['size']);
+		$offset = 0;
+
+		if (substr($MPCheaderData, $offset, 3) == 'MP+') {
+
+			// great, this is SV7+
+			$thisfile_mpc_header['raw']['preamble'] = substr($MPCheaderData, $offset, 3); // should be 'MP+'
+			$offset += 3;
+
+		} elseif (preg_match('/^[\x00\x01\x10\x11\x40\x41\x50\x51\x80\x81\x90\x91\xC0\xC1\xD0\xD1][\x20-37][\x00\x20\x40\x60\x80\xA0\xC0\xE0]/s', substr($MPCheaderData, 0, 4))) {
+
+			// this is SV4 - SV6, handle seperately
+            $thisfile_mpc_header['size'] = 8;
+
+            // add size of file header to avdataoffset - calc bitrate correctly + MD5 data
+		    $ThisFileInfo['avdataoffset'] += $thisfile_mpc_header['size'];
+
+			// Most of this code adapted from Jurgen Faul's MPEGplus source code - thanks Jurgen! :)
+			$HeaderDWORD[0] = getid3_lib::LittleEndian2Int(substr($MPCheaderData, 0, 4));
+			$HeaderDWORD[1] = getid3_lib::LittleEndian2Int(substr($MPCheaderData, 4, 4));
+
+
+			// DDDD DDDD  CCCC CCCC  BBBB BBBB  AAAA AAAA
+			// aaaa aaaa  abcd dddd  dddd deee  eeff ffff
+			//
+			// a = bitrate       = anything
+			// b = IS            = anything
+			// c = MS            = anything
+			// d = streamversion = 0000000004 or 0000000005 or 0000000006
+			// e = maxband       = anything
+			// f = blocksize     = 000001 for SV5+, anything(?) for SV4
+
+			$thisfile_mpc_header['target_bitrate']       =        (($HeaderDWORD[0] &amp; 0xFF800000) &gt;&gt; 23);
+			$thisfile_mpc_header['intensity_stereo']     = (bool) (($HeaderDWORD[0] &amp; 0x00400000) &gt;&gt; 22);
+			$thisfile_mpc_header['mid-side_stereo']      = (bool) (($HeaderDWORD[0] &amp; 0x00200000) &gt;&gt; 21);
+			$thisfile_mpc_header['stream_major_version'] =         ($HeaderDWORD[0] &amp; 0x001FF800) &gt;&gt; 11;
+			$thisfile_mpc_header['stream_minor_version'] = 0; // no sub-version numbers before SV7
+			$thisfile_mpc_header['max_band']             =         ($HeaderDWORD[0] &amp; 0x000007C0) &gt;&gt;  6;  // related to lowpass frequency, not sure how it translates exactly
+			$thisfile_mpc_header['block_size']           =         ($HeaderDWORD[0] &amp; 0x0000003F);
+
+			switch ($thisfile_mpc_header['stream_major_version']) {
+				case 4:
+					$thisfile_mpc_header['frame_count'] = ($HeaderDWORD[1] &gt;&gt; 16);
+					break;
+
+				case 5:
+				case 6:
+					$thisfile_mpc_header['frame_count'] =  $HeaderDWORD[1];
+					break;
+
+				default:
+					$ThisFileInfo['error'] = 'Expecting 4, 5 or 6 in version field, found '.$thisfile_mpc_header['stream_major_version'].' instead';
+					unset($ThisFileInfo['mpc']);
+					return false;
+					break;
+			}
+
+			if (($thisfile_mpc_header['stream_major_version'] &gt; 4) &amp;&amp; ($thisfile_mpc_header['block_size'] != 1)) {
+				$ThisFileInfo['warning'][] = 'Block size expected to be 1, actual value found: '.$thisfile_mpc_header['block_size'];
+			}
+
+			$thisfile_mpc_header['sample_rate']   = 44100; // AB: used by all files up to SV7
+			$ThisFileInfo['audio']['sample_rate'] = $thisfile_mpc_header['sample_rate'];
+			$thisfile_mpc_header['samples']       = $thisfile_mpc_header['frame_count'] * 1152 * $ThisFileInfo['audio']['channels'];
+
+			if ($thisfile_mpc_header['target_bitrate'] == 0) {
+				$ThisFileInfo['audio']['bitrate_mode'] = 'vbr';
+			} else {
+				$ThisFileInfo['audio']['bitrate_mode'] = 'cbr';
+			}
+
+			$ThisFileInfo['mpc']['bitrate']   = ($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8 * 44100 / $thisfile_mpc_header['frame_count'] / 1152;
+			$ThisFileInfo['audio']['bitrate'] = $ThisFileInfo['mpc']['bitrate'];
+			$ThisFileInfo['audio']['encoder'] = 'SV'.$thisfile_mpc_header['stream_major_version'];
+
+			return true;
+
+		} else {
+
+			$ThisFileInfo['error'][] = 'Expecting &quot;MP+&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.substr($MPCheaderData, $offset, 3).'&quot;';
+			unset($ThisFileInfo['fileformat']);
+			unset($ThisFileInfo['mpc']);
+			return false;
+
+		}
+
+		// Continue with SV7+ handling
+		$StreamVersionByte                           = getid3_lib::LittleEndian2Int(substr($MPCheaderData, $offset, 1));
+		$offset += 1;
+		$thisfile_mpc_header['stream_major_version'] = ($StreamVersionByte &amp; 0x0F);
+		$thisfile_mpc_header['stream_minor_version'] = ($StreamVersionByte &amp; 0xF0) &gt;&gt; 4;
+		$thisfile_mpc_header['frame_count']          = getid3_lib::LittleEndian2Int(substr($MPCheaderData, $offset, 4));
+		$offset += 4;
+
+		switch ($thisfile_mpc_header['stream_major_version']) {
+			case 7:
+				//$ThisFileInfo['fileformat'] = 'SV7';
+				break;
+
+			default:
+				$ThisFileInfo['error'][] = 'Only Musepack SV7 supported';
+				return false;
+		}
+
+		$FlagsDWORD1                                   = getid3_lib::LittleEndian2Int(substr($MPCheaderData, $offset, 4));
+		$offset += 4;
+		$thisfile_mpc_header['intensity_stereo']       = (bool) (($FlagsDWORD1 &amp; 0x80000000) &gt;&gt; 31);
+		$thisfile_mpc_header['mid_side_stereo']        = (bool) (($FlagsDWORD1 &amp; 0x40000000) &gt;&gt; 30);
+		$thisfile_mpc_header['max_subband']            =         ($FlagsDWORD1 &amp; 0x3F000000) &gt;&gt; 24;
+		$thisfile_mpc_header['raw']['profile']         =         ($FlagsDWORD1 &amp; 0x00F00000) &gt;&gt; 20;
+		$thisfile_mpc_header['begin_loud']             = (bool) (($FlagsDWORD1 &amp; 0x00080000) &gt;&gt; 19);
+		$thisfile_mpc_header['end_loud']               = (bool) (($FlagsDWORD1 &amp; 0x00040000) &gt;&gt; 18);
+		$thisfile_mpc_header['raw']['sample_rate']     =         ($FlagsDWORD1 &amp; 0x00030000) &gt;&gt; 16;
+		$thisfile_mpc_header['max_level']              =         ($FlagsDWORD1 &amp; 0x0000FFFF);
+
+		$thisfile_mpc_header['raw']['title_peak']      = getid3_lib::LittleEndian2Int(substr($MPCheaderData, $offset, 2));
+		$offset += 2;
+		$thisfile_mpc_header['raw']['title_gain']      = getid3_lib::LittleEndian2Int(substr($MPCheaderData, $offset, 2), true);
+		$offset += 2;
+
+		$thisfile_mpc_header['raw']['album_peak']      = getid3_lib::LittleEndian2Int(substr($MPCheaderData, $offset, 2));
+		$offset += 2;
+		$thisfile_mpc_header['raw']['album_gain']      = getid3_lib::LittleEndian2Int(substr($MPCheaderData, $offset, 2), true);
+		$offset += 2;
+
+		$FlagsDWORD2                                   = getid3_lib::LittleEndian2Int(substr($MPCheaderData, $offset, 4));
+		$offset += 4;
+		$thisfile_mpc_header['true_gapless']           = (bool) (($FlagsDWORD2 &amp; 0x80000000) &gt;&gt; 31);
+		$thisfile_mpc_header['last_frame_length']      =         ($FlagsDWORD2 &amp; 0x7FF00000) &gt;&gt; 20;
+
+
+		$thisfile_mpc_header['raw']['not_sure_what']   = getid3_lib::LittleEndian2Int(substr($MPCheaderData, $offset, 3));
+		$offset += 3;
+		$thisfile_mpc_header['raw']['encoder_version'] = getid3_lib::LittleEndian2Int(substr($MPCheaderData, $offset, 1));
+		$offset += 1;
+
+		$thisfile_mpc_header['profile']     = $this-&gt;MPCprofileNameLookup($thisfile_mpc_header['raw']['profile']);
+		$thisfile_mpc_header['sample_rate'] = $this-&gt;MPCfrequencyLookup($thisfile_mpc_header['raw']['sample_rate']);
+		if ($thisfile_mpc_header['sample_rate'] == 0) {
+			$ThisFileInfo['error'][] = 'Corrupt MPC file: frequency == zero';
+			return false;
+		}
+		$ThisFileInfo['audio']['sample_rate'] = $thisfile_mpc_header['sample_rate'];
+		$thisfile_mpc_header['samples']       = ((($thisfile_mpc_header['frame_count'] - 1) * 1152) + $thisfile_mpc_header['last_frame_length']) * $ThisFileInfo['audio']['channels'];
+
+		$ThisFileInfo['playtime_seconds']     = ($thisfile_mpc_header['samples'] / $ThisFileInfo['audio']['channels']) / $ThisFileInfo['audio']['sample_rate'];
+		if ($ThisFileInfo['playtime_seconds'] == 0) {
+			$ThisFileInfo['error'][] = 'Corrupt MPC file: playtime_seconds == zero';
+			return false;
+		}
+
+		// add size of file header to avdataoffset - calc bitrate correctly + MD5 data
+		$ThisFileInfo['avdataoffset'] += $thisfile_mpc_header['size'];
+
+		$ThisFileInfo['audio']['bitrate'] = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['playtime_seconds'];
+
+		$thisfile_mpc_header['title_peak']        = $thisfile_mpc_header['raw']['title_peak'];
+		$thisfile_mpc_header['title_peak_db']     = $this-&gt;MPCpeakDBLookup($thisfile_mpc_header['title_peak']);
+		if ($thisfile_mpc_header['raw']['title_gain'] &lt; 0) {
+			$thisfile_mpc_header['title_gain_db'] = (float) (32768 + $thisfile_mpc_header['raw']['title_gain']) / -100;
+		} else {
+			$thisfile_mpc_header['title_gain_db'] = (float) $thisfile_mpc_header['raw']['title_gain'] / 100;
+		}
+
+		$thisfile_mpc_header['album_peak']        = $thisfile_mpc_header['raw']['album_peak'];
+		$thisfile_mpc_header['album_peak_db']     = $this-&gt;MPCpeakDBLookup($thisfile_mpc_header['album_peak']);
+		if ($thisfile_mpc_header['raw']['album_gain'] &lt; 0) {
+			$thisfile_mpc_header['album_gain_db'] = (float) (32768 + $thisfile_mpc_header['raw']['album_gain']) / -100;
+		} else {
+			$thisfile_mpc_header['album_gain_db'] = (float) $thisfile_mpc_header['raw']['album_gain'] / 100;;
+		}
+		$thisfile_mpc_header['encoder_version']   = $this-&gt;MPCencoderVersionLookup($thisfile_mpc_header['raw']['encoder_version']);
+
+		$ThisFileInfo['replay_gain']['track']['adjustment'] = $thisfile_mpc_header['title_gain_db'];
+		$ThisFileInfo['replay_gain']['album']['adjustment'] = $thisfile_mpc_header['album_gain_db'];
+
+		if ($thisfile_mpc_header['title_peak'] &gt; 0) {
+			$ThisFileInfo['replay_gain']['track']['peak'] = $thisfile_mpc_header['title_peak'];
+		} elseif (round($thisfile_mpc_header['max_level'] * 1.18) &gt; 0) {
+			$ThisFileInfo['replay_gain']['track']['peak'] = getid3_lib::CastAsInt(round($thisfile_mpc_header['max_level'] * 1.18)); // why? I don't know - see mppdec.c
+		}
+		if ($thisfile_mpc_header['album_peak'] &gt; 0) {
+			$ThisFileInfo['replay_gain']['album']['peak'] = $thisfile_mpc_header['album_peak'];
+		}
+
+		//$ThisFileInfo['audio']['encoder'] = 'SV'.$thisfile_mpc_header['stream_major_version'].'.'.$thisfile_mpc_header['stream_minor_version'].', '.$thisfile_mpc_header['encoder_version'];
+		$ThisFileInfo['audio']['encoder'] = $thisfile_mpc_header['encoder_version'];
+		$ThisFileInfo['audio']['encoder_options'] = $thisfile_mpc_header['profile'];
+
+		return true;
+	}
+
+	function MPCprofileNameLookup($profileid) {
+		static $MPCprofileNameLookup = array(
+			0  =&gt; 'no profile',
+			1  =&gt; 'Experimental',
+			2  =&gt; 'unused',
+			3  =&gt; 'unused',
+			4  =&gt; 'unused',
+			5  =&gt; 'below Telephone (q = 0.0)',
+			6  =&gt; 'below Telephone (q = 1.0)',
+			7  =&gt; 'Telephone (q = 2.0)',
+			8  =&gt; 'Thumb (q = 3.0)',
+			9  =&gt; 'Radio (q = 4.0)',
+			10 =&gt; 'Standard (q = 5.0)',
+			11 =&gt; 'Extreme (q = 6.0)',
+			12 =&gt; 'Insane (q = 7.0)',
+			13 =&gt; 'BrainDead (q = 8.0)',
+			14 =&gt; 'above BrainDead (q = 9.0)',
+			15 =&gt; 'above BrainDead (q = 10.0)'
+		);
+		return (isset($MPCprofileNameLookup[$profileid]) ? $MPCprofileNameLookup[$profileid] : 'invalid');
+	}
+
+	function MPCfrequencyLookup($frequencyid) {
+		static $MPCfrequencyLookup = array(
+			0 =&gt; 44100,
+			1 =&gt; 48000,
+			2 =&gt; 37800,
+			3 =&gt; 32000
+		);
+		return (isset($MPCfrequencyLookup[$frequencyid]) ? $MPCfrequencyLookup[$frequencyid] : 'invalid');
+	}
+
+	function MPCpeakDBLookup($intvalue) {
+		if ($intvalue &gt; 0) {
+			return ((log10($intvalue) / log10(2)) - 15) * 6;
+		}
+		return false;
+	}
+
+	function MPCencoderVersionLookup($encoderversion) {
+		//Encoder version * 100  (106 = 1.06)
+		//EncoderVersion % 10 == 0        Release (1.0)
+		//EncoderVersion %  2 == 0        Beta (1.06)
+		//EncoderVersion %  2 == 1        Alpha (1.05a...z)
+
+		if ($encoderversion == 0) {
+			// very old version, not known exactly which
+			return 'Buschmann v1.7.0-v1.7.9 or Klemm v0.90-v1.05';
+		}
+
+		if (($encoderversion % 10) == 0) {
+
+			// release version
+			return number_format($encoderversion / 100, 2);
+
+		} elseif (($encoderversion % 2) == 0) {
+
+			// beta version
+			return number_format($encoderversion / 100, 2).' beta';
+
+		}
+
+		// alpha version
+		return number_format($encoderversion / 100, 2).' alpha';
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.mpc.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.ogg.php
===================================================================
--- trunk/inc/external/getid3/module.audio.ogg.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.ogg.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,543 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.ogg.php                                        //
+// module for analyzing Ogg Vorbis, OggFLAC and Speex files    //
+// dependencies: module.audio.flac.php                         //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio.flac.php', __FILE__, true);
+
+class getid3_ogg
+{
+
+	function getid3_ogg(&amp;$fd, &amp;$ThisFileInfo) {
+
+		$ThisFileInfo['fileformat'] = 'ogg';
+
+		// Warn about illegal tags - only vorbiscomments are allowed
+		if (isset($ThisFileInfo['id3v2'])) {
+			$ThisFileInfo['warning'][] = 'Illegal ID3v2 tag present.';
+		}
+		if (isset($ThisFileInfo['id3v1'])) {
+			$ThisFileInfo['warning'][] = 'Illegal ID3v1 tag present.';
+		}
+		if (isset($ThisFileInfo['ape'])) {
+			$ThisFileInfo['warning'][] = 'Illegal APE tag present.';
+		}
+
+
+		// Page 1 - Stream Header
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+
+		$oggpageinfo = getid3_ogg::ParseOggPageHeader($fd);
+		$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']] = $oggpageinfo;
+
+		if (ftell($fd) &gt;= GETID3_FREAD_BUFFER_SIZE) {
+			$ThisFileInfo['error'][] = 'Could not find start of Ogg page in the first '.GETID3_FREAD_BUFFER_SIZE.' bytes (this might not be an Ogg-Vorbis file?)';
+			unset($ThisFileInfo['fileformat']);
+			unset($ThisFileInfo['ogg']);
+			return false;
+		}
+
+		$filedata = fread($fd, $oggpageinfo['page_length']);
+		$filedataoffset = 0;
+
+		if (substr($filedata, 0, 4) == 'fLaC') {
+
+			$ThisFileInfo['audio']['dataformat']   = 'flac';
+			$ThisFileInfo['audio']['bitrate_mode'] = 'vbr';
+			$ThisFileInfo['audio']['lossless']     = true;
+
+		} elseif (substr($filedata, 1, 6) == 'vorbis') {
+
+			$ThisFileInfo['audio']['dataformat'] = 'vorbis';
+			$ThisFileInfo['audio']['lossless']   = false;
+
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['packet_type'] = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 1));
+			$filedataoffset += 1;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['stream_type'] = substr($filedata, $filedataoffset, 6); // hard-coded to 'vorbis'
+			$filedataoffset += 6;
+			$ThisFileInfo['ogg']['bitstreamversion'] = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['numberofchannels'] = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 1));
+			$filedataoffset += 1;
+			$ThisFileInfo['audio']['channels']                = $ThisFileInfo['ogg']['numberofchannels'];
+			$ThisFileInfo['ogg']['samplerate']       = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			if ($ThisFileInfo['ogg']['samplerate'] == 0) {
+				$ThisFileInfo['error'][] = 'Corrupt Ogg file: sample rate == zero';
+				return false;
+			}
+			$ThisFileInfo['audio']['sample_rate']               = $ThisFileInfo['ogg']['samplerate'];
+			$ThisFileInfo['ogg']['samples']          = 0; // filled in later
+			$ThisFileInfo['ogg']['bitrate_average']  = 0; // filled in later
+			$ThisFileInfo['ogg']['bitrate_max']      = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['bitrate_nominal']  = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['bitrate_min']      = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['blocksize_small']  = pow(2,  getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 1)) &amp; 0x0F);
+			$ThisFileInfo['ogg']['blocksize_large']  = pow(2, (getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 1)) &amp; 0xF0) &gt;&gt; 4);
+			$ThisFileInfo['ogg']['stop_bit']         = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 1)); // must be 1, marks end of packet
+
+			$ThisFileInfo['audio']['bitrate_mode'] = 'vbr'; // overridden if actually abr
+			if ($ThisFileInfo['ogg']['bitrate_max'] == 0xFFFFFFFF) {
+				unset($ThisFileInfo['ogg']['bitrate_max']);
+				$ThisFileInfo['audio']['bitrate_mode'] = 'abr';
+			}
+			if ($ThisFileInfo['ogg']['bitrate_nominal'] == 0xFFFFFFFF) {
+				unset($ThisFileInfo['ogg']['bitrate_nominal']);
+			}
+			if ($ThisFileInfo['ogg']['bitrate_min'] == 0xFFFFFFFF) {
+				unset($ThisFileInfo['ogg']['bitrate_min']);
+				$ThisFileInfo['audio']['bitrate_mode'] = 'abr';
+			}
+
+		} elseif (substr($filedata, 0, 8) == 'Speex   ') {
+
+			// <A HREF="http://www.speex.org/manual/node10.html">http://www.speex.org/manual/node10.html</A>
+
+			$ThisFileInfo['audio']['dataformat']   = 'speex';
+			$ThisFileInfo['mime_type']             = 'audio/speex';
+			$ThisFileInfo['audio']['bitrate_mode'] = 'abr';
+			$ThisFileInfo['audio']['lossless']     = false;
+
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['speex_string']           =                  substr($filedata, $filedataoffset, 8); // hard-coded to 'Speex   '
+			$filedataoffset += 8;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['speex_version']          =                  substr($filedata, $filedataoffset, 20);
+			$filedataoffset += 20;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['speex_version_id']       = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['header_size']            = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['rate']                   = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['mode']                   = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['mode_bitstream_version'] = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['nb_channels']            = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['bitrate']                = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['framesize']              = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['vbr']                    = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['frames_per_packet']      = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['extra_headers']          = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['reserved1']              = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+			$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['reserved2']              = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+			$filedataoffset += 4;
+
+			$ThisFileInfo['speex']['speex_version'] = trim($ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['speex_version']);
+			$ThisFileInfo['speex']['sample_rate']   = $ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['rate'];
+			$ThisFileInfo['speex']['channels']      = $ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['nb_channels'];
+			$ThisFileInfo['speex']['vbr']           = (bool) $ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['vbr'];
+			$ThisFileInfo['speex']['band_type']     = getid3_ogg::SpeexBandModeLookup($ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['mode']);
+
+			$ThisFileInfo['audio']['sample_rate']   = $ThisFileInfo['speex']['sample_rate'];
+			$ThisFileInfo['audio']['channels']      = $ThisFileInfo['speex']['channels'];
+			if ($ThisFileInfo['speex']['vbr']) {
+				$ThisFileInfo['audio']['bitrate_mode'] = 'vbr';
+			}
+
+		} else {
+
+			$ThisFileInfo['error'][] = 'Expecting either &quot;Speex   &quot; or &quot;vorbis&quot; identifier strings, found neither';
+			unset($ThisFileInfo['ogg']);
+			unset($ThisFileInfo['mime_type']);
+			return false;
+
+		}
+
+
+		// Page 2 - Comment Header
+
+		$oggpageinfo = getid3_ogg::ParseOggPageHeader($fd);
+		$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']] = $oggpageinfo;
+
+		switch ($ThisFileInfo['audio']['dataformat']) {
+
+			case 'vorbis':
+				$filedata = fread($fd, $ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['page_length']);
+				$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['packet_type'] = getid3_lib::LittleEndian2Int(substr($filedata, 0, 1));
+				$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['stream_type'] =                  substr($filedata, 1, 6); // hard-coded to 'vorbis'
+
+				getid3_ogg::ParseVorbisCommentsFilepointer($fd, $ThisFileInfo);
+				break;
+
+			case 'flac':
+				if (!getid3_flac::FLACparseMETAdata($fd, $ThisFileInfo)) {
+					$ThisFileInfo['error'][] = 'Failed to parse FLAC headers';
+					return false;
+				}
+				break;
+
+			case 'speex':
+				fseek($fd, $ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['page_length'], SEEK_CUR);
+				getid3_ogg::ParseVorbisCommentsFilepointer($fd, $ThisFileInfo);
+				break;
+
+		}
+
+
+
+		// Last Page - Number of Samples
+
+		fseek($fd, max($ThisFileInfo['avdataend'] - GETID3_FREAD_BUFFER_SIZE, 0), SEEK_SET);
+		$LastChunkOfOgg = strrev(fread($fd, GETID3_FREAD_BUFFER_SIZE));
+		if ($LastOggSpostion = strpos($LastChunkOfOgg, 'SggO')) {
+			fseek($fd, $ThisFileInfo['avdataend'] - ($LastOggSpostion + strlen('SggO')), SEEK_SET);
+			$ThisFileInfo['avdataend'] = ftell($fd);
+			$ThisFileInfo['ogg']['pageheader']['eos'] = getid3_ogg::ParseOggPageHeader($fd);
+			$ThisFileInfo['ogg']['samples']   = $ThisFileInfo['ogg']['pageheader']['eos']['pcm_abs_position'];
+			if ($ThisFileInfo['ogg']['samples'] == 0) {
+				$ThisFileInfo['error'][] = 'Corrupt Ogg file: eos.number of samples == zero';
+				return false;
+			}
+			$ThisFileInfo['ogg']['bitrate_average'] = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / ($ThisFileInfo['ogg']['samples'] / $ThisFileInfo['audio']['sample_rate']);
+		}
+
+		if (!empty($ThisFileInfo['ogg']['bitrate_average'])) {
+			$ThisFileInfo['audio']['bitrate'] = $ThisFileInfo['ogg']['bitrate_average'];
+		} elseif (!empty($ThisFileInfo['ogg']['bitrate_nominal'])) {
+			$ThisFileInfo['audio']['bitrate'] = $ThisFileInfo['ogg']['bitrate_nominal'];
+		} elseif (!empty($ThisFileInfo['ogg']['bitrate_min']) &amp;&amp; !empty($ThisFileInfo['ogg']['bitrate_max'])) {
+			$ThisFileInfo['audio']['bitrate'] = ($ThisFileInfo['ogg']['bitrate_min'] + $ThisFileInfo['ogg']['bitrate_max']) / 2;
+		}
+		if (isset($ThisFileInfo['audio']['bitrate']) &amp;&amp; !isset($ThisFileInfo['playtime_seconds'])) {
+			if ($ThisFileInfo['audio']['bitrate'] == 0) {
+				$ThisFileInfo['error'][] = 'Corrupt Ogg file: bitrate_audio == zero';
+				return false;
+			}
+			$ThisFileInfo['playtime_seconds'] = (float) ((($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['audio']['bitrate']);
+		}
+
+		if (isset($ThisFileInfo['ogg']['vendor'])) {
+			$ThisFileInfo['audio']['encoder'] = preg_replace('/^Encoded with /', '', $ThisFileInfo['ogg']['vendor']);
+
+			// Vorbis only
+			if ($ThisFileInfo['audio']['dataformat'] == 'vorbis') {
+
+				// Vorbis 1.0 starts with Xiph.Org
+				if  (preg_match('/^Xiph.Org/', $ThisFileInfo['audio']['encoder'])) {
+
+					if ($ThisFileInfo['audio']['bitrate_mode'] == 'abr') {
+
+						// Set -b 128 on abr files
+						$ThisFileInfo['audio']['encoder_options'] = '-b '.round($ThisFileInfo['ogg']['bitrate_nominal'] / 1000);
+
+					} elseif (($ThisFileInfo['audio']['bitrate_mode'] == 'vbr') &amp;&amp; ($ThisFileInfo['audio']['channels'] == 2) &amp;&amp; ($ThisFileInfo['audio']['sample_rate'] &gt;= 44100) &amp;&amp; ($ThisFileInfo['audio']['sample_rate'] &lt;= 48000)) {
+						// Set -q N on vbr files
+						$ThisFileInfo['audio']['encoder_options'] = '-q '.$this-&gt;get_quality_from_nominal_bitrate($ThisFileInfo['ogg']['bitrate_nominal']);
+
+					}
+				}
+
+				if (empty($ThisFileInfo['audio']['encoder_options']) &amp;&amp; !empty($ThisFileInfo['ogg']['bitrate_nominal'])) {
+					$ThisFileInfo['audio']['encoder_options'] = 'Nominal bitrate: '.intval(round($ThisFileInfo['ogg']['bitrate_nominal'] / 1000)).'kbps';
+				}
+			}
+		}
+
+		return true;
+	}
+
+
+	function ParseOggPageHeader(&amp;$fd) {
+		// <A HREF="http://xiph.org/ogg/vorbis/doc/framing.html">http://xiph.org/ogg/vorbis/doc/framing.html</A>
+		$oggheader['page_start_offset'] = ftell($fd); // where we started from in the file
+
+		$filedata = fread($fd, GETID3_FREAD_BUFFER_SIZE);
+		$filedataoffset = 0;
+		while ((substr($filedata, $filedataoffset++, 4) != 'OggS')) {
+			if ((ftell($fd) - $oggheader['page_start_offset']) &gt;= GETID3_FREAD_BUFFER_SIZE) {
+				// should be found before here
+				return false;
+			}
+			if ((($filedataoffset + 28) &gt; strlen($filedata)) || (strlen($filedata) &lt; 28)) {
+				if (feof($fd) || (($filedata .= fread($fd, GETID3_FREAD_BUFFER_SIZE)) === false)) {
+					// get some more data, unless eof, in which case fail
+					return false;
+				}
+			}
+		}
+		$filedataoffset += strlen('OggS') - 1; // page, delimited by 'OggS'
+
+		$oggheader['stream_structver']  = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 1));
+		$filedataoffset += 1;
+		$oggheader['flags_raw']         = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 1));
+		$filedataoffset += 1;
+		$oggheader['flags']['fresh']    = (bool) ($oggheader['flags_raw'] &amp; 0x01); // fresh packet
+		$oggheader['flags']['bos']      = (bool) ($oggheader['flags_raw'] &amp; 0x02); // first page of logical bitstream (bos)
+		$oggheader['flags']['eos']      = (bool) ($oggheader['flags_raw'] &amp; 0x04); // last page of logical bitstream (eos)
+
+		$oggheader['pcm_abs_position']  = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 8));
+		$filedataoffset += 8;
+		$oggheader['stream_serialno']   = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+		$filedataoffset += 4;
+		$oggheader['page_seqno']        = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+		$filedataoffset += 4;
+		$oggheader['page_checksum']     = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 4));
+		$filedataoffset += 4;
+		$oggheader['page_segments']     = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 1));
+		$filedataoffset += 1;
+		$oggheader['page_length'] = 0;
+		for ($i = 0; $i &lt; $oggheader['page_segments']; $i++) {
+			$oggheader['segment_table'][$i] = getid3_lib::LittleEndian2Int(substr($filedata, $filedataoffset, 1));
+			$filedataoffset += 1;
+			$oggheader['page_length'] += $oggheader['segment_table'][$i];
+		}
+		$oggheader['header_end_offset'] = $oggheader['page_start_offset'] + $filedataoffset;
+		$oggheader['page_end_offset']   = $oggheader['header_end_offset'] + $oggheader['page_length'];
+		fseek($fd, $oggheader['header_end_offset'], SEEK_SET);
+
+		return $oggheader;
+	}
+
+
+	function ParseVorbisCommentsFilepointer(&amp;$fd, &amp;$ThisFileInfo) {
+
+		$OriginalOffset = ftell($fd);
+		$CommentStartOffset = $OriginalOffset;
+		$commentdataoffset = 0;
+		$VorbisCommentPage = 1;
+
+		switch ($ThisFileInfo['audio']['dataformat']) {
+			case 'vorbis':
+				$CommentStartOffset = $ThisFileInfo['ogg']['pageheader'][$VorbisCommentPage]['page_start_offset'];  // Second Ogg page, after header block
+				fseek($fd, $CommentStartOffset, SEEK_SET);
+				$commentdataoffset = 27 + $ThisFileInfo['ogg']['pageheader'][$VorbisCommentPage]['page_segments'];
+				$commentdata = fread($fd, getid3_ogg::OggPageSegmentLength($ThisFileInfo['ogg']['pageheader'][$VorbisCommentPage], 1) + $commentdataoffset);
+
+				$commentdataoffset += (strlen('vorbis') + 1);
+				break;
+
+			case 'flac':
+				fseek($fd, $ThisFileInfo['flac']['VORBIS_COMMENT']['raw']['offset'] + 4, SEEK_SET);
+				$commentdata = fread($fd, $ThisFileInfo['flac']['VORBIS_COMMENT']['raw']['block_length']);
+				break;
+
+			case 'speex':
+				$CommentStartOffset = $ThisFileInfo['ogg']['pageheader'][$VorbisCommentPage]['page_start_offset'];  // Second Ogg page, after header block
+				fseek($fd, $CommentStartOffset, SEEK_SET);
+				$commentdataoffset = 27 + $ThisFileInfo['ogg']['pageheader'][$VorbisCommentPage]['page_segments'];
+				$commentdata = fread($fd, getid3_ogg::OggPageSegmentLength($ThisFileInfo['ogg']['pageheader'][$VorbisCommentPage], 1) + $commentdataoffset);
+				break;
+
+			default:
+				return false;
+				break;
+		}
+
+		$VendorSize = getid3_lib::LittleEndian2Int(substr($commentdata, $commentdataoffset, 4));
+		$commentdataoffset += 4;
+
+		$ThisFileInfo['ogg']['vendor'] = substr($commentdata, $commentdataoffset, $VendorSize);
+		$commentdataoffset += $VendorSize;
+
+		$CommentsCount = getid3_lib::LittleEndian2Int(substr($commentdata, $commentdataoffset, 4));
+		$commentdataoffset += 4;
+		$ThisFileInfo['avdataoffset'] = $CommentStartOffset + $commentdataoffset;
+
+		$basicfields = array('TITLE', 'ARTIST', 'ALBUM', 'TRACKNUMBER', 'GENRE', 'DATE', 'DESCRIPTION', 'COMMENT');
+		for ($i = 0; $i &lt; $CommentsCount; $i++) {
+
+			$ThisFileInfo['ogg']['comments_raw'][$i]['dataoffset'] = $CommentStartOffset + $commentdataoffset;
+
+			if (ftell($fd) &lt; ($ThisFileInfo['ogg']['comments_raw'][$i]['dataoffset'] + 4)) {
+				$VorbisCommentPage++;
+
+				$oggpageinfo = getid3_ogg::ParseOggPageHeader($fd);
+				$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']] = $oggpageinfo;
+
+				// First, save what we haven't read yet
+				$AsYetUnusedData = substr($commentdata, $commentdataoffset);
+
+				// Then take that data off the end
+				$commentdata     = substr($commentdata, 0, $commentdataoffset);
+
+				// Add [headerlength] bytes of dummy data for the Ogg Page Header, just to keep absolute offsets correct
+				$commentdata .= str_repeat(&quot;\x00&quot;, 27 + $ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['page_segments']);
+				$commentdataoffset += (27 + $ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['page_segments']);
+
+				// Finally, stick the unused data back on the end
+				$commentdata .= $AsYetUnusedData;
+
+				//$commentdata .= fread($fd, $ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['page_length']);
+				$commentdata .= fread($fd, getid3_ogg::OggPageSegmentLength($ThisFileInfo['ogg']['pageheader'][$VorbisCommentPage], 1));
+
+			}
+			$ThisFileInfo['ogg']['comments_raw'][$i]['size']       = getid3_lib::LittleEndian2Int(substr($commentdata, $commentdataoffset, 4));
+
+			// replace avdataoffset with position just after the last vorbiscomment
+			$ThisFileInfo['avdataoffset'] = $ThisFileInfo['ogg']['comments_raw'][$i]['dataoffset'] + $ThisFileInfo['ogg']['comments_raw'][$i]['size'] + 4;
+
+			$commentdataoffset += 4;
+			while ((strlen($commentdata) - $commentdataoffset) &lt; $ThisFileInfo['ogg']['comments_raw'][$i]['size']) {
+				if (($ThisFileInfo['ogg']['comments_raw'][$i]['size'] &gt; $ThisFileInfo['avdataend']) || ($ThisFileInfo['ogg']['comments_raw'][$i]['size'] &lt; 0)) {
+					$ThisFileInfo['error'][] = 'Invalid Ogg comment size (comment #'.$i.', claims to be '.number_format($ThisFileInfo['ogg']['comments_raw'][$i]['size']).' bytes) - aborting reading comments';
+					break 2;
+				}
+
+				$VorbisCommentPage++;
+
+				$oggpageinfo = getid3_ogg::ParseOggPageHeader($fd);
+				$ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']] = $oggpageinfo;
+
+				// First, save what we haven't read yet
+				$AsYetUnusedData = substr($commentdata, $commentdataoffset);
+
+				// Then take that data off the end
+				$commentdata     = substr($commentdata, 0, $commentdataoffset);
+
+				// Add [headerlength] bytes of dummy data for the Ogg Page Header, just to keep absolute offsets correct
+				$commentdata .= str_repeat(&quot;\x00&quot;, 27 + $ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['page_segments']);
+				$commentdataoffset += (27 + $ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['page_segments']);
+
+				// Finally, stick the unused data back on the end
+				$commentdata .= $AsYetUnusedData;
+
+				//$commentdata .= fread($fd, $ThisFileInfo['ogg']['pageheader'][$oggpageinfo['page_seqno']]['page_length']);
+				$commentdata .= fread($fd, getid3_ogg::OggPageSegmentLength($ThisFileInfo['ogg']['pageheader'][$VorbisCommentPage], 1));
+
+				//$filebaseoffset += $oggpageinfo['header_end_offset'] - $oggpageinfo['page_start_offset'];
+			}
+			$commentstring = substr($commentdata, $commentdataoffset, $ThisFileInfo['ogg']['comments_raw'][$i]['size']);
+			$commentdataoffset += $ThisFileInfo['ogg']['comments_raw'][$i]['size'];
+
+			if (!$commentstring) {
+
+				// no comment?
+				$ThisFileInfo['warning'][] = 'Blank Ogg comment ['.$i.']';
+
+			} elseif (strstr($commentstring, '=')) {
+
+				$commentexploded = explode('=', $commentstring, 2);
+				$ThisFileInfo['ogg']['comments_raw'][$i]['key']   = strtoupper($commentexploded[0]);
+				$ThisFileInfo['ogg']['comments_raw'][$i]['value'] = @$commentexploded[1];
+				$ThisFileInfo['ogg']['comments_raw'][$i]['data']  = base64_decode($ThisFileInfo['ogg']['comments_raw'][$i]['value']);
+
+				$ThisFileInfo['ogg']['comments'][strtolower($ThisFileInfo['ogg']['comments_raw'][$i]['key'])][] = $ThisFileInfo['ogg']['comments_raw'][$i]['value'];
+
+				$imagechunkcheck = getid3_lib::GetDataImageSize($ThisFileInfo['ogg']['comments_raw'][$i]['data']);
+				$ThisFileInfo['ogg']['comments_raw'][$i]['image_mime'] = getid3_lib::image_type_to_mime_type($imagechunkcheck[2]);
+				if (!$ThisFileInfo['ogg']['comments_raw'][$i]['image_mime'] || ($ThisFileInfo['ogg']['comments_raw'][$i]['image_mime'] == 'application/octet-stream')) {
+					unset($ThisFileInfo['ogg']['comments_raw'][$i]['image_mime']);
+					unset($ThisFileInfo['ogg']['comments_raw'][$i]['data']);
+				}
+
+			} else {
+
+				$ThisFileInfo['warning'][] = '[known problem with CDex &gt;= v1.40, &lt; v1.50b7] Invalid Ogg comment name/value pair ['.$i.']: '.$commentstring;
+
+			}
+		}
+
+
+		// Replay Gain Adjustment
+		// <A HREF="http://privatewww.essex.ac.uk/~djmrob/replaygain/">http://privatewww.essex.ac.uk/~djmrob/replaygain/</A>
+		if (isset($ThisFileInfo['ogg']['comments']) &amp;&amp; is_array($ThisFileInfo['ogg']['comments'])) {
+			foreach ($ThisFileInfo['ogg']['comments'] as $index =&gt; $commentvalue) {
+				switch ($index) {
+					case 'rg_audiophile':
+					case 'replaygain_album_gain':
+						$ThisFileInfo['replay_gain']['album']['adjustment'] = (double) $commentvalue[0];
+						unset($ThisFileInfo['ogg']['comments'][$index]);
+						break;
+
+					case 'rg_radio':
+					case 'replaygain_track_gain':
+						$ThisFileInfo['replay_gain']['track']['adjustment'] = (double) $commentvalue[0];
+						unset($ThisFileInfo['ogg']['comments'][$index]);
+						break;
+
+					case 'replaygain_album_peak':
+						$ThisFileInfo['replay_gain']['album']['peak'] = (double) $commentvalue[0];
+						unset($ThisFileInfo['ogg']['comments'][$index]);
+						break;
+
+					case 'rg_peak':
+					case 'replaygain_track_peak':
+						$ThisFileInfo['replay_gain']['track']['peak'] = (double) $commentvalue[0];
+						unset($ThisFileInfo['ogg']['comments'][$index]);
+						break;
+
+
+					default:
+						// do nothing
+						break;
+				}
+			}
+		}
+
+		fseek($fd, $OriginalOffset, SEEK_SET);
+
+		return true;
+	}
+
+	function SpeexBandModeLookup($mode) {
+		static $SpeexBandModeLookup = array();
+		if (empty($SpeexBandModeLookup)) {
+			$SpeexBandModeLookup[0] = 'narrow';
+			$SpeexBandModeLookup[1] = 'wide';
+			$SpeexBandModeLookup[2] = 'ultra-wide';
+		}
+		return (isset($SpeexBandModeLookup[$mode]) ? $SpeexBandModeLookup[$mode] : null);
+	}
+
+
+	function OggPageSegmentLength($OggInfoArray, $SegmentNumber=1) {
+		for ($i = 0; $i &lt; $SegmentNumber; $i++) {
+			$segmentlength = 0;
+			foreach ($OggInfoArray['segment_table'] as $key =&gt; $value) {
+				$segmentlength += $value;
+				if ($value &lt; 255) {
+					break;
+				}
+			}
+		}
+		return $segmentlength;
+	}
+
+
+	function get_quality_from_nominal_bitrate($nominal_bitrate) {
+
+		// decrease precision
+		$nominal_bitrate = $nominal_bitrate / 1000;
+
+		if ($nominal_bitrate &lt; 128) {
+			// q-1 to q4
+			$qval = ($nominal_bitrate - 64) / 16;
+		} elseif ($nominal_bitrate &lt; 256) {
+			// q4 to q8
+			$qval = $nominal_bitrate / 32;
+		} elseif ($nominal_bitrate &lt; 320) {
+			// q8 to q9
+			$qval = ($nominal_bitrate + 256) / 64;
+		} else {
+			// q9 to q10
+			$qval = ($nominal_bitrate + 1300) / 180;
+		}
+		//return $qval; // 5.031324
+		//return intval($qval); // 5
+		return round($qval, 1); // 5 or 4.9
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.ogg.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.optimfrog.php
===================================================================
--- trunk/inc/external/getid3/module.audio.optimfrog.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.optimfrog.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,408 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.optimfrog.php                                  //
+// module for analyzing OptimFROG audio files                  //
+// dependencies: module.audio.riff.php                         //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio-video.riff.php', __FILE__, true);
+
+class getid3_optimfrog
+{
+
+	function getid3_optimfrog(&amp;$fd, &amp;$ThisFileInfo) {
+		$ThisFileInfo['fileformat']            = 'ofr';
+		$ThisFileInfo['audio']['dataformat']   = 'ofr';
+		$ThisFileInfo['audio']['bitrate_mode'] = 'vbr';
+		$ThisFileInfo['audio']['lossless']     = true;
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$OFRheader  = fread($fd, 8);
+		if (substr($OFRheader, 0, 5) == '*RIFF') {
+
+			return $this-&gt;ParseOptimFROGheader42($fd, $ThisFileInfo);
+
+		} elseif (substr($OFRheader, 0, 3) == 'OFR') {
+
+			return $this-&gt;ParseOptimFROGheader45($fd, $ThisFileInfo);
+
+		}
+
+		$ThisFileInfo['error'][] = 'Expecting &quot;*RIFF&quot; or &quot;OFR &quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.$OFRheader.'&quot;';
+		unset($ThisFileInfo['fileformat']);
+		return false;
+	}
+
+
+	function ParseOptimFROGheader42(&amp;$fd, &amp;$ThisFileInfo) {
+		// for fileformat of v4.21 and older
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$OptimFROGheaderData = fread($fd, 45);
+		$ThisFileInfo['avdataoffset'] = 45;
+
+		$OptimFROGencoderVersion_raw   = getid3_lib::LittleEndian2Int(substr($OptimFROGheaderData, 0, 1));
+		$OptimFROGencoderVersion_major = floor($OptimFROGencoderVersion_raw / 10);
+		$OptimFROGencoderVersion_minor = $OptimFROGencoderVersion_raw - ($OptimFROGencoderVersion_major * 10);
+		$RIFFdata                = substr($OptimFROGheaderData, 1, 44);
+		$OrignalRIFFheaderSize   = getid3_lib::LittleEndian2Int(substr($RIFFdata,  4, 4)) +  8;
+		$OrignalRIFFdataSize     = getid3_lib::LittleEndian2Int(substr($RIFFdata, 40, 4)) + 44;
+
+		if ($OrignalRIFFheaderSize &gt; $OrignalRIFFdataSize) {
+			$ThisFileInfo['avdataend'] -= ($OrignalRIFFheaderSize - $OrignalRIFFdataSize);
+			fseek($fd, $ThisFileInfo['avdataend'], SEEK_SET);
+			$RIFFdata .= fread($fd, $OrignalRIFFheaderSize - $OrignalRIFFdataSize);
+		}
+
+		// move the data chunk after all other chunks (if any)
+		// so that the RIFF parser doesn't see EOF when trying
+		// to skip over the data chunk
+		$RIFFdata = substr($RIFFdata, 0, 36).substr($RIFFdata, 44).substr($RIFFdata, 36, 8);
+		getid3_riff::ParseRIFFdata($RIFFdata, $ThisFileInfo);
+
+		$ThisFileInfo['audio']['encoder']         = 'OptimFROG '.$OptimFROGencoderVersion_major.'.'.$OptimFROGencoderVersion_minor;
+		$ThisFileInfo['audio']['channels']        = $ThisFileInfo['riff']['audio'][0]['channels'];
+		$ThisFileInfo['audio']['sample_rate']     = $ThisFileInfo['riff']['audio'][0]['sample_rate'];
+		$ThisFileInfo['audio']['bits_per_sample'] = $ThisFileInfo['riff']['audio'][0]['bits_per_sample'];
+		$ThisFileInfo['playtime_seconds']         = $OrignalRIFFdataSize / ($ThisFileInfo['audio']['channels'] * $ThisFileInfo['audio']['sample_rate'] * ($ThisFileInfo['audio']['bits_per_sample'] / 8));
+		$ThisFileInfo['audio']['bitrate']         = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['playtime_seconds'];
+
+		return true;
+	}
+
+
+	function ParseOptimFROGheader45(&amp;$fd, &amp;$ThisFileInfo) {
+		// for fileformat of v4.50a and higher
+
+		$RIFFdata = '';
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		while (!feof($fd) &amp;&amp; (ftell($fd) &lt; $ThisFileInfo['avdataend'])) {
+			$BlockOffset = ftell($fd);
+			$BlockData   = fread($fd, 8);
+			$offset      = 8;
+			$BlockName   =                  substr($BlockData, 0, 4);
+			$BlockSize   = getid3_lib::LittleEndian2Int(substr($BlockData, 4, 4));
+
+			if ($BlockName == 'OFRX') {
+				$BlockName = 'OFR ';
+			}
+			if (!isset($ThisFileInfo['ofr'][$BlockName])) {
+				$ThisFileInfo['ofr'][$BlockName] = array();
+			}
+			$thisfile_ofr_thisblock = &amp;$ThisFileInfo['ofr'][$BlockName];
+
+			switch ($BlockName) {
+				case 'OFR ':
+
+					// shortcut
+					$thisfile_ofr_thisblock['offset'] = $BlockOffset;
+					$thisfile_ofr_thisblock['size']   = $BlockSize;
+
+					$ThisFileInfo['audio']['encoder'] = 'OptimFROG 4.50 alpha';
+					switch ($BlockSize) {
+						case 12:
+						case 15:
+							// good
+							break;
+
+						default:
+							$ThisFileInfo['warning'][] = '&quot;'.$BlockName.'&quot; contains more data than expected (expected 12 or 15 bytes, found '.$BlockSize.' bytes)';
+							break;
+					}
+					$BlockData .= fread($fd, $BlockSize);
+
+					$thisfile_ofr_thisblock['total_samples']      = getid3_lib::LittleEndian2Int(substr($BlockData, $offset, 6));
+					$offset += 6;
+					$thisfile_ofr_thisblock['raw']['sample_type'] = getid3_lib::LittleEndian2Int(substr($BlockData, $offset, 1));
+					$thisfile_ofr_thisblock['sample_type']        = $this-&gt;OptimFROGsampleTypeLookup($thisfile_ofr_thisblock['raw']['sample_type']);
+					$offset += 1;
+					$thisfile_ofr_thisblock['channel_config']     = getid3_lib::LittleEndian2Int(substr($BlockData, $offset, 1));
+					$thisfile_ofr_thisblock['channels']           = $thisfile_ofr_thisblock['channel_config'];
+					$offset += 1;
+					$thisfile_ofr_thisblock['sample_rate']        = getid3_lib::LittleEndian2Int(substr($BlockData, $offset, 4));
+					$offset += 4;
+
+					if ($BlockSize &gt; 12) {
+
+						// OFR 4.504b or higher
+						$thisfile_ofr_thisblock['channels']           = $this-&gt;OptimFROGchannelConfigNumChannelsLookup($thisfile_ofr_thisblock['channel_config']);
+						$thisfile_ofr_thisblock['raw']['encoder_id']  = getid3_lib::LittleEndian2Int(substr($BlockData, $offset, 2));
+						$thisfile_ofr_thisblock['encoder']            = $this-&gt;OptimFROGencoderNameLookup($thisfile_ofr_thisblock['raw']['encoder_id']);
+						$offset += 2;
+						$thisfile_ofr_thisblock['raw']['compression'] = getid3_lib::LittleEndian2Int(substr($BlockData, $offset, 1));
+						$thisfile_ofr_thisblock['compression']        = $this-&gt;OptimFROGcompressionLookup($thisfile_ofr_thisblock['raw']['compression']);
+						$thisfile_ofr_thisblock['speedup']            = $this-&gt;OptimFROGspeedupLookup($thisfile_ofr_thisblock['raw']['compression']);
+						$offset += 1;
+
+						$ThisFileInfo['audio']['encoder']         = 'OptimFROG '.$thisfile_ofr_thisblock['encoder'];
+						$ThisFileInfo['audio']['encoder_options'] = '--mode '.$thisfile_ofr_thisblock['compression'];
+
+						if ((($thisfile_ofr_thisblock['raw']['encoder_id'] &amp; 0xF0) &gt;&gt; 4) == 7) { // v4.507
+							if (strtolower(getid3_lib::fileextension($ThisFileInfo['filename'])) == 'ofs') {
+								// OptimFROG DualStream format is lossy, but as of v4.507 there is no way to tell the difference
+								// between lossless and lossy other than the file extension.
+								$ThisFileInfo['audio']['dataformat']   = 'ofs';
+								$ThisFileInfo['audio']['lossless']     = true;
+							}
+						}
+
+					}
+
+					$ThisFileInfo['audio']['channels']        = $thisfile_ofr_thisblock['channels'];
+					$ThisFileInfo['audio']['sample_rate']     = $thisfile_ofr_thisblock['sample_rate'];
+					$ThisFileInfo['audio']['bits_per_sample'] = $this-&gt;OptimFROGbitsPerSampleTypeLookup($thisfile_ofr_thisblock['raw']['sample_type']);
+					break;
+
+
+				case 'COMP':
+					// unlike other block types, there CAN be multiple COMP blocks
+
+					$COMPdata['offset'] = $BlockOffset;
+					$COMPdata['size']   = $BlockSize;
+
+					if ($ThisFileInfo['avdataoffset'] == 0) {
+						$ThisFileInfo['avdataoffset'] = $BlockOffset;
+					}
+
+					// Only interested in first 14 bytes (only first 12 needed for v4.50 alpha), not actual audio data
+					$BlockData .= fread($fd, 14);
+					fseek($fd, $BlockSize - 14, SEEK_CUR);
+
+					$COMPdata['crc_32']                       = getid3_lib::LittleEndian2Int(substr($BlockData, $offset, 4));
+					$offset += 4;
+					$COMPdata['sample_count']                 = getid3_lib::LittleEndian2Int(substr($BlockData, $offset, 4));
+					$offset += 4;
+					$COMPdata['raw']['sample_type']           = getid3_lib::LittleEndian2Int(substr($BlockData, $offset, 1));
+					$COMPdata['sample_type']                  = $this-&gt;OptimFROGsampleTypeLookup($COMPdata['raw']['sample_type']);
+					$offset += 1;
+					$COMPdata['raw']['channel_configuration'] = getid3_lib::LittleEndian2Int(substr($BlockData, $offset, 1));
+					$COMPdata['channel_configuration']        = $this-&gt;OptimFROGchannelConfigurationLookup($COMPdata['raw']['channel_configuration']);
+					$offset += 1;
+					$COMPdata['raw']['algorithm_id']          = getid3_lib::LittleEndian2Int(substr($BlockData, $offset, 2));
+					//$COMPdata['algorithm']                    = OptimFROGalgorithmNameLookup($COMPdata['raw']['algorithm_id']);
+					$offset += 2;
+
+					if ($ThisFileInfo['ofr']['OFR ']['size'] &gt; 12) {
+
+						// OFR 4.504b or higher
+						$COMPdata['raw']['encoder_id']        = getid3_lib::LittleEndian2Int(substr($BlockData, $offset, 2));
+						$COMPdata['encoder']                  = $this-&gt;OptimFROGencoderNameLookup($COMPdata['raw']['encoder_id']);
+						$offset += 2;
+
+					}
+
+					if ($COMPdata['crc_32'] == 0x454E4F4E) {
+						// ASCII value of 'NONE' - placeholder value in v4.50a
+						$COMPdata['crc_32'] = false;
+					}
+
+					$thisfile_ofr_thisblock[] = $COMPdata;
+					break;
+
+				case 'HEAD':
+					$thisfile_ofr_thisblock['offset'] = $BlockOffset;
+					$thisfile_ofr_thisblock['size']   = $BlockSize;
+
+					$RIFFdata .= fread($fd, $BlockSize);
+					break;
+
+				case 'TAIL':
+					$thisfile_ofr_thisblock['offset'] = $BlockOffset;
+					$thisfile_ofr_thisblock['size']   = $BlockSize;
+
+					if ($BlockSize &gt; 0) {
+						$RIFFdata .= fread($fd, $BlockSize);
+					}
+					break;
+
+				case 'RECV':
+					// block contains no useful meta data - simply note and skip
+
+					$thisfile_ofr_thisblock['offset'] = $BlockOffset;
+					$thisfile_ofr_thisblock['size']   = $BlockSize;
+
+					fseek($fd, $BlockSize, SEEK_CUR);
+					break;
+
+
+				case 'APET':
+					// APEtag v2
+
+					$thisfile_ofr_thisblock['offset'] = $BlockOffset;
+					$thisfile_ofr_thisblock['size']   = $BlockSize;
+					$ThisFileInfo['warning'][] = 'APEtag processing inside OptimFROG not supported in this version ('.GETID3_VERSION.') of getID3()';
+
+					fseek($fd, $BlockSize, SEEK_CUR);
+					break;
+
+
+				case 'MD5 ':
+					// APEtag v2
+
+					$thisfile_ofr_thisblock['offset'] = $BlockOffset;
+					$thisfile_ofr_thisblock['size']   = $BlockSize;
+
+					if ($BlockSize == 16) {
+
+						$thisfile_ofr_thisblock['md5_binary'] = fread($fd, $BlockSize);
+						$thisfile_ofr_thisblock['md5_string'] = getid3_lib::PrintHexBytes($thisfile_ofr_thisblock['md5_binary'], true, false, false);
+						$ThisFileInfo['md5_data_source'] = $thisfile_ofr_thisblock['md5_string'];
+
+					} else {
+
+						$ThisFileInfo['warning'][] = 'Expecting block size of 16 in &quot;MD5 &quot; chunk, found '.$BlockSize.' instead';
+						fseek($fd, $BlockSize, SEEK_CUR);
+
+					}
+					break;
+
+
+				default:
+					$thisfile_ofr_thisblock['offset'] = $BlockOffset;
+					$thisfile_ofr_thisblock['size']   = $BlockSize;
+
+					$ThisFileInfo['warning'][] = 'Unhandled OptimFROG block type &quot;'.$BlockName.'&quot; at offset '.$thisfile_ofr_thisblock['offset'];
+					fseek($fd, $BlockSize, SEEK_CUR);
+					break;
+			}
+		}
+		if (isset($ThisFileInfo['ofr']['TAIL']['offset'])) {
+			$ThisFileInfo['avdataend'] = $ThisFileInfo['ofr']['TAIL']['offset'];
+		}
+
+		$ThisFileInfo['playtime_seconds'] = (float) $ThisFileInfo['ofr']['OFR ']['total_samples'] / ($ThisFileInfo['audio']['channels'] * $ThisFileInfo['audio']['sample_rate']);
+		$ThisFileInfo['audio']['bitrate'] = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['playtime_seconds'];
+
+		// move the data chunk after all other chunks (if any)
+		// so that the RIFF parser doesn't see EOF when trying
+		// to skip over the data chunk
+		$RIFFdata = substr($RIFFdata, 0, 36).substr($RIFFdata, 44).substr($RIFFdata, 36, 8);
+		getid3_riff::ParseRIFFdata($RIFFdata, $ThisFileInfo);
+
+		return true;
+	}
+
+
+	function OptimFROGsampleTypeLookup($SampleType) {
+		static $OptimFROGsampleTypeLookup = array(
+			0  =&gt; 'unsigned int (8-bit)',
+			1  =&gt; 'signed int (8-bit)',
+			2  =&gt; 'unsigned int (16-bit)',
+			3  =&gt; 'signed int (16-bit)',
+			4  =&gt; 'unsigned int (24-bit)',
+			5  =&gt; 'signed int (24-bit)',
+			6  =&gt; 'unsigned int (32-bit)',
+			7  =&gt; 'signed int (32-bit)',
+			8  =&gt; 'float 0.24 (32-bit)',
+			9  =&gt; 'float 16.8 (32-bit)',
+			10 =&gt; 'float 24.0 (32-bit)'
+		);
+		return (isset($OptimFROGsampleTypeLookup[$SampleType]) ? $OptimFROGsampleTypeLookup[$SampleType] : false);
+	}
+
+	function OptimFROGbitsPerSampleTypeLookup($SampleType) {
+		static $OptimFROGbitsPerSampleTypeLookup = array(
+			0  =&gt; 8,
+			1  =&gt; 8,
+			2  =&gt; 16,
+			3  =&gt; 16,
+			4  =&gt; 24,
+			5  =&gt; 24,
+			6  =&gt; 32,
+			7  =&gt; 32,
+			8  =&gt; 32,
+			9  =&gt; 32,
+			10 =&gt; 32
+		);
+		return (isset($OptimFROGbitsPerSampleTypeLookup[$SampleType]) ? $OptimFROGbitsPerSampleTypeLookup[$SampleType] : false);
+	}
+
+	function OptimFROGchannelConfigurationLookup($ChannelConfiguration) {
+		static $OptimFROGchannelConfigurationLookup = array(
+			0 =&gt; 'mono',
+			1 =&gt; 'stereo'
+		);
+		return (isset($OptimFROGchannelConfigurationLookup[$ChannelConfiguration]) ? $OptimFROGchannelConfigurationLookup[$ChannelConfiguration] : false);
+	}
+
+	function OptimFROGchannelConfigNumChannelsLookup($ChannelConfiguration) {
+		static $OptimFROGchannelConfigNumChannelsLookup = array(
+			0 =&gt; 1,
+			1 =&gt; 2
+		);
+		return (isset($OptimFROGchannelConfigNumChannelsLookup[$ChannelConfiguration]) ? $OptimFROGchannelConfigNumChannelsLookup[$ChannelConfiguration] : false);
+	}
+
+
+
+	// function OptimFROGalgorithmNameLookup($AlgorithID) {
+	//     static $OptimFROGalgorithmNameLookup = array();
+	//     return (isset($OptimFROGalgorithmNameLookup[$AlgorithID]) ? $OptimFROGalgorithmNameLookup[$AlgorithID] : false);
+	// }
+
+
+	function OptimFROGencoderNameLookup($EncoderID) {
+		// version = (encoderID &gt;&gt; 4) + 4500
+		// system  =  encoderID &amp; 0xF
+
+		$EncoderVersion  = number_format(((($EncoderID &amp; 0xF0) &gt;&gt; 4) + 4500) / 1000, 3);
+		$EncoderSystemID = ($EncoderID &amp; 0x0F);
+
+		static $OptimFROGencoderSystemLookup = array(
+			0x00 =&gt; 'Windows console',
+			0x01 =&gt; 'Linux console',
+			0x0F =&gt; 'unknown'
+		);
+		return $EncoderVersion.' ('.(isset($OptimFROGencoderSystemLookup[$EncoderSystemID]) ? $OptimFROGencoderSystemLookup[$EncoderSystemID] : 'undefined encoder type (0x'.dechex($EncoderSystemID).')').')';
+	}
+
+	function OptimFROGcompressionLookup($CompressionID) {
+		// mode    = compression &gt;&gt; 3
+		// speedup = compression &amp; 0x07
+
+		$CompressionModeID    = ($CompressionID &amp; 0xF8) &gt;&gt; 3;
+		//$CompressionSpeedupID = ($CompressionID &amp; 0x07);
+
+		static $OptimFROGencoderModeLookup = array(
+			0x00 =&gt; 'fast',
+			0x01 =&gt; 'normal',
+			0x02 =&gt; 'high',
+			0x03 =&gt; 'extra', // extranew (some versions)
+			0x04 =&gt; 'best',  // bestnew (some versions)
+			0x05 =&gt; 'ultra',
+			0x06 =&gt; 'insane',
+			0x07 =&gt; 'highnew',
+			0x08 =&gt; 'extranew',
+			0x09 =&gt; 'bestnew'
+		);
+		return (isset($OptimFROGencoderModeLookup[$CompressionModeID]) ? $OptimFROGencoderModeLookup[$CompressionModeID] : 'undefined mode (0x'.str_pad(dechex($CompressionModeID), 2, '0', STR_PAD_LEFT).')');
+	}
+
+	function OptimFROGspeedupLookup($CompressionID) {
+		// mode    = compression &gt;&gt; 3
+		// speedup = compression &amp; 0x07
+
+		//$CompressionModeID    = ($CompressionID &amp; 0xF8) &gt;&gt; 3;
+		$CompressionSpeedupID = ($CompressionID &amp; 0x07);
+
+		static $OptimFROGencoderSpeedupLookup = array(
+			0x00 =&gt; '1x',
+			0x01 =&gt; '2x',
+			0x02 =&gt; '4x'
+		);
+
+		return (isset($OptimFROGencoderSpeedupLookup[$CompressionSpeedupID]) ? $OptimFROGencoderSpeedupLookup[$CompressionSpeedupID] : 'undefined mode (0x'.dechex($CompressionSpeedupID));
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.optimfrog.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.rkau.php
===================================================================
--- trunk/inc/external/getid3/module.audio.rkau.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.rkau.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,92 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.shorten.php                                    //
+// module for analyzing Shorten Audio files                    //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_rkau
+{
+
+	function getid3_rkau(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$RKAUHeader = fread($fd, 20);
+		if (substr($RKAUHeader, 0, 3) != 'RKA') {
+			$ThisFileInfo['error'][] = 'Expecting &quot;RKA&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.substr($RKAUHeader, 0, 3).'&quot;';
+			return false;
+		}
+
+		$ThisFileInfo['fileformat']            = 'rkau';
+		$ThisFileInfo['audio']['dataformat']   = 'rkau';
+		$ThisFileInfo['audio']['bitrate_mode'] = 'vbr';
+
+		$ThisFileInfo['rkau']['raw']['version']   = getid3_lib::LittleEndian2Int(substr($RKAUHeader, 3, 1));
+		$ThisFileInfo['rkau']['version']          = '1.'.str_pad($ThisFileInfo['rkau']['raw']['version'] &amp; 0x0F, 2, '0', STR_PAD_LEFT);
+		if (($ThisFileInfo['rkau']['version'] &gt; 1.07) || ($ThisFileInfo['rkau']['version'] &lt; 1.06)) {
+			$ThisFileInfo['error'][] = 'This version of getID3() can only parse RKAU files v1.06 and 1.07 (this file is v'.$ThisFileInfo['rkau']['version'].')';
+			unset($ThisFileInfo['rkau']);
+			return false;
+		}
+
+		$ThisFileInfo['rkau']['source_bytes']     = getid3_lib::LittleEndian2Int(substr($RKAUHeader,  4, 4));
+		$ThisFileInfo['rkau']['sample_rate']      = getid3_lib::LittleEndian2Int(substr($RKAUHeader,  8, 4));
+		$ThisFileInfo['rkau']['channels']         = getid3_lib::LittleEndian2Int(substr($RKAUHeader, 12, 1));
+		$ThisFileInfo['rkau']['bits_per_sample']  = getid3_lib::LittleEndian2Int(substr($RKAUHeader, 13, 1));
+
+		$ThisFileInfo['rkau']['raw']['quality']   = getid3_lib::LittleEndian2Int(substr($RKAUHeader, 14, 1));
+		$this-&gt;RKAUqualityLookup($ThisFileInfo['rkau']);
+
+		$ThisFileInfo['rkau']['raw']['flags']            = getid3_lib::LittleEndian2Int(substr($RKAUHeader, 15, 1));
+		$ThisFileInfo['rkau']['flags']['joint_stereo']   = (bool) (!($ThisFileInfo['rkau']['raw']['flags'] &amp; 0x01));
+		$ThisFileInfo['rkau']['flags']['streaming']      =  (bool)  ($ThisFileInfo['rkau']['raw']['flags'] &amp; 0x02);
+		$ThisFileInfo['rkau']['flags']['vrq_lossy_mode'] =  (bool)  ($ThisFileInfo['rkau']['raw']['flags'] &amp; 0x04);
+
+		if ($ThisFileInfo['rkau']['flags']['streaming']) {
+			$ThisFileInfo['avdataoffset'] += 20;
+			$ThisFileInfo['rkau']['compressed_bytes']  = getid3_lib::LittleEndian2Int(substr($RKAUHeader, 16, 4));
+		} else {
+			$ThisFileInfo['avdataoffset'] += 16;
+			$ThisFileInfo['rkau']['compressed_bytes'] = $ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset'] - 1;
+		}
+		// Note: compressed_bytes does not always equal what appears to be the actual number of compressed bytes,
+		// sometimes it's more, sometimes less. No idea why(?)
+
+		$ThisFileInfo['audio']['lossless']        = $ThisFileInfo['rkau']['lossless'];
+		$ThisFileInfo['audio']['channels']        = $ThisFileInfo['rkau']['channels'];
+		$ThisFileInfo['audio']['bits_per_sample'] = $ThisFileInfo['rkau']['bits_per_sample'];
+		$ThisFileInfo['audio']['sample_rate']     = $ThisFileInfo['rkau']['sample_rate'];
+
+		$ThisFileInfo['playtime_seconds']         = $ThisFileInfo['rkau']['source_bytes'] / ($ThisFileInfo['rkau']['sample_rate'] * $ThisFileInfo['rkau']['channels'] * ($ThisFileInfo['rkau']['bits_per_sample'] / 8));
+		$ThisFileInfo['audio']['bitrate']         = ($ThisFileInfo['rkau']['compressed_bytes'] * 8) / $ThisFileInfo['playtime_seconds'];
+
+		return true;
+
+	}
+
+
+	function RKAUqualityLookup(&amp;$RKAUdata) {
+		$level   = ($RKAUdata['raw']['quality'] &amp; 0xF0) &gt;&gt; 4;
+		$quality =  $RKAUdata['raw']['quality'] &amp; 0x0F;
+
+		$RKAUdata['lossless']          = (($quality == 0) ? true : false);
+		$RKAUdata['compression_level'] = $level + 1;
+		if (!$RKAUdata['lossless']) {
+			$RKAUdata['quality_setting'] = $quality;
+		}
+
+		return true;
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.rkau.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.shorten.php
===================================================================
--- trunk/inc/external/getid3/module.audio.shorten.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.shorten.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,178 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.shorten.php                                    //
+// module for analyzing Shorten Audio files                    //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_shorten
+{
+
+	function getid3_shorten(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+
+		$ShortenHeader = fread($fd, 8);
+		if (substr($ShortenHeader, 0, 4) != 'ajkg') {
+			$ThisFileInfo['error'][] = 'Expecting &quot;ajkg&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.substr($ShortenHeader, 0, 4).'&quot;';
+			return false;
+		}
+		$ThisFileInfo['fileformat']            = 'shn';
+		$ThisFileInfo['audio']['dataformat']   = 'shn';
+		$ThisFileInfo['audio']['lossless']     = true;
+		$ThisFileInfo['audio']['bitrate_mode'] = 'vbr';
+
+		$ThisFileInfo['shn']['version'] = getid3_lib::LittleEndian2Int(substr($ShortenHeader, 4, 1));
+
+		fseek($fd, $ThisFileInfo['avdataend'] - 12, SEEK_SET);
+		$SeekTableSignatureTest = fread($fd, 12);
+		$ThisFileInfo['shn']['seektable']['present'] = (bool) (substr($SeekTableSignatureTest, 4, 8) == 'SHNAMPSK');
+		if ($ThisFileInfo['shn']['seektable']['present']) {
+			$ThisFileInfo['shn']['seektable']['length'] = getid3_lib::LittleEndian2Int(substr($SeekTableSignatureTest, 0, 4));
+			$ThisFileInfo['shn']['seektable']['offset'] = $ThisFileInfo['avdataend'] - $ThisFileInfo['shn']['seektable']['length'];
+			fseek($fd, $ThisFileInfo['shn']['seektable']['offset'], SEEK_SET);
+			$SeekTableMagic = fread($fd, 4);
+			if ($SeekTableMagic != 'SEEK') {
+
+				$ThisFileInfo['error'][] = 'Expecting &quot;SEEK&quot; at offset '.$ThisFileInfo['shn']['seektable']['offset'].', found &quot;'.$SeekTableMagic.'&quot;';
+				return false;
+
+			} else {
+
+				// typedef struct tag_TSeekEntry
+				// {
+				//   unsigned long SampleNumber;
+				//   unsigned long SHNFileByteOffset;
+				//   unsigned long SHNLastBufferReadPosition;
+				//   unsigned short SHNByteGet;
+				//   unsigned short SHNBufferOffset;
+				//   unsigned short SHNFileBitOffset;
+				//   unsigned long SHNGBuffer;
+				//   unsigned short SHNBitShift;
+				//   long CBuf0[3];
+				//   long CBuf1[3];
+				//   long Offset0[4];
+				//   long Offset1[4];
+				// }TSeekEntry;
+
+				$SeekTableData = fread($fd, $ThisFileInfo['shn']['seektable']['length'] - 16);
+				$ThisFileInfo['shn']['seektable']['entry_count'] = floor(strlen($SeekTableData) / 80);
+				//$ThisFileInfo['shn']['seektable']['entries'] = array();
+				//$SeekTableOffset = 0;
+				//for ($i = 0; $i &lt; $ThisFileInfo['shn']['seektable']['entry_count']; $i++) {
+				//	$SeekTableEntry['sample_number'] = getid3_lib::LittleEndian2Int(substr($SeekTableData, $SeekTableOffset, 4));
+				//	$SeekTableOffset += 4;
+				//	$SeekTableEntry['shn_file_byte_offset'] = getid3_lib::LittleEndian2Int(substr($SeekTableData, $SeekTableOffset, 4));
+				//	$SeekTableOffset += 4;
+				//	$SeekTableEntry['shn_last_buffer_read_position'] = getid3_lib::LittleEndian2Int(substr($SeekTableData, $SeekTableOffset, 4));
+				//	$SeekTableOffset += 4;
+				//	$SeekTableEntry['shn_byte_get'] = getid3_lib::LittleEndian2Int(substr($SeekTableData, $SeekTableOffset, 2));
+				//	$SeekTableOffset += 2;
+				//	$SeekTableEntry['shn_buffer_offset'] = getid3_lib::LittleEndian2Int(substr($SeekTableData, $SeekTableOffset, 2));
+				//	$SeekTableOffset += 2;
+				//	$SeekTableEntry['shn_file_bit_offset'] = getid3_lib::LittleEndian2Int(substr($SeekTableData, $SeekTableOffset, 2));
+				//	$SeekTableOffset += 2;
+				//	$SeekTableEntry['shn_gbuffer'] = getid3_lib::LittleEndian2Int(substr($SeekTableData, $SeekTableOffset, 4));
+				//	$SeekTableOffset += 4;
+				//	$SeekTableEntry['shn_bit_shift'] = getid3_lib::LittleEndian2Int(substr($SeekTableData, $SeekTableOffset, 2));
+				//	$SeekTableOffset += 2;
+				//	for ($j = 0; $j &lt; 3; $j++) {
+				//		$SeekTableEntry['cbuf0'][$j] = getid3_lib::LittleEndian2Int(substr($SeekTableData, $SeekTableOffset, 4));
+				//		$SeekTableOffset += 4;
+				//	}
+				//	for ($j = 0; $j &lt; 3; $j++) {
+				//		$SeekTableEntry['cbuf1'][$j] = getid3_lib::LittleEndian2Int(substr($SeekTableData, $SeekTableOffset, 4));
+				//		$SeekTableOffset += 4;
+				//	}
+				//	for ($j = 0; $j &lt; 4; $j++) {
+				//		$SeekTableEntry['offset0'][$j] = getid3_lib::LittleEndian2Int(substr($SeekTableData, $SeekTableOffset, 4));
+				//		$SeekTableOffset += 4;
+				//	}
+				//	for ($j = 0; $j &lt; 4; $j++) {
+				//		$SeekTableEntry['offset1'][$j] = getid3_lib::LittleEndian2Int(substr($SeekTableData, $SeekTableOffset, 4));
+				//		$SeekTableOffset += 4;
+				//	}
+                //
+				//	$ThisFileInfo['shn']['seektable']['entries'][] = $SeekTableEntry;
+				//}
+
+			}
+
+		}
+
+		if ((bool) ini_get('safe_mode')) {
+			$ThisFileInfo['error'][] = 'PHP running in Safe Mode - backtick operator not available, cannot run shntool to analyze Shorten files';
+			return false;
+		}
+
+		if (GETID3_OS_ISWINDOWS) {
+
+			$RequiredFiles = array('shorten.exe', 'cygwin1.dll', 'head.exe');
+			foreach ($RequiredFiles as $required_file) {
+				if (!is_readable(GETID3_HELPERAPPSDIR.$required_file)) {
+					$ThisFileInfo['error'][] = GETID3_HELPERAPPSDIR.$required_file.' does not exist';
+					return false;
+				}
+			}
+			$commandline = GETID3_HELPERAPPSDIR.'shorten.exe -x &quot;'.$ThisFileInfo['filenamepath'].'&quot; - | '.GETID3_HELPERAPPSDIR.'head.exe -c 44';
+
+		} else {
+
+	        static $shorten_present;
+	        if (!isset($shorten_present)) {
+                $shorten_present = file_exists('/usr/local/bin/shorten') || `which shorten`;
+            }
+            if (!$shorten_present) {
+                $ThisFileInfo['error'][] = 'shorten binary was not found in path or /usr/local/bin';
+                return false;
+            }
+            $commandline = (file_exists('/usr/local/bin/shorten') ? '/usr/local/bin/' : '' ) . 'shorten -x &quot;'.$ThisFileInfo['filenamepath'].'&quot; - | head -c 44';
+
+		}
+
+		$output = `$commandline`;
+
+		if (!empty($output) &amp;&amp; (substr($output, 12, 4) == 'fmt ')) {
+
+			getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio-video.riff.php', __FILE__, true);
+
+			$DecodedWAVFORMATEX = getid3_riff::RIFFparseWAVEFORMATex(substr($output, 20, 16));
+			$ThisFileInfo['audio']['channels']        = $DecodedWAVFORMATEX['channels'];
+			$ThisFileInfo['audio']['bits_per_sample'] = $DecodedWAVFORMATEX['bits_per_sample'];
+			$ThisFileInfo['audio']['sample_rate']     = $DecodedWAVFORMATEX['sample_rate'];
+
+			if (substr($output, 36, 4) == 'data') {
+
+				$ThisFileInfo['playtime_seconds'] = getid3_lib::LittleEndian2Int(substr($output, 40, 4)) / $DecodedWAVFORMATEX['raw']['nAvgBytesPerSec'];
+
+			} else {
+
+				$ThisFileInfo['error'][] = 'shorten failed to decode DATA chunk to expected location, cannot determine playtime';
+				return false;
+
+			}
+
+			$ThisFileInfo['audio']['bitrate'] = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) / $ThisFileInfo['playtime_seconds']) * 8;
+
+		} else {
+
+			$ThisFileInfo['error'][] = 'shorten failed to decode file to WAV for parsing';
+			return false;
+
+		}
+
+		return true;
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.shorten.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.tta.php
===================================================================
--- trunk/inc/external/getid3/module.audio.tta.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.tta.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,107 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.tta.php                                        //
+// module for analyzing TTA Audio files                        //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_tta
+{
+
+	function getid3_tta(&amp;$fd, &amp;$ThisFileInfo) {
+
+		$ThisFileInfo['fileformat']            = 'tta';
+		$ThisFileInfo['audio']['dataformat']   = 'tta';
+		$ThisFileInfo['audio']['lossless']     = true;
+		$ThisFileInfo['audio']['bitrate_mode'] = 'vbr';
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$ttaheader = fread($fd, 26);
+
+		$ThisFileInfo['tta']['magic'] = substr($ttaheader,  0,  3);
+		if ($ThisFileInfo['tta']['magic'] != 'TTA') {
+			$ThisFileInfo['error'][] = 'Expecting &quot;TTA&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.$ThisFileInfo['tta']['magic'].'&quot;';
+			unset($ThisFileInfo['fileformat']);
+			unset($ThisFileInfo['audio']);
+			unset($ThisFileInfo['tta']);
+			return false;
+		}
+
+		switch ($ttaheader{3}) {
+			case &quot;\x01&quot;: // TTA v1.x
+			case &quot;\x02&quot;: // TTA v1.x
+			case &quot;\x03&quot;: // TTA v1.x
+				// &quot;It was the demo-version of the TTA encoder. There is no released format with such header. TTA encoder v1 is not supported about a year.&quot;
+				$ThisFileInfo['tta']['major_version'] = 1;
+				$ThisFileInfo['avdataoffset'] += 16;
+
+				$ThisFileInfo['tta']['compression_level']   = ord($ttaheader{3});
+				$ThisFileInfo['tta']['channels']            = getid3_lib::LittleEndian2Int(substr($ttaheader,  4,  2));
+				$ThisFileInfo['tta']['bits_per_sample']     = getid3_lib::LittleEndian2Int(substr($ttaheader,  6,  2));
+				$ThisFileInfo['tta']['sample_rate']         = getid3_lib::LittleEndian2Int(substr($ttaheader,  8,  4));
+				$ThisFileInfo['tta']['samples_per_channel'] = getid3_lib::LittleEndian2Int(substr($ttaheader, 12,  4));
+
+				$ThisFileInfo['audio']['encoder_options']   = '-e'.$ThisFileInfo['tta']['compression_level'];
+				$ThisFileInfo['playtime_seconds']           = $ThisFileInfo['tta']['samples_per_channel'] / $ThisFileInfo['tta']['sample_rate'];
+				break;
+
+			case '2': // TTA v2.x
+				// &quot;I have hurried to release the TTA 2.0 encoder. Format documentation is removed from our site. This format still in development. Please wait the TTA2 format, encoder v4.&quot;
+				$ThisFileInfo['tta']['major_version'] = 2;
+				$ThisFileInfo['avdataoffset'] += 20;
+
+				$ThisFileInfo['tta']['compression_level']   = getid3_lib::LittleEndian2Int(substr($ttaheader,  4,  2));
+				$ThisFileInfo['tta']['audio_format']        = getid3_lib::LittleEndian2Int(substr($ttaheader,  6,  2));
+				$ThisFileInfo['tta']['channels']            = getid3_lib::LittleEndian2Int(substr($ttaheader,  8,  2));
+				$ThisFileInfo['tta']['bits_per_sample']     = getid3_lib::LittleEndian2Int(substr($ttaheader, 10,  2));
+				$ThisFileInfo['tta']['sample_rate']         = getid3_lib::LittleEndian2Int(substr($ttaheader, 12,  4));
+				$ThisFileInfo['tta']['data_length']         = getid3_lib::LittleEndian2Int(substr($ttaheader, 16,  4));
+
+				$ThisFileInfo['audio']['encoder_options']   = '-e'.$ThisFileInfo['tta']['compression_level'];
+				$ThisFileInfo['playtime_seconds']           = $ThisFileInfo['tta']['data_length'] / $ThisFileInfo['tta']['sample_rate'];
+				break;
+
+			case '1': // TTA v3.x
+				// &quot;This is a first stable release of the TTA format. It will be supported by the encoders v3 or higher.&quot;
+				$ThisFileInfo['tta']['major_version'] = 3;
+				$ThisFileInfo['avdataoffset'] += 26;
+
+				$ThisFileInfo['tta']['audio_format']        = getid3_lib::LittleEndian2Int(substr($ttaheader,  4,  2)); // getid3_riff::RIFFwFormatTagLookup()
+				$ThisFileInfo['tta']['channels']            = getid3_lib::LittleEndian2Int(substr($ttaheader,  6,  2));
+				$ThisFileInfo['tta']['bits_per_sample']     = getid3_lib::LittleEndian2Int(substr($ttaheader,  8,  2));
+				$ThisFileInfo['tta']['sample_rate']         = getid3_lib::LittleEndian2Int(substr($ttaheader, 10,  4));
+				$ThisFileInfo['tta']['data_length']         = getid3_lib::LittleEndian2Int(substr($ttaheader, 14,  4));
+				$ThisFileInfo['tta']['crc32_footer']        =                              substr($ttaheader, 18,  4);
+				$ThisFileInfo['tta']['seek_point']          = getid3_lib::LittleEndian2Int(substr($ttaheader, 22,  4));
+
+				$ThisFileInfo['playtime_seconds']           = $ThisFileInfo['tta']['data_length'] / $ThisFileInfo['tta']['sample_rate'];
+				break;
+
+			default:
+				$ThisFileInfo['error'][] = 'This version of getID3() only knows how to handle TTA v1 and v2 - it may not work correctly with this file which appears to be TTA v'.$ttaheader{3};
+				return false;
+				break;
+		}
+
+		$ThisFileInfo['audio']['encoder']         = 'TTA v'.$ThisFileInfo['tta']['major_version'];
+		$ThisFileInfo['audio']['bits_per_sample'] = $ThisFileInfo['tta']['bits_per_sample'];
+		$ThisFileInfo['audio']['sample_rate']     = $ThisFileInfo['tta']['sample_rate'];
+		$ThisFileInfo['audio']['channels']        = $ThisFileInfo['tta']['channels'];
+		$ThisFileInfo['audio']['bitrate']         = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['playtime_seconds'];
+
+		return true;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.tta.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.voc.php
===================================================================
--- trunk/inc/external/getid3/module.audio.voc.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.voc.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,205 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.voc.php                                        //
+// module for analyzing Creative VOC Audio files               //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_voc
+{
+
+	function getid3_voc(&amp;$fd, &amp;$ThisFileInfo) {
+
+		$OriginalAVdataOffset = $ThisFileInfo['avdataoffset'];
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$VOCheader  = fread($fd, 26);
+
+		if (substr($VOCheader, 0, 19) != 'Creative Voice File') {
+			$ThisFileInfo['error'][] = 'Expecting &quot;Creative Voice File&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.substr($VOCheader, 0, 19).'&quot;';
+			return false;
+		}
+
+		// shortcuts
+		$thisfile_audio = &amp;$ThisFileInfo['audio'];
+		$ThisFileInfo['voc'] = array();
+		$thisfile_voc        = &amp;$ThisFileInfo['voc'];
+
+		$ThisFileInfo['fileformat']               = 'voc';
+		$thisfile_audio['dataformat']      = 'voc';
+		$thisfile_audio['bitrate_mode']    = 'cbr';
+		$thisfile_audio['lossless']        = true;
+		$thisfile_audio['channels']        = 1; // might be overriden below
+		$thisfile_audio['bits_per_sample'] = 8; // might be overriden below
+
+		// byte #     Description
+		// ------     ------------------------------------------
+		// 00-12      'Creative Voice File'
+		// 13         1A (eof to abort printing of file)
+		// 14-15      Offset of first datablock in .voc file (std 1A 00 in Intel Notation)
+		// 16-17      Version number (minor,major) (VOC-HDR puts 0A 01)
+		// 18-19      2's Comp of Ver. # + 1234h (VOC-HDR puts 29 11)
+
+		$thisfile_voc['header']['datablock_offset'] = getid3_lib::LittleEndian2Int(substr($VOCheader, 20, 2));
+		$thisfile_voc['header']['minor_version']    = getid3_lib::LittleEndian2Int(substr($VOCheader, 22, 1));
+		$thisfile_voc['header']['major_version']    = getid3_lib::LittleEndian2Int(substr($VOCheader, 23, 1));
+
+		do {
+
+			$BlockOffset    = ftell($fd);
+			$BlockData      = fread($fd, 4);
+			$BlockType      = ord($BlockData{0});
+			$BlockSize      = getid3_lib::LittleEndian2Int(substr($BlockData, 1, 3));
+			$ThisBlock      = array();
+
+			@$thisfile_voc['blocktypes'][$BlockType]++;
+			switch ($BlockType) {
+				case 0:  // Terminator
+					// do nothing, we'll break out of the loop down below
+					break;
+
+				case 1:  // Sound data
+					$BlockData .= fread($fd, 2);
+					if ($ThisFileInfo['avdataoffset'] &lt;= $OriginalAVdataOffset) {
+						$ThisFileInfo['avdataoffset'] = ftell($fd);
+					}
+					fseek($fd, $BlockSize - 2, SEEK_CUR);
+
+					$ThisBlock['sample_rate_id']   = getid3_lib::LittleEndian2Int(substr($BlockData, 4, 1));
+					$ThisBlock['compression_type'] = getid3_lib::LittleEndian2Int(substr($BlockData, 5, 1));
+
+					$ThisBlock['compression_name'] = $this-&gt;VOCcompressionTypeLookup($ThisBlock['compression_type']);
+					if ($ThisBlock['compression_type'] &lt;= 3) {
+						$thisfile_voc['compressed_bits_per_sample'] = getid3_lib::CastAsInt(str_replace('-bit', '', $ThisBlock['compression_name']));
+					}
+
+					// Less accurate sample_rate calculation than the Extended block (#8) data (but better than nothing if Extended Block is not available)
+					if (empty($thisfile_audio['sample_rate'])) {
+						// SR byte = 256 - (1000000 / sample_rate)
+						$thisfile_audio['sample_rate'] = getid3_lib::trunc((1000000 / (256 - $ThisBlock['sample_rate_id'])) / $thisfile_audio['channels']);
+					}
+					break;
+
+				case 2:  // Sound continue
+				case 3:  // Silence
+				case 4:  // Marker
+				case 6:  // Repeat
+				case 7:  // End repeat
+					// nothing useful, just skip
+					fseek($fd, $BlockSize, SEEK_CUR);
+					break;
+
+				case 8:  // Extended
+					$BlockData .= fread($fd, 4);
+
+					//00-01  Time Constant:
+					//   Mono: 65536 - (256000000 / sample_rate)
+					// Stereo: 65536 - (256000000 / (sample_rate * 2))
+					$ThisBlock['time_constant'] =        getid3_lib::LittleEndian2Int(substr($BlockData, 4, 2));
+					$ThisBlock['pack_method']   =        getid3_lib::LittleEndian2Int(substr($BlockData, 6, 1));
+					$ThisBlock['stereo']        = (bool) getid3_lib::LittleEndian2Int(substr($BlockData, 7, 1));
+
+					$thisfile_audio['channels']    = ($ThisBlock['stereo'] ? 2 : 1);
+					$thisfile_audio['sample_rate'] = getid3_lib::trunc((256000000 / (65536 - $ThisBlock['time_constant'])) / $thisfile_audio['channels']);
+					break;
+
+				case 9:  // data block that supersedes blocks 1 and 8. Used for stereo, 16 bit
+					$BlockData .= fread($fd, 12);
+					if ($ThisFileInfo['avdataoffset'] &lt;= $OriginalAVdataOffset) {
+						$ThisFileInfo['avdataoffset'] = ftell($fd);
+					}
+					fseek($fd, $BlockSize - 12, SEEK_CUR);
+
+					$ThisBlock['sample_rate']      = getid3_lib::LittleEndian2Int(substr($BlockData,  4, 4));
+					$ThisBlock['bits_per_sample']  = getid3_lib::LittleEndian2Int(substr($BlockData,  8, 1));
+					$ThisBlock['channels']         = getid3_lib::LittleEndian2Int(substr($BlockData,  9, 1));
+					$ThisBlock['wFormat']          = getid3_lib::LittleEndian2Int(substr($BlockData, 10, 2));
+
+					$ThisBlock['compression_name'] = $this-&gt;VOCwFormatLookup($ThisBlock['wFormat']);
+					if ($this-&gt;VOCwFormatActualBitsPerSampleLookup($ThisBlock['wFormat'])) {
+						$thisfile_voc['compressed_bits_per_sample'] = $this-&gt;VOCwFormatActualBitsPerSampleLookup($ThisBlock['wFormat']);
+					}
+
+					$thisfile_audio['sample_rate']     = $ThisBlock['sample_rate'];
+					$thisfile_audio['bits_per_sample'] = $ThisBlock['bits_per_sample'];
+					$thisfile_audio['channels']        = $ThisBlock['channels'];
+					break;
+
+				default:
+					$ThisFileInfo['warning'][] = 'Unhandled block type &quot;'.$BlockType.'&quot; at offset '.$BlockOffset;
+					fseek($fd, $BlockSize, SEEK_CUR);
+					break;
+			}
+
+			if (!empty($ThisBlock)) {
+				$ThisBlock['block_offset']  = $BlockOffset;
+				$ThisBlock['block_size']    = $BlockSize;
+				$ThisBlock['block_type_id'] = $BlockType;
+				$thisfile_voc['blocks'][] = $ThisBlock;
+			}
+
+		} while (!feof($fd) &amp;&amp; ($BlockType != 0));
+
+		// Terminator block doesn't have size field, so seek back 3 spaces
+		fseek($fd, -3, SEEK_CUR);
+
+		ksort($thisfile_voc['blocktypes']);
+
+		if (!empty($thisfile_voc['compressed_bits_per_sample'])) {
+			$ThisFileInfo['playtime_seconds'] = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / ($thisfile_voc['compressed_bits_per_sample'] * $thisfile_audio['channels'] * $thisfile_audio['sample_rate']);
+			$thisfile_audio['bitrate'] = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['playtime_seconds'];
+		}
+
+		return true;
+	}
+
+	function VOCcompressionTypeLookup($index) {
+		static $VOCcompressionTypeLookup = array(
+			0 =&gt; '8-bit',
+			1 =&gt; '4-bit',
+			2 =&gt; '2.6-bit',
+			3 =&gt; '2-bit'
+		);
+		return (isset($VOCcompressionTypeLookup[$index]) ? $VOCcompressionTypeLookup[$index] : 'Multi DAC ('.($index - 3).') channels');
+	}
+
+	function VOCwFormatLookup($index) {
+		static $VOCwFormatLookup = array(
+			0x0000 =&gt; '8-bit unsigned PCM',
+			0x0001 =&gt; 'Creative 8-bit to 4-bit ADPCM',
+			0x0002 =&gt; 'Creative 8-bit to 3-bit ADPCM',
+			0x0003 =&gt; 'Creative 8-bit to 2-bit ADPCM',
+			0x0004 =&gt; '16-bit signed PCM',
+			0x0006 =&gt; 'CCITT a-Law',
+			0x0007 =&gt; 'CCITT u-Law',
+			0x2000 =&gt; 'Creative 16-bit to 4-bit ADPCM'
+		);
+		return (isset($VOCwFormatLookup[$index]) ? $VOCwFormatLookup[$index] : false);
+	}
+
+	function VOCwFormatActualBitsPerSampleLookup($index) {
+		static $VOCwFormatLookup = array(
+			0x0000 =&gt; 8,
+			0x0001 =&gt; 4,
+			0x0002 =&gt; 3,
+			0x0003 =&gt; 2,
+			0x0004 =&gt; 16,
+			0x0006 =&gt; 8,
+			0x0007 =&gt; 8,
+			0x2000 =&gt; 4
+		);
+		return (isset($VOCwFormatLookup[$index]) ? $VOCwFormatLookup[$index] : false);
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.voc.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.vqf.php
===================================================================
--- trunk/inc/external/getid3/module.audio.vqf.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.vqf.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,159 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.vqf.php                                        //
+// module for analyzing VQF audio files                        //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_vqf
+{
+	function getid3_vqf(&amp;$fd, &amp;$ThisFileInfo) {
+		// based loosely on code from TTwinVQ by Jurgen Faul &lt;jfaul&#216;gmx*de&gt;
+		// <A HREF="http://jfaul.de/atl">http://jfaul.de/atl</A>  or  <A HREF="http://j-faul.virtualave.net/atl/atl.html">http://j-faul.virtualave.net/atl/atl.html</A>
+
+		$ThisFileInfo['fileformat']            = 'vqf';
+		$ThisFileInfo['audio']['dataformat']   = 'vqf';
+		$ThisFileInfo['audio']['bitrate_mode'] = 'cbr';
+		$ThisFileInfo['audio']['lossless']     = false;
+
+		// shortcut
+		$ThisFileInfo['vqf']['raw'] = array();
+		$thisfile_vqf               = &amp;$ThisFileInfo['vqf'];
+		$thisfile_vqf_raw           = &amp;$thisfile_vqf['raw'];
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$VQFheaderData = fread($fd, 16);
+
+		$offset = 0;
+		$thisfile_vqf_raw['header_tag']     =               substr($VQFheaderData, $offset, 4);
+		if ($thisfile_vqf_raw['header_tag'] != 'TWIN') {
+			$ThisFileInfo['error'][] = 'Expecting &quot;TWIN&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.$thisfile_vqf_raw['header_tag'].'&quot;';
+			unset($ThisFileInfo['vqf']);
+			unset($ThisFileInfo['fileformat']);
+			return false;
+		}
+		$offset += 4;
+		$thisfile_vqf_raw['version']        =               substr($VQFheaderData, $offset, 8);
+		$offset += 8;
+		$thisfile_vqf_raw['size']           = getid3_lib::BigEndian2Int(substr($VQFheaderData, $offset, 4));
+		$offset += 4;
+
+		while (ftell($fd) &lt; $ThisFileInfo['avdataend']) {
+
+			$ChunkBaseOffset = ftell($fd);
+			$chunkoffset = 0;
+			$ChunkData = fread($fd, 8);
+			$ChunkName = substr($ChunkData, $chunkoffset, 4);
+			if ($ChunkName == 'DATA') {
+				$ThisFileInfo['avdataoffset'] = $ChunkBaseOffset;
+				break;
+			}
+			$chunkoffset += 4;
+			$ChunkSize = getid3_lib::BigEndian2Int(substr($ChunkData, $chunkoffset, 4));
+			$chunkoffset += 4;
+			if ($ChunkSize &gt; ($ThisFileInfo['avdataend'] - ftell($fd))) {
+				$ThisFileInfo['error'][] = 'Invalid chunk size ('.$ChunkSize.') for chunk &quot;'.$ChunkName.'&quot; at offset '.$ChunkBaseOffset;
+				break;
+			}
+			if ($ChunkSize &gt; 0) {
+				$ChunkData .= fread($fd, $ChunkSize);
+			}
+
+			switch ($ChunkName) {
+				case 'COMM':
+					// shortcut
+					$thisfile_vqf['COMM'] = array();
+					$thisfile_vqf_COMM    = &amp;$thisfile_vqf['COMM'];
+
+					$thisfile_vqf_COMM['channel_mode']   = getid3_lib::BigEndian2Int(substr($ChunkData, $chunkoffset, 4));
+					$chunkoffset += 4;
+					$thisfile_vqf_COMM['bitrate']        = getid3_lib::BigEndian2Int(substr($ChunkData, $chunkoffset, 4));
+					$chunkoffset += 4;
+					$thisfile_vqf_COMM['sample_rate']    = getid3_lib::BigEndian2Int(substr($ChunkData, $chunkoffset, 4));
+					$chunkoffset += 4;
+					$thisfile_vqf_COMM['security_level'] = getid3_lib::BigEndian2Int(substr($ChunkData, $chunkoffset, 4));
+					$chunkoffset += 4;
+
+					$ThisFileInfo['audio']['channels']        = $thisfile_vqf_COMM['channel_mode'] + 1;
+					$ThisFileInfo['audio']['sample_rate']     = $this-&gt;VQFchannelFrequencyLookup($thisfile_vqf_COMM['sample_rate']);
+					$ThisFileInfo['audio']['bitrate']         = $thisfile_vqf_COMM['bitrate'] * 1000;
+					$ThisFileInfo['audio']['encoder_options'] = 'CBR' . ceil($ThisFileInfo['audio']['bitrate']/1000);
+
+					if ($ThisFileInfo['audio']['bitrate'] == 0) {
+						$ThisFileInfo['error'][] = 'Corrupt VQF file: bitrate_audio == zero';
+						return false;
+					}
+					break;
+
+				case 'NAME':
+				case 'AUTH':
+				case '(c) ':
+				case 'FILE':
+				case 'COMT':
+				case 'ALBM':
+					$thisfile_vqf['comments'][$this-&gt;VQFcommentNiceNameLookup($ChunkName)][] = trim(substr($ChunkData, 8));
+					break;
+
+				case 'DSIZ':
+					$thisfile_vqf['DSIZ'] = getid3_lib::BigEndian2Int(substr($ChunkData, 8, 4));
+					break;
+
+				default:
+					$ThisFileInfo['warning'][] = 'Unhandled chunk type &quot;'.$ChunkName.'&quot; at offset '.$ChunkBaseOffset;
+					break;
+			}
+		}
+
+		$ThisFileInfo['playtime_seconds'] = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['audio']['bitrate'];
+
+		if (isset($thisfile_vqf['DSIZ']) &amp;&amp; (($thisfile_vqf['DSIZ'] != ($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset'] - strlen('DATA'))))) {
+			switch ($thisfile_vqf['DSIZ']) {
+				case 0:
+				case 1:
+					$ThisFileInfo['warning'][] = 'Invalid DSIZ value &quot;'.$thisfile_vqf['DSIZ'].'&quot;. This is known to happen with VQF files encoded by Ahead Nero, and seems to be its way of saying this is TwinVQF v'.($thisfile_vqf['DSIZ'] + 1).'.0';
+					$ThisFileInfo['audio']['encoder'] = 'Ahead Nero';
+					break;
+
+				default:
+					$ThisFileInfo['warning'][] = 'Probable corrupted file - should be '.$thisfile_vqf['DSIZ'].' bytes, actually '.($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset'] - strlen('DATA'));
+					break;
+			}
+		}
+
+		return true;
+	}
+
+	function VQFchannelFrequencyLookup($frequencyid) {
+		static $VQFchannelFrequencyLookup = array(
+			11 =&gt; 11025,
+			22 =&gt; 22050,
+			44 =&gt; 44100
+		);
+		return (isset($VQFchannelFrequencyLookup[$frequencyid]) ? $VQFchannelFrequencyLookup[$frequencyid] : $frequencyid * 1000);
+	}
+
+	function VQFcommentNiceNameLookup($shortname) {
+		static $VQFcommentNiceNameLookup = array(
+			'NAME' =&gt; 'title',
+			'AUTH' =&gt; 'artist',
+			'(c) ' =&gt; 'copyright',
+			'FILE' =&gt; 'filename',
+			'COMT' =&gt; 'comment',
+			'ALBM' =&gt; 'album'
+		);
+		return (isset($VQFcommentNiceNameLookup[$shortname]) ? $VQFcommentNiceNameLookup[$shortname] : $shortname);
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.vqf.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.audio.wavpack.php
===================================================================
--- trunk/inc/external/getid3/module.audio.wavpack.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.audio.wavpack.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,372 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.audio.wavpack.php                                    //
+// module for analyzing WavPack v4.0+ Audio files              //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_wavpack
+{
+
+	function getid3_wavpack(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+
+		while (true) {
+
+			$wavpackheader = fread($fd, 32);
+
+			if (ftell($fd) &gt;= $ThisFileInfo['avdataend']) {
+				break;
+			} elseif (feof($fd)) {
+				break;
+			} elseif (
+				(@$ThisFileInfo['wavpack']['blockheader']['total_samples'] &gt; 0) &amp;&amp;
+				(@$ThisFileInfo['wavpack']['blockheader']['block_samples'] &gt; 0) &amp;&amp;
+				(!isset($ThisFileInfo['wavpack']['riff_trailer_size']) || ($ThisFileInfo['wavpack']['riff_trailer_size'] &lt;= 0)) &amp;&amp;
+				((@$ThisFileInfo['wavpack']['config_flags']['md5_checksum'] === false) || !empty($ThisFileInfo['md5_data_source']))) {
+					break;
+			}
+
+			$blockheader_offset = ftell($fd) - 32;
+			$blockheader_magic  =                              substr($wavpackheader,  0,  4);
+			$blockheader_size   = getid3_lib::LittleEndian2Int(substr($wavpackheader,  4,  4));
+
+			if ($blockheader_magic != 'wvpk') {
+				$ThisFileInfo['error'][] = 'Expecting &quot;wvpk&quot; at offset '.$blockheader_offset.', found &quot;'.$blockheader_magic.'&quot;';
+				if ((@$ThisFileInfo['audio']['dataformat'] != 'wavpack') &amp;&amp; (@$ThisFileInfo['audio']['dataformat'] != 'wvc')) {
+					unset($ThisFileInfo['fileformat']);
+					unset($ThisFileInfo['audio']);
+					unset($ThisFileInfo['wavpack']);
+				}
+				return false;
+			}
+
+
+			if ((@$ThisFileInfo['wavpack']['blockheader']['block_samples'] &lt;= 0) ||
+				(@$ThisFileInfo['wavpack']['blockheader']['total_samples'] &lt;= 0)) {
+				// Also, it is possible that the first block might not have
+				// any samples (block_samples == 0) and in this case you should skip blocks
+				// until you find one with samples because the other information (like
+				// total_samples) are not guaranteed to be correct until (block_samples &gt; 0)
+
+				// Finally, I have defined a format for files in which the length is not known
+				// (for example when raw files are created using pipes). In these cases
+				// total_samples will be -1 and you must seek to the final block to determine
+				// the total number of samples.
+
+
+				$ThisFileInfo['audio']['dataformat']   = 'wavpack';
+				$ThisFileInfo['fileformat']            = 'wavpack';
+				$ThisFileInfo['audio']['lossless']     = true;
+				$ThisFileInfo['audio']['bitrate_mode'] = 'vbr';
+
+				$ThisFileInfo['wavpack']['blockheader']['offset'] = $blockheader_offset;
+				$ThisFileInfo['wavpack']['blockheader']['magic']  = $blockheader_magic;
+				$ThisFileInfo['wavpack']['blockheader']['size']   = $blockheader_size;
+
+				if ($ThisFileInfo['wavpack']['blockheader']['size'] &gt;= 0x100000) {
+					$ThisFileInfo['error'][] = 'Expecting WavPack block size less than &quot;0x100000&quot;, found &quot;'.$ThisFileInfo['wavpack']['blockheader']['size'].'&quot; at offset '.$ThisFileInfo['wavpack']['blockheader']['offset'];
+					if ((@$ThisFileInfo['audio']['dataformat'] != 'wavpack') &amp;&amp; (@$ThisFileInfo['audio']['dataformat'] != 'wvc')) {
+						unset($ThisFileInfo['fileformat']);
+						unset($ThisFileInfo['audio']);
+						unset($ThisFileInfo['wavpack']);
+					}
+					return false;
+				}
+
+				$ThisFileInfo['wavpack']['blockheader']['minor_version'] = ord($wavpackheader{8});
+				$ThisFileInfo['wavpack']['blockheader']['major_version'] = ord($wavpackheader{9});
+
+				if (($ThisFileInfo['wavpack']['blockheader']['major_version'] != 4) ||
+					(($ThisFileInfo['wavpack']['blockheader']['minor_version'] &lt; 4) &amp;&amp;
+					($ThisFileInfo['wavpack']['blockheader']['minor_version'] &gt; 16))) {
+						$ThisFileInfo['error'][] = 'Expecting WavPack version between &quot;4.2&quot; and &quot;4.16&quot;, found version &quot;'.$ThisFileInfo['wavpack']['blockheader']['major_version'].'.'.$ThisFileInfo['wavpack']['blockheader']['minor_version'].'&quot; at offset '.$ThisFileInfo['wavpack']['blockheader']['offset'];
+						if ((@$ThisFileInfo['audio']['dataformat'] != 'wavpack') &amp;&amp; (@$ThisFileInfo['audio']['dataformat'] != 'wvc')) {
+							unset($ThisFileInfo['fileformat']);
+							unset($ThisFileInfo['audio']);
+							unset($ThisFileInfo['wavpack']);
+						}
+						return false;
+				}
+
+				$ThisFileInfo['wavpack']['blockheader']['track_number']  = ord($wavpackheader{10}); // unused
+				$ThisFileInfo['wavpack']['blockheader']['index_number']  = ord($wavpackheader{11}); // unused
+				$ThisFileInfo['wavpack']['blockheader']['total_samples'] = getid3_lib::LittleEndian2Int(substr($wavpackheader, 12,  4));
+				$ThisFileInfo['wavpack']['blockheader']['block_index']   = getid3_lib::LittleEndian2Int(substr($wavpackheader, 16,  4));
+				$ThisFileInfo['wavpack']['blockheader']['block_samples'] = getid3_lib::LittleEndian2Int(substr($wavpackheader, 20,  4));
+				$ThisFileInfo['wavpack']['blockheader']['flags_raw']     = getid3_lib::LittleEndian2Int(substr($wavpackheader, 24,  4));
+				$ThisFileInfo['wavpack']['blockheader']['crc']           = getid3_lib::LittleEndian2Int(substr($wavpackheader, 28,  4));
+
+				$ThisFileInfo['wavpack']['blockheader']['flags']['bytes_per_sample']     =    1 + ($ThisFileInfo['wavpack']['blockheader']['flags_raw'] &amp; 0x00000003);
+				$ThisFileInfo['wavpack']['blockheader']['flags']['mono']                 = (bool) ($ThisFileInfo['wavpack']['blockheader']['flags_raw'] &amp; 0x00000004);
+				$ThisFileInfo['wavpack']['blockheader']['flags']['hybrid']               = (bool) ($ThisFileInfo['wavpack']['blockheader']['flags_raw'] &amp; 0x00000008);
+				$ThisFileInfo['wavpack']['blockheader']['flags']['joint_stereo']         = (bool) ($ThisFileInfo['wavpack']['blockheader']['flags_raw'] &amp; 0x00000010);
+				$ThisFileInfo['wavpack']['blockheader']['flags']['cross_decorrelation']  = (bool) ($ThisFileInfo['wavpack']['blockheader']['flags_raw'] &amp; 0x00000020);
+				$ThisFileInfo['wavpack']['blockheader']['flags']['hybrid_noiseshape']    = (bool) ($ThisFileInfo['wavpack']['blockheader']['flags_raw'] &amp; 0x00000040);
+				$ThisFileInfo['wavpack']['blockheader']['flags']['ieee_32bit_float']     = (bool) ($ThisFileInfo['wavpack']['blockheader']['flags_raw'] &amp; 0x00000080);
+				$ThisFileInfo['wavpack']['blockheader']['flags']['int_32bit']            = (bool) ($ThisFileInfo['wavpack']['blockheader']['flags_raw'] &amp; 0x00000100);
+				$ThisFileInfo['wavpack']['blockheader']['flags']['hybrid_bitrate_noise'] = (bool) ($ThisFileInfo['wavpack']['blockheader']['flags_raw'] &amp; 0x00000200);
+				$ThisFileInfo['wavpack']['blockheader']['flags']['hybrid_balance_noise'] = (bool) ($ThisFileInfo['wavpack']['blockheader']['flags_raw'] &amp; 0x00000400);
+				$ThisFileInfo['wavpack']['blockheader']['flags']['multichannel_initial'] = (bool) ($ThisFileInfo['wavpack']['blockheader']['flags_raw'] &amp; 0x00000800);
+				$ThisFileInfo['wavpack']['blockheader']['flags']['multichannel_final']   = (bool) ($ThisFileInfo['wavpack']['blockheader']['flags_raw'] &amp; 0x00001000);
+
+				$ThisFileInfo['audio']['lossless'] = !$ThisFileInfo['wavpack']['blockheader']['flags']['hybrid'];
+			}
+
+			while (!feof($fd) &amp;&amp; (ftell($fd) &lt; ($blockheader_offset + $blockheader_size + 8))) {
+
+				$metablock = array('offset'=&gt;ftell($fd));
+				$metablockheader = fread($fd, 2);
+				if (feof($fd)) {
+					break;
+				}
+				$metablock['id'] = ord($metablockheader{0});
+				$metablock['function_id'] = ($metablock['id'] &amp; 0x3F);
+				$metablock['function_name'] = $this-&gt;WavPackMetablockNameLookup($metablock['function_id']);
+
+				// The 0x20 bit in the id of the meta subblocks (which is defined as
+				// ID_OPTIONAL_DATA) is a permanent part of the id. The idea is that
+				// if a decoder encounters an id that it does not know about, it uses
+				// that &quot;ID_OPTIONAL_DATA&quot; flag to determine what to do. If it is set
+				// then the decoder simply ignores the metadata, but if it is zero
+				// then the decoder should quit because it means that an understanding
+				// of the metadata is required to correctly decode the audio.
+				$metablock['non_decoder'] = (bool) ($metablock['id'] &amp; 0x20);
+
+				$metablock['padded_data'] = (bool) ($metablock['id'] &amp; 0x40);
+				$metablock['large_block'] = (bool) ($metablock['id'] &amp; 0x80);
+				if ($metablock['large_block']) {
+					$metablockheader .= fread($fd, 2);
+				}
+				$metablock['size'] = getid3_lib::LittleEndian2Int(substr($metablockheader, 1)) * 2; // size is stored in words
+				$metablock['data'] = null;
+
+				if ($metablock['size'] &gt; 0) {
+
+					switch ($metablock['function_id']) {
+						case 0x21: // ID_RIFF_HEADER
+						case 0x22: // ID_RIFF_TRAILER
+						case 0x23: // ID_REPLAY_GAIN
+						case 0x24: // ID_CUESHEET
+						case 0x25: // ID_CONFIG_BLOCK
+						case 0x26: // ID_MD5_CHECKSUM
+							$metablock['data'] = fread($fd, $metablock['size']);
+
+							if ($metablock['padded_data']) {
+								// padded to the nearest even byte
+								$metablock['size']--;
+								$metablock['data'] = substr($metablock['data'], 0, -1);
+							}
+							break;
+
+						case 0x00: // ID_DUMMY
+						case 0x01: // ID_ENCODER_INFO
+						case 0x02: // ID_DECORR_TERMS
+						case 0x03: // ID_DECORR_WEIGHTS
+						case 0x04: // ID_DECORR_SAMPLES
+						case 0x05: // ID_ENTROPY_VARS
+						case 0x06: // ID_HYBRID_PROFILE
+						case 0x07: // ID_SHAPING_WEIGHTS
+						case 0x08: // ID_FLOAT_INFO
+						case 0x09: // ID_INT32_INFO
+						case 0x0A: // ID_WV_BITSTREAM
+						case 0x0B: // ID_WVC_BITSTREAM
+						case 0x0C: // ID_WVX_BITSTREAM
+						case 0x0D: // ID_CHANNEL_INFO
+							fseek($fd, $metablock['offset'] + ($metablock['large_block'] ? 4 : 2) + $metablock['size'], SEEK_SET);
+							break;
+
+						default:
+							$ThisFileInfo['warning'][] = 'Unexpected metablock type &quot;0x'.str_pad(dechex($metablock['function_id']), 2, '0', STR_PAD_LEFT).'&quot; at offset '.$metablock['offset'];
+							fseek($fd, $metablock['offset'] + ($metablock['large_block'] ? 4 : 2) + $metablock['size'], SEEK_SET);
+							break;
+					}
+
+					switch ($metablock['function_id']) {
+						case 0x21: // ID_RIFF_HEADER
+							getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio-video.riff.php', __FILE__, true);
+							$original_wav_filesize = getid3_lib::LittleEndian2Int(substr($metablock['data'], 4, 4));
+							getid3_riff::ParseRIFFdata($metablock['data'], $ParsedRIFFheader);
+							$metablock['riff'] = $ParsedRIFFheader['riff'];
+							$metablock['riff']['original_filesize'] = $original_wav_filesize;
+							$ThisFileInfo['wavpack']['riff_trailer_size'] = $original_wav_filesize - $metablock['riff']['WAVE']['data'][0]['size'] - $metablock['riff']['header_size'];
+
+							$ThisFileInfo['audio']['sample_rate'] = $ParsedRIFFheader['riff']['raw']['fmt ']['nSamplesPerSec'];
+							$ThisFileInfo['playtime_seconds']     = $ThisFileInfo['wavpack']['blockheader']['total_samples'] / $ThisFileInfo['audio']['sample_rate'];
+
+							// Safe RIFF header in case there's a RIFF footer later
+							$metablockRIFFheader = $metablock['data'];
+							break;
+
+
+						case 0x22: // ID_RIFF_TRAILER
+							$metablockRIFFfooter = $metablockRIFFheader.$metablock['data'];
+							getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio-video.riff.php', __FILE__, true);
+
+							$ftell_old = ftell($fd);
+							$startoffset = $metablock['offset'] + ($metablock['large_block'] ? 4 : 2);
+							$ParsedRIFFfooter = array('avdataend'=&gt;$ThisFileInfo['avdataend'], 'fileformat'=&gt;'riff', 'error'=&gt;array(), 'warning'=&gt;array());
+							$metablock['riff'] = getid3_riff::ParseRIFF($fd, $startoffset, $startoffset + $metablock['size'], $ParsedRIFFfooter);
+							fseek($fd, $ftell_old, SEEK_SET);
+
+							if (!empty($metablock['riff']['INFO'])) {
+								getid3_riff::RIFFcommentsParse($metablock['riff']['INFO'], $metablock['comments']);
+								$ThisFileInfo['tags']['riff'] = $metablock['comments'];
+							}
+							break;
+
+
+						case 0x23: // ID_REPLAY_GAIN
+							$ThisFileInfo['warning'][] = 'WavPack &quot;Replay Gain&quot; contents not yet handled by getID3() in metablock at offset '.$metablock['offset'];
+							break;
+
+
+						case 0x24: // ID_CUESHEET
+							$ThisFileInfo['warning'][] = 'WavPack &quot;Cuesheet&quot; contents not yet handled by getID3() in metablock at offset '.$metablock['offset'];
+							break;
+
+
+						case 0x25: // ID_CONFIG_BLOCK
+							$metablock['flags_raw'] = getid3_lib::LittleEndian2Int(substr($metablock['data'], 0, 3));
+
+							$metablock['flags']['adobe_mode']     = (bool) ($metablock['flags_raw'] &amp; 0x000001); // &quot;adobe&quot; mode for 32-bit floats
+							$metablock['flags']['fast_flag']      = (bool) ($metablock['flags_raw'] &amp; 0x000002); // fast mode
+							$metablock['flags']['very_fast_flag'] = (bool) ($metablock['flags_raw'] &amp; 0x000004); // double fast
+							$metablock['flags']['high_flag']      = (bool) ($metablock['flags_raw'] &amp; 0x000008); // high quality mode
+							$metablock['flags']['very_high_flag'] = (bool) ($metablock['flags_raw'] &amp; 0x000010); // double high (not used yet)
+							$metablock['flags']['bitrate_kbps']   = (bool) ($metablock['flags_raw'] &amp; 0x000020); // bitrate is kbps, not bits / sample
+							$metablock['flags']['auto_shaping']   = (bool) ($metablock['flags_raw'] &amp; 0x000040); // automatic noise shaping
+							$metablock['flags']['shape_override'] = (bool) ($metablock['flags_raw'] &amp; 0x000080); // shaping mode specified
+							$metablock['flags']['joint_override'] = (bool) ($metablock['flags_raw'] &amp; 0x000100); // joint-stereo mode specified
+							$metablock['flags']['copy_time']      = (bool) ($metablock['flags_raw'] &amp; 0x000200); // copy file-time from source
+							$metablock['flags']['create_exe']     = (bool) ($metablock['flags_raw'] &amp; 0x000400); // create executable
+							$metablock['flags']['create_wvc']     = (bool) ($metablock['flags_raw'] &amp; 0x000800); // create correction file
+							$metablock['flags']['optimize_wvc']   = (bool) ($metablock['flags_raw'] &amp; 0x001000); // maximize bybrid compression
+							$metablock['flags']['quality_mode']   = (bool) ($metablock['flags_raw'] &amp; 0x002000); // psychoacoustic quality mode
+							$metablock['flags']['raw_flag']       = (bool) ($metablock['flags_raw'] &amp; 0x004000); // raw mode (not implemented yet)
+							$metablock['flags']['calc_noise']     = (bool) ($metablock['flags_raw'] &amp; 0x008000); // calc noise in hybrid mode
+							$metablock['flags']['lossy_mode']     = (bool) ($metablock['flags_raw'] &amp; 0x010000); // obsolete (for information)
+							$metablock['flags']['extra_mode']     = (bool) ($metablock['flags_raw'] &amp; 0x020000); // extra processing mode
+							$metablock['flags']['skip_wvx']       = (bool) ($metablock['flags_raw'] &amp; 0x040000); // no wvx stream w/ floats &amp; big ints
+							$metablock['flags']['md5_checksum']   = (bool) ($metablock['flags_raw'] &amp; 0x080000); // compute &amp; store MD5 signature
+							$metablock['flags']['quiet_mode']     = (bool) ($metablock['flags_raw'] &amp; 0x100000); // don't report progress %
+
+							$ThisFileInfo['wavpack']['config_flags'] = $metablock['flags'];
+
+
+							if ($ThisFileInfo['wavpack']['blockheader']['flags']['hybrid']) {
+								@$ThisFileInfo['audio']['encoder_options'] .= ' -b???';
+							}
+							@$ThisFileInfo['audio']['encoder_options'] .= ($metablock['flags']['adobe_mode']     ? ' -a' : '');
+							@$ThisFileInfo['audio']['encoder_options'] .= ($metablock['flags']['optimize_wvc']   ? ' -cc' : '');
+							@$ThisFileInfo['audio']['encoder_options'] .= ($metablock['flags']['create_exe']     ? ' -e' : '');
+							@$ThisFileInfo['audio']['encoder_options'] .= ($metablock['flags']['fast_flag']      ? ' -f' : '');
+							@$ThisFileInfo['audio']['encoder_options'] .= ($metablock['flags']['joint_override'] ? ' -j?' : '');
+							@$ThisFileInfo['audio']['encoder_options'] .= ($metablock['flags']['high_flag']      ? ' -h' : '');
+							@$ThisFileInfo['audio']['encoder_options'] .= ($metablock['flags']['md5_checksum']   ? ' -m' : '');
+							@$ThisFileInfo['audio']['encoder_options'] .= ($metablock['flags']['calc_noise']     ? ' -n' : '');
+							@$ThisFileInfo['audio']['encoder_options'] .= ($metablock['flags']['shape_override'] ? ' -s?' : '');
+							@$ThisFileInfo['audio']['encoder_options'] .= ($metablock['flags']['extra_mode']     ? ' -x?' : '');
+							if (@$ThisFileInfo['audio']['encoder_options']) {
+							    $ThisFileInfo['audio']['encoder_options'] = trim(@$ThisFileInfo['audio']['encoder_options']);
+							}
+							elseif (isset($ThisFileInfo['audio']['encoder_options'])) {
+							    unset($ThisFileInfo['audio']['encoder_options']);
+							}
+							break;
+
+
+						case 0x26: // ID_MD5_CHECKSUM
+							if (strlen($metablock['data']) == 16) {
+								$ThisFileInfo['md5_data_source'] = strtolower(getid3_lib::PrintHexBytes($metablock['data'], true, false, false));
+							} else {
+								$ThisFileInfo['warning'][] = 'Expecting 16 bytes of WavPack &quot;MD5 Checksum&quot; in metablock at offset '.$metablock['offset'].', but found '.strlen($metablock['data']).' bytes';
+							}
+							break;
+
+
+						case 0x00: // ID_DUMMY
+						case 0x01: // ID_ENCODER_INFO
+						case 0x02: // ID_DECORR_TERMS
+						case 0x03: // ID_DECORR_WEIGHTS
+						case 0x04: // ID_DECORR_SAMPLES
+						case 0x05: // ID_ENTROPY_VARS
+						case 0x06: // ID_HYBRID_PROFILE
+						case 0x07: // ID_SHAPING_WEIGHTS
+						case 0x08: // ID_FLOAT_INFO
+						case 0x09: // ID_INT32_INFO
+						case 0x0A: // ID_WV_BITSTREAM
+						case 0x0B: // ID_WVC_BITSTREAM
+						case 0x0C: // ID_WVX_BITSTREAM
+						case 0x0D: // ID_CHANNEL_INFO
+							unset($metablock);
+							break;
+					}
+
+				}
+				if (!empty($metablock)) {
+					$ThisFileInfo['wavpack']['metablocks'][] = $metablock;
+				}
+
+			}
+
+		}
+
+		$ThisFileInfo['audio']['encoder']         = 'WavPack v'.$ThisFileInfo['wavpack']['blockheader']['major_version'].'.'.str_pad($ThisFileInfo['wavpack']['blockheader']['minor_version'], 2, '0', STR_PAD_LEFT);
+		$ThisFileInfo['audio']['bits_per_sample'] = $ThisFileInfo['wavpack']['blockheader']['flags']['bytes_per_sample'] * 8;
+		$ThisFileInfo['audio']['channels']        = ($ThisFileInfo['wavpack']['blockheader']['flags']['mono'] ? 1 : 2);
+
+		if (@$ThisFileInfo['playtime_seconds']) {
+
+			$ThisFileInfo['audio']['bitrate']     = (($ThisFileInfo['avdataend'] - $ThisFileInfo['avdataoffset']) * 8) / $ThisFileInfo['playtime_seconds'];
+
+		} else {
+
+			$ThisFileInfo['audio']['dataformat']  = 'wvc';
+
+		}
+
+		return true;
+	}
+
+
+	function WavPackMetablockNameLookup(&amp;$id) {
+		static $WavPackMetablockNameLookup = array(
+			0x00 =&gt; 'Dummy',
+			0x01 =&gt; 'Encoder Info',
+			0x02 =&gt; 'Decorrelation Terms',
+			0x03 =&gt; 'Decorrelation Weights',
+			0x04 =&gt; 'Decorrelation Samples',
+			0x05 =&gt; 'Entropy Variables',
+			0x06 =&gt; 'Hybrid Profile',
+			0x07 =&gt; 'Shaping Weights',
+			0x08 =&gt; 'Float Info',
+			0x09 =&gt; 'Int32 Info',
+			0x0A =&gt; 'WV Bitstream',
+			0x0B =&gt; 'WVC Bitstream',
+			0x0C =&gt; 'WVX Bitstream',
+			0x0D =&gt; 'Channel Info',
+			0x21 =&gt; 'RIFF header',
+			0x22 =&gt; 'RIFF trailer',
+			0x23 =&gt; 'Replay Gain',
+			0x24 =&gt; 'Cuesheet',
+			0x25 =&gt; 'Config Block',
+			0x26 =&gt; 'MD5 Checksum',
+		);
+		return (@$WavPackMetablockNameLookup[$id]);
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.audio.wavpack.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.graphic.bmp.php
===================================================================
--- trunk/inc/external/getid3/module.graphic.bmp.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.graphic.bmp.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,673 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.graphic.bmp.php                                      //
+// module for analyzing BMP Image files                        //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_bmp
+{
+
+	function getid3_bmp(&amp;$fd, &amp;$ThisFileInfo, $ExtractPalette=false, $ExtractData=false) {
+
+	    // shortcuts
+	    $ThisFileInfo['bmp']['header']['raw'] = array();
+	    $thisfile_bmp                         = &amp;$ThisFileInfo['bmp'];
+	    $thisfile_bmp_header                  = &amp;$thisfile_bmp['header'];
+	    $thisfile_bmp_header_raw              = &amp;$thisfile_bmp_header['raw'];
+
+		// BITMAPFILEHEADER [14 bytes] - <A HREF="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_62uq.asp">http://msdn.microsoft.com/library/en-us/gdi/bitmaps_62uq.asp</A>
+		// all versions
+		// WORD    bfType;
+		// DWORD   bfSize;
+		// WORD    bfReserved1;
+		// WORD    bfReserved2;
+		// DWORD   bfOffBits;
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$offset = 0;
+		$BMPheader = fread($fd, 14 + 40);
+
+		$thisfile_bmp_header_raw['identifier']  = substr($BMPheader, $offset, 2);
+		$offset += 2;
+
+		if ($thisfile_bmp_header_raw['identifier'] != 'BM') {
+			$ThisFileInfo['error'][] = 'Expecting &quot;BM&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.$thisfile_bmp_header_raw['identifier'].'&quot;';
+			unset($ThisFileInfo['fileformat']);
+			unset($ThisFileInfo['bmp']);
+			return false;
+		}
+
+		$thisfile_bmp_header_raw['filesize']    = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+		$offset += 4;
+		$thisfile_bmp_header_raw['reserved1']   = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 2));
+		$offset += 2;
+		$thisfile_bmp_header_raw['reserved2']   = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 2));
+		$offset += 2;
+		$thisfile_bmp_header_raw['data_offset'] = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+		$offset += 4;
+		$thisfile_bmp_header_raw['header_size'] = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+		$offset += 4;
+
+
+		// check if the hardcoded-to-1 &quot;planes&quot; is at offset 22 or 26
+		$planes22 = getid3_lib::LittleEndian2Int(substr($BMPheader, 22, 2));
+		$planes26 = getid3_lib::LittleEndian2Int(substr($BMPheader, 26, 2));
+		if (($planes22 == 1) &amp;&amp; ($planes26 != 1)) {
+			$thisfile_bmp['type_os']      = 'OS/2';
+			$thisfile_bmp['type_version'] = 1;
+		} elseif (($planes26 == 1) &amp;&amp; ($planes22 != 1)) {
+			$thisfile_bmp['type_os']      = 'Windows';
+			$thisfile_bmp['type_version'] = 1;
+		} elseif ($thisfile_bmp_header_raw['header_size'] == 12) {
+			$thisfile_bmp['type_os']      = 'OS/2';
+			$thisfile_bmp['type_version'] = 1;
+		} elseif ($thisfile_bmp_header_raw['header_size'] == 40) {
+			$thisfile_bmp['type_os']      = 'Windows';
+			$thisfile_bmp['type_version'] = 1;
+		} elseif ($thisfile_bmp_header_raw['header_size'] == 84) {
+			$thisfile_bmp['type_os']      = 'Windows';
+			$thisfile_bmp['type_version'] = 4;
+		} elseif ($thisfile_bmp_header_raw['header_size'] == 100) {
+			$thisfile_bmp['type_os']      = 'Windows';
+			$thisfile_bmp['type_version'] = 5;
+		} else {
+			$ThisFileInfo['error'][] = 'Unknown BMP subtype (or not a BMP file)';
+			unset($ThisFileInfo['fileformat']);
+			unset($ThisFileInfo['bmp']);
+			return false;
+		}
+
+		$ThisFileInfo['fileformat']                  = 'bmp';
+		$ThisFileInfo['video']['dataformat']         = 'bmp';
+		$ThisFileInfo['video']['lossless']           = true;
+		$ThisFileInfo['video']['pixel_aspect_ratio'] = (float) 1;
+
+		if ($thisfile_bmp['type_os'] == 'OS/2') {
+
+			// OS/2-format BMP
+			// <A HREF="http://netghost.narod.ru/gff/graphics/summary/os2bmp.htm">http://netghost.narod.ru/gff/graphics/summary/os2bmp.htm</A>
+
+			// DWORD  Size;             /* Size of this structure in bytes */
+			// DWORD  Width;            /* Bitmap width in pixels */
+			// DWORD  Height;           /* Bitmap height in pixel */
+			// WORD   NumPlanes;        /* Number of bit planes (color depth) */
+			// WORD   BitsPerPixel;     /* Number of bits per pixel per plane */
+
+			$thisfile_bmp_header_raw['width']          = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 2));
+			$offset += 2;
+			$thisfile_bmp_header_raw['height']         = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 2));
+			$offset += 2;
+			$thisfile_bmp_header_raw['planes']         = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 2));
+			$offset += 2;
+			$thisfile_bmp_header_raw['bits_per_pixel'] = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 2));
+			$offset += 2;
+
+			$ThisFileInfo['video']['resolution_x']    = $thisfile_bmp_header_raw['width'];
+			$ThisFileInfo['video']['resolution_y']    = $thisfile_bmp_header_raw['height'];
+			$ThisFileInfo['video']['codec']           = 'BI_RGB '.$thisfile_bmp_header_raw['bits_per_pixel'].'-bit';
+			$ThisFileInfo['video']['bits_per_sample'] = $thisfile_bmp_header_raw['bits_per_pixel'];
+
+			if ($thisfile_bmp['type_version'] &gt;= 2) {
+				// DWORD  Compression;      /* Bitmap compression scheme */
+				// DWORD  ImageDataSize;    /* Size of bitmap data in bytes */
+				// DWORD  XResolution;      /* X resolution of display device */
+				// DWORD  YResolution;      /* Y resolution of display device */
+				// DWORD  ColorsUsed;       /* Number of color table indices used */
+				// DWORD  ColorsImportant;  /* Number of important color indices */
+				// WORD   Units;            /* Type of units used to measure resolution */
+				// WORD   Reserved;         /* Pad structure to 4-byte boundary */
+				// WORD   Recording;        /* Recording algorithm */
+				// WORD   Rendering;        /* Halftoning algorithm used */
+				// DWORD  Size1;            /* Reserved for halftoning algorithm use */
+				// DWORD  Size2;            /* Reserved for halftoning algorithm use */
+				// DWORD  ColorEncoding;    /* Color model used in bitmap */
+				// DWORD  Identifier;       /* Reserved for application use */
+
+				$thisfile_bmp_header_raw['compression']      = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['bmp_data_size']    = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['resolution_h']     = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['resolution_v']     = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['colors_used']      = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['colors_important'] = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['resolution_units'] = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 2));
+				$offset += 2;
+				$thisfile_bmp_header_raw['reserved1']        = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 2));
+				$offset += 2;
+				$thisfile_bmp_header_raw['recording']        = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 2));
+				$offset += 2;
+				$thisfile_bmp_header_raw['rendering']        = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 2));
+				$offset += 2;
+				$thisfile_bmp_header_raw['size1']            = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['size2']            = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['color_encoding']   = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['identifier']       = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+
+				$thisfile_bmp_header['compression']             = $this-&gt;BMPcompressionOS2Lookup($thisfile_bmp_header_raw['compression']);
+
+				$ThisFileInfo['video']['codec'] = $thisfile_bmp_header['compression'].' '.$thisfile_bmp_header_raw['bits_per_pixel'].'-bit';
+			}
+
+		} elseif ($thisfile_bmp['type_os'] == 'Windows') {
+
+			// Windows-format BMP
+
+			// BITMAPINFOHEADER - [40 bytes] <A HREF="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_1rw2.asp">http://msdn.microsoft.com/library/en-us/gdi/bitmaps_1rw2.asp</A>
+			// all versions
+			// DWORD  biSize;
+			// LONG   biWidth;
+			// LONG   biHeight;
+			// WORD   biPlanes;
+			// WORD   biBitCount;
+			// DWORD  biCompression;
+			// DWORD  biSizeImage;
+			// LONG   biXPelsPerMeter;
+			// LONG   biYPelsPerMeter;
+			// DWORD  biClrUsed;
+			// DWORD  biClrImportant;
+
+			$thisfile_bmp_header_raw['width']            = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4), true);
+			$offset += 4;
+			$thisfile_bmp_header_raw['height']           = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4), true);
+			$offset += 4;
+			$thisfile_bmp_header_raw['planes']           = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 2));
+			$offset += 2;
+			$thisfile_bmp_header_raw['bits_per_pixel']   = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 2));
+			$offset += 2;
+			$thisfile_bmp_header_raw['compression']      = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+			$offset += 4;
+			$thisfile_bmp_header_raw['bmp_data_size']    = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+			$offset += 4;
+			$thisfile_bmp_header_raw['resolution_h']     = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4), true);
+			$offset += 4;
+			$thisfile_bmp_header_raw['resolution_v']     = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4), true);
+			$offset += 4;
+			$thisfile_bmp_header_raw['colors_used']      = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+			$offset += 4;
+			$thisfile_bmp_header_raw['colors_important'] = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+			$offset += 4;
+
+			$thisfile_bmp_header['compression']  = $this-&gt;BMPcompressionWindowsLookup($thisfile_bmp_header_raw['compression']);
+			$ThisFileInfo['video']['resolution_x']    = $thisfile_bmp_header_raw['width'];
+			$ThisFileInfo['video']['resolution_y']    = $thisfile_bmp_header_raw['height'];
+			$ThisFileInfo['video']['codec']           = $thisfile_bmp_header['compression'].' '.$thisfile_bmp_header_raw['bits_per_pixel'].'-bit';
+			$ThisFileInfo['video']['bits_per_sample'] = $thisfile_bmp_header_raw['bits_per_pixel'];
+
+			if ($thisfile_bmp['type_version'] &gt;= 4) {
+				$BMPheader .= fread($fd, 44);
+
+				// BITMAPV4HEADER - [44 bytes] - <A HREF="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_2k1e.asp">http://msdn.microsoft.com/library/en-us/gdi/bitmaps_2k1e.asp</A>
+				// Win95+, WinNT4.0+
+				// DWORD        bV4RedMask;
+				// DWORD        bV4GreenMask;
+				// DWORD        bV4BlueMask;
+				// DWORD        bV4AlphaMask;
+				// DWORD        bV4CSType;
+				// CIEXYZTRIPLE bV4Endpoints;
+				// DWORD        bV4GammaRed;
+				// DWORD        bV4GammaGreen;
+				// DWORD        bV4GammaBlue;
+				$thisfile_bmp_header_raw['red_mask']     = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['green_mask']   = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['blue_mask']    = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['alpha_mask']   = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['cs_type']      = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['ciexyz_red']   =                  substr($BMPheader, $offset, 4);
+				$offset += 4;
+				$thisfile_bmp_header_raw['ciexyz_green'] =                  substr($BMPheader, $offset, 4);
+				$offset += 4;
+				$thisfile_bmp_header_raw['ciexyz_blue']  =                  substr($BMPheader, $offset, 4);
+				$offset += 4;
+				$thisfile_bmp_header_raw['gamma_red']    = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['gamma_green']  = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['gamma_blue']   = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+
+				$thisfile_bmp_header['ciexyz_red']   = getid3_lib::FixedPoint2_30(strrev($thisfile_bmp_header_raw['ciexyz_red']));
+				$thisfile_bmp_header['ciexyz_green'] = getid3_lib::FixedPoint2_30(strrev($thisfile_bmp_header_raw['ciexyz_green']));
+				$thisfile_bmp_header['ciexyz_blue']  = getid3_lib::FixedPoint2_30(strrev($thisfile_bmp_header_raw['ciexyz_blue']));
+			}
+
+			if ($thisfile_bmp['type_version'] &gt;= 5) {
+				$BMPheader .= fread($fd, 16);
+
+				// BITMAPV5HEADER - [16 bytes] - <A HREF="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_7c36.asp">http://msdn.microsoft.com/library/en-us/gdi/bitmaps_7c36.asp</A>
+				// Win98+, Win2000+
+				// DWORD        bV5Intent;
+				// DWORD        bV5ProfileData;
+				// DWORD        bV5ProfileSize;
+				// DWORD        bV5Reserved;
+				$thisfile_bmp_header_raw['intent']              = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['profile_data_offset'] = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['profile_data_size']   = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+				$thisfile_bmp_header_raw['reserved3']           = getid3_lib::LittleEndian2Int(substr($BMPheader, $offset, 4));
+				$offset += 4;
+			}
+
+		} else {
+
+			$ThisFileInfo['error'][] = 'Unknown BMP format in header.';
+			return false;
+
+		}
+
+
+		if ($ExtractPalette || $ExtractData) {
+			$PaletteEntries = 0;
+			if ($thisfile_bmp_header_raw['bits_per_pixel'] &lt; 16) {
+				$PaletteEntries = pow(2, $thisfile_bmp_header_raw['bits_per_pixel']);
+			} elseif (isset($thisfile_bmp_header_raw['colors_used']) &amp;&amp; ($thisfile_bmp_header_raw['colors_used'] &gt; 0) &amp;&amp; ($thisfile_bmp_header_raw['colors_used'] &lt;= 256)) {
+				$PaletteEntries = $thisfile_bmp_header_raw['colors_used'];
+			}
+			if ($PaletteEntries &gt; 0) {
+				$BMPpalette = fread($fd, 4 * $PaletteEntries);
+				$paletteoffset = 0;
+				for ($i = 0; $i &lt; $PaletteEntries; $i++) {
+					// RGBQUAD          - <A HREF="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_5f8y.asp">http://msdn.microsoft.com/library/en-us/gdi/bitmaps_5f8y.asp</A>
+					// BYTE    rgbBlue;
+					// BYTE    rgbGreen;
+					// BYTE    rgbRed;
+					// BYTE    rgbReserved;
+					$blue  = getid3_lib::LittleEndian2Int(substr($BMPpalette, $paletteoffset++, 1));
+					$green = getid3_lib::LittleEndian2Int(substr($BMPpalette, $paletteoffset++, 1));
+					$red   = getid3_lib::LittleEndian2Int(substr($BMPpalette, $paletteoffset++, 1));
+					if (($thisfile_bmp['type_os'] == 'OS/2') &amp;&amp; ($thisfile_bmp['type_version'] == 1)) {
+						// no padding byte
+					} else {
+						$paletteoffset++; // padding byte
+					}
+					$thisfile_bmp['palette'][$i] = (($red &lt;&lt; 16) | ($green &lt;&lt; 8) | $blue);
+				}
+			}
+		}
+
+		if ($ExtractData) {
+			fseek($fd, $thisfile_bmp_header_raw['data_offset'], SEEK_SET);
+			$RowByteLength = ceil(($thisfile_bmp_header_raw['width'] * ($thisfile_bmp_header_raw['bits_per_pixel'] / 8)) / 4) * 4; // round up to nearest DWORD boundry
+			$BMPpixelData = fread($fd, $thisfile_bmp_header_raw['height'] * $RowByteLength);
+			$pixeldataoffset = 0;
+			switch (@$thisfile_bmp_header_raw['compression']) {
+
+				case 0: // BI_RGB
+					switch ($thisfile_bmp_header_raw['bits_per_pixel']) {
+						case 1:
+							for ($row = ($thisfile_bmp_header_raw['height'] - 1); $row &gt;= 0; $row--) {
+								for ($col = 0; $col &lt; $thisfile_bmp_header_raw['width']; $col = $col) {
+									$paletteindexbyte = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+									for ($i = 7; $i &gt;= 0; $i--) {
+										$paletteindex = ($paletteindexbyte &amp; (0x01 &lt;&lt; $i)) &gt;&gt; $i;
+										$thisfile_bmp['data'][$row][$col] = $thisfile_bmp['palette'][$paletteindex];
+										$col++;
+									}
+								}
+								while (($pixeldataoffset % 4) != 0) {
+									// lines are padded to nearest DWORD
+									$pixeldataoffset++;
+								}
+							}
+							break;
+
+						case 4:
+							for ($row = ($thisfile_bmp_header_raw['height'] - 1); $row &gt;= 0; $row--) {
+								for ($col = 0; $col &lt; $thisfile_bmp_header_raw['width']; $col = $col) {
+									$paletteindexbyte = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+									for ($i = 1; $i &gt;= 0; $i--) {
+										$paletteindex = ($paletteindexbyte &amp; (0x0F &lt;&lt; (4 * $i))) &gt;&gt; (4 * $i);
+										$thisfile_bmp['data'][$row][$col] = $thisfile_bmp['palette'][$paletteindex];
+										$col++;
+									}
+								}
+								while (($pixeldataoffset % 4) != 0) {
+									// lines are padded to nearest DWORD
+									$pixeldataoffset++;
+								}
+							}
+							break;
+
+						case 8:
+							for ($row = ($thisfile_bmp_header_raw['height'] - 1); $row &gt;= 0; $row--) {
+								for ($col = 0; $col &lt; $thisfile_bmp_header_raw['width']; $col++) {
+									$paletteindex = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+									$thisfile_bmp['data'][$row][$col] = $thisfile_bmp['palette'][$paletteindex];
+								}
+								while (($pixeldataoffset % 4) != 0) {
+									// lines are padded to nearest DWORD
+									$pixeldataoffset++;
+								}
+							}
+							break;
+
+						case 24:
+						case 32:
+							for ($row = ($thisfile_bmp_header_raw['height'] - 1); $row &gt;= 0; $row--) {
+								for ($col = 0; $col &lt; $thisfile_bmp_header_raw['width']; $col++) {
+									$blue  = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+									$green = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+									$red   = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+									if ($thisfile_bmp_header_raw['bits_per_pixel'] == 32) {
+										$paletteoffset++; // filler byte
+									}
+									$thisfile_bmp['data'][$row][$col] = (($red &lt;&lt; 16) | ($green &lt;&lt; 8) | ($blue));
+								}
+								while (($pixeldataoffset % 4) != 0) {
+									// lines are padded to nearest DWORD
+									$pixeldataoffset++;
+								}
+							}
+							break;
+
+						case 16:
+
+						default:
+							$ThisFileInfo['error'][] = 'Unknown bits-per-pixel value ('.$thisfile_bmp_header_raw['bits_per_pixel'].') - cannot read pixel data';
+							break;
+					}
+					break;
+
+
+				case 1: // BI_RLE8 - <A HREF="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_6x0u.asp">http://msdn.microsoft.com/library/en-us/gdi/bitmaps_6x0u.asp</A>
+					switch ($thisfile_bmp_header_raw['bits_per_pixel']) {
+						case 8:
+							$pixelcounter = 0;
+							while ($pixeldataoffset &lt; strlen($BMPpixelData)) {
+								$firstbyte  = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+								$secondbyte = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+								if ($firstbyte == 0) {
+
+									// escaped/absolute mode - the first byte of the pair can be set to zero to
+									// indicate an escape character that denotes the end of a line, the end of
+									// a bitmap, or a delta, depending on the value of the second byte.
+									switch ($secondbyte) {
+										case 0:
+											// end of line
+											// no need for special processing, just ignore
+											break;
+
+										case 1:
+											// end of bitmap
+											$pixeldataoffset = strlen($BMPpixelData); // force to exit loop just in case
+											break;
+
+										case 2:
+											// delta - The 2 bytes following the escape contain unsigned values
+											// indicating the horizontal and vertical offsets of the next pixel
+											// from the current position.
+											$colincrement = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+											$rowincrement = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+											$col = ($pixelcounter % $thisfile_bmp_header_raw['width']) + $colincrement;
+											$row = ($thisfile_bmp_header_raw['height'] - 1 - (($pixelcounter - $col) / $thisfile_bmp_header_raw['width'])) - $rowincrement;
+											$pixelcounter = ($row * $thisfile_bmp_header_raw['width']) + $col;
+											break;
+
+										default:
+											// In absolute mode, the first byte is zero and the second byte is a
+											// value in the range 03H through FFH. The second byte represents the
+											// number of bytes that follow, each of which contains the color index
+											// of a single pixel. Each run must be aligned on a word boundary.
+											for ($i = 0; $i &lt; $secondbyte; $i++) {
+												$paletteindex = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+												$col = $pixelcounter % $thisfile_bmp_header_raw['width'];
+												$row = $thisfile_bmp_header_raw['height'] - 1 - (($pixelcounter - $col) / $thisfile_bmp_header_raw['width']);
+												$thisfile_bmp['data'][$row][$col] = $thisfile_bmp['palette'][$paletteindex];
+												$pixelcounter++;
+											}
+											while (($pixeldataoffset % 2) != 0) {
+												// Each run must be aligned on a word boundary.
+												$pixeldataoffset++;
+											}
+											break;
+									}
+
+								} else {
+
+									// encoded mode - the first byte specifies the number of consecutive pixels
+									// to be drawn using the color index contained in the second byte.
+									for ($i = 0; $i &lt; $firstbyte; $i++) {
+										$col = $pixelcounter % $thisfile_bmp_header_raw['width'];
+										$row = $thisfile_bmp_header_raw['height'] - 1 - (($pixelcounter - $col) / $thisfile_bmp_header_raw['width']);
+										$thisfile_bmp['data'][$row][$col] = $thisfile_bmp['palette'][$secondbyte];
+										$pixelcounter++;
+									}
+
+								}
+							}
+							break;
+
+						default:
+							$ThisFileInfo['error'][] = 'Unknown bits-per-pixel value ('.$thisfile_bmp_header_raw['bits_per_pixel'].') - cannot read pixel data';
+							break;
+					}
+					break;
+
+
+
+				case 2: // BI_RLE4 - <A HREF="http://msdn.microsoft.com/library/en-us/gdi/bitmaps_6x0u.asp">http://msdn.microsoft.com/library/en-us/gdi/bitmaps_6x0u.asp</A>
+					switch ($thisfile_bmp_header_raw['bits_per_pixel']) {
+						case 4:
+							$pixelcounter = 0;
+							while ($pixeldataoffset &lt; strlen($BMPpixelData)) {
+								$firstbyte  = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+								$secondbyte = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+								if ($firstbyte == 0) {
+
+									// escaped/absolute mode - the first byte of the pair can be set to zero to
+									// indicate an escape character that denotes the end of a line, the end of
+									// a bitmap, or a delta, depending on the value of the second byte.
+									switch ($secondbyte) {
+										case 0:
+											// end of line
+											// no need for special processing, just ignore
+											break;
+
+										case 1:
+											// end of bitmap
+											$pixeldataoffset = strlen($BMPpixelData); // force to exit loop just in case
+											break;
+
+										case 2:
+											// delta - The 2 bytes following the escape contain unsigned values
+											// indicating the horizontal and vertical offsets of the next pixel
+											// from the current position.
+											$colincrement = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+											$rowincrement = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+											$col = ($pixelcounter % $thisfile_bmp_header_raw['width']) + $colincrement;
+											$row = ($thisfile_bmp_header_raw['height'] - 1 - (($pixelcounter - $col) / $thisfile_bmp_header_raw['width'])) - $rowincrement;
+											$pixelcounter = ($row * $thisfile_bmp_header_raw['width']) + $col;
+											break;
+
+										default:
+											// In absolute mode, the first byte is zero. The second byte contains the number
+											// of color indexes that follow. Subsequent bytes contain color indexes in their
+											// high- and low-order 4 bits, one color index for each pixel. In absolute mode,
+											// each run must be aligned on a word boundary.
+											unset($paletteindexes);
+											for ($i = 0; $i &lt; ceil($secondbyte / 2); $i++) {
+												$paletteindexbyte = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset++, 1));
+												$paletteindexes[] = ($paletteindexbyte &amp; 0xF0) &gt;&gt; 4;
+												$paletteindexes[] = ($paletteindexbyte &amp; 0x0F);
+											}
+											while (($pixeldataoffset % 2) != 0) {
+												// Each run must be aligned on a word boundary.
+												$pixeldataoffset++;
+											}
+
+											foreach ($paletteindexes as $paletteindex) {
+												$col = $pixelcounter % $thisfile_bmp_header_raw['width'];
+												$row = $thisfile_bmp_header_raw['height'] - 1 - (($pixelcounter - $col) / $thisfile_bmp_header_raw['width']);
+												$thisfile_bmp['data'][$row][$col] = $thisfile_bmp['palette'][$paletteindex];
+												$pixelcounter++;
+											}
+											break;
+									}
+
+								} else {
+
+									// encoded mode - the first byte of the pair contains the number of pixels to be
+									// drawn using the color indexes in the second byte. The second byte contains two
+									// color indexes, one in its high-order 4 bits and one in its low-order 4 bits.
+									// The first of the pixels is drawn using the color specified by the high-order
+									// 4 bits, the second is drawn using the color in the low-order 4 bits, the third
+									// is drawn using the color in the high-order 4 bits, and so on, until all the
+									// pixels specified by the first byte have been drawn.
+									$paletteindexes[0] = ($secondbyte &amp; 0xF0) &gt;&gt; 4;
+									$paletteindexes[1] = ($secondbyte &amp; 0x0F);
+									for ($i = 0; $i &lt; $firstbyte; $i++) {
+										$col = $pixelcounter % $thisfile_bmp_header_raw['width'];
+										$row = $thisfile_bmp_header_raw['height'] - 1 - (($pixelcounter - $col) / $thisfile_bmp_header_raw['width']);
+										$thisfile_bmp['data'][$row][$col] = $thisfile_bmp['palette'][$paletteindexes[($i % 2)]];
+										$pixelcounter++;
+									}
+
+								}
+							}
+							break;
+
+						default:
+							$ThisFileInfo['error'][] = 'Unknown bits-per-pixel value ('.$thisfile_bmp_header_raw['bits_per_pixel'].') - cannot read pixel data';
+							break;
+					}
+					break;
+
+
+				case 3: // BI_BITFIELDS
+					switch ($thisfile_bmp_header_raw['bits_per_pixel']) {
+						case 16:
+						case 32:
+							$redshift   = 0;
+							$greenshift = 0;
+							$blueshift  = 0;
+							while ((($thisfile_bmp_header_raw['red_mask'] &gt;&gt; $redshift) &amp; 0x01) == 0) {
+								$redshift++;
+							}
+							while ((($thisfile_bmp_header_raw['green_mask'] &gt;&gt; $greenshift) &amp; 0x01) == 0) {
+								$greenshift++;
+							}
+							while ((($thisfile_bmp_header_raw['blue_mask'] &gt;&gt; $blueshift) &amp; 0x01) == 0) {
+								$blueshift++;
+							}
+							for ($row = ($thisfile_bmp_header_raw['height'] - 1); $row &gt;= 0; $row--) {
+								for ($col = 0; $col &lt; $thisfile_bmp_header_raw['width']; $col++) {
+									$pixelvalue = getid3_lib::LittleEndian2Int(substr($BMPpixelData, $pixeldataoffset, $thisfile_bmp_header_raw['bits_per_pixel'] / 8));
+									$pixeldataoffset += $thisfile_bmp_header_raw['bits_per_pixel'] / 8;
+
+									$red   = intval(round(((($pixelvalue &amp; $thisfile_bmp_header_raw['red_mask'])   &gt;&gt; $redshift)   / ($thisfile_bmp_header_raw['red_mask']   &gt;&gt; $redshift))   * 255));
+									$green = intval(round(((($pixelvalue &amp; $thisfile_bmp_header_raw['green_mask']) &gt;&gt; $greenshift) / ($thisfile_bmp_header_raw['green_mask'] &gt;&gt; $greenshift)) * 255));
+									$blue  = intval(round(((($pixelvalue &amp; $thisfile_bmp_header_raw['blue_mask'])  &gt;&gt; $blueshift)  / ($thisfile_bmp_header_raw['blue_mask']  &gt;&gt; $blueshift))  * 255));
+									$thisfile_bmp['data'][$row][$col] = (($red &lt;&lt; 16) | ($green &lt;&lt; 8) | ($blue));
+								}
+								while (($pixeldataoffset % 4) != 0) {
+									// lines are padded to nearest DWORD
+									$pixeldataoffset++;
+								}
+							}
+							break;
+
+						default:
+							$ThisFileInfo['error'][] = 'Unknown bits-per-pixel value ('.$thisfile_bmp_header_raw['bits_per_pixel'].') - cannot read pixel data';
+							break;
+					}
+					break;
+
+
+				default: // unhandled compression type
+					$ThisFileInfo['error'][] = 'Unknown/unhandled compression type value ('.$thisfile_bmp_header_raw['compression'].') - cannot decompress pixel data';
+					break;
+			}
+		}
+
+		return true;
+	}
+
+
+	function PlotBMP(&amp;$BMPinfo) {
+		$starttime = time();
+		if (!isset($BMPinfo['bmp']['data']) || !is_array($BMPinfo['bmp']['data'])) {
+			echo 'ERROR: no pixel data&lt;BR&gt;';
+			return false;
+		}
+		set_time_limit(intval(round($BMPinfo['resolution_x'] * $BMPinfo['resolution_y'] / 10000)));
+		if ($im = ImageCreateTrueColor($BMPinfo['resolution_x'], $BMPinfo['resolution_y'])) {
+			for ($row = 0; $row &lt; $BMPinfo['resolution_y']; $row++) {
+				for ($col = 0; $col &lt; $BMPinfo['resolution_x']; $col++) {
+					if (isset($BMPinfo['bmp']['data'][$row][$col])) {
+						$red   = ($BMPinfo['bmp']['data'][$row][$col] &amp; 0x00FF0000) &gt;&gt; 16;
+						$green = ($BMPinfo['bmp']['data'][$row][$col] &amp; 0x0000FF00) &gt;&gt; 8;
+						$blue  = ($BMPinfo['bmp']['data'][$row][$col] &amp; 0x000000FF);
+						$pixelcolor = ImageColorAllocate($im, $red, $green, $blue);
+						ImageSetPixel($im, $col, $row, $pixelcolor);
+					} else {
+						//echo 'ERROR: no data for pixel '.$row.' x '.$col.'&lt;BR&gt;';
+						//return false;
+					}
+				}
+			}
+			if (headers_sent()) {
+				echo 'plotted '.($BMPinfo['resolution_x'] * $BMPinfo['resolution_y']).' pixels in '.(time() - $starttime).' seconds&lt;BR&gt;';
+				ImageDestroy($im);
+				exit;
+			} else {
+				header('Content-type: image/png');
+				ImagePNG($im);
+				ImageDestroy($im);
+				return true;
+			}
+		}
+		return false;
+	}
+
+	function BMPcompressionWindowsLookup($compressionid) {
+		static $BMPcompressionWindowsLookup = array(
+			0 =&gt; 'BI_RGB',
+			1 =&gt; 'BI_RLE8',
+			2 =&gt; 'BI_RLE4',
+			3 =&gt; 'BI_BITFIELDS',
+			4 =&gt; 'BI_JPEG',
+			5 =&gt; 'BI_PNG'
+		);
+		return (isset($BMPcompressionWindowsLookup[$compressionid]) ? $BMPcompressionWindowsLookup[$compressionid] : 'invalid');
+	}
+
+	function BMPcompressionOS2Lookup($compressionid) {
+		static $BMPcompressionOS2Lookup = array(
+			0 =&gt; 'BI_RGB',
+			1 =&gt; 'BI_RLE8',
+			2 =&gt; 'BI_RLE4',
+			3 =&gt; 'Huffman 1D',
+			4 =&gt; 'BI_RLE24',
+		);
+		return (isset($BMPcompressionOS2Lookup[$compressionid]) ? $BMPcompressionOS2Lookup[$compressionid] : 'invalid');
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.graphic.bmp.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.graphic.gif.php
===================================================================
--- trunk/inc/external/getid3/module.graphic.gif.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.graphic.gif.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,183 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.graphic.gif.php                                      //
+// module for analyzing GIF Image files                        //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_gif
+{
+
+	function getid3_gif(&amp;$fd, &amp;$ThisFileInfo) {
+		$ThisFileInfo['fileformat']                  = 'gif';
+		$ThisFileInfo['video']['dataformat']         = 'gif';
+		$ThisFileInfo['video']['lossless']           = true;
+		$ThisFileInfo['video']['pixel_aspect_ratio'] = (float) 1;
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$GIFheader = fread($fd, 13);
+		$offset = 0;
+
+		$ThisFileInfo['gif']['header']['raw']['identifier']            =                              substr($GIFheader, $offset, 3);
+		$offset += 3;
+
+		if ($ThisFileInfo['gif']['header']['raw']['identifier'] != 'GIF') {
+			$ThisFileInfo['error'][] = 'Expecting &quot;GIF&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.$ThisFileInfo['gif']['header']['raw']['identifier'].'&quot;';
+			unset($ThisFileInfo['fileformat']);
+			unset($ThisFileInfo['gif']);
+			return false;
+		}
+
+		$ThisFileInfo['gif']['header']['raw']['version']               =                              substr($GIFheader, $offset, 3);
+		$offset += 3;
+		$ThisFileInfo['gif']['header']['raw']['width']                 = getid3_lib::LittleEndian2Int(substr($GIFheader, $offset, 2));
+		$offset += 2;
+		$ThisFileInfo['gif']['header']['raw']['height']                = getid3_lib::LittleEndian2Int(substr($GIFheader, $offset, 2));
+		$offset += 2;
+		$ThisFileInfo['gif']['header']['raw']['flags']                 = getid3_lib::LittleEndian2Int(substr($GIFheader, $offset, 1));
+		$offset += 1;
+		$ThisFileInfo['gif']['header']['raw']['bg_color_index']        = getid3_lib::LittleEndian2Int(substr($GIFheader, $offset, 1));
+		$offset += 1;
+		$ThisFileInfo['gif']['header']['raw']['aspect_ratio']          = getid3_lib::LittleEndian2Int(substr($GIFheader, $offset, 1));
+		$offset += 1;
+
+		$ThisFileInfo['video']['resolution_x']                         = $ThisFileInfo['gif']['header']['raw']['width'];
+		$ThisFileInfo['video']['resolution_y']                         = $ThisFileInfo['gif']['header']['raw']['height'];
+		$ThisFileInfo['gif']['version']                                = $ThisFileInfo['gif']['header']['raw']['version'];
+		$ThisFileInfo['gif']['header']['flags']['global_color_table']  = (bool) ($ThisFileInfo['gif']['header']['raw']['flags'] &amp; 0x80);
+		if ($ThisFileInfo['gif']['header']['raw']['flags'] &amp; 0x80) {
+			// Number of bits per primary color available to the original image, minus 1
+			$ThisFileInfo['gif']['header']['bits_per_pixel']  = 3 * ((($ThisFileInfo['gif']['header']['raw']['flags'] &amp; 0x70) &gt;&gt; 4) + 1);
+		} else {
+			$ThisFileInfo['gif']['header']['bits_per_pixel']  = 0;
+		}
+		$ThisFileInfo['gif']['header']['flags']['global_color_sorted'] = (bool) ($ThisFileInfo['gif']['header']['raw']['flags'] &amp; 0x40);
+		if ($ThisFileInfo['gif']['header']['flags']['global_color_table']) {
+			// the number of bytes contained in the Global Color Table. To determine that
+			// actual size of the color table, raise 2 to [the value of the field + 1]
+			$ThisFileInfo['gif']['header']['global_color_size'] = pow(2, ($ThisFileInfo['gif']['header']['raw']['flags'] &amp; 0x07) + 1);
+			$ThisFileInfo['video']['bits_per_sample']           = ($ThisFileInfo['gif']['header']['raw']['flags'] &amp; 0x07) + 1;
+		} else {
+			$ThisFileInfo['gif']['header']['global_color_size'] = 0;
+		}
+		if ($ThisFileInfo['gif']['header']['raw']['aspect_ratio'] != 0) {
+			// Aspect Ratio = (Pixel Aspect Ratio + 15) / 64
+			$ThisFileInfo['gif']['header']['aspect_ratio'] = ($ThisFileInfo['gif']['header']['raw']['aspect_ratio'] + 15) / 64;
+		}
+
+//		if ($ThisFileInfo['gif']['header']['flags']['global_color_table']) {
+//			$GIFcolorTable = fread($fd, 3 * $ThisFileInfo['gif']['header']['global_color_size']);
+//			$offset = 0;
+//			for ($i = 0; $i &lt; $ThisFileInfo['gif']['header']['global_color_size']; $i++) {
+//				$red   = getid3_lib::LittleEndian2Int(substr($GIFcolorTable, $offset++, 1));
+//				$green = getid3_lib::LittleEndian2Int(substr($GIFcolorTable, $offset++, 1));
+//				$blue  = getid3_lib::LittleEndian2Int(substr($GIFcolorTable, $offset++, 1));
+//				$ThisFileInfo['gif']['global_color_table'][$i] = (($red &lt;&lt; 16) | ($green &lt;&lt; 8) | ($blue));
+//			}
+//		}
+//
+//		// Image Descriptor
+//		while (!feof($fd)) {
+//			$NextBlockTest = fread($fd, 1);
+//			switch ($NextBlockTest) {
+//
+//				case ',': // ',' - Image separator character
+//
+//					$ImageDescriptorData = $NextBlockTest.fread($fd, 9);
+//					$ImageDescriptor = array();
+//					$ImageDescriptor['image_left']   = getid3_lib::LittleEndian2Int(substr($ImageDescriptorData, 1, 2));
+//					$ImageDescriptor['image_top']    = getid3_lib::LittleEndian2Int(substr($ImageDescriptorData, 3, 2));
+//					$ImageDescriptor['image_width']  = getid3_lib::LittleEndian2Int(substr($ImageDescriptorData, 5, 2));
+//					$ImageDescriptor['image_height'] = getid3_lib::LittleEndian2Int(substr($ImageDescriptorData, 7, 2));
+//					$ImageDescriptor['flags_raw']    = getid3_lib::LittleEndian2Int(substr($ImageDescriptorData, 9, 1));
+//					$ImageDescriptor['flags']['use_local_color_map'] = (bool) ($ImageDescriptor['flags_raw'] &amp; 0x80);
+//					$ImageDescriptor['flags']['image_interlaced']    = (bool) ($ImageDescriptor['flags_raw'] &amp; 0x40);
+//					$ThisFileInfo['gif']['image_descriptor'][] = $ImageDescriptor;
+//
+//					if ($ImageDescriptor['flags']['use_local_color_map']) {
+//
+//						$ThisFileInfo['warning'][] = 'This version of getID3() cannot parse local color maps for GIFs';
+//						return true;
+//
+//					}
+//echo 'Start of raster data: '.ftell($fd).'&lt;BR&gt;';
+//					$RasterData = array();
+//					$RasterData['code_size']        = getid3_lib::LittleEndian2Int(fread($fd, 1));
+//					$RasterData['block_byte_count'] = getid3_lib::LittleEndian2Int(fread($fd, 1));
+//					$ThisFileInfo['gif']['raster_data'][count($ThisFileInfo['gif']['image_descriptor']) - 1] = $RasterData;
+//
+//					$CurrentCodeSize = $RasterData['code_size'] + 1;
+//					for ($i = 0; $i &lt; pow(2, $RasterData['code_size']); $i++) {
+//						$DefaultDataLookupTable[$i] = chr($i);
+//					}
+//					$DefaultDataLookupTable[pow(2, $RasterData['code_size']) + 0] = ''; // Clear Code
+//					$DefaultDataLookupTable[pow(2, $RasterData['code_size']) + 1] = ''; // End Of Image Code
+//
+//
+//					$NextValue = $this-&gt;GetLSBits($fd, $CurrentCodeSize);
+//					echo 'Clear Code: '.$NextValue.'&lt;BR&gt;';
+//
+//					$NextValue = $this-&gt;GetLSBits($fd, $CurrentCodeSize);
+//					echo 'First Color: '.$NextValue.'&lt;BR&gt;';
+//
+//					$Prefix = $NextValue;
+//$i = 0;
+//					while ($i++ &lt; 20) {
+//						$NextValue = $this-&gt;GetLSBits($fd, $CurrentCodeSize);
+//						echo $NextValue.'&lt;BR&gt;';
+//					}
+//return true;
+//					break;
+//
+//				case '!':
+//					// GIF Extension Block
+//					$ExtensionBlockData = $NextBlockTest.fread($fd, 2);
+//					$ExtensionBlock = array();
+//					$ExtensionBlock['function_code']  = getid3_lib::LittleEndian2Int(substr($ExtensionBlockData, 1, 1));
+//					$ExtensionBlock['byte_length']    = getid3_lib::LittleEndian2Int(substr($ExtensionBlockData, 2, 1));
+//					$ExtensionBlock['data']           = fread($fd, $ExtensionBlock['byte_length']);
+//					$ThisFileInfo['gif']['extension_blocks'][] = $ExtensionBlock;
+//					break;
+//
+//				case ';':
+//					$ThisFileInfo['gif']['terminator_offset'] = ftell($fd) - 1;
+//					// GIF Terminator
+//					break;
+//
+//				default:
+//					break;
+//
+//
+//			}
+//		}
+
+		return true;
+	}
+
+
+	function GetLSBits($fd, $bits) {
+		static $bitbuffer = '';
+		while (strlen($bitbuffer) &lt; $bits) {
+//echo 'Read another byte: '.ftell($fd).'&lt;BR&gt;';
+			$bitbuffer = str_pad(decbin(ord(fread($fd, 1))), 8, '0', STR_PAD_LEFT).$bitbuffer;
+		}
+
+		$value = bindec(substr($bitbuffer, 0 - $bits));
+		$bitbuffer = substr($bitbuffer, 0, 0 - $bits);
+
+		return $value;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.graphic.gif.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.graphic.jpg.php
===================================================================
--- trunk/inc/external/getid3/module.graphic.jpg.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.graphic.jpg.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,72 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.graphic.jpg.php                                      //
+// module for analyzing JPEG Image files                       //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_jpg
+{
+
+
+	function getid3_jpg(&amp;$fd, &amp;$ThisFileInfo) {
+		$ThisFileInfo['fileformat']                  = 'jpg';
+		$ThisFileInfo['video']['dataformat']         = 'jpg';
+		$ThisFileInfo['video']['lossless']           = false;
+		$ThisFileInfo['video']['bits_per_sample']    = 24;
+		$ThisFileInfo['video']['pixel_aspect_ratio'] = (float) 1;
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+
+		list($width, $height, $type) = getid3_lib::GetDataImageSize(fread($fd, $ThisFileInfo['filesize']));
+		if ($type == 2) {
+
+			$ThisFileInfo['video']['resolution_x'] = $width;
+			$ThisFileInfo['video']['resolution_y'] = $height;
+
+			if (version_compare(phpversion(), '4.2.0', '&gt;=')) {
+
+				if (function_exists('exif_read_data')) {
+
+					ob_start();
+					$ThisFileInfo['jpg']['exif'] = exif_read_data($ThisFileInfo['filenamepath'], '', true, false);
+					$errors = ob_get_contents();
+					if ($errors) {
+						$ThisFileInfo['error'][] = strip_tags($errors);
+						unset($ThisFileInfo['jpg']['exif']);
+					}
+					ob_end_clean();
+
+				} else {
+
+					$ThisFileInfo['warning'][] = 'EXIF parsing only available when compiled with --enable-exif (or php_exif.dll enabled for Windows).';
+
+				}
+
+			} else {
+
+				$ThisFileInfo['warning'][] = 'EXIF parsing only available in PHP v4.2.0 and higher compiled with --enable-exif (or php_exif.dll enabled for Windows). You are using PHP v'.phpversion();
+
+			}
+
+			return true;
+
+		}
+
+		unset($ThisFileInfo['fileformat']);
+		return false;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.graphic.jpg.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.graphic.pcd.php
===================================================================
--- trunk/inc/external/getid3/module.graphic.pcd.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.graphic.pcd.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,130 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.graphic.pcd.php                                      //
+// module for analyzing PhotoCD (PCD) Image files              //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_pcd
+{
+	function getid3_pcd(&amp;$fd, &amp;$ThisFileInfo, $ExtractData=0) {
+		$ThisFileInfo['fileformat']          = 'pcd';
+		$ThisFileInfo['video']['dataformat'] = 'pcd';
+		$ThisFileInfo['video']['lossless']   = false;
+
+
+		fseek($fd, $ThisFileInfo['avdataoffset'] + 72, SEEK_SET);
+
+		$PCDflags = fread($fd, 1);
+		$PCDisVertical = ((ord($PCDflags) &amp; 0x01) ? true : false);
+
+
+		if ($PCDisVertical) {
+			$ThisFileInfo['video']['resolution_x'] = 3072;
+			$ThisFileInfo['video']['resolution_y'] = 2048;
+		} else {
+			$ThisFileInfo['video']['resolution_x'] = 2048;
+			$ThisFileInfo['video']['resolution_y'] = 3072;
+		}
+
+
+		if ($ExtractData &gt; 3) {
+
+			$ThisFileInfo['error'][] = 'Cannot extract PSD image data for detail levels above BASE (3)';
+
+		} elseif ($ExtractData &gt; 0) {
+
+			$PCD_levels[1] = array( 192,  128, 0x02000); // BASE/16
+			$PCD_levels[2] = array( 384,  256, 0x0B800); // BASE/4
+			$PCD_levels[3] = array( 768,  512, 0x30000); // BASE
+			//$PCD_levels[4] = array(1536, 1024,    ??); // BASE*4  - encrypted with Kodak-proprietary compression/encryption
+			//$PCD_levels[5] = array(3072, 2048,    ??); // BASE*16 - encrypted with Kodak-proprietary compression/encryption
+			//$PCD_levels[6] = array(6144, 4096,    ??); // BASE*64 - encrypted with Kodak-proprietary compression/encryption; PhotoCD-Pro only
+
+			list($PCD_width, $PCD_height, $PCD_dataOffset) = $PCD_levels[3];
+
+			fseek($fd, $ThisFileInfo['avdataoffset'] + $PCD_dataOffset, SEEK_SET);
+
+			for ($y = 0; $y &lt; $PCD_height; $y += 2) {
+				// The image-data of these subtypes start at the respective offsets of 02000h, 0b800h and 30000h.
+				// To decode the YcbYr to the more usual RGB-code, three lines of data have to be read, each
+				// consisting of &#145;w&#146; bytes, where &#145;w&#146; is the width of the image-subtype. The first &#145;w&#146; bytes and
+				// the first half of the third &#145;w&#146; bytes contain data for the first RGB-line, the second &#145;w&#146; bytes
+				// and the second half of the third &#145;w&#146; bytes contain data for a second RGB-line.
+
+				$PCD_data_Y1 = fread($fd, $PCD_width);
+				$PCD_data_Y2 = fread($fd, $PCD_width);
+				$PCD_data_Cb = fread($fd, intval(round($PCD_width / 2)));
+				$PCD_data_Cr = fread($fd, intval(round($PCD_width / 2)));
+
+				for ($x = 0; $x &lt; $PCD_width; $x++) {
+					if ($PCDisVertical) {
+						$ThisFileInfo['pcd']['data'][$PCD_width - $x][$y]     = $this-&gt;YCbCr2RGB(ord($PCD_data_Y1{$x}), ord($PCD_data_Cb{floor($x / 2)}), ord($PCD_data_Cr{floor($x / 2)}));
+						$ThisFileInfo['pcd']['data'][$PCD_width - $x][$y + 1] = $this-&gt;YCbCr2RGB(ord($PCD_data_Y2{$x}), ord($PCD_data_Cb{floor($x / 2)}), ord($PCD_data_Cr{floor($x / 2)}));
+					} else {
+						$ThisFileInfo['pcd']['data'][$y][$x]                  = $this-&gt;YCbCr2RGB(ord($PCD_data_Y1{$x}), ord($PCD_data_Cb{floor($x / 2)}), ord($PCD_data_Cr{floor($x / 2)}));
+						$ThisFileInfo['pcd']['data'][$y + 1][$x]              = $this-&gt;YCbCr2RGB(ord($PCD_data_Y2{$x}), ord($PCD_data_Cb{floor($x / 2)}), ord($PCD_data_Cr{floor($x / 2)}));
+					}
+				}
+			}
+
+			// Example for plotting extracted data
+			//getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.audio.ac3.php', __FILE__, true);
+			//if ($PCDisVertical) {
+			//	$BMPinfo['resolution_x'] = $PCD_height;
+			//	$BMPinfo['resolution_y'] = $PCD_width;
+			//} else {
+			//	$BMPinfo['resolution_x'] = $PCD_width;
+			//	$BMPinfo['resolution_y'] = $PCD_height;
+			//}
+			//$BMPinfo['bmp']['data'] = $ThisFileInfo['pcd']['data'];
+			//getid3_bmp::PlotBMP($BMPinfo);
+			//exit;
+
+		}
+
+	}
+
+	function YCbCr2RGB($Y, $Cb, $Cr) {
+		static $YCbCr_constants = array();
+		if (empty($YCbCr_constants)) {
+			$YCbCr_constants['red']['Y']    =  0.0054980 * 256;
+			$YCbCr_constants['red']['Cb']   =  0.0000000 * 256;
+			$YCbCr_constants['red']['Cr']   =  0.0051681 * 256;
+			$YCbCr_constants['green']['Y']  =  0.0054980 * 256;
+			$YCbCr_constants['green']['Cb'] = -0.0015446 * 256;
+			$YCbCr_constants['green']['Cr'] = -0.0026325 * 256;
+			$YCbCr_constants['blue']['Y']   =  0.0054980 * 256;
+			$YCbCr_constants['blue']['Cb']  =  0.0079533 * 256;
+			$YCbCr_constants['blue']['Cr']  =  0.0000000 * 256;
+		}
+
+		$RGBcolor = array('red'=&gt;0, 'green'=&gt;0, 'blue'=&gt;0);
+		foreach ($RGBcolor as $rgbname =&gt; $dummy) {
+			$RGBcolor[$rgbname] = max(0,
+										min(255,
+											intval(
+												round(
+													($YCbCr_constants[$rgbname]['Y'] * $Y) +
+													($YCbCr_constants[$rgbname]['Cb'] * ($Cb - 156)) +
+													($YCbCr_constants[$rgbname]['Cr'] * ($Cr - 137))
+												)
+											)
+										)
+									);
+		}
+		return (($RGBcolor['red'] * 65536) + ($RGBcolor['green'] * 256) + $RGBcolor['blue']);
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.graphic.pcd.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.graphic.png.php
===================================================================
--- trunk/inc/external/getid3/module.graphic.png.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.graphic.png.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,519 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.graphic.png.php                                      //
+// module for analyzing PNG Image files                        //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_png
+{
+
+	function getid3_png(&amp;$fd, &amp;$ThisFileInfo) {
+
+	    // shortcut
+	    $ThisFileInfo['png'] = array();
+	    $thisfile_png = &amp;$ThisFileInfo['png'];
+
+		$ThisFileInfo['fileformat']          = 'png';
+		$ThisFileInfo['video']['dataformat'] = 'png';
+		$ThisFileInfo['video']['lossless']   = false;
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$PNGfiledata = fread($fd, GETID3_FREAD_BUFFER_SIZE);
+		$offset = 0;
+
+		$PNGidentifier = substr($PNGfiledata, $offset, 8); // $89 $50 $4E $47 $0D $0A $1A $0A
+		$offset += 8;
+
+		if ($PNGidentifier != &quot;\x89\x50\x4E\x47\x0D\x0A\x1A\x0A&quot;) {
+			$ThisFileInfo['error'][] = 'First 8 bytes of file ('.getid3_lib::PrintHexBytes($PNGidentifier).') did not match expected PNG identifier';
+			unset($ThisFileInfo['fileformat']);
+			return false;
+		}
+
+		while (((ftell($fd) - (strlen($PNGfiledata) - $offset)) &lt; $ThisFileInfo['filesize'])) {
+			$chunk['data_length'] = getid3_lib::BigEndian2Int(substr($PNGfiledata, $offset, 4));
+			$offset += 4;
+			while (((strlen($PNGfiledata) - $offset) &lt; ($chunk['data_length'] + 4)) &amp;&amp; (ftell($fd) &lt; $ThisFileInfo['filesize'])) {
+				$PNGfiledata .= fread($fd, GETID3_FREAD_BUFFER_SIZE);
+			}
+			$chunk['type_text']   =               substr($PNGfiledata, $offset, 4);
+			$offset += 4;
+			$chunk['type_raw']    = getid3_lib::BigEndian2Int($chunk['type_text']);
+			$chunk['data']        =               substr($PNGfiledata, $offset, $chunk['data_length']);
+			$offset += $chunk['data_length'];
+			$chunk['crc']         = getid3_lib::BigEndian2Int(substr($PNGfiledata, $offset, 4));
+			$offset += 4;
+
+			$chunk['flags']['ancilliary']   = (bool) ($chunk['type_raw'] &amp; 0x20000000);
+			$chunk['flags']['private']      = (bool) ($chunk['type_raw'] &amp; 0x00200000);
+			$chunk['flags']['reserved']     = (bool) ($chunk['type_raw'] &amp; 0x00002000);
+			$chunk['flags']['safe_to_copy'] = (bool) ($chunk['type_raw'] &amp; 0x00000020);
+
+			// shortcut
+			$thisfile_png[$chunk['type_text']] = array();
+			$thisfile_png_chunk_type_text = &amp;$thisfile_png[$chunk['type_text']];
+
+			switch ($chunk['type_text']) {
+
+				case 'IHDR': // Image Header
+					$thisfile_png_chunk_type_text['header'] = $chunk;
+					$thisfile_png_chunk_type_text['width']                     = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'],  0, 4));
+					$thisfile_png_chunk_type_text['height']                    = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'],  4, 4));
+					$thisfile_png_chunk_type_text['raw']['bit_depth']          = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'],  8, 1));
+					$thisfile_png_chunk_type_text['raw']['color_type']         = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'],  9, 1));
+					$thisfile_png_chunk_type_text['raw']['compression_method'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 10, 1));
+					$thisfile_png_chunk_type_text['raw']['filter_method']      = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 11, 1));
+					$thisfile_png_chunk_type_text['raw']['interlace_method']   = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 12, 1));
+
+					$thisfile_png_chunk_type_text['compression_method_text']   = $this-&gt;PNGcompressionMethodLookup($thisfile_png_chunk_type_text['raw']['compression_method']);
+					$thisfile_png_chunk_type_text['color_type']['palette']     = (bool) ($thisfile_png_chunk_type_text['raw']['color_type'] &amp; 0x01);
+					$thisfile_png_chunk_type_text['color_type']['true_color']  = (bool) ($thisfile_png_chunk_type_text['raw']['color_type'] &amp; 0x02);
+					$thisfile_png_chunk_type_text['color_type']['alpha']       = (bool) ($thisfile_png_chunk_type_text['raw']['color_type'] &amp; 0x04);
+
+					$ThisFileInfo['video']['resolution_x']    = $thisfile_png_chunk_type_text['width'];
+					$ThisFileInfo['video']['resolution_y']    = $thisfile_png_chunk_type_text['height'];
+
+					$ThisFileInfo['video']['bits_per_sample'] = $this-&gt;IHDRcalculateBitsPerSample($thisfile_png_chunk_type_text['raw']['color_type'], $thisfile_png_chunk_type_text['raw']['bit_depth']);
+					break;
+
+
+				case 'PLTE': // Palette
+					$thisfile_png_chunk_type_text['header'] = $chunk;
+					$paletteoffset = 0;
+					for ($i = 0; $i &lt;= 255; $i++) {
+						//$thisfile_png_chunk_type_text['red'][$i]   = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], $paletteoffset++, 1));
+						//$thisfile_png_chunk_type_text['green'][$i] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], $paletteoffset++, 1));
+						//$thisfile_png_chunk_type_text['blue'][$i]  = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], $paletteoffset++, 1));
+						$red   = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], $paletteoffset++, 1));
+						$green = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], $paletteoffset++, 1));
+						$blue  = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], $paletteoffset++, 1));
+						$thisfile_png_chunk_type_text[$i] = (($red &lt;&lt; 16) | ($green &lt;&lt; 8) | ($blue));
+					}
+					break;
+
+
+				case 'tRNS': // Transparency
+					$thisfile_png_chunk_type_text['header'] = $chunk;
+					switch ($thisfile_png['IHDR']['raw']['color_type']) {
+						case 0:
+							$thisfile_png_chunk_type_text['transparent_color_gray']  = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 0, 2));
+							break;
+
+						case 2:
+							$thisfile_png_chunk_type_text['transparent_color_red']   = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 0, 2));
+							$thisfile_png_chunk_type_text['transparent_color_green'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 2, 2));
+							$thisfile_png_chunk_type_text['transparent_color_blue']  = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 4, 2));
+							break;
+
+						case 3:
+							for ($i = 0; $i &lt; strlen($thisfile_png_chunk_type_text['header']['data']); $i++) {
+								$thisfile_png_chunk_type_text['palette_opacity'][$i] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], $i, 1));
+							}
+							break;
+
+						case 4:
+						case 6:
+							$ThisFileInfo['error'][] = 'Invalid color_type in tRNS chunk: '.$thisfile_png['IHDR']['raw']['color_type'];
+
+						default:
+							$ThisFileInfo['warning'][] = 'Unhandled color_type in tRNS chunk: '.$thisfile_png['IHDR']['raw']['color_type'];
+							break;
+					}
+					break;
+
+
+				case 'gAMA': // Image Gamma
+					$thisfile_png_chunk_type_text['header'] = $chunk;
+					$thisfile_png_chunk_type_text['gamma']  = getid3_lib::BigEndian2Int($thisfile_png_chunk_type_text['header']['data']) / 100000;
+					break;
+
+
+				case 'cHRM': // Primary Chromaticities
+					$thisfile_png_chunk_type_text['header']  = $chunk;
+					$thisfile_png_chunk_type_text['white_x'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'],  0, 4)) / 100000;
+					$thisfile_png_chunk_type_text['white_y'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'],  4, 4)) / 100000;
+					$thisfile_png_chunk_type_text['red_y']   = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'],  8, 4)) / 100000;
+					$thisfile_png_chunk_type_text['red_y']   = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 12, 4)) / 100000;
+					$thisfile_png_chunk_type_text['green_y'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 16, 4)) / 100000;
+					$thisfile_png_chunk_type_text['green_y'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 20, 4)) / 100000;
+					$thisfile_png_chunk_type_text['blue_y']  = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 24, 4)) / 100000;
+					$thisfile_png_chunk_type_text['blue_y']  = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 28, 4)) / 100000;
+					break;
+
+
+				case 'sRGB': // Standard RGB Color Space
+					$thisfile_png_chunk_type_text['header']                 = $chunk;
+					$thisfile_png_chunk_type_text['reindering_intent']      = getid3_lib::BigEndian2Int($thisfile_png_chunk_type_text['header']['data']);
+					$thisfile_png_chunk_type_text['reindering_intent_text'] = $this-&gt;PNGsRGBintentLookup($thisfile_png_chunk_type_text['reindering_intent']);
+					break;
+
+
+				case 'iCCP': // Embedded ICC Profile
+					$thisfile_png_chunk_type_text['header']                  = $chunk;
+					list($profilename, $compressiondata)                                 = explode(&quot;\x00&quot;, $thisfile_png_chunk_type_text['header']['data'], 2);
+					$thisfile_png_chunk_type_text['profile_name']            = $profilename;
+					$thisfile_png_chunk_type_text['compression_method']      = getid3_lib::BigEndian2Int(substr($compressiondata, 0, 1));
+					$thisfile_png_chunk_type_text['compression_profile']     = substr($compressiondata, 1);
+
+					$thisfile_png_chunk_type_text['compression_method_text'] = $this-&gt;PNGcompressionMethodLookup($thisfile_png_chunk_type_text['compression_method']);
+					break;
+
+
+				case 'tEXt': // Textual Data
+					$thisfile_png_chunk_type_text['header']  = $chunk;
+					list($keyword, $text)                                = explode(&quot;\x00&quot;, $thisfile_png_chunk_type_text['header']['data'], 2);
+					$thisfile_png_chunk_type_text['keyword'] = $keyword;
+					$thisfile_png_chunk_type_text['text']    = $text;
+
+					$thisfile_png['comments'][$thisfile_png_chunk_type_text['keyword']][] = $thisfile_png_chunk_type_text['text'];
+					break;
+
+
+				case 'zTXt': // Compressed Textual Data
+					$thisfile_png_chunk_type_text['header']                  = $chunk;
+					list($keyword, $otherdata)                                           = explode(&quot;\x00&quot;, $thisfile_png_chunk_type_text['header']['data'], 2);
+					$thisfile_png_chunk_type_text['keyword']                 = $keyword;
+					$thisfile_png_chunk_type_text['compression_method']      = getid3_lib::BigEndian2Int(substr($otherdata, 0, 1));
+					$thisfile_png_chunk_type_text['compressed_text']         = substr($otherdata, 1);
+					$thisfile_png_chunk_type_text['compression_method_text'] = $this-&gt;PNGcompressionMethodLookup($thisfile_png_chunk_type_text['compression_method']);
+					switch ($thisfile_png_chunk_type_text['compression_method']) {
+						case 0:
+							$thisfile_png_chunk_type_text['text']            = gzuncompress($thisfile_png_chunk_type_text['compressed_text']);
+							break;
+
+						default:
+							// unknown compression method
+							break;
+					}
+
+					if (isset($thisfile_png_chunk_type_text['text'])) {
+						$thisfile_png['comments'][$thisfile_png_chunk_type_text['keyword']][] = $thisfile_png_chunk_type_text['text'];
+					}
+					break;
+
+
+				case 'iTXt': // International Textual Data
+					$thisfile_png_chunk_type_text['header']                  = $chunk;
+					list($keyword, $otherdata)                                           = explode(&quot;\x00&quot;, $thisfile_png_chunk_type_text['header']['data'], 2);
+					$thisfile_png_chunk_type_text['keyword']                 = $keyword;
+					$thisfile_png_chunk_type_text['compression']             = (bool) getid3_lib::BigEndian2Int(substr($otherdata, 0, 1));
+					$thisfile_png_chunk_type_text['compression_method']      = getid3_lib::BigEndian2Int(substr($otherdata, 1, 1));
+					$thisfile_png_chunk_type_text['compression_method_text'] = $this-&gt;PNGcompressionMethodLookup($thisfile_png_chunk_type_text['compression_method']);
+					list($languagetag, $translatedkeyword, $text)                        = explode(&quot;\x00&quot;, substr($otherdata, 2), 3);
+					$thisfile_png_chunk_type_text['language_tag']            = $languagetag;
+					$thisfile_png_chunk_type_text['translated_keyword']      = $translatedkeyword;
+
+					if ($thisfile_png_chunk_type_text['compression']) {
+
+						switch ($thisfile_png_chunk_type_text['compression_method']) {
+							case 0:
+								$thisfile_png_chunk_type_text['text']        = gzuncompress($text);
+								break;
+
+							default:
+								// unknown compression method
+								break;
+						}
+
+					} else {
+
+						$thisfile_png_chunk_type_text['text']                = $text;
+
+					}
+
+					if (isset($thisfile_png_chunk_type_text['text'])) {
+						$thisfile_png['comments'][$thisfile_png_chunk_type_text['keyword']][] = $thisfile_png_chunk_type_text['text'];
+					}
+					break;
+
+
+				case 'bKGD': // Background Color
+					$thisfile_png_chunk_type_text['header']                   = $chunk;
+					switch ($thisfile_png['IHDR']['raw']['color_type']) {
+						case 0:
+						case 4:
+							$thisfile_png_chunk_type_text['background_gray']  = getid3_lib::BigEndian2Int($thisfile_png_chunk_type_text['header']['data']);
+							break;
+
+						case 2:
+						case 6:
+							$thisfile_png_chunk_type_text['background_red']   = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 0 * $thisfile_png['IHDR']['raw']['bit_depth'], $thisfile_png['IHDR']['raw']['bit_depth']));
+							$thisfile_png_chunk_type_text['background_green'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 1 * $thisfile_png['IHDR']['raw']['bit_depth'], $thisfile_png['IHDR']['raw']['bit_depth']));
+							$thisfile_png_chunk_type_text['background_blue']  = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 2 * $thisfile_png['IHDR']['raw']['bit_depth'], $thisfile_png['IHDR']['raw']['bit_depth']));
+							break;
+
+						case 3:
+							$thisfile_png_chunk_type_text['background_index'] = getid3_lib::BigEndian2Int($thisfile_png_chunk_type_text['header']['data']);
+							break;
+
+						default:
+							break;
+					}
+					break;
+
+
+				case 'pHYs': // Physical Pixel Dimensions
+					$thisfile_png_chunk_type_text['header']                 = $chunk;
+					$thisfile_png_chunk_type_text['pixels_per_unit_x']      = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 0, 4));
+					$thisfile_png_chunk_type_text['pixels_per_unit_y']      = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 4, 4));
+					$thisfile_png_chunk_type_text['unit_specifier']         = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 8, 1));
+					$thisfile_png_chunk_type_text['unit']                   = $this-&gt;PNGpHYsUnitLookup($thisfile_png_chunk_type_text['unit_specifier']);
+					break;
+
+
+				case 'sBIT': // Significant Bits
+					$thisfile_png_chunk_type_text['header'] = $chunk;
+					switch ($thisfile_png['IHDR']['raw']['color_type']) {
+						case 0:
+							$thisfile_png_chunk_type_text['significant_bits_gray']  = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 0, 1));
+							break;
+
+						case 2:
+						case 3:
+							$thisfile_png_chunk_type_text['significant_bits_red']   = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 0, 1));
+							$thisfile_png_chunk_type_text['significant_bits_green'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 1, 1));
+							$thisfile_png_chunk_type_text['significant_bits_blue']  = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 2, 1));
+							break;
+
+						case 4:
+							$thisfile_png_chunk_type_text['significant_bits_gray']  = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 0, 1));
+							$thisfile_png_chunk_type_text['significant_bits_alpha'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 1, 1));
+							break;
+
+						case 6:
+							$thisfile_png_chunk_type_text['significant_bits_red']   = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 0, 1));
+							$thisfile_png_chunk_type_text['significant_bits_green'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 1, 1));
+							$thisfile_png_chunk_type_text['significant_bits_blue']  = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 2, 1));
+							$thisfile_png_chunk_type_text['significant_bits_alpha'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 3, 1));
+							break;
+
+						default:
+							break;
+					}
+					break;
+
+
+				case 'sPLT': // Suggested Palette
+					$thisfile_png_chunk_type_text['header']                           = $chunk;
+					list($palettename, $otherdata)                                                = explode(&quot;\x00&quot;, $thisfile_png_chunk_type_text['header']['data'], 2);
+					$thisfile_png_chunk_type_text['palette_name']                     = $palettename;
+					$sPLToffset = 0;
+					$thisfile_png_chunk_type_text['sample_depth_bits']                = getid3_lib::BigEndian2Int(substr($otherdata, $sPLToffset, 1));
+					$sPLToffset += 1;
+					$thisfile_png_chunk_type_text['sample_depth_bytes']               = $thisfile_png_chunk_type_text['sample_depth_bits'] / 8;
+					$paletteCounter = 0;
+					while ($sPLToffset &lt; strlen($otherdata)) {
+						$thisfile_png_chunk_type_text['red'][$paletteCounter]       = getid3_lib::BigEndian2Int(substr($otherdata, $sPLToffset, $thisfile_png_chunk_type_text['sample_depth_bytes']));
+						$sPLToffset += $thisfile_png_chunk_type_text['sample_depth_bytes'];
+						$thisfile_png_chunk_type_text['green'][$paletteCounter]     = getid3_lib::BigEndian2Int(substr($otherdata, $sPLToffset, $thisfile_png_chunk_type_text['sample_depth_bytes']));
+						$sPLToffset += $thisfile_png_chunk_type_text['sample_depth_bytes'];
+						$thisfile_png_chunk_type_text['blue'][$paletteCounter]      = getid3_lib::BigEndian2Int(substr($otherdata, $sPLToffset, $thisfile_png_chunk_type_text['sample_depth_bytes']));
+						$sPLToffset += $thisfile_png_chunk_type_text['sample_depth_bytes'];
+						$thisfile_png_chunk_type_text['alpha'][$paletteCounter]     = getid3_lib::BigEndian2Int(substr($otherdata, $sPLToffset, $thisfile_png_chunk_type_text['sample_depth_bytes']));
+						$sPLToffset += $thisfile_png_chunk_type_text['sample_depth_bytes'];
+						$thisfile_png_chunk_type_text['frequency'][$paletteCounter] = getid3_lib::BigEndian2Int(substr($otherdata, $sPLToffset, 2));
+						$sPLToffset += 2;
+						$paletteCounter++;
+					}
+					break;
+
+
+				case 'hIST': // Palette Histogram
+					$thisfile_png_chunk_type_text['header'] = $chunk;
+					$hISTcounter = 0;
+					while ($hISTcounter &lt; strlen($thisfile_png_chunk_type_text['header']['data'])) {
+						$thisfile_png_chunk_type_text[$hISTcounter] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], $hISTcounter / 2, 2));
+						$hISTcounter += 2;
+					}
+					break;
+
+
+				case 'tIME': // Image Last-Modification Time
+					$thisfile_png_chunk_type_text['header'] = $chunk;
+					$thisfile_png_chunk_type_text['year']   = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 0, 2));
+					$thisfile_png_chunk_type_text['month']  = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 2, 1));
+					$thisfile_png_chunk_type_text['day']    = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 3, 1));
+					$thisfile_png_chunk_type_text['hour']   = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 4, 1));
+					$thisfile_png_chunk_type_text['minute'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 5, 1));
+					$thisfile_png_chunk_type_text['second'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 6, 1));
+					$thisfile_png_chunk_type_text['unix']   = gmmktime($thisfile_png_chunk_type_text['hour'], $thisfile_png_chunk_type_text['minute'], $thisfile_png_chunk_type_text['second'], $thisfile_png_chunk_type_text['month'], $thisfile_png_chunk_type_text['day'], $thisfile_png_chunk_type_text['year']);
+					break;
+
+
+				case 'oFFs': // Image Offset
+					$thisfile_png_chunk_type_text['header']         = $chunk;
+					$thisfile_png_chunk_type_text['position_x']     = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 0, 4), false, true);
+					$thisfile_png_chunk_type_text['position_y']     = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 4, 4), false, true);
+					$thisfile_png_chunk_type_text['unit_specifier'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 8, 1));
+					$thisfile_png_chunk_type_text['unit']           = $this-&gt;PNGoFFsUnitLookup($thisfile_png_chunk_type_text['unit_specifier']);
+					break;
+
+
+				case 'pCAL': // Calibration Of Pixel Values
+					$thisfile_png_chunk_type_text['header']             = $chunk;
+					list($calibrationname, $otherdata)                              = explode(&quot;\x00&quot;, $thisfile_png_chunk_type_text['header']['data'], 2);
+					$thisfile_png_chunk_type_text['calibration_name']   = $calibrationname;
+					$pCALoffset = 0;
+					$thisfile_png_chunk_type_text['original_zero']      = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], $pCALoffset, 4), false, true);
+					$pCALoffset += 4;
+					$thisfile_png_chunk_type_text['original_max']       = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], $pCALoffset, 4), false, true);
+					$pCALoffset += 4;
+					$thisfile_png_chunk_type_text['equation_type']      = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], $pCALoffset, 1));
+					$pCALoffset += 1;
+					$thisfile_png_chunk_type_text['equation_type_text'] = $this-&gt;PNGpCALequationTypeLookup($thisfile_png_chunk_type_text['equation_type']);
+					$thisfile_png_chunk_type_text['parameter_count']    = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], $pCALoffset, 1));
+					$pCALoffset += 1;
+					$thisfile_png_chunk_type_text['parameters']         = explode(&quot;\x00&quot;, substr($thisfile_png_chunk_type_text['header']['data'], $pCALoffset));
+					break;
+
+
+				case 'sCAL': // Physical Scale Of Image Subject
+					$thisfile_png_chunk_type_text['header']         = $chunk;
+					$thisfile_png_chunk_type_text['unit_specifier'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 0, 1));
+					$thisfile_png_chunk_type_text['unit']           = $this-&gt;PNGsCALUnitLookup($thisfile_png_chunk_type_text['unit_specifier']);
+					list($pixelwidth, $pixelheight)                             = explode(&quot;\x00&quot;, substr($thisfile_png_chunk_type_text['header']['data'], 1));
+					$thisfile_png_chunk_type_text['pixel_width']    = $pixelwidth;
+					$thisfile_png_chunk_type_text['pixel_height']   = $pixelheight;
+					break;
+
+
+				case 'gIFg': // GIF Graphic Control Extension
+					$gIFgCounter = 0;
+					if (isset($thisfile_png_chunk_type_text) &amp;&amp; is_array($thisfile_png_chunk_type_text)) {
+						$gIFgCounter = count($thisfile_png_chunk_type_text);
+					}
+					$thisfile_png_chunk_type_text[$gIFgCounter]['header']          = $chunk;
+					$thisfile_png_chunk_type_text[$gIFgCounter]['disposal_method'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 0, 1));
+					$thisfile_png_chunk_type_text[$gIFgCounter]['user_input_flag'] = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 1, 1));
+					$thisfile_png_chunk_type_text[$gIFgCounter]['delay_time']      = getid3_lib::BigEndian2Int(substr($thisfile_png_chunk_type_text['header']['data'], 2, 2));
+					break;
+
+
+				case 'gIFx': // GIF Application Extension
+					$gIFxCounter = 0;
+					if (isset($thisfile_png_chunk_type_text) &amp;&amp; is_array($thisfile_png_chunk_type_text)) {
+						$gIFxCounter = count($thisfile_png_chunk_type_text);
+					}
+					$thisfile_png_chunk_type_text[$gIFxCounter]['header']                 = $chunk;
+					$thisfile_png_chunk_type_text[$gIFxCounter]['application_identifier'] = substr($thisfile_png_chunk_type_text['header']['data'],  0, 8);
+					$thisfile_png_chunk_type_text[$gIFxCounter]['authentication_code']    = substr($thisfile_png_chunk_type_text['header']['data'],  8, 3);
+					$thisfile_png_chunk_type_text[$gIFxCounter]['application_data']       = substr($thisfile_png_chunk_type_text['header']['data'], 11);
+					break;
+
+
+				case 'IDAT': // Image Data
+					$idatinformationfieldindex = 0;
+					if (isset($thisfile_png['IDAT']) &amp;&amp; is_array($thisfile_png['IDAT'])) {
+						$idatinformationfieldindex = count($thisfile_png['IDAT']);
+					}
+					unset($chunk['data']);
+					$thisfile_png_chunk_type_text[$idatinformationfieldindex]['header'] = $chunk;
+					break;
+
+
+				case 'IEND': // Image Trailer
+					$thisfile_png_chunk_type_text['header'] = $chunk;
+					break;
+
+
+				default:
+					//unset($chunk['data']);
+					$thisfile_png_chunk_type_text['header'] = $chunk;
+					$ThisFileInfo['warning'][] = 'Unhandled chunk type: '.$chunk['type_text'];
+					break;
+			}
+		}
+
+		return true;
+	}
+
+	function PNGsRGBintentLookup($sRGB) {
+		static $PNGsRGBintentLookup = array(
+			0 =&gt; 'Perceptual',
+			1 =&gt; 'Relative colorimetric',
+			2 =&gt; 'Saturation',
+			3 =&gt; 'Absolute colorimetric'
+		);
+		return (isset($PNGsRGBintentLookup[$sRGB]) ? $PNGsRGBintentLookup[$sRGB] : 'invalid');
+	}
+
+	function PNGcompressionMethodLookup($compressionmethod) {
+		static $PNGcompressionMethodLookup = array(
+			0 =&gt; 'deflate/inflate'
+		);
+		return (isset($PNGcompressionMethodLookup[$compressionmethod]) ? $PNGcompressionMethodLookup[$compressionmethod] : 'invalid');
+	}
+
+	function PNGpHYsUnitLookup($unitid) {
+		static $PNGpHYsUnitLookup = array(
+			0 =&gt; 'unknown',
+			1 =&gt; 'meter'
+		);
+		return (isset($PNGpHYsUnitLookup[$unitid]) ? $PNGpHYsUnitLookup[$unitid] : 'invalid');
+	}
+
+	function PNGoFFsUnitLookup($unitid) {
+		static $PNGoFFsUnitLookup = array(
+			0 =&gt; 'pixel',
+			1 =&gt; 'micrometer'
+		);
+		return (isset($PNGoFFsUnitLookup[$unitid]) ? $PNGoFFsUnitLookup[$unitid] : 'invalid');
+	}
+
+	function PNGpCALequationTypeLookup($equationtype) {
+		static $PNGpCALequationTypeLookup = array(
+			0 =&gt; 'Linear mapping',
+			1 =&gt; 'Base-e exponential mapping',
+			2 =&gt; 'Arbitrary-base exponential mapping',
+			3 =&gt; 'Hyperbolic mapping'
+		);
+		return (isset($PNGpCALequationTypeLookup[$equationtype]) ? $PNGpCALequationTypeLookup[$equationtype] : 'invalid');
+	}
+
+	function PNGsCALUnitLookup($unitid) {
+		static $PNGsCALUnitLookup = array(
+			0 =&gt; 'meter',
+			1 =&gt; 'radian'
+		);
+		return (isset($PNGsCALUnitLookup[$unitid]) ? $PNGsCALUnitLookup[$unitid] : 'invalid');
+	}
+
+	function IHDRcalculateBitsPerSample($color_type, $bit_depth) {
+		switch ($color_type) {
+			case 0: // Each pixel is a grayscale sample.
+				return $bit_depth;
+				break;
+
+			case 2: // Each pixel is an R,G,B triple
+				return 3 * $bit_depth;
+				break;
+
+			case 3: // Each pixel is a palette index; a PLTE chunk must appear.
+				return $bit_depth;
+				break;
+
+			case 4: // Each pixel is a grayscale sample, followed by an alpha sample.
+				return 2 * $bit_depth;
+				break;
+
+			case 6: // Each pixel is an R,G,B triple, followed by an alpha sample.
+				return 4 * $bit_depth;
+				break;
+		}
+		return false;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.graphic.png.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.graphic.tiff.php
===================================================================
--- trunk/inc/external/getid3/module.graphic.tiff.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.graphic.tiff.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,221 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.archive.tiff.php                                     //
+// module for analyzing TIFF files                             //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_tiff
+{
+
+	function getid3_tiff(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$TIFFheader = fread($fd, 4);
+
+		switch (substr($TIFFheader, 0, 2)) {
+			case 'II':
+				$ThisFileInfo['tiff']['byte_order'] = 'Intel';
+				break;
+			case 'MM':
+				$ThisFileInfo['tiff']['byte_order'] = 'Motorola';
+				break;
+			default:
+				$ThisFileInfo['error'][] = 'Invalid TIFF byte order identifier ('.substr($TIFFheader, 0, 2).') at offset '.$ThisFileInfo['avdataoffset'];
+				return false;
+				break;
+		}
+
+		$ThisFileInfo['fileformat']          = 'tiff';
+		$ThisFileInfo['video']['dataformat'] = 'tiff';
+		$ThisFileInfo['video']['lossless']   = true;
+		$ThisFileInfo['tiff']['ifd']         = array();
+		$CurrentIFD                          = array();
+
+		$FieldTypeByteLength = array(1=&gt;1, 2=&gt;1, 3=&gt;2, 4=&gt;4, 5=&gt;8);
+
+		$nextIFDoffset = $this-&gt;TIFFendian2Int(fread($fd, 4), $ThisFileInfo['tiff']['byte_order']);
+
+		while ($nextIFDoffset &gt; 0) {
+
+			$CurrentIFD['offset'] = $nextIFDoffset;
+
+			fseek($fd, $ThisFileInfo['avdataoffset'] + $nextIFDoffset, SEEK_SET);
+			$CurrentIFD['fieldcount'] = $this-&gt;TIFFendian2Int(fread($fd, 2), $ThisFileInfo['tiff']['byte_order']);
+
+			for ($i = 0; $i &lt; $CurrentIFD['fieldcount']; $i++) {
+				$CurrentIFD['fields'][$i]['raw']['tag']    = $this-&gt;TIFFendian2Int(fread($fd, 2), $ThisFileInfo['tiff']['byte_order']);
+				$CurrentIFD['fields'][$i]['raw']['type']   = $this-&gt;TIFFendian2Int(fread($fd, 2), $ThisFileInfo['tiff']['byte_order']);
+				$CurrentIFD['fields'][$i]['raw']['length'] = $this-&gt;TIFFendian2Int(fread($fd, 4), $ThisFileInfo['tiff']['byte_order']);
+				$CurrentIFD['fields'][$i]['raw']['offset'] =                       fread($fd, 4);
+
+				switch ($CurrentIFD['fields'][$i]['raw']['type']) {
+					case 1: // BYTE  An 8-bit unsigned integer.
+						if ($CurrentIFD['fields'][$i]['raw']['length'] &lt;= 4) {
+							$CurrentIFD['fields'][$i]['value']  = $this-&gt;TIFFendian2Int(substr($CurrentIFD['fields'][$i]['raw']['offset'], 0, 1), $ThisFileInfo['tiff']['byte_order']);
+						} else {
+							$CurrentIFD['fields'][$i]['offset'] = $this-&gt;TIFFendian2Int($CurrentIFD['fields'][$i]['raw']['offset'], $ThisFileInfo['tiff']['byte_order']);
+						}
+						break;
+
+					case 2: // ASCII 8-bit bytes  that store ASCII codes; the last byte must be null.
+						if ($CurrentIFD['fields'][$i]['raw']['length'] &lt;= 4) {
+							$CurrentIFD['fields'][$i]['value']  = substr($CurrentIFD['fields'][$i]['raw']['offset'], 3);
+						} else {
+							$CurrentIFD['fields'][$i]['offset'] = $this-&gt;TIFFendian2Int($CurrentIFD['fields'][$i]['raw']['offset'], $ThisFileInfo['tiff']['byte_order']);
+						}
+						break;
+
+					case 3: // SHORT A 16-bit (2-byte) unsigned integer.
+						if ($CurrentIFD['fields'][$i]['raw']['length'] &lt;= 2) {
+							$CurrentIFD['fields'][$i]['value']  = $this-&gt;TIFFendian2Int(substr($CurrentIFD['fields'][$i]['raw']['offset'], 0, 2), $ThisFileInfo['tiff']['byte_order']);
+						} else {
+							$CurrentIFD['fields'][$i]['offset'] = $this-&gt;TIFFendian2Int($CurrentIFD['fields'][$i]['raw']['offset'], $ThisFileInfo['tiff']['byte_order']);
+						}
+						break;
+
+					case 4: // LONG  A 32-bit (4-byte) unsigned integer.
+						if ($CurrentIFD['fields'][$i]['raw']['length'] &lt;= 1) {
+							$CurrentIFD['fields'][$i]['value']  = $this-&gt;TIFFendian2Int($CurrentIFD['fields'][$i]['raw']['offset'], $ThisFileInfo['tiff']['byte_order']);
+						} else {
+							$CurrentIFD['fields'][$i]['offset'] = $this-&gt;TIFFendian2Int($CurrentIFD['fields'][$i]['raw']['offset'], $ThisFileInfo['tiff']['byte_order']);
+						}
+						break;
+
+					case 5: // RATIONAL   Two LONG_s:  the first represents the numerator of a fraction, the second the denominator.
+						break;
+				}
+			}
+
+			$ThisFileInfo['tiff']['ifd'][] = $CurrentIFD;
+			$CurrentIFD = array();
+			$nextIFDoffset = $this-&gt;TIFFendian2Int(fread($fd, 4), $ThisFileInfo['tiff']['byte_order']);
+
+		}
+
+		foreach ($ThisFileInfo['tiff']['ifd'] as $IFDid =&gt; $IFDarray) {
+			foreach ($IFDarray['fields'] as $key =&gt; $fieldarray) {
+				switch ($fieldarray['raw']['tag']) {
+					case 256: // ImageWidth
+					case 257: // ImageLength
+					case 258: // BitsPerSample
+					case 259: // Compression
+						if (!isset($fieldarray['value'])) {
+							fseek($fd, $fieldarray['offset'], SEEK_SET);
+							$ThisFileInfo['tiff']['ifd'][$IFDid]['fields'][$key]['raw']['data'] = fread($fd, $fieldarray['raw']['length'] * $FieldTypeByteLength[$fieldarray['raw']['type']]);
+
+						}
+						break;
+
+					case 270: // ImageDescription
+					case 271: // Make
+					case 272: // Model
+					case 305: // Software
+					case 306: // DateTime
+					case 315: // Artist
+					case 316: // HostComputer
+						if (isset($fieldarray['value'])) {
+							$ThisFileInfo['tiff']['ifd'][$IFDid]['fields'][$key]['raw']['data'] = $fieldarray['value'];
+						} else {
+							fseek($fd, $fieldarray['offset'], SEEK_SET);
+							$ThisFileInfo['tiff']['ifd'][$IFDid]['fields'][$key]['raw']['data'] = fread($fd, $fieldarray['raw']['length'] * $FieldTypeByteLength[$fieldarray['raw']['type']]);
+
+						}
+						break;
+				}
+				switch ($fieldarray['raw']['tag']) {
+					case 256: // ImageWidth
+						$ThisFileInfo['video']['resolution_x'] = $fieldarray['value'];
+						break;
+
+					case 257: // ImageLength
+						$ThisFileInfo['video']['resolution_y'] = $fieldarray['value'];
+						break;
+
+					case 258: // BitsPerSample
+						if (isset($fieldarray['value'])) {
+							$ThisFileInfo['video']['bits_per_sample'] = $fieldarray['value'];
+						} else {
+							$ThisFileInfo['video']['bits_per_sample'] = 0;
+							for ($i = 0; $i &lt; $fieldarray['raw']['length']; $i++) {
+								$ThisFileInfo['video']['bits_per_sample'] += $this-&gt;TIFFendian2Int(substr($ThisFileInfo['tiff']['ifd'][$IFDid]['fields'][$key]['raw']['data'], $i * $FieldTypeByteLength[$fieldarray['raw']['type']], $FieldTypeByteLength[$fieldarray['raw']['type']]), $ThisFileInfo['tiff']['byte_order']);
+							}
+						}
+						break;
+
+					case 259: // Compression
+						$ThisFileInfo['video']['codec'] = $this-&gt;TIFFcompressionMethod($fieldarray['value']);
+						break;
+
+					case 270: // ImageDescription
+					case 271: // Make
+					case 272: // Model
+					case 305: // Software
+					case 306: // DateTime
+					case 315: // Artist
+					case 316: // HostComputer
+						@$ThisFileInfo['tiff']['comments'][$this-&gt;TIFFcommentName($fieldarray['raw']['tag'])][] = $ThisFileInfo['tiff']['ifd'][$IFDid]['fields'][$key]['raw']['data'];
+						break;
+
+					default:
+						break;
+				}
+			}
+		}
+
+		return true;
+	}
+
+
+	function TIFFendian2Int($bytestring, $byteorder) {
+		if ($byteorder == 'Intel') {
+			return getid3_lib::LittleEndian2Int($bytestring);
+		} elseif ($byteorder == 'Motorola') {
+			return getid3_lib::BigEndian2Int($bytestring);
+		}
+		return false;
+	}
+
+	function TIFFcompressionMethod($id) {
+		static $TIFFcompressionMethod = array();
+		if (empty($TIFFcompressionMethod)) {
+			$TIFFcompressionMethod = array(
+				1     =&gt; 'Uncompressed',
+				2     =&gt; 'Huffman',
+				3     =&gt; 'Fax - CCITT 3',
+				5     =&gt; 'LZW',
+				32773 =&gt; 'PackBits',
+			);
+		}
+		return (isset($TIFFcompressionMethod[$id]) ? $TIFFcompressionMethod[$id] : 'unknown/invalid ('.$id.')');
+	}
+
+	function TIFFcommentName($id) {
+		static $TIFFcommentName = array();
+		if (empty($TIFFcommentName)) {
+			$TIFFcommentName = array(
+				270 =&gt; 'imagedescription',
+				271 =&gt; 'make',
+				272 =&gt; 'model',
+				305 =&gt; 'software',
+				306 =&gt; 'datetime',
+				315 =&gt; 'artist',
+				316 =&gt; 'hostcomputer',
+			);
+		}
+		return (isset($TIFFcommentName[$id]) ? $TIFFcommentName[$id] : 'unknown/invalid ('.$id.')');
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.graphic.tiff.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.misc.exe.php
===================================================================
--- trunk/inc/external/getid3/module.misc.exe.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.misc.exe.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,59 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.misc.exe.php                                         //
+// module for analyzing EXE files                              //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_exe
+{
+
+	function getid3_exe(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, $ThisFileInfo['avdataoffset'], SEEK_SET);
+		$EXEheader = fread($fd, 28);
+
+		if (substr($EXEheader, 0, 2) != 'MZ') {
+			$ThisFileInfo['error'][] = 'Expecting &quot;MZ&quot; at offset '.$ThisFileInfo['avdataoffset'].', found &quot;'.substr($EXEheader, 0, 2).'&quot; instead.';
+			return false;
+		}
+
+		$ThisFileInfo['fileformat'] = 'exe';
+		$ThisFileInfo['exe']['mz']['magic'] = 'MZ';
+
+		$ThisFileInfo['exe']['mz']['raw']['last_page_size']          = getid3_lib::LittleEndian2Int(substr($EXEheader,  2, 2));
+		$ThisFileInfo['exe']['mz']['raw']['page_count']              = getid3_lib::LittleEndian2Int(substr($EXEheader,  4, 2));
+		$ThisFileInfo['exe']['mz']['raw']['relocation_count']        = getid3_lib::LittleEndian2Int(substr($EXEheader,  6, 2));
+		$ThisFileInfo['exe']['mz']['raw']['header_paragraphs']       = getid3_lib::LittleEndian2Int(substr($EXEheader,  8, 2));
+		$ThisFileInfo['exe']['mz']['raw']['min_memory_paragraphs']   = getid3_lib::LittleEndian2Int(substr($EXEheader, 10, 2));
+		$ThisFileInfo['exe']['mz']['raw']['max_memory_paragraphs']   = getid3_lib::LittleEndian2Int(substr($EXEheader, 12, 2));
+		$ThisFileInfo['exe']['mz']['raw']['initial_ss']              = getid3_lib::LittleEndian2Int(substr($EXEheader, 14, 2));
+		$ThisFileInfo['exe']['mz']['raw']['initial_sp']              = getid3_lib::LittleEndian2Int(substr($EXEheader, 16, 2));
+		$ThisFileInfo['exe']['mz']['raw']['checksum']                = getid3_lib::LittleEndian2Int(substr($EXEheader, 18, 2));
+		$ThisFileInfo['exe']['mz']['raw']['cs_ip']                   = getid3_lib::LittleEndian2Int(substr($EXEheader, 20, 4));
+		$ThisFileInfo['exe']['mz']['raw']['relocation_table_offset'] = getid3_lib::LittleEndian2Int(substr($EXEheader, 24, 2));
+		$ThisFileInfo['exe']['mz']['raw']['overlay_number']          = getid3_lib::LittleEndian2Int(substr($EXEheader, 26, 2));
+
+		$ThisFileInfo['exe']['mz']['byte_size']          = (($ThisFileInfo['exe']['mz']['raw']['page_count'] - 1)) * 512 + $ThisFileInfo['exe']['mz']['raw']['last_page_size'];
+		$ThisFileInfo['exe']['mz']['header_size']        = $ThisFileInfo['exe']['mz']['raw']['header_paragraphs'] * 16;
+		$ThisFileInfo['exe']['mz']['memory_minimum']     = $ThisFileInfo['exe']['mz']['raw']['min_memory_paragraphs'] * 16;
+		$ThisFileInfo['exe']['mz']['memory_recommended'] = $ThisFileInfo['exe']['mz']['raw']['max_memory_paragraphs'] * 16;
+
+$ThisFileInfo['error'][] = 'EXE parsing not enabled in this version of getID3()';
+return false;
+
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.misc.exe.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.misc.iso.php
===================================================================
--- trunk/inc/external/getid3/module.misc.iso.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.misc.iso.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,386 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.misc.iso.php                                         //
+// module for analyzing ISO files                              //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_iso
+{
+
+	function getid3_iso($fd, &amp;$ThisFileInfo) {
+		$ThisFileInfo['fileformat'] = 'iso';
+
+		for ($i = 16; $i &lt;= 19; $i++) {
+			fseek($fd, 2048 * $i, SEEK_SET);
+			$ISOheader = fread($fd, 2048);
+			if (substr($ISOheader, 1, 5) == 'CD001') {
+				switch (ord($ISOheader{0})) {
+					case 1:
+						$ThisFileInfo['iso']['primary_volume_descriptor']['offset'] = 2048 * $i;
+						$this-&gt;ParsePrimaryVolumeDescriptor($ISOheader, $ThisFileInfo);
+						break;
+
+					case 2:
+						$ThisFileInfo['iso']['supplementary_volume_descriptor']['offset'] = 2048 * $i;
+						$this-&gt;ParseSupplementaryVolumeDescriptor($ISOheader, $ThisFileInfo);
+						break;
+
+					default:
+						// skip
+						break;
+				}
+			}
+		}
+
+		$this-&gt;ParsePathTable($fd, $ThisFileInfo);
+
+		$ThisFileInfo['iso']['files'] = array();
+		foreach ($ThisFileInfo['iso']['path_table']['directories'] as $directorynum =&gt; $directorydata) {
+
+			$ThisFileInfo['iso']['directories'][$directorynum] = $this-&gt;ParseDirectoryRecord($fd, $directorydata, $ThisFileInfo);
+
+		}
+
+		return true;
+
+	}
+
+
+	function ParsePrimaryVolumeDescriptor(&amp;$ISOheader, &amp;$ThisFileInfo) {
+		// ISO integer values are stored *BOTH* Little-Endian AND Big-Endian format!!
+		// ie 12345 == 0x3039  is stored as $39 $30 $30 $39 in a 4-byte field
+
+		// shortcuts
+		$ThisFileInfo['iso']['primary_volume_descriptor']['raw'] = array();
+		$thisfile_iso_primaryVD     = &amp;$ThisFileInfo['iso']['primary_volume_descriptor'];
+		$thisfile_iso_primaryVD_raw = &amp;$thisfile_iso_primaryVD['raw'];
+
+		$thisfile_iso_primaryVD_raw['volume_descriptor_type']         = getid3_lib::LittleEndian2Int(substr($ISOheader,    0, 1));
+		$thisfile_iso_primaryVD_raw['standard_identifier']            =                  substr($ISOheader,    1, 5);
+		if ($thisfile_iso_primaryVD_raw['standard_identifier'] != 'CD001') {
+			$ThisFileInfo['error'][] = 'Expected &quot;CD001&quot; at offset ('.($thisfile_iso_primaryVD['offset'] + 1).'), found &quot;'.$thisfile_iso_primaryVD_raw['standard_identifier'].'&quot; instead';
+			unset($ThisFileInfo['fileformat']);
+			unset($ThisFileInfo['iso']);
+			return false;
+		}
+
+
+		$thisfile_iso_primaryVD_raw['volume_descriptor_version']     = getid3_lib::LittleEndian2Int(substr($ISOheader,    6, 1));
+		//$thisfile_iso_primaryVD_raw['unused_1']                      =                              substr($ISOheader,    7, 1);
+		$thisfile_iso_primaryVD_raw['system_identifier']             =                              substr($ISOheader,    8, 32);
+		$thisfile_iso_primaryVD_raw['volume_identifier']             =                              substr($ISOheader,   40, 32);
+		//$thisfile_iso_primaryVD_raw['unused_2']                      =                              substr($ISOheader,   72, 8);
+		$thisfile_iso_primaryVD_raw['volume_space_size']             = getid3_lib::LittleEndian2Int(substr($ISOheader,   80, 4));
+		//$thisfile_iso_primaryVD_raw['unused_3']                      =                              substr($ISOheader,   88, 32);
+		$thisfile_iso_primaryVD_raw['volume_set_size']               = getid3_lib::LittleEndian2Int(substr($ISOheader,  120, 2));
+		$thisfile_iso_primaryVD_raw['volume_sequence_number']        = getid3_lib::LittleEndian2Int(substr($ISOheader,  124, 2));
+		$thisfile_iso_primaryVD_raw['logical_block_size']            = getid3_lib::LittleEndian2Int(substr($ISOheader,  128, 2));
+		$thisfile_iso_primaryVD_raw['path_table_size']               = getid3_lib::LittleEndian2Int(substr($ISOheader,  132, 4));
+		$thisfile_iso_primaryVD_raw['path_table_l_location']         = getid3_lib::LittleEndian2Int(substr($ISOheader,  140, 2));
+		$thisfile_iso_primaryVD_raw['path_table_l_opt_location']     = getid3_lib::LittleEndian2Int(substr($ISOheader,  144, 2));
+		$thisfile_iso_primaryVD_raw['path_table_m_location']         = getid3_lib::LittleEndian2Int(substr($ISOheader,  148, 2));
+		$thisfile_iso_primaryVD_raw['path_table_m_opt_location']     = getid3_lib::LittleEndian2Int(substr($ISOheader,  152, 2));
+		$thisfile_iso_primaryVD_raw['root_directory_record']         =                              substr($ISOheader,  156, 34);
+		$thisfile_iso_primaryVD_raw['volume_set_identifier']         =                              substr($ISOheader,  190, 128);
+		$thisfile_iso_primaryVD_raw['publisher_identifier']          =                              substr($ISOheader,  318, 128);
+		$thisfile_iso_primaryVD_raw['data_preparer_identifier']      =                              substr($ISOheader,  446, 128);
+		$thisfile_iso_primaryVD_raw['application_identifier']        =                              substr($ISOheader,  574, 128);
+		$thisfile_iso_primaryVD_raw['copyright_file_identifier']     =                              substr($ISOheader,  702, 37);
+		$thisfile_iso_primaryVD_raw['abstract_file_identifier']      =                              substr($ISOheader,  739, 37);
+		$thisfile_iso_primaryVD_raw['bibliographic_file_identifier'] =                              substr($ISOheader,  776, 37);
+		$thisfile_iso_primaryVD_raw['volume_creation_date_time']     =                              substr($ISOheader,  813, 17);
+		$thisfile_iso_primaryVD_raw['volume_modification_date_time'] =                              substr($ISOheader,  830, 17);
+		$thisfile_iso_primaryVD_raw['volume_expiration_date_time']   =                              substr($ISOheader,  847, 17);
+		$thisfile_iso_primaryVD_raw['volume_effective_date_time']    =                              substr($ISOheader,  864, 17);
+		$thisfile_iso_primaryVD_raw['file_structure_version']        = getid3_lib::LittleEndian2Int(substr($ISOheader,  881, 1));
+		//$thisfile_iso_primaryVD_raw['unused_4']                      = getid3_lib::LittleEndian2Int(substr($ISOheader,  882, 1));
+		$thisfile_iso_primaryVD_raw['application_data']              =                              substr($ISOheader,  883, 512);
+		//$thisfile_iso_primaryVD_raw['unused_5']                      =                              substr($ISOheader, 1395, 653);
+
+		$thisfile_iso_primaryVD['system_identifier']             = trim($thisfile_iso_primaryVD_raw['system_identifier']);
+		$thisfile_iso_primaryVD['volume_identifier']             = trim($thisfile_iso_primaryVD_raw['volume_identifier']);
+		$thisfile_iso_primaryVD['volume_set_identifier']         = trim($thisfile_iso_primaryVD_raw['volume_set_identifier']);
+		$thisfile_iso_primaryVD['publisher_identifier']          = trim($thisfile_iso_primaryVD_raw['publisher_identifier']);
+		$thisfile_iso_primaryVD['data_preparer_identifier']      = trim($thisfile_iso_primaryVD_raw['data_preparer_identifier']);
+		$thisfile_iso_primaryVD['application_identifier']        = trim($thisfile_iso_primaryVD_raw['application_identifier']);
+		$thisfile_iso_primaryVD['copyright_file_identifier']     = trim($thisfile_iso_primaryVD_raw['copyright_file_identifier']);
+		$thisfile_iso_primaryVD['abstract_file_identifier']      = trim($thisfile_iso_primaryVD_raw['abstract_file_identifier']);
+		$thisfile_iso_primaryVD['bibliographic_file_identifier'] = trim($thisfile_iso_primaryVD_raw['bibliographic_file_identifier']);
+		$thisfile_iso_primaryVD['volume_creation_date_time']     = $this-&gt;ISOtimeText2UNIXtime($thisfile_iso_primaryVD_raw['volume_creation_date_time']);
+		$thisfile_iso_primaryVD['volume_modification_date_time'] = $this-&gt;ISOtimeText2UNIXtime($thisfile_iso_primaryVD_raw['volume_modification_date_time']);
+		$thisfile_iso_primaryVD['volume_expiration_date_time']   = $this-&gt;ISOtimeText2UNIXtime($thisfile_iso_primaryVD_raw['volume_expiration_date_time']);
+		$thisfile_iso_primaryVD['volume_effective_date_time']    = $this-&gt;ISOtimeText2UNIXtime($thisfile_iso_primaryVD_raw['volume_effective_date_time']);
+
+		if (($thisfile_iso_primaryVD_raw['volume_space_size'] * 2048) &gt; $ThisFileInfo['filesize']) {
+			$ThisFileInfo['error'][] = 'Volume Space Size ('.($thisfile_iso_primaryVD_raw['volume_space_size'] * 2048).' bytes) is larger than the file size ('.$ThisFileInfo['filesize'].' bytes) (truncated file?)';
+		}
+
+		return true;
+	}
+
+
+	function ParseSupplementaryVolumeDescriptor(&amp;$ISOheader, &amp;$ThisFileInfo) {
+		// ISO integer values are stored Both-Endian format!!
+		// ie 12345 == 0x3039  is stored as $39 $30 $30 $39 in a 4-byte field
+
+		// shortcuts
+		$ThisFileInfo['iso']['supplementary_volume_descriptor']['raw'] = array();
+		$thisfile_iso_supplementaryVD     = &amp;$ThisFileInfo['iso']['supplementary_volume_descriptor'];
+		$thisfile_iso_supplementaryVD_raw = &amp;$thisfile_iso_supplementaryVD['raw'];
+
+		$thisfile_iso_supplementaryVD_raw['volume_descriptor_type'] = getid3_lib::LittleEndian2Int(substr($ISOheader,    0, 1));
+		$thisfile_iso_supplementaryVD_raw['standard_identifier']    =                  substr($ISOheader,    1, 5);
+		if ($thisfile_iso_supplementaryVD_raw['standard_identifier'] != 'CD001') {
+			$ThisFileInfo['error'][] = 'Expected &quot;CD001&quot; at offset ('.($thisfile_iso_supplementaryVD['offset'] + 1).'), found &quot;'.$thisfile_iso_supplementaryVD_raw['standard_identifier'].'&quot; instead';
+			unset($ThisFileInfo['fileformat']);
+			unset($ThisFileInfo['iso']);
+			return false;
+		}
+
+		$thisfile_iso_supplementaryVD_raw['volume_descriptor_version'] = getid3_lib::LittleEndian2Int(substr($ISOheader,    6, 1));
+		//$thisfile_iso_supplementaryVD_raw['unused_1']                  =                              substr($ISOheader,    7, 1);
+		$thisfile_iso_supplementaryVD_raw['system_identifier']         =                              substr($ISOheader,    8, 32);
+		$thisfile_iso_supplementaryVD_raw['volume_identifier']         =                              substr($ISOheader,   40, 32);
+		//$thisfile_iso_supplementaryVD_raw['unused_2']                  =                              substr($ISOheader,   72, 8);
+		$thisfile_iso_supplementaryVD_raw['volume_space_size']         = getid3_lib::LittleEndian2Int(substr($ISOheader,   80, 4));
+		if ($thisfile_iso_supplementaryVD_raw['volume_space_size'] == 0) {
+			// Supplementary Volume Descriptor not used
+			//unset($thisfile_iso_supplementaryVD);
+			//return false;
+		}
+
+		//$thisfile_iso_supplementaryVD_raw['unused_3']                       =                              substr($ISOheader,   88, 32);
+		$thisfile_iso_supplementaryVD_raw['volume_set_size']                = getid3_lib::LittleEndian2Int(substr($ISOheader,  120, 2));
+		$thisfile_iso_supplementaryVD_raw['volume_sequence_number']         = getid3_lib::LittleEndian2Int(substr($ISOheader,  124, 2));
+		$thisfile_iso_supplementaryVD_raw['logical_block_size']             = getid3_lib::LittleEndian2Int(substr($ISOheader,  128, 2));
+		$thisfile_iso_supplementaryVD_raw['path_table_size']                = getid3_lib::LittleEndian2Int(substr($ISOheader,  132, 4));
+		$thisfile_iso_supplementaryVD_raw['path_table_l_location']          = getid3_lib::LittleEndian2Int(substr($ISOheader,  140, 2));
+		$thisfile_iso_supplementaryVD_raw['path_table_l_opt_location']      = getid3_lib::LittleEndian2Int(substr($ISOheader,  144, 2));
+		$thisfile_iso_supplementaryVD_raw['path_table_m_location']          = getid3_lib::LittleEndian2Int(substr($ISOheader,  148, 2));
+		$thisfile_iso_supplementaryVD_raw['path_table_m_opt_location']      = getid3_lib::LittleEndian2Int(substr($ISOheader,  152, 2));
+		$thisfile_iso_supplementaryVD_raw['root_directory_record']          =                              substr($ISOheader,  156, 34);
+		$thisfile_iso_supplementaryVD_raw['volume_set_identifier']          =                              substr($ISOheader,  190, 128);
+		$thisfile_iso_supplementaryVD_raw['publisher_identifier']           =                              substr($ISOheader,  318, 128);
+		$thisfile_iso_supplementaryVD_raw['data_preparer_identifier']       =                              substr($ISOheader,  446, 128);
+		$thisfile_iso_supplementaryVD_raw['application_identifier']         =                              substr($ISOheader,  574, 128);
+		$thisfile_iso_supplementaryVD_raw['copyright_file_identifier']      =                              substr($ISOheader,  702, 37);
+		$thisfile_iso_supplementaryVD_raw['abstract_file_identifier']       =                              substr($ISOheader,  739, 37);
+		$thisfile_iso_supplementaryVD_raw['bibliographic_file_identifier']  =                              substr($ISOheader,  776, 37);
+		$thisfile_iso_supplementaryVD_raw['volume_creation_date_time']      =                              substr($ISOheader,  813, 17);
+		$thisfile_iso_supplementaryVD_raw['volume_modification_date_time']  =                              substr($ISOheader,  830, 17);
+		$thisfile_iso_supplementaryVD_raw['volume_expiration_date_time']    =                              substr($ISOheader,  847, 17);
+		$thisfile_iso_supplementaryVD_raw['volume_effective_date_time']     =                              substr($ISOheader,  864, 17);
+		$thisfile_iso_supplementaryVD_raw['file_structure_version']         = getid3_lib::LittleEndian2Int(substr($ISOheader,  881, 1));
+		//$thisfile_iso_supplementaryVD_raw['unused_4']                       = getid3_lib::LittleEndian2Int(substr($ISOheader,  882, 1));
+		$thisfile_iso_supplementaryVD_raw['application_data']               =                              substr($ISOheader,  883, 512);
+		//$thisfile_iso_supplementaryVD_raw['unused_5']                       =                              substr($ISOheader, 1395, 653);
+
+		$thisfile_iso_supplementaryVD['system_identifier']              = trim($thisfile_iso_supplementaryVD_raw['system_identifier']);
+		$thisfile_iso_supplementaryVD['volume_identifier']              = trim($thisfile_iso_supplementaryVD_raw['volume_identifier']);
+		$thisfile_iso_supplementaryVD['volume_set_identifier']          = trim($thisfile_iso_supplementaryVD_raw['volume_set_identifier']);
+		$thisfile_iso_supplementaryVD['publisher_identifier']           = trim($thisfile_iso_supplementaryVD_raw['publisher_identifier']);
+		$thisfile_iso_supplementaryVD['data_preparer_identifier']       = trim($thisfile_iso_supplementaryVD_raw['data_preparer_identifier']);
+		$thisfile_iso_supplementaryVD['application_identifier']         = trim($thisfile_iso_supplementaryVD_raw['application_identifier']);
+		$thisfile_iso_supplementaryVD['copyright_file_identifier']      = trim($thisfile_iso_supplementaryVD_raw['copyright_file_identifier']);
+		$thisfile_iso_supplementaryVD['abstract_file_identifier']       = trim($thisfile_iso_supplementaryVD_raw['abstract_file_identifier']);
+		$thisfile_iso_supplementaryVD['bibliographic_file_identifier']  = trim($thisfile_iso_supplementaryVD_raw['bibliographic_file_identifier']);
+		$thisfile_iso_supplementaryVD['volume_creation_date_time']      = $this-&gt;ISOtimeText2UNIXtime($thisfile_iso_supplementaryVD_raw['volume_creation_date_time']);
+		$thisfile_iso_supplementaryVD['volume_modification_date_time']  = $this-&gt;ISOtimeText2UNIXtime($thisfile_iso_supplementaryVD_raw['volume_modification_date_time']);
+		$thisfile_iso_supplementaryVD['volume_expiration_date_time']    = $this-&gt;ISOtimeText2UNIXtime($thisfile_iso_supplementaryVD_raw['volume_expiration_date_time']);
+		$thisfile_iso_supplementaryVD['volume_effective_date_time']     = $this-&gt;ISOtimeText2UNIXtime($thisfile_iso_supplementaryVD_raw['volume_effective_date_time']);
+
+		if (($thisfile_iso_supplementaryVD_raw['volume_space_size'] * $thisfile_iso_supplementaryVD_raw['logical_block_size']) &gt; $ThisFileInfo['filesize']) {
+			$ThisFileInfo['error'][] = 'Volume Space Size ('.($thisfile_iso_supplementaryVD_raw['volume_space_size'] * $thisfile_iso_supplementaryVD_raw['logical_block_size']).' bytes) is larger than the file size ('.$ThisFileInfo['filesize'].' bytes) (truncated file?)';
+		}
+
+		return true;
+	}
+
+
+	function ParsePathTable($fd, &amp;$ThisFileInfo) {
+		if (!isset($ThisFileInfo['iso']['supplementary_volume_descriptor']['raw']['path_table_l_location']) &amp;&amp; !isset($ThisFileInfo['iso']['primary_volume_descriptor']['raw']['path_table_l_location'])) {
+			return false;
+		}
+		if (isset($ThisFileInfo['iso']['supplementary_volume_descriptor']['raw']['path_table_l_location'])) {
+			$PathTableLocation = $ThisFileInfo['iso']['supplementary_volume_descriptor']['raw']['path_table_l_location'];
+			$PathTableSize     = $ThisFileInfo['iso']['supplementary_volume_descriptor']['raw']['path_table_size'];
+			$TextEncoding      = 'UTF-16BE'; // Big-Endian Unicode
+		} else {
+			$PathTableLocation = $ThisFileInfo['iso']['primary_volume_descriptor']['raw']['path_table_l_location'];
+			$PathTableSize     = $ThisFileInfo['iso']['primary_volume_descriptor']['raw']['path_table_size'];
+			$TextEncoding      = 'ISO-8859-1'; // Latin-1
+		}
+
+		if (($PathTableLocation * 2048) &gt; $ThisFileInfo['filesize']) {
+			$ThisFileInfo['error'][] = 'Path Table Location specifies an offset ('.($PathTableLocation * 2048).') beyond the end-of-file ('.$ThisFileInfo['filesize'].')';
+			return false;
+		}
+
+		$ThisFileInfo['iso']['path_table']['offset'] = $PathTableLocation * 2048;
+		fseek($fd, $ThisFileInfo['iso']['path_table']['offset'], SEEK_SET);
+		$ThisFileInfo['iso']['path_table']['raw'] = fread($fd, $PathTableSize);
+
+		$offset = 0;
+		$pathcounter = 1;
+		while ($offset &lt; $PathTableSize) {
+			// shortcut
+			$ThisFileInfo['iso']['path_table']['directories'][$pathcounter] = array();
+			$thisfile_iso_pathtable_directories_current = &amp;$ThisFileInfo['iso']['path_table']['directories'][$pathcounter];
+
+			$thisfile_iso_pathtable_directories_current['length']           = getid3_lib::LittleEndian2Int(substr($ThisFileInfo['iso']['path_table']['raw'], $offset, 1));
+			$offset += 1;
+			$thisfile_iso_pathtable_directories_current['extended_length']  = getid3_lib::LittleEndian2Int(substr($ThisFileInfo['iso']['path_table']['raw'], $offset, 1));
+			$offset += 1;
+			$thisfile_iso_pathtable_directories_current['location_logical'] = getid3_lib::LittleEndian2Int(substr($ThisFileInfo['iso']['path_table']['raw'], $offset, 4));
+			$offset += 4;
+			$thisfile_iso_pathtable_directories_current['parent_directory'] = getid3_lib::LittleEndian2Int(substr($ThisFileInfo['iso']['path_table']['raw'], $offset, 2));
+			$offset += 2;
+			$thisfile_iso_pathtable_directories_current['name']             =                  substr($ThisFileInfo['iso']['path_table']['raw'], $offset, $thisfile_iso_pathtable_directories_current['length']);
+			$offset += $thisfile_iso_pathtable_directories_current['length'] + ($thisfile_iso_pathtable_directories_current['length'] % 2);
+
+			$thisfile_iso_pathtable_directories_current['name_ascii']       = getid3_lib::iconv_fallback($TextEncoding, $ThisFileInfo['encoding'], $thisfile_iso_pathtable_directories_current['name']);
+
+			$thisfile_iso_pathtable_directories_current['location_bytes'] = $thisfile_iso_pathtable_directories_current['location_logical'] * 2048;
+			if ($pathcounter == 1) {
+				$thisfile_iso_pathtable_directories_current['full_path'] = '/';
+			} else {
+				$thisfile_iso_pathtable_directories_current['full_path'] = $ThisFileInfo['iso']['path_table']['directories'][$thisfile_iso_pathtable_directories_current['parent_directory']]['full_path'].$thisfile_iso_pathtable_directories_current['name_ascii'].'/';
+			}
+			$FullPathArray[] = $thisfile_iso_pathtable_directories_current['full_path'];
+
+			$pathcounter++;
+		}
+
+		return true;
+	}
+
+
+	function ParseDirectoryRecord(&amp;$fd, $directorydata, &amp;$ThisFileInfo) {
+		if (isset($ThisFileInfo['iso']['supplementary_volume_descriptor'])) {
+			$TextEncoding = 'UTF-16BE';   // Big-Endian Unicode
+		} else {
+			$TextEncoding = 'ISO-8859-1'; // Latin-1
+		}
+
+		fseek($fd, $directorydata['location_bytes'], SEEK_SET);
+		$DirectoryRecordData = fread($fd, 1);
+
+		while (ord($DirectoryRecordData{0}) &gt; 33) {
+
+			$DirectoryRecordData .= fread($fd, ord($DirectoryRecordData{0}) - 1);
+
+			$ThisDirectoryRecord['raw']['length']                    = getid3_lib::LittleEndian2Int(substr($DirectoryRecordData,  0, 1));
+			$ThisDirectoryRecord['raw']['extended_attribute_length'] = getid3_lib::LittleEndian2Int(substr($DirectoryRecordData,  1, 1));
+			$ThisDirectoryRecord['raw']['offset_logical']            = getid3_lib::LittleEndian2Int(substr($DirectoryRecordData,  2, 4));
+			$ThisDirectoryRecord['raw']['filesize']                  = getid3_lib::LittleEndian2Int(substr($DirectoryRecordData, 10, 4));
+			$ThisDirectoryRecord['raw']['recording_date_time']       =                  substr($DirectoryRecordData, 18, 7);
+			$ThisDirectoryRecord['raw']['file_flags']                = getid3_lib::LittleEndian2Int(substr($DirectoryRecordData, 25, 1));
+			$ThisDirectoryRecord['raw']['file_unit_size']            = getid3_lib::LittleEndian2Int(substr($DirectoryRecordData, 26, 1));
+			$ThisDirectoryRecord['raw']['interleave_gap_size']       = getid3_lib::LittleEndian2Int(substr($DirectoryRecordData, 27, 1));
+			$ThisDirectoryRecord['raw']['volume_sequence_number']    = getid3_lib::LittleEndian2Int(substr($DirectoryRecordData, 28, 2));
+			$ThisDirectoryRecord['raw']['file_identifier_length']    = getid3_lib::LittleEndian2Int(substr($DirectoryRecordData, 32, 1));
+			$ThisDirectoryRecord['raw']['file_identifier']           =                  substr($DirectoryRecordData, 33, $ThisDirectoryRecord['raw']['file_identifier_length']);
+
+			$ThisDirectoryRecord['file_identifier_ascii']            = getid3_lib::iconv_fallback($TextEncoding, $ThisFileInfo['encoding'], $ThisDirectoryRecord['raw']['file_identifier']);
+
+			$ThisDirectoryRecord['filesize']                  = $ThisDirectoryRecord['raw']['filesize'];
+			$ThisDirectoryRecord['offset_bytes']              = $ThisDirectoryRecord['raw']['offset_logical'] * 2048;
+			$ThisDirectoryRecord['file_flags']['hidden']      = (bool) ($ThisDirectoryRecord['raw']['file_flags'] &amp; 0x01);
+			$ThisDirectoryRecord['file_flags']['directory']   = (bool) ($ThisDirectoryRecord['raw']['file_flags'] &amp; 0x02);
+			$ThisDirectoryRecord['file_flags']['associated']  = (bool) ($ThisDirectoryRecord['raw']['file_flags'] &amp; 0x04);
+			$ThisDirectoryRecord['file_flags']['extended']    = (bool) ($ThisDirectoryRecord['raw']['file_flags'] &amp; 0x08);
+			$ThisDirectoryRecord['file_flags']['permissions'] = (bool) ($ThisDirectoryRecord['raw']['file_flags'] &amp; 0x10);
+			$ThisDirectoryRecord['file_flags']['multiple']    = (bool) ($ThisDirectoryRecord['raw']['file_flags'] &amp; 0x80);
+			$ThisDirectoryRecord['recording_timestamp']       = $this-&gt;ISOtime2UNIXtime($ThisDirectoryRecord['raw']['recording_date_time']);
+
+			if ($ThisDirectoryRecord['file_flags']['directory']) {
+				$ThisDirectoryRecord['filename'] = $directorydata['full_path'];
+			} else {
+				$ThisDirectoryRecord['filename'] = $directorydata['full_path'].$this-&gt;ISOstripFilenameVersion($ThisDirectoryRecord['file_identifier_ascii']);
+				$ThisFileInfo['iso']['files'] = getid3_lib::array_merge_clobber($ThisFileInfo['iso']['files'], getid3_lib::CreateDeepArray($ThisDirectoryRecord['filename'], '/', $ThisDirectoryRecord['filesize']));
+			}
+
+			$DirectoryRecord[] = $ThisDirectoryRecord;
+			$DirectoryRecordData = fread($fd, 1);
+		}
+
+		return $DirectoryRecord;
+	}
+
+	function ISOstripFilenameVersion($ISOfilename) {
+		// convert 'filename.ext;1' to 'filename.ext'
+		if (!strstr($ISOfilename, ';')) {
+			return $ISOfilename;
+		} else {
+			return substr($ISOfilename, 0, strpos($ISOfilename, ';'));
+		}
+	}
+
+	function ISOtimeText2UNIXtime($ISOtime) {
+
+		$UNIXyear   = (int) substr($ISOtime,  0, 4);
+		$UNIXmonth  = (int) substr($ISOtime,  4, 2);
+		$UNIXday    = (int) substr($ISOtime,  6, 2);
+		$UNIXhour   = (int) substr($ISOtime,  8, 2);
+		$UNIXminute = (int) substr($ISOtime, 10, 2);
+		$UNIXsecond = (int) substr($ISOtime, 12, 2);
+
+		if (!$UNIXyear) {
+			return false;
+		}
+		return mktime($UNIXhour, $UNIXminute, $UNIXsecond, $UNIXmonth, $UNIXday, $UNIXyear);
+	}
+
+	function ISOtime2UNIXtime($ISOtime) {
+		// Represented by seven bytes:
+		// 1: Number of years since 1900
+		// 2: Month of the year from 1 to 12
+		// 3: Day of the Month from 1 to 31
+		// 4: Hour of the day from 0 to 23
+		// 5: Minute of the hour from 0 to 59
+		// 6: second of the minute from 0 to 59
+		// 7: Offset from Greenwich Mean Time in number of 15 minute intervals from -48 (West) to +52 (East)
+
+		$UNIXyear   = ord($ISOtime{0}) + 1900;
+		$UNIXmonth  = ord($ISOtime{1});
+		$UNIXday    = ord($ISOtime{2});
+		$UNIXhour   = ord($ISOtime{3});
+		$UNIXminute = ord($ISOtime{4});
+		$UNIXsecond = ord($ISOtime{5});
+		$GMToffset  = $this-&gt;TwosCompliment2Decimal(ord($ISOtime{5}));
+
+		return mktime($UNIXhour, $UNIXminute, $UNIXsecond, $UNIXmonth, $UNIXday, $UNIXyear);
+	}
+
+	function TwosCompliment2Decimal($BinaryValue) {
+		// <A HREF="http://sandbox.mc.edu/~bennet/cs110/tc/tctod.html">http://sandbox.mc.edu/~bennet/cs110/tc/tctod.html</A>
+		// First check if the number is negative or positive by looking at the sign bit.
+		// If it is positive, simply convert it to decimal.
+		// If it is negative, make it positive by inverting the bits and adding one.
+		// Then, convert the result to decimal.
+		// The negative of this number is the value of the original binary.
+
+		if ($BinaryValue &amp; 0x80) {
+
+			// negative number
+			return (0 - ((~$BinaryValue &amp; 0xFF) + 1));
+		} else {
+			// positive number
+			return $BinaryValue;
+		}
+	}
+
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.misc.iso.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.tag.apetag.php
===================================================================
--- trunk/inc/external/getid3/module.tag.apetag.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.tag.apetag.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,284 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.tag.apetag.php                                       //
+// module for analyzing APE tags                               //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+class getid3_apetag
+{
+
+	function getid3_apetag(&amp;$fd, &amp;$ThisFileInfo, $overrideendoffset=0) {
+		$id3v1tagsize     = 128;
+		$apetagheadersize = 32;
+		$lyrics3tagsize   = 10;
+
+		if ($overrideendoffset == 0) {
+
+			fseek($fd, 0 - $id3v1tagsize - $apetagheadersize - $lyrics3tagsize, SEEK_END);
+			$APEfooterID3v1 = fread($fd, $id3v1tagsize + $apetagheadersize + $lyrics3tagsize);
+
+			//if (preg_match('/APETAGEX.{24}TAG.{125}$/i', $APEfooterID3v1)) {
+			if (substr($APEfooterID3v1, strlen($APEfooterID3v1) - $id3v1tagsize - $apetagheadersize, 8) == 'APETAGEX') {
+
+				// APE tag found before ID3v1
+				$ThisFileInfo['ape']['tag_offset_end'] = $ThisFileInfo['filesize'] - $id3v1tagsize;
+
+			//} elseif (preg_match('/APETAGEX.{24}$/i', $APEfooterID3v1)) {
+			} elseif (substr($APEfooterID3v1, strlen($APEfooterID3v1) - $apetagheadersize, 8) == 'APETAGEX') {
+
+				// APE tag found, no ID3v1
+				$ThisFileInfo['ape']['tag_offset_end'] = $ThisFileInfo['filesize'];
+
+			}
+
+		} else {
+
+			fseek($fd, $overrideendoffset - $apetagheadersize, SEEK_SET);
+			if (fread($fd, 8) == 'APETAGEX') {
+				$ThisFileInfo['ape']['tag_offset_end'] = $overrideendoffset;
+			}
+
+		}
+		if (!isset($ThisFileInfo['ape']['tag_offset_end'])) {
+
+			// APE tag not found
+			unset($ThisFileInfo['ape']);
+			return false;
+
+		}
+
+		// shortcut
+		$thisfile_ape = &amp;$ThisFileInfo['ape'];
+
+		fseek($fd, $thisfile_ape['tag_offset_end'] - $apetagheadersize, SEEK_SET);
+		$APEfooterData = fread($fd, 32);
+		if (!($thisfile_ape['footer'] = $this-&gt;parseAPEheaderFooter($APEfooterData))) {
+			$ThisFileInfo['error'][] = 'Error parsing APE footer at offset '.$thisfile_ape['tag_offset_end'];
+			return false;
+		}
+
+		if (isset($thisfile_ape['footer']['flags']['header']) &amp;&amp; $thisfile_ape['footer']['flags']['header']) {
+			fseek($fd, $thisfile_ape['tag_offset_end'] - $thisfile_ape['footer']['raw']['tagsize'] - $apetagheadersize, SEEK_SET);
+			$thisfile_ape['tag_offset_start'] = ftell($fd);
+			$APEtagData = fread($fd, $thisfile_ape['footer']['raw']['tagsize'] + $apetagheadersize);
+		} else {
+			$thisfile_ape['tag_offset_start'] = $thisfile_ape['tag_offset_end'] - $thisfile_ape['footer']['raw']['tagsize'];
+			fseek($fd, $thisfile_ape['tag_offset_start'], SEEK_SET);
+			$APEtagData = fread($fd, $thisfile_ape['footer']['raw']['tagsize']);
+		}
+		$ThisFileInfo['avdataend'] = $thisfile_ape['tag_offset_start'];
+
+		if (isset($ThisFileInfo['id3v1']['tag_offset_start']) &amp;&amp; ($ThisFileInfo['id3v1']['tag_offset_start'] &lt; $thisfile_ape['tag_offset_end'])) {
+			$ThisFileInfo['warning'][] = 'ID3v1 tag information ignored since it appears to be a false synch in APEtag data';
+			unset($ThisFileInfo['id3v1']);
+			foreach ($ThisFileInfo['warning'] as $key =&gt; $value) {
+				if ($value == 'Some ID3v1 fields do not use NULL characters for padding') {
+					unset($ThisFileInfo['warning'][$key]);
+					sort($ThisFileInfo['warning']);
+					break;
+				}
+			}
+		}
+
+		$offset = 0;
+		if (isset($thisfile_ape['footer']['flags']['header']) &amp;&amp; $thisfile_ape['footer']['flags']['header']) {
+			if ($thisfile_ape['header'] = $this-&gt;parseAPEheaderFooter(substr($APEtagData, 0, $apetagheadersize))) {
+				$offset += $apetagheadersize;
+			} else {
+				$ThisFileInfo['error'][] = 'Error parsing APE header at offset '.$thisfile_ape['tag_offset_start'];
+				return false;
+			}
+		}
+
+		// shortcut
+		$ThisFileInfo['replay_gain'] = array();
+		$thisfile_replaygain = &amp;$ThisFileInfo['replay_gain'];
+		
+		for ($i = 0; $i &lt; $thisfile_ape['footer']['raw']['tag_items']; $i++) {
+			$value_size = getid3_lib::LittleEndian2Int(substr($APEtagData, $offset, 4));
+			$offset += 4;
+			$item_flags = getid3_lib::LittleEndian2Int(substr($APEtagData, $offset, 4));
+			$offset += 4;
+			if (strstr(substr($APEtagData, $offset), &quot;\x00&quot;) === false) {
+				$ThisFileInfo['error'][] = 'Cannot find null-byte (0x00) seperator between ItemKey #'.$i.' and value. ItemKey starts '.$offset.' bytes into the APE tag, at file offset '.($thisfile_ape['tag_offset_start'] + $offset);
+				return false;
+			}
+			$ItemKeyLength = strpos($APEtagData, &quot;\x00&quot;, $offset) - $offset;
+			$item_key      = strtolower(substr($APEtagData, $offset, $ItemKeyLength));
+
+			// shortcut
+			$thisfile_ape['items'][$item_key] = array();
+			$thisfile_ape_items_current = &amp;$thisfile_ape['items'][$item_key];
+
+			$offset += ($ItemKeyLength + 1); // skip 0x00 terminator
+			$thisfile_ape_items_current['data'] = substr($APEtagData, $offset, $value_size);
+			$offset += $value_size;
+
+			$thisfile_ape_items_current['flags'] = $this-&gt;parseAPEtagFlags($item_flags);
+			switch ($thisfile_ape_items_current['flags']['item_contents_raw']) {
+				case 0: // UTF-8
+				case 3: // Locator (URL, filename, etc), UTF-8 encoded
+					$thisfile_ape_items_current['data'] = explode(&quot;\x00&quot;, trim($thisfile_ape_items_current['data']));
+					break;
+
+				default: // binary data
+					break;
+			}
+
+			switch (strtolower($item_key)) {
+				case 'replaygain_track_gain':
+					$thisfile_replaygain['track']['adjustment'] = (float) str_replace(',', '.', $thisfile_ape_items_current['data'][0]); // float casting will see &quot;0,95&quot; as zero!
+					$thisfile_replaygain['track']['originator'] = 'unspecified';
+					break;
+
+				case 'replaygain_track_peak':
+					$thisfile_replaygain['track']['peak']       = (float) str_replace(',', '.', $thisfile_ape_items_current['data'][0]); // float casting will see &quot;0,95&quot; as zero!
+					$thisfile_replaygain['track']['originator'] = 'unspecified';
+					if ($thisfile_replaygain['track']['peak'] &lt;= 0) {
+						$ThisFileInfo['warning'][] = 'ReplayGain Track peak from APEtag appears invalid: '.$thisfile_replaygain['track']['peak'].' (original value = &quot;'.$thisfile_ape_items_current['data'][0].'&quot;)';
+					}
+					break;
+
+				case 'replaygain_album_gain':
+					$thisfile_replaygain['album']['adjustment'] = (float) str_replace(',', '.', $thisfile_ape_items_current['data'][0]); // float casting will see &quot;0,95&quot; as zero!
+					$thisfile_replaygain['album']['originator'] = 'unspecified';
+					break;
+
+				case 'replaygain_album_peak':
+					$thisfile_replaygain['album']['peak']       = (float) str_replace(',', '.', $thisfile_ape_items_current['data'][0]); // float casting will see &quot;0,95&quot; as zero!
+					$thisfile_replaygain['album']['originator'] = 'unspecified';
+					if ($thisfile_replaygain['album']['peak'] &lt;= 0) {
+						$ThisFileInfo['warning'][] = 'ReplayGain Album peak from APEtag appears invalid: '.$thisfile_replaygain['album']['peak'].' (original value = &quot;'.$thisfile_ape_items_current['data'][0].'&quot;)';
+					}
+					break;
+
+				case 'mp3gain_undo':
+					list($mp3gain_undo_left, $mp3gain_undo_right, $mp3gain_undo_wrap) = explode(',', $thisfile_ape_items_current['data'][0]);
+					$thisfile_replaygain['mp3gain']['undo_left']  = intval($mp3gain_undo_left);
+					$thisfile_replaygain['mp3gain']['undo_right'] = intval($mp3gain_undo_right);
+					$thisfile_replaygain['mp3gain']['undo_wrap']  = (($mp3gain_undo_wrap == 'Y') ? true : false);
+					break;
+
+				case 'mp3gain_minmax':
+					list($mp3gain_globalgain_min, $mp3gain_globalgain_max) = explode(',', $thisfile_ape_items_current['data'][0]);
+					$thisfile_replaygain['mp3gain']['globalgain_track_min'] = intval($mp3gain_globalgain_min);
+					$thisfile_replaygain['mp3gain']['globalgain_track_max'] = intval($mp3gain_globalgain_max);
+					break;
+
+				case 'mp3gain_album_minmax':
+					list($mp3gain_globalgain_album_min, $mp3gain_globalgain_album_max) = explode(',', $thisfile_ape_items_current['data'][0]);
+					$thisfile_replaygain['mp3gain']['globalgain_album_min'] = intval($mp3gain_globalgain_album_min);
+					$thisfile_replaygain['mp3gain']['globalgain_album_max'] = intval($mp3gain_globalgain_album_max);
+					break;
+
+				case 'tracknumber':
+					foreach ($thisfile_ape_items_current['data'] as $comment) {
+						$thisfile_ape['comments']['track'][] = $comment;
+					}
+					break;
+
+				default:
+					foreach ($thisfile_ape_items_current['data'] as $comment) {
+						$thisfile_ape['comments'][strtolower($item_key)][] = $comment;
+					}
+					break;
+			}
+
+		}
+		if (empty($thisfile_replaygain)) {
+			unset($ThisFileInfo['replay_gain']);
+		}
+
+		return true;
+	}
+
+	function parseAPEheaderFooter($APEheaderFooterData) {
+		// <A HREF="http://www.uni-jena.de/~pfk/mpp/sv8/apeheader.html">http://www.uni-jena.de/~pfk/mpp/sv8/apeheader.html</A>
+
+		// shortcut
+		$headerfooterinfo['raw'] = array();
+		$headerfooterinfo_raw = &amp;$headerfooterinfo['raw'];
+
+		$headerfooterinfo_raw['footer_tag']   =                  substr($APEheaderFooterData,  0, 8);
+		if ($headerfooterinfo_raw['footer_tag'] != 'APETAGEX') {
+			return false;
+		}
+		$headerfooterinfo_raw['version']      = getid3_lib::LittleEndian2Int(substr($APEheaderFooterData,  8, 4));
+		$headerfooterinfo_raw['tagsize']      = getid3_lib::LittleEndian2Int(substr($APEheaderFooterData, 12, 4));
+		$headerfooterinfo_raw['tag_items']    = getid3_lib::LittleEndian2Int(substr($APEheaderFooterData, 16, 4));
+		$headerfooterinfo_raw['global_flags'] = getid3_lib::LittleEndian2Int(substr($APEheaderFooterData, 20, 4));
+		$headerfooterinfo_raw['reserved']     =                              substr($APEheaderFooterData, 24, 8);
+
+		$headerfooterinfo['tag_version']         = $headerfooterinfo_raw['version'] / 1000;
+		if ($headerfooterinfo['tag_version'] &gt;= 2) {
+			$headerfooterinfo['flags'] = $this-&gt;parseAPEtagFlags($headerfooterinfo_raw['global_flags']);
+		}
+		return $headerfooterinfo;
+	}
+
+	function parseAPEtagFlags($rawflagint) {
+		// &quot;Note: APE Tags 1.0 do not use any of the APE Tag flags.
+		// All are set to zero on creation and ignored on reading.&quot;
+		// <A HREF="http://www.uni-jena.de/~pfk/mpp/sv8/apetagflags.html">http://www.uni-jena.de/~pfk/mpp/sv8/apetagflags.html</A>
+		$flags['header']            = (bool) ($rawflagint &amp; 0x80000000);
+		$flags['footer']            = (bool) ($rawflagint &amp; 0x40000000);
+		$flags['this_is_header']    = (bool) ($rawflagint &amp; 0x20000000);
+		$flags['item_contents_raw'] =        ($rawflagint &amp; 0x00000006) &gt;&gt; 1;
+		$flags['read_only']         = (bool) ($rawflagint &amp; 0x00000001);
+
+		$flags['item_contents']     = $this-&gt;APEcontentTypeFlagLookup($flags['item_contents_raw']);
+
+		return $flags;
+	}
+
+	function APEcontentTypeFlagLookup($contenttypeid) {
+		static $APEcontentTypeFlagLookup = array(
+			0 =&gt; 'utf-8',
+			1 =&gt; 'binary',
+			2 =&gt; 'external',
+			3 =&gt; 'reserved'
+		);
+		return (isset($APEcontentTypeFlagLookup[$contenttypeid]) ? $APEcontentTypeFlagLookup[$contenttypeid] : 'invalid');
+	}
+
+	function APEtagItemIsUTF8Lookup($itemkey) {
+		static $APEtagItemIsUTF8Lookup = array(
+			'title',
+			'subtitle',
+			'artist',
+			'album',
+			'debut album',
+			'publisher',
+			'conductor',
+			'track',
+			'composer',
+			'comment',
+			'copyright',
+			'publicationright',
+			'file',
+			'year',
+			'record date',
+			'record location',
+			'genre',
+			'media',
+			'related',
+			'isrc',
+			'abstract',
+			'language',
+			'bibliography'
+		);
+		return in_array(strtolower($itemkey), $APEtagItemIsUTF8Lookup);
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.tag.apetag.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.tag.id3v1.php
===================================================================
--- trunk/inc/external/getid3/module.tag.id3v1.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.tag.id3v1.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,356 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// module.tag.id3v1.php                                        //
+// module for analyzing ID3v1 tags                             //
+// dependencies: NONE                                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_id3v1
+{
+
+	function getid3_id3v1(&amp;$fd, &amp;$ThisFileInfo) {
+
+		fseek($fd, -256, SEEK_END);
+		$preid3v1 = fread($fd, 128);
+		$id3v1tag = fread($fd, 128);
+
+		if (substr($id3v1tag, 0, 3) == 'TAG') {
+
+			$ThisFileInfo['avdataend'] = $ThisFileInfo['filesize'] - 128;
+
+			$ParsedID3v1['title']   = $this-&gt;cutfield(substr($id3v1tag,   3, 30));
+			$ParsedID3v1['artist']  = $this-&gt;cutfield(substr($id3v1tag,  33, 30));
+			$ParsedID3v1['album']   = $this-&gt;cutfield(substr($id3v1tag,  63, 30));
+			$ParsedID3v1['year']    = $this-&gt;cutfield(substr($id3v1tag,  93,  4));
+			$ParsedID3v1['comment'] =                 substr($id3v1tag,  97, 30);  // can't remove nulls yet, track detection depends on them
+			$ParsedID3v1['genreid'] =             ord(substr($id3v1tag, 127,  1));
+
+			// If second-last byte of comment field is null and last byte of comment field is non-null
+			// then this is ID3v1.1 and the comment field is 28 bytes long and the 30th byte is the track number
+			if (($id3v1tag{125} === &quot;\x00&quot;) &amp;&amp; ($id3v1tag{126} !== &quot;\x00&quot;)) {
+				$ParsedID3v1['track']   = ord(substr($ParsedID3v1['comment'], 29,  1));
+				$ParsedID3v1['comment'] =     substr($ParsedID3v1['comment'],  0, 28);
+			}
+			$ParsedID3v1['comment'] = $this-&gt;cutfield($ParsedID3v1['comment']);
+
+			$ParsedID3v1['genre'] = $this-&gt;LookupGenreName($ParsedID3v1['genreid']);
+			if (!empty($ParsedID3v1['genre'])) {
+				unset($ParsedID3v1['genreid']);
+			}
+			if (empty($ParsedID3v1['genre']) || (@$ParsedID3v1['genre'] == 'Unknown')) {
+				unset($ParsedID3v1['genre']);
+			}
+
+			foreach ($ParsedID3v1 as $key =&gt; $value) {
+				$ParsedID3v1['comments'][$key][0] = $value;
+			}
+
+			// ID3v1 data is supposed to be padded with NULL characters, but some taggers pad with spaces
+			$GoodFormatID3v1tag = $this-&gt;GenerateID3v1Tag(
+											$ParsedID3v1['title'],
+											$ParsedID3v1['artist'],
+											$ParsedID3v1['album'],
+											$ParsedID3v1['year'],
+											$this-&gt;LookupGenreID(@$ParsedID3v1['genre']),
+											$ParsedID3v1['comment'],
+											@$ParsedID3v1['track']);
+			$ParsedID3v1['padding_valid'] = true;
+			if ($id3v1tag !== $GoodFormatID3v1tag) {
+				$ParsedID3v1['padding_valid'] = false;
+				$ThisFileInfo['warning'][] = 'Some ID3v1 fields do not use NULL characters for padding';
+			}
+
+			$ParsedID3v1['tag_offset_end']   = $ThisFileInfo['filesize'];
+			$ParsedID3v1['tag_offset_start'] = $ParsedID3v1['tag_offset_end'] - 128;
+
+			$ThisFileInfo['id3v1'] = $ParsedID3v1;
+		}
+
+		if (substr($preid3v1, 0, 3) == 'TAG') {
+			// The way iTunes handles tags is, well, brain-damaged.
+			// It completely ignores v1 if ID3v2 is present.
+			// This goes as far as adding a new v1 tag *even if there already is one*
+
+			// A suspected double-ID3v1 tag has been detected, but it could be that
+			// the &quot;TAG&quot; identifier is a legitimate part of an APE or Lyrics3 tag
+			if (substr($preid3v1, 96, 8) == 'APETAGEX') {
+				// an APE tag footer was found before the last ID3v1, assume false &quot;TAG&quot; synch
+			} elseif (substr($preid3v1, 119, 6) == 'LYRICS') {
+				// a Lyrics3 tag footer was found before the last ID3v1, assume false &quot;TAG&quot; synch
+			} else {
+				// APE and Lyrics3 footers not found - assume double ID3v1
+				$ThisFileInfo['warning'][] = 'Duplicate ID3v1 tag detected - this has been known to happen with iTunes';
+				$ThisFileInfo['avdataend'] -= 128;
+			}
+		}
+
+		return true;
+	}
+
+	function cutfield($str) {
+		return trim(substr($str, 0, strcspn($str, &quot;\x00&quot;)));
+	}
+
+	function ArrayOfGenres($allowSCMPXextended=false) {
+		static $GenreLookup = array(
+			0    =&gt; 'Blues',
+			1    =&gt; 'Classic Rock',
+			2    =&gt; 'Country',
+			3    =&gt; 'Dance',
+			4    =&gt; 'Disco',
+			5    =&gt; 'Funk',
+			6    =&gt; 'Grunge',
+			7    =&gt; 'Hip-Hop',
+			8    =&gt; 'Jazz',
+			9    =&gt; 'Metal',
+			10   =&gt; 'New Age',
+			11   =&gt; 'Oldies',
+			12   =&gt; 'Other',
+			13   =&gt; 'Pop',
+			14   =&gt; 'R&amp;B',
+			15   =&gt; 'Rap',
+			16   =&gt; 'Reggae',
+			17   =&gt; 'Rock',
+			18   =&gt; 'Techno',
+			19   =&gt; 'Industrial',
+			20   =&gt; 'Alternative',
+			21   =&gt; 'Ska',
+			22   =&gt; 'Death Metal',
+			23   =&gt; 'Pranks',
+			24   =&gt; 'Soundtrack',
+			25   =&gt; 'Euro-Techno',
+			26   =&gt; 'Ambient',
+			27   =&gt; 'Trip-Hop',
+			28   =&gt; 'Vocal',
+			29   =&gt; 'Jazz+Funk',
+			30   =&gt; 'Fusion',
+			31   =&gt; 'Trance',
+			32   =&gt; 'Classical',
+			33   =&gt; 'Instrumental',
+			34   =&gt; 'Acid',
+			35   =&gt; 'House',
+			36   =&gt; 'Game',
+			37   =&gt; 'Sound Clip',
+			38   =&gt; 'Gospel',
+			39   =&gt; 'Noise',
+			40   =&gt; 'Alt. Rock',
+			41   =&gt; 'Bass',
+			42   =&gt; 'Soul',
+			43   =&gt; 'Punk',
+			44   =&gt; 'Space',
+			45   =&gt; 'Meditative',
+			46   =&gt; 'Instrumental Pop',
+			47   =&gt; 'Instrumental Rock',
+			48   =&gt; 'Ethnic',
+			49   =&gt; 'Gothic',
+			50   =&gt; 'Darkwave',
+			51   =&gt; 'Techno-Industrial',
+			52   =&gt; 'Electronic',
+			53   =&gt; 'Pop-Folk',
+			54   =&gt; 'Eurodance',
+			55   =&gt; 'Dream',
+			56   =&gt; 'Southern Rock',
+			57   =&gt; 'Comedy',
+			58   =&gt; 'Cult',
+			59   =&gt; 'Gangsta Rap',
+			60   =&gt; 'Top 40',
+			61   =&gt; 'Christian Rap',
+			62   =&gt; 'Pop/Funk',
+			63   =&gt; 'Jungle',
+			64   =&gt; 'Native American',
+			65   =&gt; 'Cabaret',
+			66   =&gt; 'New Wave',
+			67   =&gt; 'Psychedelic',
+			68   =&gt; 'Rave',
+			69   =&gt; 'Showtunes',
+			70   =&gt; 'Trailer',
+			71   =&gt; 'Lo-Fi',
+			72   =&gt; 'Tribal',
+			73   =&gt; 'Acid Punk',
+			74   =&gt; 'Acid Jazz',
+			75   =&gt; 'Polka',
+			76   =&gt; 'Retro',
+			77   =&gt; 'Musical',
+			78   =&gt; 'Rock &amp; Roll',
+			79   =&gt; 'Hard Rock',
+			80   =&gt; 'Folk',
+			81   =&gt; 'Folk/Rock',
+			82   =&gt; 'National Folk',
+			83   =&gt; 'Swing',
+			84   =&gt; 'Fast-Fusion',
+			85   =&gt; 'Bebob',
+			86   =&gt; 'Latin',
+			87   =&gt; 'Revival',
+			88   =&gt; 'Celtic',
+			89   =&gt; 'Bluegrass',
+			90   =&gt; 'Avantgarde',
+			91   =&gt; 'Gothic Rock',
+			92   =&gt; 'Progressive Rock',
+			93   =&gt; 'Psychedelic Rock',
+			94   =&gt; 'Symphonic Rock',
+			95   =&gt; 'Slow Rock',
+			96   =&gt; 'Big Band',
+			97   =&gt; 'Chorus',
+			98   =&gt; 'Easy Listening',
+			99   =&gt; 'Acoustic',
+			100  =&gt; 'Humour',
+			101  =&gt; 'Speech',
+			102  =&gt; 'Chanson',
+			103  =&gt; 'Opera',
+			104  =&gt; 'Chamber Music',
+			105  =&gt; 'Sonata',
+			106  =&gt; 'Symphony',
+			107  =&gt; 'Booty Bass',
+			108  =&gt; 'Primus',
+			109  =&gt; 'Porn Groove',
+			110  =&gt; 'Satire',
+			111  =&gt; 'Slow Jam',
+			112  =&gt; 'Club',
+			113  =&gt; 'Tango',
+			114  =&gt; 'Samba',
+			115  =&gt; 'Folklore',
+			116  =&gt; 'Ballad',
+			117  =&gt; 'Power Ballad',
+			118  =&gt; 'Rhythmic Soul',
+			119  =&gt; 'Freestyle',
+			120  =&gt; 'Duet',
+			121  =&gt; 'Punk Rock',
+			122  =&gt; 'Drum Solo',
+			123  =&gt; 'A Cappella',
+			124  =&gt; 'Euro-House',
+			125  =&gt; 'Dance Hall',
+			126  =&gt; 'Goa',
+			127  =&gt; 'Drum &amp; Bass',
+			128  =&gt; 'Club-House',
+			129  =&gt; 'Hardcore',
+			130  =&gt; 'Terror',
+			131  =&gt; 'Indie',
+			132  =&gt; 'BritPop',
+			133  =&gt; 'Negerpunk',
+			134  =&gt; 'Polsk Punk',
+			135  =&gt; 'Beat',
+			136  =&gt; 'Christian Gangsta Rap',
+			137  =&gt; 'Heavy Metal',
+			138  =&gt; 'Black Metal',
+			139  =&gt; 'Crossover',
+			140  =&gt; 'Contemporary Christian',
+			141  =&gt; 'Christian Rock',
+			142  =&gt; 'Merengue',
+			143  =&gt; 'Salsa',
+			144  =&gt; 'Trash Metal',
+			145  =&gt; 'Anime',
+			146  =&gt; 'JPop',
+			147  =&gt; 'Synthpop',
+
+			255  =&gt; 'Unknown',
+
+			'CR' =&gt; 'Cover',
+			'RX' =&gt; 'Remix'
+		);
+
+		static $GenreLookupSCMPX = array();
+		if ($allowSCMPXextended &amp;&amp; empty($GenreLookupSCMPX)) {
+			$GenreLookupSCMPX = $GenreLookup;
+			// <A HREF="http://www.geocities.co.jp/SiliconValley-Oakland/3664/alittle.html#GenreExtended">http://www.geocities.co.jp/SiliconValley-Oakland/3664/alittle.html#GenreExtended</A>
+			// Extended ID3v1 genres invented by SCMPX
+			// Note that 255 &quot;Japanese Anime&quot; conflicts with standard &quot;Unknown&quot;
+			$GenreLookupSCMPX[240] = 'Sacred';
+			$GenreLookupSCMPX[241] = 'Northern Europe';
+			$GenreLookupSCMPX[242] = 'Irish &amp; Scottish';
+			$GenreLookupSCMPX[243] = 'Scotland';
+			$GenreLookupSCMPX[244] = 'Ethnic Europe';
+			$GenreLookupSCMPX[245] = 'Enka';
+			$GenreLookupSCMPX[246] = 'Children\'s Song';
+			$GenreLookupSCMPX[247] = 'Japanese Sky';
+			$GenreLookupSCMPX[248] = 'Japanese Heavy Rock';
+			$GenreLookupSCMPX[249] = 'Japanese Doom Rock';
+			$GenreLookupSCMPX[250] = 'Japanese J-POP';
+			$GenreLookupSCMPX[251] = 'Japanese Seiyu';
+			$GenreLookupSCMPX[252] = 'Japanese Ambient Techno';
+			$GenreLookupSCMPX[253] = 'Japanese Moemoe';
+			$GenreLookupSCMPX[254] = 'Japanese Tokusatsu';
+			//$GenreLookupSCMPX[255] = 'Japanese Anime';
+		}
+
+		return ($allowSCMPXextended ? $GenreLookupSCMPX : $GenreLookup);
+	}
+
+	function LookupGenreName($genreid, $allowSCMPXextended=true) {
+		switch ($genreid) {
+			case 'RX':
+			case 'CR':
+				break;
+			default:
+				$genreid = intval($genreid); // to handle 3 or '3' or '03'
+				break;
+		}
+		$GenreLookup = getid3_id3v1::ArrayOfGenres($allowSCMPXextended);
+		return (isset($GenreLookup[$genreid]) ? $GenreLookup[$genreid] : false);
+	}
+
+	function LookupGenreID($genre, $allowSCMPXextended=false) {
+		$GenreLookup = getid3_id3v1::ArrayOfGenres($allowSCMPXextended);
+		$LowerCaseNoSpaceSearchTerm = strtolower(str_replace(' ', '', $genre));
+		foreach ($GenreLookup as $key =&gt; $value) {
+			foreach ($GenreLookup as $key =&gt; $value) {
+				if (strtolower(str_replace(' ', '', $value)) == $LowerCaseNoSpaceSearchTerm) {
+					return $key;
+				}
+			}
+			return false;
+		}
+		return (isset($GenreLookup[$genreid]) ? $GenreLookup[$genreid] : false);
+	}
+
+	function StandardiseID3v1GenreName($OriginalGenre) {
+		if (($GenreID = getid3_id3v1::LookupGenreID($OriginalGenre)) !== false) {
+			return getid3_id3v1::LookupGenreName($GenreID);
+		}
+		return $OriginalGenre;
+	}
+
+	function GenerateID3v1Tag($title, $artist, $album, $year, $genreid, $comment, $track='') {
+		$ID3v1Tag  = 'TAG';
+		$ID3v1Tag .= str_pad(trim(substr($title,  0, 30)), 30, &quot;\x00&quot;, STR_PAD_RIGHT);
+		$ID3v1Tag .= str_pad(trim(substr($artist, 0, 30)), 30, &quot;\x00&quot;, STR_PAD_RIGHT);
+		$ID3v1Tag .= str_pad(trim(substr($album,  0, 30)), 30, &quot;\x00&quot;, STR_PAD_RIGHT);
+		$ID3v1Tag .= str_pad(trim(substr($year,   0,  4)),  4, &quot;\x00&quot;, STR_PAD_LEFT);
+		if (!empty($track) &amp;&amp; ($track &gt; 0) &amp;&amp; ($track &lt;= 255)) {
+			$ID3v1Tag .= str_pad(trim(substr($comment, 0, 28)), 28, &quot;\x00&quot;, STR_PAD_RIGHT);
+			$ID3v1Tag .= &quot;\x00&quot;;
+			if (gettype($track) == 'string') {
+				$track = (int) $track;
+			}
+			$ID3v1Tag .= chr($track);
+		} else {
+			$ID3v1Tag .= str_pad(trim(substr($comment, 0, 30)), 30, &quot;\x00&quot;, STR_PAD_RIGHT);
+		}
+		if (($genreid &lt; 0) || ($genreid &gt; 147)) {
+			$genreid = 255; // 'unknown' genre
+		}
+		switch (gettype($genreid)) {
+			case 'string':
+			case 'integer':
+				$ID3v1Tag .= chr(intval($genreid));
+				break;
+			default:
+				$ID3v1Tag .= chr(255); // 'unknown' genre
+				break;
+		}
+
+		return $ID3v1Tag;
+	}
+
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.tag.id3v1.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.tag.id3v2.php
===================================================================
--- trunk/inc/external/getid3/module.tag.id3v2.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.tag.id3v2.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,3040 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+///                                                            //
+// module.tag.id3v2.php                                        //
+// module for analyzing ID3v2 tags                             //
+// dependencies: module.tag.id3v1.php                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.tag.id3v1.php', __FILE__, true);
+
+class getid3_id3v2
+{
+
+	function getid3_id3v2(&amp;$fd, &amp;$ThisFileInfo, $StartingOffset=0) {
+		//    Overall tag structure:
+		//        +-----------------------------+
+		//        |      Header (10 bytes)      |
+		//        +-----------------------------+
+		//        |       Extended Header       |
+		//        | (variable length, OPTIONAL) |
+		//        +-----------------------------+
+		//        |   Frames (variable length)  |
+		//        +-----------------------------+
+		//        |           Padding           |
+		//        | (variable length, OPTIONAL) |
+		//        +-----------------------------+
+		//        | Footer (10 bytes, OPTIONAL) |
+		//        +-----------------------------+
+
+		//    Header
+		//        ID3v2/file identifier      &quot;ID3&quot;
+		//        ID3v2 version              $04 00
+		//        ID3v2 flags                (%ab000000 in v2.2, %abc00000 in v2.3, %abcd0000 in v2.4.x)
+		//        ID3v2 size             4 * %0xxxxxxx
+
+
+		// shortcuts
+		$ThisFileInfo['id3v2']['header'] = true;
+		$thisfile_id3v2                  = &amp;$ThisFileInfo['id3v2'];
+		$thisfile_id3v2['flags']         =  array();
+		$thisfile_id3v2_flags            = &amp;$thisfile_id3v2['flags'];
+
+
+		fseek($fd, $StartingOffset, SEEK_SET);
+		$header = fread($fd, 10);
+		if (substr($header, 0, 3) == 'ID3') {
+
+			$thisfile_id3v2['majorversion'] = ord($header{3});
+			$thisfile_id3v2['minorversion'] = ord($header{4});
+
+			// shortcut
+			$id3v2_majorversion = &amp;$thisfile_id3v2['majorversion'];
+
+		} else {
+
+			unset($ThisFileInfo['id3v2']);
+			return false;
+
+		}
+
+		if ($id3v2_majorversion &gt; 4) { // this script probably won't correctly parse ID3v2.5.x and above (if it ever exists)
+
+			$ThisFileInfo['error'][] = 'this script only parses up to ID3v2.4.x - this tag is ID3v2.'.$id3v2_majorversion.'.'.$thisfile_id3v2['minorversion'];
+			return false;
+
+		}
+
+		$id3_flags = ord($header{5});
+		switch ($id3v2_majorversion) {
+			case 2:
+				// %ab000000 in v2.2
+				$thisfile_id3v2_flags['unsynch']     = (bool) ($id3_flags &amp; 0x80); // a - Unsynchronisation
+				$thisfile_id3v2_flags['compression'] = (bool) ($id3_flags &amp; 0x40); // b - Compression
+				break;
+
+			case 3:
+				// %abc00000 in v2.3
+				$thisfile_id3v2_flags['unsynch']     = (bool) ($id3_flags &amp; 0x80); // a - Unsynchronisation
+				$thisfile_id3v2_flags['exthead']     = (bool) ($id3_flags &amp; 0x40); // b - Extended header
+				$thisfile_id3v2_flags['experim']     = (bool) ($id3_flags &amp; 0x20); // c - Experimental indicator
+				break;
+
+			case 4:
+				// %abcd0000 in v2.4
+				$thisfile_id3v2_flags['unsynch']     = (bool) ($id3_flags &amp; 0x80); // a - Unsynchronisation
+				$thisfile_id3v2_flags['exthead']     = (bool) ($id3_flags &amp; 0x40); // b - Extended header
+				$thisfile_id3v2_flags['experim']     = (bool) ($id3_flags &amp; 0x20); // c - Experimental indicator
+				$thisfile_id3v2_flags['isfooter']    = (bool) ($id3_flags &amp; 0x10); // d - Footer present
+				break;
+		}
+
+		$thisfile_id3v2['headerlength'] = getid3_lib::BigEndian2Int(substr($header, 6, 4), 1) + 10; // length of ID3v2 tag in 10-byte header doesn't include 10-byte header length
+
+		$thisfile_id3v2['tag_offset_start'] = $StartingOffset;
+		$thisfile_id3v2['tag_offset_end']   = $thisfile_id3v2['tag_offset_start'] + $thisfile_id3v2['headerlength'];
+
+	//    Extended Header
+		if (isset($thisfile_id3v2_flags['exthead']) &amp;&amp; $thisfile_id3v2_flags['exthead']) {
+	//            Extended header size   4 * %0xxxxxxx
+	//            Number of flag bytes       $01
+	//            Extended Flags             $xx
+	//            Where the 'Extended header size' is the size of the whole extended header, stored as a 32 bit synchsafe integer.
+			$extheader = fread ($fd, 4);
+			$thisfile_id3v2['extheaderlength'] = getid3_lib::BigEndian2Int($extheader, 1);
+
+	//            The extended flags field, with its size described by 'number of flag  bytes', is defined as:
+	//                %0bcd0000
+	//            b - Tag is an update
+	//                Flag data length       $00
+	//            c - CRC data present
+	//                Flag data length       $05
+	//                Total frame CRC    5 * %0xxxxxxx
+	//            d - Tag restrictions
+	//                Flag data length       $01
+			$extheaderflagbytes = fread ($fd, 1);
+			$extheaderflags     = fread ($fd, $extheaderflagbytes);
+			$id3_exthead_flags = getid3_lib::BigEndian2Bin(substr($header, 5, 1));
+			$thisfile_id3v2['exthead_flags']['update']       = substr($id3_exthead_flags, 1, 1);
+			$thisfile_id3v2['exthead_flags']['CRC']          = substr($id3_exthead_flags, 2, 1);
+			if ($thisfile_id3v2['exthead_flags']['CRC']) {
+				$extheaderrawCRC = fread ($fd, 5);
+				$thisfile_id3v2['exthead_flags']['CRC'] = getid3_lib::BigEndian2Int($extheaderrawCRC, 1);
+			}
+			$thisfile_id3v2['exthead_flags']['restrictions'] = substr($id3_exthead_flags, 3, 1);
+			if ($thisfile_id3v2['exthead_flags']['restrictions']) {
+				// Restrictions           %ppqrrstt
+				$extheaderrawrestrictions = fread ($fd, 1);
+				$thisfile_id3v2['exthead_flags']['restrictions_tagsize']  = (bindec('11000000') &amp; ord($extheaderrawrestrictions)) &gt;&gt; 6; // p - Tag size restrictions
+				$thisfile_id3v2['exthead_flags']['restrictions_textenc']  = (bindec('00100000') &amp; ord($extheaderrawrestrictions)) &gt;&gt; 5; // q - Text encoding restrictions
+				$thisfile_id3v2['exthead_flags']['restrictions_textsize'] = (bindec('00011000') &amp; ord($extheaderrawrestrictions)) &gt;&gt; 3; // r - Text fields size restrictions
+				$thisfile_id3v2['exthead_flags']['restrictions_imgenc']   = (bindec('00000100') &amp; ord($extheaderrawrestrictions)) &gt;&gt; 2; // s - Image encoding restrictions
+				$thisfile_id3v2['exthead_flags']['restrictions_imgsize']  = (bindec('00000011') &amp; ord($extheaderrawrestrictions)) &gt;&gt; 0; // t - Image size restrictions
+			}
+		} // end extended header
+
+
+
+		// create 'encoding' key - used by getid3::HandleAllTags()
+		// in ID3v2 every field can have it's own encoding type
+		// so force everything to UTF-8 so it can be handled consistantly
+		$thisfile_id3v2['encoding'] = 'UTF-8';
+
+
+	//    Frames
+
+	//        All ID3v2 frames consists of one frame header followed by one or more
+	//        fields containing the actual information. The header is always 10
+	//        bytes and laid out as follows:
+	//
+	//        Frame ID      $xx xx xx xx  (four characters)
+	//        Size      4 * %0xxxxxxx
+	//        Flags         $xx xx
+
+		$sizeofframes = $thisfile_id3v2['headerlength'] - 10; // not including 10-byte initial header
+		if (isset($thisfile_id3v2['extheaderlength'])) {
+			$sizeofframes -= $thisfile_id3v2['extheaderlength'];
+		}
+		if (isset($thisfile_id3v2_flags['isfooter']) &amp;&amp; $thisfile_id3v2_flags['isfooter']) {
+			$sizeofframes -= 10; // footer takes last 10 bytes of ID3v2 header, after frame data, before audio
+		}
+		if ($sizeofframes &gt; 0) {
+
+			$framedata = fread($fd, $sizeofframes); // read all frames from file into $framedata variable
+			
+			//    if entire frame data is unsynched, de-unsynch it now (ID3v2.3.x)
+			if (isset($thisfile_id3v2_flags['unsynch']) &amp;&amp; $thisfile_id3v2_flags['unsynch'] &amp;&amp; ($id3v2_majorversion &lt;= 3)) {
+				$framedata = $this-&gt;DeUnsynchronise($framedata);
+			}
+			//        [in ID3v2.4.0] Unsynchronisation [S:6.1] is done on frame level, instead
+			//        of on tag level, making it easier to skip frames, increasing the streamability
+			//        of the tag. The unsynchronisation flag in the header [S:3.1] indicates that
+			//        there exists an unsynchronised frame, while the new unsynchronisation flag in
+			//        the frame header [S:4.1.2] indicates unsynchronisation.
+
+			$framedataoffset = 10; // how many bytes into the stream - start from after the 10-byte header
+			while (isset($framedata) &amp;&amp; (strlen($framedata) &gt; 0)) { // cycle through until no more frame data is left to parse
+				if (strlen($framedata) &lt;= $this-&gt;ID3v2HeaderLength($id3v2_majorversion)) {
+					// insufficient room left in ID3v2 header for actual data - must be padding
+					$thisfile_id3v2['padding']['start']  = $framedataoffset;
+					$thisfile_id3v2['padding']['length'] = strlen($framedata);
+					$thisfile_id3v2['padding']['valid']  = true;
+					for ($i = 0; $i &lt; $thisfile_id3v2['padding']['length']; $i++) {
+						if ($framedata{$i} != &quot;\x00&quot;) {
+							$thisfile_id3v2['padding']['valid'] = false;
+							$thisfile_id3v2['padding']['errorpos'] = $thisfile_id3v2['padding']['start'] + $i;
+							$ThisFileInfo['warning'][] = 'Invalid ID3v2 padding found at offset '.$thisfile_id3v2['padding']['errorpos'].' (the remaining '.($thisfile_id3v2['padding']['length'] - $i).' bytes are considered invalid)';
+							break;
+						}
+					}
+					break; // skip rest of ID3v2 header
+				}
+				if ($id3v2_majorversion == 2) {
+					// Frame ID  $xx xx xx (three characters)
+					// Size      $xx xx xx (24-bit integer)
+					// Flags     $xx xx
+
+					$frame_header = substr($framedata, 0, 6); // take next 6 bytes for header
+					$framedata    = substr($framedata, 6);    // and leave the rest in $framedata
+					$frame_name   = substr($frame_header, 0, 3);
+					$frame_size   = getid3_lib::BigEndian2Int(substr($frame_header, 3, 3), 0);
+					$frame_flags  = 0; // not used for anything in ID3v2.2, just set to avoid E_NOTICEs
+
+				} elseif ($id3v2_majorversion &gt; 2) {
+
+					// Frame ID  $xx xx xx xx (four characters)
+					// Size      $xx xx xx xx (32-bit integer in v2.3, 28-bit synchsafe in v2.4+)
+					// Flags     $xx xx
+
+					$frame_header = substr($framedata, 0, 10); // take next 10 bytes for header
+					$framedata    = substr($framedata, 10);    // and leave the rest in $framedata
+
+					$frame_name = substr($frame_header, 0, 4);
+					if ($id3v2_majorversion == 3) {
+						$frame_size = getid3_lib::BigEndian2Int(substr($frame_header, 4, 4), 0); // 32-bit integer
+					} else { // ID3v2.4+
+						$frame_size = getid3_lib::BigEndian2Int(substr($frame_header, 4, 4), 1); // 32-bit synchsafe integer (28-bit value)
+					}
+
+					if ($frame_size &lt; (strlen($framedata) + 4)) {
+						$nextFrameID = substr($framedata, $frame_size, 4);
+						if ($this-&gt;IsValidID3v2FrameName($nextFrameID, $id3v2_majorversion)) {
+							// next frame is OK
+						} elseif (($frame_name == &quot;\x00&quot;.'MP3') || ($frame_name == &quot;\x00\x00&quot;.'MP') || ($frame_name == ' MP3') || ($frame_name == 'MP3e')) {
+							// MP3ext known broken frames - &quot;ok&quot; for the purposes of this test
+						} elseif (($id3v2_majorversion == 4) &amp;&amp; ($this-&gt;IsValidID3v2FrameName(substr($framedata, getid3_lib::BigEndian2Int(substr($frame_header, 4, 4), 0), 4), 3))) {
+							$ThisFileInfo['warning'][] = 'ID3v2 tag written as ID3v2.4, but with non-synchsafe integers (ID3v2.3 style). Older versions of Helium2 (www.helium2.com) is a known culprit of this. Tag has been parsed as ID3v2.3';
+							$id3v2_majorversion = 3;
+							$frame_size = getid3_lib::BigEndian2Int(substr($frame_header, 4, 4), 0); // 32-bit integer
+						}
+					}
+
+
+					$frame_flags = getid3_lib::BigEndian2Int(substr($frame_header, 8, 2));
+				}
+
+				if ((($id3v2_majorversion == 2) &amp;&amp; ($frame_name == &quot;\x00\x00\x00&quot;)) || ($frame_name == &quot;\x00\x00\x00\x00&quot;)) {
+					// padding encountered
+
+					$thisfile_id3v2['padding']['start']  = $framedataoffset;
+					$thisfile_id3v2['padding']['length'] = strlen($framedata);
+					$thisfile_id3v2['padding']['valid']  = true;
+					for ($i = 0; $i &lt; $thisfile_id3v2['padding']['length']; $i++) {
+						if ($framedata{$i} != &quot;\x00&quot;) {
+							$thisfile_id3v2['padding']['valid'] = false;
+							$thisfile_id3v2['padding']['errorpos'] = $thisfile_id3v2['padding']['start'] + $i;
+							$ThisFileInfo['warning'][] = 'Invalid ID3v2 padding found at offset '.$thisfile_id3v2['padding']['errorpos'].' (the remaining '.($thisfile_id3v2['padding']['length'] - $i).' bytes are considered invalid)';
+							break;
+						}
+					}
+					break; // skip rest of ID3v2 header
+				}
+
+				if ($frame_name == 'COM ') {
+					$ThisFileInfo['warning'][] = 'error parsing &quot;'.$frame_name.'&quot; ('.$framedataoffset.' bytes into the ID3v2.'.$id3v2_majorversion.' tag). (ERROR: IsValidID3v2FrameName(&quot;'.str_replace(&quot;\x00&quot;, ' ', $frame_name).'&quot;, '.$id3v2_majorversion.'))). [Note: this particular error has been known to happen with tags edited by iTunes (versions &quot;X v2.0.3&quot;, &quot;v3.0.1&quot; are known-guilty, probably others too)]';
+					$frame_name = 'COMM';
+				}
+				if (($frame_size &lt;= strlen($framedata)) &amp;&amp; ($this-&gt;IsValidID3v2FrameName($frame_name, $id3v2_majorversion))) {
+
+					unset($parsedFrame);
+					$parsedFrame['frame_name']      = $frame_name;
+					$parsedFrame['frame_flags_raw'] = $frame_flags;
+					$parsedFrame['data']            = substr($framedata, 0, $frame_size);
+					$parsedFrame['datalength']      = getid3_lib::CastAsInt($frame_size);
+					$parsedFrame['dataoffset']      = $framedataoffset;
+
+					$this-&gt;ParseID3v2Frame($parsedFrame, $ThisFileInfo);
+					$thisfile_id3v2[$frame_name][] = $parsedFrame;
+
+					$framedata = substr($framedata, $frame_size);
+
+				} else { // invalid frame length or FrameID
+
+					if ($frame_size &lt;= strlen($framedata)) {
+
+						if ($this-&gt;IsValidID3v2FrameName(substr($framedata, $frame_size, 4), $id3v2_majorversion)) {
+
+							// next frame is valid, just skip the current frame
+							$framedata = substr($framedata, $frame_size);
+							$ThisFileInfo['warning'][] = 'Next ID3v2 frame is valid, skipping current frame.';
+
+						} else {
+
+							// next frame is invalid too, abort processing
+							unset($framedata);
+							$ThisFileInfo['error'][] = 'Next ID3v2 frame is also invalid, aborting processing.';
+
+						}
+
+					} elseif ($frame_size == strlen($framedata)) {
+
+						// this is the last frame, just skip
+						$ThisFileInfo['warning'][] = 'This was the last ID3v2 frame.';
+
+					} else {
+
+						// next frame is invalid too, abort processing
+						unset($framedata);
+						$ThisFileInfo['warning'][] = 'Invalid ID3v2 frame size, aborting.';
+
+					}
+					if (!$this-&gt;IsValidID3v2FrameName($frame_name, $id3v2_majorversion)) {
+
+						switch ($frame_name) {
+							case &quot;\x00\x00&quot;.'MP':
+							case &quot;\x00&quot;.'MP3':
+							case ' MP3':
+							case 'MP3e':
+							case &quot;\x00&quot;.'MP':
+							case ' MP':
+							case 'MP3':
+								$ThisFileInfo['warning'][] = 'error parsing &quot;'.$frame_name.'&quot; ('.$framedataoffset.' bytes into the ID3v2.'.$id3v2_majorversion.' tag). (ERROR: !IsValidID3v2FrameName(&quot;'.str_replace(&quot;\x00&quot;, ' ', $frame_name).'&quot;, '.$id3v2_majorversion.'))). [Note: this particular error has been known to happen with tags edited by &quot;MP3ext (www.mutschler.de/mp3ext/)&quot;]';
+								break;
+
+							default:
+								$ThisFileInfo['warning'][] = 'error parsing &quot;'.$frame_name.'&quot; ('.$framedataoffset.' bytes into the ID3v2.'.$id3v2_majorversion.' tag). (ERROR: !IsValidID3v2FrameName(&quot;'.str_replace(&quot;\x00&quot;, ' ', $frame_name).'&quot;, '.$id3v2_majorversion.'))).';
+								break;
+						}
+
+					} elseif ($frame_size &gt; strlen($framedata)){
+
+						$ThisFileInfo['error'][] = 'error parsing &quot;'.$frame_name.'&quot; ('.$framedataoffset.' bytes into the ID3v2.'.$id3v2_majorversion.' tag). (ERROR: $frame_size ('.$frame_size.') &gt; strlen($framedata) ('.strlen($framedata).')).';
+
+					} else {
+
+						$ThisFileInfo['error'][] = 'error parsing &quot;'.$frame_name.'&quot; ('.$framedataoffset.' bytes into the ID3v2.'.$id3v2_majorversion.' tag).';
+
+					}
+
+				}
+				$framedataoffset += ($frame_size + $this-&gt;ID3v2HeaderLength($id3v2_majorversion));
+
+			}
+
+		}
+
+
+	//    Footer
+
+	//    The footer is a copy of the header, but with a different identifier.
+	//        ID3v2 identifier           &quot;3DI&quot;
+	//        ID3v2 version              $04 00
+	//        ID3v2 flags                %abcd0000
+	//        ID3v2 size             4 * %0xxxxxxx
+
+		if (isset($thisfile_id3v2_flags['isfooter']) &amp;&amp; $thisfile_id3v2_flags['isfooter']) {
+			$footer = fread ($fd, 10);
+			if (substr($footer, 0, 3) == '3DI') {
+				$thisfile_id3v2['footer'] = true;
+				$thisfile_id3v2['majorversion_footer'] = ord($footer{3});
+				$thisfile_id3v2['minorversion_footer'] = ord($footer{4});
+			}
+			if ($thisfile_id3v2['majorversion_footer'] &lt;= 4) {
+				$id3_flags = ord(substr($footer{5}));
+				$thisfile_id3v2_flags['unsynch_footer']  = (bool) ($id3_flags &amp; 0x80);
+				$thisfile_id3v2_flags['extfoot_footer']  = (bool) ($id3_flags &amp; 0x40);
+				$thisfile_id3v2_flags['experim_footer']  = (bool) ($id3_flags &amp; 0x20);
+				$thisfile_id3v2_flags['isfooter_footer'] = (bool) ($id3_flags &amp; 0x10);
+
+				$thisfile_id3v2['footerlength'] = getid3_lib::BigEndian2Int(substr($footer, 6, 4), 1);
+			}
+		} // end footer
+
+		if (isset($thisfile_id3v2['comments']['genre'])) {
+			foreach ($thisfile_id3v2['comments']['genre'] as $key =&gt; $value) {
+				unset($thisfile_id3v2['comments']['genre'][$key]);
+				$thisfile_id3v2['comments'] = getid3_lib::array_merge_noclobber($thisfile_id3v2['comments'], $this-&gt;ParseID3v2GenreString($value));
+			}
+		}
+
+		if (isset($thisfile_id3v2['comments']['track'])) {
+			foreach ($thisfile_id3v2['comments']['track'] as $key =&gt; $value) {
+				if (strstr($value, '/')) {
+					list($thisfile_id3v2['comments']['track'][$key], $thisfile_id3v2['comments']['totaltracks'][$key]) = explode('/', $thisfile_id3v2['comments']['track'][$key]);
+				}
+			}
+		}
+
+
+		// Set avdataoffset
+		$ThisFileInfo['avdataoffset'] = $thisfile_id3v2['headerlength'];
+		if (isset($thisfile_id3v2['footer'])) {
+			$ThisFileInfo['avdataoffset'] += 10;
+		}
+
+		return true;
+	}
+
+
+	function ParseID3v2GenreString($genrestring) {
+		// Parse genres into arrays of genreName and genreID
+		// ID3v2.2.x, ID3v2.3.x: '(21)' or '(4)Eurodisco' or '(51)(39)' or '(55)((I think...)'
+		// ID3v2.4.x: '21' $00 'Eurodisco' $00
+
+		$genrestring = trim($genrestring);
+		$returnarray = array();
+		if (strpos($genrestring, &quot;\x00&quot;) !== false) {
+			$unprocessed = trim($genrestring); // trailing nulls will cause an infinite loop.
+			$genrestring = '';
+			while (strpos($unprocessed, &quot;\x00&quot;) !== false) {
+				// convert null-seperated v2.4-format into v2.3 ()-seperated format
+				$endpos = strpos($unprocessed, &quot;\x00&quot;);
+				$genrestring .= '('.substr($unprocessed, 0, $endpos).')';
+				$unprocessed = substr($unprocessed, $endpos + 1);
+			}
+			unset($unprocessed);
+		}
+		if (getid3_id3v1::LookupGenreID($genrestring)) {
+
+			$returnarray['genre'][] = $genrestring;
+
+		} else {
+
+			while (strpos($genrestring, '(') !== false) {
+
+				$startpos = strpos($genrestring, '(');
+				$endpos   = strpos($genrestring, ')');
+				if (substr($genrestring, $startpos + 1, 1) == '(') {
+					$genrestring = substr($genrestring, 0, $startpos).substr($genrestring, $startpos + 1);
+					$endpos--;
+				}
+				$element     = substr($genrestring, $startpos + 1, $endpos - ($startpos + 1));
+				$genrestring = substr($genrestring, 0, $startpos).substr($genrestring, $endpos + 1);
+				if (getid3_id3v1::LookupGenreName($element)) { // $element is a valid genre id/abbreviation
+
+					if (empty($returnarray['genre']) || !in_array(getid3_id3v1::LookupGenreName($element), $returnarray['genre'])) { // avoid duplicate entires
+						$returnarray['genre'][] = getid3_id3v1::LookupGenreName($element);
+					}
+
+				} else {
+
+					if (empty($returnarray['genre']) || !in_array($element, $returnarray['genre'])) { // avoid duplicate entires
+						$returnarray['genre'][] = $element;
+					}
+
+				}
+			}
+		}
+		if ($genrestring) {
+			if (empty($returnarray['genre']) || !in_array($genrestring, $returnarray['genre'])) { // avoid duplicate entires
+				$returnarray['genre'][]   = $genrestring;
+			}
+		}
+
+		return $returnarray;
+	}
+
+
+	function ParseID3v2Frame(&amp;$parsedFrame, &amp;$ThisFileInfo) {
+
+		// shortcuts
+		$id3v2_majorversion = $ThisFileInfo['id3v2']['majorversion'];
+
+		$parsedFrame['framenamelong']  = $this-&gt;FrameNameLongLookup($parsedFrame['frame_name']);
+		if (empty($parsedFrame['framenamelong'])) {
+			unset($parsedFrame['framenamelong']);
+		}
+		$parsedFrame['framenameshort'] = $this-&gt;FrameNameShortLookup($parsedFrame['frame_name']);
+		if (empty($parsedFrame['framenameshort'])) {
+			unset($parsedFrame['framenameshort']);
+		}
+
+		if ($id3v2_majorversion &gt;= 3) { // frame flags are not part of the ID3v2.2 standard
+			if ($id3v2_majorversion == 3) {
+				//    Frame Header Flags
+				//    %abc00000 %ijk00000
+				$parsedFrame['flags']['TagAlterPreservation']  = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x8000); // a - Tag alter preservation
+				$parsedFrame['flags']['FileAlterPreservation'] = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x4000); // b - File alter preservation
+				$parsedFrame['flags']['ReadOnly']              = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x2000); // c - Read only
+				$parsedFrame['flags']['compression']           = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x0080); // i - Compression
+				$parsedFrame['flags']['Encryption']            = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x0040); // j - Encryption
+				$parsedFrame['flags']['GroupingIdentity']      = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x0020); // k - Grouping identity
+
+			} elseif ($id3v2_majorversion == 4) {
+				//    Frame Header Flags
+				//    %0abc0000 %0h00kmnp
+				$parsedFrame['flags']['TagAlterPreservation']  = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x4000); // a - Tag alter preservation
+				$parsedFrame['flags']['FileAlterPreservation'] = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x2000); // b - File alter preservation
+				$parsedFrame['flags']['ReadOnly']              = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x1000); // c - Read only
+				$parsedFrame['flags']['GroupingIdentity']      = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x0040); // h - Grouping identity
+				$parsedFrame['flags']['compression']           = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x0008); // k - Compression
+				$parsedFrame['flags']['Encryption']            = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x0004); // m - Encryption
+				$parsedFrame['flags']['Unsynchronisation']     = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x0002); // n - Unsynchronisation
+				$parsedFrame['flags']['DataLengthIndicator']   = (bool) ($parsedFrame['frame_flags_raw'] &amp; 0x0001); // p - Data length indicator
+
+				// Frame-level de-unsynchronisation - ID3v2.4
+				if ($parsedFrame['flags']['Unsynchronisation']) {
+					$parsedFrame['data'] = $this-&gt;DeUnsynchronise($parsedFrame['data']);
+				}
+			}
+
+			//    Frame-level de-compression
+			if ($parsedFrame['flags']['compression']) {
+				$parsedFrame['decompressed_size'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], 0, 4));
+				if (!function_exists('gzuncompress')) {
+					$ThisFileInfo['warning'][] = 'gzuncompress() support required to decompress ID3v2 frame &quot;'.$parsedFrame['frame_name'].'&quot;';
+				} elseif ($decompresseddata = @gzuncompress(substr($parsedFrame['data'], 4))) {
+					$parsedFrame['data'] = $decompresseddata;
+				} else {
+					$ThisFileInfo['warning'][] = 'gzuncompress() failed on compressed contents of ID3v2 frame &quot;'.$parsedFrame['frame_name'].'&quot;';
+				}
+			}
+		}
+
+		if (isset($parsedFrame['datalength']) &amp;&amp; ($parsedFrame['datalength'] == 0)) {
+
+			$warning = 'Frame &quot;'.$parsedFrame['frame_name'].'&quot; at offset '.$parsedFrame['dataoffset'].' has no data portion';
+			switch ($parsedFrame['frame_name']) {
+				case 'WCOM':
+					$warning .= ' (this is known to happen with files tagged by RioPort)';
+					break;
+
+				default:
+					break;
+			}
+			$ThisFileInfo['warning'][] = $warning;
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'UFID')) || // 4.1   UFID Unique file identifier
+			(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'UFI'))) {  // 4.1   UFI  Unique file identifier
+			//   There may be more than one 'UFID' frame in a tag,
+			//   but only one with the same 'Owner identifier'.
+			// &lt;Header for 'Unique file identifier', ID: 'UFID'&gt;
+			// Owner identifier        &lt;text string&gt; $00
+			// Identifier              &lt;up to 64 bytes binary data&gt;
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;);
+			$frame_idstring = substr($parsedFrame['data'], 0, $frame_terminatorpos);
+			$parsedFrame['ownerid'] = $frame_idstring;
+			$parsedFrame['data'] = substr($parsedFrame['data'], $frame_terminatorpos + strlen(&quot;\x00&quot;));
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'TXXX')) || // 4.2.2 TXXX User defined text information frame
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'TXX'))) {    // 4.2.2 TXX  User defined text information frame
+			//   There may be more than one 'TXXX' frame in each tag,
+			//   but only one with the same description.
+			// &lt;Header for 'User defined text information frame', ID: 'TXXX'&gt;
+			// Text encoding     $xx
+			// Description       &lt;text string according to encoding&gt; $00 (00)
+			// Value             &lt;text string according to encoding&gt;
+
+			$frame_offset = 0;
+			$frame_textencoding = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+
+			if ((($id3v2_majorversion &lt;= 3) &amp;&amp; ($frame_textencoding &gt; 1)) || (($id3v2_majorversion == 4) &amp;&amp; ($frame_textencoding &gt; 3))) {
+				$ThisFileInfo['warning'][] = 'Invalid text encoding byte ('.$frame_textencoding.') in frame &quot;'.$parsedFrame['frame_name'].'&quot; - defaulting to ISO-8859-1 encoding';
+			}
+			$frame_terminatorpos = strpos($parsedFrame['data'], $this-&gt;TextEncodingTerminatorLookup($frame_textencoding), $frame_offset);
+			if (ord(substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)), 1)) === 0) {
+				$frame_terminatorpos++; // strpos() fooled because 2nd byte of Unicode chars are often 0x00
+			}
+			$frame_description = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_description) === 0) {
+				$frame_description = '';
+			}
+			$parsedFrame['encodingid']  = $frame_textencoding;
+			$parsedFrame['encoding']    = $this-&gt;TextEncodingNameLookup($frame_textencoding);
+
+			$parsedFrame['description'] = $frame_description;
+			$parsedFrame['data'] = substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)));
+			if (!empty($parsedFrame['framenameshort']) &amp;&amp; !empty($parsedFrame['data'])) {
+				$ThisFileInfo['id3v2']['comments'][$parsedFrame['framenameshort']][] = trim(getid3_lib::iconv_fallback($parsedFrame['encoding'], $ThisFileInfo['id3v2']['encoding'], $parsedFrame['data']));
+			}
+			unset($parsedFrame['data']);
+
+
+		} elseif ($parsedFrame['frame_name']{0} == 'T') { // 4.2. T??[?] Text information frame
+			//   There may only be one text information frame of its kind in an tag.
+			// &lt;Header for 'Text information frame', ID: 'T000' - 'TZZZ',
+			// excluding 'TXXX' described in 4.2.6.&gt;
+			// Text encoding                $xx
+			// Information                  &lt;text string(s) according to encoding&gt;
+
+			$frame_offset = 0;
+			$frame_textencoding = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			if ((($id3v2_majorversion &lt;= 3) &amp;&amp; ($frame_textencoding &gt; 1)) || (($id3v2_majorversion == 4) &amp;&amp; ($frame_textencoding &gt; 3))) {
+				$ThisFileInfo['warning'][] = 'Invalid text encoding byte ('.$frame_textencoding.') in frame &quot;'.$parsedFrame['frame_name'].'&quot; - defaulting to ISO-8859-1 encoding';
+			}
+
+			$parsedFrame['data'] = (string) substr($parsedFrame['data'], $frame_offset);
+
+			$parsedFrame['encodingid'] = $frame_textencoding;
+			$parsedFrame['encoding']   = $this-&gt;TextEncodingNameLookup($frame_textencoding);
+
+			if (!empty($parsedFrame['framenameshort']) &amp;&amp; !empty($parsedFrame['data'])) {
+				$ThisFileInfo['id3v2']['comments'][$parsedFrame['framenameshort']][] = getid3_lib::iconv_fallback($parsedFrame['encoding'], $ThisFileInfo['id3v2']['encoding'], $parsedFrame['data']);
+			}
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'WXXX')) || // 4.3.2 WXXX User defined URL link frame
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'WXX'))) {    // 4.3.2 WXX  User defined URL link frame
+			//   There may be more than one 'WXXX' frame in each tag,
+			//   but only one with the same description
+			// &lt;Header for 'User defined URL link frame', ID: 'WXXX'&gt;
+			// Text encoding     $xx
+			// Description       &lt;text string according to encoding&gt; $00 (00)
+			// URL               &lt;text string&gt;
+
+			$frame_offset = 0;
+			$frame_textencoding = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			if ((($id3v2_majorversion &lt;= 3) &amp;&amp; ($frame_textencoding &gt; 1)) || (($id3v2_majorversion == 4) &amp;&amp; ($frame_textencoding &gt; 3))) {
+				$ThisFileInfo['warning'][] = 'Invalid text encoding byte ('.$frame_textencoding.') in frame &quot;'.$parsedFrame['frame_name'].'&quot; - defaulting to ISO-8859-1 encoding';
+			}
+			$frame_terminatorpos = strpos($parsedFrame['data'], $this-&gt;TextEncodingTerminatorLookup($frame_textencoding), $frame_offset);
+			if (ord(substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)), 1)) === 0) {
+				$frame_terminatorpos++; // strpos() fooled because 2nd byte of Unicode chars are often 0x00
+			}
+			$frame_description = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+
+			if (ord($frame_description) === 0) {
+				$frame_description = '';
+			}
+			$parsedFrame['data'] = substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)));
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], $this-&gt;TextEncodingTerminatorLookup($frame_textencoding));
+			if (ord(substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)), 1)) === 0) {
+				$frame_terminatorpos++; // strpos() fooled because 2nd byte of Unicode chars are often 0x00
+			}
+			if ($frame_terminatorpos) {
+				// there are null bytes after the data - this is not according to spec
+				// only use data up to first null byte
+				$frame_urldata = (string) substr($parsedFrame['data'], 0, $frame_terminatorpos);
+			} else {
+				// no null bytes following data, just use all data
+				$frame_urldata = (string) $parsedFrame['data'];
+			}
+
+			$parsedFrame['encodingid']  = $frame_textencoding;
+			$parsedFrame['encoding']    = $this-&gt;TextEncodingNameLookup($frame_textencoding);
+
+			$parsedFrame['url']         = $frame_urldata;
+			$parsedFrame['description'] = $frame_description;
+			if (!empty($parsedFrame['framenameshort']) &amp;&amp; $parsedFrame['url']) {
+				$ThisFileInfo['id3v2']['comments'][$parsedFrame['framenameshort']][] = getid3_lib::iconv_fallback($parsedFrame['encoding'], $ThisFileInfo['id3v2']['encoding'], $parsedFrame['url']);
+			}
+			unset($parsedFrame['data']);
+
+
+		} elseif ($parsedFrame['frame_name']{0} == 'W') { // 4.3. W??? URL link frames
+			//   There may only be one URL link frame of its kind in a tag,
+			//   except when stated otherwise in the frame description
+			// &lt;Header for 'URL link frame', ID: 'W000' - 'WZZZ', excluding 'WXXX'
+			// described in 4.3.2.&gt;
+			// URL              &lt;text string&gt;
+
+			$parsedFrame['url'] = trim($parsedFrame['data']);
+			if (!empty($parsedFrame['framenameshort']) &amp;&amp; $parsedFrame['url']) {
+				$ThisFileInfo['id3v2']['comments'][$parsedFrame['framenameshort']][] = $parsedFrame['url'];
+			}
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion == 3) &amp;&amp; ($parsedFrame['frame_name'] == 'IPLS')) || // 4.4  IPLS Involved people list (ID3v2.3 only)
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'IPL'))) {     // 4.4  IPL  Involved people list (ID3v2.2 only)
+			//   There may only be one 'IPL' frame in each tag
+			// &lt;Header for 'User defined URL link frame', ID: 'IPL'&gt;
+			// Text encoding     $xx
+			// People list strings    &lt;textstrings&gt;
+
+			$frame_offset = 0;
+			$frame_textencoding = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			if ((($id3v2_majorversion &lt;= 3) &amp;&amp; ($frame_textencoding &gt; 1)) || (($id3v2_majorversion == 4) &amp;&amp; ($frame_textencoding &gt; 3))) {
+				$ThisFileInfo['warning'][] = 'Invalid text encoding byte ('.$frame_textencoding.') in frame &quot;'.$parsedFrame['frame_name'].'&quot; - defaulting to ISO-8859-1 encoding';
+			}
+			$parsedFrame['encodingid'] = $frame_textencoding;
+			$parsedFrame['encoding']   = $this-&gt;TextEncodingNameLookup($parsedFrame['encodingid']);
+
+			$parsedFrame['data']       = (string) substr($parsedFrame['data'], $frame_offset);
+			if (!empty($parsedFrame['framenameshort']) &amp;&amp; !empty($parsedFrame['data'])) {
+				$ThisFileInfo['id3v2']['comments'][$parsedFrame['framenameshort']][] = getid3_lib::iconv_fallback($parsedFrame['encoding'], $ThisFileInfo['id3v2']['encoding'], $parsedFrame['data']);
+			}
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'MCDI')) || // 4.4   MCDI Music CD identifier
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'MCI'))) {     // 4.5   MCI  Music CD identifier
+			//   There may only be one 'MCDI' frame in each tag
+			// &lt;Header for 'Music CD identifier', ID: 'MCDI'&gt;
+			// CD TOC                &lt;binary data&gt;
+
+			if (!empty($parsedFrame['framenameshort']) &amp;&amp; !empty($parsedFrame['data'])) {
+				$ThisFileInfo['id3v2']['comments'][$parsedFrame['framenameshort']][] = $parsedFrame['data'];
+			}
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'ETCO')) || // 4.5   ETCO Event timing codes
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'ETC'))) {     // 4.6   ETC  Event timing codes
+			//   There may only be one 'ETCO' frame in each tag
+			// &lt;Header for 'Event timing codes', ID: 'ETCO'&gt;
+			// Time stamp format    $xx
+			//   Where time stamp format is:
+			// $01  (32-bit value) MPEG frames from beginning of file
+			// $02  (32-bit value) milliseconds from beginning of file
+			//   Followed by a list of key events in the following format:
+			// Type of event   $xx
+			// Time stamp      $xx (xx ...)
+			//   The 'Time stamp' is set to zero if directly at the beginning of the sound
+			//   or after the previous event. All events MUST be sorted in chronological order.
+
+			$frame_offset = 0;
+			$parsedFrame['timestampformat'] = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+
+			while ($frame_offset &lt; strlen($parsedFrame['data'])) {
+				$parsedFrame['typeid']    = substr($parsedFrame['data'], $frame_offset++, 1);
+				$parsedFrame['type']      = $this-&gt;ETCOEventLookup($parsedFrame['typeid']);
+				$parsedFrame['timestamp'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, 4));
+				$frame_offset += 4;
+			}
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'MLLT')) || // 4.6   MLLT MPEG location lookup table
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'MLL'))) {     // 4.7   MLL MPEG location lookup table
+			//   There may only be one 'MLLT' frame in each tag
+			// &lt;Header for 'Location lookup table', ID: 'MLLT'&gt;
+			// MPEG frames between reference  $xx xx
+			// Bytes between reference        $xx xx xx
+			// Milliseconds between reference $xx xx xx
+			// Bits for bytes deviation       $xx
+			// Bits for milliseconds dev.     $xx
+			//   Then for every reference the following data is included;
+			// Deviation in bytes         %xxx....
+			// Deviation in milliseconds  %xxx....
+
+			$frame_offset = 0;
+			$parsedFrame['framesbetweenreferences'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], 0, 2));
+			$parsedFrame['bytesbetweenreferences']  = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], 2, 3));
+			$parsedFrame['msbetweenreferences']     = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], 5, 3));
+			$parsedFrame['bitsforbytesdeviation']   = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], 8, 1));
+			$parsedFrame['bitsformsdeviation']      = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], 9, 1));
+			$parsedFrame['data'] = substr($parsedFrame['data'], 10);
+			while ($frame_offset &lt; strlen($parsedFrame['data'])) {
+				$deviationbitstream .= getid3_lib::BigEndian2Bin(substr($parsedFrame['data'], $frame_offset++, 1));
+			}
+			$reference_counter = 0;
+			while (strlen($deviationbitstream) &gt; 0) {
+				$parsedFrame[$reference_counter]['bytedeviation'] = bindec(substr($deviationbitstream, 0, $parsedFrame['bitsforbytesdeviation']));
+				$parsedFrame[$reference_counter]['msdeviation']   = bindec(substr($deviationbitstream, $parsedFrame['bitsforbytesdeviation'], $parsedFrame['bitsformsdeviation']));
+				$deviationbitstream = substr($deviationbitstream, $parsedFrame['bitsforbytesdeviation'] + $parsedFrame['bitsformsdeviation']);
+				$reference_counter++;
+			}
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'SYTC')) || // 4.7   SYTC Synchronised tempo codes
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'STC'))) {     // 4.8   STC  Synchronised tempo codes
+			//   There may only be one 'SYTC' frame in each tag
+			// &lt;Header for 'Synchronised tempo codes', ID: 'SYTC'&gt;
+			// Time stamp format   $xx
+			// Tempo data          &lt;binary data&gt;
+			//   Where time stamp format is:
+			// $01  (32-bit value) MPEG frames from beginning of file
+			// $02  (32-bit value) milliseconds from beginning of file
+
+			$frame_offset = 0;
+			$parsedFrame['timestampformat'] = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$timestamp_counter = 0;
+			while ($frame_offset &lt; strlen($parsedFrame['data'])) {
+				$parsedFrame[$timestamp_counter]['tempo'] = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+				if ($parsedFrame[$timestamp_counter]['tempo'] == 255) {
+					$parsedFrame[$timestamp_counter]['tempo'] += ord(substr($parsedFrame['data'], $frame_offset++, 1));
+				}
+				$parsedFrame[$timestamp_counter]['timestamp'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, 4));
+				$frame_offset += 4;
+				$timestamp_counter++;
+			}
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'USLT')) || // 4.8   USLT Unsynchronised lyric/text transcription
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'ULT'))) {     // 4.9   ULT  Unsynchronised lyric/text transcription
+			//   There may be more than one 'Unsynchronised lyrics/text transcription' frame
+			//   in each tag, but only one with the same language and content descriptor.
+			// &lt;Header for 'Unsynchronised lyrics/text transcription', ID: 'USLT'&gt;
+			// Text encoding        $xx
+			// Language             $xx xx xx
+			// Content descriptor   &lt;text string according to encoding&gt; $00 (00)
+			// Lyrics/text          &lt;full text string according to encoding&gt;
+
+			$frame_offset = 0;
+			$frame_textencoding = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			if ((($id3v2_majorversion &lt;= 3) &amp;&amp; ($frame_textencoding &gt; 1)) || (($id3v2_majorversion == 4) &amp;&amp; ($frame_textencoding &gt; 3))) {
+				$ThisFileInfo['warning'][] = 'Invalid text encoding byte ('.$frame_textencoding.') in frame &quot;'.$parsedFrame['frame_name'].'&quot; - defaulting to ISO-8859-1 encoding';
+			}
+			$frame_language = substr($parsedFrame['data'], $frame_offset, 3);
+			$frame_offset += 3;
+			$frame_terminatorpos = strpos($parsedFrame['data'], $this-&gt;TextEncodingTerminatorLookup($frame_textencoding), $frame_offset);
+			if (ord(substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)), 1)) === 0) {
+				$frame_terminatorpos++; // strpos() fooled because 2nd byte of Unicode chars are often 0x00
+			}
+			$frame_description = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_description) === 0) {
+				$frame_description = '';
+			}
+			$parsedFrame['data'] = substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)));
+
+			$parsedFrame['encodingid']   = $frame_textencoding;
+			$parsedFrame['encoding']     = $this-&gt;TextEncodingNameLookup($frame_textencoding);
+
+			$parsedFrame['data']         = $parsedFrame['data'];
+			$parsedFrame['language']     = $frame_language;
+			$parsedFrame['languagename'] = $this-&gt;LanguageLookup($frame_language, false);
+			$parsedFrame['description']  = $frame_description;
+			if (!empty($parsedFrame['framenameshort']) &amp;&amp; !empty($parsedFrame['data'])) {
+				$ThisFileInfo['id3v2']['comments'][$parsedFrame['framenameshort']][] = getid3_lib::iconv_fallback($parsedFrame['encoding'], $ThisFileInfo['id3v2']['encoding'], $parsedFrame['data']);
+			}
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'SYLT')) || // 4.9   SYLT Synchronised lyric/text
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'SLT'))) {     // 4.10  SLT  Synchronised lyric/text
+			//   There may be more than one 'SYLT' frame in each tag,
+			//   but only one with the same language and content descriptor.
+			// &lt;Header for 'Synchronised lyrics/text', ID: 'SYLT'&gt;
+			// Text encoding        $xx
+			// Language             $xx xx xx
+			// Time stamp format    $xx
+			//   $01  (32-bit value) MPEG frames from beginning of file
+			//   $02  (32-bit value) milliseconds from beginning of file
+			// Content type         $xx
+			// Content descriptor   &lt;text string according to encoding&gt; $00 (00)
+			//   Terminated text to be synced (typically a syllable)
+			//   Sync identifier (terminator to above string)   $00 (00)
+			//   Time stamp                                     $xx (xx ...)
+
+			$frame_offset = 0;
+			$frame_textencoding = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			if ((($id3v2_majorversion &lt;= 3) &amp;&amp; ($frame_textencoding &gt; 1)) || (($id3v2_majorversion == 4) &amp;&amp; ($frame_textencoding &gt; 3))) {
+				$ThisFileInfo['warning'][] = 'Invalid text encoding byte ('.$frame_textencoding.') in frame &quot;'.$parsedFrame['frame_name'].'&quot; - defaulting to ISO-8859-1 encoding';
+			}
+			$frame_language = substr($parsedFrame['data'], $frame_offset, 3);
+			$frame_offset += 3;
+			$parsedFrame['timestampformat'] = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['contenttypeid']   = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['contenttype']     = $this-&gt;SYTLContentTypeLookup($parsedFrame['contenttypeid']);
+			$parsedFrame['encodingid']      = $frame_textencoding;
+			$parsedFrame['encoding']        = $this-&gt;TextEncodingNameLookup($frame_textencoding);
+
+			$parsedFrame['language']        = $frame_language;
+			$parsedFrame['languagename']    = $this-&gt;LanguageLookup($frame_language, false);
+
+			$timestampindex = 0;
+			$frame_remainingdata = substr($parsedFrame['data'], $frame_offset);
+			while (strlen($frame_remainingdata)) {
+				$frame_offset = 0;
+				$frame_terminatorpos = strpos($frame_remainingdata, $this-&gt;TextEncodingTerminatorLookup($frame_textencoding));
+				if ($frame_terminatorpos === false) {
+					$frame_remainingdata = '';
+				} else {
+					if (ord(substr($frame_remainingdata, $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)), 1)) === 0) {
+						$frame_terminatorpos++; // strpos() fooled because 2nd byte of Unicode chars are often 0x00
+					}
+					$parsedFrame['lyrics'][$timestampindex]['data'] = substr($frame_remainingdata, $frame_offset, $frame_terminatorpos - $frame_offset);
+
+					$frame_remainingdata = substr($frame_remainingdata, $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)));
+					if (($timestampindex == 0) &amp;&amp; (ord($frame_remainingdata{0}) != 0)) {
+						// timestamp probably omitted for first data item
+					} else {
+						$parsedFrame['lyrics'][$timestampindex]['timestamp'] = getid3_lib::BigEndian2Int(substr($frame_remainingdata, 0, 4));
+						$frame_remainingdata = substr($frame_remainingdata, 4);
+					}
+					$timestampindex++;
+				}
+			}
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'COMM')) || // 4.10  COMM Comments
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'COM'))) {     // 4.11  COM  Comments
+			//   There may be more than one comment frame in each tag,
+			//   but only one with the same language and content descriptor.
+			// &lt;Header for 'Comment', ID: 'COMM'&gt;
+			// Text encoding          $xx
+			// Language               $xx xx xx
+			// Short content descrip. &lt;text string according to encoding&gt; $00 (00)
+			// The actual text        &lt;full text string according to encoding&gt;
+
+			if (strlen($parsedFrame['data']) &lt; 5) {
+
+				$ThisFileInfo['warning'][] = 'Invalid data (too short) for &quot;'.$parsedFrame['frame_name'].'&quot; frame at offset '.$parsedFrame['dataoffset'];
+
+			} else {
+
+				$frame_offset = 0;
+				$frame_textencoding = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+				if ((($id3v2_majorversion &lt;= 3) &amp;&amp; ($frame_textencoding &gt; 1)) || (($id3v2_majorversion == 4) &amp;&amp; ($frame_textencoding &gt; 3))) {
+					$ThisFileInfo['warning'][] = 'Invalid text encoding byte ('.$frame_textencoding.') in frame &quot;'.$parsedFrame['frame_name'].'&quot; - defaulting to ISO-8859-1 encoding';
+				}
+				$frame_language = substr($parsedFrame['data'], $frame_offset, 3);
+				$frame_offset += 3;
+				$frame_terminatorpos = strpos($parsedFrame['data'], $this-&gt;TextEncodingTerminatorLookup($frame_textencoding), $frame_offset);
+				if (ord(substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)), 1)) === 0) {
+					$frame_terminatorpos++; // strpos() fooled because 2nd byte of Unicode chars are often 0x00
+				}
+				$frame_description = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+				if (ord($frame_description) === 0) {
+					$frame_description = '';
+				}
+				$frame_text = (string) substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)));
+
+				$parsedFrame['encodingid']   = $frame_textencoding;
+				$parsedFrame['encoding']     = $this-&gt;TextEncodingNameLookup($frame_textencoding);
+
+				$parsedFrame['language']     = $frame_language;
+				$parsedFrame['languagename'] = $this-&gt;LanguageLookup($frame_language, false);
+				$parsedFrame['description']  = $frame_description;
+				$parsedFrame['data']         = $frame_text;
+				if (!empty($parsedFrame['framenameshort']) &amp;&amp; !empty($parsedFrame['data'])) {
+					$ThisFileInfo['id3v2']['comments'][$parsedFrame['framenameshort']][] = getid3_lib::iconv_fallback($parsedFrame['encoding'], $ThisFileInfo['id3v2']['encoding'], $parsedFrame['data']);
+				}
+
+			}
+
+		} elseif (($id3v2_majorversion &gt;= 4) &amp;&amp; ($parsedFrame['frame_name'] == 'RVA2')) { // 4.11  RVA2 Relative volume adjustment (2) (ID3v2.4+ only)
+			//   There may be more than one 'RVA2' frame in each tag,
+			//   but only one with the same identification string
+			// &lt;Header for 'Relative volume adjustment (2)', ID: 'RVA2'&gt;
+			// Identification          &lt;text string&gt; $00
+			//   The 'identification' string is used to identify the situation and/or
+			//   device where this adjustment should apply. The following is then
+			//   repeated for every channel:
+			// Type of channel         $xx
+			// Volume adjustment       $xx xx
+			// Bits representing peak  $xx
+			// Peak volume             $xx (xx ...)
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;);
+			$frame_idstring = substr($parsedFrame['data'], 0, $frame_terminatorpos);
+			if (ord($frame_idstring) === 0) {
+				$frame_idstring = '';
+			}
+			$frame_remainingdata = substr($parsedFrame['data'], $frame_terminatorpos + strlen(&quot;\x00&quot;));
+			$parsedFrame['description'] = $frame_idstring;
+			while (strlen($frame_remainingdata)) {
+				$frame_offset = 0;
+				$frame_channeltypeid = ord(substr($frame_remainingdata, $frame_offset++, 1));
+				$parsedFrame[$frame_channeltypeid]['channeltypeid']  = $frame_channeltypeid;
+				$parsedFrame[$frame_channeltypeid]['channeltype']    = $this-&gt;RVA2ChannelTypeLookup($frame_channeltypeid);
+				$parsedFrame[$frame_channeltypeid]['volumeadjust']   = getid3_lib::BigEndian2Int(substr($frame_remainingdata, $frame_offset, 2), false, true); // 16-bit signed
+				$frame_offset += 2;
+				$parsedFrame[$frame_channeltypeid]['bitspeakvolume'] = ord(substr($frame_remainingdata, $frame_offset++, 1));
+				$frame_bytespeakvolume = ceil($parsedFrame[$frame_channeltypeid]['bitspeakvolume'] / 8);
+				$parsedFrame[$frame_channeltypeid]['peakvolume']     = getid3_lib::BigEndian2Int(substr($frame_remainingdata, $frame_offset, $frame_bytespeakvolume));
+				$frame_remainingdata = substr($frame_remainingdata, $frame_offset + $frame_bytespeakvolume);
+			}
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion == 3) &amp;&amp; ($parsedFrame['frame_name'] == 'RVAD')) || // 4.12  RVAD Relative volume adjustment (ID3v2.3 only)
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'RVA'))) {     // 4.12  RVA  Relative volume adjustment (ID3v2.2 only)
+			//   There may only be one 'RVA' frame in each tag
+			// &lt;Header for 'Relative volume adjustment', ID: 'RVA'&gt;
+			// ID3v2.2 =&gt; Increment/decrement     %000000ba
+			// ID3v2.3 =&gt; Increment/decrement     %00fedcba
+			// Bits used for volume descr.        $xx
+			// Relative volume change, right      $xx xx (xx ...) // a
+			// Relative volume change, left       $xx xx (xx ...) // b
+			// Peak volume right                  $xx xx (xx ...)
+			// Peak volume left                   $xx xx (xx ...)
+			//   ID3v2.3 only, optional (not present in ID3v2.2):
+			// Relative volume change, right back $xx xx (xx ...) // c
+			// Relative volume change, left back  $xx xx (xx ...) // d
+			// Peak volume right back             $xx xx (xx ...)
+			// Peak volume left back              $xx xx (xx ...)
+			//   ID3v2.3 only, optional (not present in ID3v2.2):
+			// Relative volume change, center     $xx xx (xx ...) // e
+			// Peak volume center                 $xx xx (xx ...)
+			//   ID3v2.3 only, optional (not present in ID3v2.2):
+			// Relative volume change, bass       $xx xx (xx ...) // f
+			// Peak volume bass                   $xx xx (xx ...)
+
+			$frame_offset = 0;
+			$frame_incrdecrflags = getid3_lib::BigEndian2Bin(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['incdec']['right'] = (bool) substr($frame_incrdecrflags, 6, 1);
+			$parsedFrame['incdec']['left']  = (bool) substr($frame_incrdecrflags, 7, 1);
+			$parsedFrame['bitsvolume'] = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$frame_bytesvolume = ceil($parsedFrame['bitsvolume'] / 8);
+			$parsedFrame['volumechange']['right'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, $frame_bytesvolume));
+			if ($parsedFrame['incdec']['right'] === false) {
+				$parsedFrame['volumechange']['right'] *= -1;
+			}
+			$frame_offset += $frame_bytesvolume;
+			$parsedFrame['volumechange']['left'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, $frame_bytesvolume));
+			if ($parsedFrame['incdec']['left'] === false) {
+				$parsedFrame['volumechange']['left'] *= -1;
+			}
+			$frame_offset += $frame_bytesvolume;
+			$parsedFrame['peakvolume']['right'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, $frame_bytesvolume));
+			$frame_offset += $frame_bytesvolume;
+			$parsedFrame['peakvolume']['left']  = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, $frame_bytesvolume));
+			$frame_offset += $frame_bytesvolume;
+			if ($id3v2_majorversion == 3) {
+				$parsedFrame['data'] = substr($parsedFrame['data'], $frame_offset);
+				if (strlen($parsedFrame['data']) &gt; 0) {
+					$parsedFrame['incdec']['rightrear'] = (bool) substr($frame_incrdecrflags, 4, 1);
+					$parsedFrame['incdec']['leftrear']  = (bool) substr($frame_incrdecrflags, 5, 1);
+					$parsedFrame['volumechange']['rightrear'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, $frame_bytesvolume));
+					if ($parsedFrame['incdec']['rightrear'] === false) {
+						$parsedFrame['volumechange']['rightrear'] *= -1;
+					}
+					$frame_offset += $frame_bytesvolume;
+					$parsedFrame['volumechange']['leftrear'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, $frame_bytesvolume));
+					if ($parsedFrame['incdec']['leftrear'] === false) {
+						$parsedFrame['volumechange']['leftrear'] *= -1;
+					}
+					$frame_offset += $frame_bytesvolume;
+					$parsedFrame['peakvolume']['rightrear'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, $frame_bytesvolume));
+					$frame_offset += $frame_bytesvolume;
+					$parsedFrame['peakvolume']['leftrear']  = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, $frame_bytesvolume));
+					$frame_offset += $frame_bytesvolume;
+				}
+				$parsedFrame['data'] = substr($parsedFrame['data'], $frame_offset);
+				if (strlen($parsedFrame['data']) &gt; 0) {
+					$parsedFrame['incdec']['center'] = (bool) substr($frame_incrdecrflags, 3, 1);
+					$parsedFrame['volumechange']['center'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, $frame_bytesvolume));
+					if ($parsedFrame['incdec']['center'] === false) {
+						$parsedFrame['volumechange']['center'] *= -1;
+					}
+					$frame_offset += $frame_bytesvolume;
+					$parsedFrame['peakvolume']['center'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, $frame_bytesvolume));
+					$frame_offset += $frame_bytesvolume;
+				}
+				$parsedFrame['data'] = substr($parsedFrame['data'], $frame_offset);
+				if (strlen($parsedFrame['data']) &gt; 0) {
+					$parsedFrame['incdec']['bass'] = (bool) substr($frame_incrdecrflags, 2, 1);
+					$parsedFrame['volumechange']['bass'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, $frame_bytesvolume));
+					if ($parsedFrame['incdec']['bass'] === false) {
+						$parsedFrame['volumechange']['bass'] *= -1;
+					}
+					$frame_offset += $frame_bytesvolume;
+					$parsedFrame['peakvolume']['bass'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, $frame_bytesvolume));
+					$frame_offset += $frame_bytesvolume;
+				}
+			}
+			unset($parsedFrame['data']);
+
+
+		} elseif (($id3v2_majorversion &gt;= 4) &amp;&amp; ($parsedFrame['frame_name'] == 'EQU2')) { // 4.12  EQU2 Equalisation (2) (ID3v2.4+ only)
+			//   There may be more than one 'EQU2' frame in each tag,
+			//   but only one with the same identification string
+			// &lt;Header of 'Equalisation (2)', ID: 'EQU2'&gt;
+			// Interpolation method  $xx
+			//   $00  Band
+			//   $01  Linear
+			// Identification        &lt;text string&gt; $00
+			//   The following is then repeated for every adjustment point
+			// Frequency          $xx xx
+			// Volume adjustment  $xx xx
+
+			$frame_offset = 0;
+			$frame_interpolationmethod = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_idstring = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_idstring) === 0) {
+				$frame_idstring = '';
+			}
+			$parsedFrame['description'] = $frame_idstring;
+			$frame_remainingdata = substr($parsedFrame['data'], $frame_terminatorpos + strlen(&quot;\x00&quot;));
+			while (strlen($frame_remainingdata)) {
+				$frame_frequency = getid3_lib::BigEndian2Int(substr($frame_remainingdata, 0, 2)) / 2;
+				$parsedFrame['data'][$frame_frequency] = getid3_lib::BigEndian2Int(substr($frame_remainingdata, 2, 2), false, true);
+				$frame_remainingdata = substr($frame_remainingdata, 4);
+			}
+			$parsedFrame['interpolationmethod'] = $frame_interpolationmethod;
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion == 3) &amp;&amp; ($parsedFrame['frame_name'] == 'EQUA')) || // 4.12  EQUA Equalisation (ID3v2.3 only)
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'EQU'))) {     // 4.13  EQU  Equalisation (ID3v2.2 only)
+			//   There may only be one 'EQUA' frame in each tag
+			// &lt;Header for 'Relative volume adjustment', ID: 'EQU'&gt;
+			// Adjustment bits    $xx
+			//   This is followed by 2 bytes + ('adjustment bits' rounded up to the
+			//   nearest byte) for every equalisation band in the following format,
+			//   giving a frequency range of 0 - 32767Hz:
+			// Increment/decrement   %x (MSB of the Frequency)
+			// Frequency             (lower 15 bits)
+			// Adjustment            $xx (xx ...)
+
+			$frame_offset = 0;
+			$parsedFrame['adjustmentbits'] = substr($parsedFrame['data'], $frame_offset++, 1);
+			$frame_adjustmentbytes = ceil($parsedFrame['adjustmentbits'] / 8);
+
+			$frame_remainingdata = (string) substr($parsedFrame['data'], $frame_offset);
+			while (strlen($frame_remainingdata) &gt; 0) {
+				$frame_frequencystr = getid3_lib::BigEndian2Bin(substr($frame_remainingdata, 0, 2));
+				$frame_incdec    = (bool) substr($frame_frequencystr, 0, 1);
+				$frame_frequency = bindec(substr($frame_frequencystr, 1, 15));
+				$parsedFrame[$frame_frequency]['incdec'] = $frame_incdec;
+				$parsedFrame[$frame_frequency]['adjustment'] = getid3_lib::BigEndian2Int(substr($frame_remainingdata, 2, $frame_adjustmentbytes));
+				if ($parsedFrame[$frame_frequency]['incdec'] === false) {
+					$parsedFrame[$frame_frequency]['adjustment'] *= -1;
+				}
+				$frame_remainingdata = substr($frame_remainingdata, 2 + $frame_adjustmentbytes);
+			}
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'RVRB')) || // 4.13  RVRB Reverb
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'REV'))) {     // 4.14  REV  Reverb
+			//   There may only be one 'RVRB' frame in each tag.
+			// &lt;Header for 'Reverb', ID: 'RVRB'&gt;
+			// Reverb left (ms)                 $xx xx
+			// Reverb right (ms)                $xx xx
+			// Reverb bounces, left             $xx
+			// Reverb bounces, right            $xx
+			// Reverb feedback, left to left    $xx
+			// Reverb feedback, left to right   $xx
+			// Reverb feedback, right to right  $xx
+			// Reverb feedback, right to left   $xx
+			// Premix left to right             $xx
+			// Premix right to left             $xx
+
+			$frame_offset = 0;
+			$parsedFrame['left']  = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, 2));
+			$frame_offset += 2;
+			$parsedFrame['right'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, 2));
+			$frame_offset += 2;
+			$parsedFrame['bouncesL']      = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['bouncesR']      = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['feedbackLL']    = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['feedbackLR']    = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['feedbackRR']    = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['feedbackRL']    = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['premixLR']      = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['premixRL']      = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'APIC')) || // 4.14  APIC Attached picture
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'PIC'))) {     // 4.15  PIC  Attached picture
+			//   There may be several pictures attached to one file,
+			//   each in their individual 'APIC' frame, but only one
+			//   with the same content descriptor
+			// &lt;Header for 'Attached picture', ID: 'APIC'&gt;
+			// Text encoding      $xx
+			// ID3v2.3+ =&gt; MIME type          &lt;text string&gt; $00
+			// ID3v2.2  =&gt; Image format       $xx xx xx
+			// Picture type       $xx
+			// Description        &lt;text string according to encoding&gt; $00 (00)
+			// Picture data       &lt;binary data&gt;
+
+			$frame_offset = 0;
+			$frame_textencoding = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			if ((($id3v2_majorversion &lt;= 3) &amp;&amp; ($frame_textencoding &gt; 1)) || (($id3v2_majorversion == 4) &amp;&amp; ($frame_textencoding &gt; 3))) {
+				$ThisFileInfo['warning'][] = 'Invalid text encoding byte ('.$frame_textencoding.') in frame &quot;'.$parsedFrame['frame_name'].'&quot; - defaulting to ISO-8859-1 encoding';
+			}
+
+			if ($id3v2_majorversion == 2) {
+				$frame_imagetype = substr($parsedFrame['data'], $frame_offset, 3);
+				if (strtolower($frame_imagetype) == 'ima') {
+					// complete hack for mp3Rage (www.chaoticsoftware.com) that puts ID3v2.3-formatted
+					// MIME type instead of 3-char ID3v2.2-format image type  (thanks xbhoff&#216;pacbell*net)
+					$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+					$frame_mimetype = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+					if (ord($frame_mimetype) === 0) {
+						$frame_mimetype = '';
+					}
+					$frame_imagetype = strtoupper(str_replace('image/', '', strtolower($frame_mimetype)));
+					if ($frame_imagetype == 'JPEG') {
+						$frame_imagetype = 'JPG';
+					}
+					$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+				} else {
+					$frame_offset += 3;
+				}
+			}
+			if ($id3v2_majorversion &gt; 2) {
+				$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+				$frame_mimetype = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+				if (ord($frame_mimetype) === 0) {
+					$frame_mimetype = '';
+				}
+				$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+			}
+
+			$frame_picturetype = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], $this-&gt;TextEncodingTerminatorLookup($frame_textencoding), $frame_offset);
+			if (ord(substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)), 1)) === 0) {
+				$frame_terminatorpos++; // strpos() fooled because 2nd byte of Unicode chars are often 0x00
+			}
+			$frame_description = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_description) === 0) {
+				$frame_description = '';
+			}
+			$parsedFrame['encodingid']       = $frame_textencoding;
+			$parsedFrame['encoding']         = $this-&gt;TextEncodingNameLookup($frame_textencoding);
+
+			if ($id3v2_majorversion == 2) {
+				$parsedFrame['imagetype']    = $frame_imagetype;
+			} else {
+				$parsedFrame['mime']         = $frame_mimetype;
+			}
+			$parsedFrame['picturetypeid']    = $frame_picturetype;
+			$parsedFrame['picturetype']      = $this-&gt;APICPictureTypeLookup($frame_picturetype);
+			$parsedFrame['description']      = $frame_description;
+			$parsedFrame['data']             = substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)));
+
+			$imagechunkcheck = getid3_lib::GetDataImageSize($parsedFrame['data']);
+			if (($imagechunkcheck[2] &gt;= 1) &amp;&amp; ($imagechunkcheck[2] &lt;= 3)) {
+				$parsedFrame['image_mime']       = 'image/'.getid3_lib::ImageTypesLookup($imagechunkcheck[2]);
+				if ($imagechunkcheck[0]) {
+					$parsedFrame['image_width']  = $imagechunkcheck[0];
+				}
+				if ($imagechunkcheck[1]) {
+					$parsedFrame['image_height'] = $imagechunkcheck[1];
+				}
+				$parsedFrame['image_bytes']      = strlen($parsedFrame['data']);
+			}
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'GEOB')) || // 4.15  GEOB General encapsulated object
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'GEO'))) {     // 4.16  GEO  General encapsulated object
+			//   There may be more than one 'GEOB' frame in each tag,
+			//   but only one with the same content descriptor
+			// &lt;Header for 'General encapsulated object', ID: 'GEOB'&gt;
+			// Text encoding          $xx
+			// MIME type              &lt;text string&gt; $00
+			// Filename               &lt;text string according to encoding&gt; $00 (00)
+			// Content description    &lt;text string according to encoding&gt; $00 (00)
+			// Encapsulated object    &lt;binary data&gt;
+
+			$frame_offset = 0;
+			$frame_textencoding = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			if ((($id3v2_majorversion &lt;= 3) &amp;&amp; ($frame_textencoding &gt; 1)) || (($id3v2_majorversion == 4) &amp;&amp; ($frame_textencoding &gt; 3))) {
+				$ThisFileInfo['warning'][] = 'Invalid text encoding byte ('.$frame_textencoding.') in frame &quot;'.$parsedFrame['frame_name'].'&quot; - defaulting to ISO-8859-1 encoding';
+			}
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_mimetype = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_mimetype) === 0) {
+				$frame_mimetype = '';
+			}
+			$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], $this-&gt;TextEncodingTerminatorLookup($frame_textencoding), $frame_offset);
+			if (ord(substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)), 1)) === 0) {
+				$frame_terminatorpos++; // strpos() fooled because 2nd byte of Unicode chars are often 0x00
+			}
+			$frame_filename = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_filename) === 0) {
+				$frame_filename = '';
+			}
+			$frame_offset = $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding));
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], $this-&gt;TextEncodingTerminatorLookup($frame_textencoding), $frame_offset);
+			if (ord(substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)), 1)) === 0) {
+				$frame_terminatorpos++; // strpos() fooled because 2nd byte of Unicode chars are often 0x00
+			}
+			$frame_description = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_description) === 0) {
+				$frame_description = '';
+			}
+			$frame_offset = $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding));
+
+			$parsedFrame['objectdata']  = (string) substr($parsedFrame['data'], $frame_offset);
+			$parsedFrame['encodingid']  = $frame_textencoding;
+			$parsedFrame['encoding']    = $this-&gt;TextEncodingNameLookup($frame_textencoding);
+
+			$parsedFrame['mime']        = $frame_mimetype;
+			$parsedFrame['filename']    = $frame_filename;
+			$parsedFrame['description'] = $frame_description;
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'PCNT')) || // 4.16  PCNT Play counter
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'CNT'))) {     // 4.17  CNT  Play counter
+			//   There may only be one 'PCNT' frame in each tag.
+			//   When the counter reaches all one's, one byte is inserted in
+			//   front of the counter thus making the counter eight bits bigger
+			// &lt;Header for 'Play counter', ID: 'PCNT'&gt;
+			// Counter        $xx xx xx xx (xx ...)
+
+			$parsedFrame['data']          = getid3_lib::BigEndian2Int($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'POPM')) || // 4.17  POPM Popularimeter
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'POP'))) {     // 4.18  POP  Popularimeter
+			//   There may be more than one 'POPM' frame in each tag,
+			//   but only one with the same email address
+			// &lt;Header for 'Popularimeter', ID: 'POPM'&gt;
+			// Email to user   &lt;text string&gt; $00
+			// Rating          $xx
+			// Counter         $xx xx xx xx (xx ...)
+
+			$frame_offset = 0;
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_emailaddress = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_emailaddress) === 0) {
+				$frame_emailaddress = '';
+			}
+			$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+			$frame_rating = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['data'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset));
+			$parsedFrame['email']  = $frame_emailaddress;
+			$parsedFrame['rating'] = $frame_rating;
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'RBUF')) || // 4.18  RBUF Recommended buffer size
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'BUF'))) {     // 4.19  BUF  Recommended buffer size
+			//   There may only be one 'RBUF' frame in each tag
+			// &lt;Header for 'Recommended buffer size', ID: 'RBUF'&gt;
+			// Buffer size               $xx xx xx
+			// Embedded info flag        %0000000x
+			// Offset to next tag        $xx xx xx xx
+
+			$frame_offset = 0;
+			$parsedFrame['buffersize'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, 3));
+			$frame_offset += 3;
+
+			$frame_embeddedinfoflags = getid3_lib::BigEndian2Bin(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['flags']['embededinfo'] = (bool) substr($frame_embeddedinfoflags, 7, 1);
+			$parsedFrame['nexttagoffset'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, 4));
+			unset($parsedFrame['data']);
+
+
+		} elseif (($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'CRM')) { // 4.20  Encrypted meta frame (ID3v2.2 only)
+			//   There may be more than one 'CRM' frame in a tag,
+			//   but only one with the same 'owner identifier'
+			// &lt;Header for 'Encrypted meta frame', ID: 'CRM'&gt;
+			// Owner identifier      &lt;textstring&gt; $00 (00)
+			// Content/explanation   &lt;textstring&gt; $00 (00)
+			// Encrypted datablock   &lt;binary data&gt;
+
+			$frame_offset = 0;
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_ownerid = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_description = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_description) === 0) {
+				$frame_description = '';
+			}
+			$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+
+			$parsedFrame['ownerid']     = $frame_ownerid;
+			$parsedFrame['data']        = (string) substr($parsedFrame['data'], $frame_offset);
+			$parsedFrame['description'] = $frame_description;
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'AENC')) || // 4.19  AENC Audio encryption
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'CRA'))) {     // 4.21  CRA  Audio encryption
+			//   There may be more than one 'AENC' frames in a tag,
+			//   but only one with the same 'Owner identifier'
+			// &lt;Header for 'Audio encryption', ID: 'AENC'&gt;
+			// Owner identifier   &lt;text string&gt; $00
+			// Preview start      $xx xx
+			// Preview length     $xx xx
+			// Encryption info    &lt;binary data&gt;
+
+			$frame_offset = 0;
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_ownerid = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_ownerid) === 0) {
+				$frame_ownerid == '';
+			}
+			$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+			$parsedFrame['ownerid'] = $frame_ownerid;
+			$parsedFrame['previewstart'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, 2));
+			$frame_offset += 2;
+			$parsedFrame['previewlength'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, 2));
+			$frame_offset += 2;
+			$parsedFrame['encryptioninfo'] = (string) substr($parsedFrame['data'], $frame_offset);
+			unset($parsedFrame['data']);
+
+
+		} elseif ((($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'LINK')) || // 4.20  LINK Linked information
+				(($id3v2_majorversion == 2) &amp;&amp; ($parsedFrame['frame_name'] == 'LNK'))) {     // 4.22  LNK  Linked information
+			//   There may be more than one 'LINK' frame in a tag,
+			//   but only one with the same contents
+			// &lt;Header for 'Linked information', ID: 'LINK'&gt;
+			// ID3v2.3+ =&gt; Frame identifier   $xx xx xx xx
+			// ID3v2.2  =&gt; Frame identifier   $xx xx xx
+			// URL                            &lt;text string&gt; $00
+			// ID and additional data         &lt;text string(s)&gt;
+
+			$frame_offset = 0;
+			if ($id3v2_majorversion == 2) {
+				$parsedFrame['frameid'] = substr($parsedFrame['data'], $frame_offset, 3);
+				$frame_offset += 3;
+			} else {
+				$parsedFrame['frameid'] = substr($parsedFrame['data'], $frame_offset, 4);
+				$frame_offset += 4;
+			}
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_url = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_url) === 0) {
+				$frame_url = '';
+			}
+			$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+			$parsedFrame['url'] = $frame_url;
+
+			$parsedFrame['additionaldata'] = (string) substr($parsedFrame['data'], $frame_offset);
+			if (!empty($parsedFrame['framenameshort']) &amp;&amp; $parsedFrame['url']) {
+				$ThisFileInfo['id3v2']['comments'][$parsedFrame['framenameshort']][] = getid3_lib::iconv_fallback($parsedFrame['encoding'], $ThisFileInfo['id3v2']['encoding'], $parsedFrame['url']);
+			}
+			unset($parsedFrame['data']);
+
+
+		} elseif (($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'POSS')) { // 4.21  POSS Position synchronisation frame (ID3v2.3+ only)
+			//   There may only be one 'POSS' frame in each tag
+			// &lt;Head for 'Position synchronisation', ID: 'POSS'&gt;
+			// Time stamp format         $xx
+			// Position                  $xx (xx ...)
+
+			$frame_offset = 0;
+			$parsedFrame['timestampformat'] = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['position']        = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset));
+			unset($parsedFrame['data']);
+
+
+		} elseif (($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'USER')) { // 4.22  USER Terms of use (ID3v2.3+ only)
+			//   There may be more than one 'Terms of use' frame in a tag,
+			//   but only one with the same 'Language'
+			// &lt;Header for 'Terms of use frame', ID: 'USER'&gt;
+			// Text encoding        $xx
+			// Language             $xx xx xx
+			// The actual text      &lt;text string according to encoding&gt;
+
+			$frame_offset = 0;
+			$frame_textencoding = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			if ((($id3v2_majorversion &lt;= 3) &amp;&amp; ($frame_textencoding &gt; 1)) || (($id3v2_majorversion == 4) &amp;&amp; ($frame_textencoding &gt; 3))) {
+				$ThisFileInfo['warning'][] = 'Invalid text encoding byte ('.$frame_textencoding.') in frame &quot;'.$parsedFrame['frame_name'].'&quot; - defaulting to ISO-8859-1 encoding';
+			}
+			$frame_language = substr($parsedFrame['data'], $frame_offset, 3);
+			$frame_offset += 3;
+			$parsedFrame['language']     = $frame_language;
+			$parsedFrame['languagename'] = $this-&gt;LanguageLookup($frame_language, false);
+			$parsedFrame['encodingid']   = $frame_textencoding;
+			$parsedFrame['encoding']     = $this-&gt;TextEncodingNameLookup($frame_textencoding);
+
+			$parsedFrame['data']         = (string) substr($parsedFrame['data'], $frame_offset);
+			if (!empty($parsedFrame['framenameshort']) &amp;&amp; !empty($parsedFrame['data'])) {
+				$ThisFileInfo['id3v2']['comments'][$parsedFrame['framenameshort']][] = getid3_lib::iconv_fallback($parsedFrame['encoding'], $ThisFileInfo['id3v2']['encoding'], $parsedFrame['data']);
+			}
+			unset($parsedFrame['data']);
+
+
+		} elseif (($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'OWNE')) { // 4.23  OWNE Ownership frame (ID3v2.3+ only)
+			//   There may only be one 'OWNE' frame in a tag
+			// &lt;Header for 'Ownership frame', ID: 'OWNE'&gt;
+			// Text encoding     $xx
+			// Price paid        &lt;text string&gt; $00
+			// Date of purch.    &lt;text string&gt;
+			// Seller            &lt;text string according to encoding&gt;
+
+			$frame_offset = 0;
+			$frame_textencoding = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			if ((($id3v2_majorversion &lt;= 3) &amp;&amp; ($frame_textencoding &gt; 1)) || (($id3v2_majorversion == 4) &amp;&amp; ($frame_textencoding &gt; 3))) {
+				$ThisFileInfo['warning'][] = 'Invalid text encoding byte ('.$frame_textencoding.') in frame &quot;'.$parsedFrame['frame_name'].'&quot; - defaulting to ISO-8859-1 encoding';
+			}
+			$parsedFrame['encodingid'] = $frame_textencoding;
+			$parsedFrame['encoding']   = $this-&gt;TextEncodingNameLookup($frame_textencoding);
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_pricepaid = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+
+			$parsedFrame['pricepaid']['currencyid'] = substr($frame_pricepaid, 0, 3);
+			$parsedFrame['pricepaid']['currency']   = $this-&gt;LookupCurrencyUnits($parsedFrame['pricepaid']['currencyid']);
+			$parsedFrame['pricepaid']['value']      = substr($frame_pricepaid, 3);
+
+			$parsedFrame['purchasedate'] = substr($parsedFrame['data'], $frame_offset, 8);
+			if (!$this-&gt;IsValidDateStampString($parsedFrame['purchasedate'])) {
+				$parsedFrame['purchasedateunix'] = mktime (0, 0, 0, substr($parsedFrame['purchasedate'], 4, 2), substr($parsedFrame['purchasedate'], 6, 2), substr($parsedFrame['purchasedate'], 0, 4));
+			}
+			$frame_offset += 8;
+
+			$parsedFrame['seller'] = (string) substr($parsedFrame['data'], $frame_offset);
+			unset($parsedFrame['data']);
+
+
+		} elseif (($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'COMR')) { // 4.24  COMR Commercial frame (ID3v2.3+ only)
+			//   There may be more than one 'commercial frame' in a tag,
+			//   but no two may be identical
+			// &lt;Header for 'Commercial frame', ID: 'COMR'&gt;
+			// Text encoding      $xx
+			// Price string       &lt;text string&gt; $00
+			// Valid until        &lt;text string&gt;
+			// Contact URL        &lt;text string&gt; $00
+			// Received as        $xx
+			// Name of seller     &lt;text string according to encoding&gt; $00 (00)
+			// Description        &lt;text string according to encoding&gt; $00 (00)
+			// Picture MIME type  &lt;string&gt; $00
+			// Seller logo        &lt;binary data&gt;
+
+			$frame_offset = 0;
+			$frame_textencoding = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			if ((($id3v2_majorversion &lt;= 3) &amp;&amp; ($frame_textencoding &gt; 1)) || (($id3v2_majorversion == 4) &amp;&amp; ($frame_textencoding &gt; 3))) {
+				$ThisFileInfo['warning'][] = 'Invalid text encoding byte ('.$frame_textencoding.') in frame &quot;'.$parsedFrame['frame_name'].'&quot; - defaulting to ISO-8859-1 encoding';
+			}
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_pricestring = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+			$frame_rawpricearray = explode('/', $frame_pricestring);
+			foreach ($frame_rawpricearray as $key =&gt; $val) {
+				$frame_currencyid = substr($val, 0, 3);
+				$parsedFrame['price'][$frame_currencyid]['currency'] = $this-&gt;LookupCurrencyUnits($frame_currencyid);
+				$parsedFrame['price'][$frame_currencyid]['value']    = substr($val, 3);
+			}
+
+			$frame_datestring = substr($parsedFrame['data'], $frame_offset, 8);
+			$frame_offset += 8;
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_contacturl = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+
+			$frame_receivedasid = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], $this-&gt;TextEncodingTerminatorLookup($frame_textencoding), $frame_offset);
+			if (ord(substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)), 1)) === 0) {
+				$frame_terminatorpos++; // strpos() fooled because 2nd byte of Unicode chars are often 0x00
+			}
+			$frame_sellername = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_sellername) === 0) {
+				$frame_sellername = '';
+			}
+			$frame_offset = $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding));
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], $this-&gt;TextEncodingTerminatorLookup($frame_textencoding), $frame_offset);
+			if (ord(substr($parsedFrame['data'], $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding)), 1)) === 0) {
+				$frame_terminatorpos++; // strpos() fooled because 2nd byte of Unicode chars are often 0x00
+			}
+			$frame_description = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_description) === 0) {
+				$frame_description = '';
+			}
+			$frame_offset = $frame_terminatorpos + strlen($this-&gt;TextEncodingTerminatorLookup($frame_textencoding));
+
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_mimetype = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+
+			$frame_sellerlogo = substr($parsedFrame['data'], $frame_offset);
+
+			$parsedFrame['encodingid']        = $frame_textencoding;
+			$parsedFrame['encoding']          = $this-&gt;TextEncodingNameLookup($frame_textencoding);
+
+			$parsedFrame['pricevaliduntil']   = $frame_datestring;
+			$parsedFrame['contacturl']        = $frame_contacturl;
+			$parsedFrame['receivedasid']      = $frame_receivedasid;
+			$parsedFrame['receivedas']        = $this-&gt;COMRReceivedAsLookup($frame_receivedasid);
+			$parsedFrame['sellername']        = $frame_sellername;
+			$parsedFrame['description']       = $frame_description;
+			$parsedFrame['mime']              = $frame_mimetype;
+			$parsedFrame['logo']              = $frame_sellerlogo;
+			unset($parsedFrame['data']);
+
+
+		} elseif (($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'ENCR')) { // 4.25  ENCR Encryption method registration (ID3v2.3+ only)
+			//   There may be several 'ENCR' frames in a tag,
+			//   but only one containing the same symbol
+			//   and only one containing the same owner identifier
+			// &lt;Header for 'Encryption method registration', ID: 'ENCR'&gt;
+			// Owner identifier    &lt;text string&gt; $00
+			// Method symbol       $xx
+			// Encryption data     &lt;binary data&gt;
+
+			$frame_offset = 0;
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_ownerid = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_ownerid) === 0) {
+				$frame_ownerid = '';
+			}
+			$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+
+			$parsedFrame['ownerid']      = $frame_ownerid;
+			$parsedFrame['methodsymbol'] = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['data']         = (string) substr($parsedFrame['data'], $frame_offset);
+
+
+		} elseif (($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'GRID')) { // 4.26  GRID Group identification registration (ID3v2.3+ only)
+
+			//   There may be several 'GRID' frames in a tag,
+			//   but only one containing the same symbol
+			//   and only one containing the same owner identifier
+			// &lt;Header for 'Group ID registration', ID: 'GRID'&gt;
+			// Owner identifier      &lt;text string&gt; $00
+			// Group symbol          $xx
+			// Group dependent data  &lt;binary data&gt;
+
+			$frame_offset = 0;
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_ownerid = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_ownerid) === 0) {
+				$frame_ownerid = '';
+			}
+			$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+
+			$parsedFrame['ownerid']       = $frame_ownerid;
+			$parsedFrame['groupsymbol']   = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['data']          = (string) substr($parsedFrame['data'], $frame_offset);
+
+
+		} elseif (($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'PRIV')) { // 4.27  PRIV Private frame (ID3v2.3+ only)
+			//   The tag may contain more than one 'PRIV' frame
+			//   but only with different contents
+			// &lt;Header for 'Private frame', ID: 'PRIV'&gt;
+			// Owner identifier      &lt;text string&gt; $00
+			// The private data      &lt;binary data&gt;
+
+			$frame_offset = 0;
+			$frame_terminatorpos = strpos($parsedFrame['data'], &quot;\x00&quot;, $frame_offset);
+			$frame_ownerid = substr($parsedFrame['data'], $frame_offset, $frame_terminatorpos - $frame_offset);
+			if (ord($frame_ownerid) === 0) {
+				$frame_ownerid = '';
+			}
+			$frame_offset = $frame_terminatorpos + strlen(&quot;\x00&quot;);
+
+			$parsedFrame['ownerid'] = $frame_ownerid;
+			$parsedFrame['data']    = (string) substr($parsedFrame['data'], $frame_offset);
+
+
+		} elseif (($id3v2_majorversion &gt;= 4) &amp;&amp; ($parsedFrame['frame_name'] == 'SIGN')) { // 4.28  SIGN Signature frame (ID3v2.4+ only)
+			//   There may be more than one 'signature frame' in a tag,
+			//   but no two may be identical
+			// &lt;Header for 'Signature frame', ID: 'SIGN'&gt;
+			// Group symbol      $xx
+			// Signature         &lt;binary data&gt;
+
+			$frame_offset = 0;
+			$parsedFrame['groupsymbol'] = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$parsedFrame['data']        = (string) substr($parsedFrame['data'], $frame_offset);
+
+
+		} elseif (($id3v2_majorversion &gt;= 4) &amp;&amp; ($parsedFrame['frame_name'] == 'SEEK')) { // 4.29  SEEK Seek frame (ID3v2.4+ only)
+			//   There may only be one 'seek frame' in a tag
+			// &lt;Header for 'Seek frame', ID: 'SEEK'&gt;
+			// Minimum offset to next tag       $xx xx xx xx
+
+			$frame_offset = 0;
+			$parsedFrame['data']          = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, 4));
+
+
+		} elseif (($id3v2_majorversion &gt;= 4) &amp;&amp; ($parsedFrame['frame_name'] == 'ASPI')) { // 4.30  ASPI Audio seek point index (ID3v2.4+ only)
+			//   There may only be one 'audio seek point index' frame in a tag
+			// &lt;Header for 'Seek Point Index', ID: 'ASPI'&gt;
+			// Indexed data start (S)         $xx xx xx xx
+			// Indexed data length (L)        $xx xx xx xx
+			// Number of index points (N)     $xx xx
+			// Bits per index point (b)       $xx
+			//   Then for every index point the following data is included:
+			// Fraction at index (Fi)          $xx (xx)
+
+			$frame_offset = 0;
+			$parsedFrame['datastart'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, 4));
+			$frame_offset += 4;
+			$parsedFrame['indexeddatalength'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, 4));
+			$frame_offset += 4;
+			$parsedFrame['indexpoints'] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, 2));
+			$frame_offset += 2;
+			$parsedFrame['bitsperpoint'] = ord(substr($parsedFrame['data'], $frame_offset++, 1));
+			$frame_bytesperpoint = ceil($parsedFrame['bitsperpoint'] / 8);
+			for ($i = 0; $i &lt; $frame_indexpoints; $i++) {
+				$parsedFrame['indexes'][$i] = getid3_lib::BigEndian2Int(substr($parsedFrame['data'], $frame_offset, $frame_bytesperpoint));
+				$frame_offset += $frame_bytesperpoint;
+			}
+			unset($parsedFrame['data']);
+
+		} elseif (($id3v2_majorversion &gt;= 3) &amp;&amp; ($parsedFrame['frame_name'] == 'RGAD')) { // Replay Gain Adjustment
+			// <A HREF="http://privatewww.essex.ac.uk/~djmrob/replaygain/file_format_id3v2.html">http://privatewww.essex.ac.uk/~djmrob/replaygain/file_format_id3v2.html</A>
+			//   There may only be one 'RGAD' frame in a tag
+			// &lt;Header for 'Replay Gain Adjustment', ID: 'RGAD'&gt;
+			// Peak Amplitude                      $xx $xx $xx $xx
+			// Radio Replay Gain Adjustment        %aaabbbcd %dddddddd
+			// Audiophile Replay Gain Adjustment   %aaabbbcd %dddddddd
+			//   a - name code
+			//   b - originator code
+			//   c - sign bit
+			//   d - replay gain adjustment
+
+			$frame_offset = 0;
+			$parsedFrame['peakamplitude'] = getid3_lib::BigEndian2Float(substr($parsedFrame['data'], $frame_offset, 4));
+			$frame_offset += 4;
+			$rg_track_adjustment = getid3_lib::Dec2Bin(substr($parsedFrame['data'], $frame_offset, 2));
+			$frame_offset += 2;
+			$rg_album_adjustment = getid3_lib::Dec2Bin(substr($parsedFrame['data'], $frame_offset, 2));
+			$frame_offset += 2;
+			$parsedFrame['raw']['track']['name']       = getid3_lib::Bin2Dec(substr($rg_track_adjustment, 0, 3));
+			$parsedFrame['raw']['track']['originator'] = getid3_lib::Bin2Dec(substr($rg_track_adjustment, 3, 3));
+			$parsedFrame['raw']['track']['signbit']    = getid3_lib::Bin2Dec(substr($rg_track_adjustment, 6, 1));
+			$parsedFrame['raw']['track']['adjustment'] = getid3_lib::Bin2Dec(substr($rg_track_adjustment, 7, 9));
+			$parsedFrame['raw']['album']['name']       = getid3_lib::Bin2Dec(substr($rg_album_adjustment, 0, 3));
+			$parsedFrame['raw']['album']['originator'] = getid3_lib::Bin2Dec(substr($rg_album_adjustment, 3, 3));
+			$parsedFrame['raw']['album']['signbit']    = getid3_lib::Bin2Dec(substr($rg_album_adjustment, 6, 1));
+			$parsedFrame['raw']['album']['adjustment'] = getid3_lib::Bin2Dec(substr($rg_album_adjustment, 7, 9));
+			$parsedFrame['track']['name']       = getid3_lib::RGADnameLookup($parsedFrame['raw']['track']['name']);
+			$parsedFrame['track']['originator'] = getid3_lib::RGADoriginatorLookup($parsedFrame['raw']['track']['originator']);
+			$parsedFrame['track']['adjustment'] = getid3_lib::RGADadjustmentLookup($parsedFrame['raw']['track']['adjustment'], $parsedFrame['raw']['track']['signbit']);
+			$parsedFrame['album']['name']       = getid3_lib::RGADnameLookup($parsedFrame['raw']['album']['name']);
+			$parsedFrame['album']['originator'] = getid3_lib::RGADoriginatorLookup($parsedFrame['raw']['album']['originator']);
+			$parsedFrame['album']['adjustment'] = getid3_lib::RGADadjustmentLookup($parsedFrame['raw']['album']['adjustment'], $parsedFrame['raw']['album']['signbit']);
+
+			$ThisFileInfo['replay_gain']['track']['peak']       = $parsedFrame['peakamplitude'];
+			$ThisFileInfo['replay_gain']['track']['originator'] = $parsedFrame['track']['originator'];
+			$ThisFileInfo['replay_gain']['track']['adjustment'] = $parsedFrame['track']['adjustment'];
+			$ThisFileInfo['replay_gain']['album']['originator'] = $parsedFrame['album']['originator'];
+			$ThisFileInfo['replay_gain']['album']['adjustment'] = $parsedFrame['album']['adjustment'];
+
+			unset($parsedFrame['data']);
+
+		}
+
+		return true;
+	}
+
+
+	function DeUnsynchronise($data) {
+		return str_replace(&quot;\xFF\x00&quot;, &quot;\xFF&quot;, $data);
+	}
+
+	function LookupCurrencyUnits($currencyid) {
+
+		$begin = __LINE__;
+
+		/** This is not a comment!
+
+
+			AED	Dirhams
+			AFA	Afghanis
+			ALL	Leke
+			AMD	Drams
+			ANG	Guilders
+			AOA	Kwanza
+			ARS	Pesos
+			ATS	Schillings
+			AUD	Dollars
+			AWG	Guilders
+			AZM	Manats
+			BAM	Convertible Marka
+			BBD	Dollars
+			BDT	Taka
+			BEF	Francs
+			BGL	Leva
+			BHD	Dinars
+			BIF	Francs
+			BMD	Dollars
+			BND	Dollars
+			BOB	Bolivianos
+			BRL	Brazil Real
+			BSD	Dollars
+			BTN	Ngultrum
+			BWP	Pulas
+			BYR	Rubles
+			BZD	Dollars
+			CAD	Dollars
+			CDF	Congolese Francs
+			CHF	Francs
+			CLP	Pesos
+			CNY	Yuan Renminbi
+			COP	Pesos
+			CRC	Colones
+			CUP	Pesos
+			CVE	Escudos
+			CYP	Pounds
+			CZK	Koruny
+			DEM	Deutsche Marks
+			DJF	Francs
+			DKK	Kroner
+			DOP	Pesos
+			DZD	Algeria Dinars
+			EEK	Krooni
+			EGP	Pounds
+			ERN	Nakfa
+			ESP	Pesetas
+			ETB	Birr
+			EUR	Euro
+			FIM	Markkaa
+			FJD	Dollars
+			FKP	Pounds
+			FRF	Francs
+			GBP	Pounds
+			GEL	Lari
+			GGP	Pounds
+			GHC	Cedis
+			GIP	Pounds
+			GMD	Dalasi
+			GNF	Francs
+			GRD	Drachmae
+			GTQ	Quetzales
+			GYD	Dollars
+			HKD	Dollars
+			HNL	Lempiras
+			HRK	Kuna
+			HTG	Gourdes
+			HUF	Forints
+			IDR	Rupiahs
+			IEP	Pounds
+			ILS	New Shekels
+			IMP	Pounds
+			INR	Rupees
+			IQD	Dinars
+			IRR	Rials
+			ISK	Kronur
+			ITL	Lire
+			JEP	Pounds
+			JMD	Dollars
+			JOD	Dinars
+			JPY	Yen
+			KES	Shillings
+			KGS	Soms
+			KHR	Riels
+			KMF	Francs
+			KPW	Won
+			KWD	Dinars
+			KYD	Dollars
+			KZT	Tenge
+			LAK	Kips
+			LBP	Pounds
+			LKR	Rupees
+			LRD	Dollars
+			LSL	Maloti
+			LTL	Litai
+			LUF	Francs
+			LVL	Lati
+			LYD	Dinars
+			MAD	Dirhams
+			MDL	Lei
+			MGF	Malagasy Francs
+			MKD	Denars
+			MMK	Kyats
+			MNT	Tugriks
+			MOP	Patacas
+			MRO	Ouguiyas
+			MTL	Liri
+			MUR	Rupees
+			MVR	Rufiyaa
+			MWK	Kwachas
+			MXN	Pesos
+			MYR	Ringgits
+			MZM	Meticais
+			NAD	Dollars
+			NGN	Nairas
+			NIO	Gold Cordobas
+			NLG	Guilders
+			NOK	Krone
+			NPR	Nepal Rupees
+			NZD	Dollars
+			OMR	Rials
+			PAB	Balboa
+			PEN	Nuevos Soles
+			PGK	Kina
+			PHP	Pesos
+			PKR	Rupees
+			PLN	Zlotych
+			PTE	Escudos
+			PYG	Guarani
+			QAR	Rials
+			ROL	Lei
+			RUR	Rubles
+			RWF	Rwanda Francs
+			SAR	Riyals
+			SBD	Dollars
+			SCR	Rupees
+			SDD	Dinars
+			SEK	Kronor
+			SGD	Dollars
+			SHP	Pounds
+			SIT	Tolars
+			SKK	Koruny
+			SLL	Leones
+			SOS	Shillings
+			SPL	Luigini
+			SRG	Guilders
+			STD	Dobras
+			SVC	Colones
+			SYP	Pounds
+			SZL	Emalangeni
+			THB	Baht
+			TJR	Rubles
+			TMM	Manats
+			TND	Dinars
+			TOP	Pa'anga
+			TRL	Liras
+			TTD	Dollars
+			TVD	Tuvalu Dollars
+			TWD	New Dollars
+			TZS	Shillings
+			UAH	Hryvnia
+			UGX	Shillings
+			USD	Dollars
+			UYU	Pesos
+			UZS	Sums
+			VAL	Lire
+			VEB	Bolivares
+			VND	Dong
+			VUV	Vatu
+			WST	Tala
+			XAF	Francs
+			XAG	Ounces
+			XAU	Ounces
+			XCD	Dollars
+			XDR	Special Drawing Rights
+			XPD	Ounces
+			XPF	Francs
+			XPT	Ounces
+			YER	Rials
+			YUM	New Dinars
+			ZAR	Rand
+			ZMK	Kwacha
+			ZWD	Zimbabwe Dollars
+
+		*/
+
+		return getid3_lib::EmbeddedLookup($currencyid, $begin, __LINE__, __FILE__, 'id3v2-currency-units');
+	}
+
+
+	function LookupCurrencyCountry($currencyid) {
+
+		$begin = __LINE__;
+
+		/** This is not a comment!
+
+			AED	United Arab Emirates
+			AFA	Afghanistan
+			ALL	Albania
+			AMD	Armenia
+			ANG	Netherlands Antilles
+			AOA	Angola
+			ARS	Argentina
+			ATS	Austria
+			AUD	Australia
+			AWG	Aruba
+			AZM	Azerbaijan
+			BAM	Bosnia and Herzegovina
+			BBD	Barbados
+			BDT	Bangladesh
+			BEF	Belgium
+			BGL	Bulgaria
+			BHD	Bahrain
+			BIF	Burundi
+			BMD	Bermuda
+			BND	Brunei Darussalam
+			BOB	Bolivia
+			BRL	Brazil
+			BSD	Bahamas
+			BTN	Bhutan
+			BWP	Botswana
+			BYR	Belarus
+			BZD	Belize
+			CAD	Canada
+			CDF	Congo/Kinshasa
+			CHF	Switzerland
+			CLP	Chile
+			CNY	China
+			COP	Colombia
+			CRC	Costa Rica
+			CUP	Cuba
+			CVE	Cape Verde
+			CYP	Cyprus
+			CZK	Czech Republic
+			DEM	Germany
+			DJF	Djibouti
+			DKK	Denmark
+			DOP	Dominican Republic
+			DZD	Algeria
+			EEK	Estonia
+			EGP	Egypt
+			ERN	Eritrea
+			ESP	Spain
+			ETB	Ethiopia
+			EUR	Euro Member Countries
+			FIM	Finland
+			FJD	Fiji
+			FKP	Falkland Islands (Malvinas)
+			FRF	France
+			GBP	United Kingdom
+			GEL	Georgia
+			GGP	Guernsey
+			GHC	Ghana
+			GIP	Gibraltar
+			GMD	Gambia
+			GNF	Guinea
+			GRD	Greece
+			GTQ	Guatemala
+			GYD	Guyana
+			HKD	Hong Kong
+			HNL	Honduras
+			HRK	Croatia
+			HTG	Haiti
+			HUF	Hungary
+			IDR	Indonesia
+			IEP	Ireland (Eire)
+			ILS	Israel
+			IMP	Isle of Man
+			INR	India
+			IQD	Iraq
+			IRR	Iran
+			ISK	Iceland
+			ITL	Italy
+			JEP	Jersey
+			JMD	Jamaica
+			JOD	Jordan
+			JPY	Japan
+			KES	Kenya
+			KGS	Kyrgyzstan
+			KHR	Cambodia
+			KMF	Comoros
+			KPW	Korea
+			KWD	Kuwait
+			KYD	Cayman Islands
+			KZT	Kazakstan
+			LAK	Laos
+			LBP	Lebanon
+			LKR	Sri Lanka
+			LRD	Liberia
+			LSL	Lesotho
+			LTL	Lithuania
+			LUF	Luxembourg
+			LVL	Latvia
+			LYD	Libya
+			MAD	Morocco
+			MDL	Moldova
+			MGF	Madagascar
+			MKD	Macedonia
+			MMK	Myanmar (Burma)
+			MNT	Mongolia
+			MOP	Macau
+			MRO	Mauritania
+			MTL	Malta
+			MUR	Mauritius
+			MVR	Maldives (Maldive Islands)
+			MWK	Malawi
+			MXN	Mexico
+			MYR	Malaysia
+			MZM	Mozambique
+			NAD	Namibia
+			NGN	Nigeria
+			NIO	Nicaragua
+			NLG	Netherlands (Holland)
+			NOK	Norway
+			NPR	Nepal
+			NZD	New Zealand
+			OMR	Oman
+			PAB	Panama
+			PEN	Peru
+			PGK	Papua New Guinea
+			PHP	Philippines
+			PKR	Pakistan
+			PLN	Poland
+			PTE	Portugal
+			PYG	Paraguay
+			QAR	Qatar
+			ROL	Romania
+			RUR	Russia
+			RWF	Rwanda
+			SAR	Saudi Arabia
+			SBD	Solomon Islands
+			SCR	Seychelles
+			SDD	Sudan
+			SEK	Sweden
+			SGD	Singapore
+			SHP	Saint Helena
+			SIT	Slovenia
+			SKK	Slovakia
+			SLL	Sierra Leone
+			SOS	Somalia
+			SPL	Seborga
+			SRG	Suriname
+			STD	S&#227;o Tome and Principe
+			SVC	El Salvador
+			SYP	Syria
+			SZL	Swaziland
+			THB	Thailand
+			TJR	Tajikistan
+			TMM	Turkmenistan
+			TND	Tunisia
+			TOP	Tonga
+			TRL	Turkey
+			TTD	Trinidad and Tobago
+			TVD	Tuvalu
+			TWD	Taiwan
+			TZS	Tanzania
+			UAH	Ukraine
+			UGX	Uganda
+			USD	United States of America
+			UYU	Uruguay
+			UZS	Uzbekistan
+			VAL	Vatican City
+			VEB	Venezuela
+			VND	Viet Nam
+			VUV	Vanuatu
+			WST	Samoa
+			XAF	Communaut&#233; Financi&#232;re Africaine
+			XAG	Silver
+			XAU	Gold
+			XCD	East Caribbean
+			XDR	International Monetary Fund
+			XPD	Palladium
+			XPF	Comptoirs Fran&#231;ais du Pacifique
+			XPT	Platinum
+			YER	Yemen
+			YUM	Yugoslavia
+			ZAR	South Africa
+			ZMK	Zambia
+			ZWD	Zimbabwe
+
+		*/
+
+		return getid3_lib::EmbeddedLookup($currencyid, $begin, __LINE__, __FILE__, 'id3v2-currency-country');
+	}
+
+
+
+	function LanguageLookup($languagecode, $casesensitive=false) {
+
+		if (!$casesensitive) {
+			$languagecode = strtolower($languagecode);
+		}
+
+		// <A HREF="http://www.id3.org/id3v2.4.0-structure.txt">http://www.id3.org/id3v2.4.0-structure.txt</A>
+		// [4.   ID3v2 frame overview]
+		// The three byte language field, present in several frames, is used to
+		// describe the language of the frame's content, according to ISO-639-2
+		// [ISO-639-2]. The language should be represented in lower case. If the
+		// language is not known the string &quot;XXX&quot; should be used.
+
+
+		// ISO 639-2 - <A HREF="http://www.id3.org/iso639-2.html">http://www.id3.org/iso639-2.html</A>
+
+		$begin = __LINE__;
+
+		/** This is not a comment!
+
+			XXX	unknown
+			xxx	unknown
+			aar	Afar
+			abk	Abkhazian
+			ace	Achinese
+			ach	Acoli
+			ada	Adangme
+			afa	Afro-Asiatic (Other)
+			afh	Afrihili
+			afr	Afrikaans
+			aka	Akan
+			akk	Akkadian
+			alb	Albanian
+			ale	Aleut
+			alg	Algonquian Languages
+			amh	Amharic
+			ang	English, Old (ca. 450-1100)
+			apa	Apache Languages
+			ara	Arabic
+			arc	Aramaic
+			arm	Armenian
+			arn	Araucanian
+			arp	Arapaho
+			art	Artificial (Other)
+			arw	Arawak
+			asm	Assamese
+			ath	Athapascan Languages
+			ava	Avaric
+			ave	Avestan
+			awa	Awadhi
+			aym	Aymara
+			aze	Azerbaijani
+			bad	Banda
+			bai	Bamileke Languages
+			bak	Bashkir
+			bal	Baluchi
+			bam	Bambara
+			ban	Balinese
+			baq	Basque
+			bas	Basa
+			bat	Baltic (Other)
+			bej	Beja
+			bel	Byelorussian
+			bem	Bemba
+			ben	Bengali
+			ber	Berber (Other)
+			bho	Bhojpuri
+			bih	Bihari
+			bik	Bikol
+			bin	Bini
+			bis	Bislama
+			bla	Siksika
+			bnt	Bantu (Other)
+			bod	Tibetan
+			bra	Braj
+			bre	Breton
+			bua	Buriat
+			bug	Buginese
+			bul	Bulgarian
+			bur	Burmese
+			cad	Caddo
+			cai	Central American Indian (Other)
+			car	Carib
+			cat	Catalan
+			cau	Caucasian (Other)
+			ceb	Cebuano
+			cel	Celtic (Other)
+			ces	Czech
+			cha	Chamorro
+			chb	Chibcha
+			che	Chechen
+			chg	Chagatai
+			chi	Chinese
+			chm	Mari
+			chn	Chinook jargon
+			cho	Choctaw
+			chr	Cherokee
+			chu	Church Slavic
+			chv	Chuvash
+			chy	Cheyenne
+			cop	Coptic
+			cor	Cornish
+			cos	Corsican
+			cpe	Creoles and Pidgins, English-based (Other)
+			cpf	Creoles and Pidgins, French-based (Other)
+			cpp	Creoles and Pidgins, Portuguese-based (Other)
+			cre	Cree
+			crp	Creoles and Pidgins (Other)
+			cus	Cushitic (Other)
+			cym	Welsh
+			cze	Czech
+			dak	Dakota
+			dan	Danish
+			del	Delaware
+			deu	German
+			din	Dinka
+			div	Divehi
+			doi	Dogri
+			dra	Dravidian (Other)
+			dua	Duala
+			dum	Dutch, Middle (ca. 1050-1350)
+			dut	Dutch
+			dyu	Dyula
+			dzo	Dzongkha
+			efi	Efik
+			egy	Egyptian (Ancient)
+			eka	Ekajuk
+			ell	Greek, Modern (1453-)
+			elx	Elamite
+			eng	English
+			enm	English, Middle (ca. 1100-1500)
+			epo	Esperanto
+			esk	Eskimo (Other)
+			esl	Spanish
+			est	Estonian
+			eus	Basque
+			ewe	Ewe
+			ewo	Ewondo
+			fan	Fang
+			fao	Faroese
+			fas	Persian
+			fat	Fanti
+			fij	Fijian
+			fin	Finnish
+			fiu	Finno-Ugrian (Other)
+			fon	Fon
+			fra	French
+			fre	French
+			frm	French, Middle (ca. 1400-1600)
+			fro	French, Old (842- ca. 1400)
+			fry	Frisian
+			ful	Fulah
+			gaa	Ga
+			gae	Gaelic (Scots)
+			gai	Irish
+			gay	Gayo
+			gdh	Gaelic (Scots)
+			gem	Germanic (Other)
+			geo	Georgian
+			ger	German
+			gez	Geez
+			gil	Gilbertese
+			glg	Gallegan
+			gmh	German, Middle High (ca. 1050-1500)
+			goh	German, Old High (ca. 750-1050)
+			gon	Gondi
+			got	Gothic
+			grb	Grebo
+			grc	Greek, Ancient (to 1453)
+			gre	Greek, Modern (1453-)
+			grn	Guarani
+			guj	Gujarati
+			hai	Haida
+			hau	Hausa
+			haw	Hawaiian
+			heb	Hebrew
+			her	Herero
+			hil	Hiligaynon
+			him	Himachali
+			hin	Hindi
+			hmo	Hiri Motu
+			hun	Hungarian
+			hup	Hupa
+			hye	Armenian
+			iba	Iban
+			ibo	Igbo
+			ice	Icelandic
+			ijo	Ijo
+			iku	Inuktitut
+			ilo	Iloko
+			ina	Interlingua (International Auxiliary language Association)
+			inc	Indic (Other)
+			ind	Indonesian
+			ine	Indo-European (Other)
+			ine	Interlingue
+			ipk	Inupiak
+			ira	Iranian (Other)
+			iri	Irish
+			iro	Iroquoian uages
+			isl	Icelandic
+			ita	Italian
+			jav	Javanese
+			jaw	Javanese
+			jpn	Japanese
+			jpr	Judeo-Persian
+			jrb	Judeo-Arabic
+			kaa	Kara-Kalpak
+			kab	Kabyle
+			kac	Kachin
+			kal	Greenlandic
+			kam	Kamba
+			kan	Kannada
+			kar	Karen
+			kas	Kashmiri
+			kat	Georgian
+			kau	Kanuri
+			kaw	Kawi
+			kaz	Kazakh
+			kha	Khasi
+			khi	Khoisan (Other)
+			khm	Khmer
+			kho	Khotanese
+			kik	Kikuyu
+			kin	Kinyarwanda
+			kir	Kirghiz
+			kok	Konkani
+			kom	Komi
+			kon	Kongo
+			kor	Korean
+			kpe	Kpelle
+			kro	Kru
+			kru	Kurukh
+			kua	Kuanyama
+			kum	Kumyk
+			kur	Kurdish
+			kus	Kusaie
+			kut	Kutenai
+			lad	Ladino
+			lah	Lahnda
+			lam	Lamba
+			lao	Lao
+			lat	Latin
+			lav	Latvian
+			lez	Lezghian
+			lin	Lingala
+			lit	Lithuanian
+			lol	Mongo
+			loz	Lozi
+			ltz	Letzeburgesch
+			lub	Luba-Katanga
+			lug	Ganda
+			lui	Luiseno
+			lun	Lunda
+			luo	Luo (Kenya and Tanzania)
+			mac	Macedonian
+			mad	Madurese
+			mag	Magahi
+			mah	Marshall
+			mai	Maithili
+			mak	Macedonian
+			mak	Makasar
+			mal	Malayalam
+			man	Mandingo
+			mao	Maori
+			map	Austronesian (Other)
+			mar	Marathi
+			mas	Masai
+			max	Manx
+			may	Malay
+			men	Mende
+			mga	Irish, Middle (900 - 1200)
+			mic	Micmac
+			min	Minangkabau
+			mis	Miscellaneous (Other)
+			mkh	Mon-Kmer (Other)
+			mlg	Malagasy
+			mlt	Maltese
+			mni	Manipuri
+			mno	Manobo Languages
+			moh	Mohawk
+			mol	Moldavian
+			mon	Mongolian
+			mos	Mossi
+			mri	Maori
+			msa	Malay
+			mul	Multiple Languages
+			mun	Munda Languages
+			mus	Creek
+			mwr	Marwari
+			mya	Burmese
+			myn	Mayan Languages
+			nah	Aztec
+			nai	North American Indian (Other)
+			nau	Nauru
+			nav	Navajo
+			nbl	Ndebele, South
+			nde	Ndebele, North
+			ndo	Ndongo
+			nep	Nepali
+			new	Newari
+			nic	Niger-Kordofanian (Other)
+			niu	Niuean
+			nla	Dutch
+			nno	Norwegian (Nynorsk)
+			non	Norse, Old
+			nor	Norwegian
+			nso	Sotho, Northern
+			nub	Nubian Languages
+			nya	Nyanja
+			nym	Nyamwezi
+			nyn	Nyankole
+			nyo	Nyoro
+			nzi	Nzima
+			oci	Langue d'Oc (post 1500)
+			oji	Ojibwa
+			ori	Oriya
+			orm	Oromo
+			osa	Osage
+			oss	Ossetic
+			ota	Turkish, Ottoman (1500 - 1928)
+			oto	Otomian Languages
+			paa	Papuan-Australian (Other)
+			pag	Pangasinan
+			pal	Pahlavi
+			pam	Pampanga
+			pan	Panjabi
+			pap	Papiamento
+			pau	Palauan
+			peo	Persian, Old (ca 600 - 400 B.C.)
+			per	Persian
+			phn	Phoenician
+			pli	Pali
+			pol	Polish
+			pon	Ponape
+			por	Portuguese
+			pra	Prakrit uages
+			pro	Provencal, Old (to 1500)
+			pus	Pushto
+			que	Quechua
+			raj	Rajasthani
+			rar	Rarotongan
+			roa	Romance (Other)
+			roh	Rhaeto-Romance
+			rom	Romany
+			ron	Romanian
+			rum	Romanian
+			run	Rundi
+			rus	Russian
+			sad	Sandawe
+			sag	Sango
+			sah	Yakut
+			sai	South American Indian (Other)
+			sal	Salishan Languages
+			sam	Samaritan Aramaic
+			san	Sanskrit
+			sco	Scots
+			scr	Serbo-Croatian
+			sel	Selkup
+			sem	Semitic (Other)
+			sga	Irish, Old (to 900)
+			shn	Shan
+			sid	Sidamo
+			sin	Singhalese
+			sio	Siouan Languages
+			sit	Sino-Tibetan (Other)
+			sla	Slavic (Other)
+			slk	Slovak
+			slo	Slovak
+			slv	Slovenian
+			smi	Sami Languages
+			smo	Samoan
+			sna	Shona
+			snd	Sindhi
+			sog	Sogdian
+			som	Somali
+			son	Songhai
+			sot	Sotho, Southern
+			spa	Spanish
+			sqi	Albanian
+			srd	Sardinian
+			srr	Serer
+			ssa	Nilo-Saharan (Other)
+			ssw	Siswant
+			ssw	Swazi
+			suk	Sukuma
+			sun	Sudanese
+			sus	Susu
+			sux	Sumerian
+			sve	Swedish
+			swa	Swahili
+			swe	Swedish
+			syr	Syriac
+			tah	Tahitian
+			tam	Tamil
+			tat	Tatar
+			tel	Telugu
+			tem	Timne
+			ter	Tereno
+			tgk	Tajik
+			tgl	Tagalog
+			tha	Thai
+			tib	Tibetan
+			tig	Tigre
+			tir	Tigrinya
+			tiv	Tivi
+			tli	Tlingit
+			tmh	Tamashek
+			tog	Tonga (Nyasa)
+			ton	Tonga (Tonga Islands)
+			tru	Truk
+			tsi	Tsimshian
+			tsn	Tswana
+			tso	Tsonga
+			tuk	Turkmen
+			tum	Tumbuka
+			tur	Turkish
+			tut	Altaic (Other)
+			twi	Twi
+			tyv	Tuvinian
+			uga	Ugaritic
+			uig	Uighur
+			ukr	Ukrainian
+			umb	Umbundu
+			und	Undetermined
+			urd	Urdu
+			uzb	Uzbek
+			vai	Vai
+			ven	Venda
+			vie	Vietnamese
+			vol	Volap&#252;k
+			vot	Votic
+			wak	Wakashan Languages
+			wal	Walamo
+			war	Waray
+			was	Washo
+			wel	Welsh
+			wen	Sorbian Languages
+			wol	Wolof
+			xho	Xhosa
+			yao	Yao
+			yap	Yap
+			yid	Yiddish
+			yor	Yoruba
+			zap	Zapotec
+			zen	Zenaga
+			zha	Zhuang
+			zho	Chinese
+			zul	Zulu
+			zun	Zuni
+
+		*/
+
+		return getid3_lib::EmbeddedLookup($languagecode, $begin, __LINE__, __FILE__, 'id3v2-languagecode');
+	}
+
+
+	function ETCOEventLookup($index) {
+        if (($index &gt;= 0x17) &amp;&amp; ($index &lt;= 0xDF)) {
+		    return 'reserved for future use';
+	    }
+		if (($index &gt;= 0xE0) &amp;&amp; ($index &lt;= 0xEF)) {
+			return 'not predefined synch 0-F';
+		}
+		if (($index &gt;= 0xF0) &amp;&amp; ($index &lt;= 0xFC)) {
+			return 'reserved for future use';
+		}
+
+		static $EventLookup = array(
+			0x00 =&gt; 'padding (has no meaning)',
+			0x01 =&gt; 'end of initial silence',
+			0x02 =&gt; 'intro start',
+			0x03 =&gt; 'main part start',
+			0x04 =&gt; 'outro start',
+			0x05 =&gt; 'outro end',
+			0x06 =&gt; 'verse start',
+			0x07 =&gt; 'refrain start',
+			0x08 =&gt; 'interlude start',
+			0x09 =&gt; 'theme start',
+			0x0A =&gt; 'variation start',
+			0x0B =&gt; 'key change',
+			0x0C =&gt; 'time change',
+			0x0D =&gt; 'momentary unwanted noise (Snap, Crackle &amp; Pop)',
+			0x0E =&gt; 'sustained noise',
+			0x0F =&gt; 'sustained noise end',
+			0x10 =&gt; 'intro end',
+			0x11 =&gt; 'main part end',
+			0x12 =&gt; 'verse end',
+			0x13 =&gt; 'refrain end',
+			0x14 =&gt; 'theme end',
+			0x15 =&gt; 'profanity',
+			0x16 =&gt; 'profanity end',
+			0xFD =&gt; 'audio end (start of silence)',
+			0xFE =&gt; 'audio file ends',
+			0xFF =&gt; 'one more byte of events follows'
+		);
+
+		return (isset($EventLookup[$index]) ? $EventLookup[$index] : '');
+	}
+
+	function SYTLContentTypeLookup($index) {
+		static $SYTLContentTypeLookup = array(
+			0x00 =&gt; 'other',
+			0x01 =&gt; 'lyrics',
+			0x02 =&gt; 'text transcription',
+			0x03 =&gt; 'movement/part name', // (e.g. 'Adagio')
+			0x04 =&gt; 'events',             // (e.g. 'Don Quijote enters the stage')
+			0x05 =&gt; 'chord',              // (e.g. 'Bb F Fsus')
+			0x06 =&gt; 'trivia/\'pop up\' information',
+			0x07 =&gt; 'URLs to webpages',
+			0x08 =&gt; 'URLs to images'
+		);
+
+		return (isset($SYTLContentTypeLookup[$index]) ? $SYTLContentTypeLookup[$index] : '');
+	}
+
+	function APICPictureTypeLookup($index, $returnarray=false) {
+		static $APICPictureTypeLookup = array(
+			0x00 =&gt; 'Other',
+			0x01 =&gt; '32x32 pixels \'file icon\' (PNG only)',
+			0x02 =&gt; 'Other file icon',
+			0x03 =&gt; 'Cover (front)',
+			0x04 =&gt; 'Cover (back)',
+			0x05 =&gt; 'Leaflet page',
+			0x06 =&gt; 'Media (e.g. label side of CD)',
+			0x07 =&gt; 'Lead artist/lead performer/soloist',
+			0x08 =&gt; 'Artist/performer',
+			0x09 =&gt; 'Conductor',
+			0x0A =&gt; 'Band/Orchestra',
+			0x0B =&gt; 'Composer',
+			0x0C =&gt; 'Lyricist/text writer',
+			0x0D =&gt; 'Recording Location',
+			0x0E =&gt; 'During recording',
+			0x0F =&gt; 'During performance',
+			0x10 =&gt; 'Movie/video screen capture',
+			0x11 =&gt; 'A bright coloured fish',
+			0x12 =&gt; 'Illustration',
+			0x13 =&gt; 'Band/artist logotype',
+			0x14 =&gt; 'Publisher/Studio logotype'
+		);
+		if ($returnarray) {
+			return $APICPictureTypeLookup;
+		}
+		return (isset($APICPictureTypeLookup[$index]) ? $APICPictureTypeLookup[$index] : '');
+	}
+
+	function COMRReceivedAsLookup($index) {
+		static $COMRReceivedAsLookup = array(
+			0x00 =&gt; 'Other',
+			0x01 =&gt; 'Standard CD album with other songs',
+			0x02 =&gt; 'Compressed audio on CD',
+			0x03 =&gt; 'File over the Internet',
+			0x04 =&gt; 'Stream over the Internet',
+			0x05 =&gt; 'As note sheets',
+			0x06 =&gt; 'As note sheets in a book with other sheets',
+			0x07 =&gt; 'Music on other media',
+			0x08 =&gt; 'Non-musical merchandise'
+		);
+
+		return (isset($COMRReceivedAsLookup[$index]) ? $COMRReceivedAsLookup[$index] : '');
+	}
+
+	function RVA2ChannelTypeLookup($index) {
+		static $RVA2ChannelTypeLookup = array(
+			0x00 =&gt; 'Other',
+			0x01 =&gt; 'Master volume',
+			0x02 =&gt; 'Front right',
+			0x03 =&gt; 'Front left',
+			0x04 =&gt; 'Back right',
+			0x05 =&gt; 'Back left',
+			0x06 =&gt; 'Front centre',
+			0x07 =&gt; 'Back centre',
+			0x08 =&gt; 'Subwoofer'
+		);
+
+		return (isset($RVA2ChannelTypeLookup[$index]) ? $RVA2ChannelTypeLookup[$index] : '');
+	}
+
+	function FrameNameLongLookup($framename) {
+
+		$begin = __LINE__;
+
+		/** This is not a comment!
+
+			AENC	Audio encryption
+			APIC	Attached picture
+			ASPI	Audio seek point index
+			BUF	Recommended buffer size
+			CNT	Play counter
+			COM	Comments
+			COMM	Comments
+			COMR	Commercial frame
+			CRA	Audio encryption
+			CRM	Encrypted meta frame
+			ENCR	Encryption method registration
+			EQU	Equalisation
+			EQU2	Equalisation (2)
+			EQUA	Equalisation
+			ETC	Event timing codes
+			ETCO	Event timing codes
+			GEO	General encapsulated object
+			GEOB	General encapsulated object
+			GRID	Group identification registration
+			IPL	Involved people list
+			IPLS	Involved people list
+			LINK	Linked information
+			LNK	Linked information
+			MCDI	Music CD identifier
+			MCI	Music CD Identifier
+			MLL	MPEG location lookup table
+			MLLT	MPEG location lookup table
+			OWNE	Ownership frame
+			PCNT	Play counter
+			PIC	Attached picture
+			POP	Popularimeter
+			POPM	Popularimeter
+			POSS	Position synchronisation frame
+			PRIV	Private frame
+			RBUF	Recommended buffer size
+			REV	Reverb
+			RVA	Relative volume adjustment
+			RVA2	Relative volume adjustment (2)
+			RVAD	Relative volume adjustment
+			RVRB	Reverb
+			SEEK	Seek frame
+			SIGN	Signature frame
+			SLT	Synchronised lyric/text
+			STC	Synced tempo codes
+			SYLT	Synchronised lyric/text
+			SYTC	Synchronised tempo codes
+			TAL	Album/Movie/Show title
+			TALB	Album/Movie/Show title
+			TBP	BPM (Beats Per Minute)
+			TBPM	BPM (beats per minute)
+			TCM	Composer
+			TCO	Content type
+			TCOM	Composer
+			TCON	Content type
+			TCOP	Copyright message
+			TCR	Copyright message
+			TDA	Date
+			TDAT	Date
+			TDEN	Encoding time
+			TDLY	Playlist delay
+			TDOR	Original release time
+			TDRC	Recording time
+			TDRL	Release time
+			TDTG	Tagging time
+			TDY	Playlist delay
+			TEN	Encoded by
+			TENC	Encoded by
+			TEXT	Lyricist/Text writer
+			TFLT	File type
+			TFT	File type
+			TIM	Time
+			TIME	Time
+			TIPL	Involved people list
+			TIT1	Content group description
+			TIT2	Title/songname/content description
+			TIT3	Subtitle/Description refinement
+			TKE	Initial key
+			TKEY	Initial key
+			TLA	Language(s)
+			TLAN	Language(s)
+			TLE	Length
+			TLEN	Length
+			TMCL	Musician credits list
+			TMED	Media type
+			TMOO	Mood
+			TMT	Media type
+			TOA	Original artist(s)/performer(s)
+			TOAL	Original album/movie/show title
+			TOF	Original filename
+			TOFN	Original filename
+			TOL	Original Lyricist(s)/text writer(s)
+			TOLY	Original lyricist(s)/text writer(s)
+			TOPE	Original artist(s)/performer(s)
+			TOR	Original release year
+			TORY	Original release year
+			TOT	Original album/Movie/Show title
+			TOWN	File owner/licensee
+			TP1	Lead artist(s)/Lead performer(s)/Soloist(s)/Performing group
+			TP2	Band/Orchestra/Accompaniment
+			TP3	Conductor/Performer refinement
+			TP4	Interpreted, remixed, or otherwise modified by
+			TPA	Part of a set
+			TPB	Publisher
+			TPE1	Lead performer(s)/Soloist(s)
+			TPE2	Band/orchestra/accompaniment
+			TPE3	Conductor/performer refinement
+			TPE4	Interpreted, remixed, or otherwise modified by
+			TPOS	Part of a set
+			TPRO	Produced notice
+			TPUB	Publisher
+			TRC	ISRC (International Standard Recording Code)
+			TRCK	Track number/Position in set
+			TRD	Recording dates
+			TRDA	Recording dates
+			TRK	Track number/Position in set
+			TRSN	Internet radio station name
+			TRSO	Internet radio station owner
+			TSI	Size
+			TSIZ	Size
+			TSOA	Album sort order
+			TSOP	Performer sort order
+			TSOT	Title sort order
+			TSRC	ISRC (international standard recording code)
+			TSS	Software/hardware and settings used for encoding
+			TSSE	Software/Hardware and settings used for encoding
+			TSST	Set subtitle
+			TT1	Content group description
+			TT2	Title/Songname/Content description
+			TT3	Subtitle/Description refinement
+			TXT	Lyricist/text writer
+			TXX	User defined text information frame
+			TXXX	User defined text information frame
+			TYE	Year
+			TYER	Year
+			UFI	Unique file identifier
+			UFID	Unique file identifier
+			ULT	Unsychronised lyric/text transcription
+			USER	Terms of use
+			USLT	Unsynchronised lyric/text transcription
+			WAF	Official audio file webpage
+			WAR	Official artist/performer webpage
+			WAS	Official audio source webpage
+			WCM	Commercial information
+			WCOM	Commercial information
+			WCOP	Copyright/Legal information
+			WCP	Copyright/Legal information
+			WOAF	Official audio file webpage
+			WOAR	Official artist/performer webpage
+			WOAS	Official audio source webpage
+			WORS	Official Internet radio station homepage
+			WPAY	Payment
+			WPB	Publishers official webpage
+			WPUB	Publishers official webpage
+			WXX	User defined URL link frame
+			WXXX	User defined URL link frame
+			TFEA	Featured Artist
+			TSTU	Recording Studio
+			rgad	Replay Gain Adjustment
+
+		*/
+
+		return getid3_lib::EmbeddedLookup($framename, $begin, __LINE__, __FILE__, 'id3v2-framename_long');
+
+		// Last three:
+		// from Helium2 [www.helium2.com]
+		// from <A HREF="http://privatewww.essex.ac.uk/~djmrob/replaygain/file_format_id3v2.html">http://privatewww.essex.ac.uk/~djmrob/replaygain/file_format_id3v2.html</A>
+	}
+
+
+	function FrameNameShortLookup($framename) {
+
+		$begin = __LINE__;
+
+		/** This is not a comment!
+
+			COM	comment
+			COMM	comment
+			TAL	album
+			TALB	album
+			TBP	bpm
+			TBPM	bpm
+			TCM	composer
+			TCO	genre
+			TCOM	composer
+			TCON	genre
+			TCOP	copyright
+			TCR	copyright
+			TEN	encoded_by
+			TENC	encoded_by
+			TEXT	lyricist
+			TIT1	description
+			TIT2	title
+			TIT3	subtitle
+			TLA	language
+			TLAN	language
+			TLE	length
+			TLEN	length
+			TMOO	mood
+			TOA	original_artist
+			TOAL	original_album
+			TOF	original_filename
+			TOFN	original_filename
+			TOL	original_lyricist
+			TOLY	original_lyricist
+			TOPE	original_artist
+			TOT	original_album
+			TP1	artist
+			TP2	band
+			TP3	conductor
+			TP4	remixer
+			TPB	publisher
+			TPE1	artist
+			TPE2	band
+			TPE3	conductor
+			TPE4	remixer
+			TPUB	publisher
+			TRC	isrc
+			TRCK	track
+			TRK	track
+			TSI	size
+			TSIZ	size
+			TSRC	isrc
+			TSS	encoder_settings
+			TSSE	encoder_settings
+			TSST	subtitle
+			TT1	description
+			TT2	title
+			TT3	subtitle
+			TXT	lyricist
+			TXX	text
+			TXXX	text
+			TYE	year
+			TYER	year
+			UFI	unique_file_identifier
+			UFID	unique_file_identifier
+			ULT	unsychronised_lyric
+			USER	terms_of_use
+			USLT	unsynchronised lyric
+			WAF	url_file
+			WAR	url_artist
+			WAS	url_source
+			WCOP	copyright
+			WCP	copyright
+			WOAF	url_file
+			WOAR	url_artist
+			WOAS	url_souce
+			WORS	url_station
+			WPB	url_publisher
+			WPUB	url_publisher
+			WXX	url_user
+			WXXX	url_user
+			TFEA	featured_artist
+			TSTU	studio
+
+		*/
+
+		return getid3_lib::EmbeddedLookup($framename, $begin, __LINE__, __FILE__, 'id3v2-framename_short');
+	}
+
+	function TextEncodingTerminatorLookup($encoding) {
+		// <A HREF="http://www.id3.org/id3v2.4.0-structure.txt">http://www.id3.org/id3v2.4.0-structure.txt</A>
+		// Frames that allow different types of text encoding contains a text encoding description byte. Possible encodings:
+		// $00  ISO-8859-1. Terminated with $00.
+		// $01  UTF-16 encoded Unicode with BOM. All strings in the same frame SHALL have the same byteorder. Terminated with $00 00.
+		// $02  UTF-16BE encoded Unicode without BOM. Terminated with $00 00.
+		// $03  UTF-8 encoded Unicode. Terminated with $00.
+
+		static $TextEncodingTerminatorLookup = array(0=&gt;&quot;\x00&quot;, 1=&gt;&quot;\x00\x00&quot;, 2=&gt;&quot;\x00\x00&quot;, 3=&gt;&quot;\x00&quot;, 255=&gt;&quot;\x00\x00&quot;);
+
+		return @$TextEncodingTerminatorLookup[$encoding];
+	}
+
+	function TextEncodingNameLookup($encoding) {
+		// <A HREF="http://www.id3.org/id3v2.4.0-structure.txt">http://www.id3.org/id3v2.4.0-structure.txt</A>
+		static $TextEncodingNameLookup = array(0=&gt;'ISO-8859-1', 1=&gt;'UTF-16', 2=&gt;'UTF-16BE', 3=&gt;'UTF-8', 255=&gt;'UTF-16BE');
+		return (isset($TextEncodingNameLookup[$encoding]) ? $TextEncodingNameLookup[$encoding] : 'ISO-8859-1');
+	}
+
+	function IsValidID3v2FrameName($framename, $id3v2majorversion) {
+		switch ($id3v2majorversion) {
+			case 2:
+				return ereg('[A-Z][A-Z0-9]{2}', $framename);
+				break;
+
+			case 3:
+			case 4:
+				return ereg('[A-Z][A-Z0-9]{3}', $framename);
+				break;
+		}
+		return false;
+	}
+
+	function IsANumber($numberstring, $allowdecimal=false, $allownegative=false) {
+		for ($i = 0; $i &lt; strlen($numberstring); $i++) {
+			if ((chr($numberstring{$i}) &lt; chr('0')) || (chr($numberstring{$i}) &gt; chr('9'))) {
+				if (($numberstring{$i} == '.') &amp;&amp; $allowdecimal) {
+					// allowed
+				} elseif (($numberstring{$i} == '-') &amp;&amp; $allownegative &amp;&amp; ($i == 0)) {
+					// allowed
+				} else {
+					return false;
+				}
+			}
+		}
+		return true;
+	}
+
+	function IsValidDateStampString($datestamp) {
+		if (strlen($datestamp) != 8) {
+			return false;
+		}
+		if (!$this-&gt;IsANumber($datestamp, false)) {
+			return false;
+		}
+		$year  = substr($datestamp, 0, 4);
+		$month = substr($datestamp, 4, 2);
+		$day   = substr($datestamp, 6, 2);
+		if (($year == 0) || ($month == 0) || ($day == 0)) {
+			return false;
+		}
+		if ($month &gt; 12) {
+			return false;
+		}
+		if ($day &gt; 31) {
+			return false;
+		}
+		if (($day &gt; 30) &amp;&amp; (($month == 4) || ($month == 6) || ($month == 9) || ($month == 11))) {
+			return false;
+		}
+		if (($day &gt; 29) &amp;&amp; ($month == 2)) {
+			return false;
+		}
+		return true;
+	}
+
+	function ID3v2HeaderLength($majorversion) {
+		return (($majorversion == 2) ? 6 : 10);
+	}
+
+}
+
+?&gt;


Property changes on: trunk/inc/external/getid3/module.tag.id3v2.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/module.tag.lyrics3.php
===================================================================
--- trunk/inc/external/getid3/module.tag.lyrics3.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/module.tag.lyrics3.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,271 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+///                                                            //
+// module.tag.lyrics3.php                                      //
+// module for analyzing Lyrics3 tags                           //
+// dependencies: module.tag.apetag.php (optional)              //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_lyrics3
+{
+
+	function getid3_lyrics3(&amp;$fd, &amp;$ThisFileInfo) {
+		// <A HREF="http://www.volweb.cz/str/tags.htm">http://www.volweb.cz/str/tags.htm</A>
+
+		fseek($fd, (0 - 128 - 9 - 6), SEEK_END);          // end - ID3v1 - LYRICSEND - [Lyrics3size]
+		$lyrics3_id3v1 = fread($fd, 128 + 9 + 6);
+		$lyrics3lsz    = substr($lyrics3_id3v1,  0,   6); // Lyrics3size
+		$lyrics3end    = substr($lyrics3_id3v1,  6,   9); // LYRICSEND or LYRICS200
+		$id3v1tag      = substr($lyrics3_id3v1, 15, 128); // ID3v1
+
+		if ($lyrics3end == 'LYRICSEND') {
+			// Lyrics3v1, ID3v1, no APE
+
+			$lyrics3size    = 5100;
+			$lyrics3offset  = $ThisFileInfo['filesize'] - 128 - $lyrics3size;
+			$lyrics3version = 1;
+
+		} elseif ($lyrics3end == 'LYRICS200') {
+			// Lyrics3v2, ID3v1, no APE
+
+			// LSZ = lyrics + 'LYRICSBEGIN'; add 6-byte size field; add 'LYRICS200'
+			$lyrics3size    = $lyrics3lsz + 6 + strlen('LYRICS200');
+			$lyrics3offset  = $ThisFileInfo['filesize'] - 128 - $lyrics3size;
+			$lyrics3version = 2;
+
+		} elseif (substr(strrev($lyrics3_id3v1), 0, 9) == strrev('LYRICSEND')) {
+			// Lyrics3v1, no ID3v1, no APE
+
+			$lyrics3size    = 5100;
+			$lyrics3offset  = $ThisFileInfo['filesize'] - $lyrics3size;
+			$lyrics3version = 1;
+			$lyrics3offset  = $ThisFileInfo['filesize'] - $lyrics3size;
+
+		} elseif (substr(strrev($lyrics3_id3v1), 0, 9) == strrev('LYRICS200')) {
+
+			// Lyrics3v2, no ID3v1, no APE
+
+			$lyrics3size    = strrev(substr(strrev($lyrics3_id3v1), 9, 6)) + 6 + strlen('LYRICS200'); // LSZ = lyrics + 'LYRICSBEGIN'; add 6-byte size field; add 'LYRICS200'
+			$lyrics3offset  = $ThisFileInfo['filesize'] - $lyrics3size;
+			$lyrics3version = 2;
+
+		} else {
+
+			if (isset($ThisFileInfo['ape']['tag_offset_start']) &amp;&amp; ($ThisFileInfo['ape']['tag_offset_start'] &gt; 15)) {
+
+				fseek($fd, $ThisFileInfo['ape']['tag_offset_start'] - 15, SEEK_SET);
+				$lyrics3lsz = fread($fd, 6);
+				$lyrics3end = fread($fd, 9);
+
+				if ($lyrics3end == 'LYRICSEND') {
+					// Lyrics3v1, APE, maybe ID3v1
+
+					$lyrics3size    = 5100;
+					$lyrics3offset  = $ThisFileInfo['ape']['tag_offset_start'] - $lyrics3size;
+					$ThisFileInfo['avdataend'] = $lyrics3offset;
+					$lyrics3version = 1;
+					$ThisFileInfo['warning'][] = 'APE tag located after Lyrics3, will probably break Lyrics3 compatability';
+
+				} elseif ($lyrics3end == 'LYRICS200') {
+					// Lyrics3v2, APE, maybe ID3v1
+
+					$lyrics3size    = $lyrics3lsz + 6 + strlen('LYRICS200'); // LSZ = lyrics + 'LYRICSBEGIN'; add 6-byte size field; add 'LYRICS200'
+					$lyrics3offset  = $ThisFileInfo['ape']['tag_offset_start'] - $lyrics3size;
+					$lyrics3version = 2;
+					$ThisFileInfo['warning'][] = 'APE tag located after Lyrics3, will probably break Lyrics3 compatability';
+
+				}
+
+			}
+
+		}
+
+		if (isset($lyrics3offset)) {
+			$ThisFileInfo['avdataend'] = $lyrics3offset;
+			$this-&gt;getLyrics3Data($ThisFileInfo, $fd, $lyrics3offset, $lyrics3version, $lyrics3size);
+
+			if (!isset($ThisFileInfo['ape'])) {
+				$GETID3_ERRORARRAY = &amp;$ThisFileInfo['warning'];
+				if (getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.tag.apetag.php', __FILE__, false)) {
+					$tag = new getid3_apetag($fd, $ThisFileInfo, $ThisFileInfo['lyrics3']['tag_offset_start']);
+				}
+			}
+
+		}
+
+		return true;
+	}
+
+	function getLyrics3Data(&amp;$ThisFileInfo, &amp;$fd, $endoffset, $version, $length) {
+		// <A HREF="http://www.volweb.cz/str/tags.htm">http://www.volweb.cz/str/tags.htm</A>
+
+		fseek($fd, $endoffset, SEEK_SET);
+		if ($length &lt;= 0) {
+			return false;
+		}
+		$rawdata = fread($fd, $length);
+
+		if (substr($rawdata, 0, 11) != 'LYRICSBEGIN') {
+			if (strpos($rawdata, 'LYRICSBEGIN') !== false) {
+
+				$ThisFileInfo['warning'][] = '&quot;LYRICSBEGIN&quot; expected at '.$endoffset.' but actually found at '.($endoffset + strpos($rawdata, 'LYRICSBEGIN')).' - this is invalid for Lyrics3 v'.$version;
+				$ThisFileInfo['avdataend'] = $endoffset + strpos($rawdata, 'LYRICSBEGIN');
+				$ParsedLyrics3['tag_offset_start'] = $ThisFileInfo['avdataend'];
+				$rawdata = substr($rawdata, strpos($rawdata, 'LYRICSBEGIN'));
+				$length = strlen($rawdata);
+
+			} else {
+
+				$ThisFileInfo['error'][] = '&quot;LYRICSBEGIN&quot; expected at '.$endoffset.' but found &quot;'.substr($rawdata, 0, 11).'&quot; instead';
+				return false;
+
+			}
+
+		}
+
+		$ParsedLyrics3['raw']['lyrics3version'] = $version;
+		$ParsedLyrics3['raw']['lyrics3tagsize'] = $length;
+		$ParsedLyrics3['tag_offset_start']      = $endoffset;
+		$ParsedLyrics3['tag_offset_end']        = $endoffset + $length;
+
+		switch ($version) {
+
+			case 1:
+				if (substr($rawdata, strlen($rawdata) - 9, 9) == 'LYRICSEND') {
+					$ParsedLyrics3['raw']['LYR'] = trim(substr($rawdata, 11, strlen($rawdata) - 11 - 9));
+					$this-&gt;Lyrics3LyricsTimestampParse($ParsedLyrics3);
+				} else {
+					$ThisFileInfo['error'][] = '&quot;LYRICSEND&quot; expected at '.(ftell($fd) - 11 + $length - 9).' but found &quot;'.substr($rawdata, strlen($rawdata) - 9, 9).'&quot; instead';
+					return false;
+				}
+				break;
+
+			case 2:
+				if (substr($rawdata, strlen($rawdata) - 9, 9) == 'LYRICS200') {
+					$ParsedLyrics3['raw']['unparsed'] = substr($rawdata, 11, strlen($rawdata) - 11 - 9 - 6); // LYRICSBEGIN + LYRICS200 + LSZ
+					$rawdata = $ParsedLyrics3['raw']['unparsed'];
+					while (strlen($rawdata) &gt; 0) {
+						$fieldname = substr($rawdata, 0, 3);
+						$fieldsize = (int) substr($rawdata, 3, 5);
+						$ParsedLyrics3['raw'][$fieldname] = substr($rawdata, 8, $fieldsize);
+						$rawdata = substr($rawdata, 3 + 5 + $fieldsize);
+					}
+
+					if (isset($ParsedLyrics3['raw']['IND'])) {
+						$i = 0;
+						$flagnames = array('lyrics', 'timestamps', 'inhibitrandom');
+						foreach ($flagnames as $flagname) {
+							if (strlen($ParsedLyrics3['raw']['IND']) &gt; ++$i) {
+								$ParsedLyrics3['flags'][$flagname] = $this-&gt;IntString2Bool(substr($ParsedLyrics3['raw']['IND'], $i, 1));
+							}
+						}
+					}
+
+					$fieldnametranslation = array('ETT'=&gt;'title', 'EAR'=&gt;'artist', 'EAL'=&gt;'album', 'INF'=&gt;'comment', 'AUT'=&gt;'author');
+					foreach ($fieldnametranslation as $key =&gt; $value) {
+						if (isset($ParsedLyrics3['raw'][$key])) {
+							$ParsedLyrics3['comments'][$value][] = trim($ParsedLyrics3['raw'][$key]);
+						}
+					}
+
+					if (isset($ParsedLyrics3['raw']['IMG'])) {
+						$imagestrings = explode(&quot;\r\n&quot;, $ParsedLyrics3['raw']['IMG']);
+						foreach ($imagestrings as $key =&gt; $imagestring) {
+							if (strpos($imagestring, '||') !== false) {
+								$imagearray = explode('||', $imagestring);
+								$ParsedLyrics3['images'][$key]['filename']     = $imagearray[0];
+								$ParsedLyrics3['images'][$key]['description']  = $imagearray[1];
+								$ParsedLyrics3['images'][$key]['timestamp']    = $this-&gt;Lyrics3Timestamp2Seconds($imagearray[2]);
+							}
+						}
+					}
+					if (isset($ParsedLyrics3['raw']['LYR'])) {
+						$this-&gt;Lyrics3LyricsTimestampParse($ParsedLyrics3);
+					}
+				} else {
+					$ThisFileInfo['error'][] = '&quot;LYRICS200&quot; expected at '.(ftell($fd) - 11 + $length - 9).' but found &quot;'.substr($rawdata, strlen($rawdata) - 9, 9).'&quot; instead';
+					return false;
+				}
+				break;
+
+			default:
+				$ThisFileInfo['error'][] = 'Cannot process Lyrics3 version '.$version.' (only v1 and v2)';
+				return false;
+				break;
+		}
+
+
+		if (isset($ThisFileInfo['id3v1']['tag_offset_start']) &amp;&amp; ($ThisFileInfo['id3v1']['tag_offset_start'] &lt; $ParsedLyrics3['tag_offset_end'])) {
+			$ThisFileInfo['warning'][] = 'ID3v1 tag information ignored since it appears to be a false synch in Lyrics3 tag data';
+			unset($ThisFileInfo['id3v1']);
+			foreach ($ThisFileInfo['warning'] as $key =&gt; $value) {
+				if ($value == 'Some ID3v1 fields do not use NULL characters for padding') {
+					unset($ThisFileInfo['warning'][$key]);
+					sort($ThisFileInfo['warning']);
+					break;
+				}
+			}
+		}
+
+		$ThisFileInfo['lyrics3'] = $ParsedLyrics3;
+
+		return true;
+	}
+
+	function Lyrics3Timestamp2Seconds($rawtimestamp) {
+		if (ereg('^\\[([0-9]{2}):([0-9]{2})\\]$', $rawtimestamp, $regs)) {
+			return (int) (($regs[1] * 60) + $regs[2]);
+		}
+		return false;
+	}
+
+	function Lyrics3LyricsTimestampParse(&amp;$Lyrics3data) {
+		$lyricsarray = explode(&quot;\r\n&quot;, $Lyrics3data['raw']['LYR']);
+		foreach ($lyricsarray as $key =&gt; $lyricline) {
+			$regs = array();
+			unset($thislinetimestamps);
+			while (ereg('^(\\[[0-9]{2}:[0-9]{2}\\])', $lyricline, $regs)) {
+				$thislinetimestamps[] = $this-&gt;Lyrics3Timestamp2Seconds($regs[0]);
+				$lyricline = str_replace($regs[0], '', $lyricline);
+			}
+			$notimestamplyricsarray[$key] = $lyricline;
+			if (isset($thislinetimestamps) &amp;&amp; is_array($thislinetimestamps)) {
+				sort($thislinetimestamps);
+				foreach ($thislinetimestamps as $timestampkey =&gt; $timestamp) {
+					if (isset($Lyrics3data['synchedlyrics'][$timestamp])) {
+						// timestamps only have a 1-second resolution, it's possible that multiple lines
+						// could have the same timestamp, if so, append
+						$Lyrics3data['synchedlyrics'][$timestamp] .= &quot;\r\n&quot;.$lyricline;
+					} else {
+						$Lyrics3data['synchedlyrics'][$timestamp] = $lyricline;
+					}
+				}
+			}
+		}
+		$Lyrics3data['unsynchedlyrics'] = implode(&quot;\r\n&quot;, $notimestamplyricsarray);
+		if (isset($Lyrics3data['synchedlyrics']) &amp;&amp; is_array($Lyrics3data['synchedlyrics'])) {
+			ksort($Lyrics3data['synchedlyrics']);
+		}
+		return true;
+	}
+
+	function IntString2Bool($char) {
+		if ($char == '1') {
+			return true;
+		} elseif ($char == '0') {
+			return false;
+		}
+		return null;
+	}
+}
+
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/module.tag.lyrics3.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/write.apetag.php
===================================================================
--- trunk/inc/external/getid3/write.apetag.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/write.apetag.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,227 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// write.apetag.php                                            //
+// module for writing APE tags                                 //
+// dependencies: module.tag.apetag.php                         //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.tag.apetag.php', __FILE__, true);
+
+class getid3_write_apetag
+{
+
+	var $filename;
+	var $tag_data;
+	var $always_preserve_replaygain = true;  // ReplayGain / MP3gain tags will be copied from old tag even if not passed in data
+	var $warnings = array();                 // any non-critical errors will be stored here
+	var $errors   = array();                 // any critical errors will be stored here
+
+	function getid3_write_apetag() {
+		return true;
+	}
+
+	function WriteAPEtag() {
+		// NOTE: All data passed to this function must be UTF-8 format
+
+		$getID3 = new getID3;
+		$ThisFileInfo = $getID3-&gt;analyze($this-&gt;filename);
+
+		if (isset($ThisFileInfo['ape']['tag_offset_start']) &amp;&amp; isset($ThisFileInfo['lyrics3']['tag_offset_end'])) {
+			if ($ThisFileInfo['ape']['tag_offset_start'] &gt;= $ThisFileInfo['lyrics3']['tag_offset_end']) {
+				// Current APE tag between Lyrics3 and ID3v1/EOF
+				// This break Lyrics3 functionality
+				if (!$this-&gt;DeleteAPEtag()) {
+					return false;
+				}
+				$ThisFileInfo = $getID3-&gt;analyze($this-&gt;filename);
+			}
+		}
+
+		if ($this-&gt;always_preserve_replaygain) {
+			$ReplayGainTagsToPreserve = array('mp3gain_minmax', 'mp3gain_album_minmax', 'mp3gain_undo', 'replaygain_track_peak', 'replaygain_track_gain', 'replaygain_album_peak', 'replaygain_album_gain');
+			foreach ($ReplayGainTagsToPreserve as $rg_key) {
+				if (isset($ThisFileInfo['ape']['items'][strtolower($rg_key)]['data'][0]) &amp;&amp; !isset($this-&gt;tag_data[strtoupper($rg_key)][0])) {
+					$this-&gt;tag_data[strtoupper($rg_key)][0] = $ThisFileInfo['ape']['items'][strtolower($rg_key)]['data'][0];
+				}
+			}
+		}
+
+		if ($APEtag = $this-&gt;GenerateAPEtag()) {
+			if ($fp = @fopen($this-&gt;filename, 'a+b')) {
+				$oldignoreuserabort = ignore_user_abort(true);
+				flock($fp, LOCK_EX);
+
+				$PostAPEdataOffset = $ThisFileInfo['avdataend'];
+				if (isset($ThisFileInfo['ape']['tag_offset_end'])) {
+					$PostAPEdataOffset = max($PostAPEdataOffset, $ThisFileInfo['ape']['tag_offset_end']);
+				}
+				if (isset($ThisFileInfo['lyrics3']['tag_offset_start'])) {
+					$PostAPEdataOffset = max($PostAPEdataOffset, $ThisFileInfo['lyrics3']['tag_offset_start']);
+				}
+				fseek($fp, $PostAPEdataOffset, SEEK_SET);
+				$PostAPEdata = '';
+				if ($ThisFileInfo['filesize'] &gt; $PostAPEdataOffset) {
+					$PostAPEdata = fread($fp, $ThisFileInfo['filesize'] - $PostAPEdataOffset);
+				}
+
+				fseek($fp, $PostAPEdataOffset, SEEK_SET);
+				if (isset($ThisFileInfo['ape']['tag_offset_start'])) {
+					fseek($fp, $ThisFileInfo['ape']['tag_offset_start'], SEEK_SET);
+				}
+				ftruncate($fp, ftell($fp));
+				fwrite($fp, $APEtag, strlen($APEtag));
+				if (!empty($PostAPEdata)) {
+					fwrite($fp, $PostAPEdata, strlen($PostAPEdata));
+				}
+				flock($fp, LOCK_UN);
+				fclose($fp);
+				ignore_user_abort($oldignoreuserabort);
+				return true;
+
+			}
+			return false;
+		}
+		return false;
+	}
+
+	function DeleteAPEtag() {
+		$getID3 = new getID3;
+		$ThisFileInfo = $getID3-&gt;analyze($this-&gt;filename);
+		if (isset($ThisFileInfo['ape']['tag_offset_start']) &amp;&amp; isset($ThisFileInfo['ape']['tag_offset_end'])) {
+			if ($fp = @fopen($this-&gt;filename, 'a+b')) {
+
+				flock($fp, LOCK_EX);
+				$oldignoreuserabort = ignore_user_abort(true);
+
+				fseek($fp, $ThisFileInfo['ape']['tag_offset_end'], SEEK_SET);
+				$DataAfterAPE = '';
+				if ($ThisFileInfo['filesize'] &gt; $ThisFileInfo['ape']['tag_offset_end']) {
+					$DataAfterAPE = fread($fp, $ThisFileInfo['filesize'] - $ThisFileInfo['ape']['tag_offset_end']);
+				}
+
+				ftruncate($fp, $ThisFileInfo['ape']['tag_offset_start']);
+				fseek($fp, $ThisFileInfo['ape']['tag_offset_start'], SEEK_SET);
+
+				if (!empty($DataAfterAPE)) {
+					fwrite($fp, $DataAfterAPE, strlen($DataAfterAPE));
+				}
+
+				flock($fp, LOCK_UN);
+				fclose($fp);
+				ignore_user_abort($oldignoreuserabort);
+
+				return true;
+
+			}
+		}
+		return false;
+	}
+
+
+	function GenerateAPEtag() {
+		// NOTE: All data passed to this function must be UTF-8 format
+
+		$items = array();
+		if (!is_array($this-&gt;tag_data)) {
+			return false;
+		}
+		foreach ($this-&gt;tag_data as $key =&gt; $arrayofvalues) {
+			if (!is_array($arrayofvalues)) {
+				return false;
+			}
+
+			$valuestring = '';
+			foreach ($arrayofvalues as $value) {
+				$valuestring .= str_replace(&quot;\x00&quot;, '', $value).&quot;\x00&quot;;
+			}
+			$valuestring = rtrim($valuestring, &quot;\x00&quot;);
+
+			// Length of the assigned value in bytes
+			$tagitem  = getid3_lib::LittleEndian2String(strlen($valuestring), 4);
+
+			//$tagitem .= $this-&gt;GenerateAPEtagFlags(true, true, false, 0, false);
+			$tagitem .= &quot;\x00\x00\x00\x00&quot;;
+
+			$tagitem .= $this-&gt;CleanAPEtagItemKey($key).&quot;\x00&quot;;
+			$tagitem .= $valuestring;
+
+			$items[] = $tagitem;
+
+		}
+
+		return $this-&gt;GenerateAPEtagHeaderFooter($items, true).implode('', $items).$this-&gt;GenerateAPEtagHeaderFooter($items, false);
+	}
+
+	function GenerateAPEtagHeaderFooter(&amp;$items, $isheader=false) {
+		$tagdatalength = 0;
+		foreach ($items as $itemdata) {
+			$tagdatalength += strlen($itemdata);
+		}
+
+		$APEheader  = 'APETAGEX';
+		$APEheader .= getid3_lib::LittleEndian2String(2000, 4);
+		$APEheader .= getid3_lib::LittleEndian2String(32 + $tagdatalength, 4);
+		$APEheader .= getid3_lib::LittleEndian2String(count($items), 4);
+		$APEheader .= $this-&gt;GenerateAPEtagFlags(true, true, $isheader, 0, false);
+		$APEheader .= str_repeat(&quot;\x00&quot;, 8);
+
+		return $APEheader;
+	}
+
+	function GenerateAPEtagFlags($header=true, $footer=true, $isheader=false, $encodingid=0, $readonly=false) {
+		$APEtagFlags = array_fill(0, 4, 0);
+		if ($header) {
+			$APEtagFlags[0] |= 0x80; // Tag contains a header
+		}
+		if (!$footer) {
+			$APEtagFlags[0] |= 0x40; // Tag contains no footer
+		}
+		if ($isheader) {
+			$APEtagFlags[0] |= 0x20; // This is the header, not the footer
+		}
+
+		// 0: Item contains text information coded in UTF-8
+		// 1: Item contains binary information &#176;)
+		// 2: Item is a locator of external stored information &#176;&#176;)
+		// 3: reserved
+		$APEtagFlags[3] |= ($encodingid &lt;&lt; 1);
+
+		if ($readonly) {
+			$APEtagFlags[3] |= 0x01; // Tag or Item is Read Only
+		}
+
+		return chr($APEtagFlags[3]).chr($APEtagFlags[2]).chr($APEtagFlags[1]).chr($APEtagFlags[0]);
+	}
+
+	function CleanAPEtagItemKey($itemkey) {
+		$itemkey = eregi_replace(&quot;[^\x20-\x7E]&quot;, '', $itemkey);
+
+		// <A HREF="http://www.personal.uni-jena.de/~pfk/mpp/sv8/apekey.html">http://www.personal.uni-jena.de/~pfk/mpp/sv8/apekey.html</A>
+		switch (strtoupper($itemkey)) {
+			case 'EAN/UPC':
+			case 'ISBN':
+			case 'LC':
+			case 'ISRC':
+				$itemkey = strtoupper($itemkey);
+				break;
+
+			default:
+				$itemkey = ucwords($itemkey);
+				break;
+		}
+		return $itemkey;
+
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/write.apetag.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/write.id3v1.php
===================================================================
--- trunk/inc/external/getid3/write.id3v1.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/write.id3v1.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,104 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// write.id3v1.php                                             //
+// module for writing ID3v1 tags                               //
+// dependencies: module.tag.id3v1.php                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.tag.id3v1.php', __FILE__, true);
+
+class getid3_write_id3v1
+{
+	var $filename;
+	var $tag_data;
+	var $warnings = array(); // any non-critical errors will be stored here
+	var $errors   = array(); // any critical errors will be stored here
+
+	function getid3_write_id3v1() {
+		return true;
+	}
+
+	function WriteID3v1() {
+		// File MUST be writeable - CHMOD(646) at least
+		if (is_writeable($this-&gt;filename)) {
+			if ($fp_source = @fopen($this-&gt;filename, 'r+b')) {
+
+				fseek($fp_source, -128, SEEK_END);
+				if (fread($fp_source, 3) == 'TAG') {
+					fseek($fp_source, -128, SEEK_END); // overwrite existing ID3v1 tag
+				} else {
+					fseek($fp_source, 0, SEEK_END);    // append new ID3v1 tag
+				}
+
+				$new_id3v1_tag_data = getid3_id3v1::GenerateID3v1Tag(
+														@$this-&gt;tag_data['title'],
+														@$this-&gt;tag_data['artist'],
+														@$this-&gt;tag_data['album'],
+														@$this-&gt;tag_data['year'],
+														@$this-&gt;tag_data['genreid'],
+														@$this-&gt;tag_data['comment'],
+														@$this-&gt;tag_data['track']);
+				fwrite($fp_source, $new_id3v1_tag_data, 128);
+				fclose($fp_source);
+				return true;
+
+			} else {
+				$this-&gt;errors[] = 'Could not open '.$this-&gt;filename.' mode &quot;r+b&quot;';
+				return false;
+			}
+		}
+		$this-&gt;errors[] = 'File is not writeable: '.$this-&gt;filename;
+		return false;
+	}
+
+	function FixID3v1Padding() {
+		// ID3v1 data is supposed to be padded with NULL characters, but some taggers incorrectly use spaces
+		// This function rewrites the ID3v1 tag with correct padding
+
+		// Initialize getID3 engine
+		$getID3 = new getID3;
+		$ThisFileInfo = $getID3-&gt;analyze($this-&gt;filename);
+		if (isset($ThisFileInfo['tags']['id3v1'])) {
+			foreach ($ThisFileInfo['tags']['id3v1'] as $key =&gt; $value) {
+				$id3v1data[$key] = implode(',', $value);
+			}
+			$this-&gt;tag_data = $id3v1data;
+			return $this-&gt;WriteID3v1();
+		}
+		return false;
+	}
+
+	function RemoveID3v1() {
+		// File MUST be writeable - CHMOD(646) at least
+		if (is_writeable($this-&gt;filename)) {
+			if ($fp_source = @fopen($this-&gt;filename, 'r+b')) {
+
+				fseek($fp_source, -128, SEEK_END);
+				if (fread($fp_source, 3) == 'TAG') {
+					ftruncate($fp_source, filesize($this-&gt;filename) - 128);
+				} else {
+					// no ID3v1 tag to begin with - do nothing
+				}
+				fclose($fp_source);
+				return true;
+
+			} else {
+				$this-&gt;errors[] = 'Could not open '.$this-&gt;filename.' mode &quot;r+b&quot;';
+			}
+		} else {
+			$this-&gt;errors[] = $this-&gt;filename.' is not writeable';
+		}
+		return false;
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/write.id3v1.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/write.id3v2.php
===================================================================
--- trunk/inc/external/getid3/write.id3v2.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/write.id3v2.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,2028 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+///                                                            //
+// write.id3v2.php                                             //
+// module for writing ID3v2 tags                               //
+// dependencies: module.tag.id3v2.php                          //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'module.tag.id3v2.php', __FILE__, true);
+
+class getid3_write_id3v2
+{
+	var $filename;
+	var $tag_data;
+	var $paddedlength                = 4096;     // minimum length of ID3v2 tag in bytes
+	var $majorversion                = 3;        // ID3v2 major version (2, 3 (recommended), 4)
+	var $minorversion                = 0;        // ID3v2 minor version - always 0
+	var $merge_existing_data         = false;    // if true, merge new data with existing tags; if false, delete old tag data and only write new tags
+	var $id3v2_default_encodingid    = 0;        // default text encoding (ISO-8859-1) if not explicitly passed
+	var $id3v2_use_unsynchronisation = false;    // the specs say it should be TRUE, but most other ID3v2-aware programs are broken if unsynchronization is used, so by default don't use it.
+	var $warnings                    = array();  // any non-critical errors will be stored here
+	var $errors                      = array();  // any critical errors will be stored here
+
+	function getid3_write_id3v2() {
+		return true;
+	}
+
+	function WriteID3v2() {
+		// File MUST be writeable - CHMOD(646) at least. It's best if the
+		// directory is also writeable, because that method is both faster and less susceptible to errors.
+
+		if (is_writeable($this-&gt;filename) || (!file_exists($this-&gt;filename) &amp;&amp; is_writeable(dirname($this-&gt;filename)))) {
+			// Initialize getID3 engine
+			$getID3 = new getID3;
+			$OldThisFileInfo = $getID3-&gt;analyze($this-&gt;filename);
+			if ($this-&gt;merge_existing_data) {
+				// merge with existing data
+				if (!empty($OldThisFileInfo['id3v2'])) {
+					$this-&gt;tag_data = $this-&gt;array_join_merge($OldThisFileInfo['id3v2'], $this-&gt;tag_data);
+				}
+			}
+			$this-&gt;paddedlength = max(@$OldThisFileInfo['id3v2']['headerlength'], $this-&gt;paddedlength);
+
+			if ($NewID3v2Tag = $this-&gt;GenerateID3v2Tag()) {
+				if (file_exists($this-&gt;filename) &amp;&amp; is_writeable($this-&gt;filename) &amp;&amp; isset($OldThisFileInfo['id3v2']['headerlength']) &amp;&amp; ($OldThisFileInfo['id3v2']['headerlength'] == strlen($NewID3v2Tag))) {
+
+					// best and fastest method - insert-overwrite existing tag (padded to length of old tag if neccesary)
+					if (file_exists($this-&gt;filename)) {
+
+						ob_start();
+						if ($fp = fopen($this-&gt;filename, 'r+b')) {
+							rewind($fp);
+							fwrite($fp, $NewID3v2Tag, strlen($NewID3v2Tag));
+							fclose($fp);
+						} else {
+							$this-&gt;errors[] = 'Could not open '.$this-&gt;filename.' mode &quot;r+b&quot; - '.strip_tags(ob_get_contents());
+						}
+						ob_end_clean();
+
+					} else {
+
+						ob_start();
+						if ($fp = fopen($this-&gt;filename, 'wb')) {
+							rewind($fp);
+							fwrite($fp, $NewID3v2Tag, strlen($NewID3v2Tag));
+							fclose($fp);
+						} else {
+							$this-&gt;errors[] = 'Could not open '.$this-&gt;filename.' mode &quot;wb&quot; - '.strip_tags(ob_get_contents());
+						}
+						ob_end_clean();
+
+					}
+
+				} else {
+
+					if ($tempfilename = tempnam('*', 'getID3')) {
+						ob_start();
+						if ($fp_source = fopen($this-&gt;filename, 'rb')) {
+							if ($fp_temp = fopen($tempfilename, 'wb')) {
+
+								fwrite($fp_temp, $NewID3v2Tag, strlen($NewID3v2Tag));
+
+								rewind($fp_source);
+								if (!empty($OldThisFileInfo['avdataoffset'])) {
+									fseek($fp_source, $OldThisFileInfo['avdataoffset'], SEEK_SET);
+								}
+
+								while ($buffer = fread($fp_source, GETID3_FREAD_BUFFER_SIZE)) {
+									fwrite($fp_temp, $buffer, strlen($buffer));
+								}
+
+								fclose($fp_temp);
+								fclose($fp_source);
+								copy($tempfilename, $this-&gt;filename);
+								unlink($tempfilename);
+								return true;
+
+							} else {
+
+								$this-&gt;errors[] = 'Could not open '.$tempfilename.' mode &quot;wb&quot; - '.strip_tags(ob_get_contents());
+
+							}
+							fclose($fp_source);
+
+						} else {
+
+							$this-&gt;errors[] = 'Could not open '.$this-&gt;filename.' mode &quot;rb&quot; - '.strip_tags(ob_get_contents());
+
+						}
+						ob_end_clean();
+					}
+					return false;
+
+				}
+
+			} else {
+
+				$this-&gt;errors[] = '$this-&gt;GenerateID3v2Tag() failed';
+
+			}
+
+			if (!empty($this-&gt;errors)) {
+				return false;
+			}
+			return true;
+		} else {
+			$this-&gt;errors[] = '!is_writeable('.$this-&gt;filename.')';
+		}
+		return false;
+	}
+
+	function RemoveID3v2() {
+
+		// File MUST be writeable - CHMOD(646) at least. It's best if the
+		// directory is also writeable, because that method is both faster and less susceptible to errors.
+		if (is_writeable(dirname($this-&gt;filename))) {
+
+			// preferred method - only one copying operation, minimal chance of corrupting
+			// original file if script is interrupted, but required directory to be writeable
+			if ($fp_source = @fopen($this-&gt;filename, 'rb')) {
+				// Initialize getID3 engine
+				$getID3 = new getID3;
+				$OldThisFileInfo = $getID3-&gt;analyze($this-&gt;filename);
+				rewind($fp_source);
+				if ($OldThisFileInfo['avdataoffset'] !== false) {
+					fseek($fp_source, $OldThisFileInfo['avdataoffset'], SEEK_SET);
+				}
+				if ($fp_temp = @fopen($this-&gt;filename.'getid3tmp', 'w+b')) {
+					while ($buffer = fread($fp_source, GETID3_FREAD_BUFFER_SIZE)) {
+						fwrite($fp_temp, $buffer, strlen($buffer));
+					}
+					fclose($fp_temp);
+				} else {
+					$this-&gt;errors[] = 'Could not open '.$this-&gt;filename.'getid3tmp mode &quot;w+b&quot;';
+				}
+				fclose($fp_source);
+			} else {
+				$this-&gt;errors[] = 'Could not open '.$this-&gt;filename.' mode &quot;rb&quot;';
+			}
+			if (file_exists($this-&gt;filename)) {
+				unlink($this-&gt;filename);
+			}
+			rename($this-&gt;filename.'getid3tmp', $this-&gt;filename);
+
+		} elseif (is_writable($this-&gt;filename)) {
+
+			// less desirable alternate method - double-copies the file, overwrites original file
+			// and could corrupt source file if the script is interrupted or an error occurs.
+			if ($fp_source = @fopen($this-&gt;filename, 'rb')) {
+				// Initialize getID3 engine
+				$getID3 = new getID3;
+				$OldThisFileInfo = $getID3-&gt;analyze($this-&gt;filename);
+				rewind($fp_source);
+				if ($OldThisFileInfo['avdataoffset'] !== false) {
+					fseek($fp_source, $OldThisFileInfo['avdataoffset'], SEEK_SET);
+				}
+				if ($fp_temp = tmpfile()) {
+					while ($buffer = fread($fp_source, GETID3_FREAD_BUFFER_SIZE)) {
+						fwrite($fp_temp, $buffer, strlen($buffer));
+					}
+					fclose($fp_source);
+					if ($fp_source = @fopen($this-&gt;filename, 'wb')) {
+						rewind($fp_temp);
+						while ($buffer = fread($fp_temp, GETID3_FREAD_BUFFER_SIZE)) {
+							fwrite($fp_source, $buffer, strlen($buffer));
+						}
+						fseek($fp_temp, -128, SEEK_END);
+						fclose($fp_source);
+					} else {
+						$this-&gt;errors[] = 'Could not open '.$this-&gt;filename.' mode &quot;wb&quot;';
+					}
+					fclose($fp_temp);
+				} else {
+					$this-&gt;errors[] = 'Could not create tmpfile()';
+				}
+			} else {
+				$this-&gt;errors[] = 'Could not open '.$this-&gt;filename.' mode &quot;rb&quot;';
+			}
+
+		} else {
+
+			$this-&gt;errors[] = 'Directory and file both not writeable';
+
+		}
+
+		if (!empty($this-&gt;errors)) {
+			return false;
+		}
+		return true;
+	}
+
+
+	function GenerateID3v2TagFlags($flags) {
+		switch ($this-&gt;majorversion) {
+			case 4:
+				// %abcd0000
+				$flag  = (@$flags['unsynchronisation'] ? '1' : '0'); // a - Unsynchronisation
+				$flag .= (@$flags['extendedheader']    ? '1' : '0'); // b - Extended header
+				$flag .= (@$flags['experimental']      ? '1' : '0'); // c - Experimental indicator
+				$flag .= (@$flags['footer']            ? '1' : '0'); // d - Footer present
+				$flag .= '0000';
+				break;
+
+			case 3:
+				// %abc00000
+				$flag  = (@$flags['unsynchronisation'] ? '1' : '0'); // a - Unsynchronisation
+				$flag .= (@$flags['extendedheader']    ? '1' : '0'); // b - Extended header
+				$flag .= (@$flags['experimental']      ? '1' : '0'); // c - Experimental indicator
+				$flag .= '00000';
+				break;
+
+			case 2:
+				// %ab000000
+				$flag  = (@$flags['unsynchronisation'] ? '1' : '0'); // a - Unsynchronisation
+				$flag .= (@$flags['compression']       ? '1' : '0'); // b - Compression
+				$flag .= '000000';
+				break;
+
+			default:
+				return false;
+				break;
+		}
+		return chr(bindec($flag));
+	}
+
+
+	function GenerateID3v2FrameFlags($TagAlter=false, $FileAlter=false, $ReadOnly=false, $Compression=false, $Encryption=false, $GroupingIdentity=false, $Unsynchronisation=false, $DataLengthIndicator=false) {
+		switch ($this-&gt;majorversion) {
+			case 4:
+				// %0abc0000 %0h00kmnp
+				$flag1  = '0';
+				$flag1 .= $TagAlter  ? '1' : '0'; // a - Tag alter preservation (true == discard)
+				$flag1 .= $FileAlter ? '1' : '0'; // b - File alter preservation (true == discard)
+				$flag1 .= $ReadOnly  ? '1' : '0'; // c - Read only (true == read only)
+				$flag1 .= '0000';
+
+				$flag2  = '0';
+				$flag2 .= $GroupingIdentity    ? '1' : '0'; // h - Grouping identity (true == contains group information)
+				$flag2 .= '00';
+				$flag2 .= $Compression         ? '1' : '0'; // k - Compression (true == compressed)
+				$flag2 .= $Encryption          ? '1' : '0'; // m - Encryption (true == encrypted)
+				$flag2 .= $Unsynchronisation   ? '1' : '0'; // n - Unsynchronisation (true == unsynchronised)
+				$flag2 .= $DataLengthIndicator ? '1' : '0'; // p - Data length indicator (true == data length indicator added)
+				break;
+
+			case 3:
+				// %abc00000 %ijk00000
+				$flag1  = $TagAlter  ? '1' : '0';  // a - Tag alter preservation (true == discard)
+				$flag1 .= $FileAlter ? '1' : '0';  // b - File alter preservation (true == discard)
+				$flag1 .= $ReadOnly  ? '1' : '0';  // c - Read only (true == read only)
+				$flag1 .= '00000';
+
+				$flag2  = $Compression      ? '1' : '0';      // i - Compression (true == compressed)
+				$flag2 .= $Encryption       ? '1' : '0';      // j - Encryption (true == encrypted)
+				$flag2 .= $GroupingIdentity ? '1' : '0';      // k - Grouping identity (true == contains group information)
+				$flag2 .= '00000';
+				break;
+
+			default:
+				return false;
+				break;
+
+		}
+		return chr(bindec($flag1)).chr(bindec($flag2));
+	}
+
+	function GenerateID3v2FrameData($frame_name, $source_data_array) {
+		if (!getid3_id3v2::IsValidID3v2FrameName($frame_name, $this-&gt;majorversion)) {
+			return false;
+		}
+		$framedata = '';
+
+		if (($this-&gt;majorversion &lt; 3) || ($this-&gt;majorversion &gt; 4)) {
+
+			$this-&gt;errors[] = 'Only ID3v2.3 and ID3v2.4 are supported in GenerateID3v2FrameData()';
+
+		} else { // $this-&gt;majorversion 3 or 4
+
+			switch ($frame_name) {
+				case 'UFID':
+					// 4.1   UFID Unique file identifier
+					// Owner identifier        &lt;text string&gt; $00
+					// Identifier              &lt;up to 64 bytes binary data&gt;
+					if (strlen($source_data_array['data']) &gt; 64) {
+						$this-&gt;errors[] = 'Identifier not allowed to be longer than 64 bytes in '.$frame_name.' (supplied data was '.strlen($source_data_array['data']).' bytes long)';
+					} else {
+						$framedata .= str_replace(&quot;\x00&quot;, '', $source_data_array['ownerid']).&quot;\x00&quot;;
+						$framedata .= substr($source_data_array['data'], 0, 64); // max 64 bytes - truncate anything longer
+					}
+					break;
+
+				case 'TXXX':
+					// 4.2.2 TXXX User defined text information frame
+					// Text encoding     $xx
+					// Description       &lt;text string according to encoding&gt; $00 (00)
+					// Value             &lt;text string according to encoding&gt;
+					$source_data_array['encodingid'] = (isset($source_data_array['encodingid']) ? $source_data_array['encodingid'] : $this-&gt;id3v2_default_encodingid);
+					if (!$this-&gt;ID3v2IsValidTextEncoding($source_data_array['encodingid'], $this-&gt;majorversion)) {
+						$this-&gt;errors[] = 'Invalid Text Encoding in '.$frame_name.' ('.$source_data_array['encodingid'].') for ID3v2.'.$this-&gt;majorversion;
+					} else {
+						$framedata .= chr($source_data_array['encodingid']);
+						$framedata .= $source_data_array['description'].getid3_id3v2::TextEncodingTerminatorLookup($source_data_array['encodingid']);
+						$framedata .= $source_data_array['data'];
+					}
+					break;
+
+				case 'WXXX':
+					// 4.3.2 WXXX User defined URL link frame
+					// Text encoding     $xx
+					// Description       &lt;text string according to encoding&gt; $00 (00)
+					// URL               &lt;text string&gt;
+					$source_data_array['encodingid'] = (isset($source_data_array['encodingid']) ? $source_data_array['encodingid'] : $this-&gt;id3v2_default_encodingid);
+					if (!$this-&gt;ID3v2IsValidTextEncoding($source_data_array['encodingid'], $this-&gt;majorversion)) {
+						$this-&gt;errors[] = 'Invalid Text Encoding in '.$frame_name.' ('.$source_data_array['encodingid'].') for ID3v2.'.$this-&gt;majorversion;
+					} elseif (!isset($source_data_array['data']) || !$this-&gt;IsValidURL($source_data_array['data'], false, false)) {
+						$this-&gt;errors[] = 'Invalid URL in '.$frame_name.' ('.$source_data_array['data'].')';
+					} else {
+						$framedata .= chr($source_data_array['encodingid']);
+						$framedata .= $source_data_array['description'].getid3_id3v2::TextEncodingTerminatorLookup($source_data_array['encodingid']);
+						$framedata .= $source_data_array['data'];
+					}
+					break;
+
+				case 'IPLS':
+					// 4.4  IPLS Involved people list (ID3v2.3 only)
+					// Text encoding     $xx
+					// People list strings    &lt;textstrings&gt;
+					$source_data_array['encodingid'] = (isset($source_data_array['encodingid']) ? $source_data_array['encodingid'] : $this-&gt;id3v2_default_encodingid);
+					if (!$this-&gt;ID3v2IsValidTextEncoding($source_data_array['encodingid'], $this-&gt;majorversion)) {
+						$this-&gt;errors[] = 'Invalid Text Encoding in '.$frame_name.' ('.$source_data_array['encodingid'].') for ID3v2.'.$this-&gt;majorversion;
+					} else {
+						$framedata .= chr($source_data_array['encodingid']);
+						$framedata .= $source_data_array['data'];
+					}
+					break;
+
+				case 'MCDI':
+					// 4.4   MCDI Music CD identifier
+					// CD TOC                &lt;binary data&gt;
+					$framedata .= $source_data_array['data'];
+					break;
+
+				case 'ETCO':
+					// 4.5   ETCO Event timing codes
+					// Time stamp format    $xx
+					//   Where time stamp format is:
+					// $01  (32-bit value) MPEG frames from beginning of file
+					// $02  (32-bit value) milliseconds from beginning of file
+					//   Followed by a list of key events in the following format:
+					// Type of event   $xx
+					// Time stamp      $xx (xx ...)
+					//   The 'Time stamp' is set to zero if directly at the beginning of the sound
+					//   or after the previous event. All events MUST be sorted in chronological order.
+					if (($source_data_array['timestampformat'] &gt; 2) || ($source_data_array['timestampformat'] &lt; 1)) {
+						$this-&gt;errors[] = 'Invalid Time Stamp Format byte in '.$frame_name.' ('.$source_data_array['timestampformat'].')';
+					} else {
+						$framedata .= chr($source_data_array['timestampformat']);
+						foreach ($source_data_array as $key =&gt; $val) {
+							if (!$this-&gt;ID3v2IsValidETCOevent($val['typeid'])) {
+								$this-&gt;errors[] = 'Invalid Event Type byte in '.$frame_name.' ('.$val['typeid'].')';
+							} elseif (($key != 'timestampformat') &amp;&amp; ($key != 'flags')) {
+								if (($val['timestamp'] &gt; 0) &amp;&amp; ($previousETCOtimestamp &gt;= $val['timestamp'])) {
+									//   The 'Time stamp' is set to zero if directly at the beginning of the sound
+									//   or after the previous event. All events MUST be sorted in chronological order.
+									$this-&gt;errors[] = 'Out-of-order timestamp in '.$frame_name.' ('.$val['timestamp'].') for Event Type ('.$val['typeid'].')';
+								} else {
+									$framedata .= chr($val['typeid']);
+									$framedata .= getid3_lib::BigEndian2String($val['timestamp'], 4, false);
+								}
+							}
+						}
+					}
+					break;
+
+				case 'MLLT':
+					// 4.6   MLLT MPEG location lookup table
+					// MPEG frames between reference  $xx xx
+					// Bytes between reference        $xx xx xx
+					// Milliseconds between reference $xx xx xx
+					// Bits for bytes deviation       $xx
+					// Bits for milliseconds dev.     $xx
+					//   Then for every reference the following data is included;
+					// Deviation in bytes         %xxx....
+					// Deviation in milliseconds  %xxx....
+					if (($source_data_array['framesbetweenreferences'] &gt; 0) &amp;&amp; ($source_data_array['framesbetweenreferences'] &lt;= 65535)) {
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['framesbetweenreferences'], 2, false);
+					} else {
+						$this-&gt;errors[] = 'Invalid MPEG Frames Between References in '.$frame_name.' ('.$source_data_array['framesbetweenreferences'].')';
+					}
+					if (($source_data_array['bytesbetweenreferences'] &gt; 0) &amp;&amp; ($source_data_array['bytesbetweenreferences'] &lt;= 16777215)) {
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['bytesbetweenreferences'], 3, false);
+					} else {
+						$this-&gt;errors[] = 'Invalid bytes Between References in '.$frame_name.' ('.$source_data_array['bytesbetweenreferences'].')';
+					}
+					if (($source_data_array['msbetweenreferences'] &gt; 0) &amp;&amp; ($source_data_array['msbetweenreferences'] &lt;= 16777215)) {
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['msbetweenreferences'], 3, false);
+					} else {
+						$this-&gt;errors[] = 'Invalid Milliseconds Between References in '.$frame_name.' ('.$source_data_array['msbetweenreferences'].')';
+					}
+					if (!$this-&gt;IsWithinBitRange($source_data_array['bitsforbytesdeviation'], 8, false)) {
+						if (($source_data_array['bitsforbytesdeviation'] % 4) == 0) {
+							$framedata .= chr($source_data_array['bitsforbytesdeviation']);
+						} else {
+							$this-&gt;errors[] = 'Bits For Bytes Deviation in '.$frame_name.' ('.$source_data_array['bitsforbytesdeviation'].') must be a multiple of 4.';
+						}
+					} else {
+						$this-&gt;errors[] = 'Invalid Bits For Bytes Deviation in '.$frame_name.' ('.$source_data_array['bitsforbytesdeviation'].')';
+					}
+					if (!$this-&gt;IsWithinBitRange($source_data_array['bitsformsdeviation'], 8, false)) {
+						if (($source_data_array['bitsformsdeviation'] % 4) == 0) {
+							$framedata .= chr($source_data_array['bitsformsdeviation']);
+						} else {
+							$this-&gt;errors[] = 'Bits For Milliseconds Deviation in '.$frame_name.' ('.$source_data_array['bitsforbytesdeviation'].') must be a multiple of 4.';
+						}
+					} else {
+						$this-&gt;errors[] = 'Invalid Bits For Milliseconds Deviation in '.$frame_name.' ('.$source_data_array['bitsformsdeviation'].')';
+					}
+					foreach ($source_data_array as $key =&gt; $val) {
+						if (($key != 'framesbetweenreferences') &amp;&amp; ($key != 'bytesbetweenreferences') &amp;&amp; ($key != 'msbetweenreferences') &amp;&amp; ($key != 'bitsforbytesdeviation') &amp;&amp; ($key != 'bitsformsdeviation') &amp;&amp; ($key != 'flags')) {
+							$unwrittenbitstream .= str_pad(getid3_lib::Dec2Bin($val['bytedeviation']), $source_data_array['bitsforbytesdeviation'], '0', STR_PAD_LEFT);
+							$unwrittenbitstream .= str_pad(getid3_lib::Dec2Bin($val['msdeviation']),   $source_data_array['bitsformsdeviation'],    '0', STR_PAD_LEFT);
+						}
+					}
+					for ($i = 0; $i &lt; strlen($unwrittenbitstream); $i += 8) {
+						$highnibble = bindec(substr($unwrittenbitstream, $i, 4)) &lt;&lt; 4;
+						$lownibble  = bindec(substr($unwrittenbitstream, $i + 4, 4));
+						$framedata .= chr($highnibble &amp; $lownibble);
+					}
+					break;
+
+				case 'SYTC':
+					// 4.7   SYTC Synchronised tempo codes
+					// Time stamp format   $xx
+					// Tempo data          &lt;binary data&gt;
+					//   Where time stamp format is:
+					// $01  (32-bit value) MPEG frames from beginning of file
+					// $02  (32-bit value) milliseconds from beginning of file
+					if (($source_data_array['timestampformat'] &gt; 2) || ($source_data_array['timestampformat'] &lt; 1)) {
+						$this-&gt;errors[] = 'Invalid Time Stamp Format byte in '.$frame_name.' ('.$source_data_array['timestampformat'].')';
+					} else {
+						$framedata .= chr($source_data_array['timestampformat']);
+						foreach ($source_data_array as $key =&gt; $val) {
+							if (!$this-&gt;ID3v2IsValidETCOevent($val['typeid'])) {
+								$this-&gt;errors[] = 'Invalid Event Type byte in '.$frame_name.' ('.$val['typeid'].')';
+							} elseif (($key != 'timestampformat') &amp;&amp; ($key != 'flags')) {
+								if (($val['tempo'] &lt; 0) || ($val['tempo'] &gt; 510)) {
+									$this-&gt;errors[] = 'Invalid Tempo (max = 510) in '.$frame_name.' ('.$val['tempo'].') at timestamp ('.$val['timestamp'].')';
+								} else {
+									if ($val['tempo'] &gt; 255) {
+										$framedata .= chr(255);
+										$val['tempo'] -= 255;
+									}
+									$framedata .= chr($val['tempo']);
+									$framedata .= getid3_lib::BigEndian2String($val['timestamp'], 4, false);
+								}
+							}
+						}
+					}
+					break;
+
+				case 'USLT':
+					// 4.8   USLT Unsynchronised lyric/text transcription
+					// Text encoding        $xx
+					// Language             $xx xx xx
+					// Content descriptor   &lt;text string according to encoding&gt; $00 (00)
+					// Lyrics/text          &lt;full text string according to encoding&gt;
+					$source_data_array['encodingid'] = (isset($source_data_array['encodingid']) ? $source_data_array['encodingid'] : $this-&gt;id3v2_default_encodingid);
+					if (!$this-&gt;ID3v2IsValidTextEncoding($source_data_array['encodingid'])) {
+						$this-&gt;errors[] = 'Invalid Text Encoding in '.$frame_name.' ('.$source_data_array['encodingid'].') for ID3v2.'.$this-&gt;majorversion;
+					} elseif (getid3_id3v2::LanguageLookup($source_data_array['language'], true) == '') {
+						$this-&gt;errors[] = 'Invalid Language in '.$frame_name.' ('.$source_data_array['language'].')';
+					} else {
+						$framedata .= chr($source_data_array['encodingid']);
+						$framedata .= strtolower($source_data_array['language']);
+						$framedata .= $source_data_array['description'].getid3_id3v2::TextEncodingTerminatorLookup($source_data_array['encodingid']);
+						$framedata .= $source_data_array['data'];
+					}
+					break;
+
+				case 'SYLT':
+					// 4.9   SYLT Synchronised lyric/text
+					// Text encoding        $xx
+					// Language             $xx xx xx
+					// Time stamp format    $xx
+					//   $01  (32-bit value) MPEG frames from beginning of file
+					//   $02  (32-bit value) milliseconds from beginning of file
+					// Content type         $xx
+					// Content descriptor   &lt;text string according to encoding&gt; $00 (00)
+					//   Terminated text to be synced (typically a syllable)
+					//   Sync identifier (terminator to above string)   $00 (00)
+					//   Time stamp                                     $xx (xx ...)
+					$source_data_array['encodingid'] = (isset($source_data_array['encodingid']) ? $source_data_array['encodingid'] : $this-&gt;id3v2_default_encodingid);
+					if (!$this-&gt;ID3v2IsValidTextEncoding($source_data_array['encodingid'])) {
+						$this-&gt;errors[] = 'Invalid Text Encoding in '.$frame_name.' ('.$source_data_array['encodingid'].') for ID3v2.'.$this-&gt;majorversion;
+					} elseif (getid3_id3v2::LanguageLookup($source_data_array['language'], true) == '') {
+						$this-&gt;errors[] = 'Invalid Language in '.$frame_name.' ('.$source_data_array['language'].')';
+					} elseif (($source_data_array['timestampformat'] &gt; 2) || ($source_data_array['timestampformat'] &lt; 1)) {
+						$this-&gt;errors[] = 'Invalid Time Stamp Format byte in '.$frame_name.' ('.$source_data_array['timestampformat'].')';
+					} elseif (!$this-&gt;ID3v2IsValidSYLTtype($source_data_array['contenttypeid'])) {
+						$this-&gt;errors[] = 'Invalid Content Type byte in '.$frame_name.' ('.$source_data_array['contenttypeid'].')';
+					} elseif (!is_array($source_data_array['data'])) {
+						$this-&gt;errors[] = 'Invalid Lyric/Timestamp data in '.$frame_name.' (must be an array)';
+					} else {
+						$framedata .= chr($source_data_array['encodingid']);
+						$framedata .= strtolower($source_data_array['language']);
+						$framedata .= chr($source_data_array['timestampformat']);
+						$framedata .= chr($source_data_array['contenttypeid']);
+						$framedata .= $source_data_array['description'].getid3_id3v2::TextEncodingTerminatorLookup($source_data_array['encodingid']);
+						ksort($source_data_array['data']);
+						foreach ($source_data_array['data'] as $key =&gt; $val) {
+							$framedata .= $val['data'].getid3_id3v2::TextEncodingTerminatorLookup($source_data_array['encodingid']);
+							$framedata .= getid3_lib::BigEndian2String($val['timestamp'], 4, false);
+						}
+					}
+					break;
+
+				case 'COMM':
+					// 4.10  COMM Comments
+					// Text encoding          $xx
+					// Language               $xx xx xx
+					// Short content descrip. &lt;text string according to encoding&gt; $00 (00)
+					// The actual text        &lt;full text string according to encoding&gt;
+					$source_data_array['encodingid'] = (isset($source_data_array['encodingid']) ? $source_data_array['encodingid'] : $this-&gt;id3v2_default_encodingid);
+					if (!$this-&gt;ID3v2IsValidTextEncoding($source_data_array['encodingid'])) {
+						$this-&gt;errors[] = 'Invalid Text Encoding in '.$frame_name.' ('.$source_data_array['encodingid'].') for ID3v2.'.$this-&gt;majorversion;
+					} elseif (getid3_id3v2::LanguageLookup($source_data_array['language'], true) == '') {
+						$this-&gt;errors[] = 'Invalid Language in '.$frame_name.' ('.$source_data_array['language'].')';
+					} else {
+						$framedata .= chr($source_data_array['encodingid']);
+						$framedata .= strtolower($source_data_array['language']);
+						$framedata .= $source_data_array['description'].getid3_id3v2::TextEncodingTerminatorLookup($source_data_array['encodingid']);
+						$framedata .= $source_data_array['data'];
+					}
+					break;
+
+				case 'RVA2':
+					// 4.11  RVA2 Relative volume adjustment (2) (ID3v2.4+ only)
+					// Identification          &lt;text string&gt; $00
+					//   The 'identification' string is used to identify the situation and/or
+					//   device where this adjustment should apply. The following is then
+					//   repeated for every channel:
+					// Type of channel         $xx
+					// Volume adjustment       $xx xx
+					// Bits representing peak  $xx
+					// Peak volume             $xx (xx ...)
+					$framedata .= str_replace(&quot;\x00&quot;, '', $source_data_array['description']).&quot;\x00&quot;;
+					foreach ($source_data_array as $key =&gt; $val) {
+						if ($key != 'description') {
+							$framedata .= chr($val['channeltypeid']);
+							$framedata .= getid3_lib::BigEndian2String($val['volumeadjust'], 2, false, true); // signed 16-bit
+							if (!$this-&gt;IsWithinBitRange($source_data_array['bitspeakvolume'], 8, false)) {
+								$framedata .= chr($val['bitspeakvolume']);
+								if ($val['bitspeakvolume'] &gt; 0) {
+									$framedata .= getid3_lib::BigEndian2String($val['peakvolume'], ceil($val['bitspeakvolume'] / 8), false, false);
+								}
+							} else {
+								$this-&gt;errors[] = 'Invalid Bits Representing Peak Volume in '.$frame_name.' ('.$val['bitspeakvolume'].') (range = 0 to 255)';
+							}
+						}
+					}
+					break;
+
+				case 'RVAD':
+					// 4.12  RVAD Relative volume adjustment (ID3v2.3 only)
+					// Increment/decrement     %00fedcba
+					// Bits used for volume descr.        $xx
+					// Relative volume change, right      $xx xx (xx ...) // a
+					// Relative volume change, left       $xx xx (xx ...) // b
+					// Peak volume right                  $xx xx (xx ...)
+					// Peak volume left                   $xx xx (xx ...)
+					// Relative volume change, right back $xx xx (xx ...) // c
+					// Relative volume change, left back  $xx xx (xx ...) // d
+					// Peak volume right back             $xx xx (xx ...)
+					// Peak volume left back              $xx xx (xx ...)
+					// Relative volume change, center     $xx xx (xx ...) // e
+					// Peak volume center                 $xx xx (xx ...)
+					// Relative volume change, bass       $xx xx (xx ...) // f
+					// Peak volume bass                   $xx xx (xx ...)
+					if (!$this-&gt;IsWithinBitRange($source_data_array['bitsvolume'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Bits For Volume Description byte in '.$frame_name.' ('.$source_data_array['bitsvolume'].') (range = 1 to 255)';
+					} else {
+						$incdecflag .= '00';
+						$incdecflag .= $source_data_array['incdec']['right']     ? '1' : '0';     // a - Relative volume change, right
+						$incdecflag .= $source_data_array['incdec']['left']      ? '1' : '0';      // b - Relative volume change, left
+						$incdecflag .= $source_data_array['incdec']['rightrear'] ? '1' : '0'; // c - Relative volume change, right back
+						$incdecflag .= $source_data_array['incdec']['leftrear']  ? '1' : '0';  // d - Relative volume change, left back
+						$incdecflag .= $source_data_array['incdec']['center']    ? '1' : '0';    // e - Relative volume change, center
+						$incdecflag .= $source_data_array['incdec']['bass']      ? '1' : '0';      // f - Relative volume change, bass
+						$framedata .= chr(bindec($incdecflag));
+						$framedata .= chr($source_data_array['bitsvolume']);
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['volumechange']['right'], ceil($source_data_array['bitsvolume'] / 8), false);
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['volumechange']['left'],  ceil($source_data_array['bitsvolume'] / 8), false);
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['peakvolume']['right'], ceil($source_data_array['bitsvolume'] / 8), false);
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['peakvolume']['left'],  ceil($source_data_array['bitsvolume'] / 8), false);
+						if ($source_data_array['volumechange']['rightrear'] || $source_data_array['volumechange']['leftrear'] ||
+							$source_data_array['peakvolume']['rightrear'] || $source_data_array['peakvolume']['leftrear'] ||
+							$source_data_array['volumechange']['center'] || $source_data_array['peakvolume']['center'] ||
+							$source_data_array['volumechange']['bass'] || $source_data_array['peakvolume']['bass']) {
+								$framedata .= getid3_lib::BigEndian2String($source_data_array['volumechange']['rightrear'], ceil($source_data_array['bitsvolume']/8), false);
+								$framedata .= getid3_lib::BigEndian2String($source_data_array['volumechange']['leftrear'],  ceil($source_data_array['bitsvolume']/8), false);
+								$framedata .= getid3_lib::BigEndian2String($source_data_array['peakvolume']['rightrear'], ceil($source_data_array['bitsvolume']/8), false);
+								$framedata .= getid3_lib::BigEndian2String($source_data_array['peakvolume']['leftrear'],  ceil($source_data_array['bitsvolume']/8), false);
+						}
+						if ($source_data_array['volumechange']['center'] || $source_data_array['peakvolume']['center'] ||
+							$source_data_array['volumechange']['bass'] || $source_data_array['peakvolume']['bass']) {
+								$framedata .= getid3_lib::BigEndian2String($source_data_array['volumechange']['center'], ceil($source_data_array['bitsvolume']/8), false);
+								$framedata .= getid3_lib::BigEndian2String($source_data_array['peakvolume']['center'], ceil($source_data_array['bitsvolume']/8), false);
+						}
+						if ($source_data_array['volumechange']['bass'] || $source_data_array['peakvolume']['bass']) {
+								$framedata .= getid3_lib::BigEndian2String($source_data_array['volumechange']['bass'], ceil($source_data_array['bitsvolume']/8), false);
+								$framedata .= getid3_lib::BigEndian2String($source_data_array['peakvolume']['bass'], ceil($source_data_array['bitsvolume']/8), false);
+						}
+					}
+					break;
+
+				case 'EQU2':
+					// 4.12  EQU2 Equalisation (2) (ID3v2.4+ only)
+					// Interpolation method  $xx
+					//   $00  Band
+					//   $01  Linear
+					// Identification        &lt;text string&gt; $00
+					//   The following is then repeated for every adjustment point
+					// Frequency          $xx xx
+					// Volume adjustment  $xx xx
+					if (($source_data_array['interpolationmethod'] &lt; 0) || ($source_data_array['interpolationmethod'] &gt; 1)) {
+						$this-&gt;errors[] = 'Invalid Interpolation Method byte in '.$frame_name.' ('.$source_data_array['interpolationmethod'].') (valid = 0 or 1)';
+					} else {
+						$framedata .= chr($source_data_array['interpolationmethod']);
+						$framedata .= str_replace(&quot;\x00&quot;, '', $source_data_array['description']).&quot;\x00&quot;;
+						foreach ($source_data_array['data'] as $key =&gt; $val) {
+							$framedata .= getid3_lib::BigEndian2String(intval(round($key * 2)), 2, false);
+							$framedata .= getid3_lib::BigEndian2String($val, 2, false, true); // signed 16-bit
+						}
+					}
+					break;
+
+				case 'EQUA':
+					// 4.12  EQUA Equalisation (ID3v2.3 only)
+					// Adjustment bits    $xx
+					//   This is followed by 2 bytes + ('adjustment bits' rounded up to the
+					//   nearest byte) for every equalisation band in the following format,
+					//   giving a frequency range of 0 - 32767Hz:
+					// Increment/decrement   %x (MSB of the Frequency)
+					// Frequency             (lower 15 bits)
+					// Adjustment            $xx (xx ...)
+					if (!$this-&gt;IsWithinBitRange($source_data_array['bitsvolume'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Adjustment Bits byte in '.$frame_name.' ('.$source_data_array['bitsvolume'].') (range = 1 to 255)';
+					} else {
+						$framedata .= chr($source_data_array['adjustmentbits']);
+						foreach ($source_data_array as $key =&gt; $val) {
+							if ($key != 'bitsvolume') {
+								if (($key &gt; 32767) || ($key &lt; 0)) {
+									$this-&gt;errors[] = 'Invalid Frequency in '.$frame_name.' ('.$key.') (range = 0 to 32767)';
+								} else {
+									if ($val &gt;= 0) {
+										// put MSB of frequency to 1 if increment, 0 if decrement
+										$key |= 0x8000;
+									}
+									$framedata .= getid3_lib::BigEndian2String($key, 2, false);
+									$framedata .= getid3_lib::BigEndian2String($val, ceil($source_data_array['adjustmentbits'] / 8), false);
+								}
+							}
+						}
+					}
+					break;
+
+				case 'RVRB':
+					// 4.13  RVRB Reverb
+					// Reverb left (ms)                 $xx xx
+					// Reverb right (ms)                $xx xx
+					// Reverb bounces, left             $xx
+					// Reverb bounces, right            $xx
+					// Reverb feedback, left to left    $xx
+					// Reverb feedback, left to right   $xx
+					// Reverb feedback, right to right  $xx
+					// Reverb feedback, right to left   $xx
+					// Premix left to right             $xx
+					// Premix right to left             $xx
+					if (!$this-&gt;IsWithinBitRange($source_data_array['left'], 16, false)) {
+						$this-&gt;errors[] = 'Invalid Reverb Left in '.$frame_name.' ('.$source_data_array['left'].') (range = 0 to 65535)';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['right'], 16, false)) {
+						$this-&gt;errors[] = 'Invalid Reverb Left in '.$frame_name.' ('.$source_data_array['right'].') (range = 0 to 65535)';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['bouncesL'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Reverb Bounces, Left in '.$frame_name.' ('.$source_data_array['bouncesL'].') (range = 0 to 255)';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['bouncesR'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Reverb Bounces, Right in '.$frame_name.' ('.$source_data_array['bouncesR'].') (range = 0 to 255)';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['feedbackLL'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Reverb Feedback, Left-To-Left in '.$frame_name.' ('.$source_data_array['feedbackLL'].') (range = 0 to 255)';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['feedbackLR'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Reverb Feedback, Left-To-Right in '.$frame_name.' ('.$source_data_array['feedbackLR'].') (range = 0 to 255)';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['feedbackRR'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Reverb Feedback, Right-To-Right in '.$frame_name.' ('.$source_data_array['feedbackRR'].') (range = 0 to 255)';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['feedbackRL'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Reverb Feedback, Right-To-Left in '.$frame_name.' ('.$source_data_array['feedbackRL'].') (range = 0 to 255)';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['premixLR'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Premix, Left-To-Right in '.$frame_name.' ('.$source_data_array['premixLR'].') (range = 0 to 255)';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['premixRL'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Premix, Right-To-Left in '.$frame_name.' ('.$source_data_array['premixRL'].') (range = 0 to 255)';
+					} else {
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['left'], 2, false);
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['right'], 2, false);
+						$framedata .= chr($source_data_array['bouncesL']);
+						$framedata .= chr($source_data_array['bouncesR']);
+						$framedata .= chr($source_data_array['feedbackLL']);
+						$framedata .= chr($source_data_array['feedbackLR']);
+						$framedata .= chr($source_data_array['feedbackRR']);
+						$framedata .= chr($source_data_array['feedbackRL']);
+						$framedata .= chr($source_data_array['premixLR']);
+						$framedata .= chr($source_data_array['premixRL']);
+					}
+					break;
+
+				case 'APIC':
+					// 4.14  APIC Attached picture
+					// Text encoding      $xx
+					// MIME type          &lt;text string&gt; $00
+					// Picture type       $xx
+					// Description        &lt;text string according to encoding&gt; $00 (00)
+					// Picture data       &lt;binary data&gt;
+					$source_data_array['encodingid'] = (isset($source_data_array['encodingid']) ? $source_data_array['encodingid'] : $this-&gt;id3v2_default_encodingid);
+					if (!$this-&gt;ID3v2IsValidTextEncoding($source_data_array['encodingid'])) {
+						$this-&gt;errors[] = 'Invalid Text Encoding in '.$frame_name.' ('.$source_data_array['encodingid'].') for ID3v2.'.$this-&gt;majorversion;
+					} elseif (!$this-&gt;ID3v2IsValidAPICpicturetype($source_data_array['picturetypeid'])) {
+						$this-&gt;errors[] = 'Invalid Picture Type byte in '.$frame_name.' ('.$source_data_array['picturetypeid'].') for ID3v2.'.$this-&gt;majorversion;
+					} elseif (($this-&gt;majorversion &gt;= 3) &amp;&amp; (!$this-&gt;ID3v2IsValidAPICimageformat($source_data_array['mime']))) {
+						$this-&gt;errors[] = 'Invalid MIME Type in '.$frame_name.' ('.$source_data_array['mime'].') for ID3v2.'.$this-&gt;majorversion;
+					} elseif (($source_data_array['mime'] == '--&gt;') &amp;&amp; (!$this-&gt;IsValidURL($source_data_array['data'], false, false))) {
+						$this-&gt;errors[] = 'Invalid URL in '.$frame_name.' ('.$source_data_array['data'].')';
+					} else {
+						$framedata .= chr($source_data_array['encodingid']);
+						$framedata .= str_replace(&quot;\x00&quot;, '', $source_data_array['mime']).&quot;\x00&quot;;
+						$framedata .= chr($source_data_array['picturetypeid']);
+						$framedata .= @$source_data_array['description'].getid3_id3v2::TextEncodingTerminatorLookup($source_data_array['encodingid']);
+						$framedata .= $source_data_array['data'];
+					}
+					break;
+
+				case 'GEOB':
+					// 4.15  GEOB General encapsulated object
+					// Text encoding          $xx
+					// MIME type              &lt;text string&gt; $00
+					// Filename               &lt;text string according to encoding&gt; $00 (00)
+					// Content description    &lt;text string according to encoding&gt; $00 (00)
+					// Encapsulated object    &lt;binary data&gt;
+					$source_data_array['encodingid'] = (isset($source_data_array['encodingid']) ? $source_data_array['encodingid'] : $this-&gt;id3v2_default_encodingid);
+					if (!$this-&gt;ID3v2IsValidTextEncoding($source_data_array['encodingid'])) {
+						$this-&gt;errors[] = 'Invalid Text Encoding in '.$frame_name.' ('.$source_data_array['encodingid'].') for ID3v2.'.$this-&gt;majorversion;
+					} elseif (!$this-&gt;IsValidMIMEstring($source_data_array['mime'])) {
+						$this-&gt;errors[] = 'Invalid MIME Type in '.$frame_name.' ('.$source_data_array['mime'].')';
+					} elseif (!$source_data_array['description']) {
+						$this-&gt;errors[] = 'Missing Description in '.$frame_name;
+					} else {
+						$framedata .= chr($source_data_array['encodingid']);
+						$framedata .= str_replace(&quot;\x00&quot;, '', $source_data_array['mime']).&quot;\x00&quot;;
+						$framedata .= $source_data_array['filename'].getid3_id3v2::TextEncodingTerminatorLookup($source_data_array['encodingid']);
+						$framedata .= $source_data_array['description'].getid3_id3v2::TextEncodingTerminatorLookup($source_data_array['encodingid']);
+						$framedata .= $source_data_array['data'];
+					}
+					break;
+
+				case 'PCNT':
+					// 4.16  PCNT Play counter
+					//   When the counter reaches all one's, one byte is inserted in
+					//   front of the counter thus making the counter eight bits bigger
+					// Counter        $xx xx xx xx (xx ...)
+					$framedata .= getid3_lib::BigEndian2String($source_data_array['data'], 4, false);
+					break;
+
+				case 'POPM':
+					// 4.17  POPM Popularimeter
+					//   When the counter reaches all one's, one byte is inserted in
+					//   front of the counter thus making the counter eight bits bigger
+					// Email to user   &lt;text string&gt; $00
+					// Rating          $xx
+					// Counter         $xx xx xx xx (xx ...)
+					if (!$this-&gt;IsWithinBitRange($source_data_array['rating'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Rating byte in '.$frame_name.' ('.$source_data_array['rating'].') (range = 0 to 255)';
+					} elseif (!IsValidEmail($source_data_array['email'])) {
+						$this-&gt;errors[] = 'Invalid Email in '.$frame_name.' ('.$source_data_array['email'].')';
+					} else {
+						$framedata .= str_replace(&quot;\x00&quot;, '', $source_data_array['email']).&quot;\x00&quot;;
+						$framedata .= chr($source_data_array['rating']);
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['data'], 4, false);
+					}
+					break;
+
+				case 'RBUF':
+					// 4.18  RBUF Recommended buffer size
+					// Buffer size               $xx xx xx
+					// Embedded info flag        %0000000x
+					// Offset to next tag        $xx xx xx xx
+					if (!$this-&gt;IsWithinBitRange($source_data_array['buffersize'], 24, false)) {
+						$this-&gt;errors[] = 'Invalid Buffer Size in '.$frame_name;
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['nexttagoffset'], 32, false)) {
+						$this-&gt;errors[] = 'Invalid Offset To Next Tag in '.$frame_name;
+					} else {
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['buffersize'], 3, false);
+						$flag .= '0000000';
+						$flag .= $source_data_array['flags']['embededinfo'] ? '1' : '0';
+						$framedata .= chr(bindec($flag));
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['nexttagoffset'], 4, false);
+					}
+					break;
+
+				case 'AENC':
+					// 4.19  AENC Audio encryption
+					// Owner identifier   &lt;text string&gt; $00
+					// Preview start      $xx xx
+					// Preview length     $xx xx
+					// Encryption info    &lt;binary data&gt;
+					if (!$this-&gt;IsWithinBitRange($source_data_array['previewstart'], 16, false)) {
+						$this-&gt;errors[] = 'Invalid Preview Start in '.$frame_name.' ('.$source_data_array['previewstart'].')';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['previewlength'], 16, false)) {
+						$this-&gt;errors[] = 'Invalid Preview Length in '.$frame_name.' ('.$source_data_array['previewlength'].')';
+					} else {
+						$framedata .= str_replace(&quot;\x00&quot;, '', $source_data_array['ownerid']).&quot;\x00&quot;;
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['previewstart'], 2, false);
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['previewlength'], 2, false);
+						$framedata .= $source_data_array['encryptioninfo'];
+					}
+					break;
+
+				case 'LINK':
+					// 4.20  LINK Linked information
+					// Frame identifier               $xx xx xx xx
+					// URL                            &lt;text string&gt; $00
+					// ID and additional data         &lt;text string(s)&gt;
+					if (!getid3_id3v2::IsValidID3v2FrameName($source_data_array['frameid'], $this-&gt;majorversion)) {
+						$this-&gt;errors[] = 'Invalid Frame Identifier in '.$frame_name.' ('.$source_data_array['frameid'].')';
+					} elseif (!$this-&gt;IsValidURL($source_data_array['data'], true, false)) {
+						$this-&gt;errors[] = 'Invalid URL in '.$frame_name.' ('.$source_data_array['data'].')';
+					} elseif ((($source_data_array['frameid'] == 'AENC') || ($source_data_array['frameid'] == 'APIC') || ($source_data_array['frameid'] == 'GEOB') || ($source_data_array['frameid'] == 'TXXX')) &amp;&amp; ($source_data_array['additionaldata'] == '')) {
+						$this-&gt;errors[] = 'Content Descriptor must be specified as additional data for Frame Identifier of '.$source_data_array['frameid'].' in '.$frame_name;
+					} elseif (($source_data_array['frameid'] == 'USER') &amp;&amp; (getid3_id3v2::LanguageLookup($source_data_array['additionaldata'], true) == '')) {
+						$this-&gt;errors[] = 'Language must be specified as additional data for Frame Identifier of '.$source_data_array['frameid'].' in '.$frame_name;
+					} elseif (($source_data_array['frameid'] == 'PRIV') &amp;&amp; ($source_data_array['additionaldata'] == '')) {
+						$this-&gt;errors[] = 'Owner Identifier must be specified as additional data for Frame Identifier of '.$source_data_array['frameid'].' in '.$frame_name;
+					} elseif ((($source_data_array['frameid'] == 'COMM') || ($source_data_array['frameid'] == 'SYLT') || ($source_data_array['frameid'] == 'USLT')) &amp;&amp; ((getid3_id3v2::LanguageLookup(substr($source_data_array['additionaldata'], 0, 3), true) == '') || (substr($source_data_array['additionaldata'], 3) == ''))) {
+						$this-&gt;errors[] = 'Language followed by Content Descriptor must be specified as additional data for Frame Identifier of '.$source_data_array['frameid'].' in '.$frame_name;
+					} else {
+						$framedata .= $source_data_array['frameid'];
+						$framedata .= str_replace(&quot;\x00&quot;, '', $source_data_array['data']).&quot;\x00&quot;;
+						switch ($source_data_array['frameid']) {
+							case 'COMM':
+							case 'SYLT':
+							case 'USLT':
+							case 'PRIV':
+							case 'USER':
+							case 'AENC':
+							case 'APIC':
+							case 'GEOB':
+							case 'TXXX':
+								$framedata .= $source_data_array['additionaldata'];
+								break;
+							case 'ASPI':
+							case 'ETCO':
+							case 'EQU2':
+							case 'MCID':
+							case 'MLLT':
+							case 'OWNE':
+							case 'RVA2':
+							case 'RVRB':
+							case 'SYTC':
+							case 'IPLS':
+							case 'RVAD':
+							case 'EQUA':
+								// no additional data required
+								break;
+							case 'RBUF':
+								if ($this-&gt;majorversion == 3) {
+									// no additional data required
+								} else {
+									$this-&gt;errors[] = $source_data_array['frameid'].' is not a valid Frame Identifier in '.$frame_name.' (in ID3v2.'.$this-&gt;majorversion.')';
+								}
+
+							default:
+								if ((substr($source_data_array['frameid'], 0, 1) == 'T') || (substr($source_data_array['frameid'], 0, 1) == 'W')) {
+									// no additional data required
+								} else {
+									$this-&gt;errors[] = $source_data_array['frameid'].' is not a valid Frame Identifier in '.$frame_name.' (in ID3v2.'.$this-&gt;majorversion.')';
+								}
+								break;
+						}
+					}
+					break;
+
+				case 'POSS':
+					// 4.21  POSS Position synchronisation frame (ID3v2.3+ only)
+					// Time stamp format         $xx
+					// Position                  $xx (xx ...)
+					if (($source_data_array['timestampformat'] &lt; 1) || ($source_data_array['timestampformat'] &gt; 2)) {
+						$this-&gt;errors[] = 'Invalid Time Stamp Format in '.$frame_name.' ('.$source_data_array['timestampformat'].') (valid = 1 or 2)';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['position'], 32, false)) {
+						$this-&gt;errors[] = 'Invalid Position in '.$frame_name.' ('.$source_data_array['position'].') (range = 0 to 4294967295)';
+					} else {
+						$framedata .= chr($source_data_array['timestampformat']);
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['position'], 4, false);
+					}
+					break;
+
+				case 'USER':
+					// 4.22  USER Terms of use (ID3v2.3+ only)
+					// Text encoding        $xx
+					// Language             $xx xx xx
+					// The actual text      &lt;text string according to encoding&gt;
+					$source_data_array['encodingid'] = (isset($source_data_array['encodingid']) ? $source_data_array['encodingid'] : $this-&gt;id3v2_default_encodingid);
+					if (!$this-&gt;ID3v2IsValidTextEncoding($source_data_array['encodingid'])) {
+						$this-&gt;errors[] = 'Invalid Text Encoding in '.$frame_name.' ('.$source_data_array['encodingid'].')';
+					} elseif (getid3_id3v2::LanguageLookup($source_data_array['language'], true) == '') {
+						$this-&gt;errors[] = 'Invalid Language in '.$frame_name.' ('.$source_data_array['language'].')';
+					} else {
+						$framedata .= chr($source_data_array['encodingid']);
+						$framedata .= strtolower($source_data_array['language']);
+						$framedata .= $source_data_array['data'];
+					}
+					break;
+
+				case 'OWNE':
+					// 4.23  OWNE Ownership frame (ID3v2.3+ only)
+					// Text encoding     $xx
+					// Price paid        &lt;text string&gt; $00
+					// Date of purch.    &lt;text string&gt;
+					// Seller            &lt;text string according to encoding&gt;
+					$source_data_array['encodingid'] = (isset($source_data_array['encodingid']) ? $source_data_array['encodingid'] : $this-&gt;id3v2_default_encodingid);
+					if (!$this-&gt;ID3v2IsValidTextEncoding($source_data_array['encodingid'])) {
+						$this-&gt;errors[] = 'Invalid Text Encoding in '.$frame_name.' ('.$source_data_array['encodingid'].')';
+					} elseif (!$this-&gt;IsANumber($source_data_array['pricepaid']['value'], false)) {
+						$this-&gt;errors[] = 'Invalid Price Paid in '.$frame_name.' ('.$source_data_array['pricepaid']['value'].')';
+					} elseif (!$this-&gt;IsValidDateStampString($source_data_array['purchasedate'])) {
+						$this-&gt;errors[] = 'Invalid Date Of Purchase in '.$frame_name.' ('.$source_data_array['purchasedate'].') (format = YYYYMMDD)';
+					} else {
+						$framedata .= chr($source_data_array['encodingid']);
+						$framedata .= str_replace(&quot;\x00&quot;, '', $source_data_array['pricepaid']['value']).&quot;\x00&quot;;
+						$framedata .= $source_data_array['purchasedate'];
+						$framedata .= $source_data_array['seller'];
+					}
+					break;
+
+				case 'COMR':
+					// 4.24  COMR Commercial frame (ID3v2.3+ only)
+					// Text encoding      $xx
+					// Price string       &lt;text string&gt; $00
+					// Valid until        &lt;text string&gt;
+					// Contact URL        &lt;text string&gt; $00
+					// Received as        $xx
+					// Name of seller     &lt;text string according to encoding&gt; $00 (00)
+					// Description        &lt;text string according to encoding&gt; $00 (00)
+					// Picture MIME type  &lt;string&gt; $00
+					// Seller logo        &lt;binary data&gt;
+					$source_data_array['encodingid'] = (isset($source_data_array['encodingid']) ? $source_data_array['encodingid'] : $this-&gt;id3v2_default_encodingid);
+					if (!$this-&gt;ID3v2IsValidTextEncoding($source_data_array['encodingid'])) {
+						$this-&gt;errors[] = 'Invalid Text Encoding in '.$frame_name.' ('.$source_data_array['encodingid'].')';
+					} elseif (!$this-&gt;IsValidDateStampString($source_data_array['pricevaliduntil'])) {
+						$this-&gt;errors[] = 'Invalid Valid Until date in '.$frame_name.' ('.$source_data_array['pricevaliduntil'].') (format = YYYYMMDD)';
+					} elseif (!$this-&gt;IsValidURL($source_data_array['contacturl'], false, true)) {
+						$this-&gt;errors[] = 'Invalid Contact URL in '.$frame_name.' ('.$source_data_array['contacturl'].') (allowed schemes: http, https, ftp, mailto)';
+					} elseif (!$this-&gt;ID3v2IsValidCOMRreceivedAs($source_data_array['receivedasid'])) {
+						$this-&gt;errors[] = 'Invalid Received As byte in '.$frame_name.' ('.$source_data_array['contacturl'].') (range = 0 to 8)';
+					} elseif (!$this-&gt;IsValidMIMEstring($source_data_array['mime'])) {
+						$this-&gt;errors[] = 'Invalid MIME Type in '.$frame_name.' ('.$source_data_array['mime'].')';
+					} else {
+						$framedata .= chr($source_data_array['encodingid']);
+						unset($pricestring);
+						foreach ($source_data_array['price'] as $key =&gt; $val) {
+							if ($this-&gt;ID3v2IsValidPriceString($key.$val['value'])) {
+								$pricestrings[] = $key.$val['value'];
+							} else {
+								$this-&gt;errors[] = 'Invalid Price String in '.$frame_name.' ('.$key.$val['value'].')';
+							}
+						}
+						$framedata .= implode('/', $pricestrings);
+						$framedata .= $source_data_array['pricevaliduntil'];
+						$framedata .= str_replace(&quot;\x00&quot;, '', $source_data_array['contacturl']).&quot;\x00&quot;;
+						$framedata .= chr($source_data_array['receivedasid']);
+						$framedata .= $source_data_array['sellername'].getid3_id3v2::TextEncodingTerminatorLookup($source_data_array['encodingid']);
+						$framedata .= $source_data_array['description'].getid3_id3v2::TextEncodingTerminatorLookup($source_data_array['encodingid']);
+						$framedata .= $source_data_array['mime'].&quot;\x00&quot;;
+						$framedata .= $source_data_array['logo'];
+					}
+					break;
+
+				case 'ENCR':
+					// 4.25  ENCR Encryption method registration (ID3v2.3+ only)
+					// Owner identifier    &lt;text string&gt; $00
+					// Method symbol       $xx
+					// Encryption data     &lt;binary data&gt;
+					if (!$this-&gt;IsWithinBitRange($source_data_array['methodsymbol'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Group Symbol in '.$frame_name.' ('.$source_data_array['methodsymbol'].') (range = 0 to 255)';
+					} else {
+						$framedata .= str_replace(&quot;\x00&quot;, '', $source_data_array['ownerid']).&quot;\x00&quot;;
+						$framedata .= ord($source_data_array['methodsymbol']);
+						$framedata .= $source_data_array['data'];
+					}
+					break;
+
+				case 'GRID':
+					// 4.26  GRID Group identification registration (ID3v2.3+ only)
+					// Owner identifier      &lt;text string&gt; $00
+					// Group symbol          $xx
+					// Group dependent data  &lt;binary data&gt;
+					if (!$this-&gt;IsWithinBitRange($source_data_array['groupsymbol'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Group Symbol in '.$frame_name.' ('.$source_data_array['groupsymbol'].') (range = 0 to 255)';
+					} else {
+						$framedata .= str_replace(&quot;\x00&quot;, '', $source_data_array['ownerid']).&quot;\x00&quot;;
+						$framedata .= ord($source_data_array['groupsymbol']);
+						$framedata .= $source_data_array['data'];
+					}
+					break;
+
+				case 'PRIV':
+					// 4.27  PRIV Private frame (ID3v2.3+ only)
+					// Owner identifier      &lt;text string&gt; $00
+					// The private data      &lt;binary data&gt;
+					$framedata .= str_replace(&quot;\x00&quot;, '', $source_data_array['ownerid']).&quot;\x00&quot;;
+					$framedata .= $source_data_array['data'];
+					break;
+
+				case 'SIGN':
+					// 4.28  SIGN Signature frame (ID3v2.4+ only)
+					// Group symbol      $xx
+					// Signature         &lt;binary data&gt;
+					if (!$this-&gt;IsWithinBitRange($source_data_array['groupsymbol'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Group Symbol in '.$frame_name.' ('.$source_data_array['groupsymbol'].') (range = 0 to 255)';
+					} else {
+						$framedata .= ord($source_data_array['groupsymbol']);
+						$framedata .= $source_data_array['data'];
+					}
+					break;
+
+				case 'SEEK':
+					// 4.29  SEEK Seek frame (ID3v2.4+ only)
+					// Minimum offset to next tag       $xx xx xx xx
+					if (!$this-&gt;IsWithinBitRange($source_data_array['data'], 32, false)) {
+						$this-&gt;errors[] = 'Invalid Minimum Offset in '.$frame_name.' ('.$source_data_array['data'].') (range = 0 to 4294967295)';
+					} else {
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['data'], 4, false);
+					}
+					break;
+
+				case 'ASPI':
+					// 4.30  ASPI Audio seek point index (ID3v2.4+ only)
+					// Indexed data start (S)         $xx xx xx xx
+					// Indexed data length (L)        $xx xx xx xx
+					// Number of index points (N)     $xx xx
+					// Bits per index point (b)       $xx
+					//   Then for every index point the following data is included:
+					// Fraction at index (Fi)          $xx (xx)
+					if (!$this-&gt;IsWithinBitRange($source_data_array['datastart'], 32, false)) {
+						$this-&gt;errors[] = 'Invalid Indexed Data Start in '.$frame_name.' ('.$source_data_array['datastart'].') (range = 0 to 4294967295)';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['datalength'], 32, false)) {
+						$this-&gt;errors[] = 'Invalid Indexed Data Length in '.$frame_name.' ('.$source_data_array['datalength'].') (range = 0 to 4294967295)';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['indexpoints'], 16, false)) {
+						$this-&gt;errors[] = 'Invalid Number Of Index Points in '.$frame_name.' ('.$source_data_array['indexpoints'].') (range = 0 to 65535)';
+					} elseif (!$this-&gt;IsWithinBitRange($source_data_array['bitsperpoint'], 8, false)) {
+						$this-&gt;errors[] = 'Invalid Bits Per Index Point in '.$frame_name.' ('.$source_data_array['bitsperpoint'].') (range = 0 to 255)';
+					} elseif ($source_data_array['indexpoints'] != count($source_data_array['indexes'])) {
+						$this-&gt;errors[] = 'Number Of Index Points does not match actual supplied data in '.$frame_name;
+					} else {
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['datastart'], 4, false);
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['datalength'], 4, false);
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['indexpoints'], 2, false);
+						$framedata .= getid3_lib::BigEndian2String($source_data_array['bitsperpoint'], 1, false);
+						foreach ($source_data_array['indexes'] as $key =&gt; $val) {
+							$framedata .= getid3_lib::BigEndian2String($val, ceil($source_data_array['bitsperpoint'] / 8), false);
+						}
+					}
+					break;
+
+				case 'RGAD':
+					//   RGAD Replay Gain Adjustment
+					//   <A HREF="http://privatewww.essex.ac.uk/~djmrob/replaygain/">http://privatewww.essex.ac.uk/~djmrob/replaygain/</A>
+					// Peak Amplitude                     $xx $xx $xx $xx
+					// Radio Replay Gain Adjustment        %aaabbbcd %dddddddd
+					// Audiophile Replay Gain Adjustment   %aaabbbcd %dddddddd
+					//   a - name code
+					//   b - originator code
+					//   c - sign bit
+					//   d - replay gain adjustment
+
+					if (($source_data_array['track_adjustment'] &gt; 51) || ($source_data_array['track_adjustment'] &lt; -51)) {
+						$this-&gt;errors[] = 'Invalid Track Adjustment in '.$frame_name.' ('.$source_data_array['track_adjustment'].') (range = -51.0 to +51.0)';
+					} elseif (($source_data_array['album_adjustment'] &gt; 51) || ($source_data_array['album_adjustment'] &lt; -51)) {
+						$this-&gt;errors[] = 'Invalid Album Adjustment in '.$frame_name.' ('.$source_data_array['album_adjustment'].') (range = -51.0 to +51.0)';
+					} elseif (!$this-&gt;ID3v2IsValidRGADname($source_data_array['raw']['track_name'])) {
+						$this-&gt;errors[] = 'Invalid Track Name Code in '.$frame_name.' ('.$source_data_array['raw']['track_name'].') (range = 0 to 2)';
+					} elseif (!$this-&gt;ID3v2IsValidRGADname($source_data_array['raw']['album_name'])) {
+						$this-&gt;errors[] = 'Invalid Album Name Code in '.$frame_name.' ('.$source_data_array['raw']['album_name'].') (range = 0 to 2)';
+					} elseif (!$this-&gt;ID3v2IsValidRGADoriginator($source_data_array['raw']['track_originator'])) {
+						$this-&gt;errors[] = 'Invalid Track Originator Code in '.$frame_name.' ('.$source_data_array['raw']['track_originator'].') (range = 0 to 3)';
+					} elseif (!$this-&gt;ID3v2IsValidRGADoriginator($source_data_array['raw']['album_originator'])) {
+						$this-&gt;errors[] = 'Invalid Album Originator Code in '.$frame_name.' ('.$source_data_array['raw']['album_originator'].') (range = 0 to 3)';
+					} else {
+						$framedata .= getid3_lib::Float2String($source_data_array['peakamplitude'], 32);
+						$framedata .= getid3_lib::RGADgainString($source_data_array['raw']['track_name'], $source_data_array['raw']['track_originator'], $source_data_array['track_adjustment']);
+						$framedata .= getid3_lib::RGADgainString($source_data_array['raw']['album_name'], $source_data_array['raw']['album_originator'], $source_data_array['album_adjustment']);
+					}
+					break;
+
+				default:
+					if ($frame_name{0} == 'T') {
+						// 4.2. T???  Text information frames
+						// Text encoding                $xx
+						// Information                  &lt;text string(s) according to encoding&gt;
+						$source_data_array['encodingid'] = (isset($source_data_array['encodingid']) ? $source_data_array['encodingid'] : $this-&gt;id3v2_default_encodingid);
+						if (!$this-&gt;ID3v2IsValidTextEncoding($source_data_array['encodingid'])) {
+							$this-&gt;errors[] = 'Invalid Text Encoding in '.$frame_name.' ('.$source_data_array['encodingid'].') for ID3v2.'.$this-&gt;majorversion;
+						} else {
+							$framedata .= chr($source_data_array['encodingid']);
+							$framedata .= $source_data_array['data'];
+						}
+					} elseif ($frame_name{0} == 'W') {
+						// 4.3. W???  URL link frames
+						// URL              &lt;text string&gt;
+						if (!$this-&gt;IsValidURL($source_data_array['data'], false, false)) {
+							$this-&gt;errors[] = 'Invalid URL in '.$frame_name.' ('.$source_data_array['data'].')';
+						} else {
+							$framedata .= $source_data_array['data'];
+						}
+					} else {
+						$this-&gt;errors[] = $frame_name.' not yet supported in $this-&gt;GenerateID3v2FrameData()';
+					}
+					break;
+			}
+		}
+		if (!empty($this-&gt;errors)) {
+			return false;
+		}
+		return $framedata;
+	}
+
+	function ID3v2FrameIsAllowed($frame_name, $source_data_array) {
+		static $PreviousFrames = array();
+
+		if ($frame_name === null) {
+			// if the writing functions are called multiple times, the static array needs to be
+			// cleared - this can be done by calling $this-&gt;ID3v2FrameIsAllowed(null, '')
+			$PreviousFrames = array();
+			return true;
+		}
+
+		if ($this-&gt;majorversion == 4) {
+			switch ($frame_name) {
+				case 'UFID':
+				case 'AENC':
+				case 'ENCR':
+				case 'GRID':
+					if (!isset($source_data_array['ownerid'])) {
+						$this-&gt;errors[] = '[ownerid] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['ownerid'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same OwnerID ('.$source_data_array['ownerid'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['ownerid'];
+					}
+					break;
+
+				case 'TXXX':
+				case 'WXXX':
+				case 'RVA2':
+				case 'EQU2':
+				case 'APIC':
+				case 'GEOB':
+					if (!isset($source_data_array['description'])) {
+						$this-&gt;errors[] = '[description] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['description'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same Description ('.$source_data_array['description'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['description'];
+					}
+					break;
+
+				case 'USER':
+					if (!isset($source_data_array['language'])) {
+						$this-&gt;errors[] = '[language] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['language'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same Language ('.$source_data_array['language'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['language'];
+					}
+					break;
+
+				case 'USLT':
+				case 'SYLT':
+				case 'COMM':
+					if (!isset($source_data_array['language'])) {
+						$this-&gt;errors[] = '[language] not specified for '.$frame_name;
+					} elseif (!isset($source_data_array['description'])) {
+						$this-&gt;errors[] = '[description] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['language'].$source_data_array['description'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same Language + Description ('.$source_data_array['language'].' + '.$source_data_array['description'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['language'].$source_data_array['description'];
+					}
+					break;
+
+				case 'POPM':
+					if (!isset($source_data_array['email'])) {
+						$this-&gt;errors[] = '[email] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['email'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same Email ('.$source_data_array['email'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['email'];
+					}
+					break;
+
+				case 'IPLS':
+				case 'MCDI':
+				case 'ETCO':
+				case 'MLLT':
+				case 'SYTC':
+				case 'RVRB':
+				case 'PCNT':
+				case 'RBUF':
+				case 'POSS':
+				case 'OWNE':
+				case 'SEEK':
+				case 'ASPI':
+				case 'RGAD':
+					if (in_array($frame_name, $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed';
+					} else {
+						$PreviousFrames[] = $frame_name;
+					}
+					break;
+
+				case 'LINK':
+					// this isn't implemented quite right (yet) - it should check the target frame data for compliance
+					// but right now it just allows one linked frame of each type, to be safe.
+					if (!isset($source_data_array['frameid'])) {
+						$this-&gt;errors[] = '[frameid] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['frameid'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same FrameID ('.$source_data_array['frameid'].')';
+					} elseif (in_array($source_data_array['frameid'], $PreviousFrames)) {
+						// no links to singleton tags
+						$this-&gt;errors[] = 'Cannot specify a '.$frame_name.' tag to a singleton tag that already exists ('.$source_data_array['frameid'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['frameid']; // only one linked tag of this type
+						$PreviousFrames[] = $source_data_array['frameid'];             // no non-linked singleton tags of this type
+					}
+					break;
+
+				case 'COMR':
+					//   There may be more than one 'commercial frame' in a tag, but no two may be identical
+					// Checking isn't implemented at all (yet) - just assumes that it's OK.
+					break;
+
+				case 'PRIV':
+				case 'SIGN':
+					if (!isset($source_data_array['ownerid'])) {
+						$this-&gt;errors[] = '[ownerid] not specified for '.$frame_name;
+					} elseif (!isset($source_data_array['data'])) {
+						$this-&gt;errors[] = '[data] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['ownerid'].$source_data_array['data'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same OwnerID + Data ('.$source_data_array['ownerid'].' + '.$source_data_array['data'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['ownerid'].$source_data_array['data'];
+					}
+					break;
+
+				default:
+					if (($frame_name{0} != 'T') &amp;&amp; ($frame_name{0} != 'W')) {
+						$this-&gt;errors[] = 'Frame not allowed in ID3v2.'.$this-&gt;majorversion.': '.$frame_name;
+					}
+					break;
+			}
+
+		} elseif ($this-&gt;majorversion == 3) {
+
+			switch ($frame_name) {
+				case 'UFID':
+				case 'AENC':
+				case 'ENCR':
+				case 'GRID':
+					if (!isset($source_data_array['ownerid'])) {
+						$this-&gt;errors[] = '[ownerid] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['ownerid'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same OwnerID ('.$source_data_array['ownerid'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['ownerid'];
+					}
+					break;
+
+				case 'TXXX':
+				case 'WXXX':
+				case 'APIC':
+				case 'GEOB':
+					if (!isset($source_data_array['description'])) {
+						$this-&gt;errors[] = '[description] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['description'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same Description ('.$source_data_array['description'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['description'];
+					}
+					break;
+
+				case 'USER':
+					if (!isset($source_data_array['language'])) {
+						$this-&gt;errors[] = '[language] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['language'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same Language ('.$source_data_array['language'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['language'];
+					}
+					break;
+
+				case 'USLT':
+				case 'SYLT':
+				case 'COMM':
+					if (!isset($source_data_array['language'])) {
+						$this-&gt;errors[] = '[language] not specified for '.$frame_name;
+					} elseif (!isset($source_data_array['description'])) {
+						$this-&gt;errors[] = '[description] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['language'].$source_data_array['description'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same Language + Description ('.$source_data_array['language'].' + '.$source_data_array['description'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['language'].$source_data_array['description'];
+					}
+					break;
+
+				case 'POPM':
+					if (!isset($source_data_array['email'])) {
+						$this-&gt;errors[] = '[email] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['email'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same Email ('.$source_data_array['email'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['email'];
+					}
+					break;
+
+				case 'IPLS':
+				case 'MCDI':
+				case 'ETCO':
+				case 'MLLT':
+				case 'SYTC':
+				case 'RVAD':
+				case 'EQUA':
+				case 'RVRB':
+				case 'PCNT':
+				case 'RBUF':
+				case 'POSS':
+				case 'OWNE':
+				case 'RGAD':
+					if (in_array($frame_name, $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed';
+					} else {
+						$PreviousFrames[] = $frame_name;
+					}
+					break;
+
+				case 'LINK':
+					// this isn't implemented quite right (yet) - it should check the target frame data for compliance
+					// but right now it just allows one linked frame of each type, to be safe.
+					if (!isset($source_data_array['frameid'])) {
+						$this-&gt;errors[] = '[frameid] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['frameid'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same FrameID ('.$source_data_array['frameid'].')';
+					} elseif (in_array($source_data_array['frameid'], $PreviousFrames)) {
+						// no links to singleton tags
+						$this-&gt;errors[] = 'Cannot specify a '.$frame_name.' tag to a singleton tag that already exists ('.$source_data_array['frameid'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['frameid']; // only one linked tag of this type
+						$PreviousFrames[] = $source_data_array['frameid'];             // no non-linked singleton tags of this type
+					}
+					break;
+
+				case 'COMR':
+					//   There may be more than one 'commercial frame' in a tag, but no two may be identical
+					// Checking isn't implemented at all (yet) - just assumes that it's OK.
+					break;
+
+				case 'PRIV':
+					if (!isset($source_data_array['ownerid'])) {
+						$this-&gt;errors[] = '[ownerid] not specified for '.$frame_name;
+					} elseif (!isset($source_data_array['data'])) {
+						$this-&gt;errors[] = '[data] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['ownerid'].$source_data_array['data'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same OwnerID + Data ('.$source_data_array['ownerid'].' + '.$source_data_array['data'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['ownerid'].$source_data_array['data'];
+					}
+					break;
+
+				default:
+					if (($frame_name{0} != 'T') &amp;&amp; ($frame_name{0} != 'W')) {
+						$this-&gt;errors[] = 'Frame not allowed in ID3v2.'.$this-&gt;majorversion.': '.$frame_name;
+					}
+					break;
+			}
+
+		} elseif ($this-&gt;majorversion == 2) {
+
+			switch ($frame_name) {
+				case 'UFI':
+				case 'CRM':
+				case 'CRA':
+					if (!isset($source_data_array['ownerid'])) {
+						$this-&gt;errors[] = '[ownerid] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['ownerid'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same OwnerID ('.$source_data_array['ownerid'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['ownerid'];
+					}
+					break;
+
+				case 'TXX':
+				case 'WXX':
+				case 'PIC':
+				case 'GEO':
+					if (!isset($source_data_array['description'])) {
+						$this-&gt;errors[] = '[description] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['description'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same Description ('.$source_data_array['description'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['description'];
+					}
+					break;
+
+				case 'ULT':
+				case 'SLT':
+				case 'COM':
+					if (!isset($source_data_array['language'])) {
+						$this-&gt;errors[] = '[language] not specified for '.$frame_name;
+					} elseif (!isset($source_data_array['description'])) {
+						$this-&gt;errors[] = '[description] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['language'].$source_data_array['description'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same Language + Description ('.$source_data_array['language'].' + '.$source_data_array['description'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['language'].$source_data_array['description'];
+					}
+					break;
+
+				case 'POP':
+					if (!isset($source_data_array['email'])) {
+						$this-&gt;errors[] = '[email] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['email'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same Email ('.$source_data_array['email'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['email'];
+					}
+					break;
+
+				case 'IPL':
+				case 'MCI':
+				case 'ETC':
+				case 'MLL':
+				case 'STC':
+				case 'RVA':
+				case 'EQU':
+				case 'REV':
+				case 'CNT':
+				case 'BUF':
+					if (in_array($frame_name, $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed';
+					} else {
+						$PreviousFrames[] = $frame_name;
+					}
+					break;
+
+				case 'LNK':
+					// this isn't implemented quite right (yet) - it should check the target frame data for compliance
+					// but right now it just allows one linked frame of each type, to be safe.
+					if (!isset($source_data_array['frameid'])) {
+						$this-&gt;errors[] = '[frameid] not specified for '.$frame_name;
+					} elseif (in_array($frame_name.$source_data_array['frameid'], $PreviousFrames)) {
+						$this-&gt;errors[] = 'Only one '.$frame_name.' tag allowed with the same FrameID ('.$source_data_array['frameid'].')';
+					} elseif (in_array($source_data_array['frameid'], $PreviousFrames)) {
+						// no links to singleton tags
+						$this-&gt;errors[] = 'Cannot specify a '.$frame_name.' tag to a singleton tag that already exists ('.$source_data_array['frameid'].')';
+					} else {
+						$PreviousFrames[] = $frame_name.$source_data_array['frameid']; // only one linked tag of this type
+						$PreviousFrames[] = $source_data_array['frameid'];             // no non-linked singleton tags of this type
+					}
+					break;
+
+				default:
+					if (($frame_name{0} != 'T') &amp;&amp; ($frame_name{0} != 'W')) {
+						$this-&gt;errors[] = 'Frame not allowed in ID3v2.'.$this-&gt;majorversion.': '.$frame_name;
+					}
+					break;
+			}
+		}
+
+		if (!empty($this-&gt;errors)) {
+			return false;
+		}
+		return true;
+	}
+
+	function GenerateID3v2Tag($noerrorsonly=true) {
+		$this-&gt;ID3v2FrameIsAllowed(null, ''); // clear static array in case this isn't the first call to $this-&gt;GenerateID3v2Tag()
+
+		$tagstring = '';
+		if (is_array($this-&gt;tag_data)) {
+			foreach ($this-&gt;tag_data as $frame_name =&gt; $frame_rawinputdata) {
+				foreach ($frame_rawinputdata as $irrelevantindex =&gt; $source_data_array) {
+					if (getid3_id3v2::IsValidID3v2FrameName($frame_name, $this-&gt;majorversion)) {
+						unset($frame_length);
+						unset($frame_flags);
+						$frame_data = false;
+						if ($this-&gt;ID3v2FrameIsAllowed($frame_name, $source_data_array)) {
+							if ($frame_data = $this-&gt;GenerateID3v2FrameData($frame_name, $source_data_array)) {
+								$FrameUnsynchronisation = false;
+								if ($this-&gt;majorversion &gt;= 4) {
+									// frame-level unsynchronisation
+									$unsynchdata = $frame_data;
+									if ($this-&gt;id3v2_use_unsynchronisation) {
+										$unsynchdata = $this-&gt;Unsynchronise($frame_data);
+									}
+									if (strlen($unsynchdata) != strlen($frame_data)) {
+										// unsynchronisation needed
+										$FrameUnsynchronisation = true;
+										$frame_data = $unsynchdata;
+										if (isset($TagUnsynchronisation) &amp;&amp; $TagUnsynchronisation === false) {
+											// only set to true if ALL frames are unsynchronised
+										} else {
+											$TagUnsynchronisation = true;
+										}
+									} else {
+										if (isset($TagUnsynchronisation)) {
+											$TagUnsynchronisation = false;
+										}
+									}
+									unset($unsynchdata);
+
+									$frame_length = getid3_lib::BigEndian2String(strlen($frame_data), 4, true);
+								} else {
+									$frame_length = getid3_lib::BigEndian2String(strlen($frame_data), 4, false);
+								}
+								$frame_flags  = $this-&gt;GenerateID3v2FrameFlags($this-&gt;ID3v2FrameFlagsLookupTagAlter($frame_name), $this-&gt;ID3v2FrameFlagsLookupFileAlter($frame_name), false, false, false, false, $FrameUnsynchronisation, false);
+							}
+						} else {
+							$this-&gt;errors[] = 'Frame &quot;'.$frame_name.'&quot; is NOT allowed';
+						}
+						if ($frame_data === false) {
+							$this-&gt;errors[] = '$this-&gt;GenerateID3v2FrameData() failed for &quot;'.$frame_name.'&quot;';
+							if ($noerrorsonly) {
+								return false;
+							} else {
+								unset($frame_name);
+							}
+						}
+					} else {
+						// ignore any invalid frame names, including 'title', 'header', etc
+						$this-&gt;warnings[] = 'Ignoring invalid ID3v2 frame type: &quot;'.$frame_name.'&quot;';
+						unset($frame_name);
+						unset($frame_length);
+						unset($frame_flags);
+						unset($frame_data);
+					}
+					if (isset($frame_name) &amp;&amp; isset($frame_length) &amp;&amp; isset($frame_flags) &amp;&amp; isset($frame_data)) {
+						$tagstring .= $frame_name.$frame_length.$frame_flags.$frame_data;
+					}
+				}
+			}
+
+			if (!isset($TagUnsynchronisation)) {
+				$TagUnsynchronisation = false;
+			}
+			if (($this-&gt;majorversion &lt;= 3) &amp;&amp; $this-&gt;id3v2_use_unsynchronisation) {
+				// tag-level unsynchronisation
+				$unsynchdata = $this-&gt;Unsynchronise($tagstring);
+				if (strlen($unsynchdata) != strlen($tagstring)) {
+					// unsynchronisation needed
+					$TagUnsynchronisation = true;
+					$tagstring = $unsynchdata;
+				}
+			}
+
+			while ($this-&gt;paddedlength &lt; (strlen($tagstring) + getid3_id3v2::ID3v2HeaderLength($this-&gt;majorversion))) {
+				$this-&gt;paddedlength += 1024;
+			}
+
+			$footer = false; // ID3v2 footers not yet supported in getID3()
+			if (!$footer &amp;&amp; ($this-&gt;paddedlength &gt; (strlen($tagstring) + getid3_id3v2::ID3v2HeaderLength($this-&gt;majorversion)))) {
+				// pad up to $paddedlength bytes if unpadded tag is shorter than $paddedlength
+				// &quot;Furthermore it MUST NOT have any padding when a tag footer is added to the tag.&quot;
+				$tagstring .= @str_repeat(&quot;\x00&quot;, $this-&gt;paddedlength - strlen($tagstring) - getid3_id3v2::ID3v2HeaderLength($this-&gt;majorversion));
+			}
+			if ($this-&gt;id3v2_use_unsynchronisation &amp;&amp; (substr($tagstring, strlen($tagstring) - 1, 1) == &quot;\xFF&quot;)) {
+				// special unsynchronisation case:
+				// if last byte == $FF then appended a $00
+				$TagUnsynchronisation = true;
+				$tagstring .= &quot;\x00&quot;;
+			}
+
+			$tagheader  = 'ID3';
+			$tagheader .= chr($this-&gt;majorversion);
+			$tagheader .= chr($this-&gt;minorversion);
+			$tagheader .= $this-&gt;GenerateID3v2TagFlags(array('unsynchronisation'=&gt;$TagUnsynchronisation));
+			$tagheader .= getid3_lib::BigEndian2String(strlen($tagstring), 4, true);
+
+			return $tagheader.$tagstring;
+		}
+		$this-&gt;errors[] = 'tag_data is not an array in GenerateID3v2Tag()';
+		return false;
+	}
+
+	function ID3v2IsValidPriceString($pricestring) {
+		if (getid3_id3v2::LanguageLookup(substr($pricestring, 0, 3), true) == '') {
+			return false;
+		} elseif (!$this-&gt;IsANumber(substr($pricestring, 3), true)) {
+			return false;
+		}
+		return true;
+	}
+
+	function ID3v2FrameFlagsLookupTagAlter($framename) {
+		// unfinished
+		switch ($framename) {
+			case 'RGAD':
+				$allow = true;
+			default:
+				$allow = false;
+				break;
+		}
+		return $allow;
+	}
+
+	function ID3v2FrameFlagsLookupFileAlter($framename) {
+		// unfinished
+		switch ($framename) {
+			case 'RGAD':
+				return false;
+				break;
+
+			default:
+				return false;
+				break;
+		}
+	}
+
+	function ID3v2IsValidETCOevent($eventid) {
+		if (($eventid &lt; 0) || ($eventid &gt; 0xFF)) {
+			// outside range of 1 byte
+			return false;
+		} elseif (($eventid &gt;= 0xF0) &amp;&amp; ($eventid &lt;= 0xFC)) {
+			// reserved for future use
+			return false;
+		} elseif (($eventid &gt;= 0x17) &amp;&amp; ($eventid &lt;= 0xDF)) {
+			// reserved for future use
+			return false;
+		} elseif (($eventid &gt;= 0x0E) &amp;&amp; ($eventid &lt;= 0x16) &amp;&amp; ($this-&gt;majorversion == 2)) {
+			// not defined in ID3v2.2
+			return false;
+		} elseif (($eventid &gt;= 0x15) &amp;&amp; ($eventid &lt;= 0x16) &amp;&amp; ($this-&gt;majorversion == 3)) {
+			// not defined in ID3v2.3
+			return false;
+		}
+		return true;
+	}
+
+	function ID3v2IsValidSYLTtype($contenttype) {
+		if (($contenttype &gt;= 0) &amp;&amp; ($contenttype &lt;= 8) &amp;&amp; ($this-&gt;majorversion == 4)) {
+			return true;
+		} elseif (($contenttype &gt;= 0) &amp;&amp; ($contenttype &lt;= 6) &amp;&amp; ($this-&gt;majorversion == 3)) {
+			return true;
+		}
+		return false;
+	}
+
+	function ID3v2IsValidRVA2channeltype($channeltype) {
+		if (($channeltype &gt;= 0) &amp;&amp; ($channeltype &lt;= 8) &amp;&amp; ($this-&gt;majorversion == 4)) {
+			return true;
+		}
+		return false;
+	}
+
+	function ID3v2IsValidAPICpicturetype($picturetype) {
+		if (($picturetype &gt;= 0) &amp;&amp; ($picturetype &lt;= 0x14) &amp;&amp; ($this-&gt;majorversion &gt;= 2) &amp;&amp; ($this-&gt;majorversion &lt;= 4)) {
+			return true;
+		}
+		return false;
+	}
+
+	function ID3v2IsValidAPICimageformat($imageformat) {
+		if ($imageformat == '--&gt;') {
+			return true;
+		} elseif ($this-&gt;majorversion == 2) {
+			if ((strlen($imageformat) == 3) &amp;&amp; ($imageformat == strtoupper($imageformat))) {
+				return true;
+			}
+		} elseif (($this-&gt;majorversion == 3) || ($this-&gt;majorversion == 4)) {
+			if ($this-&gt;IsValidMIMEstring($imageformat)) {
+				return true;
+			}
+		}
+		return false;
+	}
+
+	function ID3v2IsValidCOMRreceivedAs($receivedas) {
+		if (($this-&gt;majorversion &gt;= 3) &amp;&amp; ($receivedas &gt;= 0) &amp;&amp; ($receivedas &lt;= 8)) {
+			return true;
+		}
+		return false;
+	}
+
+	function ID3v2IsValidRGADname($RGADname) {
+		if (($RGADname &gt;= 0) &amp;&amp; ($RGADname &lt;= 2)) {
+			return true;
+		}
+		return false;
+	}
+
+	function ID3v2IsValidRGADoriginator($RGADoriginator) {
+		if (($RGADoriginator &gt;= 0) &amp;&amp; ($RGADoriginator &lt;= 3)) {
+			return true;
+		}
+		return false;
+	}
+
+	function ID3v2IsValidTextEncoding($textencodingbyte) {
+		static $ID3v2IsValidTextEncoding_cache = array(
+			2 =&gt; array(true, true),
+			3 =&gt; array(true, true),
+			4 =&gt; array(true, true, true, true));
+		return isset($ID3v2IsValidTextEncoding_cache[$this-&gt;majorversion][$textencodingbyte]);
+	}
+
+	function Unsynchronise($data) {
+		// Whenever a false synchronisation is found within the tag, one zeroed
+		// byte is inserted after the first false synchronisation byte. The
+		// format of a correct sync that should be altered by ID3 encoders is as
+		// follows:
+		//      %11111111 111xxxxx
+		// And should be replaced with:
+		//      %11111111 00000000 111xxxxx
+		// This has the side effect that all $FF 00 combinations have to be
+		// altered, so they won't be affected by the decoding process. Therefore
+		// all the $FF 00 combinations have to be replaced with the $FF 00 00
+		// combination during the unsynchronisation.
+
+		$data = str_replace(&quot;\xFF\x00&quot;, &quot;\xFF\x00\x00&quot;, $data);
+		$unsyncheddata = '';
+		$datalength = strlen($data);
+		for ($i = 0; $i &lt; $datalength; $i++) {
+			$thischar = $data{$i};
+			$unsyncheddata .= $thischar;
+			if ($thischar == &quot;\xFF&quot;) {
+				$nextchar = ord($data{$i + 1});
+				if (($nextchar &amp; 0xE0) == 0xE0) {
+					// previous byte = 11111111, this byte = 111?????
+					$unsyncheddata .= &quot;\x00&quot;;
+				}
+			}
+		}
+		return $unsyncheddata;
+	}
+
+	function is_hash($var) {
+		// written by dev-null&#216;christophe*vg
+		// taken from <A HREF="http://www.php.net/manual/en/function.array-merge-recursive.php">http://www.php.net/manual/en/function.array-merge-recursive.php</A>
+		if (is_array($var)) {
+			$keys = array_keys($var);
+			$all_num = true;
+			for ($i = 0; $i &lt; count($keys); $i++) {
+				if (is_string($keys[$i])) {
+					return true;
+				}
+			}
+		}
+		return false;
+	}
+
+	function array_join_merge($arr1, $arr2) {
+		// written by dev-null&#216;christophe*vg
+		// taken from <A HREF="http://www.php.net/manual/en/function.array-merge-recursive.php">http://www.php.net/manual/en/function.array-merge-recursive.php</A>
+		if (is_array($arr1) &amp;&amp; is_array($arr2)) {
+			// the same -&gt; merge
+			$new_array = array();
+
+			if ($this-&gt;is_hash($arr1) &amp;&amp; $this-&gt;is_hash($arr2)) {
+				// hashes -&gt; merge based on keys
+				$keys = array_merge(array_keys($arr1), array_keys($arr2));
+				foreach ($keys as $key) {
+					$new_array[$key] = $this-&gt;array_join_merge(@$arr1[$key], @$arr2[$key]);
+				}
+			} else {
+				// two real arrays -&gt; merge
+				$new_array = array_reverse(array_unique(array_reverse(array_merge($arr1, $arr2))));
+			}
+			return $new_array;
+		} else {
+			// not the same ... take new one if defined, else the old one stays
+			return $arr2 ? $arr2 : $arr1;
+		}
+	}
+
+	function IsValidMIMEstring($mimestring) {
+		if ((strlen($mimestring) &gt;= 3) &amp;&amp; (strpos($mimestring, '/') &gt; 0) &amp;&amp; (strpos($mimestring, '/') &lt; (strlen($mimestring) - 1))) {
+			return true;
+		}
+		return false;
+	}
+
+	function IsWithinBitRange($number, $maxbits, $signed=false) {
+		if ($signed) {
+			if (($number &gt; (0 - pow(2, $maxbits - 1))) &amp;&amp; ($number &lt;= pow(2, $maxbits - 1))) {
+				return true;
+			}
+		} else {
+			if (($number &gt;= 0) &amp;&amp; ($number &lt;= pow(2, $maxbits))) {
+				return true;
+			}
+		}
+		return false;
+	}
+
+	function safe_parse_url($url) {
+		$parts = @parse_url($url);
+		$parts['scheme'] = (isset($parts['scheme']) ? $parts['scheme'] : '');
+		$parts['host']   = (isset($parts['host'])   ? $parts['host']   : '');
+		$parts['user']   = (isset($parts['user'])   ? $parts['user']   : '');
+		$parts['pass']   = (isset($parts['pass'])   ? $parts['pass']   : '');
+		$parts['path']   = (isset($parts['path'])   ? $parts['path']   : '');
+		$parts['query']  = (isset($parts['query'])  ? $parts['query']  : '');
+		return $parts;
+	}
+
+	function IsValidURL($url, $allowUserPass=false) {
+		if ($url == '') {
+			return false;
+		}
+		if ($allowUserPass !== true) {
+			if (strstr($url, '@')) {
+				// in the format <A HREF="http://user:pass@example.com">http://user:pass@example.com</A>  or <A HREF="http://user@example.com">http://user@example.com</A>
+				// but could easily be somebody incorrectly entering an email address in place of a URL
+				return false;
+			}
+		}
+		if ($parts = $this-&gt;safe_parse_url($url)) {
+			if (($parts['scheme'] != 'http') &amp;&amp; ($parts['scheme'] != 'https') &amp;&amp; ($parts['scheme'] != 'ftp') &amp;&amp; ($parts['scheme'] != 'gopher')) {
+				return false;
+			} elseif (!eregi(&quot;^[[:alnum:]]([-.]?[0-9a-z])*\.[a-z]{2,3}$&quot;, $parts['host'], $regs) &amp;&amp; !IsValidDottedIP($parts['host'])) {
+				return false;
+			} elseif (!eregi(&quot;^([[:alnum:]-]|[\_])*$&quot;, $parts['user'], $regs)) {
+				return false;
+			} elseif (!eregi(&quot;^([[:alnum:]-]|[\_])*$&quot;, $parts['pass'], $regs)) {
+				return false;
+			} elseif (!eregi(&quot;^[[:alnum:]/_\.@~-]*$&quot;, $parts['path'], $regs)) {
+				return false;
+			} elseif (!eregi(&quot;^[[:alnum:]?&amp;=+:;_()%#/,\.-]*$&quot;, $parts['query'], $regs)) {
+				return false;
+			} else {
+				return true;
+			}
+		}
+		return false;
+	}
+
+	function ID3v2ShortFrameNameLookup($majorversion, $long_description) {
+		$long_description = str_replace(' ', '_', strtolower(trim($long_description)));
+		static $ID3v2ShortFrameNameLookup = array();
+		if (empty($ID3v2ShortFrameNameLookup)) {
+
+			// The following are unique to ID3v2.2
+			$ID3v2ShortFrameNameLookup[2]['comment']                                          = 'COM';
+			$ID3v2ShortFrameNameLookup[2]['album']                                            = 'TAL';
+			$ID3v2ShortFrameNameLookup[2]['beats_per_minute']                                 = 'TBP';
+			$ID3v2ShortFrameNameLookup[2]['composer']                                         = 'TCM';
+			$ID3v2ShortFrameNameLookup[2]['genre']                                            = 'TCO';
+			$ID3v2ShortFrameNameLookup[2]['copyright']                                        = 'TCR';
+			$ID3v2ShortFrameNameLookup[2]['encoded_by']                                       = 'TEN';
+			$ID3v2ShortFrameNameLookup[2]['language']                                         = 'TLA';
+			$ID3v2ShortFrameNameLookup[2]['length']                                           = 'TLE';
+			$ID3v2ShortFrameNameLookup[2]['original_artist']                                  = 'TOA';
+			$ID3v2ShortFrameNameLookup[2]['original_filename']                                = 'TOF';
+			$ID3v2ShortFrameNameLookup[2]['original_lyricist']                                = 'TOL';
+			$ID3v2ShortFrameNameLookup[2]['original_album_title']                             = 'TOT';
+			$ID3v2ShortFrameNameLookup[2]['artist']                                           = 'TP1';
+			$ID3v2ShortFrameNameLookup[2]['band']                                             = 'TP2';
+			$ID3v2ShortFrameNameLookup[2]['conductor']                                        = 'TP3';
+			$ID3v2ShortFrameNameLookup[2]['remixer']                                          = 'TP4';
+			$ID3v2ShortFrameNameLookup[2]['publisher']                                        = 'TPB';
+			$ID3v2ShortFrameNameLookup[2]['isrc']                                             = 'TRC';
+			$ID3v2ShortFrameNameLookup[2]['tracknumber']                                      = 'TRK';
+			$ID3v2ShortFrameNameLookup[2]['size']                                             = 'TSI';
+			$ID3v2ShortFrameNameLookup[2]['encoder_settings']                                 = 'TSS';
+			$ID3v2ShortFrameNameLookup[2]['description']                                      = 'TT1';
+			$ID3v2ShortFrameNameLookup[2]['title']                                            = 'TT2';
+			$ID3v2ShortFrameNameLookup[2]['subtitle']                                         = 'TT3';
+			$ID3v2ShortFrameNameLookup[2]['lyricist']                                         = 'TXT';
+			$ID3v2ShortFrameNameLookup[2]['user_text']                                        = 'TXX';
+			$ID3v2ShortFrameNameLookup[2]['year']                                             = 'TYE';
+			$ID3v2ShortFrameNameLookup[2]['unique_file_identifier']                           = 'UFI';
+			$ID3v2ShortFrameNameLookup[2]['unsynchronised_lyrics']                            = 'ULT';
+			$ID3v2ShortFrameNameLookup[2]['url_file']                                         = 'WAF';
+			$ID3v2ShortFrameNameLookup[2]['url_artist']                                       = 'WAR';
+			$ID3v2ShortFrameNameLookup[2]['url_source']                                       = 'WAS';
+			$ID3v2ShortFrameNameLookup[2]['copyright_information']                            = 'WCP';
+			$ID3v2ShortFrameNameLookup[2]['url_publisher']                                    = 'WPB';
+			$ID3v2ShortFrameNameLookup[2]['url_user']                                         = 'WXX';
+
+			// The following are common to ID3v2.3 and ID3v2.4
+			$ID3v2ShortFrameNameLookup[3]['audio_encryption']                                 = 'AENC';
+			$ID3v2ShortFrameNameLookup[3]['attached_picture']                                 = 'APIC';
+			$ID3v2ShortFrameNameLookup[3]['comment']                                          = 'COMM';
+			$ID3v2ShortFrameNameLookup[3]['commercial']                                       = 'COMR';
+			$ID3v2ShortFrameNameLookup[3]['encryption_method_registration']                   = 'ENCR';
+			$ID3v2ShortFrameNameLookup[3]['event_timing_codes']                               = 'ETCO';
+			$ID3v2ShortFrameNameLookup[3]['general_encapsulated_object']                      = 'GEOB';
+			$ID3v2ShortFrameNameLookup[3]['group_identification_registration']                = 'GRID';
+			$ID3v2ShortFrameNameLookup[3]['linked_information']                               = 'LINK';
+			$ID3v2ShortFrameNameLookup[3]['music_cd_identifier']                              = 'MCDI';
+			$ID3v2ShortFrameNameLookup[3]['mpeg_location_lookup_table']                       = 'MLLT';
+			$ID3v2ShortFrameNameLookup[3]['ownership']                                        = 'OWNE';
+			$ID3v2ShortFrameNameLookup[3]['play_counter']                                     = 'PCNT';
+			$ID3v2ShortFrameNameLookup[3]['popularimeter']                                    = 'POPM';
+			$ID3v2ShortFrameNameLookup[3]['position_synchronisation']                         = 'POSS';
+			$ID3v2ShortFrameNameLookup[3]['private']                                          = 'PRIV';
+			$ID3v2ShortFrameNameLookup[3]['recommended_buffer_size']                          = 'RBUF';
+			$ID3v2ShortFrameNameLookup[3]['reverb']                                           = 'RVRB';
+			$ID3v2ShortFrameNameLookup[3]['synchronised_lyrics']                              = 'SYLT';
+			$ID3v2ShortFrameNameLookup[3]['synchronised_tempo_codes']                         = 'SYTC';
+			$ID3v2ShortFrameNameLookup[3]['album']                                            = 'TALB';
+			$ID3v2ShortFrameNameLookup[3]['beats_per_minute']                                 = 'TBPM';
+			$ID3v2ShortFrameNameLookup[3]['composer']                                         = 'TCOM';
+			$ID3v2ShortFrameNameLookup[3]['genre']                                            = 'TCON';
+			$ID3v2ShortFrameNameLookup[3]['copyright']                                        = 'TCOP';
+			$ID3v2ShortFrameNameLookup[3]['playlist_delay']                                   = 'TDLY';
+			$ID3v2ShortFrameNameLookup[3]['encoded_by']                                       = 'TENC';
+			$ID3v2ShortFrameNameLookup[3]['lyricist']                                         = 'TEXT';
+			$ID3v2ShortFrameNameLookup[3]['file_type']                                        = 'TFLT';
+			$ID3v2ShortFrameNameLookup[3]['content_group_description']                        = 'TIT1';
+			$ID3v2ShortFrameNameLookup[3]['title']                                            = 'TIT2';
+			$ID3v2ShortFrameNameLookup[3]['subtitle']                                         = 'TIT3';
+			$ID3v2ShortFrameNameLookup[3]['initial_key']                                      = 'TKEY';
+			$ID3v2ShortFrameNameLookup[3]['language']                                         = 'TLAN';
+			$ID3v2ShortFrameNameLookup[3]['length']                                           = 'TLEN';
+			$ID3v2ShortFrameNameLookup[3]['media_type']                                       = 'TMED';
+			$ID3v2ShortFrameNameLookup[3]['original_album_title']                             = 'TOAL';
+			$ID3v2ShortFrameNameLookup[3]['original_filename']                                = 'TOFN';
+			$ID3v2ShortFrameNameLookup[3]['original_lyricist']                                = 'TOLY';
+			$ID3v2ShortFrameNameLookup[3]['original_artist']                                  = 'TOPE';
+			$ID3v2ShortFrameNameLookup[3]['file_owner']                                       = 'TOWN';
+			$ID3v2ShortFrameNameLookup[3]['artist']                                           = 'TPE1';
+			$ID3v2ShortFrameNameLookup[3]['band']                                             = 'TPE2';
+			$ID3v2ShortFrameNameLookup[3]['conductor']                                        = 'TPE3';
+			$ID3v2ShortFrameNameLookup[3]['remixer']                                          = 'TPE4';
+			$ID3v2ShortFrameNameLookup[3]['part_of_set']                                      = 'TPOS';
+			$ID3v2ShortFrameNameLookup[3]['publisher']                                        = 'TPUB';
+			$ID3v2ShortFrameNameLookup[3]['tracknumber']                                      = 'TRCK';
+			$ID3v2ShortFrameNameLookup[3]['internet_radio_station_name']                      = 'TRSN';
+			$ID3v2ShortFrameNameLookup[3]['internet_radio_station_owner']                     = 'TRSO';
+			$ID3v2ShortFrameNameLookup[3]['isrc']                                             = 'TSRC';
+			$ID3v2ShortFrameNameLookup[3]['encoder_settings']                                 = 'TSSE';
+			$ID3v2ShortFrameNameLookup[3]['user_text']                                        = 'TXXX';
+			$ID3v2ShortFrameNameLookup[3]['unique_file_identifier']                           = 'UFID';
+			$ID3v2ShortFrameNameLookup[3]['terms_of_use']                                     = 'USER';
+			$ID3v2ShortFrameNameLookup[3]['unsynchronised_lyrics']                            = 'USLT';
+			$ID3v2ShortFrameNameLookup[3]['commercial']                                       = 'WCOM';
+			$ID3v2ShortFrameNameLookup[3]['copyright_information']                            = 'WCOP';
+			$ID3v2ShortFrameNameLookup[3]['url_file']                                         = 'WOAF';
+			$ID3v2ShortFrameNameLookup[3]['url_artist']                                       = 'WOAR';
+			$ID3v2ShortFrameNameLookup[3]['url_source']                                       = 'WOAS';
+			$ID3v2ShortFrameNameLookup[3]['url_station']                                      = 'WORS';
+			$ID3v2ShortFrameNameLookup[3]['payment']                                          = 'WPAY';
+			$ID3v2ShortFrameNameLookup[3]['url_publisher']                                    = 'WPUB';
+			$ID3v2ShortFrameNameLookup[3]['url_user']                                         = 'WXXX';
+
+			// The above are common to ID3v2.3 and ID3v2.4
+			// so copy them to ID3v2.4 before adding specifics for 2.3 and 2.4
+			$ID3v2ShortFrameNameLookup[4] = $ID3v2ShortFrameNameLookup[3];
+
+			// The following are unique to ID3v2.3
+			$ID3v2ShortFrameNameLookup[3]['equalisation']                                     = 'EQUA';
+			$ID3v2ShortFrameNameLookup[3]['involved_people_list']                             = 'IPLS';
+			$ID3v2ShortFrameNameLookup[3]['relative_volume_adjustment']                       = 'RVAD';
+			$ID3v2ShortFrameNameLookup[3]['date']                                             = 'TDAT';
+			$ID3v2ShortFrameNameLookup[3]['time']                                             = 'TIME';
+			$ID3v2ShortFrameNameLookup[3]['original_release_year']                            = 'TORY';
+			$ID3v2ShortFrameNameLookup[3]['recording_dates']                                  = 'TRDA';
+			$ID3v2ShortFrameNameLookup[3]['size']                                             = 'TSIZ';
+			$ID3v2ShortFrameNameLookup[3]['year']                                             = 'TYER';
+
+
+			// The following are unique to ID3v2.4
+			$ID3v2ShortFrameNameLookup[4]['audio_seek_point_index']                           = 'ASPI';
+			$ID3v2ShortFrameNameLookup[4]['equalisation']                                     = 'EQU2';
+			$ID3v2ShortFrameNameLookup[4]['relative_volume_adjustment']                       = 'RVA2';
+			$ID3v2ShortFrameNameLookup[4]['seek']                                             = 'SEEK';
+			$ID3v2ShortFrameNameLookup[4]['signature']                                        = 'SIGN';
+			$ID3v2ShortFrameNameLookup[4]['encoding_time']                                    = 'TDEN';
+			$ID3v2ShortFrameNameLookup[4]['original_release_time']                            = 'TDOR';
+			$ID3v2ShortFrameNameLookup[4]['recording_time']                                   = 'TDRC';
+			$ID3v2ShortFrameNameLookup[4]['release_time']                                     = 'TDRL';
+			$ID3v2ShortFrameNameLookup[4]['tagging_time']                                     = 'TDTG';
+			$ID3v2ShortFrameNameLookup[4]['involved_people_list']                             = 'TIPL';
+			$ID3v2ShortFrameNameLookup[4]['musician_credits_list']                            = 'TMCL';
+			$ID3v2ShortFrameNameLookup[4]['mood']                                             = 'TMOO';
+			$ID3v2ShortFrameNameLookup[4]['produced_notice']                                  = 'TPRO';
+			$ID3v2ShortFrameNameLookup[4]['album_sort_order']                                 = 'TSOA';
+			$ID3v2ShortFrameNameLookup[4]['performer_sort_order']                             = 'TSOP';
+			$ID3v2ShortFrameNameLookup[4]['title_sort_order']                                 = 'TSOT';
+			$ID3v2ShortFrameNameLookup[4]['set_subtitle']                                     = 'TSST';
+		}
+		return @$ID3v2ShortFrameNameLookup[$majorversion][strtolower($long_description)];
+
+	}
+
+}
+
+?&gt;


Property changes on: trunk/inc/external/getid3/write.id3v2.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/write.lyrics3.php
===================================================================
--- trunk/inc/external/getid3/write.lyrics3.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/write.lyrics3.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,78 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// write.lyrics3.php                                           //
+// module for writing Lyrics3 tags                             //
+// dependencies: module.tag.lyrics3.php                        //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_write_lyrics3
+{
+	var $filename;
+	var $tag_data;
+	//var $lyrics3_version = 2;       // 1 or 2
+	var $warnings        = array(); // any non-critical errors will be stored here
+	var $errors          = array(); // any critical errors will be stored here
+
+	function getid3_write_lyrics3() {
+		return true;
+	}
+
+	function WriteLyrics3() {
+		$this-&gt;errors[] = 'WriteLyrics3() not yet functional - cannot write Lyrics3';
+		return false;
+	}
+
+	function DeleteLyrics3() {
+		// Initialize getID3 engine
+		$getID3 = new getID3;
+		$ThisFileInfo = $getID3-&gt;analyze($this-&gt;filename);
+		if (isset($ThisFileInfo['lyrics3']['tag_offset_start']) &amp;&amp; isset($ThisFileInfo['lyrics3']['tag_offset_end'])) {
+			if ($fp = @fopen($this-&gt;filename, 'a+b')) {
+
+				flock($fp, LOCK_EX);
+				$oldignoreuserabort = ignore_user_abort(true);
+
+				fseek($fp, $ThisFileInfo['lyrics3']['tag_offset_end'], SEEK_SET);
+				$DataAfterLyrics3 = '';
+				if ($ThisFileInfo['filesize'] &gt; $ThisFileInfo['lyrics3']['tag_offset_end']) {
+					$DataAfterLyrics3 = fread($fp, $ThisFileInfo['filesize'] - $ThisFileInfo['lyrics3']['tag_offset_end']);
+				}
+
+				ftruncate($fp, $ThisFileInfo['lyrics3']['tag_offset_start']);
+
+				if (!empty($DataAfterLyrics3)) {
+					fseek($fp, $ThisFileInfo['lyrics3']['tag_offset_start'], SEEK_SET);
+					fwrite($fp, $DataAfterLyrics3, strlen($DataAfterLyrics3));
+				}
+
+				flock($fp, LOCK_UN);
+				fclose($fp);
+				ignore_user_abort($oldignoreuserabort);
+
+				return true;
+
+			} else {
+
+				$this-&gt;errors[] = 'Cannot open &quot;'.$this-&gt;filename.'&quot; in &quot;a+b&quot; mode';
+				return false;
+
+			}
+		}
+		// no Lyrics3 present
+		return true;
+	}
+
+
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/write.lyrics3.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/write.metaflac.php
===================================================================
--- trunk/inc/external/getid3/write.metaflac.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/write.metaflac.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,167 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// write.metaflac.php                                          //
+// module for writing metaflac tags                            //
+// dependencies: /helperapps/metaflac.exe                      //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_write_metaflac
+{
+
+	var $filename;
+	var $tag_data;
+	var $warnings = array(); // any non-critical errors will be stored here
+	var $errors   = array(); // any critical errors will be stored here
+
+	function getid3_write_metaflac() {
+		return true;
+	}
+
+	function WriteMetaFLAC() {
+
+		if (!ini_get('safe_mode')) {
+
+			// Create file with new comments
+			$tempcommentsfilename = tempnam('*', 'getID3');
+			if ($fpcomments = @fopen($tempcommentsfilename, 'wb')) {
+
+				foreach ($this-&gt;tag_data as $key =&gt; $value) {
+					foreach ($value as $commentdata) {
+						fwrite($fpcomments, $this-&gt;CleanmetaflacName($key).'='.$commentdata.&quot;\n&quot;);
+					}
+				}
+				fclose($fpcomments);
+
+			} else {
+
+				$this-&gt;errors[] = 'failed to open temporary tags file &quot;'.$tempcommentsfilename.'&quot;, tags not written';
+				return false;
+
+			}
+
+			$oldignoreuserabort = ignore_user_abort(true);
+			if (GETID3_OS_ISWINDOWS) {
+
+				if (file_exists(GETID3_HELPERAPPSDIR.'metaflac.exe')) {
+					//$commandline = '&quot;'.GETID3_HELPERAPPSDIR.'metaflac.exe&quot; --no-utf8-convert --remove-vc-all --import-vc-from=&quot;'.$tempcommentsfilename.'&quot; &quot;'.str_replace('/', '\\', $this-&gt;filename).'&quot;';
+					//  metaflac works fine if you copy-paste the above commandline into a command prompt,
+					//  but refuses to work with `backtick` if there are &quot;doublequotes&quot; present around BOTH
+					//  the metaflac pathname and the target filename. For whatever reason...??
+					//  The solution is simply ensure that the metaflac pathname has no spaces,
+					//  and therefore does not need to be quoted
+
+					// On top of that, if error messages are not always captured properly under Windows
+					// To at least see if there was a problem, compare file modification timestamps before and after writing
+					clearstatcache();
+					$timestampbeforewriting = filemtime($this-&gt;filename);
+
+					$commandline = GETID3_HELPERAPPSDIR.'metaflac.exe --no-utf8-convert --remove-vc-all --import-vc-from=&quot;'.$tempcommentsfilename.'&quot; &quot;'.$this-&gt;filename.'&quot; 2&gt;&amp;1';
+					$metaflacError = `$commandline`;
+
+					if (empty($metaflacError)) {
+						clearstatcache();
+						if ($timestampbeforewriting == filemtime($this-&gt;filename)) {
+							$metaflacError = 'File modification timestamp has not changed - it looks like the tags were not written';
+						}
+					}
+				} else {
+					$metaflacError = 'metaflac.exe not found in '.GETID3_HELPERAPPSDIR;
+				}
+
+			} else {
+
+				// It's simpler on *nix
+				$commandline = 'metaflac --no-utf8-convert --remove-vc-all --import-vc-from='.$tempcommentsfilename.' &quot;'.$this-&gt;filename.'&quot; 2&gt;&amp;1';
+				$metaflacError = `$commandline`;
+
+			}
+
+			// Remove temporary comments file
+			unlink($tempcommentsfilename);
+			ignore_user_abort($oldignoreuserabort);
+
+			if (!empty($metaflacError)) {
+
+				$this-&gt;errors[] = 'System call to metaflac failed with this message returned: '.&quot;\n\n&quot;.$metaflacError;
+				return false;
+
+			}
+
+			return true;
+		}
+
+		$this-&gt;errors[] = 'PHP running in Safe Mode (backtick operator not available) - cannot call metaflac, tags not written';
+		return false;
+	}
+
+
+	function DeleteMetaFLAC() {
+
+		if (!ini_get('safe_mode')) {
+
+			$oldignoreuserabort = ignore_user_abort(true);
+			if (GETID3_OS_ISWINDOWS) {
+
+				if (file_exists(GETID3_HELPERAPPSDIR.'metaflac.exe')) {
+					// To at least see if there was a problem, compare file modification timestamps before and after writing
+					clearstatcache();
+					$timestampbeforewriting = filemtime($this-&gt;filename);
+
+					$commandline = GETID3_HELPERAPPSDIR.'metaflac.exe --remove-vc-all &quot;'.$this-&gt;filename.'&quot; 2&gt;&amp;1';
+					$metaflacError = `$commandline`;
+
+					if (empty($metaflacError)) {
+						clearstatcache();
+						if ($timestampbeforewriting == filemtime($this-&gt;filename)) {
+							$metaflacError = 'File modification timestamp has not changed - it looks like the tags were not deleted';
+						}
+					}
+				} else {
+					$metaflacError = 'metaflac.exe not found in '.GETID3_HELPERAPPSDIR;
+				}
+
+			} else {
+
+				// It's simpler on *nix
+				$commandline = 'metaflac --remove-vc-all &quot;'.$this-&gt;filename.'&quot; 2&gt;&amp;1';
+				$metaflacError = `$commandline`;
+
+			}
+
+			ignore_user_abort($oldignoreuserabort);
+
+			if (!empty($metaflacError)) {
+				$this-&gt;errors[] = 'System call to metaflac failed with this message returned: '.&quot;\n\n&quot;.$metaflacError;
+				return false;
+			}
+			return true;
+		}
+		$this-&gt;errors[] = 'PHP running in Safe Mode (backtick operator not available) - cannot call metaflac, tags not deleted';
+		return false;
+	}
+
+
+	function CleanmetaflacName($originalcommentname) {
+		// A case-insensitive field name that may consist of ASCII 0x20 through 0x7D, 0x3D ('=') excluded.
+		// ASCII 0x41 through 0x5A inclusive (A-Z) is to be considered equivalent to ASCII 0x61 through
+		// 0x7A inclusive (a-z).
+
+		// replace invalid chars with a space, return uppercase text
+		// Thanks Chris Bolt &lt;chris-getid3&#216;bolt*cx&gt; for improving this function
+		// note: ereg_replace() replaces nulls with empty string (not space)
+		return strtoupper(ereg_replace('[^ -&lt;&gt;-}]', ' ', str_replace(&quot;\x00&quot;, ' ', $originalcommentname)));
+
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/write.metaflac.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/write.php
===================================================================
--- trunk/inc/external/getid3/write.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/write.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,582 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+///                                                            //
+// write.php                                                   //
+// module for writing tags (APEv2, ID3v1, ID3v2)               //
+// dependencies: getid3.lib.php                                //
+//               write.apetag.php (optional)                   //
+//               write.id3v1.php (optional)                    //
+//               write.id3v2.php (optional)                    //
+//               write.vorbiscomment.php (optional)            //
+//               write.metaflac.php (optional)                 //
+//               write.lyrics3.php (optional)                  //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+if (!defined('GETID3_INCLUDEPATH')) {
+	die('getid3.php MUST be included before calling getid3_writetags');
+}
+if (!include_once(GETID3_INCLUDEPATH.'getid3.lib.php')) {
+	die('write.php depends on getid3.lib.php, which is missing.');
+}
+
+
+// NOTES:
+//
+// You should pass data here with standard field names as follows:
+// * TITLE
+// * ARTIST
+// * ALBUM
+// * TRACKNUMBER
+// * COMMENT
+// * GENRE
+// * YEAR
+// * ATTACHED_PICTURE (ID3v2 only)
+//
+// <A HREF="http://www.personal.uni-jena.de/~pfk/mpp/sv8/apekey.html">http://www.personal.uni-jena.de/~pfk/mpp/sv8/apekey.html</A>
+// The APEv2 Tag Items Keys definition says &quot;TRACK&quot; is correct but foobar2000 uses &quot;TRACKNUMBER&quot; instead
+// Pass data here as &quot;TRACKNUMBER&quot; for compatability with all formats
+
+
+class getid3_writetags
+{
+	// public
+	var $filename;                            // absolute filename of file to write tags to
+	var $tagformats         = array();        // array of tag formats to write ('id3v1', 'id3v2.2', 'id2v2.3', 'id3v2.4', 'ape', 'vorbiscomment', 'metaflac', 'real')
+	var $tag_data           = array(array()); // 2-dimensional array of tag data (ex: $data['ARTIST'][0] = 'Elvis')
+	var $tag_encoding       = 'ISO-8859-1';   // text encoding used for tag data ('ISO-8859-1', 'UTF-8', 'UTF-16', 'UTF-16LE', 'UTF-16BE', )
+	var $overwrite_tags     = true;           // if true will erase existing tag data and write only passed data; if false will merge passed data with existing tag data
+	var $remove_other_tags  = false;          // if true will erase remove all existing tags and only write those passed in $tagformats; if false will ignore any tags not mentioned in $tagformats
+
+	var $id3v2_tag_language = 'eng';          // ISO-639-2 3-character language code needed for some ID3v2 frames (<A HREF="http://www.id3.org/iso639-2.html">http://www.id3.org/iso639-2.html</A>)
+	var $id3v2_paddedlength = 4096;           // minimum length of ID3v2 tags (will be padded to this length if tag data is shorter)
+
+	var $warnings           = array();        // any non-critical errors will be stored here
+	var $errors             = array();        // any critical errors will be stored here
+
+	// private
+	var $ThisFileInfo; // analysis of file before writing
+
+	function getid3_writetags() {
+		return true;
+	}
+
+
+	function WriteTags() {
+
+		if (empty($this-&gt;filename)) {
+			$this-&gt;errors[] = 'filename is undefined in getid3_writetags';
+			return false;
+		} elseif (!file_exists($this-&gt;filename)) {
+			$this-&gt;errors[] = 'filename set to non-existant file &quot;'.$this-&gt;filename.'&quot; in getid3_writetags';
+			return false;
+		}
+
+		if (!is_array($this-&gt;tagformats)) {
+			$this-&gt;errors[] = 'tagformats must be an array in getid3_writetags';
+			return false;
+		}
+
+		if (filesize($this-&gt;filename) == 0) {
+
+			// empty file special case - allow any tag format, don't check existing format
+			// could be useful if you want to generate tag data for a non-existant file
+			$this-&gt;ThisFileInfo = array('fileformat'=&gt;'');
+			$AllowedTagFormats = array('id3v1', 'id3v2.2', 'id3v2.3', 'id3v2.4', 'ape', 'lyrics3');
+
+		} else {
+
+			$getID3 = new getID3;
+			$getID3-&gt;encoding = $this-&gt;tag_encoding;
+			$this-&gt;ThisFileInfo = $getID3-&gt;analyze($this-&gt;filename);
+
+			// check for what file types are allowed on this fileformat
+			switch (@$this-&gt;ThisFileInfo['fileformat']) {
+				case 'mp3':
+				case 'mp2':
+				case 'mp1':
+					$AllowedTagFormats = array('id3v1', 'id3v2.2', 'id3v2.3', 'id3v2.4', 'ape', 'lyrics3');
+					break;
+
+				case 'mpc':
+					$AllowedTagFormats = array('ape');
+					break;
+
+				case 'flac':
+					$AllowedTagFormats = array('metaflac');
+					break;
+
+				case 'real':
+					$AllowedTagFormats = array('real');
+					break;
+
+				case 'ogg':
+					switch (@$this-&gt;ThisFileInfo['audio']['dataformat']) {
+						case 'flac':
+							//$AllowedTagFormats = array('metaflac');
+							$this-&gt;errors[] = 'metaflac is not (yet) compatible with OggFLAC files';
+							return false;
+							break;
+						case 'vorbis':
+							$AllowedTagFormats = array('vorbiscomment');
+							break;
+						default:
+							$this-&gt;errors[] = 'metaflac is not (yet) compatible with Ogg files other than OggVorbis';
+							return false;
+							break;
+					}
+					break;
+
+				default:
+					$AllowedTagFormats = array();
+					break;
+			}
+			foreach ($this-&gt;tagformats as $requested_tag_format) {
+				if (!in_array($requested_tag_format, $AllowedTagFormats)) {
+					$errormessage = 'Tag format &quot;'.$requested_tag_format.'&quot; is not allowed on &quot;'.@$this-&gt;ThisFileInfo['fileformat'];
+					if (@$this-&gt;ThisFileInfo['fileformat'] != @$this-&gt;ThisFileInfo['audio']['dataformat']) {
+						$errormessage .= '.'.@$this-&gt;ThisFileInfo['audio']['dataformat'];
+					}
+					$errormessage .= '&quot; files';
+					$this-&gt;errors[] = $errormessage;
+					return false;
+				}
+			}
+
+			// List of other tag formats, removed if requested
+			$TagFormatsToRemove = array();
+			if ($this-&gt;remove_other_tags) {
+				foreach ($AllowedTagFormats as $AllowedTagFormat) {
+					switch ($AllowedTagFormat) {
+						case 'id3v2.2':
+						case 'id3v2.3':
+						case 'id3v2.4':
+							if (!in_array('id3v2', $TagFormatsToRemove) &amp;&amp; !in_array('id3v2.2', $this-&gt;tagformats) &amp;&amp; !in_array('id3v2.3', $this-&gt;tagformats) &amp;&amp; !in_array('id3v2.4', $this-&gt;tagformats)) {
+								$TagFormatsToRemove[] = 'id3v2';
+							}
+							break;
+
+						default:
+							if (!in_array($AllowedTagFormat, $this-&gt;tagformats)) {
+								$TagFormatsToRemove[] = $AllowedTagFormat;
+							}
+							break;
+					}
+				}
+			}
+		}
+
+		$WritingFilesToInclude = array_merge($this-&gt;tagformats, $TagFormatsToRemove);
+
+		// Check for required include files and include them
+		foreach ($WritingFilesToInclude as $tagformat) {
+			switch ($tagformat) {
+				case 'ape':
+					$GETID3_ERRORARRAY = &amp;$this-&gt;errors;
+					if (!getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'write.apetag.php', __FILE__, false)) {
+						return false;
+					}
+					break;
+
+				case 'id3v1':
+				case 'lyrics3':
+				case 'vorbiscomment':
+				case 'metaflac':
+				case 'real':
+					$GETID3_ERRORARRAY = &amp;$this-&gt;errors;
+					if (!getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'write.'.$tagformat.'.php', __FILE__, false)) {
+						return false;
+					}
+					break;
+
+				case 'id3v2.2':
+				case 'id3v2.3':
+				case 'id3v2.4':
+				case 'id3v2':
+					$GETID3_ERRORARRAY = &amp;$this-&gt;errors;
+					if (!getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'write.id3v2.php', __FILE__, false)) {
+						return false;
+					}
+					break;
+
+				default:
+					$this-&gt;errors[] = 'unknown tag format &quot;'.$tagformat.'&quot; in $tagformats in WriteTags()';
+					return false;
+					break;
+			}
+
+		}
+
+		// Validation of supplied data
+		if (!is_array($this-&gt;tag_data)) {
+			$this-&gt;errors[] = '$tag_data is not an array in WriteTags()';
+			return false;
+		}
+		// convert supplied data array keys to upper case, if they're not already
+		foreach ($this-&gt;tag_data as $tag_key =&gt; $tag_array) {
+			if (strtoupper($tag_key) !== $tag_key) {
+				$this-&gt;tag_data[strtoupper($tag_key)] = $this-&gt;tag_data[$tag_key];
+				unset($this-&gt;tag_data[$tag_key]);
+			}
+		}
+		// convert source data array keys to upper case, if they're not already
+		if (!empty($this-&gt;ThisFileInfo['tags'])) {
+			foreach ($this-&gt;ThisFileInfo['tags'] as $tag_format =&gt; $tag_data_array) {
+				foreach ($tag_data_array as $tag_key =&gt; $tag_array) {
+					if (strtoupper($tag_key) !== $tag_key) {
+						$this-&gt;ThisFileInfo['tags'][$tag_format][strtoupper($tag_key)] = $this-&gt;ThisFileInfo['tags'][$tag_format][$tag_key];
+						unset($this-&gt;ThisFileInfo['tags'][$tag_format][$tag_key]);
+					}
+				}
+			}
+		}
+
+		// Convert &quot;TRACK&quot; to &quot;TRACKNUMBER&quot; (if needed) for compatability with all formats
+		if (isset($this-&gt;tag_data['TRACK']) &amp;&amp; !isset($this-&gt;tag_data['TRACKNUMBER'])) {
+			$this-&gt;tag_data['TRACKNUMBER'] = $this-&gt;tag_data['TRACK'];
+			unset($this-&gt;tag_data['TRACK']);
+		}
+
+		// Remove all other tag formats, if requested
+		if ($this-&gt;remove_other_tags) {
+			$this-&gt;DeleteTags($TagFormatsToRemove);
+		}
+
+		// Write data for each tag format
+		foreach ($this-&gt;tagformats as $tagformat) {
+			$success = false; // overridden if tag writing is successful
+			switch ($tagformat) {
+				case 'ape':
+					$ape_writer = new getid3_write_apetag;
+					if (($ape_writer-&gt;tag_data = $this-&gt;FormatDataForAPE()) !== false) {
+						$ape_writer-&gt;filename = $this-&gt;filename;
+						if (($success = $ape_writer-&gt;WriteAPEtag()) === false) {
+							$this-&gt;errors[] = 'WriteAPEtag() failed with message(s):&lt;PRE&gt;&lt;UL&gt;&lt;LI&gt;'.trim(implode('&lt;/LI&gt;&lt;LI&gt;', $ape_writer-&gt;errors)).'&lt;/LI&gt;&lt;/UL&gt;&lt;/PRE&gt;';
+						}
+					} else {
+						$this-&gt;errors[] = 'FormatDataForAPE() failed';
+					}
+					break;
+
+				case 'id3v1':
+					$id3v1_writer = new getid3_write_id3v1;
+					if (($id3v1_writer-&gt;tag_data = $this-&gt;FormatDataForID3v1()) !== false) {
+						$id3v1_writer-&gt;filename = $this-&gt;filename;
+						if (($success = $id3v1_writer-&gt;WriteID3v1()) === false) {
+							$this-&gt;errors[] = 'WriteID3v1() failed with message(s):&lt;PRE&gt;&lt;UL&gt;&lt;LI&gt;'.trim(implode('&lt;/LI&gt;&lt;LI&gt;', $id3v1_writer-&gt;errors)).'&lt;/LI&gt;&lt;/UL&gt;&lt;/PRE&gt;';
+						}
+					} else {
+						$this-&gt;errors[] = 'FormatDataForID3v1() failed';
+					}
+					break;
+
+				case 'id3v2.2':
+				case 'id3v2.3':
+				case 'id3v2.4':
+					$id3v2_writer = new getid3_write_id3v2;
+					$id3v2_writer-&gt;majorversion = (int) substr($tagformat, -1);
+					$id3v2_writer-&gt;paddedlength = $this-&gt;id3v2_paddedlength;
+					if (($id3v2_writer-&gt;tag_data = $this-&gt;FormatDataForID3v2($id3v2_writer-&gt;majorversion)) !== false) {
+						$id3v2_writer-&gt;filename = $this-&gt;filename;
+						if (($success = $id3v2_writer-&gt;WriteID3v2()) === false) {
+							$this-&gt;errors[] = 'WriteID3v2() failed with message(s):&lt;PRE&gt;&lt;UL&gt;&lt;LI&gt;'.trim(implode('&lt;/LI&gt;&lt;LI&gt;', $id3v2_writer-&gt;errors)).'&lt;/LI&gt;&lt;/UL&gt;&lt;/PRE&gt;';
+						}
+					} else {
+						$this-&gt;errors[] = 'FormatDataForID3v2() failed';
+					}
+					break;
+
+				case 'vorbiscomment':
+					$vorbiscomment_writer = new getid3_write_vorbiscomment;
+					if (($vorbiscomment_writer-&gt;tag_data = $this-&gt;FormatDataForVorbisComment()) !== false) {
+						$vorbiscomment_writer-&gt;filename = $this-&gt;filename;
+						if (($success = $vorbiscomment_writer-&gt;WriteVorbisComment()) === false) {
+							$this-&gt;errors[] = 'WriteVorbisComment() failed with message(s):&lt;PRE&gt;&lt;UL&gt;&lt;LI&gt;'.trim(implode('&lt;/LI&gt;&lt;LI&gt;', $vorbiscomment_writer-&gt;errors)).'&lt;/LI&gt;&lt;/UL&gt;&lt;/PRE&gt;';
+						}
+					} else {
+						$this-&gt;errors[] = 'WriteVorbisComment() failed';
+					}
+					break;
+
+				case 'metaflac':
+					$metaflac_writer = new getid3_write_metaflac;
+					if (($metaflac_writer-&gt;tag_data = $this-&gt;FormatDataForMetaFLAC()) !== false) {
+						$metaflac_writer-&gt;filename = $this-&gt;filename;
+						if (($success = $metaflac_writer-&gt;WriteMetaFLAC()) === false) {
+							$this-&gt;errors[] = 'WriteMetaFLAC() failed with message(s):&lt;PRE&gt;&lt;UL&gt;&lt;LI&gt;'.trim(implode('&lt;/LI&gt;&lt;LI&gt;', $metaflac_writer-&gt;errors)).'&lt;/LI&gt;&lt;/UL&gt;&lt;/PRE&gt;';
+						}
+					} else {
+						$this-&gt;errors[] = 'FormatDataForMetaFLAC() failed';
+					}
+					break;
+
+				case 'real':
+					$real_writer = new getid3_write_real;
+					if (($real_writer-&gt;tag_data = $this-&gt;FormatDataForReal()) !== false) {
+						$real_writer-&gt;filename = $this-&gt;filename;
+						if (($success = $real_writer-&gt;WriteReal()) === false) {
+							$this-&gt;errors[] = 'WriteReal() failed with message(s):&lt;PRE&gt;&lt;UL&gt;&lt;LI&gt;'.trim(implode('&lt;/LI&gt;&lt;LI&gt;', $real_writer-&gt;errors)).'&lt;/LI&gt;&lt;/UL&gt;&lt;/PRE&gt;';
+						}
+					} else {
+						$this-&gt;errors[] = 'FormatDataForReal() failed';
+					}
+					break;
+
+				default:
+					$this-&gt;errors[] = 'Invalid tag format to write: &quot;'.$tagformat.'&quot;';
+					return false;
+					break;
+			}
+			if (!$success) {
+				return false;
+			}
+		}
+		return true;
+
+	}
+
+
+	function DeleteTags($TagFormatsToDelete) {
+		foreach ($TagFormatsToDelete as $DeleteTagFormat) {
+			$success = false; // overridden if tag deletion is successful
+			switch ($DeleteTagFormat) {
+				case 'id3v1':
+					$id3v1_writer = new getid3_write_id3v1;
+					$id3v1_writer-&gt;filename = $this-&gt;filename;
+					if (($success = $id3v1_writer-&gt;RemoveID3v1()) === false) {
+						$this-&gt;errors[] = 'RemoveID3v1() failed with message(s):&lt;PRE&gt;&lt;UL&gt;&lt;LI&gt;'.trim(implode('&lt;/LI&gt;&lt;LI&gt;', $id3v1_writer-&gt;errors)).'&lt;/LI&gt;&lt;/UL&gt;&lt;/PRE&gt;';
+					}
+					break;
+
+				case 'id3v2':
+					$id3v2_writer = new getid3_write_id3v2;
+					$id3v2_writer-&gt;filename = $this-&gt;filename;
+					if (($success = $id3v2_writer-&gt;RemoveID3v2()) === false) {
+						$this-&gt;errors[] = 'RemoveID3v2() failed with message(s):&lt;PRE&gt;&lt;UL&gt;&lt;LI&gt;'.trim(implode('&lt;/LI&gt;&lt;LI&gt;', $id3v2_writer-&gt;errors)).'&lt;/LI&gt;&lt;/UL&gt;&lt;/PRE&gt;';
+					}
+					break;
+
+				case 'ape':
+					$ape_writer = new getid3_write_apetag;
+					$ape_writer-&gt;filename = $this-&gt;filename;
+					if (($success = $ape_writer-&gt;DeleteAPEtag()) === false) {
+						$this-&gt;errors[] = 'DeleteAPEtag() failed with message(s):&lt;PRE&gt;&lt;UL&gt;&lt;LI&gt;'.trim(implode('&lt;/LI&gt;&lt;LI&gt;', $ape_writer-&gt;errors)).'&lt;/LI&gt;&lt;/UL&gt;&lt;/PRE&gt;';
+					}
+					break;
+
+				case 'vorbiscomment':
+					$vorbiscomment_writer = new getid3_write_vorbiscomment;
+					$vorbiscomment_writer-&gt;filename = $this-&gt;filename;
+					if (($success = $vorbiscomment_writer-&gt;DeleteVorbisComment()) === false) {
+						$this-&gt;errors[] = 'DeleteVorbisComment() failed with message(s):&lt;PRE&gt;&lt;UL&gt;&lt;LI&gt;'.trim(implode('&lt;/LI&gt;&lt;LI&gt;', $vorbiscomment_writer-&gt;errors)).'&lt;/LI&gt;&lt;/UL&gt;&lt;/PRE&gt;';
+					}
+					break;
+
+				case 'metaflac':
+					$metaflac_writer = new getid3_write_metaflac;
+					$metaflac_writer-&gt;filename = $this-&gt;filename;
+					if (($success = $metaflac_writer-&gt;DeleteMetaFLAC()) === false) {
+						$this-&gt;errors[] = 'DeleteMetaFLAC() failed with message(s):&lt;PRE&gt;&lt;UL&gt;&lt;LI&gt;'.trim(implode('&lt;/LI&gt;&lt;LI&gt;', $metaflac_writer-&gt;errors)).'&lt;/LI&gt;&lt;/UL&gt;&lt;/PRE&gt;';
+					}
+					break;
+
+				case 'lyrics3':
+					$lyrics3_writer = new getid3_write_lyrics3;
+					$lyrics3_writer-&gt;filename = $this-&gt;filename;
+					if (($success = $lyrics3_writer-&gt;DeleteLyrics3()) === false) {
+						$this-&gt;errors[] = 'DeleteLyrics3() failed with message(s):&lt;PRE&gt;&lt;UL&gt;&lt;LI&gt;'.trim(implode('&lt;/LI&gt;&lt;LI&gt;', $lyrics3_writer-&gt;errors)).'&lt;/LI&gt;&lt;/UL&gt;&lt;/PRE&gt;';
+					}
+					break;
+
+				default:
+					$this-&gt;errors[] = 'Invalid tag format to delete: &quot;'.$tagformat.'&quot;';
+					return false;
+					break;
+			}
+			if (!$success) {
+				return false;
+			}
+		}
+		return true;
+	}
+
+
+	function MergeExistingTagData($TagFormat, &amp;$tag_data) {
+		// Merge supplied data with existing data, if requested
+		if ($this-&gt;overwrite_tags) {
+			// do nothing - ignore previous data
+		} else {
+			if (!isset($this-&gt;ThisFileInfo['tags'][$TagFormat])) {
+				return false;
+			}
+			$tag_data = array_merge_recursive($tag_data, $this-&gt;ThisFileInfo['tags'][$TagFormat]);
+		}
+		return true;
+	}
+
+	function FormatDataForAPE() {
+		$ape_tag_data = array();
+		foreach ($this-&gt;tag_data as $tag_key =&gt; $valuearray) {
+			switch ($tag_key) {
+				case 'ATTACHED_PICTURE':
+					// ATTACHED_PICTURE is ID3v2 only - ignore
+					$this-&gt;warnings[] = '$data['.$tag_key.'] is assumed to be ID3v2 APIC data - NOT written to APE tag';
+					break;
+
+				default:
+					foreach ($valuearray as $key =&gt; $value) {
+						if (is_string($value) || is_numeric($value)) {
+							$ape_tag_data[$tag_key][$key] = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'UTF-8', $value);
+						} else {
+							$this-&gt;warnings[] = '$data['.$tag_key.']['.$key.'] is not a string value - all of $data['.$tag_key.'] NOT written to APE tag';
+							unset($ape_tag_data[$tag_key]);
+							break;
+						}
+					}
+					break;
+			}
+		}
+		$this-&gt;MergeExistingTagData('ape', $ape_tag_data);
+		return $ape_tag_data;
+	}
+
+
+	function FormatDataForID3v1() {
+		$tag_data_id3v1['genreid'] = 255;
+		if (!empty($this-&gt;tag_data['GENRE'])) {
+			foreach ($this-&gt;tag_data['GENRE'] as $key =&gt; $value) {
+				if (getid3_id3v1::LookupGenreID($value) !== false) {
+					$tag_data_id3v1['genreid'] = getid3_id3v1::LookupGenreID($value);
+					break;
+				}
+			}
+		}
+
+		$tag_data_id3v1['title']   = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'ISO-8859-1', @implode(' ', @$this-&gt;tag_data['TITLE']));
+		$tag_data_id3v1['artist']  = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'ISO-8859-1', @implode(' ', @$this-&gt;tag_data['ARTIST']));
+		$tag_data_id3v1['album']   = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'ISO-8859-1', @implode(' ', @$this-&gt;tag_data['ALBUM']));
+		$tag_data_id3v1['year']    = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'ISO-8859-1', @implode(' ', @$this-&gt;tag_data['YEAR']));
+		$tag_data_id3v1['comment'] = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'ISO-8859-1', @implode(' ', @$this-&gt;tag_data['COMMENT']));
+
+		$tag_data_id3v1['track']   = intval(getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'ISO-8859-1', @implode(' ', @$this-&gt;tag_data['TRACKNUMBER'])));
+		if ($tag_data_id3v1['track'] &lt;= 0) {
+			$tag_data_id3v1['track'] = '';
+		}
+
+		$this-&gt;MergeExistingTagData('id3v1', $tag_data_id3v1);
+		return $tag_data_id3v1;
+	}
+
+	function FormatDataForID3v2($id3v2_majorversion) {
+		$tag_data_id3v2 = array();
+
+		$ID3v2_text_encoding_lookup[2] = array('ISO-8859-1'=&gt;0, 'UTF-16'=&gt;1);
+		$ID3v2_text_encoding_lookup[3] = array('ISO-8859-1'=&gt;0, 'UTF-16'=&gt;1);
+		$ID3v2_text_encoding_lookup[4] = array('ISO-8859-1'=&gt;0, 'UTF-16'=&gt;1, 'UTF-16BE'=&gt;2, 'UTF-8'=&gt;3);
+		foreach ($this-&gt;tag_data as $tag_key =&gt; $valuearray) {
+			$ID3v2_framename = getid3_write_id3v2::ID3v2ShortFrameNameLookup($id3v2_majorversion, $tag_key);
+			switch ($ID3v2_framename) {
+				case 'APIC':
+					foreach ($valuearray as $key =&gt; $apic_data_array) {
+						if (isset($apic_data_array['data']) &amp;&amp;
+							isset($apic_data_array['picturetypeid']) &amp;&amp;
+							isset($apic_data_array['description']) &amp;&amp;
+							isset($apic_data_array['mime'])) {
+								$tag_data_id3v2['APIC'][] = $apic_data_array;
+						} else {
+							$this-&gt;errors[] = 'ID3v2 APIC data is not properly structured';
+							return false;
+						}
+					}
+					break;
+
+				case '':
+					$this-&gt;errors[] = 'ID3v2: Skipping &quot;'.$tag_key.'&quot; because cannot match it to a known ID3v2 frame type';
+					// some other data type, don't know how to handle it, ignore it
+					break;
+
+				default:
+					// most other (text) frames can be copied over as-is
+					foreach ($valuearray as $key =&gt; $value) {
+						if (isset($ID3v2_text_encoding_lookup[$id3v2_majorversion][$this-&gt;tag_encoding])) {
+							// source encoding is valid in ID3v2 - use it with no conversion
+							$tag_data_id3v2[$ID3v2_framename][$key]['encodingid'] = $ID3v2_text_encoding_lookup[$id3v2_majorversion][$this-&gt;tag_encoding];
+							$tag_data_id3v2[$ID3v2_framename][$key]['data']       = $value;
+						} else {
+							// source encoding is NOT valid in ID3v2 - convert it to an ID3v2-valid encoding first
+							if ($id3v2_majorversion &lt; 4) {
+								// convert data from other encoding to UTF-16
+								$tag_data_id3v2[$ID3v2_framename][$key]['encodingid'] = 1;
+								$tag_data_id3v2[$ID3v2_framename][$key]['data']       = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'UTF-16', $value);
+							} else {
+								// convert data from other encoding to UTF-8
+								$tag_data_id3v2[$ID3v2_framename][$key]['encodingid'] = 3;
+								$tag_data_id3v2[$ID3v2_framename][$key]['data']       = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'UTF-8', $value);
+							}
+						}
+
+						// These values are not needed for all frame types, but if they're not used no matter
+						$tag_data_id3v2[$ID3v2_framename][$key]['description'] = '';
+						$tag_data_id3v2[$ID3v2_framename][$key]['language']    = $this-&gt;id3v2_tag_language;
+					}
+					break;
+			}
+		}
+		$this-&gt;MergeExistingTagData('id3v2', $tag_data_id3v2);
+		return $tag_data_id3v2;
+	}
+
+	function FormatDataForVorbisComment() {
+		$tag_data_vorbiscomment = $this-&gt;tag_data;
+
+		// check for multi-line comment values - split out to multiple comments if neccesary
+		// and convert data to UTF-8 strings
+		foreach ($tag_data_vorbiscomment as $tag_key =&gt; $valuearray) {
+			foreach ($valuearray as $key =&gt; $value) {
+				str_replace(&quot;\r&quot;, &quot;\n&quot;, $value);
+				if (strstr($value, &quot;\n&quot;)) {
+					unset($tag_data_vorbiscomment[$tag_key][$key]);
+					$multilineexploded = explode(&quot;\n&quot;, $value);
+					foreach ($multilineexploded as $newcomment) {
+						if (strlen(trim($newcomment)) &gt; 0) {
+							$tag_data_vorbiscomment[$tag_key][] = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'UTF-8', $newcomment);
+						}
+					}
+				} elseif (is_string($value) || is_numeric($value)) {
+					$tag_data_vorbiscomment[$tag_key][$key] = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'UTF-8', $value);
+				} else {
+					$this-&gt;warnings[] = '$data['.$tag_key.']['.$key.'] is not a string value - all of $data['.$tag_key.'] NOT written to VorbisComment tag';
+					unset($tag_data_vorbiscomment[$tag_key]);
+					break;
+				}
+			}
+		}
+		$this-&gt;MergeExistingTagData('vorbiscomment', $tag_data_vorbiscomment);
+		return $tag_data_vorbiscomment;
+	}
+
+	function FormatDataForMetaFLAC() {
+		// FLAC &amp; OggFLAC use VorbisComments same as OggVorbis
+		// but require metaflac to do the writing rather than vorbiscomment
+		return $this-&gt;FormatDataForVorbisComment();
+	}
+
+	function FormatDataForReal() {
+		$tag_data_real['title']     = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'ISO-8859-1', @implode(' ', @$this-&gt;tag_data['TITLE']));
+		$tag_data_real['artist']    = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'ISO-8859-1', @implode(' ', @$this-&gt;tag_data['ARTIST']));
+		$tag_data_real['copyright'] = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'ISO-8859-1', @implode(' ', @$this-&gt;tag_data['COPYRIGHT']));
+		$tag_data_real['comment']   = getid3_lib::iconv_fallback($this-&gt;tag_encoding, 'ISO-8859-1', @implode(' ', @$this-&gt;tag_data['COMMENT']));
+
+		$this-&gt;MergeExistingTagData('real', $tag_data_real);
+		return $tag_data_real;
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/write.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/write.real.php
===================================================================
--- trunk/inc/external/getid3/write.real.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/write.real.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,140 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// write.real.php                                              //
+// module for writing RealAudio/RealVideo tags                 //
+// dependencies: module.tag.real.php                           //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+class getid3_write_real
+{
+	var $filename;
+	var $tag_data;
+	var $warnings     = array(); // any non-critical errors will be stored here
+	var $errors       = array(); // any critical errors will be stored here
+	var $paddedlength = 512;     // minimum length of CONT tag in bytes
+
+	function getid3_write_real() {
+		return true;
+	}
+
+	function WriteReal() {
+		// File MUST be writeable - CHMOD(646) at least
+		if (is_writeable($this-&gt;filename)) {
+			if ($fp_source = @fopen($this-&gt;filename, 'r+b')) {
+
+				// Initialize getID3 engine
+				$getID3 = new getID3;
+				$OldThisFileInfo = $getID3-&gt;analyze($this-&gt;filename);
+				if (empty($OldThisFileInfo['chunks']) &amp;&amp; !empty($OldThisFileInfo['old_ra_header'])) {
+					$this-&gt;errors[] = 'Cannot write Real tags on old-style file format';
+					return false;
+				}
+
+				$OldPROPinfo = false;
+				$StartOfDATA = false;
+				foreach ($OldThisFileInfo['chunks'] as $chunknumber =&gt; $chunkarray) {
+					if ($chunkarray['name'] == 'PROP') {
+						$OldPROPinfo = $chunkarray;
+					} elseif ($chunkarray['name'] = 'DATA') {
+						$StartOfDATA = $chunkarray['offset'];
+					}
+				}
+
+				if (!empty($OldPROPinfo['length'])) {
+					$this-&gt;paddedlength = max($OldPROPinfo['length'], $this-&gt;paddedlength);
+				}
+
+				$new_real_tag_data = GenerateRealTag();
+
+				if (@$OldPROPinfo['length'] == $new_real_tag_data) {
+
+					// new data length is same as old data length - just overwrite
+					fseek($fp_source, $OldPROPinfo['offset'], SEEK_SET);
+					fwrite($fp_source, $new_real_tag_data);
+
+				} else {
+
+					if (empty($OldPROPinfo)) {
+						// no existing PROP chunk
+						$BeforeOffset = $StartOfDATA;
+						$AfterOffset  = $StartOfDATA;
+					} else {
+						// new data is longer than old data
+						$BeforeOffset = $OldPROPinfo['offset'];
+						$AfterOffset  = $OldPROPinfo['offset'] + $OldPROPinfo['length'];
+					}
+
+
+				}
+
+				fclose($fp_source);
+				return true;
+
+			} else {
+				$this-&gt;errors[] = 'Could not open '.$this-&gt;filename.' mode &quot;r+b&quot;';
+				return false;
+			}
+		}
+		$this-&gt;errors[] = 'File is not writeable: '.$this-&gt;filename;
+		return false;
+	}
+
+	function GenerateRealTag() {
+		$RealCONT  = &quot;\x00\x00&quot;; // object version
+
+		$RealCONT .= BigEndian2String(strlen(@$this-&gt;tag_data['title']), 4);
+		$RealCONT .= @$this-&gt;tag_data['title'];
+
+		$RealCONT .= BigEndian2String(strlen(@$this-&gt;tag_data['artist']), 4);
+		$RealCONT .= @$this-&gt;tag_data['artist'];
+
+		$RealCONT .= BigEndian2String(strlen(@$this-&gt;tag_data['copyright']), 4);
+		$RealCONT .= @$this-&gt;tag_data['copyright'];
+
+		$RealCONT .= BigEndian2String(strlen(@$this-&gt;tag_data['comment']), 4);
+		$RealCONT .= @$this-&gt;tag_data['comment'];
+
+		if ($this-&gt;paddedlength &gt; (strlen($RealCONT) + 8)) {
+			$RealCONT .= str_repeat(&quot;\x00&quot;, $this-&gt;paddedlength - strlen($RealCONT) - 8);
+		}
+
+		$RealCONT  = 'CONT'.BigEndian2String(strlen($RealCONT) + 8, 4).$RealCONT; // CONT chunk identifier + chunk length
+
+		return $RealCONT;
+	}
+
+	function RemoveReal() {
+		// File MUST be writeable - CHMOD(646) at least
+		if (is_writeable($this-&gt;filename)) {
+			if ($fp_source = @fopen($this-&gt;filename, 'r+b')) {
+
+return false;
+				//fseek($fp_source, -128, SEEK_END);
+				//if (fread($fp_source, 3) == 'TAG') {
+				//	ftruncate($fp_source, filesize($this-&gt;filename) - 128);
+				//} else {
+				//	// no real tag to begin with - do nothing
+				//}
+				fclose($fp_source);
+				return true;
+
+			} else {
+				$this-&gt;errors[] = 'Could not open '.$this-&gt;filename.' mode &quot;r+b&quot;';
+			}
+		} else {
+			$this-&gt;errors[] = $this-&gt;filename.' is not writeable';
+		}
+		return false;
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/write.real.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/getid3/write.vorbiscomment.php
===================================================================
--- trunk/inc/external/getid3/write.vorbiscomment.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/getid3/write.vorbiscomment.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,124 @@
+&lt;?php
+/////////////////////////////////////////////////////////////////
+/// getID3() by James Heinrich &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at getid3.org</A>&gt;               //
+//  available at <A HREF="http://getid3.sourceforge.net">http://getid3.sourceforge.net</A>                 //
+//            or <A HREF="http://www.getid3.org">http://www.getid3.org</A>                         //
+/////////////////////////////////////////////////////////////////
+// See readme.txt for more details                             //
+/////////////////////////////////////////////////////////////////
+//                                                             //
+// write.vorbiscomment.php                                     //
+// module for writing VorbisComment tags                       //
+// dependencies: /helperapps/vorbiscomment.exe                 //
+//                                                            ///
+/////////////////////////////////////////////////////////////////
+
+
+class getid3_write_vorbiscomment
+{
+
+	var $filename;
+	var $tag_data;
+	var $warnings = array(); // any non-critical errors will be stored here
+	var $errors   = array(); // any critical errors will be stored here
+
+	function getid3_write_vorbiscomment() {
+		return true;
+	}
+
+	function WriteVorbisComment() {
+
+		if (!ini_get('safe_mode')) {
+
+			// Create file with new comments
+			$tempcommentsfilename = tempnam('*', 'getID3');
+			if ($fpcomments = @fopen($tempcommentsfilename, 'wb')) {
+
+				foreach ($this-&gt;tag_data as $key =&gt; $value) {
+					foreach ($value as $commentdata) {
+						fwrite($fpcomments, $this-&gt;CleanVorbisCommentName($key).'='.$commentdata.&quot;\n&quot;);
+					}
+				}
+				fclose($fpcomments);
+
+			} else {
+
+				$this-&gt;errors[] = 'failed to open temporary tags file &quot;'.$tempcommentsfilename.'&quot;, tags not written';
+				return false;
+
+			}
+
+			$oldignoreuserabort = ignore_user_abort(true);
+			if (GETID3_OS_ISWINDOWS) {
+
+				if (file_exists(GETID3_HELPERAPPSDIR.'vorbiscomment.exe')) {
+					//$commandline = '&quot;'.GETID3_HELPERAPPSDIR.'vorbiscomment.exe&quot; -w --raw -c &quot;'.$tempcommentsfilename.'&quot; &quot;'.str_replace('/', '\\', $this-&gt;filename).'&quot;';
+					//  vorbiscomment works fine if you copy-paste the above commandline into a command prompt,
+					//  but refuses to work with `backtick` if there are &quot;doublequotes&quot; present around BOTH
+					//  the metaflac pathname and the target filename. For whatever reason...??
+					//  The solution is simply ensure that the metaflac pathname has no spaces,
+					//  and therefore does not need to be quoted
+
+					// On top of that, if error messages are not always captured properly under Windows
+					// To at least see if there was a problem, compare file modification timestamps before and after writing
+					clearstatcache();
+					$timestampbeforewriting = filemtime($this-&gt;filename);
+
+					$commandline = GETID3_HELPERAPPSDIR.'vorbiscomment.exe -w --raw -c &quot;'.$tempcommentsfilename.'&quot; &quot;'.$this-&gt;filename.'&quot; 2&gt;&amp;1';
+					$VorbiscommentError = `$commandline`;
+
+					if (empty($VorbiscommentError)) {
+						clearstatcache();
+						if ($timestampbeforewriting == filemtime($this-&gt;filename)) {
+							$VorbiscommentError = 'File modification timestamp has not changed - it looks like the tags were not written';
+						}
+					}
+				} else {
+					$VorbiscommentError = 'vorbiscomment.exe not found in '.GETID3_HELPERAPPSDIR;
+				}
+
+			} else {
+
+				$commandline = 'vorbiscomment -w --raw -c &quot;'.$tempcommentsfilename.'&quot; &quot;'.$this-&gt;filename.'&quot; 2&gt;&amp;1';
+				$VorbiscommentError = `$commandline`;
+
+			}
+
+			// Remove temporary comments file
+			unlink($tempcommentsfilename);
+			ignore_user_abort($oldignoreuserabort);
+
+			if (!empty($VorbiscommentError)) {
+
+				$this-&gt;errors[] = 'system call to vorbiscomment failed with message: '.&quot;\n\n&quot;.$VorbiscommentError;
+				return false;
+
+			}
+
+			return true;
+		}
+
+		$this-&gt;errors[] = 'PHP running in Safe Mode (backtick operator not available) - cannot call vorbiscomment, tags not written';
+		return false;
+	}
+
+	function DeleteVorbisComment() {
+		$this-&gt;tag_data = array(array());
+		return $this-&gt;WriteVorbisComment();
+	}
+
+	function CleanVorbisCommentName($originalcommentname) {
+		// A case-insensitive field name that may consist of ASCII 0x20 through 0x7D, 0x3D ('=') excluded.
+		// ASCII 0x41 through 0x5A inclusive (A-Z) is to be considered equivalent to ASCII 0x61 through
+		// 0x7A inclusive (a-z).
+
+		// replace invalid chars with a space, return uppercase text
+		// Thanks Chris Bolt &lt;chris-getid3&#216;bolt*cx&gt; for improving this function
+		// note: ereg_replace() replaces nulls with empty string (not space)
+		return strtoupper(ereg_replace('[^ -&lt;&gt;-}]', ' ', str_replace(&quot;\x00&quot;, ' ', $originalcommentname)));
+
+	}
+
+}
+
+?&gt;
\ No newline at end of file


Property changes on: trunk/inc/external/getid3/write.vorbiscomment.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/magpierss/cache/8e99a8852dead559703e55398fe9606e
===================================================================
--- trunk/inc/external/magpierss/cache/8e99a8852dead559703e55398fe9606e	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/magpierss/cache/8e99a8852dead559703e55398fe9606e	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,3 @@
+O:9:&quot;magpierss&quot;:25:{s:6:&quot;parser&quot;;i:0;s:12:&quot;current_item&quot;;a:0:{}s:5:&quot;items&quot;;a:5:{i:0;a:4:{s:5:&quot;title&quot;;s:42:&quot;Vreemde jongens die platenmaatschappijen..&quot;;s:11:&quot;description&quot;;s:360:&quot;Webwereld bericht over de toename van klachten aan platenmaatschappijen omtrent kopieerbeveiligingen (ook wel digital rights management, DRM, genoemd) op cd's die het lastig maken om muziek op mp3 spelers te zetten. Blijkbaar komen er zoveel klachten binnen dat  Sony BMG een site heeft gemaakt met uitleg hoe men de beveiliging van Sony BGM uitgebrachte [...]&quot;;s:4:&quot;link&quot;;s:42:&quot;<A HREF="http://nl.creativecommons.org/nieuws/?p=63">http://nl.creativecommons.org/nieuws/?p=63</A>&quot;;s:7:&quot;summary&quot;;s:360:&quot;Webwereld bericht over de toename van klachten aan platenmaatschappijen omtrent kopieerbeveiligingen (ook wel digital rights management, DRM, genoemd) op cd's die het lastig maken om muziek op mp3 spelers te zetten. Blijkbaar komen er zoveel klachten binnen dat  Sony BMG een site heeft gemaakt met uitleg hoe men de beveiliging van Sony BGM uitgebrachte [...]&quot;;}i:1;!
 a:4:{s:5:&quot;title&quot;;s:89:&quot;VPRO maakt als eerste Nederlandse publieke omroep gebruik van Creative Commons Licenties.&quot;;s:11:&quot;description&quot;;s:369:&quot;Op 15 september 2005 is het project '3VOOR12 Plundert Musea' van de VPRO van start gegaan. Dit Het is de eerste keer dat een publieke omroep hierbij structureel van de Creative Commons Licenties gebruik maakt. In samenwerking met Creative Commons Nederland heeft de VPRO&#160;de Creative Commons Licenties in het online gedeelte van het project ge&#239;ntegreerd: [...]&quot;;s:4:&quot;link&quot;;s:42:&quot;<A HREF="http://nl.creativecommons.org/nieuws/?p=61">http://nl.creativecommons.org/nieuws/?p=61</A>&quot;;s:7:&quot;summary&quot;;s:369:&quot;Op 15 september 2005 is het project '3VOOR12 Plundert Musea' van de VPRO van start gegaan. Dit Het is de eerste keer dat een publieke omroep hierbij structureel van de Creative Commons Licenties gebruik maakt. In samenwerking met Creative Commons Nederland heeft de VPRO&#160;de Creative Commons Licenties in het online gedeelte van het project ge&#239;ntegreerd: [...]&quot;;}i:2;a:4:{s:5:&quot;title&quot;;s:!
 40:&quot;2.5 versie van Creative Commons licentie&quot;;s:11:&quot;descriptio!
 n&quot;;s:276
:<i>&quot;Afgelopen weekeind zijn de nieuwe versies van de Nederlandstalige Creative Commons licenties actief geworden. Op de voorpagina wordt er in een kort artikeltje aangegeven wat de verschillen zijn tussen de oude 2.0 en de nieuwere 2.5 versies van de Creative Commons licenties.  &quot;;s:4:&quot;link&quot;;s:42:&quot;<A HREF="http://nl.creativecommons.org/nieuws/?p=60">http://nl.creativecommons.org/nieuws/?p=60</A>&quot;;s:7:&quot;summary&quot;;s:276:&quot;Afgelopen weekeind zijn de nieuwe versies van de Nederlandstalige Creative Commons licenties actief geworden. Op de voorpagina wordt er in een kort artikeltje aangegeven wat de verschillen zijn tussen de oude 2.0 en de nieuwere 2.5 versies van de Creative Commons licenties.  &quot;;}i:3;a:4:{s:5:&quot;title&quot;;s:16:&quot;Reizen in geluid&quot;;s:11:&quot;description&quot;;s:323:&quot;Afgelopen februari was ik in India en daar vielen me veel dingen op die totaal anders zijn dan in Nederland. De overweldigende geuren en kleuren, de hoeveelheid mensen en de totaal andere geluiden. Dat laatste vond ik zo bijzonder dat ik besloot om wat opnames te maken met mij!
</I> n mp3 spelertje. Als een herinnering aan [...]&quot;;s:4:&quot;link&quot;;s:42:&quot;<A HREF="http://nl.creativecommons.org/nieuws/?p=59">http://nl.creativecommons.org/nieuws/?p=59</A>&quot;;s:7:&quot;summary&quot;;s:323:&quot;Afgelopen februari was ik in India en daar vielen me veel dingen op die totaal anders zijn dan in Nederland. De overweldigende geuren en kleuren, de hoeveelheid mensen en de totaal andere geluiden. Dat laatste vond ik zo bijzonder dat ik besloot om wat opnames te maken met mijn mp3 spelertje. Als een herinnering aan [...]&quot;;}i:4;a:4:{s:5:&quot;title&quot;;s:39:&quot;Project Orange meer dan alleen een film&quot;;s:11:&quot;description&quot;;s:326:&quot;Project Orange (PO) is een project wat ernaar streeft een (korte) film uit te brengen en vrij te geven onder een Creative Commons licentie. Niet alleen de film zelf, maar ook al het ruwe bronmateriaal zal worden vrijgegeven. Bijzonder is dat het hier een film betreft die ontwikkeld wordt met het Open Source 3d software [...]&quot;;s:4:&quot;link&quot;;s:42:&quot;<A HREF="http://nl.creativecommons.org/nieuws/?p=58">http://nl.creativecommons.org/nieuws/?p=58</A>&quot;;s:7:&quot;summary&quot;;s:326:&quot;Project Orange (PO) is een p!
 roject wat ernaar streeft een (korte) film uit te brengen en v!
 rij te g
even onder een Creative Commons licentie. Niet alleen de film zelf, maar ook al het ruwe bronmateriaal zal worden vrijgegeven. Bijzonder is dat het hier een film betreft die ontwikkeld wordt met het Open Source 3d software [...]&quot;;}}s:7:&quot;channel&quot;;a:7:{s:5:&quot;title&quot;;s:33:&quot;Weblog Creative Commons Nederland&quot;;s:4:&quot;link&quot;;s:36:&quot;<A HREF="http://nl.creativecommons.org/nieuws">http://nl.creativecommons.org/nieuws</A>&quot;;s:11:&quot;description&quot;;s:58:&quot;Nieuws en informatie over de Creative Commons in Nederland&quot;;s:13:&quot;lastbuilddate&quot;;s:31:&quot;Wed, 05 Oct 2005 15:14:59 +0000&quot;;s:4:&quot;docs&quot;;s:34:&quot;<A HREF="http://backend.userland.com/rss092">http://backend.userland.com/rss092</A>&quot;;s:8:&quot;language&quot;;s:2:&quot;en&quot;;s:7:&quot;tagline&quot;;s:58:&quot;Nieuws en informatie over de Creative Commons in Nederland&quot;;}s:9:&quot;textinput&quot;;a:0:{}s:5:&quot;image&quot;;a:0:{}s:9:&quot;feed_type&quot;;s:3:&quot;RSS&quot;;s:12:&quot;feed_version&quot;;s:4:&quot;0.92&quot;;s:8:&quot;encoding&quot;;s:10:&quot;ISO-8859-1&quot;;s:16:&quot;_source_encoding&quot;;s:0:&quot;&quot;;s:5:&quot;ERROR&quot;;s:0:&quot;&quot;;s:7:&quot;WARNING&quot;;s:0:&quot;&quot;;s:19:&quot;_CONTENT_CONSTRUCTS&quot;;a:6:{i:0;s:7:&quot;content&quot;;i:1;s:7:&quot;summary&quot;;i:2;s:4:&quot;info&quot;;i:3;s:5:&quot;title&quot;;i:4;s:7:&quot;tagline&quot;;i:5;s:9:&quot;!
 copyright&quot;;}s:16:&quot;_KNOWN_ENCODINGS&quot;;a:3:{i:0;s:5:&quot;UTF-8&quot;;i:1;s:8:&quot;US-ASCII&quot;;i:2;s:10:&quot;ISO-8859-1&quot;;}s:5:&quot;stack&quot;;a:0:{}s:9:&quot;inchannel&quot;;b:0;s:6:&quot;initem&quot;;b:0;s:9:&quot;incontent&quot;;b:0;s:11:&quot;intextinput&quot;;b:0;s:7:&quot;inimage&quot;;b:0;s:13:&quot;current_field&quot;;s:0:&quot;&quot;;s:17:&quot;current_namespace&quot;;b:0;s:15:&quot;source_encoding&quot;;s:5:&quot;UTF-8&quot;;s:13:&quot;last_modified&quot;;s:31:&quot;Wed, 05 Oct 2005 15:14:59 GMT
+&quot;;s:4:&quot;etag&quot;;s:36:&quot;&quot;477b06ae99ace39cb2d52dfc7f493e12&quot;
+&quot;;}
\ No newline at end of file

Added: trunk/inc/external/magpierss/extlib/Snoopy.class.inc
===================================================================
--- trunk/inc/external/magpierss/extlib/Snoopy.class.inc	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/magpierss/extlib/Snoopy.class.inc	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,899 @@
+&lt;?php
+
+/*************************************************
+
+Snoopy - the PHP net client
+Author: Monte Ohrt &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">monte at ispi.net</A>&gt;
+Copyright (c): 1999-2000 ispi, all rights reserved
+Version: 1.0
+
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this library; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+You may contact the author of Snoopy by e-mail at:
<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">+monte at ispi.net</A>
+
+Or, write to:
+Monte Ohrt
+CTO, ispi
+237 S. 70th suite 220
+Lincoln, NE 68510
+
+The latest version of Snoopy can be obtained from:
+<A HREF="http://snoopy.sourceforge.com">http://snoopy.sourceforge.com</A>
+
+*************************************************/
+
+class Snoopy
+{
+	/**** Public variables ****/
+	
+	/* user definable vars */
+
+	var $host			=	&quot;www.php.net&quot;;		// host name we are connecting to
+	var $port			=	80;					// port we are connecting to
+	var $proxy_host		=	&quot;&quot;;					// proxy host to use
+	var $proxy_port		=	&quot;&quot;;					// proxy port to use
+	var $agent			=	&quot;Snoopy v1.0&quot;;		// agent we masquerade as
+	var	$referer		=	&quot;&quot;;					// referer info to pass
+	var $cookies		=	array();			// array of cookies to pass
+												// $cookies[&quot;username&quot;]=&quot;joe&quot;;
+	var	$rawheaders		=	array();			// array of raw headers to send
+												// $rawheaders[&quot;Content-type&quot;]=&quot;text/html&quot;;
+
+	var $maxredirs		=	5;					// http redirection depth maximum. 0 = disallow
+	var $lastredirectaddr	=	&quot;&quot;;				// contains address of last redirected address
+	var	$offsiteok		=	true;				// allows redirection off-site
+	var $maxframes		=	0;					// frame content depth maximum. 0 = disallow
+	var $expandlinks	=	true;				// expand links to fully qualified URLs.
+												// this only applies to fetchlinks()
+												// or submitlinks()
+	var $passcookies	=	true;				// pass set cookies back through redirects
+												// NOTE: this currently does not respect
+												// dates, domains or paths.
+	
+	var	$user			=	&quot;&quot;;					// user for http authentication
+	var	$pass			=	&quot;&quot;;					// password for http authentication
+	
+	// http accept types
+	var $accept			=	&quot;image/gif, image/x-xbitmap, image/jpeg, image/pjpeg, */*&quot;;
+	
+	var $results		=	&quot;&quot;;					// where the content is put
+		
+	var $error			=	&quot;&quot;;					// error messages sent here
+	var	$response_code	=	&quot;&quot;;					// response code returned from server
+	var	$headers		=	array();			// headers returned from server sent here
+	var	$maxlength		=	500000;				// max return data length (body)
+	var $read_timeout	=	0;					// timeout on read operations, in seconds
+												// supported only since PHP 4 Beta 4
+												// set to 0 to disallow timeouts
+	var $timed_out		=	false;				// if a read operation timed out
+	var	$status			=	0;					// http request status
+	
+	var	$curl_path		=	&quot;/usr/bin/curl&quot;;
+												// Snoopy will use cURL for fetching
+												// SSL content if a full system path to
+												// the cURL binary is supplied here.
+												// set to false if you do not have
+												// cURL installed. See <A HREF="http://curl.haxx.se">http://curl.haxx.se</A>
+												// for details on installing cURL.
+												// Snoopy does *not* use the cURL
+												// library functions built into php,
+												// as these functions are not stable
+												// as of this Snoopy release.
+	
+	// send Accept-encoding: gzip?
+	var $use_gzip		= true;	
+	
+	/**** Private variables ****/	
+	
+	var	$_maxlinelen	=	4096;				// max line length (headers)
+	
+	var $_httpmethod	=	&quot;GET&quot;;				// default http request method
+	var $_httpversion	=	&quot;HTTP/1.0&quot;;			// default http request version
+	var $_submit_method	=	&quot;POST&quot;;				// default submit method
+	var $_submit_type	=	&quot;application/x-www-form-urlencoded&quot;;	// default submit type
+	var $_mime_boundary	=   &quot;&quot;;					// MIME boundary for multipart/form-data submit type
+	var $_redirectaddr	=	false;				// will be set if page fetched is a redirect
+	var $_redirectdepth	=	0;					// increments on an http redirect
+	var $_frameurls		= 	array();			// frame src urls
+	var $_framedepth	=	0;					// increments on frame depth
+	
+	var $_isproxy		=	false;				// set if using a proxy server
+	var $_fp_timeout	=	30;					// timeout for socket connection
+
+/*======================================================================*\
+	Function:	fetch
+	Purpose:	fetch the contents of a web page
+				(and possibly other protocols in the
+				future like ftp, nntp, gopher, etc.)
+	Input:		$URI	the location of the page to fetch
+	Output:		$this-&gt;results	the output text from the fetch
+\*======================================================================*/
+
+	function fetch($URI)
+	{
+	
+		//preg_match(&quot;|^([^:]+)://([^:/]+)(:[\d]+)*(.*)|&quot;,$URI,$URI_PARTS);
+		$URI_PARTS = parse_url($URI);
+		if (!empty($URI_PARTS[&quot;user&quot;]))
+			$this-&gt;user = $URI_PARTS[&quot;user&quot;];
+		if (!empty($URI_PARTS[&quot;pass&quot;]))
+			$this-&gt;pass = $URI_PARTS[&quot;pass&quot;];
+				
+		switch($URI_PARTS[&quot;scheme&quot;])
+		{
+			case &quot;http&quot;:
+				$this-&gt;host = $URI_PARTS[&quot;host&quot;];
+				if(!empty($URI_PARTS[&quot;port&quot;]))
+					$this-&gt;port = $URI_PARTS[&quot;port&quot;];
+				if($this-&gt;_connect($fp))
+				{
+					if($this-&gt;_isproxy)
+					{
+						// using proxy, send entire URI
+						$this-&gt;_httprequest($URI,$fp,$URI,$this-&gt;_httpmethod);
+					}
+					else
+					{
+						$path = $URI_PARTS[&quot;path&quot;].(isset($URI_PARTS[&quot;query&quot;]) ? &quot;?&quot;.$URI_PARTS[&quot;query&quot;] : &quot;&quot;);
+						// no proxy, send only the path
+						$this-&gt;_httprequest($path, $fp, $URI, $this-&gt;_httpmethod);
+					}
+					
+					$this-&gt;_disconnect($fp);
+
+					if($this-&gt;_redirectaddr)
+					{
+						/* url was redirected, check if we've hit the max depth */
+						if($this-&gt;maxredirs &gt; $this-&gt;_redirectdepth)
+						{
+							// only follow redirect if it's on this site, or offsiteok is true
+							if(preg_match(&quot;|^<A HREF="http://">http://</A>&quot;.preg_quote($this-&gt;host).&quot;|i&quot;,$this-&gt;_redirectaddr) || $this-&gt;offsiteok)
+							{
+								/* follow the redirect */
+								$this-&gt;_redirectdepth++;
+								$this-&gt;lastredirectaddr=$this-&gt;_redirectaddr;
+								$this-&gt;fetch($this-&gt;_redirectaddr);
+							}
+						}
+					}
+
+					if($this-&gt;_framedepth &lt; $this-&gt;maxframes &amp;&amp; count($this-&gt;_frameurls) &gt; 0)
+					{
+						$frameurls = $this-&gt;_frameurls;
+						$this-&gt;_frameurls = array();
+						
+						while(list(,$frameurl) = each($frameurls))
+						{
+							if($this-&gt;_framedepth &lt; $this-&gt;maxframes)
+							{
+								$this-&gt;fetch($frameurl);
+								$this-&gt;_framedepth++;
+							}
+							else
+								break;
+						}
+					}					
+				}
+				else
+				{
+					return false;
+				}
+				return true;					
+				break;
+			case &quot;https&quot;:
+				if(!$this-&gt;curl_path || (!is_executable($this-&gt;curl_path))) {
+					$this-&gt;error = &quot;Bad curl ($this-&gt;curl_path), can't fetch HTTPS \n&quot;;
+					return false;
+				}
+				$this-&gt;host = $URI_PARTS[&quot;host&quot;];
+				if(!empty($URI_PARTS[&quot;port&quot;]))
+					$this-&gt;port = $URI_PARTS[&quot;port&quot;];
+				if($this-&gt;_isproxy)
+				{
+					// using proxy, send entire URI
+					$this-&gt;_httpsrequest($URI,$URI,$this-&gt;_httpmethod);
+				}
+				else
+				{
+					$path = $URI_PARTS[&quot;path&quot;].($URI_PARTS[&quot;query&quot;] ? &quot;?&quot;.$URI_PARTS[&quot;query&quot;] : &quot;&quot;);
+					// no proxy, send only the path
+					$this-&gt;_httpsrequest($path, $URI, $this-&gt;_httpmethod);
+				}
+
+				if($this-&gt;_redirectaddr)
+				{
+					/* url was redirected, check if we've hit the max depth */
+					if($this-&gt;maxredirs &gt; $this-&gt;_redirectdepth)
+					{
+						// only follow redirect if it's on this site, or offsiteok is true
+						if(preg_match(&quot;|^<A HREF="http://">http://</A>&quot;.preg_quote($this-&gt;host).&quot;|i&quot;,$this-&gt;_redirectaddr) || $this-&gt;offsiteok)
+						{
+							/* follow the redirect */
+							$this-&gt;_redirectdepth++;
+							$this-&gt;lastredirectaddr=$this-&gt;_redirectaddr;
+							$this-&gt;fetch($this-&gt;_redirectaddr);
+						}
+					}
+				}
+
+				if($this-&gt;_framedepth &lt; $this-&gt;maxframes &amp;&amp; count($this-&gt;_frameurls) &gt; 0)
+				{
+					$frameurls = $this-&gt;_frameurls;
+					$this-&gt;_frameurls = array();
+
+					while(list(,$frameurl) = each($frameurls))
+					{
+						if($this-&gt;_framedepth &lt; $this-&gt;maxframes)
+						{
+							$this-&gt;fetch($frameurl);
+							$this-&gt;_framedepth++;
+						}
+						else
+							break;
+					}
+				}					
+				return true;					
+				break;
+			default:
+				// not a valid protocol
+				$this-&gt;error	=	'Invalid protocol &quot;'.$URI_PARTS[&quot;scheme&quot;].'&quot;\n';
+				return false;
+				break;
+		}		
+		return true;
+	}
+
+
+
+/*======================================================================*\
+	Private functions
+\*======================================================================*/
+	
+	
+/*======================================================================*\
+	Function:	_striplinks
+	Purpose:	strip the hyperlinks from an html document
+	Input:		$document	document to strip.
+	Output:		$match		an array of the links
+\*======================================================================*/
+
+	function _striplinks($document)
+	{	
+		preg_match_all(&quot;'&lt;\s*a\s+.*href\s*=\s*			# find &lt;a href=
+						([\&quot;\'])?					# find single or double quote
+						(?(1) (.*?)\\1 | ([^\s\&gt;]+))		# if quote found, match up to next matching
+													# quote, otherwise match up to next space
+						'isx&quot;,$document,$links);
+						
+
+		// catenate the non-empty matches from the conditional subpattern
+
+		while(list($key,$val) = each($links[2]))
+		{
+			if(!empty($val))
+				$match[] = $val;
+		}				
+		
+		while(list($key,$val) = each($links[3]))
+		{
+			if(!empty($val))
+				$match[] = $val;
+		}		
+		
+		// return the links
+		return $match;
+	}
+
+/*======================================================================*\
+	Function:	_stripform
+	Purpose:	strip the form elements from an html document
+	Input:		$document	document to strip.
+	Output:		$match		an array of the links
+\*======================================================================*/
+
+	function _stripform($document)
+	{	
+		preg_match_all(&quot;'&lt;\/?(FORM|INPUT|SELECT|TEXTAREA|(OPTION))[^&lt;&gt;]*&gt;(?(2)(.*(?=&lt;\/?(option|select)[^&lt;&gt;]*&gt;[\r\n]*)|(?=[\r\n]*))|(?=[\r\n]*))'Usi&quot;,$document,$elements);
+		
+		// catenate the matches
+		$match = implode(&quot;\r\n&quot;,$elements[0]);
+				
+		// return the links
+		return $match;
+	}
+
+	
+	
+/*======================================================================*\
+	Function:	_striptext
+	Purpose:	strip the text from an html document
+	Input:		$document	document to strip.
+	Output:		$text		the resulting text
+\*======================================================================*/
+
+	function _striptext($document)
+	{
+		
+		// I didn't use preg eval (//e) since that is only available in PHP 4.0.
+		// so, list your entities one by one here. I included some of the
+		// more common ones.
+								
+		$search = array(&quot;'&lt;script[^&gt;]*?&gt;.*?&lt;/script&gt;'si&quot;,	// strip out javascript
+						&quot;'&lt;[\/\!]*?[^&lt;&gt;]*?&gt;'si&quot;,			// strip out html tags
+						&quot;'([\r\n])[\s]+'&quot;,					// strip out white space
+						&quot;'&amp;(quote|#34);'i&quot;,					// replace html entities
+						&quot;'&amp;(amp|#38);'i&quot;,
+						&quot;'&amp;(lt|#60);'i&quot;,
+						&quot;'&amp;(gt|#62);'i&quot;,
+						&quot;'&amp;(nbsp|#160);'i&quot;,
+						&quot;'&amp;(iexcl|#161);'i&quot;,
+						&quot;'&amp;(cent|#162);'i&quot;,
+						&quot;'&amp;(pound|#163);'i&quot;,
+						&quot;'&amp;(copy|#169);'i&quot;
+						);				
+		$replace = array(	&quot;&quot;,
+							&quot;&quot;,
+							&quot;\\1&quot;,
+							&quot;\&quot;&quot;,
+							&quot;&amp;&quot;,
+							&quot;&lt;&quot;,
+							&quot;&gt;&quot;,
+							&quot; &quot;,
+							chr(161),
+							chr(162),
+							chr(163),
+							chr(169));
+					
+		$text = preg_replace($search,$replace,$document);
+								
+		return $text;
+	}
+
+/*======================================================================*\
+	Function:	_expandlinks
+	Purpose:	expand each link into a fully qualified URL
+	Input:		$links			the links to qualify
+				$URI			the full URI to get the base from
+	Output:		$expandedLinks	the expanded links
+\*======================================================================*/
+
+	function _expandlinks($links,$URI)
+	{
+		
+		preg_match(&quot;/^[^\?]+/&quot;,$URI,$match);
+
+		$match = preg_replace(&quot;|/[^\/\.]+\.[^\/\.]+$|&quot;,&quot;&quot;,$match[0]);
+				
+		$search = array( 	&quot;|^<A HREF="http://">http://</A>&quot;.preg_quote($this-&gt;host).&quot;|i&quot;,
+							&quot;|^(?!<A HREF="http://">http://</A>)(\/)?(?!mailto:)|i&quot;,
+							&quot;|/\./|&quot;,
+							&quot;|/[^\/]+/\.\./|&quot;
+						);
+						
+		$replace = array(	&quot;&quot;,
+							$match.&quot;/&quot;,
+							&quot;/&quot;,
+							&quot;/&quot;
+						);			
+				
+		$expandedLinks = preg_replace($search,$replace,$links);
+
+		return $expandedLinks;
+	}
+
+/*======================================================================*\
+	Function:	_httprequest
+	Purpose:	go get the http data from the server
+	Input:		$url		the url to fetch
+				$fp			the current open file pointer
+				$URI		the full URI
+				$body		body contents to send if any (POST)
+	Output:		
+\*======================================================================*/
+	
+	function _httprequest($url,$fp,$URI,$http_method,$content_type=&quot;&quot;,$body=&quot;&quot;)
+	{
+		if($this-&gt;passcookies &amp;&amp; $this-&gt;_redirectaddr)
+			$this-&gt;setcookies();
+			
+		$URI_PARTS = parse_url($URI);
+		if(empty($url))
+			$url = &quot;/&quot;;
+		$headers = $http_method.&quot; &quot;.$url.&quot; &quot;.$this-&gt;_httpversion.&quot;\r\n&quot;;		
+		if(!empty($this-&gt;agent))
+			$headers .= &quot;User-Agent: &quot;.$this-&gt;agent.&quot;\r\n&quot;;
+		if(!empty($this-&gt;host) &amp;&amp; !isset($this-&gt;rawheaders['Host']))
+			$headers .= &quot;Host: &quot;.$this-&gt;host.&quot;\r\n&quot;;
+		if(!empty($this-&gt;accept))
+			$headers .= &quot;Accept: &quot;.$this-&gt;accept.&quot;\r\n&quot;;
+		
+		if($this-&gt;use_gzip) {
+			// make sure PHP was built with --with-zlib
+			// and we can handle gzipp'ed data
+			if ( function_exists(gzinflate) ) {
+			   $headers .= &quot;Accept-encoding: gzip\r\n&quot;;
+			}
+			else {
+			   trigger_error(
+			   	&quot;use_gzip is on, but PHP was built without zlib support.&quot;.
+				&quot;  Requesting file(s) without gzip encoding.&quot;, 
+				E_USER_NOTICE);
+			}
+		}
+		
+		if(!empty($this-&gt;referer))
+			$headers .= &quot;Referer: &quot;.$this-&gt;referer.&quot;\r\n&quot;;
+		if(!empty($this-&gt;cookies))
+		{			
+			if(!is_array($this-&gt;cookies))
+				$this-&gt;cookies = (array)$this-&gt;cookies;
+	
+			reset($this-&gt;cookies);
+			if ( count($this-&gt;cookies) &gt; 0 ) {
+				$cookie_headers .= 'Cookie: ';
+				foreach ( $this-&gt;cookies as $cookieKey =&gt; $cookieVal ) {
+				$cookie_headers .= $cookieKey.&quot;=&quot;.urlencode($cookieVal).&quot;; &quot;;
+				}
+				$headers .= substr($cookie_headers,0,-2) . &quot;\r\n&quot;;
+			} 
+		}
+		if(!empty($this-&gt;rawheaders))
+		{
+			if(!is_array($this-&gt;rawheaders))
+				$this-&gt;rawheaders = (array)$this-&gt;rawheaders;
+			while(list($headerKey,$headerVal) = each($this-&gt;rawheaders))
+				$headers .= $headerKey.&quot;: &quot;.$headerVal.&quot;\r\n&quot;;
+		}
+		if(!empty($content_type)) {
+			$headers .= &quot;Content-type: $content_type&quot;;
+			if ($content_type == &quot;multipart/form-data&quot;)
+				$headers .= &quot;; boundary=&quot;.$this-&gt;_mime_boundary;
+			$headers .= &quot;\r\n&quot;;
+		}
+		if(!empty($body))	
+			$headers .= &quot;Content-length: &quot;.strlen($body).&quot;\r\n&quot;;
+		if(!empty($this-&gt;user) || !empty($this-&gt;pass))	
+			$headers .= &quot;Authorization: BASIC &quot;.base64_encode($this-&gt;user.&quot;:&quot;.$this-&gt;pass).&quot;\r\n&quot;;
+
+		$headers .= &quot;\r\n&quot;;
+		
+		// set the read timeout if needed
+		if ($this-&gt;read_timeout &gt; 0)
+			socket_set_timeout($fp, $this-&gt;read_timeout);
+		$this-&gt;timed_out = false;
+		
+		fwrite($fp,$headers.$body,strlen($headers.$body));
+		
+		$this-&gt;_redirectaddr = false;
+		unset($this-&gt;headers);
+		
+		// content was returned gzip encoded?
+		$is_gzipped = false;
+						
+		while($currentHeader = fgets($fp,$this-&gt;_maxlinelen))
+		{
+			if ($this-&gt;read_timeout &gt; 0 &amp;&amp; $this-&gt;_check_timeout($fp))
+			{
+				$this-&gt;status=-100;
+				return false;
+			}
+				
+		//	if($currentHeader == &quot;\r\n&quot;)
+			if(preg_match(&quot;/^\r?\n$/&quot;, $currentHeader) )
+			      break;
+						
+			// if a header begins with Location: or URI:, set the redirect
+			if(preg_match(&quot;/^(Location:|URI:)/i&quot;,$currentHeader))
+			{
+				// get URL portion of the redirect
+				preg_match(&quot;/^(Location:|URI:)\s+(.*)/&quot;,chop($currentHeader),$matches);
+				// look for :// in the Location header to see if hostname is included
+				if(!preg_match(&quot;|\:\/\/|&quot;,$matches[2]))
+				{
+					// no host in the path, so prepend
+					$this-&gt;_redirectaddr = $URI_PARTS[&quot;scheme&quot;].&quot;://&quot;.$this-&gt;host.&quot;:&quot;.$this-&gt;port;
+					// eliminate double slash
+					if(!preg_match(&quot;|^/|&quot;,$matches[2]))
+							$this-&gt;_redirectaddr .= &quot;/&quot;.$matches[2];
+					else
+							$this-&gt;_redirectaddr .= $matches[2];
+				}
+				else
+					$this-&gt;_redirectaddr = $matches[2];
+			}
+		
+			if(preg_match(&quot;|^HTTP/|&quot;,$currentHeader))
+			{
+                if(preg_match(&quot;|^HTTP/[^\s]*\s(.*?)\s|&quot;,$currentHeader, $status))
+				{
+					$this-&gt;status= $status[1];
+                }				
+				$this-&gt;response_code = $currentHeader;
+			}
+			
+			if (preg_match(&quot;/Content-Encoding: gzip/&quot;, $currentHeader) ) {
+				$is_gzipped = true;
+			}
+			
+			$this-&gt;headers[] = $currentHeader;
+		}
+
+		# $results = fread($fp, $this-&gt;maxlength);
+		$results = &quot;&quot;;
+		while ( $data = fread($fp, $this-&gt;maxlength) ) {
+		    $results .= $data;
+		    if (
+		        strlen($results) &gt; $this-&gt;maxlength ) {
+		        break;
+		    }
+		}
+		
+		// gunzip
+		if ( $is_gzipped ) {
+			// per <A HREF="http://www.php.net/manual/en/function.gzencode.php">http://www.php.net/manual/en/function.gzencode.php</A>
+			$results = substr($results, 10);
+			$results = gzinflate($results);
+		}
+		
+		if ($this-&gt;read_timeout &gt; 0 &amp;&amp; $this-&gt;_check_timeout($fp))
+		{
+			$this-&gt;status=-100;
+			return false;
+		}
+		
+		// check if there is a a redirect meta tag
+		
+		if(preg_match(&quot;'&lt;meta[\s]*http-equiv[^&gt;]*?content[\s]*=[\s]*[\&quot;\']?\d+;[\s]+URL[\s]*=[\s]*([^\&quot;\']*?)[\&quot;\']?&gt;'i&quot;,$results,$match))
+		{
+			$this-&gt;_redirectaddr = $this-&gt;_expandlinks($match[1],$URI);	
+		}
+
+		// have we hit our frame depth and is there frame src to fetch?
+		if(($this-&gt;_framedepth &lt; $this-&gt;maxframes) &amp;&amp; preg_match_all(&quot;'&lt;frame\s+.*src[\s]*=[\'\&quot;]?([^\'\&quot;\&gt;]+)'i&quot;,$results,$match))
+		{
+			$this-&gt;results[] = $results;
+			for($x=0; $x&lt;count($match[1]); $x++)
+				$this-&gt;_frameurls[] = $this-&gt;_expandlinks($match[1][$x],$URI_PARTS[&quot;scheme&quot;].&quot;://&quot;.$this-&gt;host);
+		}
+		// have we already fetched framed content?
+		elseif(is_array($this-&gt;results))
+			$this-&gt;results[] = $results;
+		// no framed content
+		else
+			$this-&gt;results = $results;
+		
+		return true;
+	}
+
+/*======================================================================*\
+	Function:	_httpsrequest
+	Purpose:	go get the https data from the server using curl
+	Input:		$url		the url to fetch
+				$URI		the full URI
+				$body		body contents to send if any (POST)
+	Output:		
+\*======================================================================*/
+	
+	function _httpsrequest($url,$URI,$http_method,$content_type=&quot;&quot;,$body=&quot;&quot;)
+	{
+		if($this-&gt;passcookies &amp;&amp; $this-&gt;_redirectaddr)
+			$this-&gt;setcookies();
+
+		$headers = array();		
+					
+		$URI_PARTS = parse_url($URI);
+		if(empty($url))
+			$url = &quot;/&quot;;
+		// GET ... header not needed for curl
+		//$headers[] = $http_method.&quot; &quot;.$url.&quot; &quot;.$this-&gt;_httpversion;		
+		if(!empty($this-&gt;agent))
+			$headers[] = &quot;User-Agent: &quot;.$this-&gt;agent;
+		if(!empty($this-&gt;host))
+			$headers[] = &quot;Host: &quot;.$this-&gt;host;
+		if(!empty($this-&gt;accept))
+			$headers[] = &quot;Accept: &quot;.$this-&gt;accept;
+		if(!empty($this-&gt;referer))
+			$headers[] = &quot;Referer: &quot;.$this-&gt;referer;
+		if(!empty($this-&gt;cookies))
+		{			
+			if(!is_array($this-&gt;cookies))
+				$this-&gt;cookies = (array)$this-&gt;cookies;
+	
+			reset($this-&gt;cookies);
+			if ( count($this-&gt;cookies) &gt; 0 ) {
+				$cookie_str = 'Cookie: ';
+				foreach ( $this-&gt;cookies as $cookieKey =&gt; $cookieVal ) {
+				$cookie_str .= $cookieKey.&quot;=&quot;.urlencode($cookieVal).&quot;; &quot;;
+				}
+				$headers[] = substr($cookie_str,0,-2);
+			}
+		}
+		if(!empty($this-&gt;rawheaders))
+		{
+			if(!is_array($this-&gt;rawheaders))
+				$this-&gt;rawheaders = (array)$this-&gt;rawheaders;
+			while(list($headerKey,$headerVal) = each($this-&gt;rawheaders))
+				$headers[] = $headerKey.&quot;: &quot;.$headerVal;
+		}
+		if(!empty($content_type)) {
+			if ($content_type == &quot;multipart/form-data&quot;)
+				$headers[] = &quot;Content-type: $content_type; boundary=&quot;.$this-&gt;_mime_boundary;
+			else
+				$headers[] = &quot;Content-type: $content_type&quot;;
+		}
+		if(!empty($body))	
+			$headers[] = &quot;Content-length: &quot;.strlen($body);
+		if(!empty($this-&gt;user) || !empty($this-&gt;pass))	
+			$headers[] = &quot;Authorization: BASIC &quot;.base64_encode($this-&gt;user.&quot;:&quot;.$this-&gt;pass);
+			
+		for($curr_header = 0; $curr_header &lt; count($headers); $curr_header++)
+			$cmdline_params .= &quot; -H \&quot;&quot;.$headers[$curr_header].&quot;\&quot;&quot;;
+		
+		if(!empty($body))
+			$cmdline_params .= &quot; -d \&quot;$body\&quot;&quot;;
+		
+		if($this-&gt;read_timeout &gt; 0)
+			$cmdline_params .= &quot; -m &quot;.$this-&gt;read_timeout;
+		
+		$headerfile = uniqid(time());
+		
+		# accept self-signed certs
+		$cmdline_params .= &quot; -k&quot;;
+		exec($this-&gt;curl_path.&quot; -D \&quot;/tmp/$headerfile\&quot;&quot;.$cmdline_params.&quot; &quot;.$URI,$results,$return);
+		
+		if($return)
+		{
+			$this-&gt;error = &quot;Error: cURL could not retrieve the document, error $return.&quot;;
+			return false;
+		}
+			
+			
+		$results = implode(&quot;\r\n&quot;,$results);
+		
+		$result_headers = file(&quot;/tmp/$headerfile&quot;);
+						
+		$this-&gt;_redirectaddr = false;
+		unset($this-&gt;headers);
+						
+		for($currentHeader = 0; $currentHeader &lt; count($result_headers); $currentHeader++)
+		{
+			
+			// if a header begins with Location: or URI:, set the redirect
+			if(preg_match(&quot;/^(Location: |URI: )/i&quot;,$result_headers[$currentHeader]))
+			{
+				// get URL portion of the redirect
+				preg_match(&quot;/^(Location: |URI:)(.*)/&quot;,chop($result_headers[$currentHeader]),$matches);
+				// look for :// in the Location header to see if hostname is included
+				if(!preg_match(&quot;|\:\/\/|&quot;,$matches[2]))
+				{
+					// no host in the path, so prepend
+					$this-&gt;_redirectaddr = $URI_PARTS[&quot;scheme&quot;].&quot;://&quot;.$this-&gt;host.&quot;:&quot;.$this-&gt;port;
+					// eliminate double slash
+					if(!preg_match(&quot;|^/|&quot;,$matches[2]))
+							$this-&gt;_redirectaddr .= &quot;/&quot;.$matches[2];
+					else
+							$this-&gt;_redirectaddr .= $matches[2];
+				}
+				else
+					$this-&gt;_redirectaddr = $matches[2];
+			}
+		
+			if(preg_match(&quot;|^HTTP/|&quot;,$result_headers[$currentHeader]))
+			{
+			    $this-&gt;response_code = $result_headers[$currentHeader];
+			    if(preg_match(&quot;|^HTTP/[^\s]*\s(.*?)\s|&quot;,$this-&gt;response_code, $match))
+			    {
+				$this-&gt;status= $match[1];
+                	    }
+			}
+			$this-&gt;headers[] = $result_headers[$currentHeader];
+		}
+
+		// check if there is a a redirect meta tag
+		
+		if(preg_match(&quot;'&lt;meta[\s]*http-equiv[^&gt;]*?content[\s]*=[\s]*[\&quot;\']?\d+;[\s]+URL[\s]*=[\s]*([^\&quot;\']*?)[\&quot;\']?&gt;'i&quot;,$results,$match))
+		{
+			$this-&gt;_redirectaddr = $this-&gt;_expandlinks($match[1],$URI);	
+		}
+
+		// have we hit our frame depth and is there frame src to fetch?
+		if(($this-&gt;_framedepth &lt; $this-&gt;maxframes) &amp;&amp; preg_match_all(&quot;'&lt;frame\s+.*src[\s]*=[\'\&quot;]?([^\'\&quot;\&gt;]+)'i&quot;,$results,$match))
+		{
+			$this-&gt;results[] = $results;
+			for($x=0; $x&lt;count($match[1]); $x++)
+				$this-&gt;_frameurls[] = $this-&gt;_expandlinks($match[1][$x],$URI_PARTS[&quot;scheme&quot;].&quot;://&quot;.$this-&gt;host);
+		}
+		// have we already fetched framed content?
+		elseif(is_array($this-&gt;results))
+			$this-&gt;results[] = $results;
+		// no framed content
+		else
+			$this-&gt;results = $results;
+
+		unlink(&quot;/tmp/$headerfile&quot;);
+		
+		return true;
+	}
+
+/*======================================================================*\
+	Function:	setcookies()
+	Purpose:	set cookies for a redirection
+\*======================================================================*/
+	
+	function setcookies()
+	{
+		for($x=0; $x&lt;count($this-&gt;headers); $x++)
+		{
+		if(preg_match(&quot;/^set-cookie:[\s]+([^=]+)=([^;]+)/i&quot;, $this-&gt;headers[$x],$match))
+			$this-&gt;cookies[$match[1]] = $match[2];
+		}
+	}
+
+	
+/*======================================================================*\
+	Function:	_check_timeout
+	Purpose:	checks whether timeout has occurred
+	Input:		$fp	file pointer
+\*======================================================================*/
+
+	function _check_timeout($fp)
+	{
+		if ($this-&gt;read_timeout &gt; 0) {
+			$fp_status = socket_get_status($fp);
+			if ($fp_status[&quot;timed_out&quot;]) {
+				$this-&gt;timed_out = true;
+				return true;
+			}
+		}
+		return false;
+	}
+
+/*======================================================================*\
+	Function:	_connect
+	Purpose:	make a socket connection
+	Input:		$fp	file pointer
+\*======================================================================*/
+	
+	function _connect(&amp;$fp)
+	{
+		if(!empty($this-&gt;proxy_host) &amp;&amp; !empty($this-&gt;proxy_port))
+			{
+				$this-&gt;_isproxy = true;
+				$host = $this-&gt;proxy_host;
+				$port = $this-&gt;proxy_port;
+			}
+		else
+		{
+			$host = $this-&gt;host;
+			$port = $this-&gt;port;
+		}
+	
+		$this-&gt;status = 0;
+		
+		if($fp = fsockopen(
+					$host,
+					$port,
+					$errno,
+					$errstr,
+					$this-&gt;_fp_timeout
+					))
+		{
+			// socket connection succeeded
+
+			return true;
+		}
+		else
+		{
+			// socket connection failed
+			$this-&gt;status = $errno;
+			switch($errno)
+			{
+				case -3:
+					$this-&gt;error=&quot;socket creation failed (-3)&quot;;
+				case -4:
+					$this-&gt;error=&quot;dns lookup failure (-4)&quot;;
+				case -5:
+					$this-&gt;error=&quot;connection refused or timed out (-5)&quot;;
+				default:
+					$this-&gt;error=&quot;connection failed (&quot;.$errno.&quot;)&quot;;
+			}
+			return false;
+		}
+	}
+/*======================================================================*\
+	Function:	_disconnect
+	Purpose:	disconnect a socket connection
+	Input:		$fp	file pointer
+\*======================================================================*/
+	
+	function _disconnect($fp)
+	{
+		return(fclose($fp));
+	}
+
+	
+/*======================================================================*\
+	Function:	_prepare_post_body
+	Purpose:	Prepare post body according to encoding type
+	Input:		$formvars  - form variables
+				$formfiles - form upload files
+	Output:		post body
+\*======================================================================*/
+	
+	function _prepare_post_body($formvars, $formfiles)
+	{
+		settype($formvars, &quot;array&quot;);
+		settype($formfiles, &quot;array&quot;);
+
+		if (count($formvars) == 0 &amp;&amp; count($formfiles) == 0)
+			return;
+		
+		switch ($this-&gt;_submit_type) {
+			case &quot;application/x-www-form-urlencoded&quot;:
+				reset($formvars);
+				while(list($key,$val) = each($formvars)) {
+					if (is_array($val) || is_object($val)) {
+						while (list($cur_key, $cur_val) = each($val)) {
+							$postdata .= urlencode($key).&quot;[]=&quot;.urlencode($cur_val).&quot;&amp;&quot;;
+						}
+					} else
+						$postdata .= urlencode($key).&quot;=&quot;.urlencode($val).&quot;&amp;&quot;;
+				}
+				break;
+
+			case &quot;multipart/form-data&quot;:
+				$this-&gt;_mime_boundary = &quot;Snoopy&quot;.md5(uniqid(microtime()));
+				
+				reset($formvars);
+				while(list($key,$val) = each($formvars)) {
+					if (is_array($val) || is_object($val)) {
+						while (list($cur_key, $cur_val) = each($val)) {
+							$postdata .= &quot;--&quot;.$this-&gt;_mime_boundary.&quot;\r\n&quot;;
+							$postdata .= &quot;Content-Disposition: form-data; name=\&quot;$key\[\]\&quot;\r\n\r\n&quot;;
+							$postdata .= &quot;$cur_val\r\n&quot;;
+						}
+					} else {
+						$postdata .= &quot;--&quot;.$this-&gt;_mime_boundary.&quot;\r\n&quot;;
+						$postdata .= &quot;Content-Disposition: form-data; name=\&quot;$key\&quot;\r\n\r\n&quot;;
+						$postdata .= &quot;$val\r\n&quot;;
+					}
+				}
+				
+				reset($formfiles);
+				while (list($field_name, $file_names) = each($formfiles)) {
+					settype($file_names, &quot;array&quot;);
+					while (list(, $file_name) = each($file_names)) {
+						if (!is_readable($file_name)) continue;
+
+						$fp = fopen($file_name, &quot;r&quot;);
+						$file_content = fread($fp, filesize($file_name));
+						fclose($fp);
+						$base_name = basename($file_name);
+
+						$postdata .= &quot;--&quot;.$this-&gt;_mime_boundary.&quot;\r\n&quot;;
+						$postdata .= &quot;Content-Disposition: form-data; name=\&quot;$field_name\&quot;; filename=\&quot;$base_name\&quot;\r\n\r\n&quot;;
+						$postdata .= &quot;$file_content\r\n&quot;;
+					}
+				}
+				$postdata .= &quot;--&quot;.$this-&gt;_mime_boundary.&quot;--\r\n&quot;;
+				break;
+		}
+
+		return $postdata;
+	}
+}
+
+?&gt;

Added: trunk/inc/external/magpierss/rss_cache.inc
===================================================================
--- trunk/inc/external/magpierss/rss_cache.inc	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/magpierss/rss_cache.inc	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,184 @@
+&lt;?php
+/*
+ * Project:     MagpieRSS: a simple RSS integration tool
+ * File:        rss_cache.inc, a simple, rolling(no GC), cache 
+ *              for RSS objects, keyed on URL.
+ * Author:      Kellan Elliott-McCrea &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">kellan at protest.net</A>&gt;
+ * Version:     0.51
+ * License:     GPL
+ *
+ * The lastest version of MagpieRSS can be obtained from:
+ * <A HREF="http://magpierss.sourceforge.net">http://magpierss.sourceforge.net</A>
+ *
+ * For questions, help, comments, discussion, etc., please join the
+ * Magpie mailing list:
+ * <A HREF="http://lists.sourceforge.net/lists/listinfo/magpierss-general">http://lists.sourceforge.net/lists/listinfo/magpierss-general</A>
+ *
+ */
+
+class RSSCache {
+    var $BASE_CACHE = './cache';    // where the cache files are stored
+    var $MAX_AGE    = 3600;         // when are files stale, default one hour
+    var $ERROR      = &quot;&quot;;           // accumulate error messages
+    
+    function RSSCache ($base='', $age='') {
+        if ( $base ) {
+            $this-&gt;BASE_CACHE = $base;
+        }
+        if ( $age ) {
+            $this-&gt;MAX_AGE = $age;
+        }
+        
+        // attempt to make the cache directory
+        if ( ! file_exists( $this-&gt;BASE_CACHE ) ) {
+            $status = @mkdir( $this-&gt;BASE_CACHE, 0755 );
+            
+            // if make failed 
+            if ( ! $status ) {
+                $this-&gt;error(
+                    &quot;Cache couldn't make dir '&quot; . $this-&gt;BASE_CACHE . &quot;'.&quot;
+                );
+            }
+        }
+    }
+    
+/*=======================================================================*\
+    Function:   set
+    Purpose:    add an item to the cache, keyed on url
+    Input:      url from wich the rss file was fetched
+    Output:     true on sucess  
+\*=======================================================================*/
+    function set ($url, $rss) {
+        $this-&gt;ERROR = &quot;&quot;;
+        $cache_file = $this-&gt;file_name( $url );
+        $fp = @fopen( $cache_file, 'w' );
+        
+        if ( ! $fp ) {
+            $this-&gt;error(
+                &quot;Cache unable to open file for writing: $cache_file&quot;
+            );
+            return 0;
+        }
+        
+        
+        $data = $this-&gt;serialize( $rss );
+        fwrite( $fp, $data );
+        fclose( $fp );
+        
+        return $cache_file;
+    }
+    
+/*=======================================================================*\
+    Function:   get
+    Purpose:    fetch an item from the cache
+    Input:      url from wich the rss file was fetched
+    Output:     cached object on HIT, false on MISS 
+\*=======================================================================*/ 
+    function get ($url) {
+        $this-&gt;ERROR = &quot;&quot;;
+        $cache_file = $this-&gt;file_name( $url );
+        
+        if ( ! file_exists( $cache_file ) ) {
+            $this-&gt;debug( 
+                &quot;Cache doesn't contain: $url (cache file: $cache_file)&quot;
+            );
+            return 0;
+        }
+        
+        $fp = @fopen($cache_file, 'r');
+        if ( ! $fp ) {
+            $this-&gt;error(
+                &quot;Failed to open cache file for reading: $cache_file&quot;
+            );
+            return 0;
+        }
+        
+        $data = fread( $fp, filesize($cache_file) );
+        $rss = $this-&gt;unserialize( $data );
+        
+        return $rss;
+    }
+
+/*=======================================================================*\
+    Function:   check_cache
+    Purpose:    check a url for membership in the cache
+                and whether the object is older then MAX_AGE (ie. STALE)
+    Input:      url from wich the rss file was fetched
+    Output:     cached object on HIT, false on MISS 
+\*=======================================================================*/     
+    function check_cache ( $url ) {
+        $this-&gt;ERROR = &quot;&quot;;
+        $filename = $this-&gt;file_name( $url );
+        
+        if ( file_exists( $filename ) ) {
+            // find how long ago the file was added to the cache
+            // and whether that is longer then MAX_AGE
+            $mtime = filemtime( $filename );
+            $age = time() - $mtime;
+            if ( $this-&gt;MAX_AGE &gt; $age ) {
+                // object exists and is current
+                return 'HIT';
+            }
+            else {
+                // object exists but is old
+                return 'STALE';
+            }
+        }
+        else {
+            // object does not exist
+            return 'MISS';
+        }
+    }
+
+/*=======================================================================*\
+    Function:   serialize
+\*=======================================================================*/     
+    function serialize ( $rss ) {
+        return serialize( $rss );
+    }
+
+/*=======================================================================*\
+    Function:   unserialize
+\*=======================================================================*/     
+    function unserialize ( $data ) {
+        return unserialize( $data );
+    }
+    
+/*=======================================================================*\
+    Function:   file_name
+    Purpose:    map url to location in cache
+    Input:      url from wich the rss file was fetched
+    Output:     a file name
+\*=======================================================================*/     
+    function file_name ($url) {
+        $filename = md5( $url );
+        return join( DIRECTORY_SEPARATOR, array( $this-&gt;BASE_CACHE, $filename ) );
+    }
+
+/*=======================================================================*\
+    Function:   error
+    Purpose:    register error
+\*=======================================================================*/         
+    function error ($errormsg, $lvl=E_USER_WARNING) {
+        // append PHP's error message if track_errors enabled
+        if ( isset($php_errormsg) ) { 
+            $errormsg .= &quot; ($php_errormsg)&quot;;
+        }
+        $this-&gt;ERROR = $errormsg;
+        if ( MAGPIE_DEBUG ) {
+            trigger_error( $errormsg, $lvl);
+        }
+        else {
+            error_log( $errormsg, 0);
+        }
+    }
+    
+    function debug ($debugmsg, $lvl=E_USER_NOTICE) {
+        if ( MAGPIE_DEBUG ) {
+            $this-&gt;error(&quot;MagpieRSS [debug] $debugmsg&quot;, $lvl);
+        }
+    }
+
+}
+
+?&gt;

Added: trunk/inc/external/magpierss/rss_fetch.inc
===================================================================
--- trunk/inc/external/magpierss/rss_fetch.inc	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/magpierss/rss_fetch.inc	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,458 @@
+&lt;?php
+/*
+ * Project:     MagpieRSS: a simple RSS integration tool
+ * File:        rss_fetch.inc, a simple functional interface
+                to fetching and parsing RSS files, via the
+                function fetch_rss()
+ * Author:      Kellan Elliott-McCrea &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">kellan at protest.net</A>&gt;
+ * License:     GPL
+ *
+ * The lastest version of MagpieRSS can be obtained from:
+ * <A HREF="http://magpierss.sourceforge.net">http://magpierss.sourceforge.net</A>
+ *
+ * For questions, help, comments, discussion, etc., please join the
+ * Magpie mailing list:
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">magpierss-general at lists.sourceforge.net</A>
+ *
+ */
+ 
+// Setup MAGPIE_DIR for use on hosts that don't include
+// the current path in include_path.
+// with thanks to rajiv and smarty
+if (!defined('DIR_SEP')) {
+    define('DIR_SEP', DIRECTORY_SEPARATOR);
+}
+
+if (!defined('MAGPIE_DIR')) {
+    define('MAGPIE_DIR', dirname(__FILE__) . DIR_SEP);
+}
+
+require_once( MAGPIE_DIR . 'rss_parse.inc' );
+require_once( MAGPIE_DIR . 'rss_cache.inc' );
+
+// for including 3rd party libraries
+define('MAGPIE_EXTLIB', MAGPIE_DIR . 'extlib' . DIR_SEP);
+require_once( MAGPIE_EXTLIB . 'Snoopy.class.inc');
+
+
+/* 
+ * CONSTANTS - redefine these in your script to change the
+ * behaviour of fetch_rss() currently, most options effect the cache
+ *
+ * MAGPIE_CACHE_ON - Should Magpie cache parsed RSS objects? 
+ * For me a built in cache was essential to creating a &quot;PHP-like&quot; 
+ * feel to Magpie, see rss_cache.inc for rationale
+ *
+ *
+ * MAGPIE_CACHE_DIR - Where should Magpie cache parsed RSS objects?
+ * This should be a location that the webserver can write to.   If this 
+ * directory does not already exist Mapie will try to be smart and create 
+ * it.  This will often fail for permissions reasons.
+ *
+ *
+ * MAGPIE_CACHE_AGE - How long to store cached RSS objects? In seconds.
+ *
+ *
+ * MAGPIE_CACHE_FRESH_ONLY - If remote fetch fails, throw error
+ * instead of returning stale object?
+ *
+ * MAGPIE_DEBUG - Display debugging notices?
+ *
+*/
+
+
+/*=======================================================================*\
+    Function: fetch_rss: 
+    Purpose:  return RSS object for the give url
+              maintain the cache
+    Input:    url of RSS file
+    Output:   parsed RSS object (see rss_parse.inc)
+
+    NOTES ON CACHEING:  
+    If caching is on (MAGPIE_CACHE_ON) fetch_rss will first check the cache.
+    
+    NOTES ON RETRIEVING REMOTE FILES:
+    If conditional gets are on (MAGPIE_CONDITIONAL_GET_ON) fetch_rss will
+    return a cached object, and touch the cache object upon recieving a
+    304.
+    
+    NOTES ON FAILED REQUESTS:
+    If there is an HTTP error while fetching an RSS object, the cached
+    version will be return, if it exists (and if MAGPIE_CACHE_FRESH_ONLY is off)
+\*=======================================================================*/
+
+define('MAGPIE_VERSION', '0.7');
+
+$MAGPIE_ERROR = &quot;&quot;;
+
+function fetch_rss ($url) {
+    // initialize constants
+    init();
+    
+    if ( !isset($url) ) {
+        error(&quot;fetch_rss called without a url&quot;);
+        return false;
+    }
+    
+    // if cache is disabled
+    if ( !MAGPIE_CACHE_ON ) {
+        // fetch file, and parse it
+        $resp = _fetch_remote_file( $url );
+        if ( is_success( $resp-&gt;status ) ) {
+            return _response_to_rss( $resp );
+        }
+        else {
+            error(&quot;Failed to fetch $url and cache is off&quot;);
+            return false;
+        }
+    } 
+    // else cache is ON
+    else {
+        // Flow
+        // 1. check cache
+        // 2. if there is a hit, make sure its fresh
+        // 3. if cached obj fails freshness check, fetch remote
+        // 4. if remote fails, return stale object, or error
+        
+        $cache = new RSSCache( MAGPIE_CACHE_DIR, MAGPIE_CACHE_AGE );
+        
+        if (MAGPIE_DEBUG and $cache-&gt;ERROR) {
+            debug($cache-&gt;ERROR, E_USER_WARNING);
+        }
+        
+        
+        $cache_status    = 0;       // response of check_cache
+        $request_headers = array(); // HTTP headers to send with fetch
+        $rss             = 0;       // parsed RSS object
+        $errormsg        = 0;       // errors, if any
+        
+        // store parsed XML by desired output encoding
+        // as character munging happens at parse time
+        $cache_key       = $url . MAGPIE_OUTPUT_ENCODING;
+        
+        if (!$cache-&gt;ERROR) {
+            // return cache HIT, MISS, or STALE
+            $cache_status = $cache-&gt;check_cache( $cache_key);
+        }
+        
+        // if object cached, and cache is fresh, return cached obj
+        if ( $cache_status == 'HIT' ) {
+            $rss = $cache-&gt;get( $cache_key );
+            if ( isset($rss) and $rss ) {
+                // should be cache age
+                $rss-&gt;from_cache = 1;
+                if ( MAGPIE_DEBUG &gt; 1) {
+                debug(&quot;MagpieRSS: Cache HIT&quot;, E_USER_NOTICE);
+            }
+                return $rss;
+            }
+        }
+        
+        // else attempt a conditional get
+        
+        // setup headers
+        if ( $cache_status == 'STALE' ) {
+            $rss = $cache-&gt;get( $cache_key );
+            if ( $rss and $rss-&gt;etag and $rss-&gt;last_modified ) {
+                $request_headers['If-None-Match'] = $rss-&gt;etag;
+                $request_headers['If-Last-Modified'] = $rss-&gt;last_modified;
+            }
+        }
+        
+        $resp = _fetch_remote_file( $url, $request_headers );
+        
+        if (isset($resp) and $resp) {
+            if ($resp-&gt;status == '304' ) {
+                // we have the most current copy
+                if ( MAGPIE_DEBUG &gt; 1) {
+                    debug(&quot;Got 304 for $url&quot;);
+                }
+                // reset cache on 304 (at minutillo insistent prodding)
+                $cache-&gt;set($cache_key, $rss);
+                return $rss;
+            }
+            elseif ( is_success( $resp-&gt;status ) ) {
+                $rss = _response_to_rss( $resp );
+                if ( $rss ) {
+                    if (MAGPIE_DEBUG &gt; 1) {
+                        debug(&quot;Fetch successful&quot;);
+                    }
+                    // add object to cache
+                    $cache-&gt;set( $cache_key, $rss );
+                    return $rss;
+                }
+            }
+            else {
+                $errormsg = &quot;Failed to fetch $url &quot;;
+                if ( $resp-&gt;status == '-100' ) {
+                    $errormsg .= &quot;(Request timed out after &quot; . MAGPIE_FETCH_TIME_OUT . &quot; seconds)&quot;;
+                }
+                elseif ( $resp-&gt;error ) {
+                    # compensate for Snoopy's annoying habbit to tacking
+                    # on '\n'
+                    $http_error = substr($resp-&gt;error, 0, -2); 
+                    $errormsg .= &quot;(HTTP Error: $http_error)&quot;;
+                }
+                else {
+                    $errormsg .=  &quot;(HTTP Response: &quot; . $resp-&gt;response_code .')';
+                }
+            }
+        }
+        else {
+            $errormsg = &quot;Unable to retrieve RSS file for unknown reasons.&quot;;
+        }
+        
+        // else fetch failed
+        
+        // attempt to return cached object
+        if ($rss) {
+            if ( MAGPIE_DEBUG ) {
+                debug(&quot;Returning STALE object for $url&quot;);
+            }
+            return $rss;
+        }
+        
+        // else we totally failed
+        error( $errormsg ); 
+        
+        return false;
+        
+    } // end if ( !MAGPIE_CACHE_ON ) {
+} // end fetch_rss()
+
+/*=======================================================================*\
+    Function:   error
+    Purpose:    set MAGPIE_ERROR, and trigger error
+\*=======================================================================*/
+
+function error ($errormsg, $lvl=E_USER_WARNING) {
+        global $MAGPIE_ERROR;
+        
+        // append PHP's error message if track_errors enabled
+        if ( isset($php_errormsg) ) { 
+            $errormsg .= &quot; ($php_errormsg)&quot;;
+        }
+        if ( $errormsg ) {
+            $errormsg = &quot;MagpieRSS: $errormsg&quot;;
+            $MAGPIE_ERROR = $errormsg;
+            trigger_error( $errormsg, $lvl);                
+        }
+}
+
+function debug ($debugmsg, $lvl=E_USER_NOTICE) {
+    trigger_error(&quot;MagpieRSS [debug] $debugmsg&quot;, $lvl);
+}
+            
+/*=======================================================================*\
+    Function:   magpie_error
+    Purpose:    accessor for the magpie error variable
+\*=======================================================================*/
+function magpie_error ($errormsg=&quot;&quot;) {
+    global $MAGPIE_ERROR;
+    
+    if ( isset($errormsg) and $errormsg ) { 
+        $MAGPIE_ERROR = $errormsg;
+    }
+    
+    return $MAGPIE_ERROR;   
+}
+
+/*=======================================================================*\
+    Function:   _fetch_remote_file
+    Purpose:    retrieve an arbitrary remote file
+    Input:      url of the remote file
+                headers to send along with the request (optional)
+    Output:     an HTTP response object (see Snoopy.class.inc)  
+\*=======================================================================*/
+function _fetch_remote_file ($url, $headers = &quot;&quot; ) {
+    // Snoopy is an HTTP client in PHP
+    $client = new Snoopy();
+    $client-&gt;agent = MAGPIE_USER_AGENT;
+    $client-&gt;read_timeout = MAGPIE_FETCH_TIME_OUT;
+    $client-&gt;use_gzip = MAGPIE_USE_GZIP;
+    if (is_array($headers) ) {
+        $client-&gt;rawheaders = $headers;
+    }
+    
+    @$client-&gt;fetch($url);
+    return $client;
+
+}
+
+/*=======================================================================*\
+    Function:   _response_to_rss
+    Purpose:    parse an HTTP response object into an RSS object
+    Input:      an HTTP response object (see Snoopy)
+    Output:     parsed RSS object (see rss_parse)
+\*=======================================================================*/
+function _response_to_rss ($resp) {
+    $rss = new MagpieRSS( $resp-&gt;results, MAGPIE_OUTPUT_ENCODING, MAGPIE_INPUT_ENCODING, MAGPIE_DETECT_ENCODING );
+    
+    // if RSS parsed successfully       
+    if ( $rss and !$rss-&gt;ERROR) {
+        
+        // find Etag, and Last-Modified
+        foreach($resp-&gt;headers as $h) {
+            // 2003-03-02 - Nicola Asuni (www.tecnick.com) - fixed bug &quot;Undefined offset: 1&quot;
+            if (strpos($h, &quot;: &quot;)) {
+                list($field, $val) = explode(&quot;: &quot;, $h, 2);
+            }
+            else {
+                $field = $h;
+                $val = &quot;&quot;;
+            }
+            
+            if ( $field == 'ETag' ) {
+                $rss-&gt;etag = $val;
+            }
+            
+            if ( $field == 'Last-Modified' ) {
+                $rss-&gt;last_modified = $val;
+            }
+        }
+        
+        return $rss;    
+    } // else construct error message
+    else {
+        $errormsg = &quot;Failed to parse RSS file.&quot;;
+        
+        if ($rss) {
+            $errormsg .= &quot; (&quot; . $rss-&gt;ERROR . &quot;)&quot;;
+        }
+        error($errormsg);
+        
+        return false;
+    } // end if ($rss and !$rss-&gt;error)
+}
+
+/*=======================================================================*\
+    Function:   init
+    Purpose:    setup constants with default values
+                check for user overrides
+\*=======================================================================*/
+function init () {
+    if ( defined('MAGPIE_INITALIZED') ) {
+        return;
+    }
+    else {
+        define('MAGPIE_INITALIZED', true);
+    }
+    
+    if ( !defined('MAGPIE_CACHE_ON') ) {
+        define('MAGPIE_CACHE_ON', true);
+    }
+
+    if ( !defined('MAGPIE_CACHE_DIR') ) {
+        define('MAGPIE_CACHE_DIR', './cache');
+    }
+
+    if ( !defined('MAGPIE_CACHE_AGE') ) {
+        define('MAGPIE_CACHE_AGE', 60*60); // one hour
+    }
+
+    if ( !defined('MAGPIE_CACHE_FRESH_ONLY') ) {
+        define('MAGPIE_CACHE_FRESH_ONLY', false);
+    }
+
+    if ( !defined('MAGPIE_OUTPUT_ENCODING') ) {
+        define('MAGPIE_OUTPUT_ENCODING', 'ISO-8859-1');
+    }
+    
+    if ( !defined('MAGPIE_INPUT_ENCODING') ) {
+        define('MAGPIE_INPUT_ENCODING', null);
+    }
+    
+    if ( !defined('MAGPIE_DETECT_ENCODING') ) {
+        define('MAGPIE_DETECT_ENCODING', true);
+    }
+    
+    if ( !defined('MAGPIE_DEBUG') ) {
+        define('MAGPIE_DEBUG', 0);
+    }
+    
+    if ( !defined('MAGPIE_USER_AGENT') ) {
+        $ua = 'MagpieRSS/'. MAGPIE_VERSION . ' (+<A HREF="http://magpierss.sf.net">http://magpierss.sf.net</A>';
+        
+        if ( MAGPIE_CACHE_ON ) {
+            $ua = $ua . ')';
+        }
+        else {
+            $ua = $ua . '; No cache)';
+        }
+        
+        define('MAGPIE_USER_AGENT', $ua);
+    }
+    
+    if ( !defined('MAGPIE_FETCH_TIME_OUT') ) {
+        define('MAGPIE_FETCH_TIME_OUT', 5); // 5 second timeout
+    }
+    
+    // use gzip encoding to fetch rss files if supported?
+    if ( !defined('MAGPIE_USE_GZIP') ) {
+        define('MAGPIE_USE_GZIP', true);    
+    }
+}
+
+// NOTE: the following code should really be in Snoopy, or at least
+// somewhere other then rss_fetch!
+
+/*=======================================================================*\
+    HTTP STATUS CODE PREDICATES
+    These functions attempt to classify an HTTP status code
+    based on RFC 2616 and RFC 2518.
+    
+    All of them take an HTTP status code as input, and return true or false
+
+    All this code is adapted from LWP's HTTP::Status.
+\*=======================================================================*/
+
+
+/*=======================================================================*\
+    Function:   is_info
+    Purpose:    return true if Informational status code
+\*=======================================================================*/
+function is_info ($sc) { 
+    return $sc &gt;= 100 &amp;&amp; $sc &lt; 200; 
+}
+
+/*=======================================================================*\
+    Function:   is_success
+    Purpose:    return true if Successful status code
+\*=======================================================================*/
+function is_success ($sc) { 
+    return $sc &gt;= 200 &amp;&amp; $sc &lt; 300; 
+}
+
+/*=======================================================================*\
+    Function:   is_redirect
+    Purpose:    return true if Redirection status code
+\*=======================================================================*/
+function is_redirect ($sc) { 
+    return $sc &gt;= 300 &amp;&amp; $sc &lt; 400; 
+}
+
+/*=======================================================================*\
+    Function:   is_error
+    Purpose:    return true if Error status code
+\*=======================================================================*/
+function is_error ($sc) { 
+    return $sc &gt;= 400 &amp;&amp; $sc &lt; 600; 
+}
+
+/*=======================================================================*\
+    Function:   is_client_error
+    Purpose:    return true if Error status code, and its a client error
+\*=======================================================================*/
+function is_client_error ($sc) { 
+    return $sc &gt;= 400 &amp;&amp; $sc &lt; 500; 
+}
+
+/*=======================================================================*\
+    Function:   is_client_error
+    Purpose:    return true if Error status code, and its a server error
+\*=======================================================================*/
+function is_server_error ($sc) { 
+    return $sc &gt;= 500 &amp;&amp; $sc &lt; 600; 
+}
+
+?&gt;

Added: trunk/inc/external/magpierss/rss_parse.inc
===================================================================
--- trunk/inc/external/magpierss/rss_parse.inc	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/magpierss/rss_parse.inc	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,589 @@
+&lt;?php
+
+/**
+* Project:     MagpieRSS: a simple RSS integration tool
+* File:        rss_parse.inc  - parse an RSS or Atom feed
+*               return as a simple object.
+*
+* Handles RSS 0.9x, RSS 2.0, RSS 1.0, and Atom 0.3
+*
+* The lastest version of MagpieRSS can be obtained from:
+* <A HREF="http://magpierss.sourceforge.net">http://magpierss.sourceforge.net</A>
+*
+* For questions, help, comments, discussion, etc., please join the
+* Magpie mailing list:
+* <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">magpierss-general at lists.sourceforge.net</A>
+*
+* @author           Kellan Elliott-McCrea &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">kellan at protest.net</A>&gt;
+* @version          0.7a
+* @license          GPL
+*
+*/
+
+define('RSS', 'RSS');
+define('ATOM', 'Atom');
+
+require_once (MAGPIE_DIR . 'rss_utils.inc');
+
+/**
+* Hybrid parser, and object, takes RSS as a string and returns a simple object.
+*
+* see: rss_fetch.inc for a simpler interface with integrated caching support
+*
+*/
+class MagpieRSS {
+    var $parser;
+    
+    var $current_item   = array();  // item currently being parsed
+    var $items          = array();  // collection of parsed items
+    var $channel        = array();  // hash of channel fields
+    var $textinput      = array();
+    var $image          = array();
+    var $feed_type;
+    var $feed_version;
+    var $encoding       = '';       // output encoding of parsed rss
+    
+    var $_source_encoding = '';     // only set if we have to parse xml prolog
+    
+    var $ERROR = &quot;&quot;;
+    var $WARNING = &quot;&quot;;
+    
+    // define some constants
+    
+    var $_CONTENT_CONSTRUCTS = array('content', 'summary', 'info', 'title', 'tagline', 'copyright');
+    var $_KNOWN_ENCODINGS    = array('UTF-8', 'US-ASCII', 'ISO-8859-1');
+
+    // parser variables, useless if you're not a parser, treat as private
+    var $stack              = array(); // parser stack
+    var $inchannel          = false;
+    var $initem             = false;
+    var $incontent          = false; // if in Atom &lt;content mode=&quot;xml&quot;&gt; field 
+    var $intextinput        = false;
+    var $inimage            = false;
+    var $current_field      = '';
+    var $current_namespace  = false;
+    
+
+    /**
+     *  Set up XML parser, parse source, and return populated RSS object..
+     *   
+     *  @param string $source           string containing the RSS to be parsed
+     *
+     *  NOTE:  Probably a good idea to leave the encoding options alone unless
+     *         you know what you're doing as PHP's character set support is
+     *         a little weird.
+     *
+     *  NOTE:  A lot of this is unnecessary but harmless with PHP5 
+     *
+     *
+     *  @param string $output_encoding  output the parsed RSS in this character 
+     *                                  set defaults to ISO-8859-1 as this is PHP's
+     *                                  default.
+     *
+     *                                  NOTE: might be changed to UTF-8 in future
+     *                                  versions.
+     *                               
+     *  @param string $input_encoding   the character set of the incoming RSS source. 
+     *                                  Leave blank and Magpie will try to figure it
+     *                                  out.
+     *                                  
+     *                                   
+     *  @param bool   $detect_encoding  if false Magpie won't attempt to detect
+     *                                  source encoding. (caveat emptor)
+     *
+     */
+    function MagpieRSS ($source, $output_encoding='ISO-8859-1', 
+                        $input_encoding=null, $detect_encoding=true) 
+    {   
+        # if PHP xml isn't compiled in, die
+        #
+        if (!function_exists('xml_parser_create')) {
+            $this-&gt;error( &quot;Failed to load PHP's XML Extension. &quot; . 
+                          &quot;<A HREF="http://www.php.net/manual/en/ref.xml.php">http://www.php.net/manual/en/ref.xml.php</A>&quot;,
+                           E_USER_ERROR );
+        }
+        
+        list($parser, $source) = $this-&gt;create_parser($source, 
+                $output_encoding, $input_encoding, $detect_encoding);
+        
+        
+        if (!is_resource($parser)) {
+            $this-&gt;error( &quot;Failed to create an instance of PHP's XML parser. &quot; .
+                          &quot;<A HREF="http://www.php.net/manual/en/ref.xml.php">http://www.php.net/manual/en/ref.xml.php</A>&quot;,
+                          E_USER_ERROR );
+        }
+
+        
+        $this-&gt;parser = $parser;
+        
+        # pass in parser, and a reference to this object
+        # setup handlers
+        #
+        xml_set_object( $this-&gt;parser, $this );
+        xml_set_element_handler($this-&gt;parser, 
+                'feed_start_element', 'feed_end_element' );
+                        
+        xml_set_character_data_handler( $this-&gt;parser, 'feed_cdata' ); 
+    
+        $status = xml_parse( $this-&gt;parser, $source );
+        
+        if (! $status ) {
+            $errorcode = xml_get_error_code( $this-&gt;parser );
+            if ( $errorcode != XML_ERROR_NONE ) {
+                $xml_error = xml_error_string( $errorcode );
+                $error_line = xml_get_current_line_number($this-&gt;parser);
+                $error_col = xml_get_current_column_number($this-&gt;parser);
+                $errormsg = &quot;$xml_error at line $error_line, column $error_col&quot;;
+
+                $this-&gt;error( $errormsg );
+            }
+        }
+        
+        xml_parser_free( $this-&gt;parser );
+
+        $this-&gt;normalize();
+    }
+    
+    function feed_start_element($p, $element, &amp;$attrs) {
+        $el = $element = strtolower($element);
+        $attrs = array_change_key_case($attrs, CASE_LOWER);
+        
+        // check for a namespace, and split if found
+        $ns = false;
+        if ( strpos( $element, ':' ) ) {
+            list($ns, $el) = split( ':', $element, 2); 
+        }
+        if ( $ns and $ns != 'rdf' ) {
+            $this-&gt;current_namespace = $ns;
+        }
+            
+        # if feed type isn't set, then this is first element of feed
+        # identify feed from root element
+        #
+        if (!isset($this-&gt;feed_type) ) {
+            if ( $el == 'rdf' ) {
+                $this-&gt;feed_type = RSS;
+                $this-&gt;feed_version = '1.0';
+            }
+            elseif ( $el == 'rss' ) {
+                $this-&gt;feed_type = RSS;
+                $this-&gt;feed_version = $attrs['version'];
+            }
+            elseif ( $el == 'feed' ) {
+                $this-&gt;feed_type = ATOM;
+                $this-&gt;feed_version = $attrs['version'];
+                $this-&gt;inchannel = true;
+            }
+            return;
+        }
+    
+        if ( $el == 'channel' ) 
+        {
+            $this-&gt;inchannel = true;
+        }
+        elseif ($el == 'item' or $el == 'entry' ) 
+        {
+            $this-&gt;initem = true;
+            if ( isset($attrs['rdf:about']) ) {
+                $this-&gt;current_item['about'] = $attrs['rdf:about']; 
+            }
+        }
+        
+        // if we're in the default namespace of an RSS feed,
+        //  record textinput or image fields
+        elseif ( 
+            $this-&gt;feed_type == RSS and 
+            $this-&gt;current_namespace == '' and 
+            $el == 'textinput' ) 
+        {
+            $this-&gt;intextinput = true;
+        }
+        
+        elseif (
+            $this-&gt;feed_type == RSS and 
+            $this-&gt;current_namespace == '' and 
+            $el == 'image' ) 
+        {
+            $this-&gt;inimage = true;
+        }
+        
+        # handle atom content constructs
+        elseif ( $this-&gt;feed_type == ATOM and in_array($el, $this-&gt;_CONTENT_CONSTRUCTS) )
+        {
+            // avoid clashing w/ RSS mod_content
+            if ($el == 'content' ) {
+                $el = 'atom_content';
+            }
+            
+            $this-&gt;incontent = $el;
+            
+            
+        }
+        
+        // if inside an Atom content construct (e.g. content or summary) field treat tags as text
+        elseif ($this-&gt;feed_type == ATOM and $this-&gt;incontent ) 
+        {
+            // if tags are inlined, then flatten
+            $attrs_str = join(' ', 
+                    array_map('map_attrs', 
+                    array_keys($attrs), 
+                    array_values($attrs) ) );
+            
+            $this-&gt;append_content( &quot;&lt;$element $attrs_str&gt;&quot;  );
+                    
+            array_unshift( $this-&gt;stack, $el );
+        }
+        
+        // Atom support many links per containging element.
+        // Magpie treats link elements of type rel='alternate'
+        // as being equivalent to RSS's simple link element.
+        //
+        elseif ($this-&gt;feed_type == ATOM and $el == 'link' ) 
+        {
+            if ( isset($attrs['rel']) and $attrs['rel'] == 'alternate' ) 
+            {
+                $link_el = 'link';
+            }
+            else {
+                $link_el = 'link_' . $attrs['rel'];
+            }
+            
+            $this-&gt;append($link_el, $attrs['href']);
+        }
+        // set stack[0] to current element
+        else {
+            array_unshift($this-&gt;stack, $el);
+        }
+    }
+    
+
+    
+    function feed_cdata ($p, $text) {
+        
+        if ($this-&gt;feed_type == ATOM and $this-&gt;incontent) 
+        {
+            $this-&gt;append_content( $text );
+        }
+        else {
+            $current_el = join('_', array_reverse($this-&gt;stack));
+            $this-&gt;append($current_el, $text);
+        }
+    }
+    
+    function feed_end_element ($p, $el) {
+        $el = strtolower($el);
+        
+        if ( $el == 'item' or $el == 'entry' ) 
+        {
+            $this-&gt;items[] = $this-&gt;current_item;
+            $this-&gt;current_item = array();
+            $this-&gt;initem = false;
+        }
+        elseif ($this-&gt;feed_type == RSS and $this-&gt;current_namespace == '' and $el == 'textinput' ) 
+        {
+            $this-&gt;intextinput = false;
+        }
+        elseif ($this-&gt;feed_type == RSS and $this-&gt;current_namespace == '' and $el == 'image' ) 
+        {
+            $this-&gt;inimage = false;
+        }
+        elseif ($this-&gt;feed_type == ATOM and in_array($el, $this-&gt;_CONTENT_CONSTRUCTS) )
+        {   
+            $this-&gt;incontent = false;
+        }
+        elseif ($el == 'channel' or $el == 'feed' ) 
+        {
+            $this-&gt;inchannel = false;
+        }
+        elseif ($this-&gt;feed_type == ATOM and $this-&gt;incontent  ) {
+            // balance tags properly
+            // note:  i don't think this is actually neccessary
+            if ( $this-&gt;stack[0] == $el ) 
+            {
+                $this-&gt;append_content(&quot;&lt;/$el&gt;&quot;);
+            }
+            else {
+                $this-&gt;append_content(&quot;&lt;$el /&gt;&quot;);
+            }
+
+            array_shift( $this-&gt;stack );
+        }
+        else {
+            array_shift( $this-&gt;stack );
+        }
+        
+        $this-&gt;current_namespace = false;
+    }
+    
+    function concat (&amp;$str1, $str2=&quot;&quot;) {
+        if (!isset($str1) ) {
+            $str1=&quot;&quot;;
+        }
+        $str1 .= $str2;
+    }
+    
+    
+    
+    function append_content($text) {
+        if ( $this-&gt;initem ) {
+            $this-&gt;concat( $this-&gt;current_item[ $this-&gt;incontent ], $text );
+        }
+        elseif ( $this-&gt;inchannel ) {
+            $this-&gt;concat( $this-&gt;channel[ $this-&gt;incontent ], $text );
+        }
+    }
+    
+    // smart append - field and namespace aware
+    function append($el, $text) {
+        if (!$el) {
+            return;
+        }
+        if ( $this-&gt;current_namespace ) 
+        {
+            if ( $this-&gt;initem ) {
+                $this-&gt;concat(
+                    $this-&gt;current_item[ $this-&gt;current_namespace ][ $el ], $text);
+            }
+            elseif ($this-&gt;inchannel) {
+                $this-&gt;concat(
+                    $this-&gt;channel[ $this-&gt;current_namespace][ $el ], $text );
+            }
+            elseif ($this-&gt;intextinput) {
+                $this-&gt;concat(
+                    $this-&gt;textinput[ $this-&gt;current_namespace][ $el ], $text );
+            }
+            elseif ($this-&gt;inimage) {
+                $this-&gt;concat(
+                    $this-&gt;image[ $this-&gt;current_namespace ][ $el ], $text );
+            }
+        }
+        else {
+            if ( $this-&gt;initem ) {
+                $this-&gt;concat(
+                    $this-&gt;current_item[ $el ], $text);
+            }
+            elseif ($this-&gt;intextinput) {
+                $this-&gt;concat(
+                    $this-&gt;textinput[ $el ], $text );
+            }
+            elseif ($this-&gt;inimage) {
+                $this-&gt;concat(
+                    $this-&gt;image[ $el ], $text );
+            }
+            elseif ($this-&gt;inchannel) {
+                $this-&gt;concat(
+                    $this-&gt;channel[ $el ], $text );
+            }
+            
+        }
+    }
+    
+    function normalize () {
+        // if atom populate rss fields
+        if ( $this-&gt;is_atom() ) {
+            $this-&gt;channel['description'] = $this-&gt;channel['tagline'];
+            for ( $i = 0; $i &lt; count($this-&gt;items); $i++) {
+                $item = $this-&gt;items[$i];
+                if ( isset($item['summary']) )
+                    $item['description'] = $item['summary'];
+                if ( isset($item['atom_content']))
+                    $item['content']['encoded'] = $item['atom_content'];
+                
+                $atom_date = (isset($item['issued']) ) ? $item['issued'] : $item['modified'];
+                if ( $atom_date ) {
+                    $epoch = @parse_w3cdtf($item['modified']);
+                    if ($epoch and $epoch &gt; 0) {
+                        $item['date_timestamp'] = $epoch;
+                    }
+                }
+                
+                $this-&gt;items[$i] = $item;
+            }       
+        }
+        elseif ( $this-&gt;is_rss() ) {
+            $this-&gt;channel['tagline'] = $this-&gt;channel['description'];
+            for ( $i = 0; $i &lt; count($this-&gt;items); $i++) {
+                $item = $this-&gt;items[$i];
+                if ( isset($item['description']))
+                    $item['summary'] = $item['description'];
+                if ( isset($item['content']['encoded'] ) )
+                    $item['atom_content'] = $item['content']['encoded'];
+                
+                if ( $this-&gt;is_rss() == '1.0' and isset($item['dc']['date']) ) {
+                    $epoch = @parse_w3cdtf($item['dc']['date']);
+                    if ($epoch and $epoch &gt; 0) {
+                        $item['date_timestamp'] = $epoch;
+                    }
+                }
+                elseif ( isset($item['pubdate']) ) {
+                    $epoch = @strtotime($item['pubdate']);
+                    if ($epoch &gt; 0) {
+                        $item['date_timestamp'] = $epoch;
+                    }
+                }
+                
+                $this-&gt;items[$i] = $item;
+            }
+        }
+    }
+    
+    
+    function is_rss () {
+        if ( $this-&gt;feed_type == RSS ) {
+            return $this-&gt;feed_version; 
+        }
+        else {
+            return false;
+        }
+    }
+    
+    function is_atom() {
+        if ( $this-&gt;feed_type == ATOM ) {
+            return $this-&gt;feed_version;
+        }
+        else {
+            return false;
+        }
+    }
+
+    /**
+    * return XML parser, and possibly re-encoded source
+    *
+    */
+    function create_parser($source, $out_enc, $in_enc, $detect) {
+        if ( substr(phpversion(),0,1) == 5) {
+            $parser = $this-&gt;php5_create_parser($in_enc, $detect);
+        }
+        else {
+            list($parser, $source) = $this-&gt;php4_create_parser($source, $in_enc, $detect);
+        }
+        if ($out_enc) {
+            $this-&gt;encoding = $out_enc;
+            xml_parser_set_option($parser, XML_OPTION_TARGET_ENCODING, $out_enc);
+        }
+        
+        return array($parser, $source);
+    }
+    
+    /**
+    * Instantiate an XML parser under PHP5
+    *
+    * PHP5 will do a fine job of detecting input encoding
+    * if passed an empty string as the encoding. 
+    *
+    * All hail libxml2!
+    *
+    */
+    function php5_create_parser($in_enc, $detect) {
+        // by default php5 does a fine job of detecting input encodings
+        if(!$detect &amp;&amp; $in_enc) {
+            return xml_parser_create($in_enc);
+        }
+        else {
+            return xml_parser_create('');
+        }
+    }
+    
+    /**
+    * Instaniate an XML parser under PHP4
+    *
+    * Unfortunately PHP4's support for character encodings
+    * and especially XML and character encodings sucks.  As
+    * long as the documents you parse only contain characters
+    * from the ISO-8859-1 character set (a superset of ASCII,
+    * and a subset of UTF-8) you're fine.  However once you
+    * step out of that comfy little world things get mad, bad,
+    * and dangerous to know.
+    *
+    * The following code is based on SJM's work with FoF
+    * @see <A HREF="http://minutillo.com/steve/weblog/2004/6/17/php-xml-and-character-encodings-a-tale-of-sadness-rage-and-data-loss">http://minutillo.com/steve/weblog/2004/6/17/php-xml-and-character-encodings-a-tale-of-sadness-rage-and-data-loss</A>
+    *
+    */
+    function php4_create_parser($source, $in_enc, $detect) {
+        if ( !$detect ) {
+            return array(xml_parser_create($in_enc), $source);
+        }
+        
+        if (!$in_enc) {
+            if (preg_match('/&lt;?xml.*encoding=[\'&quot;](.*?)[\'&quot;].*?&gt;/m', $source, $m)) {
+                $in_enc = strtoupper($m[1]);
+                $this-&gt;source_encoding = $in_enc;
+            }
+            else {
+                $in_enc = 'UTF-8';
+            }
+        }
+        
+        if ($this-&gt;known_encoding($in_enc)) {
+            return array(xml_parser_create($in_enc), $source);
+        }
+        
+        // the dectected encoding is not one of the simple encodings PHP knows
+        
+        // attempt to use the iconv extension to
+        // cast the XML to a known encoding
+        // @see <A HREF="http://php.net/iconv">http://php.net/iconv</A>
+       
+        if (function_exists('iconv'))  {
+            $encoded_source = iconv($in_enc,'UTF-8', $source);
+            if ($encoded_source) {
+                return array(xml_parser_create('UTF-8'), $encoded_source);
+            }
+        }
+        
+        // iconv didn't work, try mb_convert_encoding
+        // @see <A HREF="http://php.net/mbstring">http://php.net/mbstring</A>
+        if(function_exists('mb_convert_encoding')) {
+            $encoded_source = mb_convert_encoding($source, 'UTF-8', $in_enc );
+            if ($encoded_source) {
+                return array(xml_parser_create('UTF-8'), $encoded_source);
+            }
+        }
+        
+        // else 
+        $this-&gt;error(&quot;Feed is in an unsupported character encoding. ($in_enc) &quot; .
+                     &quot;You may see strange artifacts, and mangled characters.&quot;,
+                     E_USER_NOTICE);
+            
+        return array(xml_parser_create(), $source);
+    }
+    
+    function known_encoding($enc) {
+        $enc = strtoupper($enc);
+        if ( in_array($enc, $this-&gt;_KNOWN_ENCODINGS) ) {
+            return $enc;
+        }
+        else {
+            return false;
+        }
+    }
+
+    function error ($errormsg, $lvl=E_USER_WARNING) {
+        // append PHP's error message if track_errors enabled
+        if ( $php_errormsg ) { 
+            $errormsg .= &quot; ($php_errormsg)&quot;;
+        }
+        if ( MAGPIE_DEBUG ) {
+            trigger_error( $errormsg, $lvl);        
+        }
+        else {
+            error_log( $errormsg, 0);
+        }
+        
+        $notices = E_USER_NOTICE|E_NOTICE;
+        if ( $lvl&amp;$notices ) {
+            $this-&gt;WARNING = $errormsg;
+        } else {
+            $this-&gt;ERROR = $errormsg;
+        }
+    }
+    
+    
+} // end class RSS
+
+function map_attrs($k, $v) {
+    return &quot;$k=\&quot;$v\&quot;&quot;;
+}
+
+
+?&gt;

Added: trunk/inc/external/magpierss/rss_utils.inc
===================================================================
--- trunk/inc/external/magpierss/rss_utils.inc	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/magpierss/rss_utils.inc	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,67 @@
+&lt;?php
+/*
+ * Project:     MagpieRSS: a simple RSS integration tool
+ * File:        rss_utils.inc, utility methods for working with RSS
+ * Author:      Kellan Elliott-McCrea &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">kellan at protest.net</A>&gt;
+ * Version:     0.51
+ * License:     GPL
+ *
+ * The lastest version of MagpieRSS can be obtained from:
+ * <A HREF="http://magpierss.sourceforge.net">http://magpierss.sourceforge.net</A>
+ *
+ * For questions, help, comments, discussion, etc., please join the
+ * Magpie mailing list:
+ * <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">magpierss-general at lists.sourceforge.net</A>
+ */
+
+
+/*======================================================================*\
+    Function: parse_w3cdtf
+    Purpose:  parse a W3CDTF date into unix epoch
+
+    NOTE: <A HREF="http://www.w3.org/TR/NOTE-datetime">http://www.w3.org/TR/NOTE-datetime</A>
+\*======================================================================*/
+
+function parse_w3cdtf ( $date_str ) {
+    
+    # regex to match wc3dtf
+    $pat = &quot;/(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2})(:(\d{2}))?(?:([-+])(\d{2}):?(\d{2})|(Z))?/&quot;;
+    
+    if ( preg_match( $pat, $date_str, $match ) ) {
+        list( $year, $month, $day, $hours, $minutes, $seconds) = 
+            array( $match[1], $match[2], $match[3], $match[4], $match[5], $match[6]);
+        
+        # calc epoch for current date assuming GMT
+        $epoch = gmmktime( $hours, $minutes, $seconds, $month, $day, $year);
+        
+        $offset = 0;
+        if ( $match[10] == 'Z' ) {
+            # zulu time, aka GMT
+        }
+        else {
+            list( $tz_mod, $tz_hour, $tz_min ) =
+                array( $match[8], $match[9], $match[10]);
+            
+            # zero out the variables
+            if ( ! $tz_hour ) { $tz_hour = 0; }
+            if ( ! $tz_min ) { $tz_min = 0; }
+        
+            $offset_secs = (($tz_hour*60)+$tz_min)*60;
+            
+            # is timezone ahead of GMT?  then subtract offset
+            #
+            if ( $tz_mod == '+' ) {
+                $offset_secs = $offset_secs * -1;
+            }
+            
+            $offset = $offset_secs; 
+        }
+        $epoch = $epoch + $offset;
+        return $epoch;
+    }
+    else {
+        return -1;
+    }
+}
+
+?&gt;

Added: trunk/inc/external/xspf/class.XSPF.php
===================================================================
--- trunk/inc/external/xspf/class.XSPF.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/xspf/class.XSPF.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,509 @@
+&lt;?php
+/*********************************************  
+* XSPF Class is a class to generate
+* a XSPF( <A HREF="http://www.xspf.org">http://www.xspf.org</A>) playlist. 
+* Copyright (C) 2005  Bjorn Wijers [<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">me at bjornwijers.com</A>]
+*
+* This program is free software; you can redistribute it and/or
+* modify it under the terms of the GNU General Public License
+* as published by the Free Software Foundation; either version 2
+* of the License, or (at your option) any later version.
+*
+* This program is distributed in the hope that it will be useful,
+* but WITHOUT ANY WARRANTY; without even the implied warranty of
+* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+* GNU General Public License for more details.
+*
+* You should have received a copy of the GNU General Public License
+* along with this program; if not, write to the Free Software
+* Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+*
+*	dependencies: 
+*		-XML_Serializer, use PEAR to install
+*		-XSPF_Track
+*	mimetype: application/xspf+xml.
+*
+*	this class can be used to generate
+*	a XSPF( <A HREF="http://www.xspf.org">http://www.xspf.org</A>) playlist. 
+*
+*	usefull urls:
+*	<A HREF="http://www.sitepoint.com/print/xml-php-pear-xml_serializer">http://www.sitepoint.com/print/xml-php-pear-xml_serializer</A>
+*	<A HREF="http://www.melonfire.com/community/columns/trog/article.php?id=244&amp;page=5">http://www.melonfire.com/community/columns/trog/article.php?id=244&amp;page=5</A>
+*
+*	
+*********************************************/
+
+/* Enable these three lines during debugging: */
+ini_set(&quot;display_errors&quot;,1);
+ini_set(&quot;display_startup_errors&quot;,1);
+error_reporting(E_NOTICE | E_ALL );
+
+/* set include path for pear install */
+if(!ini_set(&quot;include_path&quot;,&quot;.:/usr/share/php&quot;)) {
+	die (&quot;Sorry, but include_path could not be set&quot;);
+}
+
+
+	class XSPF {
+		var $log = &quot;LOG\n\n&quot;;			// value
+		var $version;      				// value or NULL
+		var $charset;      				// value or NULL
+		var $xmlns;        				// value or NULL
+		var $playlist_title;			// value or NULL
+		var $playlist_creator;      	// value or NULL
+		var $playlist_annotation;   	// value or NULL
+		var $playlist_info;         	// value or NULL
+		var $playlist_location;     	// value or NULL
+		var $playlist_identifier;   	// value or NULL
+		var $playlist_image;        	// value or NULL
+		var $playlist_date;         	// value or NULL
+		var $playlist_license;      	// value or NULL
+		var $track;						// value or NULL
+		var $attributions = array() ;	// plural element names are arrays
+		var $links = array(); 			// plural element names are arrays
+		var $metas = array();			// plural element names are arrays
+		var $extensions = array(); 		// plural element names are arrays
+		var $tracklist = array(); 		// contains track objects      
+		var $playlist_xml; 				// value or NULL
+		
+		/* CONSTRUCTOR */
+		function XSPF() {
+			require_once('class.XSPF_Track.php');	// track definition
+			require_once('XML/Serializer.php');		// Serializer class from PEAR
+			$this-&gt;setVersion();
+			$this-&gt;setCharSet();
+			$this-&gt;setXMLNameSpace();
+
+		}
+
+		
+		
+		/*
+		* creates a track object based
+		* on the data received and 
+		* adds it to the tracklist array
+		*/
+		function addTrack($params) {
+			// make sure addtrack gets an array
+			if(!is_array($params)) {
+				$this-&gt;writeToLog(&quot;addTrack did not receive a parameter of the type array&quot;);
+				return false;
+			}
+			
+			// create a Track object
+			// the track object handles
+			// the data itself
+			$this-&gt;track = new XSPF_Track($params);
+			array_push($this-&gt;tracklist, $this-&gt;track);
+		}
+		
+		/*
+		* output the playlist
+		*/
+		function serializePlaylist() {
+			
+			// get all the tracks for the list
+			$all_tracks = $this-&gt;getTrackList();
+			$nr_tracks = sizeof($all_tracks);
+			$list = array(&quot;track&quot;=&gt;array());
+			// NOTE: attribution, link, meta and extension are not functional yet!
+			if($nr_tracks &gt;= 0) {
+				foreach($all_tracks as $index=&gt;$value) {
+					$a_track =	array (
+									'location'=&gt; $value-&gt;getTrackLocation(),
+									'identifier'=&gt; $value-&gt;getTrackIdentifier(),
+									'title'=&gt; $value-&gt;getTrackTitle(),
+									'creator'=&gt; $value-&gt;getTrackCreator(),
+									'annotation'=&gt; $value-&gt;getTrackAnnotation(),
+									'info'=&gt; $value-&gt;getTrackInfo(),
+									'image'=&gt; $value-&gt;getTrackImage(),
+									'album'=&gt; $value-&gt;getTrackAlbum(),
+									'trackNum'=&gt; $value-&gt;getTrackNr(),
+									'duration'=&gt; $value-&gt;getTrackDuration(),
+									'meta'=&gt; $value-&gt;getTrackMetas(),
+									'extension'=&gt; $value-&gt;getTrackExtensions()
+								 );
+					array_push($list['track'], $a_track);			 
+				}
+			}
+			//echo &quot;&lt;pre&gt;&quot;;
+			//print_r($list);
+			//echo &quot;&lt;/pre&gt;&quot;;
+			// playlist datamodel
+			// NOTE: attribution, link, meta and extension are not functional yet!
+			$playlist = array (
+				'title'=&gt;$this-&gt;getPlaylistTitle(),
+				'creator'=&gt;$this-&gt;getPlaylistCreator(),
+				'annotation'=&gt;$this-&gt;getPLaylistAnnotation(),
+				'info'=&gt;$this-&gt;getPlaylistInfo(),
+				'location'=&gt;$this-&gt;getPlaylistLocation(),
+				'identifier'=&gt;$this-&gt;getPlaylistIdentifier(),
+				'image'=&gt;$this-&gt;getPlaylistImage(),
+				'date'=&gt;$this-&gt;getPlaylistDate(),
+				'license'=&gt;$this-&gt;getPlaylistLicense(),
+				'trackList'=&gt;$list
+			);
+			
+					
+			// attributes for playlist root node
+			$root_attributes = array();
+			$root_attributes['version'] = $this-&gt;getVersion();
+			$root_attributes['xmlns'] = $this-&gt;getXMLNS();
+			
+			// serializer options
+			// this have been changed with version 0.16.0 of XML_Serializer
+			$serializer_options = array (
+				XML_SERIALIZER_OPTION_XML_DECL_ENABLED=&gt;true,
+				XML_SERIALIZER_OPTION_XML_ENCODING=&gt;$this-&gt;getCharSet(),
+				XML_SERIALIZER_OPTION_ROOT_NAME=&gt;'playlist',
+				XML_SERIALIZER_OPTION_ROOT_ATTRIBS=&gt;$root_attributes,
+				XML_SERIALIZER_OPTION_MODE=&gt;XML_SERIALIZER_MODE_SIMPLEXML,
+				XML_SERIALIZER_OPTION_IGNORE_NULL=&gt;true,
+				XML_SERIALIZER_OPTION_ATTRIBUTES_KEY=&gt;'__attributes',
+				XML_SERIALIZER_OPTION_CONTENT_KEY=&gt;'__content'
+			);
+			  
+			// Instantiate the serializer with the options
+			$Serializer = &amp;new XML_Serializer($serializer_options);
+			
+			// Serialize the data structure
+			$status = $Serializer-&gt;serialize($playlist);
+
+			// Check whether serialization worked
+			if (PEAR::isError($status)) {
+			   die($status-&gt;getMessage());
+			}
+			
+			// Display the XML document
+			//header('Content-type: text/xml');
+			$this-&gt;playlist_xml = $Serializer-&gt;getSerializedData(); 
+		}
+		
+		
+		
+		
+		function writePlaylist($path = null) {
+			// make sure the playlist is serialized
+			$this-&gt;serializePlaylist();
+					
+			if(!$handle = fopen($path, &quot;w+&quot;)) {
+				return false;
+			}
+			
+			if(fwrite($handle, $this-&gt;getPlaylistXML()) === FALSE) {
+				return false;
+			}
+			fclose($handle);
+			return true;
+		
+		}
+		
+		
+		
+		
+		/* 
+		* util function to keep a log 
+		*	
+		* NOTICE:
+		* feedback will be appended to a var,
+		* you can get the log by using getLog
+		*	
+		*/
+		function WriteToLog($error) {
+			$this-&gt;log .= $error . &quot;\n&quot;; //each line contains 1 error
+		}
+		
+			
+		/****** SETTERS *****/
+		
+		/* set the version defaults to version 1 */
+		function setVersion($version = '1') {
+			$this-&gt;version = $version;
+		}
+		
+		/* set the version defaults to UTF-8 */
+		function setCharSet($charset = 'UTF-8') {
+			$this-&gt;charset = $charset;
+		}
+	
+		/* 
+		* set the xml namespace 
+		* defaults to <A HREF="http://xspf.org/ns/0/">http://xspf.org/ns/0/</A>
+		*
+		* NOTE: 
+		* according to the xspf specs:
+		* Notice that the default namespace is 
+		* 0 but the default version is 1. 
+		* This is because version 1 playlists 
+		* are backwards compatible with version 
+		* 0 parsers.
+		*/
+		function setXMLNameSpace($xmlns = '<A HREF="http://xspf.org/ns/0/">http://xspf.org/ns/0/</A>') {
+			$this-&gt;xmlns = $xmlns;
+		}
+	
+		/* set the playlist title defaults to testplaylist */
+		function setPlaylistTitle($title = 'testplaylist') {
+			$this-&gt;playlist_title = $title;
+		}
+		
+		/* 
+		* set the playlist creator defaults to testcreator 
+		* Human-readable name of the entity (author, authors, group, company, etc) 
+		* that authored the playlist
+		*/
+		function setPlaylistCreator($creator = 'testcreator') {
+			$this-&gt;playlist_creator = $creator;
+		}
+		
+		/* 
+		* set the playlist annotation 
+		* A human-readable comment on the playlist	
+		*/
+		function setPlaylistAnnotation($annotation) {
+			$this-&gt;playlist_annotation = $annotation;
+		}
+	
+		/* 
+		* set the playlist info 
+		* URL of a web page to find 
+		* out more about this playlist
+		*/
+		function setPlaylistInfo($info) {
+			$this-&gt;playlist_info = $info;
+		}	
+		
+		/* 
+		* set the playlist location. 
+		* A source URL for this playlist
+		*/
+		function setPlaylistLocation($location) {
+			$this-&gt;playlist_location = $location;
+		}
+		
+		/* 
+		* set the playlist identifier. 
+		* Canonical ID for this playlist. 
+		* Likely to be a hash or other 
+		* location-independent name.
+		*/
+		function setPlaylistIdentifier($identifier) {
+			$this-&gt;playlist_identifier = $identifier;
+		}
+		
+		/*
+		* set a playlist image
+		* URL of an image to display 
+		* in the absence of a 
+		* playlist/trackList/image element
+		*/
+		function setPlaylistImage($image) {
+			$this-&gt;playlist_image = $image;
+		}
+		
+		/*
+		* set a playlist date default to current time and date
+		*  
+		*  
+		* NOTE: 
+		* call setVersion before you call this one,
+		* because there is a difference in handling 
+		* dates between version 0 and version 1 and
+		* this function handles the difference for you.
+		* If you don't call version first this will result 
+		* in an error.
+		*
+		* VERSION 0: 
+		* in version 0 of XSPF, 
+		* this was specifed as an ISO 8601 
+		* YYYY-MM-DD format.
+		* <A HREF="http://www.w3.org/QA/Tips/iso-date">http://www.w3.org/QA/Tips/iso-date</A>
+		*
+		* VERSION 1:
+		* Creation date (not last-modified date)
+		* of the playlist, formatted as a XML schema dateTime
+		*
+		*   	
+		*/
+		function setPlaylistDate($timestamp = NULL) {
+			//default timestamp to current time and date
+			if(empty($timestamp)) {
+				$timestamp = time();
+			}
+			
+			//get version and process the date accordingly
+			switch ($this-&gt;getVersion()){
+				//version 0
+				case 0:
+					$the_date = date(&quot;Y-m-d&quot;, $timestamp);
+					break;
+				//version 1
+				case 1: 
+					$main_date = date(&quot;Y-m-d\TH:i:s&quot;, $timestamp);				
+					$tz = date(&quot;O&quot;, $timestamp);				
+					$tz = substr_replace ($tz, ':', 3, 0);
+					$the_date = $main_date . $tz;
+					break;
+				default:
+					$this-&gt;writeToLog(&quot;Could not determine required date&quot;);
+					break;
+			}
+			$this-&gt;playlist_date = $the_date;
+		}
+		
+		/*
+		* set a playlist license
+		* URL of a resource that describes 
+		* the license under which this playlist was released 
+		*/
+		function setPlaylistLicense($license) {
+			$this-&gt;playlist_license = $license;
+		}	
+		
+		//////////// NOT QUITE CLEAR HOW TO HANDLE THESE BELOW ///////////////////
+		
+		
+		/*
+		* set a playlist attribution list
+		*
+		* expects array with index: location OR indentifier
+		*
+		*
+		* An ordered list of URIs. 
+		* The purpose is to satisfy licenses 
+		* allowing modification but requiring 
+		* attribution. If you modify such a playlist, 
+		* move its ##playlist/location OR ##playlist/identifier 
+		* element to the top of the items in 
+		* the //playlist/attribution element.
+		*/
+		function setPlaylistAttribution($attribution) {
+			array_push($this-&gt;attributions, $attribution);
+		}
+		
+		
+		
+		/*
+		* set a playlist link list
+		*
+		* The link element allows non-XSPF 
+		* web resources to be included in XSPF documents
+		* without breaking XSPF validation
+		*/
+		function setPlaylistlink($link) {
+			array_push($this-&gt;links, $link);
+		}
+		
+		
+		/*
+		* set a playlist meta list
+		*
+		* The meta element allows non-XSPF
+		* metadata to be included in XSPF 
+		* documents without breaking XSPF 
+		* validation
+		*/
+		function setPlaylistMeta($meta) {
+			array_push($this-&gt;metas, $meta);
+		}
+		
+		/*
+		* set a playlist extension list
+		*
+		* The extension element 
+		* allows non-XSPF XML to be
+		* included in XSPF documents
+		* without breaking XSPF validation
+		*/
+		function setPlaylistExtension($extension) {
+			array_push($this-&gt;extensions, $extension);
+		}
+		
+		//////////////////////////////////////////////////////////////////////////
+		
+		
+		
+		/***** GETTERS *****/
+		
+		/**
+		* all getter functions return either the corresponding value or null
+		* except for the getVersion, getXMLNS and getCharset	
+		*/
+		
+		
+		/* get the version */
+		function getVersion() {
+			return $this-&gt;version;
+		}
+		
+		function getXMLNS() {
+			return $this-&gt;xmlns;
+		}
+		
+		function getCharset() {
+			return $this-&gt;charset;
+		}
+		
+		function getPlaylistTitle() {
+			return $val = (empty($this-&gt;playlist_title)) ? null : $this-&gt;playlist_title;
+		}
+		
+		function getPlaylistCreator() {
+			return $val = (empty($this-&gt;playlist_creator)) ? null : $this-&gt;playlist_creator;
+		}
+		
+		function getPlaylistAnnotation() {
+			return $val = (empty($this-&gt;playlist_annotation)) ? null : $this-&gt;playlist_annotation;
+		}
+		
+		function getPlaylistInfo() {
+			return $val = (empty($this-&gt;playlist_info)) ? null : $this-&gt;playlist_info;
+		}
+		
+		function getPlaylistImage() {
+			return $val = (empty($this-&gt;playlist_image)) ? null : $this-&gt;playlist_image;
+		}
+		
+		function getPlaylistDate() {
+			return $val = (empty($this-&gt;playlist_date)) ? null : $this-&gt;playlist_date;
+		}
+		
+		function getPlaylistLicense() {
+			return $val = (empty($this-&gt;playlist_license)) ? null : $this-&gt;playlist_license;
+		}
+		
+		function getPlaylistLocation() {
+			return $val = (empty($this-&gt;playlist_location)) ? null : $this-&gt;playlist_location;
+		}
+		
+		function getPlaylistIdentifier() {
+			return $val = (empty($this-&gt;playlist_identifier)) ? null : $this-&gt;playlist_identifier;
+		}
+		
+		
+		function getLog() {
+			return $this-&gt;log;
+		}
+		
+		function getTracklist() {
+			return $val = (empty($this-&gt;tracklist)) ? null : $this-&gt;tracklist;
+		}
+		
+		
+		function getPlaylistXML() {
+			if(!empty($this-&gt;playlist_xml)) {
+				return $this-&gt;playlist_xml;
+			} else {
+				$this-&gt;serializePlaylist();
+				return $this-&gt;playlist_xml;
+			}
+ 			
+		}
+		
+}
+
+
+
+
+	
+?&gt;


Property changes on: trunk/inc/external/xspf/class.XSPF.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/external/xspf/class.XSPF_Track.php
===================================================================
--- trunk/inc/external/xspf/class.XSPF_Track.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/external/xspf/class.XSPF_Track.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,381 @@
+&lt;?php
+/*********************************************  
+* XSPF_Track Class is a helperclass to generate
+* a XSPF( <A HREF="http://www.xspf.org">http://www.xspf.org</A>) playlist. 
+* Copyright (C) 2005  Bjorn Wijers [<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">me at bjornwijers.com</A>]
+*
+* This program is free software; you can redistribute it and/or
+* modify it under the terms of the GNU General Public License
+* as published by the Free Software Foundation; either version 2
+* of the License, or (at your option) any later version.
+*
+* This program is distributed in the hope that it will be useful,
+* but WITHOUT ANY WARRANTY; without even the implied warranty of
+* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+* GNU General Public License for more details.
+*
+* You should have received a copy of the GNU General Public License
+* along with this program; if not, write to the Free Software
+* Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
+*
+*	dependencies: 
+*		-XML_Serializer, use PEAR to install
+*		-XSPF
+*	mimetype: application/xspf+xml.
+*
+*********************************************/
+
+/* Enable these three lines during debugging: */
+	ini_set(&quot;display_errors&quot;,1);
+	ini_set(&quot;display_startup_errors&quot;,1);
+	error_reporting(E_NOTICE | E_ALL );
+
+	class XSPF_Track {
+		var $track_title;							// value or NULL,
+		var $track_nr;								// value or NULL,
+		var $track_album;  							// value or NULL
+		var $track_annotation; 						// value or NULL
+		var $track_creator; 						// value or NULL
+		var $track_duration;						// value or NULL
+		var $track_image; 							// value or NULL
+		var $track_info;							// value or NULL
+		var $track_extension_application;			// value or NULL,
+		var $track_meta_rel;						// value or NULL,
+		var $track_links = array();	       			// plural element names are arrays
+		var $track_locations = array();    			// plural element names are arrays
+		var $track_metas= array(); 	       			// plural element names are arrays
+		var $track_extensions = array(); 			// plural element names are arrays			 
+		var $track_identifiers = array(); 			// plural element names are arrays
+	
+
+		/* CONSTRUCTOR */
+		function XSPF_Track($params) {
+			if(!is_array($params)) {
+				return false;
+			}
+			if(!empty($params)) {
+				foreach($params as $index=&gt;$value) {
+					switch ($index) {
+						case &quot;track_title&quot;:
+							$this-&gt;setTrackTitle($value);
+							break;
+							
+						case &quot;track_nr&quot;:
+							$this-&gt;setTrackNr($value);
+							break;	
+	
+						case &quot;track_album&quot;:
+							$this-&gt;setTrackAlbum($value);
+							break;	
+		
+						case &quot;track_annotation&quot;:
+							$this-&gt;setTrackAnnotation($value);
+							break;	
+		
+						case &quot;track_creator&quot;:
+							$this-&gt;setTrackCreator($value);
+							break;	
+							
+						case &quot;track_duration&quot;:
+							$this-&gt;setTrackDuration($value);
+							break;	
+							
+						case &quot;track_info&quot;:
+							$this-&gt;setTrackInfo($value);
+							break;	
+							
+						case &quot;track_image&quot;:
+							$this-&gt;setTrackImage($value);
+							break;	
+							
+						case &quot;track_location&quot;:
+							$this-&gt;setTrackLocation($value);
+							break;
+						
+						case &quot;track_identifier&quot;:
+							$this-&gt;setTrackIdentifier($value);
+							break;	
+							
+						case &quot;track_link&quot;:
+							$this-&gt;setTrackLink($value);
+							break;
+							
+						case &quot;track_meta&quot;:
+							$this-&gt;setTrackMeta($value);
+							break;
+							
+						case &quot;track_meta_rel&quot;:
+							$this-&gt;setTrackMetaRel($value);
+							break;
+							
+						case &quot;track_extension&quot;:
+							$this-&gt;setTrackExtension($value);
+							break;	
+					
+						case &quot;track_extension_application&quot;:
+							$this-&gt;setTrackExtensionApplication($value);
+							break;	
+							
+							
+					}
+				}
+			}
+		}
+		
+		/***** SETTERS *****/
+		
+		/* 
+		* set the title of a track
+		* Human-readable name of the track 
+		* that authored the resource which 
+		* defines the duration of track rendering.
+		* 
+		*/
+		function setTrackTitle($title) {
+			$this-&gt;track_title = $title;
+		}
+		
+		
+		/* 
+		* set the track number of a track 
+		* Integer with value greater than 
+		* zero giving the ordinal position
+		* of the media on the xspf:album.
+		*
+		*/
+		function setTrackNr($nr) {
+			if($nr &lt; 0 || !is_numeric($nr)) {
+				return false;
+			}
+			$this-&gt;track_nr = $nr;
+		}
+		
+		/* 
+		* set the album of a track 
+		* Human-readable name of 
+		* the collection from which
+		* the resource which defines 
+		* the duration of track rendering 
+		* comes.
+		*
+		*/
+		function setTrackAlbum($album) {
+			$this-&gt;track_album = $album;
+		}
+		
+		
+		/*
+		* set the annotation of a track 
+		* A human-readable comment on the track.
+		* This is character data, not HTML
+		*/
+		function setTrackAnnotation($annotation) {
+			$this-&gt;track_annotation = $annotation;
+		}
+		
+		/* 
+		* set the creator of a track 
+		* Human-readable name of the
+		* entity (author, authors, group,
+		* company, etc) that authored the
+		* resource which defines the 
+		* duration of track rendering.
+		*/
+		function setTrackCreator($creator) {
+			$this-&gt;track_creator = $creator;
+		}
+	
+		/* 
+		* set the duration of a track 
+		* The time to render a resource, 
+		* in milliseconds. It MUST be a 
+		* valid XML Schema nonNegativeInteger.
+		* This value is only a hint
+		*/
+		function setTrackDuration($duration) {
+			$this-&gt;track_duration = $duration;
+		}
+		
+		/*
+		* set the image belong to a track
+		* URL of an image to display 
+		* for the duration of the track	
+		*/
+		function setTrackImage($image) {
+			$this-&gt;track_image = $image;
+		}
+		
+		/*
+		* set a url belonging to the track
+		* URL of a place where this resource
+		* can be bought or more info can be found.
+		*/
+		function setTrackInfo($info) {
+			$this-&gt;track_info = $info;
+		}
+		
+		
+		/*
+		* set one ore more locations for a track
+		* expects an array as argument
+		* URL of resource to be rendered. 
+		* Probably an audio resource, but MAY be
+		* any type of resource with a well-known 
+		* duration, such as video, a SMIL document,
+		* or an XSPF document. The duration of the
+		* resource defined in this element defines 
+		* the duration of rendering. xspf:track 
+		* elements MAY contain zero or more location
+		* elements, but a user-agent MUST NOT render
+		* more than one of the named resources.
+		*/
+		function setTrackLocation($locations) {
+			if(!is_array($locations)) {
+				return false;		
+			}
+			foreach($locations as $key=&gt;$value) {
+				array_push($this-&gt;track_locations, $value);
+			}
+		}
+
+		function setTrackIdentifier($identifiers) {
+			if(!is_array($identifiers)) {
+				return false;		
+			}
+			foreach($identifiers as $key=&gt;$value) {
+				array_push($this-&gt;track_identifiers, $value);
+			}
+		}
+
+		
+		function setTrackLink($links) {
+			if(!is_array($links)) {
+				return false;		
+			}
+			
+			foreach($links as $key=&gt;$value) {
+				array_push($this-&gt;track_links, $value);
+			}
+		}
+
+		function setTrackMeta($metas) {
+			if(!is_array($metas)) {
+				return false;		
+			}
+			
+			if($this-&gt;getTrackMetaRel() == null) {
+				return false;
+			}
+
+			foreach ($metas as $key=&gt;$val){
+				$meta_node = array('__attributes'=&gt; array( 'rel'=&gt; $this-&gt;getTrackMetaRel()), $val);
+				array_push($this-&gt;track_metas, $meta_node);
+			}	
+			
+			//foreach($metas as $key=&gt;$value) {
+			//	array_push($this-&gt;track_metas, $value);
+			//}
+		}
+		
+		/* set the rel attribute of the mete node */
+		function setTrackMetaRel($rel) {
+			$this-&gt;track_meta_rel = $rel;
+		}
+		
+		/* set the application attribute of the extension node */
+		function setTrackExtensionApplication($application) {
+			$this-&gt;track_extension_application = $application;
+		}
+		
+		/* 
+		* set one or multiple extensions 
+		* NOTE: the $extensions needs to be an array
+		* with the first key called _content!
+		* i.e. $extension = array('_content'=&gt;array('firstnode'=&gt;'firstinfo','secondnode'=&gt;'secinfo', 'thirdnode'=&gt;'thirdinfo'));
+		*
+		*/
+		function setTrackExtension($extensions) {
+			if(!is_array($extensions)) {
+				return false;		
+			}
+			
+			if($this-&gt;getTrackExtensionApplication() == null) {
+				return false;
+			}
+
+			foreach ($extensions as $key=&gt;$val){
+				$extension_node = array('__attributes'=&gt; array( 'application'=&gt; $this-&gt;getTrackExtensionApplication()), $val);
+				array_push($this-&gt;track_extensions, $extension_node);
+			}								
+		}
+		
+		/***** GETTERS *****/
+		
+		/**
+		*	all getter functions return either the corresponding value or null
+		*/
+		
+		function getTrackTitle() {
+			return $val = (empty($this-&gt;track_title)) ? null : $this-&gt;track_title;
+		}
+		
+		function getTrackAlbum() {
+			return $val = (empty($this-&gt;track_album)) ? null : $this-&gt;track_album;
+		}
+		
+		function getTrackNr() {
+			return $val = (empty($this-&gt;track_nr)) ? null : $this-&gt;track_nr;
+		}
+
+		function getTrackAnnotation() {
+			return $val = (empty($this-&gt;track_annotation)) ? null : $this-&gt;track_annotation;
+		}
+		
+		function getTrackCreator() {
+			return $val = (empty($this-&gt;track_creator)) ? null : $this-&gt;track_creator;
+		}
+		
+		function getTrackDuration() {
+			return $val = (empty($this-&gt;track_duration)) ? null : $this-&gt;track_duration;
+		}
+		
+		function getTrackImage() {
+			return $val = (empty($this-&gt;track_image)) ? null : $this-&gt;track_image;
+		}
+		
+		function getTrackIdentifier() {
+			return $val = (empty($this-&gt;track_identifiers)) ? null : $this-&gt;track_identifiers;
+		}
+		
+		
+		function getTrackInfo() {
+			return $val = (empty($this-&gt;track_info)) ? null : $this-&gt;track_info;
+		}
+		
+		function getTrackMetas() {
+			return $val = (empty($this-&gt;track_metas)) ? null : $this-&gt;track_metas;
+		}
+				
+		function getTrackExtensions() {
+			return $val = (empty($this-&gt;track_extensions)) ? null : $this-&gt;track_extensions;
+		}
+		
+		
+		function getTrackExtensionApplication() {
+			return $val = (empty($this-&gt;track_extension_application)) ? null : $this-&gt;track_extension_application;
+		}
+		
+		function getTrackMetaRel() {
+			return $val = (empty($this-&gt;track_meta_rel)) ? null : $this-&gt;track_meta_rel;
+		}
+		
+		
+		/* get ONE of the possible multiple locations */
+		function getTrackLocation($index = 0) {
+			if(is_array($this-&gt;track_locations) &amp;&amp; sizeof($this-&gt;track_locations) &gt; 0) {
+				return $this-&gt;track_locations[$index];
+			}
+		}
+	}
+
+?&gt;


Property changes on: trunk/inc/external/xspf/class.XSPF_Track.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/inc/marten_kweeries.php
===================================================================
--- trunk/inc/marten_kweeries.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/marten_kweeries.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,507 @@
+&lt;?php
+require_once(&quot;inc/sm-db-settings.php&quot;);
+
+/**
+*   get a specific user by using the optional uname or email or get all users
+*/
+function qGetSignup($uname = &quot;&quot;, $email = &quot;&quot;)
+{
+    if ($uname !=&quot;&quot; &amp;&amp; $email == &quot;&quot;) {    
+    	$query= &quot;SELECT signupID, uname, pwd, email FROM signup WHERE uname = '$uname'&quot;;
+    }else if ($uname ==&quot;&quot; &amp;&amp; $email != &quot;&quot;) {    
+    	$query= &quot;SELECT signupID, uname, pwd, email FROM signup WHERE email = '$email'&quot;;
+    }else if ($uname !=&quot;&quot; &amp;&amp; $email != &quot;&quot;) {    
+    	$query= &quot;SELECT signupID, uname, pwd, email FROM signup WHERE uname = '$uname' AND email = '$email'&quot;;
+    }else {    
+    	$query= &quot;SELECT signupID, uname, pwd, email FROM signup&quot;;
+    }
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetGenre(){
+    $query= &quot;SELECT * FROM genre ORDER BY genre_name&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qInsertSignup($uname,$email,$pwd,$confirm_code)
+{
+    $query= &quot;INSERT INTO signup (uname, email, pwd,confirmcode) VALUES ('$uname', '$email', '$pwd','$confirm_code')&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qCheckCode($uname, $pwd, $code)
+{
+    $query= &quot;SELECT uname, pwd, email,signupdate FROM signup WHERE uname='$uname'&quot;;
+    $query .= &quot; AND pwd='$pwd' AND confirmcode='$code'&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+function qGetUser($uname, $pwd = '')
+{
+    if($pwd =='') {
+        $query= &quot;SELECT uid, uname, user_level FROM user WHERE uname = '$uname'&quot;;
+    } else {
+        $query= &quot;SELECT uid, uname, user_level FROM user WHERE uname = '$uname' AND pwd = '$pwd'&quot;;
+    }
+	//echo $query;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetUserByID($id)
+{
+    $query= &quot;SELECT uname, pwd FROM user WHERE uid = '$id'&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+
+function qInsertUser($uname, $pwd, $email, $homedir, $homedir_checked, $homedir_public, $quotasize, $quotafiles, $signupdate)
+{
+    $query= &quot;INSERT INTO user (uname, email, homedir, homedir_checked, homedir_public, quotasize, quotafiles, pwd, signupdate)&quot;;
+    $query .=&quot; VALUES ('$uname', '$email', '$homedir', '$homedir_checked', '$homedir_public', '$quotasize', '$quotafiles', '$pwd','$signupdate')&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qRemoveSignup($uname, $pwd)
+{
+    $query = &quot;DELETE FROM signup WHERE uname='$uname' AND pwd='$pwd' LIMIT 1&quot;; 
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+function qUpdatePwd($uname,$email,$pwd)
+{
+    $query= &quot;UPDATE user SET pwd='$pwd' WHERE uname='$uname' AND email='$email' LIMIT 1&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+
+}
+
+/**
+* Inserts values into user_profile table
+* $values should be an array. MAKE REALLY SURE no nasty XSS stuff can happen!!!
+*/
+function qInsertProfile($values) {
+    if(is_array($values)) {
+        foreach($values as $key =&gt; $val) {
+            $keystr .= $key .&quot;,&quot;; 
+            $valstr .= &quot;'&quot;.$val.&quot;'&quot; .&quot;,&quot;;
+        }
+        
+        //remove last comma
+        $keystr = rtrim($keystr,&quot;,&quot;);
+        $valstr = rtrim($valstr,&quot;,&quot;);
+        
+        $query = &quot;INSERT into user_profile ($keystr) VALUES ($valstr)&quot;;
+        $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+      //  echo $query;
+        return $q;
+        
+        
+    } else {
+        return false;    
+    }
+    
+}
+
+
+/**
+* Updates values from user_profile table
+* $values should be an array. MAKE REALLY SURE no nasty XSS stuff can happen!!!
+* needs the uid of the to be updated profile 
+*/
+function qUpdateProfile($values) {
+    if(is_array($values)) {
+        foreach($values as $key =&gt; $val) {
+            if($key != 'uid')
+            {
+                $valuestr .= &quot;$key='$val', &quot;; 
+            }
+        }
+        // set user id
+        $uid = $values['uid'];
+        //remove last comma
+        $valuestr = rtrim($valuestr, &quot; ,&quot;);
+        
+        $query = &quot;UPDATE user_profile SET $valuestr WHERE uid='$uid' LIMIT 1&quot;;
+        $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+        //echo $query;
+        return $q;
+        
+        
+    } else {
+        return false;    
+    }
+}
+
+
+function qGetProfileByUID($uid) {
+    $query = &quot;SELECT * FROM user_profile WHERE uid='$uid'&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetUserInfo($uname) {
+    $query= &quot;SELECT * FROM user WHERE uname = '$uname'&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+function qGetAudioByUID($uid) {
+    $query= &quot;SELECT * FROM audio WHERE uid = '$uid'&quot;;
+  // 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetAudioByID($audio_id) {
+    $query= &quot;SELECT * FROM audio WHERE audio_id='$audio_id'&quot;;
+  // 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+
+function qGetMoods() {
+    $query= &quot;SELECT * FROM mood_description&quot;;
+   //	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+
+}
+
+function qGetLicenseByOption($nc, $d) {
+/*   Creative Commons license:
+*   
+*   cclicense[nc]   
+*   cclicense[derative]
+*
+*   nc: 1 [no commericial use]
+*   nc: 0 [commercial use]
+*
+*   derative: 1 [derative us]
+*   derative: 2 [derative under same license]
+*   derative: 0 [no derative]
+*/
+    switch($d) {
+        case 0: 
+            $sa = 0;
+            $nd = 1;
+        break;    
+        case 1:
+            $sa = 0;
+            $nd = 0;
+        break;     
+        case 2:
+            $sa = 1;
+            $nd = 0;
+        break;
+    }
+    
+    $query = &quot;SELECT * FROM cclicense WHERE cclicense_nc='$nc' AND&quot;;
+    $query .=&quot; cclicense_sa='$sa' AND cclicense_nd='$nd' LIMIT 1&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qInsertAudio($genre_id, $license_id, $fileformat, $filepath_hi, $filepath_lo, $fname, $songtitle, $aname, $album, $playtime, $filesize, $uid) {
+    
+    
+    
+    $query .= &quot;INSERT INTO audio (genre_id, cclicense_id, audio_type, audio_hi_path, &quot;;
+    $query .= &quot;audio_lo_path, audio_filename, audio_title, audio_artist, audio_album, audio_playtime, audio_size, uid) &quot;;
+    $query .= &quot;VALUES ('$genre_id', '$license_id', '$fileformat', '$filepath_hi', '$filepath_lo', '$fname',&quot;; 
+    $query .= &quot;'$songtitle', '$aname', '$album', '$playtime','$filesize', '$uid')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertRef($ref_name) {
+	$query = &quot;INSERT INTO reference (reference_name) &quot;;
+	$query .= &quot;VALUES ('$ref_name')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+
+function qInsertTag($tag_name) {
+	$query = &quot;INSERT INTO tag (tag_name) &quot;;
+	$query .= &quot;VALUES ('$tag_name')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertAudioRef($audio_id, $ref_id) {
+	$query = &quot;INSERT INTO audio_reference (audio_id, reference_id) &quot;;
+	$query .= &quot;VALUES ('$audio_id','$ref_id')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertAudioTag($audio_id, $tag_id) {
+	$query = &quot;INSERT INTO audio_tag (audio_id, tag_id) &quot;;
+	$query .= &quot;VALUES ('$audio_id','$tag_id')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qUpdateAudioStatus($status, $id) {
+	$query = &quot;UPDATE audio SET audio_status='$status' &quot;;
+	$query .= &quot;WHERE audio_ID='$id'&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qUpdateAudio($status, $id, $hi_path, $lo_path) {
+	$query = &quot;UPDATE audio SET audio_status='$status', audio_hi_path='$hi_path', &quot;;
+	$query .= &quot;audio_lo_path='$lo_path'WHERE audio_ID='$id'&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertModerationHistory($audio_id, $uid, $status, $description) {
+	$query = &quot;INSERT INTO moderation_history (audio_id, uid, &quot;;
+	$query .= &quot;moderation_status, moderation_description) &quot;;
+	$query .= &quot;VALUES ('$audio_id','$uid','$status','$description')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+
+
+function qInsertMood($mood_id, $mood_value) {
+	$query = &quot;INSERT INTO mood_selection (mood_description_id, mood_selection_value) &quot;;
+	$query .= &quot;VALUES ('$mood_id', '$mood_value')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertAudioMood($audio_id, $mood_id) {
+	$query = &quot;INSERT INTO audio_mood (audio_id, mood_selection_id) &quot;;
+	$query .= &quot;VALUES ('$audio_id','$mood_id')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qGetLatestUsers($max) {
+    $query = &quot;SELECT u.uid, u.uname, p.avatar_path, p.avatar_filename_small&quot;;
+	$query .= &quot; FROM user AS u, user_profile AS p WHERE u.uid = p.uid&quot;;
+	$query .= &quot; ORDER BY u.userdate DESC LIMIT $max&quot;;
+    //echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetUsers($limit, $level) {
+    $query= &quot;SELECT * FROM user WHERE user_level = '$level' ORDER BY uname LIMIT $limit&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+
+}
+	
+
+
+
+
+/**
+*
+*	get the reference_name. The query can be made case-sensitive by
+*	setting the second argument to true
+*/
+function qGetRefByName($name, $case_sensitive = false) {
+	
+	if($case_sensitive) {
+	    $query = &quot;SELECT reference_id FROM reference WHERE BINARY reference_name='$name'&quot;;
+    } else {
+		$query = &quot;SELECT reference_id FROM reference WHERE reference_name='$name'&quot;;
+	}
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+
+
+/**
+*
+*	get the reference_name. The query can be made case-sensitive by
+*	setting the second argument to true
+*/
+function qGetTagByName($name, $case_sensitive = false) {
+	
+	if($case_sensitive) {
+	    $query = &quot;SELECT tag_id FROM tag WHERE BINARY tag_name='$name'&quot;;
+    } else {
+		$query = &quot;SELECT tag_id FROM tag WHERE tag_name='$name'&quot;;
+	}
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qUpdateUserLevelByUID($uid, $level) {
+	$query= &quot;UPDATE user SET user_level='$level' WHERE uid='$uid'&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qInsertModerator($uid, $genre_id) {
+	$query = &quot;INSERT INTO moderator (uid, genre_id) &quot;;
+	$query .= &quot;VALUES ('$uid','$genre_id')&quot;;
+   	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();	
+}
+
+function qGetGenreFromModerator($uid) {
+    $query = &quot;SELECT m.moderator_id, m.genre_id, g.genre_name FROM moderator as m, genre as g &quot;;
+	$query .= &quot;WHERE m.uid ='$uid' AND m.genre_id = g.genre_id&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+   // echo $query;
+    return $q;
+}
+
+function qGetModList($genre_id) {
+	$query = &quot;SELECT a.audio_id, a.audio_title, a.audio_filename,&quot;; 
+	$query .= &quot; a.audio_hi_path, a.audio_lo_path FROM audio as a&quot;;
+	$query .= &quot; WHERE a.genre_id = '$genre_id'&quot;; 
+	$query .= &quot; AND audio_status='info_available'&quot;;
+   	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;	
+}
+
+// Marten's probeersels //////////////////////////////////////////////////////////////////////////////////////
+
+
+
+function qGetAudioByGenre($genre_id){
+    $query= &quot;SELECT a.audio_id, a.audio_title, a.audio_artist, a.audio_hi_path, a.cclicense_id, u.uname,  c.cclicense_image_path FROM audio AS a, user AS u, cclicense AS c WHERE genre_id='$genre_id' AND a.cclicense_id = c.cclicense_id AND u.uid = a.uid AND audio_status='public' ORDER BY audio_id DESC LIMIT 10&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetLatestAudio(){
+    $query= &quot;SELECT a.audio_id, a.audio_title, a.audio_artist, a.audio_hi_path, u.uname FROM audio AS a, user AS u WHERE audio_status='public' AND u.uid = a.uid ORDER BY audio_id DESC LIMIT 10&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetLatestAudioFromArtist($uid){
+    $query= &quot;SELECT a.audio_id, a.audio_title, a.audio_artist, a.audio_hi_path, u.uname FROM audio AS a, user AS u WHERE audio_status='public' AND u.uid = '$uid' AND u.uid = a.uid ORDER BY audio_id DESC LIMIT 1&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetAllArtists(){
+    $query= &quot;SELECT DISTINCT(a.audio_artist), a.uid, u.uid, u.uname, p.location FROM audio AS a, user AS u, user_profile AS p WHERE a.uid = u.uid AND u.uid = p.uid AND audio_status='public' ORDER BY audio_artist ASC&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetArtistByGenre($genre_id){
+    $query= &quot;SELECT DISTINCT(a.audio_artist), a.uid, u.uid, u.uname, p.location, g.genre_omschrijving, g.genre_name, g.genre_img  FROM audio AS a, user AS u, genre AS g, user_profile AS p WHERE g.genre_id='$genre_id' AND g.genre_id = a.genre_id AND a.uid = u.uid AND u.uid = p.uid AND audio_status='public' ORDER BY audio_artist DESC&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetLatestArtistByGenre($genre_id) {
+    $query = &quot;SELECT DISTINCT(a.uid), a.audio_artist, p.avatar_path, p.avatar_filename_small, u.uid, u.uname&quot;;
+	$query .= &quot; FROM audio AS a, user_profile AS p, user AS u WHERE a.uid = p.uid AND a.uid = u.uid AND a.genre_id='$genre_id'&quot;;
+	$query .= &quot; ORDER BY u.userdate ASC LIMIT 4&quot;;
+    //echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetPublicAudioByUID($uid) {
+    $query= &quot;SELECT a.cclicense_id, a.audio_hi_path, a.audio_title, a.audio_artist, a.audio_id, a.audio_album, a.audio_size, c.cclicense_image_path FROM audio AS a, cclicense AS c WHERE a.uid = '$uid' AND a.audio_status='public' AND a.cclicense_id = c.cclicense_id ORDER BY a.audio_id DESC&quot;;
+  // 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetCheckedAudioByUID($uid) {
+    $query= &quot;SELECT * FROM audio WHERE uid = '$uid' ANd audio_status='undefined'&quot;;
+  // 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetWaitingAudioByUID($uid) {
+    $query= &quot;SELECT * FROM audio WHERE uid = '$uid' AND audio_status='info_available'&quot;;
+  // 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+/**
+*	get the tag name by audio ID. 
+*/
+
+function qGetTagByAudioID($audio_id) {	
+	$query = &quot;SELECT t.tag_name FROM audio_tag AS a, tag AS t &quot;;
+	$query .= &quot; WHERE a.audio_id = '$audio_id' AND a.tag_id = t.tag_id&quot;;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetGenreByAudioID($audio_id) {	
+	$query = &quot;SELECT DISTINCT(g.genre_name), g.genre_id FROM audio AS a, genre AS g &quot;;
+	$query .= &quot; WHERE a.audio_id = '$audio_id' AND a.genre_id = g.genre_id&quot;;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetAllUsers() {
+    $query= &quot;SELECT u.uname, p.location FROM user as u, user_profile as p WHERE u.uid = p.uid ORDER BY uname&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetArtistInfoByUID($uid) {
+	$query = &quot;SELECT  p.avatar_path, p.avatar_filename_small, p.bio, u.uid, u.uname&quot;;
+	$query .= &quot; FROM user_profile AS p, user AS u WHERE u.uid = '$uid' AND p.uid = u.uid&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+?&gt;

Added: trunk/inc/sm-db-queries.php
===================================================================
--- trunk/inc/sm-db-queries.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/sm-db-queries.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,645 @@
+&lt;?php
+require_once(&quot;inc/sm-db-settings.php&quot;);
+
+/**
+*   get a specific user by using the optional uname or email or get all users
+*/
+function qGetSignup($uname = &quot;&quot;, $email = &quot;&quot;)
+{
+    if ($uname !=&quot;&quot; &amp;&amp; $email == &quot;&quot;) {    
+    	$query= &quot;SELECT signupID, uname, pwd, email FROM signup WHERE uname = '$uname'&quot;;
+    }else if ($uname ==&quot;&quot; &amp;&amp; $email != &quot;&quot;) {    
+    	$query= &quot;SELECT signupID, uname, pwd, email FROM signup WHERE email = '$email'&quot;;
+    }else if ($uname !=&quot;&quot; &amp;&amp; $email != &quot;&quot;) {    
+    	$query= &quot;SELECT signupID, uname, pwd, email FROM signup WHERE uname = '$uname' AND email = '$email'&quot;;
+    }else {    
+    	$query= &quot;SELECT signupID, uname, pwd, email FROM signup&quot;;
+    }
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetGenre(){
+    $query= &quot;SELECT * FROM genre ORDER BY genre_name&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+function qInsertSignup($uname,$email,$pwd,$confirm_code)
+{
+    $query= &quot;INSERT INTO signup (uname, email, pwd,confirmcode) VALUES ('$uname', '$email', '$pwd','$confirm_code')&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qCheckCode($uname, $pwd, $code)
+{
+    $query= &quot;SELECT uname, pwd, email,signupdate FROM signup WHERE uname='$uname'&quot;;
+    $query .= &quot; AND pwd='$pwd' AND confirmcode='$code'&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+function qGetUser($uname, $pwd = '')
+{
+    if($pwd =='') {
+        $query= &quot;SELECT uid, uname, user_level FROM user WHERE uname = '$uname'&quot;;
+    } else {
+        $query= &quot;SELECT uid, uname, user_level FROM user WHERE uname = '$uname' AND pwd = '$pwd'&quot;;
+    }
+	//echo $query;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetUserByID($id)
+{
+    $query= &quot;SELECT uname, pwd FROM user WHERE uid = '$id'&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+
+function qInsertUser($uname, $pwd, $email, $homedir, $homedir_checked, $homedir_public, $quotasize, $quotafiles, $signupdate)
+{
+    $query= &quot;INSERT INTO user (uname, email, homedir, homedir_checked, homedir_public, quotasize, quotafiles, pwd, signupdate)&quot;;
+    $query .=&quot; VALUES ('$uname', '$email', '$homedir', '$homedir_checked', '$homedir_public', '$quotasize', '$quotafiles', '$pwd','$signupdate')&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qRemoveSignup($uname, $pwd)
+{
+    $query = &quot;DELETE FROM signup WHERE uname='$uname' AND pwd='$pwd' LIMIT 1&quot;; 
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+function qUpdatePwd($uname,$email,$pwd)
+{
+    $query= &quot;UPDATE user SET pwd='$pwd' WHERE uname='$uname' AND email='$email' LIMIT 1&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qUpdateUserSettings($values)
+{
+      if(is_array($values)) {
+        foreach($values as $key =&gt; $val) {
+            if($key != 'uname')
+            {
+                $valuestr .= &quot;$key='$val', &quot;; 
+            }
+        }
+        // set user id
+        $uname = $values['uname'];
+        //remove last comma
+        $valuestr = rtrim($valuestr, &quot; ,&quot;);
+        
+        $query = &quot;UPDATE user SET $valuestr WHERE uname='$uname' LIMIT 1&quot;;
+        $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+        echo $query;
+        return $q;
+    } else {
+        return false;    
+    }
+}
+
+
+
+/**
+* Inserts values into user_profile table
+* $values should be an array. MAKE REALLY SURE no nasty XSS stuff can happen!!!
+*/
+function qInsertProfile($values) {
+    if(is_array($values)) {
+        foreach($values as $key =&gt; $val) {
+            $keystr .= $key .&quot;,&quot;; 
+            $valstr .= &quot;'&quot;.$val.&quot;'&quot; .&quot;,&quot;;
+        }
+        
+        //remove last comma
+        $keystr = rtrim($keystr,&quot;,&quot;);
+        $valstr = rtrim($valstr,&quot;,&quot;);
+        
+        $query = &quot;INSERT into user_profile ($keystr) VALUES ($valstr)&quot;;
+        $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+      //  echo $query;
+        return $q;
+        
+        
+    } else {
+        return false;    
+    }
+    
+}
+
+/**
+*
+* Insert values into playlist table
+*
+*/
+function qInsertPlaylist($values) {
+	if(is_array($values)) {
+        foreach($values as $key =&gt; $val) {
+            $keystr .= $key .&quot;,&quot;; 
+            $valstr .= &quot;'&quot;.$val.&quot;'&quot; .&quot;,&quot;;
+        }
+        
+        //remove last comma
+        $keystr = rtrim($keystr,&quot;,&quot;);
+        $valstr = rtrim($valstr,&quot;,&quot;);
+        
+        $query = &quot;INSERT into playlist ($keystr) VALUES ($valstr)&quot;;
+        $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+        //echo $query;
+        return mysql_insert_id();;
+    } else {
+        return false;    
+    }
+}
+
+function qInsertAudioInPlaylist($playlist_id, $audio_id) {
+    $query= &quot;INSERT INTO playlist_audio (playlist_id, audio_id)&quot;;
+    $query .=&quot; VALUES ('$playlist_id', '$audio_id')&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+
+/**
+* query selects randomly $limit amount of rows
+* with the following constrains:
+* 
+* [1] audio_status must be public
+* [2] audio_id is NOT on blacklist (TODO!!!)
+*/
+function qGenerateRndPlaylist($limit = 50) {
+	$query = &quot;SELECT a.audio_id, a.audio_title, a.audio_artist, a.audio_playtime, &quot;; 
+	$query .= &quot;a.audio_hi_path, a.uid, c.cclicense_name, c.cclicense_by, c.cclicense_commercial, &quot;;
+	$query .= &quot;c.cclicense_derative, c.cclicense_human_url, u.avatar_path, u.avatar_filename_small &quot;;
+	$query .= &quot;FROM audio as a, cclicense as c, user_profile as u &quot;;
+	$query .= &quot;WHERE a.audio_status = 'public' &quot;;
+	$query .= &quot;AND a.cclicense_id = c.cclicense_id &quot;; 
+	$query .= &quot;AND a.uid = u.uid &quot;;
+	$query .= &quot;ORDER BY RAND() limit $limit &quot;;
+	//	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+
+function qGetAllPlaylists() {
+    $query= &quot;SELECT DISTINCT p.playlist_id, p.playlist_title, p.playlist_path FROM playlist as p,playlist_audio as a &quot;;
+	$query .=&quot;WHERE p.playlist_id=a.playlist_id&quot;;
+	// 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+ 
+
+
+
+/**
+* Updates values from user_profile table
+* $values should be an array. MAKE REALLY SURE no nasty XSS stuff can happen!!!
+* needs the uid of the to be updated profile 
+*/
+function qUpdateProfile($values) {
+    if(is_array($values)) {
+        foreach($values as $key =&gt; $val) {
+            if($key != 'uid')
+            {
+                $valuestr .= &quot;$key='$val', &quot;; 
+            }
+        }
+        // set user id
+        $uid = $values['uid'];
+        //remove last comma
+        $valuestr = rtrim($valuestr, &quot; ,&quot;);
+        
+        $query = &quot;UPDATE user_profile SET $valuestr WHERE uid='$uid' LIMIT 1&quot;;
+        $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+        //echo $query;
+        return $q;
+        
+        
+    } else {
+        return false;    
+    }
+}
+
+
+function qGetProfileByUID($uid) {
+    $query = &quot;SELECT * FROM user_profile WHERE uid='$uid'&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetUserInfo($uname) {
+    $query= &quot;SELECT * FROM user WHERE uname = '$uname'&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+function qGetAudioByUID($uid) {
+    $query= &quot;SELECT * FROM audio WHERE uid = '$uid'&quot;;
+  // 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetAudioByID($audio_id) {
+    $query= &quot;SELECT a.uid, a.audio_id, a.audio_title, a.audio_artist, a.audio_hi_path, a.audio_lo_path, a.audio_filename, u.uname FROM audio AS a, user AS u WHERE audio_id='$audio_id' AND u.uid = a.uid&quot;;
+  // 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetPlaylistByUID($user_id) {
+    $query= &quot;SELECT * FROM playlist WHERE user_id='$user_id'&quot;;
+	// 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+
+
+function qGetMoods() {
+    $query= &quot;SELECT * FROM mood_description&quot;;
+   //	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+
+}
+
+function qGetLicenseByOption($c, $d) {
+/*   Creative Commons license:
+*   
+*   cclicense[commercial]   
+*   cclicense[derative]
+*
+*   commercial: 0 [no commericial use]
+*   commercial: 1 [commercial use]
+*
+*   derative: 1 [derative us]
+*   derative: 2 [derative under same license]
+*   derative: 0 [no derative]
+*/
+    
+    $query = &quot;SELECT * FROM cclicense WHERE cclicense_commercial='$c' AND&quot;;
+    $query .=&quot; cclicense_derative='$d' LIMIT 1&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qInsertAudio($genre_id, $license_id, $fileformat, $filepath_hi, $filepath_lo, $fname, $songtitle, $aname, $album, $playtime, $filesize, $uid) {
+    
+    
+    
+    $query .= &quot;INSERT INTO audio (genre_id, cclicense_id, audio_type, audio_hi_path, &quot;;
+    $query .= &quot;audio_lo_path, audio_filename, audio_title, audio_artist, audio_album, audio_playtime, audio_size, uid) &quot;;
+    $query .= &quot;VALUES ('$genre_id', '$license_id', '$fileformat', '$filepath_hi', '$filepath_lo', '$fname',&quot;; 
+    $query .= &quot;'$songtitle', '$aname', '$album', '$playtime','$filesize', '$uid')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertRef($ref_name) {
+	$query = &quot;INSERT INTO reference (reference_name) &quot;;
+	$query .= &quot;VALUES ('$ref_name')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+
+function qInsertTag($tag_name) {
+	$query = &quot;INSERT INTO tag (tag_name) &quot;;
+	$query .= &quot;VALUES ('$tag_name')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertAudioRef($audio_id, $ref_id) {
+	$query = &quot;INSERT INTO audio_reference (audio_id, reference_id) &quot;;
+	$query .= &quot;VALUES ('$audio_id','$ref_id')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertAudioTag($audio_id, $tag_id) {
+	$query = &quot;INSERT INTO audio_tag (audio_id, tag_id) &quot;;
+	$query .= &quot;VALUES ('$audio_id','$tag_id')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qUpdateAudioStatus($status, $id) {
+	$query = &quot;UPDATE audio SET audio_status='$status' &quot;;
+	$query .= &quot;WHERE audio_ID='$id'&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qUpdateAudio($status, $id, $hi_path, $lo_path) {
+	$query = &quot;UPDATE audio SET audio_status='$status', audio_hi_path='$hi_path', &quot;;
+	$query .= &quot;audio_lo_path='$lo_path'WHERE audio_ID='$id'&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertModerationHistory($audio_id, $uid, $status, $description) {
+	$query = &quot;INSERT INTO moderation_history (audio_id, uid, &quot;;
+	$query .= &quot;moderation_status, moderation_description) &quot;;
+	$query .= &quot;VALUES ('$audio_id','$uid','$status','$description')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+
+
+function qInsertMood($mood_id, $mood_value) {
+	$query = &quot;INSERT INTO mood_selection (mood_description_id, mood_selection_value) &quot;;
+	$query .= &quot;VALUES ('$mood_id', '$mood_value')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertAudioMood($audio_id, $mood_id) {
+	$query = &quot;INSERT INTO audio_mood (audio_id, mood_selection_id) &quot;;
+	$query .= &quot;VALUES ('$audio_id','$mood_id')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qGetLatestUsers($max) {
+    $query = &quot;SELECT u.uid, u.uname, p.avatar_path, p.avatar_filename_small&quot;;
+	$query .= &quot; FROM user AS u, user_profile AS p WHERE u.uid = p.uid&quot;;
+	$query .= &quot; ORDER BY u.userdate DESC LIMIT $max&quot;;
+    //echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetUsers($limit, $level) {
+    $query= &quot;SELECT * FROM user WHERE user_level = '$level' ORDER BY uname LIMIT $limit&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+
+}
+	
+
+
+
+
+/**
+*
+*	get the reference_name. The query can be made case-sensitive by
+*	setting the second argument to true
+*/
+function qGetRefByName($name, $case_sensitive = false) {
+	
+	if($case_sensitive) {
+	    $query = &quot;SELECT reference_id FROM reference WHERE BINARY reference_name='$name'&quot;;
+    } else {
+		$query = &quot;SELECT reference_id FROM reference WHERE reference_name='$name'&quot;;
+	}
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+
+
+/**
+*
+*	get the reference_name. The query can be made case-sensitive by
+*	setting the second argument to true
+*/
+function qGetTagByName($name, $case_sensitive = false) {
+	
+	if($case_sensitive) {
+	    $query = &quot;SELECT tag_id FROM tag WHERE BINARY tag_name='$name'&quot;;
+    } else {
+		$query = &quot;SELECT tag_id FROM tag WHERE tag_name='$name'&quot;;
+	}
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qUpdateUserLevelByUID($uid, $level) {
+	$query= &quot;UPDATE user SET user_level='$level' WHERE uid='$uid'&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qInsertModerator($uid, $genre_id) {
+	$query = &quot;INSERT INTO moderator (uid, genre_id) &quot;;
+	$query .= &quot;VALUES ('$uid','$genre_id')&quot;;
+   	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();	
+}
+
+function qGetGenreFromModerator($uid) {
+    $query = &quot;SELECT m.moderator_id, m.genre_id, g.genre_name FROM moderator as m, genre as g &quot;;
+	$query .= &quot;WHERE m.uid ='$uid' AND m.genre_id = g.genre_id&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+   // echo $query;
+    return $q;
+}
+
+function qGetModList($genre_id) {
+	$query = &quot;SELECT a.audio_id, a.audio_title, a.audio_filename,&quot;; 
+	$query .= &quot; a.audio_hi_path, a.audio_lo_path FROM audio as a&quot;;
+	$query .= &quot; WHERE a.genre_id = '$genre_id'&quot;; 
+	$query .= &quot; AND audio_status='info_available'&quot;;
+   	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;	
+
+
+}
+
+
+function qGetTagsIncUsage() {
+	$query = &quot;SELECT t.tag_id, t.tag_name, COUNT(*) &quot;;
+	$query .= &quot;FROM tag as t, audio_tag as a &quot;;
+	$query .= &quot;WHERE t.tag_id = a.tag_id &quot;;
+	$query .= &quot;GROUP BY t.tag_name&quot;; 
+	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;	
+}
+
+
+
+function qGetAllTags() {
+	$query = &quot;SELECT t.tag_id, t.tag_name FROM tag as t, audio_tag AS at, audio AS a WHERE at.tag_id = t.tag_id AND at.audio_id = a.audio_id AND a.audio_status = 'public'&quot;; 
+	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;	
+}
+
+
+/* returns the amount of times the specific tag is used */
+function qGetUsageOfTagByID($tag_id) {
+	$query = &quot;SELECT COUNT(tag_id) FROM audio_tag WHERE tag_id ='$tag_id'&quot;; 
+	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+/* returns the amount of times the specific tag is used */
+function qGetAudioIDByTagID($tag_id) {
+	$query = &quot;SELECT audio_id FROM audio_tag WHERE tag_id ='$tag_id'&quot;; 
+	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+// Marten's probeersels //////////////////////////////////////////////////////////////////////////////////////
+
+
+
+function qGetAudioByGenre($genre_id){
+    $query= &quot;SELECT a.audio_id, a.audio_title, a.audio_artist, a.audio_hi_path, a.cclicense_id, u.uname,  c.cclicense_image_path FROM audio AS a, user AS u, cclicense AS c WHERE genre_id='$genre_id' AND a.cclicense_id = c.cclicense_id AND u.uid = a.uid AND audio_status='public' ORDER BY audio_id DESC LIMIT 10&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetLatestAudio(){
+    $query= &quot;SELECT a.audio_id, a.audio_title, a.audio_artist, a.audio_hi_path, u.uname FROM audio AS a, user AS u WHERE audio_status='public' AND u.uid = a.uid ORDER BY audio_id DESC LIMIT 10&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetLatestAudioAndInfo(){
+    $query= &quot;SELECT a.audio_id, a.audio_title, a.audio_artist, a.audio_size, a.audio_hi_path, a.cclicense_id, u.uname, c.cclicense_image_path, c.cclicense_human_url, g.genre_name FROM audio AS a, user AS u, cclicense AS c, genre AS g WHERE audio_status='public' AND g.genre_id = a.genre_id AND a.cclicense_id = c.cclicense_id AND u.uid = a.uid ORDER BY audio_id DESC LIMIT 20&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetLatestAudioFromArtist($uid){
+    $query= &quot;SELECT a.audio_id, a.audio_title, a.audio_artist, a.audio_hi_path, u.uname FROM audio AS a, user AS u WHERE audio_status='public' AND u.uid = '$uid' AND u.uid = a.uid ORDER BY audio_id DESC LIMIT 1&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetAllArtists(){
+    $query= &quot;SELECT DISTINCT(a.audio_artist), a.uid, u.uid, u.uname, p.location FROM audio AS a, user AS u, user_profile AS p WHERE a.uid = u.uid AND u.uid = p.uid AND audio_status='public' ORDER BY audio_artist ASC&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetArtistByGenre($genre_id){
+    $query= &quot;SELECT DISTINCT(a.audio_artist), a.uid, u.uid, u.uname, p.location FROM audio AS a, user AS u, genre AS g, user_profile AS p WHERE g.genre_id='$genre_id' AND g.genre_id = a.genre_id AND a.uid = u.uid AND u.uid = p.uid AND audio_status='public' ORDER BY audio_artist DESC&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetLatestArtistByGenre($genre_id) {
+    $query = &quot;SELECT DISTINCT(a.uid), a.audio_artist, p.avatar_path, p.avatar_filename_small, u.uid, u.uname&quot;;
+	$query .= &quot; FROM audio AS a, user_profile AS p, user AS u WHERE a.uid = p.uid AND a.uid = u.uid AND a.genre_id='$genre_id' AND audio_status='public'&quot;;
+	$query .= &quot; ORDER BY u.userdate DESC LIMIT 4&quot;;
+    //echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetPublicAudioByUID($uid) {
+    $query= &quot;SELECT a.cclicense_id, a.audio_hi_path, a.audio_title, a.audio_artist, a.audio_id, a.audio_album, a.audio_size, c.cclicense_image_path FROM audio AS a, cclicense AS c WHERE a.uid = '$uid' AND a.audio_status='public' AND a.cclicense_id = c.cclicense_id ORDER BY a.audio_id DESC&quot;;
+  // 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetCheckedAudioByUID($uid) {
+    $query= &quot;SELECT * FROM audio WHERE uid = '$uid' ANd audio_status='undefined'&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetWaitingAudioByUID($uid) {
+    $query= &quot;SELECT * FROM audio WHERE uid = '$uid' AND audio_status='info_available'&quot;;
+  // 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+/**
+*	get the tag name by audio ID. 
+*/
+
+function qGetTagByAudioID($audio_id) {	
+	$query = &quot;SELECT t.tag_name FROM audio_tag AS a, tag AS t &quot;;
+	$query .= &quot; WHERE a.audio_id = '$audio_id' AND a.tag_id = t.tag_id&quot;;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetGenreByAudioID($audio_id) {	
+	$query = &quot;SELECT DISTINCT(g.genre_name), g.genre_id FROM audio AS a, genre AS g &quot;;
+	$query .= &quot; WHERE a.audio_id = '$audio_id' AND a.genre_id = g.genre_id&quot;;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetAllUsers() {
+    $query= &quot;SELECT u.uname, p.location FROM user as u, user_profile as p WHERE u.uid = p.uid ORDER BY uname&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetArtistInfoByUID($uid) {
+	$query = &quot;SELECT  p.avatar_path, p.avatar_filename_small, p.bio, u.uid, u.uname&quot;;
+	$query .= &quot; FROM user_profile AS p, user AS u WHERE u.uid = '$uid' AND p.uid = u.uid&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetGenreByID($genre_id){
+    $query= &quot;SELECT * FROM genre WHERE genre_id='$genre_id' ORDER BY genre_name&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+?&gt;

Added: trunk/inc/sm-db-queries_backup.php
===================================================================
--- trunk/inc/sm-db-queries_backup.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/sm-db-queries_backup.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,645 @@
+&lt;?php
+require_once(&quot;inc/sm-db-settings.php&quot;);
+
+/**
+*   get a specific user by using the optional uname or email or get all users
+*/
+function qGetSignup($uname = &quot;&quot;, $email = &quot;&quot;)
+{
+    if ($uname !=&quot;&quot; &amp;&amp; $email == &quot;&quot;) {    
+    	$query= &quot;SELECT signupID, uname, pwd, email FROM signup WHERE uname = '$uname'&quot;;
+    }else if ($uname ==&quot;&quot; &amp;&amp; $email != &quot;&quot;) {    
+    	$query= &quot;SELECT signupID, uname, pwd, email FROM signup WHERE email = '$email'&quot;;
+    }else if ($uname !=&quot;&quot; &amp;&amp; $email != &quot;&quot;) {    
+    	$query= &quot;SELECT signupID, uname, pwd, email FROM signup WHERE uname = '$uname' AND email = '$email'&quot;;
+    }else {    
+    	$query= &quot;SELECT signupID, uname, pwd, email FROM signup&quot;;
+    }
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetGenre(){
+    $query= &quot;SELECT * FROM genre ORDER BY genre_name&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+function qInsertSignup($uname,$email,$pwd,$confirm_code)
+{
+    $query= &quot;INSERT INTO signup (uname, email, pwd,confirmcode) VALUES ('$uname', '$email', '$pwd','$confirm_code')&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qCheckCode($uname, $pwd, $code)
+{
+    $query= &quot;SELECT uname, pwd, email,signupdate FROM signup WHERE uname='$uname'&quot;;
+    $query .= &quot; AND pwd='$pwd' AND confirmcode='$code'&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+function qGetUser($uname, $pwd = '')
+{
+    if($pwd =='') {
+        $query= &quot;SELECT uid, uname, user_level FROM user WHERE uname = '$uname'&quot;;
+    } else {
+        $query= &quot;SELECT uid, uname, user_level FROM user WHERE uname = '$uname' AND pwd = '$pwd'&quot;;
+    }
+	//echo $query;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetUserByID($id)
+{
+    $query= &quot;SELECT uname, pwd FROM user WHERE uid = '$id'&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+
+function qInsertUser($uname, $pwd, $email, $homedir, $homedir_checked, $homedir_public, $quotasize, $quotafiles, $signupdate)
+{
+    $query= &quot;INSERT INTO user (uname, email, homedir, homedir_checked, homedir_public, quotasize, quotafiles, pwd, signupdate)&quot;;
+    $query .=&quot; VALUES ('$uname', '$email', '$homedir', '$homedir_checked', '$homedir_public', '$quotasize', '$quotafiles', '$pwd','$signupdate')&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qRemoveSignup($uname, $pwd)
+{
+    $query = &quot;DELETE FROM signup WHERE uname='$uname' AND pwd='$pwd' LIMIT 1&quot;; 
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+function qUpdatePwd($uname,$email,$pwd)
+{
+    $query= &quot;UPDATE user SET pwd='$pwd' WHERE uname='$uname' AND email='$email' LIMIT 1&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qUpdateUserSettings($values)
+{
+      if(is_array($values)) {
+        foreach($values as $key =&gt; $val) {
+            if($key != 'uname')
+            {
+                $valuestr .= &quot;$key='$val', &quot;; 
+            }
+        }
+        // set user id
+        $uname = $values['uname'];
+        //remove last comma
+        $valuestr = rtrim($valuestr, &quot; ,&quot;);
+        
+        $query = &quot;UPDATE user SET $valuestr WHERE uname='$uname' LIMIT 1&quot;;
+        $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+        echo $query;
+        return $q;
+    } else {
+        return false;    
+    }
+}
+
+
+
+/**
+* Inserts values into user_profile table
+* $values should be an array. MAKE REALLY SURE no nasty XSS stuff can happen!!!
+*/
+function qInsertProfile($values) {
+    if(is_array($values)) {
+        foreach($values as $key =&gt; $val) {
+            $keystr .= $key .&quot;,&quot;; 
+            $valstr .= &quot;'&quot;.$val.&quot;'&quot; .&quot;,&quot;;
+        }
+        
+        //remove last comma
+        $keystr = rtrim($keystr,&quot;,&quot;);
+        $valstr = rtrim($valstr,&quot;,&quot;);
+        
+        $query = &quot;INSERT into user_profile ($keystr) VALUES ($valstr)&quot;;
+        $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+      //  echo $query;
+        return $q;
+        
+        
+    } else {
+        return false;    
+    }
+    
+}
+
+/**
+*
+* Insert values into playlist table
+*
+*/
+function qInsertPlaylist($values) {
+	if(is_array($values)) {
+        foreach($values as $key =&gt; $val) {
+            $keystr .= $key .&quot;,&quot;; 
+            $valstr .= &quot;'&quot;.$val.&quot;'&quot; .&quot;,&quot;;
+        }
+        
+        //remove last comma
+        $keystr = rtrim($keystr,&quot;,&quot;);
+        $valstr = rtrim($valstr,&quot;,&quot;);
+        
+        $query = &quot;INSERT into playlist ($keystr) VALUES ($valstr)&quot;;
+        $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+        //echo $query;
+        return mysql_insert_id();;
+    } else {
+        return false;    
+    }
+}
+
+function qInsertAudioInPlaylist($playlist_id, $audio_id) {
+    $query= &quot;INSERT INTO playlist_audio (playlist_id, audio_id)&quot;;
+    $query .=&quot; VALUES ('$playlist_id', '$audio_id')&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+
+/**
+* query selects randomly $limit amount of rows
+* with the following constrains:
+* 
+* [1] audio_status must be public
+* [2] audio_id is NOT on blacklist (TODO!!!)
+*/
+function qGenerateRndPlaylist($limit = 50) {
+	$query = &quot;SELECT a.audio_id, a.audio_title, a.audio_artist, a.audio_playtime, &quot;; 
+	$query .= &quot;a.audio_hi_path, a.uid, c.cclicense_name, c.cclicense_by, c.cclicense_commercial, &quot;;
+	$query .= &quot;c.cclicense_derative, c.cclicense_human_url, u.avatar_path, u.avatar_filename_small &quot;;
+	$query .= &quot;FROM audio as a, cclicense as c, user_profile as u &quot;;
+	$query .= &quot;WHERE a.audio_status = 'public' &quot;;
+	$query .= &quot;AND a.cclicense_id = c.cclicense_id &quot;; 
+	$query .= &quot;AND a.uid = u.uid &quot;;
+	$query .= &quot;ORDER BY RAND() limit $limit &quot;;
+	//	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+
+function qGetAllPlaylists() {
+    $query= &quot;SELECT DISTINCT p.playlist_id, p.playlist_title, p.playlist_path FROM playlist as p,playlist_audio as a &quot;;
+	$query .=&quot;WHERE p.playlist_id=a.playlist_id&quot;;
+	// 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+ 
+
+
+
+/**
+* Updates values from user_profile table
+* $values should be an array. MAKE REALLY SURE no nasty XSS stuff can happen!!!
+* needs the uid of the to be updated profile 
+*/
+function qUpdateProfile($values) {
+    if(is_array($values)) {
+        foreach($values as $key =&gt; $val) {
+            if($key != 'uid')
+            {
+                $valuestr .= &quot;$key='$val', &quot;; 
+            }
+        }
+        // set user id
+        $uid = $values['uid'];
+        //remove last comma
+        $valuestr = rtrim($valuestr, &quot; ,&quot;);
+        
+        $query = &quot;UPDATE user_profile SET $valuestr WHERE uid='$uid' LIMIT 1&quot;;
+        $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+        //echo $query;
+        return $q;
+        
+        
+    } else {
+        return false;    
+    }
+}
+
+
+function qGetProfileByUID($uid) {
+    $query = &quot;SELECT * FROM user_profile WHERE uid='$uid'&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetUserInfo($uname) {
+    $query= &quot;SELECT * FROM user WHERE uname = '$uname'&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+function qGetAudioByUID($uid) {
+    $query= &quot;SELECT * FROM audio WHERE uid = '$uid'&quot;;
+  // 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetAudioByID($audio_id) {
+    $query= &quot;SELECT a.uid, a.audio_id, a.audio_title, a.audio_artist, a.audio_hi_path, a.audio_lo_path, a.audio_filename, u.uname FROM audio AS a, user AS u WHERE audio_id='$audio_id' AND u.uid = a.uid&quot;;
+  // 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetPlaylistByUID($user_id) {
+    $query= &quot;SELECT * FROM playlist WHERE user_id='$user_id'&quot;;
+	// 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+
+
+
+function qGetMoods() {
+    $query= &quot;SELECT * FROM mood_description&quot;;
+   //	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+
+}
+
+function qGetLicenseByOption($c, $d) {
+/*   Creative Commons license:
+*   
+*   cclicense[commercial]   
+*   cclicense[derative]
+*
+*   commercial: 0 [no commericial use]
+*   commercial: 1 [commercial use]
+*
+*   derative: 1 [derative us]
+*   derative: 2 [derative under same license]
+*   derative: 0 [no derative]
+*/
+    
+    $query = &quot;SELECT * FROM cclicense WHERE cclicense_commercial='$c' AND&quot;;
+    $query .=&quot; cclicense_derative='$d' LIMIT 1&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qInsertAudio($genre_id, $license_id, $fileformat, $filepath_hi, $filepath_lo, $fname, $songtitle, $aname, $album, $playtime, $filesize, $uid) {
+    
+    
+    
+    $query .= &quot;INSERT INTO audio (genre_id, cclicense_id, audio_type, audio_hi_path, &quot;;
+    $query .= &quot;audio_lo_path, audio_filename, audio_title, audio_artist, audio_album, audio_playtime, audio_size, uid) &quot;;
+    $query .= &quot;VALUES ('$genre_id', '$license_id', '$fileformat', '$filepath_hi', '$filepath_lo', '$fname',&quot;; 
+    $query .= &quot;'$songtitle', '$aname', '$album', '$playtime','$filesize', '$uid')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertRef($ref_name) {
+	$query = &quot;INSERT INTO reference (reference_name) &quot;;
+	$query .= &quot;VALUES ('$ref_name')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+
+function qInsertTag($tag_name) {
+	$query = &quot;INSERT INTO tag (tag_name) &quot;;
+	$query .= &quot;VALUES ('$tag_name')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertAudioRef($audio_id, $ref_id) {
+	$query = &quot;INSERT INTO audio_reference (audio_id, reference_id) &quot;;
+	$query .= &quot;VALUES ('$audio_id','$ref_id')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertAudioTag($audio_id, $tag_id) {
+	$query = &quot;INSERT INTO audio_tag (audio_id, tag_id) &quot;;
+	$query .= &quot;VALUES ('$audio_id','$tag_id')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qUpdateAudioStatus($status, $id) {
+	$query = &quot;UPDATE audio SET audio_status='$status' &quot;;
+	$query .= &quot;WHERE audio_ID='$id'&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qUpdateAudio($status, $id, $hi_path, $lo_path) {
+	$query = &quot;UPDATE audio SET audio_status='$status', audio_hi_path='$hi_path', &quot;;
+	$query .= &quot;audio_lo_path='$lo_path'WHERE audio_ID='$id'&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertModerationHistory($audio_id, $uid, $status, $description) {
+	$query = &quot;INSERT INTO moderation_history (audio_id, uid, &quot;;
+	$query .= &quot;moderation_status, moderation_description) &quot;;
+	$query .= &quot;VALUES ('$audio_id','$uid','$status','$description')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+
+
+function qInsertMood($mood_id, $mood_value) {
+	$query = &quot;INSERT INTO mood_selection (mood_description_id, mood_selection_value) &quot;;
+	$query .= &quot;VALUES ('$mood_id', '$mood_value')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qInsertAudioMood($audio_id, $mood_id) {
+	$query = &quot;INSERT INTO audio_mood (audio_id, mood_selection_id) &quot;;
+	$query .= &quot;VALUES ('$audio_id','$mood_id')&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();
+}
+
+function qGetLatestUsers($max) {
+    $query = &quot;SELECT u.uid, u.uname, p.avatar_path, p.avatar_filename_small&quot;;
+	$query .= &quot; FROM user AS u, user_profile AS p WHERE u.uid = p.uid&quot;;
+	$query .= &quot; ORDER BY u.userdate DESC LIMIT $max&quot;;
+    //echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetUsers($limit, $level) {
+    $query= &quot;SELECT * FROM user WHERE user_level = '$level' ORDER BY uname LIMIT $limit&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+
+}
+	
+
+
+
+
+/**
+*
+*	get the reference_name. The query can be made case-sensitive by
+*	setting the second argument to true
+*/
+function qGetRefByName($name, $case_sensitive = false) {
+	
+	if($case_sensitive) {
+	    $query = &quot;SELECT reference_id FROM reference WHERE BINARY reference_name='$name'&quot;;
+    } else {
+		$query = &quot;SELECT reference_id FROM reference WHERE reference_name='$name'&quot;;
+	}
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+
+
+/**
+*
+*	get the reference_name. The query can be made case-sensitive by
+*	setting the second argument to true
+*/
+function qGetTagByName($name, $case_sensitive = false) {
+	
+	if($case_sensitive) {
+	    $query = &quot;SELECT tag_id FROM tag WHERE BINARY tag_name='$name'&quot;;
+    } else {
+		$query = &quot;SELECT tag_id FROM tag WHERE tag_name='$name'&quot;;
+	}
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qUpdateUserLevelByUID($uid, $level) {
+	$query= &quot;UPDATE user SET user_level='$level' WHERE uid='$uid'&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qInsertModerator($uid, $genre_id) {
+	$query = &quot;INSERT INTO moderator (uid, genre_id) &quot;;
+	$query .= &quot;VALUES ('$uid','$genre_id')&quot;;
+   	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return mysql_insert_id();	
+}
+
+function qGetGenreFromModerator($uid) {
+    $query = &quot;SELECT m.moderator_id, m.genre_id, g.genre_name FROM moderator as m, genre as g &quot;;
+	$query .= &quot;WHERE m.uid ='$uid' AND m.genre_id = g.genre_id&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+   // echo $query;
+    return $q;
+}
+
+function qGetModList($genre_id) {
+	$query = &quot;SELECT a.audio_id, a.audio_title, a.audio_filename,&quot;; 
+	$query .= &quot; a.audio_hi_path, a.audio_lo_path FROM audio as a&quot;;
+	$query .= &quot; WHERE a.genre_id = '$genre_id'&quot;; 
+	$query .= &quot; AND audio_status='info_available'&quot;;
+   	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;	
+
+
+}
+
+
+function qGetTagsIncUsage() {
+	$query = &quot;SELECT t.tag_id, t.tag_name, COUNT(*) &quot;;
+	$query .= &quot;FROM tag as t, audio_tag as a &quot;;
+	$query .= &quot;WHERE t.tag_id = a.tag_id &quot;;
+	$query .= &quot;GROUP BY t.tag_name&quot;; 
+	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;	
+}
+
+
+
+function qGetAllTags() {
+	$query = &quot;SELECT t.tag_id, t.tag_name FROM tag as t, audio_tag AS at, audio AS a WHERE at.tag_id = t.tag_id AND at.audio_id = a.audio_id AND a.audio_status = 'public'&quot;; 
+	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;	
+}
+
+
+/* returns the amount of times the specific tag is used */
+function qGetUsageOfTagByID($tag_id) {
+	$query = &quot;SELECT COUNT(tag_id) FROM audio_tag WHERE tag_id ='$tag_id'&quot;; 
+	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+/* returns the amount of times the specific tag is used */
+function qGetAudioIDByTagID($tag_id) {
+	$query = &quot;SELECT audio_id FROM audio_tag WHERE tag_id ='$tag_id'&quot;; 
+	//echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+// Marten's probeersels //////////////////////////////////////////////////////////////////////////////////////
+
+
+
+function qGetAudioByGenre($genre_id){
+    $query= &quot;SELECT a.audio_id, a.audio_title, a.audio_artist, a.audio_hi_path, a.cclicense_id, u.uname,  c.cclicense_image_path FROM audio AS a, user AS u, cclicense AS c WHERE genre_id='$genre_id' AND a.cclicense_id = c.cclicense_id AND u.uid = a.uid AND audio_status='public' ORDER BY audio_id DESC LIMIT 10&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetLatestAudio(){
+    $query= &quot;SELECT a.audio_id, a.audio_title, a.audio_artist, a.audio_hi_path, u.uname FROM audio AS a, user AS u WHERE audio_status='public' AND u.uid = a.uid ORDER BY audio_id DESC LIMIT 10&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetLatestAudioAndInfo(){
+    $query= &quot;SELECT a.audio_id, a.audio_title, a.audio_artist, a.audio_size, a.audio_hi_path, a.cclicense_id, u.uname, c.cclicense_image_path, c.cclicense_human_url, g.genre_name FROM audio AS a, user AS u, cclicense AS c, genre AS g WHERE audio_status='public' AND g.genre_id = a.genre_id AND a.cclicense_id = c.cclicense_id AND u.uid = a.uid ORDER BY audio_id DESC LIMIT 20&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetLatestAudioFromArtist($uid){
+    $query= &quot;SELECT a.audio_id, a.audio_title, a.audio_artist, a.audio_hi_path, u.uname FROM audio AS a, user AS u WHERE audio_status='public' AND u.uid = '$uid' AND u.uid = a.uid ORDER BY audio_id DESC LIMIT 1&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetAllArtists(){
+    $query= &quot;SELECT DISTINCT(a.audio_artist), a.uid, u.uid, u.uname, p.location FROM audio AS a, user AS u, user_profile AS p WHERE a.uid = u.uid AND u.uid = p.uid AND audio_status='public' ORDER BY audio_artist ASC&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetArtistByGenre($genre_id){
+    $query= &quot;SELECT DISTINCT(a.audio_artist), a.uid, u.uid, u.uname, p.location FROM audio AS a, user AS u, genre AS g, user_profile AS p WHERE g.genre_id='$genre_id' AND g.genre_id = a.genre_id AND a.uid = u.uid AND u.uid = p.uid AND audio_status='public' ORDER BY audio_artist DESC&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetLatestArtistByGenre($genre_id) {
+    $query = &quot;SELECT DISTINCT(a.uid), a.audio_artist, p.avatar_path, p.avatar_filename_small, u.uid, u.uname&quot;;
+	$query .= &quot; FROM audio AS a, user_profile AS p, user AS u WHERE a.uid = p.uid AND a.uid = u.uid AND a.genre_id='$genre_id' AND audio_status='public'&quot;;
+	$query .= &quot; ORDER BY u.userdate ASC LIMIT 4&quot;;
+    //echo $query;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetPublicAudioByUID($uid) {
+    $query= &quot;SELECT a.cclicense_id, a.audio_hi_path, a.audio_title, a.audio_artist, a.audio_id, a.audio_album, a.audio_size, c.cclicense_image_path FROM audio AS a, cclicense AS c WHERE a.uid = '$uid' AND a.audio_status='public' AND a.cclicense_id = c.cclicense_id ORDER BY a.audio_id DESC&quot;;
+  // 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetCheckedAudioByUID($uid) {
+    $query= &quot;SELECT * FROM audio WHERE uid = '$uid' ANd audio_status='undefined'&quot;;
+   	//echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+function qGetWaitingAudioByUID($uid) {
+    $query= &quot;SELECT * FROM audio WHERE uid = '$uid' AND audio_status='info_available'&quot;;
+  // 	echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+/**
+*	get the tag name by audio ID. 
+*/
+
+function qGetTagByAudioID($audio_id) {	
+	$query = &quot;SELECT t.tag_name FROM audio_tag AS a, tag AS t &quot;;
+	$query .= &quot; WHERE a.audio_id = '$audio_id' AND a.tag_id = t.tag_id&quot;;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetGenreByAudioID($audio_id) {	
+	$query = &quot;SELECT DISTINCT(g.genre_name), g.genre_id FROM audio AS a, genre AS g &quot;;
+	$query .= &quot; WHERE a.audio_id = '$audio_id' AND a.genre_id = g.genre_id&quot;;
+	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetAllUsers() {
+    $query= &quot;SELECT u.uname, p.location FROM user as u, user_profile as p WHERE u.uid = p.uid ORDER BY uname&quot;;
+   	$q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetArtistInfoByUID($uid) {
+	$query = &quot;SELECT  p.avatar_path, p.avatar_filename_small, p.bio, u.uid, u.uname&quot;;
+	$query .= &quot; FROM user_profile AS p, user AS u WHERE u.uid = '$uid' AND p.uid = u.uid&quot;;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    //echo $query;
+    return $q;
+}
+
+function qGetGenreByID($genre_id){
+    $query= &quot;SELECT * FROM genre WHERE genre_id='$genre_id' ORDER BY genre_name&quot;;
+    //echo $query;
+    $q = mysql_query($query) or die (&quot;db problems: &quot; . mysql_error());
+    return $q;
+}
+
+?&gt;

Added: trunk/inc/sm-db-settings.php
===================================================================
--- trunk/inc/sm-db-settings.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/sm-db-settings.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,11 @@
+&lt;?php
+	/* replace with your own values */
+	$host_name = &quot;localhost&quot;;  
+	$db_user = &quot;user&quot;; 
+	$db_pwd = &quot;password&quot;;
+	$db_name = &quot;simuze&quot;;
+
+    $connection = mysql_pconnect($host_name, $db_user, $db_pwd) or die(&quot;couldn`t connect to database server &quot; . mysql_error());
+    
+    mysql_select_db($db_name) or die (&quot;couldn`t select database&quot;);
+?&gt;

Added: trunk/inc/sm-fetchnews.php
===================================================================
--- trunk/inc/sm-fetchnews.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/sm-fetchnews.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,24 @@
+&lt;?php
+//include the magpie rss
+require_once(&quot;inc/external/magpierss/rss_fetch.inc&quot;);
+
+
+//set constants.
+define('MAGPIE_CACHE_ON', true);
+define('MAGPIE_CACHE_AGE', 60*5); // 5 min
+define('MAGPIE_CACHE_DIR', 'inc/external/magpierss/cache');
+
+
+
+//$url = &quot;<A HREF="http://www.simuze.nl/live/nieuws/wp-rss.php">http://www.simuze.nl/live/nieuws/wp-rss.php</A>&quot;;
+$url = &quot;<A HREF="http://www.creativecommons.nl/nieuws/wp-rss.php">http://www.creativecommons.nl/nieuws/wp-rss.php</A>&quot;;
+$rss = fetch_rss($url);
+
+echo &quot;&lt;ul&gt;\n&quot;;
+foreach ($rss-&gt;items as $item ) {
+	$title = $item[title];
+	$url   = $item[link];
+	echo &quot;&lt;li class=\&quot;item\&quot;&gt;&lt;a href=\&quot;$url\&quot; class=\&quot;wit\&quot;&gt;$title&lt;/a&gt;&lt;/li&gt;\n&quot;;
+}
+echo &quot;&lt;/ul&gt;\n&quot;;
+?&gt;

Added: trunk/inc/sm-getprofile.php
===================================================================
--- trunk/inc/sm-getprofile.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/sm-getprofile.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,102 @@
+&lt;?php 
+
+$showprofile = false;
+if(CheckInputValid($user)) { 
+    $checked_user = addslashes($user);
+    //get user data
+    $handle = qGetUser($checked_user,'');
+	$nr = mysql_num_rows($handle);
+    if($nr == 1) {
+        $userdata = mysql_fetch_array($handle);
+        $uid = $userdata['uid'];
+        $profilehandle = qGetProfileByUID($uid); 
+        if($nr_rows= mysql_num_rows($profilehandle) == 1) {
+            $pid = &quot;update&quot;;
+            $profile = mysql_fetch_assoc($profilehandle);
+            $checked_data = array();
+            foreach($profile as $key =&gt; $val)
+            {
+                if(!empty($val)) { //put everything thats NOT empty into one array that has been checked!!
+                    //prepare birthdate
+                    if($key == 'birthdate') {
+                        $bdate = extractDate($val);
+                        if($bdate !== false) {
+                            $checked_data['birthdate'] = $bdate;
+                        }    
+                    } else if($key == 'state') {
+                        $checked_data['state'] = $val;
+                    } else if($key == 'zipcode' ) {
+                        $checked_data['zipcode'] = $val;
+                    } else if($key == 'bio') { 
+                        $tmp_bio = stripslashes($val);
+                        $bio = html_entity_decode($tmp_bio);
+                        $checked_data[$key] = $bio;
+                    } else if(strpos($key, 'im_') !== false) {
+                        $checked_data[$key] = stripslashes($val);
+                    } else if(strpos($key, 'musica_') !== false) {
+                        $checked_data[$key] = stripslashes($val);
+                    } else if(strpos($key, 'must_') !== false) {
+                        $checked_data[$key] = stripslashes($val);
+                        $checked_data[$key] = html_entity_decode($val);
+                    } else { //everything that needs to have possible slashes removed
+                        $checked_data[$key] = stripslashes($val);
+                    } 
+                }
+                
+                //check urls, if empty set to <A HREF="http://">http://</A>
+                if(strpos($key, 'url_') !== false) {
+                    if(!empty($val)) {
+                        $checked_data[$key] = rawurldecode($val);
+                    } else {
+                        $checked_data[$key] = &quot;<A HREF="http://">http://</A>&quot;;
+                    }
+                }
+                
+                //check avatar
+                if(strpos($key, 'avatar_') !== false) {
+                    if(!empty($val)) {
+                        if($key == 'avatar_path') {
+                            $checked_data[$key] = rawurldecode($val);
+                        } else {
+                            $checked_data[$key] = $val;
+                        }
+                    } else {
+                        $checked_data['avatar_path'] = AVATAR_UPLOAD_PATH .&quot;default/&quot;;
+                        $checked_data['avatar_filename'] = &quot;default_avatar240x180.gif&quot;;
+                    }
+                }
+                
+            }
+			$showprofile = true;
+        } else {
+            $pid = -1; //no profile in db, therefor no update but insert hence the $pid (profile id) equals -1 
+            $showprofile = false;
+			//no profile available, but we still want to show the <A HREF="http://">http://</A> in the url fields...so
+            $checked_data = array(&quot;url_1&quot;=&gt;&quot;<A HREF="http://">http://</A>&quot;,&quot;url_2&quot;=&gt;&quot;<A HREF="http://">http://</A>&quot;,&quot;url_3&quot;=&gt;&quot;<A HREF="http://">http://</A>&quot;);
+        }
+      
+        $today_year = date(Y);
+      
+        $selyear = $checked_data['birthdate']['year'];
+        $selmonth = $checked_data['birthdate']['month'];
+        $selday = $checked_data['birthdate']['day'];
+        
+        $paramyear = array(&quot;start&quot;=&gt;1900,&quot;end&quot;=&gt;$today_year, &quot;lang&quot;=&gt;&quot;NL&quot;, &quot;selected&quot;=&gt;$selyear);
+        $paramday = array(&quot;lang&quot;=&gt;&quot;NL&quot;, &quot;selected&quot;=&gt;$selday);
+        $parammonth = array(&quot;view&quot;=&gt;&quot;ftext&quot;,&quot;lang&quot;=&gt;&quot;NL&quot;, &quot;selected&quot;=&gt;$selmonth);
+        
+        $provincies = createSelectProvincies($checked_data['state']);
+        $year = createSelectYear($paramyear);    
+        $day = createSelectDayMonth($paramday);    
+        $month = createSelectMonth($parammonth);
+        
+        
+        //handle image
+      
+        $path = str_replace(&quot;/var/www/simuze.nl/live/&quot;,&quot;&quot;,$checked_data['avatar_path']); 
+        $imgsrc = $path . $checked_data['avatar_filename'];
+	
+    } else {
+        $showprofile = false;
+    }
+}?&gt;

Added: trunk/inc/sm-lib-functions.php
===================================================================
--- trunk/inc/sm-lib-functions.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/sm-lib-functions.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,1315 @@
+&lt;?php
+require_once(&quot;class.phpmailer.php&quot;);
+
+/**
+*   make sure all input works as expected,
+*   by undoing the possible magic_quotes directive.
+*   Now every single variable will be free from slashed and needs to be
+*   manually escaped.
+*   code origin: <A HREF="http://nl3.php.net/manual/en/function.get-magic-quotes-gpc.php">http://nl3.php.net/manual/en/function.get-magic-quotes-gpc.php</A>
+*/
+if (get_magic_quotes_gpc()) {
+   function stripslashes_deep($value)
+   {
+       $value = is_array($value) ?
+                   array_map('stripslashes_deep', $value) :
+                   stripslashes($value);
+
+       return $value;
+   }
+
+   $_POST       = array_map('stripslashes_deep', $_POST);
+   $_GET         = array_map('stripslashes_deep', $_GET);
+   $_COOKIE   = array_map('stripslashes_deep', $_COOKIE);
+   $_REQUEST = array_map('stripslashes_deep', $_COOKIE);
+}
+
+
+
+/**
+*   check if input is valid according to a string of valid chars
+*/
+function CheckInputValid($str,$maxlength = &quot;&quot;)
+{
+    //making it case independent
+    $str = strtolower($str);
+    $validmask  =&quot;abcdefghijklmnopqrstuvwxyz0123456789_-.@' &quot;;
+    if ($maxlength == &quot;&quot;) {
+        if (strspn($str, $validmask) == strlen($str)) {
+            return true;
+        } else {
+            return false;
+        }
+    } else {
+        $validlength = $maxlength;
+        if (strspn($str, $validmask) == strlen($str) &amp;&amp; $validlength &gt;= strlen($str)) {
+           return true;
+        } else {
+           return false;
+        }
+    }
+}
+
+
+function checkContainsAlfaNum($input) {
+	$output = eregi(&quot;[a-z0-9]&quot;, $input)? true : false;
+	return $output;
+}
+
+/**
+* A username consists of at least 4 and a maximum of 16 
+* alfanumeric chars. The first on may not be a number
+**/
+function checkUsernameValid($uname)
+{
+    $len = strlen($uname);
+    if($len &gt;= 4 &amp;&amp; $len &lt;= 16 ) {   
+        $uname = strtolower($uname);
+        $status = eregi(&quot;^[a-z][a-z0-9]&quot;, $uname)? true : false;
+        return $status;
+    } else {
+        return false; 
+    }    
+}
+
+function checkPasswordValid($pwd)
+{
+    $validmask=&quot;abcdefghijklmnopqrstuvwxyz0123456789_-@&quot;; 
+    $len = strlen($pwd);
+    
+    if($len &gt;= 6 &amp;&amp; $len &lt;= 16 ) {   
+        $pwd = strtolower($pwd);
+        if (strspn($pwd, $validmask) == strlen($pwd)) {
+            return true;
+        } else {
+            return false;
+        }
+    } else {
+        return false; 
+    }    
+}
+
+
+function sendFeedback($email_to, $subject, $message) {
+	//sent BCC to
+    $bcc = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">bjorn at waag.org</A>&quot;;
+    
+                                   
+	//insert succesfull, send email for confirmation
+	$mail = new PHPMailer();
+	$mail-&gt;IsSendmail();
+	$mail-&gt;AddAddress($email_to);
+	$mail-&gt;AddBCC($bcc);
+	$mail-&gt;FromName = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">simuzerobot at simuze.com</A>&quot;;
+	$mail-&gt;From = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">simuzerobot at simuze.com</A>&quot;;
+	$mail-&gt;Subject = $subject;
+	$mail-&gt;Body = $message;
+		
+	if(!$mail-&gt;Send())
+	{
+		return true;
+	}
+	else
+	{
+		return false;
+	}
+}
+
+
+
+
+
+
+/** encrypts the $value with the $alg */
+function CryptIt($alg, $value)
+{
+    switch($alg) {
+    
+        case &quot;md5&quot;:
+            $value = md5($value);
+            return $value;
+        break;    
+    }
+
+}
+
+
+/** creates a random string */
+function rndString($string_length = 6)
+{
+    // uses the decimal acsii numbers to produce a random string
+    //<A HREF="http://www.asciitable.com/">http://www.asciitable.com/</A> 
+    $min  = 48;
+    $max = 90;
+    
+    for($i = 0 ; $i &lt; $string_length; $i++){
+       $rand =  mt_rand($min,$max);
+       
+       if($rand &gt; 57 &amp;&amp; $rand &lt;= 63){
+           $rand = mt_rand(48,57);
+       }
+       $str .= chr($rand);
+    }
+    $str = strtolower($str);
+    return $str;
+}
+
+
+
+/**
+*
+* expects a timestamp(8) which
+* looks like YYYYMMDD and returns
+* an array like this this:
+* $arr['year'] = YYYY
+* $arr['month'] = MM
+* $arr['day'] = DD
+**/
+function extractTimestamp($timestamp)
+{
+    $birthdate = array();
+    //format is YYYYMMDD
+    if(strlen($timestamp) == 8) {
+        $tmp_yyyy_mmdd = chunk_split ( $timestamp , 4 ,&quot;-&quot; ); // YYYYMMDD becomes YYYY-MMDD
+        $tmp_arr =  explode(&quot;-&quot;, $tmp_yyyy_mmdd);
+        //we freed the year...YAHOO
+        $birthdate[&quot;year&quot;] = $tmp_arr[0];
+        //continue to process MMDD into MM-DD
+        $tmp_mm_dd = chunk_split ( $tmp_arr[1] , 2 ,&quot;-&quot; );
+        $tmp_arr2 =  explode(&quot;-&quot;, $tmp_mm_dd);
+        $birthdate[&quot;month&quot;] = $tmp_arr2[0];
+        $birthdate[&quot;day&quot;] = $tmp_arr2[1];
+        return $birthdate;
+    } else {
+        return false;
+    }
+}
+
+
+/**
+*   process a DATE YYYY-MM-DD
+*   into 
+* an array like this this:
+* $arr['year'] = YYYY
+* $arr['month'] = MM
+* $arr['day'] = DD
+**/
+function extractDate($date)
+{
+    if(strlen($date) == 10) {
+        $birthdate = array();
+        //format is YYYY-MM-DD
+        $tmp_arr =  explode(&quot;-&quot;, $date);
+        $birthdate[&quot;year&quot;]  = $tmp_arr[0];
+        $birthdate[&quot;month&quot;] = $tmp_arr[1];
+        $birthdate[&quot;day&quot;]   = $tmp_arr[2];
+        return $birthdate;
+    } else {
+        return false;
+    }
+}
+
+
+
+
+
+/**
+* creates a select box (selmonth)
+* with months. Options to be 
+* set in the param array:
+*
+* key:value (possibilities)
+*
+* selected:1 (1~12) default is none and this will trigger a text as default (lang specific)
+* lang:NL (NL, EN); default is EN
+* view:ftext (ftext, text,lnr) default is numeric months without leading zero
+**/
+function createSelectMonth($params)
+{
+    if(is_array($params)) { 
+        
+        $monthsNL = array(&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mrt&quot;, &quot;Apr&quot;, &quot;Mei&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sept&quot;, &quot;Okt&quot;, &quot;Nov&quot;, &quot;Dec&quot;);
+        $monthsEN = array(&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sept&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;);
+       
+        $monthsfullNL = array(&quot;Januari&quot;, &quot;Februari&quot;, &quot;Maart&quot;, &quot;April&quot;, &quot;Mei&quot;, &quot;Juni&quot;, &quot;Juli&quot;, &quot;Augustus&quot;, &quot;September&quot;, &quot;Oktober&quot;, &quot;November&quot;, &quot;December&quot;);
+        $monthsfullEN = array(&quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;, &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;, &quot;October&quot;, &quot;November&quot;, &quot;December&quot;);
+        $html .= '&lt;select name=&quot;selmonth&quot; id=&quot;selmonth&quot;&gt;'.&quot;\n&quot;;
+        
+        switch($params['lang']) {
+            case &quot;NL&quot;:
+                $msg = 'Maand';
+                switch($params['view']) {
+                    //shortext
+                    case &quot;text&quot;:
+                      if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                      } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                      }
+                      
+                      $j = 0;
+                      for($i = 1; $i &lt;= 12; $i++) {
+                          if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                          if($params['selected'] == $i &amp;&amp; !$selected) {
+                              $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$monthsNL[$j]&lt;/option&gt;\n&quot;;
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$monthsNL[$j]&lt;/option&gt;\n&quot;;
+                          }
+                          $j++;
+                      }
+                    break;
+                     //fullext
+                    case &quot;ftext&quot;:
+                        if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                      } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                      }
+                      $j = 0;
+                      for($i = 1; $i &lt;= 12; $i++) {
+                          
+                          if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                          if($params['selected'] == $i &amp;&amp; !$selected) {
+                              $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$monthsfullNL[$j]&lt;/option&gt;\n&quot;;
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$monthsfullNL[$j]&lt;/option&gt;\n&quot;;
+                          }
+                          $j++;
+                      }
+                    break;
+                    //default numeric months
+                    default:
+                          if(empty($params['selected'])) {
+                              $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                              $selected = true; 
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          }
+                        for($i = 1; $i &lt;= 12; $i++) {
+                            if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                            if($params['selected'] == $i &amp;&amp; !$selected) {
+                                $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                            } else {
+                                $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                            }
+                        }
+                    break;
+                }
+            break;
+            //default language is English
+            default:
+                $msg = 'Month';
+                switch($params['view']) {
+                    //shortext
+                    case &quot;text&quot;:
+                      if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                      } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                      }
+                      $j = 0;
+                      for($i = 1; $i &lt;= 12; $i++) {
+                          if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                          if($params['selected'] == $i &amp;&amp; !$selected) {
+                              $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$monthsEN[$j]&lt;/option&gt;\n&quot;;
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$monthsEN[$j]&lt;/option&gt;\n&quot;;
+                          }
+                          $j++;  
+                      }
+                    break;
+                     //fullext
+                    case &quot;ftext&quot;:
+                      if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                      } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                      }
+                      $j = 0;
+                      for($i = 1; $i &lt;= 12; $i++) {
+                          if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                          if($params['selected'] == $i &amp;&amp; !$selected) {
+                              $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$monthsfullEN[$j]&lt;/option&gt;\n&quot;;
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$monthsfullEN[$j]&lt;/option&gt;\n&quot;;
+                          }
+                          $j++;
+                      }
+                    break;
+                    //default numeric months
+                    default:
+                       if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                        } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                        }
+                        for($i = 1; $i &lt;= 12; $i++) {
+                            if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                            if($params['selected'] == $i &amp;&amp; !$selected) {
+                                $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                            } else {
+                                $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                            }
+                        }
+                    break;
+                }
+            break;  
+        }
+        $html .='&lt;/select&gt;';
+        return $html;
+    } else {
+        return false;
+    }     
+}
+
+
+/**
+* creates a select box (seldaymonth)
+* with days. Options to be 
+* set in the params array:
+*
+* key:value (possibilities)
+*
+* NOTE: currently we're not taking any
+* leap years into account. And we'll set all months
+* with 31 days. This will get fixed in the (near) future 
+* 
+* selected:12 (selected day of the month)
+* lang:NL (NL, EN); default is EN
+* 
+**/
+function createSelectDayMonth($params) {
+    if(is_array($params)) {    
+        $start = 1;
+        $end = 31;
+        $html  .= '&lt;select name=&quot;seldaymonth&quot; id=&quot;seldaymonth&quot;&gt;' .&quot;\n&quot;;
+        
+        switch($params['lang']) {
+            case &quot;NL&quot;:
+                $msg = 'Dag';
+                if(empty($params['selected'])) {
+                    $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                    $selected = true; 
+                } else {
+                    $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                }
+                for($i = $start; $i &lt;= $end; $i++ ) {
+                    if($i &lt; 10) {
+                        $i = &quot;0&quot; .$i;
+                    }
+                    if($params['selected'] == $i) {
+                        $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    } else {
+                        $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    }
+                }    
+            break;
+            //default language is English
+            default:
+                $msg = 'Day';
+                if(empty($params['selected'])) {
+                    $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                    $selected = true; 
+                } else {
+                    $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                }
+                for($i = $start; $i &lt;= $end; $i++ ) {
+                    if($i &lt; 10) {
+                        $i = &quot;0&quot; .$i;
+                    }
+                    if($params['selected'] == $i) {
+                        $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    } else {
+                        $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    }
+                }
+            break;
+        }
+        $html .= '&lt;/select&gt;';
+        return $html;
+    } else {
+        return false;
+    }
+}
+
+
+function createSelectGenre($name = 'undefined') {
+	if($name != 'undefined') {
+		if ($name == 'snelzoeken'){ //extra if/else statement
+			$genre = null;
+			$genre .= &quot;&lt;p class=\&quot;small\&quot;&gt;Kies een genre:\n&quot;;
+			$genre .= &quot;&lt;select&gt;\n&quot;;
+			$genre .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;::maak keuze::&lt;/option&gt;\n&quot;;
+			$genre_handle = qGetGenre();
+			$nr_genre = mysql_num_rows($genre_handle);
+			if($nr_genre &gt; 0) {
+				for($i = 0; $i &lt; $nr_genre; $i++) {
+					$g = mysql_fetch_array($genre_handle);
+					$genre .=&quot;&lt;option value=\&quot;$g[genre_id]\&quot;&gt;$g[genre_name]&lt;/option&gt;&quot;;        
+				}
+			$genre .=&quot;&lt;/select&gt;&lt;/p&gt;&quot;;
+			} else {
+				$genre .=&quot;&lt;option value=\&quot;problem\&quot;&gt;Genre db probleem&lt;/option&gt;&quot;; 
+			}
+			
+		} else {
+			$genre = null;
+			$genre .= &quot;&lt;label for=\&quot;$name\&quot;&gt;Kies een genre:&lt;/label&gt;\n&quot;;
+			$genre .= &quot;&lt;select class=\&quot;commentaar_input\&quot; name=\&quot;$name\&quot;&gt;\n&quot;;
+			$genre .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;::maak keuze::&lt;/option&gt;\n&quot;;
+			$genre_handle = qGetGenre();
+			$nr_genre = mysql_num_rows($genre_handle);
+			if($nr_genre &gt; 0) {
+				for($i = 0; $i &lt; $nr_genre; $i++) {
+					$g = mysql_fetch_array($genre_handle);
+					$genre .=&quot;&lt;option value=\&quot;$g[genre_id]\&quot;&gt;$g[genre_name]&lt;/option&gt;&quot;;        
+				}
+			$genre .=&quot;&lt;/select&gt;&lt;br /&gt;&quot;;
+			} else {
+				$genre .=&quot;&lt;option value=\&quot;problem\&quot;&gt;Genre db probleem&lt;/option&gt;&quot;; 
+			}
+		}
+		//einde extra if/else	statement
+	} else {
+		$genre = null;
+		$genre .= &quot;&lt;label for=\&quot;genre\&quot;&gt;Kies een genre:&lt;/label&gt;\n&quot;;
+		$genre .= &quot;&lt;select class=\&quot;commentaar_input\&quot; name=\&quot;genre\&quot;&gt;\n&quot;;
+		$genre .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;::maak keuze::&lt;/option&gt;\n&quot;;
+		$genre_handle = qGetGenre();
+		$nr_genre = mysql_num_rows($genre_handle);
+		if($nr_genre &gt; 0) {
+			for($i = 0; $i &lt; $nr_genre; $i++) {
+				$g = mysql_fetch_array($genre_handle);
+				$genre .=&quot;&lt;option value=\&quot;$g[genre_id]\&quot;&gt;$g[genre_name]&lt;/option&gt;&quot;;        
+			}
+		$genre .=&quot;&lt;/select&gt;&lt;br /&gt;&quot;;
+		} else {
+			$genre .=&quot;&lt;option value=\&quot;problem\&quot;&gt;Genre db probleem&lt;/option&gt;&quot;; 
+		}
+	}
+	
+	return $genre;
+}
+
+function createMoodSearch() {
+$mood_handle = qGetMoods();
+$nr_mood = mysql_num_rows($mood_handle);
+$moodsearch .= &quot;&lt;table name=\&quot;moodsearch\&quot; width=\&quot;354\&quot; border=\&quot;0\&quot; bordercolor=\&quot;#000000\&quot; cellspacing=\&quot;4\&quot; cellpadding=\&quot;2\&quot;&gt;&quot;;
+	if($nr_mood &gt; 0) {
+		for($i=0;$i&lt;$nr_mood;$i++) {
+			$mood = mysql_fetch_array($mood_handle);
+			$moodname = $mood['mood_description_name'];
+			$mid = $mood['mood_description_id'];
+			$l1  = $mood['mood_description_label1'];
+			$l2  = $mood['mood_description_label2'];
+			$l3  = $mood['mood_description_label3'];
+			$l4  = $mood['mood_description_label4'];
+			$l5  = $mood['mood_description_label5'];
+			$v1  = $mood['mood_description_value1'];
+			$v2  = $mood['mood_description_value2'];
+			$v3  = $mood['mood_description_value3'];
+			$v4  = $mood['mood_description_value4'];
+			$v5  = $mood['mood_description_value5'];
+			$unique = $mid + $i; 
+			
+			$moodsearch .=&quot;&lt;tr bgcolor=\&quot;#F8E4B3\&quot;&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;td&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;b&gt;$moodname&lt;/b&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;ol&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;li&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; value=\&quot;$v1\&quot; /&gt; $l1&lt;/li&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;li&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; value=\&quot;$v2\&quot; /&gt; $l2&lt;/li&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;li&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; checked=\&quot;checked\&quot; value=\&quot;$v3\&quot; /&gt; $l3&lt;/li&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;li&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; value=\&quot;$v4\&quot; /&gt; $l4&lt;/li&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;li&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; value=\&quot;$v5\&quot; /&gt; $l5&lt;/li&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;/ol&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;/td&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;/tr&gt;\n&quot;;
+					
+			
+		}
+	$moodsearch .= &quot;&lt;/table&gt;&quot;;    
+	} else {
+		$moodsearch .= &quot;geen moods aanwezig&quot;;
+	}
+return $moodsearch;	
+}
+
+
+function createSelectTag($name = 'undefined') {
+	if($name != 'undefined') {
+		$tag = null;
+		$tag .= &quot;&lt;select class=\&quot;commentaar_input\&quot; name=\&quot;$name\&quot;&gt;\n&quot;;
+		$tag .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;::maak keuze::&lt;/option&gt;\n&quot;;
+		$tag_handle = qGetTagsIncUsage();
+		$nr_tag = mysql_num_rows($tag_handle);
+		if($nr_tag &gt; 0) {
+			for($i = 0; $i &lt; $nr_tag; $i++) {
+				$g = mysql_fetch_array($tag_handle);
+				$nrs = $g['COUNT(*)'];
+				$tag .=&quot;&lt;option value=\&quot;$g[tag_id]\&quot;&gt;$g[tag_name]      -- $nrs nummers gevonden&lt;/option&gt;&quot;;        
+			}
+		$tag .=&quot;&lt;/select&gt;&lt;br /&gt;&quot;;
+		} else {
+			$tag .=&quot;&lt;option value=\&quot;problem\&quot;&gt;Tag db probleem&lt;/option&gt;&quot;; 
+		}
+	
+	} else {
+		$tag = null;
+		$tag .= &quot;&lt;label for=\&quot;tag\&quot;&gt;Kies een tag:&lt;/label&gt;\n&quot;;
+		$tag .= &quot;&lt;select class=\&quot;commentaar_input\&quot; name=\&quot;tag\&quot;&gt;\n&quot;;
+		$tag .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;::maak keuze::&lt;/option&gt;\n&quot;;
+		$tag_handle = qGetTagsIncUsage();
+		$nr_tag = mysql_num_rows($tag_handle);
+		if($nr_tag &gt; 0) {
+			for($i = 0; $i &lt; $nr_tag; $i++) {
+				$g = mysql_fetch_array($tag_handle);
+				$nrs = $g['COUNT(*)'];
+				$tag .=&quot;&lt;option value=\&quot;$g[tag_id]\&quot;&gt;$g[tag_name] -- $nrs nummers gevonden&lt;/option&gt;&quot;;       
+			}
+		$tag .=&quot;&lt;/select&gt;&lt;br /&gt;&quot;;
+		} else {
+			$tag .=&quot;&lt;option value=\&quot;problem\&quot;&gt;Tag db probleem&lt;/option&gt;&quot;; 
+		}
+	}
+	
+	return $tag;
+}
+
+
+
+
+
+/**
+* creates a select box (selyear)
+* with months. Options to be 
+* set in the param array:
+*
+* key:value (possibilities)
+*
+* start:1900 (start year)
+* end:2005 (end year inclusive)
+* lang:NL (NL, EN); default is EN
+* selected:2003 (selected year)
+* 
+**/
+function createSelectYear($params) {
+    if(is_array($params)) {    
+        
+        $start  = $params['start'];
+        $end    = $params['end'];
+        $html  .= '&lt;select name=&quot;selyear&quot; id=&quot;selyear&quot;&gt;'.&quot;\n&quot;;
+        
+        switch($params['lang']) {
+            case &quot;NL&quot;:
+                $msg = 'Jaar';
+                if(empty($params['selected'])) {
+                    $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                    $selected = true; 
+                } else {
+                    $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                }
+                for($i = $start; $i &lt;= $end; $i++ ) {
+                    if($params['selected'] == $i) {
+                        $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    } else {
+                        $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    }
+                }    
+            break;
+            //default language is English
+            default:
+                $msg = 'Year';
+                if(empty($params['selected'])) {
+                    $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                    $selected = true; 
+                } else {
+                    $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                }
+                for($i = $start; $i &lt;= $end; $i++ ) {
+                    if($params['selected'] == $i) {
+                        $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    } else {
+                        $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    }
+                }
+            break;
+        }
+        $html .= '&lt;/select&gt;';
+        return $html;
+    } else {
+        return false;
+    }
+}
+
+
+/**
+* creates a select box (selprovincie)
+* with Dutch provincies. 
+* sel (1~12) default is none is none and this will trigger a text as default
+*
+**/
+function createSelectProvincies($sel) {
+    $msg = 'Kies een provincie';
+    $html .= '&lt;select name=&quot;selprovincie&quot; id=&quot;selprovincie&quot;&gt;'.&quot;\n&quot;;
+    $provincies = array(&quot;Drenthe&quot;,&quot;Overijssel&quot;, &quot;Utrecht&quot;, &quot;Flevoland&quot;, &quot;Noord-Holland&quot;,&quot;Zuid-Holland&quot;, &quot;Limburg&quot;, &quot;Zeeland&quot;, &quot;Gelderland&quot;, &quot;Groningen&quot;, &quot;Friesland&quot;, &quot;Brabant&quot;);
+
+    //sort provincies into alphabetical order
+    sort($provincies);
+    reset($provincies);
+    if(empty($sel)){
+        $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+        $selected = true;
+    } else {
+         $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+    }
+    
+    for($i = 0; $i &lt; 12; $i++) {
+        if($sel == $provincies[$i] &amp;&amp; !$selected) {
+            $html .= &quot;&lt;option selected value=\&quot;$provincies[$i]\&quot;&gt;$provincies[$i]&lt;/option&gt;\n&quot;;
+        } else {
+            $html .= &quot;&lt;option value=\&quot;$provincies[$i]\&quot;&gt;$provincies[$i]&lt;/option&gt;\n&quot;;
+        }    
+    }
+    $html .= '&lt;/select&gt;'.&quot;\n&quot;;
+    return $html;
+}
+
+
+if (!function_exists('getmicrotime')) {
+	function getmicrotime() {
+		list($usec, $sec) = explode(' ', microtime());
+		return ((float) $usec + (float) $sec);
+	}
+}
+
+
+
+
+function checkFilename($str) {
+    $str = strtolower($str);
+    $validmask  =&quot;abcdefghijklmnopqrstuvwxyz0123456789_- .&quot;;
+    if (strspn($str, $validmask) == strlen($str)) {
+        return true;
+    } else {
+        return false;
+    }
+}
+
+
+
+/**
+*   check if input is valid according to a string of valid chars
+*/
+function checkTextValid($str,$maxlength = &quot;&quot;)
+{   //making it case independent
+    $str = strtolower($str);
+    
+    $apo = &quot;'&quot;;
+    $newlines = &quot;\n\r&quot;;
+    
+    $validmask .= $apo;
+    $validmask .= $newlines;
+    $validmask .='abcdefghijklmnopqrstuvwxyz0123456789_,-.@ +=#%&amp;*$!?():;&quot;';
+    
+    
+    if ($maxlength == &quot;&quot;) {
+        if (strspn($str, $validmask) == strlen($str)) {
+            return true;
+        } else {
+            return false;
+        }
+    
+    } else {
+        $validlength = $maxlength;
+        if (strspn($str, $validmask) == strlen($str) &amp;&amp; $validlength &gt;= strlen($str)) {
+           return true;
+        } else {
+           return false;
+        }
+    }
+}
+
+/**
+* Author: Roel Duysserinck
+* <A HREF="http://faq.web-con.nl/">http://faq.web-con.nl/</A>
+**/
+function checkPostcode($postcode)
+{
+    // Format: 1234 XX of 1234XX
+    $status = (eregi (&quot;[0-9]{4}[[:space:]]*[A-Za-z]{2}&quot;, $postcode))? true : false;
+    // true if postcode is correct
+    // false if postcode is correct
+    return $status;
+}
+
+
+/*
+Functions Included In This File:
+    validateUrlSyntax()
+    validateEmailSyntax()
+    validateFtpSyntax()
+*/
+
+/*
+About validateUrlSyntax():
+    This function will verify if a http URL is formatted properly, returning
+    either with true or false.
+    
+    I used rfc #2396 URI: Generic Syntax as my guide when creating the
+    regular expression. For all the details see the comments below.
+
+
+Usage:
+    validateUrlSyntax( url_to_check[, options])
+
+    url_to_check - string - The url to check
+    
+    options - string - A optional string of options to set which parts of
+            the url are required, optional, or not allowed. Each option
+            must be followed by a &quot;+&quot; for required, &quot;?&quot; for optional, or
+            &quot;-&quot; for not allowed.
+
+            s - Scheme. Allows &quot;+?-&quot;, defaults to &quot;s?&quot;
+                H - <A HREF="http://">http://</A> Allows &quot;+?-&quot;, defaults to &quot;H?&quot;
+                S - <A HREF="https://">https://</A> (SSL). Allows &quot;+?-&quot;, defaults to &quot;S?&quot;
+                E - mailto: (email). Allows &quot;+?-&quot;, defaults to &quot;E-&quot;
+                F - <A HREF="ftp://">ftp://</A> Allows &quot;+?-&quot;, defaults to &quot;F-&quot;
+                    Dependant on scheme being enabled
+            u - User section. Allows &quot;+?-&quot;, defaults to &quot;u?&quot;
+                P - Password in user section. Allows &quot;+?-&quot;, defaults to &quot;P?&quot;
+                    Dependant on user section being enabled
+            a - Address (ip or domain). Allows &quot;+?-&quot;, defaults to &quot;a+&quot;
+                I - Ip address. Allows &quot;+?-&quot;, defaults to &quot;I?&quot;
+                    If I+, then domains are disabled
+                    If I-, then domains are required
+                    Dependant on address being enabled
+            p - Port number. Allows &quot;+?-&quot;, defaults to &quot;p?&quot;
+            f - File path. Allows &quot;+?-&quot;, defaults to &quot;f?&quot;
+            q - Query section. Allows &quot;+?-&quot;, defaults to &quot;q?&quot;
+            r - Fragment (anchor). Allows &quot;+?-&quot;, defaults to &quot;r?&quot;
+
+    Paste the funtion code, or include_once() this template at the top of the page
+    you wish to use this function.
+
+
+Examples:
+    validateUrlSyntax('<A HREF="http://george@www.cnn.com/#top">http://george@www.cnn.com/#top</A>')
+
+    validateUrlSyntax('<A HREF="https://games.yahoo.com:8080/board/chess.htm?move=true">https://games.yahoo.com:8080/board/chess.htm?move=true</A>')
+
+    validateUrlSyntax('<A HREF="http://www.hotmail.com/">http://www.hotmail.com/</A>', 's+u-I-p-q-r-')
+
+    validateUrlSyntax('/directory/file.php#top', 's-u-a-p-f+')
+
+
+    if (validateUrlSyntax('<A HREF="http://www.canowhoopass.com/">http://www.canowhoopass.com/</A>', 'u-'))
+    {
+        echo 'URL SYNTAX IS VERIFIED';
+    } else {
+        echo 'URL SYNTAX IS ILLEGAL';
+    }
+
+
+Last Edited:
+    December 15th 2004
+
+
+Changelog:
+    December 15th 2004
+      -Added new TLD's - .jobs, .mobi, .post and .travel. They are official, but not yet active.
+
+    August 31th 2004
+      -Fixed bug allowing empty username even when it was required
+      -Changed and added a few options to add extra schemes
+      -Added mailto: <A HREF="ftp://">ftp://</A> and <A HREF="http://">http://</A> options
+      -https option was 'l' now it is 'S' (capital)
+      -Added password option. Now passwords can be disabled while usernames are ok (for email)
+      -IP Address option was 'i' now it is 'I' (capital)
+      -Options are now case sensitive
+      -Added validateEmailSyntax() and validateFtpSyntax() functions below&lt;br&gt;
+
+    August 27th, 2004
+      -IP group range is more specific. Used to allow 0-299. Now it is 0-255
+      -Port range more specific. Used to allow 0-69999. Now it is 0-65535&lt;br&gt;
+      -Fixed bug disallowing 'i-' option.&lt;br&gt;
+      -Changed license to GPL
+
+    July 8th, 2004
+      -Fixed bug disallowing 'l-' option. Thanks Dr. Cheap
+
+    June 15, 2004
+      -Added options parameter to make it easier for people to plug the function in
+       without needed to rework the code.
+      -Split the example application away from the function
+
+    June 1, 2004
+      -Complete rewrite
+      -Now more modular
+        -Easier to disable sections
+        -Easier to port to other languages
+        -Easier to port to verify email addresses
+      -Uses only simple regular expressions so it is more portable
+      -Follows RFC closer for domain names. Some &quot;play&quot; domains may break
+      -Renamed from 'verifyUrl()' to 'validateUrlSyntax()'
+      -Removed extra code which added '<A HREF="http://">http://</A>' and trailing '/' if it was missing
+        -That code was better suited for a massaging function, not verifying
+      -Bug fixes:
+        -Now splits up and forces '/path?query#fragment' order
+        -No longer requires a path when using a query or fragment
+
+    August 29, 2003
+      -Allowed port numbers above 9999. Now allows up to 69999
+             
+    Sometime, 2002
+      -Added new top level domains
+        -aero, coop, museum, name, info, biz, pro
+
+    October 5, 2000
+      -First Version
+
+
+Intentional Limitations:
+    -Does not verify url actually exists. Only validates the syntax
+    -Strictly follows the RFC standards. Some urls exist in the wild which will
+     not validate. Including ones with square brackets in the query section '[]'
+
+
+Known Problems:
+    -None at this time
+
+
+Author(s):
+    Rod Apeldoorn - rod(at)canowhoopass(dot)com
+
+    
+Homepage:
+    <A HREF="http://www.canowhoopass.com/">http://www.canowhoopass.com/</A>
+
+
+Thanks!:
+    -WEAV -Several members of Weav helped to test - <A HREF="http://weav.bc.ca/">http://weav.bc.ca/</A>
+    -There were also a number of emails from other developers expressing
+     thanks and suggestions. It is nice to be appreciated. Thanks!
+
+
+License:
+    Copyright 2004, Rod Apeldoorn
+    
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or (at
+    your option) any later version.
+
+    This program is distributed in the hope that it will be useful, but
+    WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    General Public License for more details.
+
+    You should have received a copy of the GNU General Public License along
+    with this program; if not, write to the Free Software Foundation, Inc.,
+    59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+    To view the license online, go to: <A HREF="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</A>
+
+
+Alternate Commercial Licenses:
+    For information in regards to alternate licensing, contact me.
+*/
+
+
+// BEGINNING OF validateUrlSyntax() function
+function validateUrlSyntax( $urladdr, $options=&quot;&quot; ){
+
+    // Force Options parameter to be lower case
+    // DISABLED PERMAMENTLY - OK to remove from code
+    //    $options = strtolower($options);
+
+    // Check Options Parameter
+    if (!ereg( '^([sHSEFuPaIpfqr][+?-])*$', $options ))
+    {
+        trigger_error(&quot;Options attribute malformed&quot;, E_USER_ERROR);
+    }
+
+    // Set Options Array, set defaults if options are not specified
+    // Scheme
+    if (strpos( $options, 's') === false) $aOptions['s'] = '?';
+    else $aOptions['s'] = substr( $options, strpos( $options, 's') + 1, 1);
+    // <A HREF="http://">http://</A>
+    if (strpos( $options, 'H') === false) $aOptions['H'] = '?';
+    else $aOptions['H'] = substr( $options, strpos( $options, 'H') + 1, 1);
+    // <A HREF="https://">https://</A> (SSL)
+    if (strpos( $options, 'S') === false) $aOptions['S'] = '?';
+    else $aOptions['S'] = substr( $options, strpos( $options, 'S') + 1, 1);
+    // mailto: (email)
+    if (strpos( $options, 'E') === false) $aOptions['E'] = '-';
+    else $aOptions['E'] = substr( $options, strpos( $options, 'E') + 1, 1);
+    // <A HREF="ftp://">ftp://</A>
+    if (strpos( $options, 'F') === false) $aOptions['F'] = '-';
+    else $aOptions['F'] = substr( $options, strpos( $options, 'F') + 1, 1);
+    // User section
+    if (strpos( $options, 'u') === false) $aOptions['u'] = '?';
+    else $aOptions['u'] = substr( $options, strpos( $options, 'u') + 1, 1);
+    // Password in user section
+    if (strpos( $options, 'P') === false) $aOptions['P'] = '?';
+    else $aOptions['P'] = substr( $options, strpos( $options, 'P') + 1, 1);
+    // Address Section
+    if (strpos( $options, 'a') === false) $aOptions['a'] = '+';
+    else $aOptions['a'] = substr( $options, strpos( $options, 'a') + 1, 1);
+    // IP Address in address section
+    if (strpos( $options, 'I') === false) $aOptions['I'] = '?';
+    else $aOptions['I'] = substr( $options, strpos( $options, 'I') + 1, 1);
+    // Port number
+    if (strpos( $options, 'p') === false) $aOptions['p'] = '?';
+    else $aOptions['p'] = substr( $options, strpos( $options, 'p') + 1, 1);
+    // File Path
+    if (strpos( $options, 'f') === false) $aOptions['f'] = '?';
+    else $aOptions['f'] = substr( $options, strpos( $options, 'f') + 1, 1);
+    // Query Section
+    if (strpos( $options, 'q') === false) $aOptions['q'] = '?';
+    else $aOptions['q'] = substr( $options, strpos( $options, 'q') + 1, 1);
+    // Fragment (Anchor)
+    if (strpos( $options, 'r') === false) $aOptions['r'] = '?';
+    else $aOptions['r'] = substr( $options, strpos( $options, 'r') + 1, 1);
+
+
+    // Loop through options array, to search for and replace &quot;-&quot; to &quot;{0}&quot; and &quot;+&quot; to &quot;&quot;
+    foreach($aOptions as $key =&gt; $value)
+    {
+        if ($value == '-')
+        {
+            $aOptions[$key] = '{0}';
+        }
+        if ($value == '+')
+        {
+            $aOptions[$key] = '';
+        }
+    }
+    
+    // DEBUGGING - Unescape following line to display to screen current option values
+    // echo '&lt;pre&gt;'; print_r($aOptions); echo '&lt;/pre&gt;';
+
+
+    // Preset Allowed Characters
+    $alphanum    = '[a-zA-Z0-9]';  // Alpha Numeric
+    $unreserved  = '[a-zA-Z0-9_.!~*' . '\'' . '()-]';
+    $escaped     = '(%[0-9a-fA-F]{2})'; // Escape sequence - In Hex - %6d would be a 'm'
+    $reserved    = '[;/?:@&amp;=+$,]'; // Special characters in the URI
+    
+    // Beginning Regular Expression
+                       // Scheme - Allows for '<A HREF="http://">http://</A>', '<A HREF="https://">https://</A>', 'mailto:', or '<A HREF="ftp://">ftp://</A>'
+    $scheme            = '(';
+    if     ($aOptions['H'] === '') { $scheme .= '<A HREF="http://">http://</A>'; }
+    elseif ($aOptions['S'] === '') { $scheme .= '<A HREF="https://">https://</A>'; }
+    elseif ($aOptions['E'] === '') { $scheme .= 'mailto:'; }
+    elseif ($aOptions['F'] === '') { $scheme .= '<A HREF="ftp://">ftp://</A>'; }
+    else
+    {
+        if ($aOptions['H'] === '?') { $scheme .= '|(<A HREF="http://">http://</A>)'; }
+        if ($aOptions['S'] === '?') { $scheme .= '|(<A HREF="https://">https://</A>)'; }
+        if ($aOptions['E'] === '?') { $scheme .= '|(mailto:)'; }
+        if ($aOptions['F'] === '?') { $scheme .= '|(<A HREF="ftp://">ftp://</A>)'; }
+        $scheme = str_replace('(|', '(', $scheme); // fix first pipe
+    }
+    $scheme            .= ')' . $aOptions['s'];
+    // End setting scheme
+    
+                       // User Info - Allows for 'username@' or 'username:password@'. Note: contrary to rfc, I removed ':' from username section, allowing it only in password.
+                       //   /---------------- Username -----------------------\  /-------------------------------- Password ------------------------------\
+    $userinfo          = '((' . $unreserved . '|' . $escaped . '|[;&amp;=+$,]' . ')+(:(' . $unreserved . '|' . $escaped . '|[;:&amp;=+$,]' . ')+)' . $aOptions['P'] . '@)' . $aOptions['u'];
+    
+                       // IP ADDRESS - Allows 0.0.0.0 to 255.255.255.255
+    $ipaddress         = '((((2(([0-4][0-9])|(5[0-5])))|([01]?[0-9]?[0-9]))\.){3}((2(([0-4][0-9])|(5[0-5])))|([01]?[0-9]?[0-9])))';
+    
+                       // Tertiary Domain(s) - Optional - Multi - Although some sites may use other characters, the RFC says tertiary domains have the same naming restrictions as second level domains
+    $domain_tertiary   = '(' . $alphanum . '(([a-zA-Z0-9-]{0,62})' . $alphanum . ')?\.)*';
+
+                       // Second Level Domain - Required - First and last characters must be Alpha-numeric. Hyphens are allowed inside.
+    $domain_secondary  = '(' . $alphanum . '(([a-zA-Z0-9-]{0,62})' . $alphanum . ')?\.)';
+    
+    /* // This regex is disabled on purpose in favour of the more exact version below
+                       // Top Level Domain - First character must be Alpha. Last character must be AlphaNumeric. Hyphens are allowed inside.
+    $domain_toplevel   = '([a-zA-Z](([a-zA-Z0-9-]*)[a-zA-Z0-9])?)';
+    */
+    
+                       // Top Level Domain - Required - Domain List Current As Of December 2004. Use above escaped line to be forgiving of possible future TLD's
+    $domain_toplevel   = '(aero|biz|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|post|pro|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|az|ax|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)';
+    
+
+                       // Address can be IP address or Domain
+    if ($aOptions['I'] === '{0}') {       // IP Address Not Allowed
+        $address       = '(' . $domain_tertiary . $domain_secondary . $domain_toplevel . ')';
+    } elseif ($aOptions['I'] === '') {  // IP Address Required
+        $address       = '(' . $ipaddress . ')';
+    } else {                            // IP Address Optional
+        $address       = '((' . $ipaddress . ')|(' . $domain_tertiary . $domain_secondary . $domain_toplevel . '))';
+    }
+    $address = $address . $aOptions['a'];
+    
+                       // Port Number - :80 or :8080 or :65534 Allows range of :0 to :65535
+                       //    (0-59999)         |(60000-64999)   |(65000-65499)    |(65500-65529)  |(65530-65535)
+    $port_number       = '(:(([0-5]?[0-9]{1,4})|(6[0-4][0-9]{3})|(65[0-4][0-9]{2})|(655[0-2][0-9])|(6553[0-5])))' . $aOptions['p'];
+    
+                       // Path - Can be as simple as '/' or have multiple folders and filenames
+    $path              = '(/((;)?(' . $unreserved . '|' . $escaped . '|' . '[:@&amp;=+$,]' . ')+(/)?)*)' . $aOptions['f'];
+    
+                       // Query Section - Accepts ?var1=value1&amp;var2=value2 or ?2393,1221 and much more
+    $querystring       = '(\?(' . $reserved . '|' . $unreserved . '|' . $escaped . ')*)' . $aOptions['q'];
+    
+                       // Fragment Section - Accepts anchors such as #top
+    $fragment          = '(#(' . $reserved . '|' . $unreserved . '|' . $escaped . ')*)' . $aOptions['r'];
+    
+    
+    // Building Regular Expression
+    $regexp = '^' . $scheme . $userinfo . $address . $port_number . $path . $querystring . $fragment . '$';
+    
+    // DEBUGGING - Uncomment Line Below To Display The Regular Expression Built
+    // echo '&lt;pre&gt;' . htmlentities(wordwrap($regexp,70,&quot;\n&quot;,1)) . '&lt;/pre&gt;';
+
+    // Running the regular expression
+    if (eregi( $regexp, $urladdr ))
+    {
+        return true; // The domain passed
+    }
+    else
+    {
+        return false; // The domain didn't pass the expression
+    }
+
+} // END Function validateUrlSyntax()
+
+
+
+/*
+About ValidateEmailSyntax():
+    This function uses the ValidateUrlSyntax() function to easily check the
+    syntax of an email address. It accepts the same options as ValidateURLSyntax
+    but defaults them for email addresses.
+
+
+Usage:
+    validateEmailSyntax( url_to_check[, options])
+
+    url_to_check - string - The url to check
+    
+    options - string - A optional string of options to set which parts of
+            the url are required, optional, or not allowed. Each option
+            must be followed by a &quot;+&quot; for required, &quot;?&quot; for optional, or
+            &quot;-&quot; for not allowed. See ValidateUrlSyntax() docs for option list.
+
+    The default options are changed to:
+        s-H-S-E+F-u+P-a+I-p-f-q-r-
+
+    This only allows an address of &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">name at domain</A>&quot;.
+
+Examples:
+    validateEmailSyntax('<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">george at fakemail.com</A>')
+    validateEmailSyntax('mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">george at fakemail.com</A>', 's+')
+    validateEmailSyntax('<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">george at fakemail.com</A>?subject=Hi%20George', 'q?')
+    validateEmailSyntax('<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">george at 212.198.33.12</A>', 'I?')
+    
+
+
+Author(s):
+    Rod Apeldoorn - rod(at)canowhoopass(dot)com
+
+    
+Homepage:
+    <A HREF="http://www.canowhoopass.com/">http://www.canowhoopass.com/</A>
+
+
+License:
+    Copyright 2004 - Rod Apeldoorn
+
+    Released under same license as validateUrlSyntax(). For details, contact me.
+
+
+*/
+
+function validateEmailSyntax( $emailaddr, $options=&quot;&quot; ){
+
+    // Check Options Parameter
+    if (!ereg( '^([sHSEFuPaIpfqr][+?-])*$', $options ))
+    {
+        trigger_error(&quot;Options attribute malformed&quot;, E_USER_ERROR);
+    }
+
+    // Set Options Array, set defaults if options are not specified
+    // Scheme
+    if (strpos( $options, 's') === false) $aOptions['s'] = '-';
+    else $aOptions['s'] = substr( $options, strpos( $options, 's') + 1, 1);
+    // <A HREF="http://">http://</A>
+    if (strpos( $options, 'H') === false) $aOptions['H'] = '-';
+    else $aOptions['H'] = substr( $options, strpos( $options, 'H') + 1, 1);
+    // <A HREF="https://">https://</A> (SSL)
+    if (strpos( $options, 'S') === false) $aOptions['S'] = '-';
+    else $aOptions['S'] = substr( $options, strpos( $options, 'S') + 1, 1);
+    // mailto: (email)
+    if (strpos( $options, 'E') === false) $aOptions['E'] = '?';
+    else $aOptions['E'] = substr( $options, strpos( $options, 'E') + 1, 1);
+    // <A HREF="ftp://">ftp://</A>
+    if (strpos( $options, 'F') === false) $aOptions['F'] = '-';
+    else $aOptions['F'] = substr( $options, strpos( $options, 'F') + 1, 1);
+    // User section
+    if (strpos( $options, 'u') === false) $aOptions['u'] = '+';
+    else $aOptions['u'] = substr( $options, strpos( $options, 'u') + 1, 1);
+    // Password in user section
+    if (strpos( $options, 'P') === false) $aOptions['P'] = '-';
+    else $aOptions['P'] = substr( $options, strpos( $options, 'P') + 1, 1);
+    // Address Section
+    if (strpos( $options, 'a') === false) $aOptions['a'] = '+';
+    else $aOptions['a'] = substr( $options, strpos( $options, 'a') + 1, 1);
+    // IP Address in address section
+    if (strpos( $options, 'I') === false) $aOptions['I'] = '-';
+    else $aOptions['I'] = substr( $options, strpos( $options, 'I') + 1, 1);
+    // Port number
+    if (strpos( $options, 'p') === false) $aOptions['p'] = '-';
+    else $aOptions['p'] = substr( $options, strpos( $options, 'p') + 1, 1);
+    // File Path
+    if (strpos( $options, 'f') === false) $aOptions['f'] = '-';
+    else $aOptions['f'] = substr( $options, strpos( $options, 'f') + 1, 1);
+    // Query Section
+    if (strpos( $options, 'q') === false) $aOptions['q'] = '-';
+    else $aOptions['q'] = substr( $options, strpos( $options, 'q') + 1, 1);
+    // Fragment (Anchor)
+    if (strpos( $options, 'r') === false) $aOptions['r'] = '-';
+    else $aOptions['r'] = substr( $options, strpos( $options, 'r') + 1, 1);
+
+    // Generate options
+    $newoptions = '';
+    foreach($aOptions as $key =&gt; $value)
+    {
+        $newoptions .= $key . $value;
+    }
+
+    // DEBUGGING - Uncomment line below to display generated options
+    // echo '&lt;pre&gt;' . $newoptions . '&lt;/pre&gt;';
+
+    // Send to validateUrlSyntax() and return result
+    return validateUrlSyntax( $emailaddr, $newoptions);
+
+} // END Function validateEmailSyntax()
+
+
+
+/*
+About ValidateFtpSyntax():
+    This function uses the ValidateUrlSyntax() function to easily check the
+    syntax of an FTP address. It accepts the same options as ValidateURLSyntax
+    but defaults them for FTP addresses.
+
+
+Usage:
+    validateFtpSyntax( url_to_check[, options])
+
+    url_to_check - string - The url to check
+    
+    options - string - A optional string of options to set which parts of
+            the url are required, optional, or not allowed. Each option
+            must be followed by a &quot;+&quot; for required, &quot;?&quot; for optional, or
+            &quot;-&quot; for not allowed. See ValidateUrlSyntax() docs for option list.
+
+    The default options are changed to:
+        s?H-S-E-F+u?P?a+I?p?f?q-r-
+
+Examples:
+    validateFtpSyntax('<A HREF="ftp://netscape.com">ftp://netscape.com</A>')
+    validateFtpSyntax('moz:<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">iesucks at netscape.com</A>')
+    validateFtpSyntax('<A HREF="ftp://netscape.com:2121/browsers/ns7/">ftp://netscape.com:2121/browsers/ns7/</A>', 'u-')
+
+
+Author(s):
+    Rod Apeldoorn - rod(at)canowhoopass(dot)com
+
+
+Homepage:
+    <A HREF="http://www.canowhoopass.com/">http://www.canowhoopass.com/</A>
+
+
+License:
+    Copyright 2004 - Rod Apeldoorn
+
+    Released under same license as validateUrlSyntax(). For details, contact me.
+*/
+
+function validateFtpSyntax( $ftpaddr, $options=&quot;&quot; ){
+
+    // Check Options Parameter
+    if (!ereg( '^([sHSEFuPaIpfqr][+?-])*$', $options ))
+    {
+        trigger_error(&quot;Options attribute malformed&quot;, E_USER_ERROR);
+    }
+
+    // Set Options Array, set defaults if options are not specified
+    // Scheme
+    if (strpos( $options, 's') === false) $aOptions['s'] = '?';
+    else $aOptions['s'] = substr( $options, strpos( $options, 's') + 1, 1);
+    // <A HREF="http://">http://</A>
+    if (strpos( $options, 'H') === false) $aOptions['H'] = '-';
+    else $aOptions['H'] = substr( $options, strpos( $options, 'H') + 1, 1);
+    // <A HREF="https://">https://</A> (SSL)
+    if (strpos( $options, 'S') === false) $aOptions['S'] = '-';
+    else $aOptions['S'] = substr( $options, strpos( $options, 'S') + 1, 1);
+    // mailto: (email)
+    if (strpos( $options, 'E') === false) $aOptions['E'] = '-';
+    else $aOptions['E'] = substr( $options, strpos( $options, 'E') + 1, 1);
+    // <A HREF="ftp://">ftp://</A>
+    if (strpos( $options, 'F') === false) $aOptions['F'] = '+';
+    else $aOptions['F'] = substr( $options, strpos( $options, 'F') + 1, 1);
+    // User section
+    if (strpos( $options, 'u') === false) $aOptions['u'] = '?';
+    else $aOptions['u'] = substr( $options, strpos( $options, 'u') + 1, 1);
+    // Password in user section
+    if (strpos( $options, 'P') === false) $aOptions['P'] = '?';
+    else $aOptions['P'] = substr( $options, strpos( $options, 'P') + 1, 1);
+    // Address Section
+    if (strpos( $options, 'a') === false) $aOptions['a'] = '+';
+    else $aOptions['a'] = substr( $options, strpos( $options, 'a') + 1, 1);
+    // IP Address in address section
+    if (strpos( $options, 'I') === false) $aOptions['I'] = '?';
+    else $aOptions['I'] = substr( $options, strpos( $options, 'I') + 1, 1);
+    // Port number
+    if (strpos( $options, 'p') === false) $aOptions['p'] = '?';
+    else $aOptions['p'] = substr( $options, strpos( $options, 'p') + 1, 1);
+    // File Path
+    if (strpos( $options, 'f') === false) $aOptions['f'] = '?';
+    else $aOptions['f'] = substr( $options, strpos( $options, 'f') + 1, 1);
+    // Query Section
+    if (strpos( $options, 'q') === false) $aOptions['q'] = '-';
+    else $aOptions['q'] = substr( $options, strpos( $options, 'q') + 1, 1);
+    // Fragment (Anchor)
+    if (strpos( $options, 'r') === false) $aOptions['r'] = '-';
+    else $aOptions['r'] = substr( $options, strpos( $options, 'r') + 1, 1);
+
+    // Generate options
+    $newoptions = '';
+    foreach($aOptions as $key =&gt; $value)
+    {
+        $newoptions .= $key . $value;
+    }
+
+    // DEBUGGING - Uncomment line below to display generated options
+    // echo '&lt;pre&gt;' . $newoptions . '&lt;/pre&gt;';
+
+    // Send to validateUrlSyntax() and return result
+    return validateUrlSyntax( $ftpaddr, $newoptions);
+
+} // END Function validateFtpSyntax()
+
+?&gt;

Added: trunk/inc/sm-lib-functions_backup.php
===================================================================
--- trunk/inc/sm-lib-functions_backup.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/sm-lib-functions_backup.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,1299 @@
+&lt;?php
+require_once(&quot;class.phpmailer.php&quot;);
+
+/**
+*   make sure all input works as expected,
+*   by undoing the possible magic_quotes directive.
+*   Now every single variable will be free from slashed and needs to be
+*   manually escaped.
+*   code origin: <A HREF="http://nl3.php.net/manual/en/function.get-magic-quotes-gpc.php">http://nl3.php.net/manual/en/function.get-magic-quotes-gpc.php</A>
+*/
+if (get_magic_quotes_gpc()) {
+   function stripslashes_deep($value)
+   {
+       $value = is_array($value) ?
+                   array_map('stripslashes_deep', $value) :
+                   stripslashes($value);
+
+       return $value;
+   }
+
+   $_POST       = array_map('stripslashes_deep', $_POST);
+   $_GET         = array_map('stripslashes_deep', $_GET);
+   $_COOKIE   = array_map('stripslashes_deep', $_COOKIE);
+   $_REQUEST = array_map('stripslashes_deep', $_COOKIE);
+}
+
+
+
+/**
+*   check if input is valid according to a string of valid chars
+*/
+function CheckInputValid($str,$maxlength = &quot;&quot;)
+{
+    //making it case independent
+    $str = strtolower($str);
+    $validmask  =&quot;abcdefghijklmnopqrstuvwxyz0123456789_-.@ '&quot;;
+    if ($maxlength == &quot;&quot;) {
+        if (strspn($str, $validmask) == strlen($str)) {
+            return true;
+        } else {
+            return false;
+        }
+    } else {
+        $validlength = $maxlength;
+        if (strspn($str, $validmask) == strlen($str) &amp;&amp; $validlength &gt;= strlen($str)) {
+           return true;
+        } else {
+           return false;
+        }
+    }
+}
+
+
+function checkContainsAlfaNum($input) {
+	$output = eregi(&quot;[a-z0-9]&quot;, $input)? true : false;
+	return $output;
+}
+
+/**
+* A username consists of at least 4 and a maximum of 16 
+* alfanumeric chars. The first on may not be a number
+**/
+function checkUsernameValid($uname)
+{
+    $len = strlen($uname);
+    if($len &gt;= 4 &amp;&amp; $len &lt;= 16 ) {   
+        $uname = strtolower($uname);
+        $status = eregi(&quot;^[a-z][a-z0-9]&quot;, $uname)? true : false;
+        return $status;
+    } else {
+        return false; 
+    }    
+}
+
+function checkPasswordValid($pwd)
+{
+    $validmask=&quot;abcdefghijklmnopqrstuvwxyz0123456789_-@&quot;; 
+    $len = strlen($pwd);
+    
+    if($len &gt;= 6 &amp;&amp; $len &lt;= 16 ) {   
+        $pwd = strtolower($pwd);
+        if (strspn($pwd, $validmask) == strlen($pwd)) {
+            return true;
+        } else {
+            return false;
+        }
+    } else {
+        return false; 
+    }    
+}
+
+
+function sendFeedback($email_to, $subject, $message) {
+	//sent BCC to
+    $bcc = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">bjorn at waag.org</A>&quot;;
+    
+                                   
+	//insert succesfull, send email for confirmation
+	$mail = new PHPMailer();
+	$mail-&gt;IsSendmail();
+	$mail-&gt;AddAddress($email_to);
+	$mail-&gt;AddBCC($bcc);
+	$mail-&gt;FromName = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">simuzerobot at simuze.com</A>&quot;;
+	$mail-&gt;From = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">simuzerobot at simuze.com</A>&quot;;
+	$mail-&gt;Subject = $subject;
+	$mail-&gt;Body = $message;
+		
+	if(!$mail-&gt;Send())
+	{
+		return true;
+	}
+	else
+	{
+		return false;
+	}
+}
+
+
+
+
+
+
+/** encrypts the $value with the $alg */
+function CryptIt($alg, $value)
+{
+    switch($alg) {
+    
+        case &quot;md5&quot;:
+            $value = md5($value);
+            return $value;
+        break;    
+    }
+
+}
+
+
+/** creates a random string */
+function rndString($string_length = 6)
+{
+    // uses the decimal acsii numbers to produce a random string
+    //<A HREF="http://www.asciitable.com/">http://www.asciitable.com/</A> 
+    $min  = 48;
+    $max = 90;
+    
+    for($i = 0 ; $i &lt; $string_length; $i++){
+       $rand =  mt_rand($min,$max);
+       
+       if($rand &gt; 57 &amp;&amp; $rand &lt;= 63){
+           $rand = mt_rand(48,57);
+       }
+       $str .= chr($rand);
+    }
+    $str = strtolower($str);
+    return $str;
+}
+
+
+
+/**
+*
+* expects a timestamp(8) which
+* looks like YYYYMMDD and returns
+* an array like this this:
+* $arr['year'] = YYYY
+* $arr['month'] = MM
+* $arr['day'] = DD
+**/
+function extractTimestamp($timestamp)
+{
+    $birthdate = array();
+    //format is YYYYMMDD
+    if(strlen($timestamp) == 8) {
+        $tmp_yyyy_mmdd = chunk_split ( $timestamp , 4 ,&quot;-&quot; ); // YYYYMMDD becomes YYYY-MMDD
+        $tmp_arr =  explode(&quot;-&quot;, $tmp_yyyy_mmdd);
+        //we freed the year...YAHOO
+        $birthdate[&quot;year&quot;] = $tmp_arr[0];
+        //continue to process MMDD into MM-DD
+        $tmp_mm_dd = chunk_split ( $tmp_arr[1] , 2 ,&quot;-&quot; );
+        $tmp_arr2 =  explode(&quot;-&quot;, $tmp_mm_dd);
+        $birthdate[&quot;month&quot;] = $tmp_arr2[0];
+        $birthdate[&quot;day&quot;] = $tmp_arr2[1];
+        return $birthdate;
+    } else {
+        return false;
+    }
+}
+
+
+/**
+*   process a DATE YYYY-MM-DD
+*   into 
+* an array like this this:
+* $arr['year'] = YYYY
+* $arr['month'] = MM
+* $arr['day'] = DD
+**/
+function extractDate($date)
+{
+    if(strlen($date) == 10) {
+        $birthdate = array();
+        //format is YYYY-MM-DD
+        $tmp_arr =  explode(&quot;-&quot;, $date);
+        $birthdate[&quot;year&quot;]  = $tmp_arr[0];
+        $birthdate[&quot;month&quot;] = $tmp_arr[1];
+        $birthdate[&quot;day&quot;]   = $tmp_arr[2];
+        return $birthdate;
+    } else {
+        return false;
+    }
+}
+
+
+
+
+
+/**
+* creates a select box (selmonth)
+* with months. Options to be 
+* set in the param array:
+*
+* key:value (possibilities)
+*
+* selected:1 (1~12) default is none and this will trigger a text as default (lang specific)
+* lang:NL (NL, EN); default is EN
+* view:ftext (ftext, text,lnr) default is numeric months without leading zero
+**/
+function createSelectMonth($params)
+{
+    if(is_array($params)) { 
+        
+        $monthsNL = array(&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mrt&quot;, &quot;Apr&quot;, &quot;Mei&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sept&quot;, &quot;Okt&quot;, &quot;Nov&quot;, &quot;Dec&quot;);
+        $monthsEN = array(&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sept&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;);
+       
+        $monthsfullNL = array(&quot;Januari&quot;, &quot;Februari&quot;, &quot;Maart&quot;, &quot;April&quot;, &quot;Mei&quot;, &quot;Juni&quot;, &quot;Juli&quot;, &quot;Augustus&quot;, &quot;September&quot;, &quot;Oktober&quot;, &quot;November&quot;, &quot;December&quot;);
+        $monthsfullEN = array(&quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;, &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;, &quot;October&quot;, &quot;November&quot;, &quot;December&quot;);
+        $html .= '&lt;select name=&quot;selmonth&quot; id=&quot;selmonth&quot;&gt;'.&quot;\n&quot;;
+        
+        switch($params['lang']) {
+            case &quot;NL&quot;:
+                $msg = 'Maand';
+                switch($params['view']) {
+                    //shortext
+                    case &quot;text&quot;:
+                      if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                      } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                      }
+                      
+                      $j = 0;
+                      for($i = 1; $i &lt;= 12; $i++) {
+                          if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                          if($params['selected'] == $i &amp;&amp; !$selected) {
+                              $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$monthsNL[$j]&lt;/option&gt;\n&quot;;
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$monthsNL[$j]&lt;/option&gt;\n&quot;;
+                          }
+                          $j++;
+                      }
+                    break;
+                     //fullext
+                    case &quot;ftext&quot;:
+                        if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                      } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                      }
+                      $j = 0;
+                      for($i = 1; $i &lt;= 12; $i++) {
+                          
+                          if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                          if($params['selected'] == $i &amp;&amp; !$selected) {
+                              $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$monthsfullNL[$j]&lt;/option&gt;\n&quot;;
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$monthsfullNL[$j]&lt;/option&gt;\n&quot;;
+                          }
+                          $j++;
+                      }
+                    break;
+                    //default numeric months
+                    default:
+                          if(empty($params['selected'])) {
+                              $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                              $selected = true; 
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          }
+                        for($i = 1; $i &lt;= 12; $i++) {
+                            if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                            if($params['selected'] == $i &amp;&amp; !$selected) {
+                                $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                            } else {
+                                $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                            }
+                        }
+                    break;
+                }
+            break;
+            //default language is English
+            default:
+                $msg = 'Month';
+                switch($params['view']) {
+                    //shortext
+                    case &quot;text&quot;:
+                      if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                      } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                      }
+                      $j = 0;
+                      for($i = 1; $i &lt;= 12; $i++) {
+                          if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                          if($params['selected'] == $i &amp;&amp; !$selected) {
+                              $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$monthsEN[$j]&lt;/option&gt;\n&quot;;
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$monthsEN[$j]&lt;/option&gt;\n&quot;;
+                          }
+                          $j++;  
+                      }
+                    break;
+                     //fullext
+                    case &quot;ftext&quot;:
+                      if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                      } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                      }
+                      $j = 0;
+                      for($i = 1; $i &lt;= 12; $i++) {
+                          if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                          if($params['selected'] == $i &amp;&amp; !$selected) {
+                              $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$monthsfullEN[$j]&lt;/option&gt;\n&quot;;
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$monthsfullEN[$j]&lt;/option&gt;\n&quot;;
+                          }
+                          $j++;
+                      }
+                    break;
+                    //default numeric months
+                    default:
+                       if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                        } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                        }
+                        for($i = 1; $i &lt;= 12; $i++) {
+                            if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                            if($params['selected'] == $i &amp;&amp; !$selected) {
+                                $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                            } else {
+                                $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                            }
+                        }
+                    break;
+                }
+            break;  
+        }
+        $html .='&lt;/select&gt;';
+        return $html;
+    } else {
+        return false;
+    }     
+}
+
+
+/**
+* creates a select box (seldaymonth)
+* with days. Options to be 
+* set in the params array:
+*
+* key:value (possibilities)
+*
+* NOTE: currently we're not taking any
+* leap years into account. And we'll set all months
+* with 31 days. This will get fixed in the (near) future 
+* 
+* selected:12 (selected day of the month)
+* lang:NL (NL, EN); default is EN
+* 
+**/
+function createSelectDayMonth($params) {
+    if(is_array($params)) {    
+        $start = 1;
+        $end = 31;
+        $html  .= '&lt;select name=&quot;seldaymonth&quot; id=&quot;seldaymonth&quot;&gt;' .&quot;\n&quot;;
+        
+        switch($params['lang']) {
+            case &quot;NL&quot;:
+                $msg = 'Dag';
+                if(empty($params['selected'])) {
+                    $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                    $selected = true; 
+                } else {
+                    $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                }
+                for($i = $start; $i &lt;= $end; $i++ ) {
+                    if($i &lt; 10) {
+                        $i = &quot;0&quot; .$i;
+                    }
+                    if($params['selected'] == $i) {
+                        $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    } else {
+                        $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    }
+                }    
+            break;
+            //default language is English
+            default:
+                $msg = 'Day';
+                if(empty($params['selected'])) {
+                    $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                    $selected = true; 
+                } else {
+                    $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                }
+                for($i = $start; $i &lt;= $end; $i++ ) {
+                    if($i &lt; 10) {
+                        $i = &quot;0&quot; .$i;
+                    }
+                    if($params['selected'] == $i) {
+                        $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    } else {
+                        $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    }
+                }
+            break;
+        }
+        $html .= '&lt;/select&gt;';
+        return $html;
+    } else {
+        return false;
+    }
+}
+
+
+function createSelectGenre($name = 'undefined') {
+	if($name != 'undefined') {
+		$genre = null;
+		$genre .= &quot;&lt;label for=\&quot;$name\&quot;&gt;Kies een genre:&lt;/label&gt;\n&quot;;
+		$genre .= &quot;&lt;select class=\&quot;commentaar_input\&quot; name=\&quot;$name\&quot;&gt;\n&quot;;
+		$genre .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;::maak keuze::&lt;/option&gt;\n&quot;;
+		$genre_handle = qGetGenre();
+		$nr_genre = mysql_num_rows($genre_handle);
+		if($nr_genre &gt; 0) {
+			for($i = 0; $i &lt; $nr_genre; $i++) {
+				$g = mysql_fetch_array($genre_handle);
+				$genre .=&quot;&lt;option value=\&quot;$g[genre_id]\&quot;&gt;$g[genre_name]&lt;/option&gt;&quot;;        
+			}
+		$genre .=&quot;&lt;/select&gt;&lt;br /&gt;&quot;;
+		} else {
+			$genre .=&quot;&lt;option value=\&quot;problem\&quot;&gt;Genre db probleem&lt;/option&gt;&quot;; 
+		}
+	
+	} else {
+		$genre = null;
+		$genre .= &quot;&lt;label for=\&quot;genre\&quot;&gt;Kies een genre:&lt;/label&gt;\n&quot;;
+		$genre .= &quot;&lt;select class=\&quot;commentaar_input\&quot; name=\&quot;genre\&quot;&gt;\n&quot;;
+		$genre .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;::maak keuze::&lt;/option&gt;\n&quot;;
+		$genre_handle = qGetGenre();
+		$nr_genre = mysql_num_rows($genre_handle);
+		if($nr_genre &gt; 0) {
+			for($i = 0; $i &lt; $nr_genre; $i++) {
+				$g = mysql_fetch_array($genre_handle);
+				$genre .=&quot;&lt;option value=\&quot;$g[genre_id]\&quot;&gt;$g[genre_name]&lt;/option&gt;&quot;;        
+			}
+		$genre .=&quot;&lt;/select&gt;&lt;br /&gt;&quot;;
+		} else {
+			$genre .=&quot;&lt;option value=\&quot;problem\&quot;&gt;Genre db probleem&lt;/option&gt;&quot;; 
+		}
+	}
+	
+	return $genre;
+}
+
+function createMoodSearch() {
+$mood_handle = qGetMoods();
+$nr_mood = mysql_num_rows($mood_handle);
+$moodsearch .= &quot;&lt;table name=\&quot;moodsearch\&quot; border=\&quot;0\&quot; bordercolor=\&quot;#000000\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;2\&quot;&gt;&quot;;
+	if($nr_mood &gt; 0) {
+		for($i=0;$i&lt;$nr_mood;$i++) {
+			$mood = mysql_fetch_array($mood_handle);
+			$moodname = $mood['mood_description_name'];
+			$mid = $mood['mood_description_id'];
+			$l1  = $mood['mood_description_label1'];
+			$l2  = $mood['mood_description_label2'];
+			$l3  = $mood['mood_description_label3'];
+			$l4  = $mood['mood_description_label4'];
+			$l5  = $mood['mood_description_label5'];
+			$v1  = $mood['mood_description_value1'];
+			$v2  = $mood['mood_description_value2'];
+			$v3  = $mood['mood_description_value3'];
+			$v4  = $mood['mood_description_value4'];
+			$v5  = $mood['mood_description_value5'];
+			$unique = $mid + $i; 
+			
+			$moodsearch .=&quot;&lt;tr bgcolor=\&quot;#F8E4B3\&quot;&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;td&gt;$moodname&lt;/td&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;td&gt;$l1&lt;/td&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;td&gt;$l2&lt;/td&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;td&gt;$l3&lt;/td&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;td&gt;$l4&lt;/td&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;td&gt;$l5&lt;/td&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;/tr&gt;\n&quot;;
+					
+			$moodsearch .=&quot;&lt;tr&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;td&gt;maak keuze:&lt;/td&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;td&gt;&lt;input type=\&quot;radio\&quot;  name=\&quot;moods[$mid]\&quot; value=\&quot;$v1\&quot; /&gt;&lt;/td&gt;\n&quot;;
+			$moodsearch .= &quot;&lt;td&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; value=\&quot;$v2\&quot; /&gt;&lt;/td&gt;\n&quot;;
+			$moodsearch .= &quot;&lt;td&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; checked=\&quot;checked\&quot; value=\&quot;$v3\&quot; /&gt;&lt;/td&gt;\n&quot;;
+			$moodsearch .= &quot;&lt;td&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; value=\&quot;$v4\&quot; /&gt;&lt;/td&gt;\n&quot;;
+			$moodsearch .= &quot;&lt;td&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; value=\&quot;$v5\&quot; /&gt;&lt;/td&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;/tr&gt;\n&quot;;
+		}
+	$moodsearch .= &quot;&lt;/table&gt;&quot;;    
+	} else {
+		$moodsearch .= &quot;geen moods aanwezig&quot;;
+	}
+return $moodsearch;	
+}
+
+
+function createSelectTag($name = 'undefined') {
+	if($name != 'undefined') {
+		$tag = null;
+		$tag .= &quot;&lt;select class=\&quot;commentaar_input\&quot; name=\&quot;$name\&quot;&gt;\n&quot;;
+		$tag .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;::maak keuze::&lt;/option&gt;\n&quot;;
+		$tag_handle = qGetTagsIncUsage();
+		$nr_tag = mysql_num_rows($tag_handle);
+		if($nr_tag &gt; 0) {
+			for($i = 0; $i &lt; $nr_tag; $i++) {
+				$g = mysql_fetch_array($tag_handle);
+				$nrs = $g['COUNT(*)'];
+				$tag .=&quot;&lt;option value=\&quot;$g[tag_id]\&quot;&gt;$g[tag_name]      -- $nrs nummers gevonden&lt;/option&gt;&quot;;        
+			}
+		$tag .=&quot;&lt;/select&gt;&lt;br /&gt;&quot;;
+		} else {
+			$tag .=&quot;&lt;option value=\&quot;problem\&quot;&gt;Tag db probleem&lt;/option&gt;&quot;; 
+		}
+	
+	} else {
+		$tag = null;
+		$tag .= &quot;&lt;label for=\&quot;tag\&quot;&gt;Kies een tag:&lt;/label&gt;\n&quot;;
+		$tag .= &quot;&lt;select class=\&quot;commentaar_input\&quot; name=\&quot;tag\&quot;&gt;\n&quot;;
+		$tag .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;::maak keuze::&lt;/option&gt;\n&quot;;
+		$tag_handle = qGetTagsIncUsage();
+		$nr_tag = mysql_num_rows($tag_handle);
+		if($nr_tag &gt; 0) {
+			for($i = 0; $i &lt; $nr_tag; $i++) {
+				$g = mysql_fetch_array($tag_handle);
+				$nrs = $g['COUNT(*)'];
+				$tag .=&quot;&lt;option value=\&quot;$g[tag_id]\&quot;&gt;$g[tag_name] -- $nrs nummers gevonden&lt;/option&gt;&quot;;       
+			}
+		$tag .=&quot;&lt;/select&gt;&lt;br /&gt;&quot;;
+		} else {
+			$tag .=&quot;&lt;option value=\&quot;problem\&quot;&gt;Tag db probleem&lt;/option&gt;&quot;; 
+		}
+	}
+	
+	return $tag;
+}
+
+
+
+
+
+/**
+* creates a select box (selyear)
+* with months. Options to be 
+* set in the param array:
+*
+* key:value (possibilities)
+*
+* start:1900 (start year)
+* end:2005 (end year inclusive)
+* lang:NL (NL, EN); default is EN
+* selected:2003 (selected year)
+* 
+**/
+function createSelectYear($params) {
+    if(is_array($params)) {    
+        
+        $start  = $params['start'];
+        $end    = $params['end'];
+        $html  .= '&lt;select name=&quot;selyear&quot; id=&quot;selyear&quot;&gt;'.&quot;\n&quot;;
+        
+        switch($params['lang']) {
+            case &quot;NL&quot;:
+                $msg = 'Jaar';
+                if(empty($params['selected'])) {
+                    $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                    $selected = true; 
+                } else {
+                    $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                }
+                for($i = $start; $i &lt;= $end; $i++ ) {
+                    if($params['selected'] == $i) {
+                        $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    } else {
+                        $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    }
+                }    
+            break;
+            //default language is English
+            default:
+                $msg = 'Year';
+                if(empty($params['selected'])) {
+                    $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                    $selected = true; 
+                } else {
+                    $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                }
+                for($i = $start; $i &lt;= $end; $i++ ) {
+                    if($params['selected'] == $i) {
+                        $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    } else {
+                        $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    }
+                }
+            break;
+        }
+        $html .= '&lt;/select&gt;';
+        return $html;
+    } else {
+        return false;
+    }
+}
+
+
+/**
+* creates a select box (selprovincie)
+* with Dutch provincies. 
+* sel (1~12) default is none is none and this will trigger a text as default
+*
+**/
+function createSelectProvincies($sel) {
+    $msg = 'Kies een provincie';
+    $html .= '&lt;select name=&quot;selprovincie&quot; id=&quot;selprovincie&quot;&gt;'.&quot;\n&quot;;
+    $provincies = array(&quot;Drenthe&quot;,&quot;Overijssel&quot;, &quot;Utrecht&quot;, &quot;Flevoland&quot;, &quot;Noord-Holland&quot;,&quot;Zuid-Holland&quot;, &quot;Limburg&quot;, &quot;Zeeland&quot;, &quot;Gelderland&quot;, &quot;Groningen&quot;, &quot;Friesland&quot;, &quot;Brabant&quot;);
+
+    //sort provincies into alphabetical order
+    sort($provincies);
+    reset($provincies);
+    if(empty($sel)){
+        $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+        $selected = true;
+    } else {
+         $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+    }
+    
+    for($i = 0; $i &lt; 12; $i++) {
+        if($sel == $provincies[$i] &amp;&amp; !$selected) {
+            $html .= &quot;&lt;option selected value=\&quot;$provincies[$i]\&quot;&gt;$provincies[$i]&lt;/option&gt;\n&quot;;
+        } else {
+            $html .= &quot;&lt;option value=\&quot;$provincies[$i]\&quot;&gt;$provincies[$i]&lt;/option&gt;\n&quot;;
+        }    
+    }
+    $html .= '&lt;/select&gt;'.&quot;\n&quot;;
+    return $html;
+}
+
+
+if (!function_exists('getmicrotime')) {
+	function getmicrotime() {
+		list($usec, $sec) = explode(' ', microtime());
+		return ((float) $usec + (float) $sec);
+	}
+}
+
+
+
+
+function checkFilename($str) {
+    $str = strtolower($str);
+    $validmask  =&quot;abcdefghijklmnopqrstuvwxyz0123456789_- .&quot;;
+    if (strspn($str, $validmask) == strlen($str)) {
+        return true;
+    } else {
+        return false;
+    }
+}
+
+
+
+/**
+*   check if input is valid according to a string of valid chars
+*/
+function checkTextValid($str,$maxlength = &quot;&quot;)
+{   //making it case independent
+    $str = strtolower($str);
+    
+    $apo = &quot;'&quot;;
+    $newlines = &quot;\n\r&quot;;
+    
+    $validmask .= $apo;
+    $validmask .= $newlines;
+    $validmask .='abcdefghijklmnopqrstuvwxyz0123456789_,-.@ +=#%&amp;*$!?():;&quot;';
+    
+    
+    if ($maxlength == &quot;&quot;) {
+        if (strspn($str, $validmask) == strlen($str)) {
+            return true;
+        } else {
+            return false;
+        }
+    
+    } else {
+        $validlength = $maxlength;
+        if (strspn($str, $validmask) == strlen($str) &amp;&amp; $validlength &gt;= strlen($str)) {
+           return true;
+        } else {
+           return false;
+        }
+    }
+}
+
+/**
+* Author: Roel Duysserinck
+* <A HREF="http://faq.web-con.nl/">http://faq.web-con.nl/</A>
+**/
+function checkPostcode($postcode)
+{
+    // Format: 1234 XX of 1234XX
+    $status = (eregi (&quot;[0-9]{4}[[:space:]]*[A-Za-z]{2}&quot;, $postcode))? true : false;
+    // true if postcode is correct
+    // false if postcode is correct
+    return $status;
+}
+
+
+/*
+Functions Included In This File:
+    validateUrlSyntax()
+    validateEmailSyntax()
+    validateFtpSyntax()
+*/
+
+/*
+About validateUrlSyntax():
+    This function will verify if a http URL is formatted properly, returning
+    either with true or false.
+    
+    I used rfc #2396 URI: Generic Syntax as my guide when creating the
+    regular expression. For all the details see the comments below.
+
+
+Usage:
+    validateUrlSyntax( url_to_check[, options])
+
+    url_to_check - string - The url to check
+    
+    options - string - A optional string of options to set which parts of
+            the url are required, optional, or not allowed. Each option
+            must be followed by a &quot;+&quot; for required, &quot;?&quot; for optional, or
+            &quot;-&quot; for not allowed.
+
+            s - Scheme. Allows &quot;+?-&quot;, defaults to &quot;s?&quot;
+                H - <A HREF="http://">http://</A> Allows &quot;+?-&quot;, defaults to &quot;H?&quot;
+                S - <A HREF="https://">https://</A> (SSL). Allows &quot;+?-&quot;, defaults to &quot;S?&quot;
+                E - mailto: (email). Allows &quot;+?-&quot;, defaults to &quot;E-&quot;
+                F - <A HREF="ftp://">ftp://</A> Allows &quot;+?-&quot;, defaults to &quot;F-&quot;
+                    Dependant on scheme being enabled
+            u - User section. Allows &quot;+?-&quot;, defaults to &quot;u?&quot;
+                P - Password in user section. Allows &quot;+?-&quot;, defaults to &quot;P?&quot;
+                    Dependant on user section being enabled
+            a - Address (ip or domain). Allows &quot;+?-&quot;, defaults to &quot;a+&quot;
+                I - Ip address. Allows &quot;+?-&quot;, defaults to &quot;I?&quot;
+                    If I+, then domains are disabled
+                    If I-, then domains are required
+                    Dependant on address being enabled
+            p - Port number. Allows &quot;+?-&quot;, defaults to &quot;p?&quot;
+            f - File path. Allows &quot;+?-&quot;, defaults to &quot;f?&quot;
+            q - Query section. Allows &quot;+?-&quot;, defaults to &quot;q?&quot;
+            r - Fragment (anchor). Allows &quot;+?-&quot;, defaults to &quot;r?&quot;
+
+    Paste the funtion code, or include_once() this template at the top of the page
+    you wish to use this function.
+
+
+Examples:
+    validateUrlSyntax('<A HREF="http://george@www.cnn.com/#top">http://george@www.cnn.com/#top</A>')
+
+    validateUrlSyntax('<A HREF="https://games.yahoo.com:8080/board/chess.htm?move=true">https://games.yahoo.com:8080/board/chess.htm?move=true</A>')
+
+    validateUrlSyntax('<A HREF="http://www.hotmail.com/">http://www.hotmail.com/</A>', 's+u-I-p-q-r-')
+
+    validateUrlSyntax('/directory/file.php#top', 's-u-a-p-f+')
+
+
+    if (validateUrlSyntax('<A HREF="http://www.canowhoopass.com/">http://www.canowhoopass.com/</A>', 'u-'))
+    {
+        echo 'URL SYNTAX IS VERIFIED';
+    } else {
+        echo 'URL SYNTAX IS ILLEGAL';
+    }
+
+
+Last Edited:
+    December 15th 2004
+
+
+Changelog:
+    December 15th 2004
+      -Added new TLD's - .jobs, .mobi, .post and .travel. They are official, but not yet active.
+
+    August 31th 2004
+      -Fixed bug allowing empty username even when it was required
+      -Changed and added a few options to add extra schemes
+      -Added mailto: <A HREF="ftp://">ftp://</A> and <A HREF="http://">http://</A> options
+      -https option was 'l' now it is 'S' (capital)
+      -Added password option. Now passwords can be disabled while usernames are ok (for email)
+      -IP Address option was 'i' now it is 'I' (capital)
+      -Options are now case sensitive
+      -Added validateEmailSyntax() and validateFtpSyntax() functions below&lt;br&gt;
+
+    August 27th, 2004
+      -IP group range is more specific. Used to allow 0-299. Now it is 0-255
+      -Port range more specific. Used to allow 0-69999. Now it is 0-65535&lt;br&gt;
+      -Fixed bug disallowing 'i-' option.&lt;br&gt;
+      -Changed license to GPL
+
+    July 8th, 2004
+      -Fixed bug disallowing 'l-' option. Thanks Dr. Cheap
+
+    June 15, 2004
+      -Added options parameter to make it easier for people to plug the function in
+       without needed to rework the code.
+      -Split the example application away from the function
+
+    June 1, 2004
+      -Complete rewrite
+      -Now more modular
+        -Easier to disable sections
+        -Easier to port to other languages
+        -Easier to port to verify email addresses
+      -Uses only simple regular expressions so it is more portable
+      -Follows RFC closer for domain names. Some &quot;play&quot; domains may break
+      -Renamed from 'verifyUrl()' to 'validateUrlSyntax()'
+      -Removed extra code which added '<A HREF="http://">http://</A>' and trailing '/' if it was missing
+        -That code was better suited for a massaging function, not verifying
+      -Bug fixes:
+        -Now splits up and forces '/path?query#fragment' order
+        -No longer requires a path when using a query or fragment
+
+    August 29, 2003
+      -Allowed port numbers above 9999. Now allows up to 69999
+             
+    Sometime, 2002
+      -Added new top level domains
+        -aero, coop, museum, name, info, biz, pro
+
+    October 5, 2000
+      -First Version
+
+
+Intentional Limitations:
+    -Does not verify url actually exists. Only validates the syntax
+    -Strictly follows the RFC standards. Some urls exist in the wild which will
+     not validate. Including ones with square brackets in the query section '[]'
+
+
+Known Problems:
+    -None at this time
+
+
+Author(s):
+    Rod Apeldoorn - rod(at)canowhoopass(dot)com
+
+    
+Homepage:
+    <A HREF="http://www.canowhoopass.com/">http://www.canowhoopass.com/</A>
+
+
+Thanks!:
+    -WEAV -Several members of Weav helped to test - <A HREF="http://weav.bc.ca/">http://weav.bc.ca/</A>
+    -There were also a number of emails from other developers expressing
+     thanks and suggestions. It is nice to be appreciated. Thanks!
+
+
+License:
+    Copyright 2004, Rod Apeldoorn
+    
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or (at
+    your option) any later version.
+
+    This program is distributed in the hope that it will be useful, but
+    WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    General Public License for more details.
+
+    You should have received a copy of the GNU General Public License along
+    with this program; if not, write to the Free Software Foundation, Inc.,
+    59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+    To view the license online, go to: <A HREF="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</A>
+
+
+Alternate Commercial Licenses:
+    For information in regards to alternate licensing, contact me.
+*/
+
+
+// BEGINNING OF validateUrlSyntax() function
+function validateUrlSyntax( $urladdr, $options=&quot;&quot; ){
+
+    // Force Options parameter to be lower case
+    // DISABLED PERMAMENTLY - OK to remove from code
+    //    $options = strtolower($options);
+
+    // Check Options Parameter
+    if (!ereg( '^([sHSEFuPaIpfqr][+?-])*$', $options ))
+    {
+        trigger_error(&quot;Options attribute malformed&quot;, E_USER_ERROR);
+    }
+
+    // Set Options Array, set defaults if options are not specified
+    // Scheme
+    if (strpos( $options, 's') === false) $aOptions['s'] = '?';
+    else $aOptions['s'] = substr( $options, strpos( $options, 's') + 1, 1);
+    // <A HREF="http://">http://</A>
+    if (strpos( $options, 'H') === false) $aOptions['H'] = '?';
+    else $aOptions['H'] = substr( $options, strpos( $options, 'H') + 1, 1);
+    // <A HREF="https://">https://</A> (SSL)
+    if (strpos( $options, 'S') === false) $aOptions['S'] = '?';
+    else $aOptions['S'] = substr( $options, strpos( $options, 'S') + 1, 1);
+    // mailto: (email)
+    if (strpos( $options, 'E') === false) $aOptions['E'] = '-';
+    else $aOptions['E'] = substr( $options, strpos( $options, 'E') + 1, 1);
+    // <A HREF="ftp://">ftp://</A>
+    if (strpos( $options, 'F') === false) $aOptions['F'] = '-';
+    else $aOptions['F'] = substr( $options, strpos( $options, 'F') + 1, 1);
+    // User section
+    if (strpos( $options, 'u') === false) $aOptions['u'] = '?';
+    else $aOptions['u'] = substr( $options, strpos( $options, 'u') + 1, 1);
+    // Password in user section
+    if (strpos( $options, 'P') === false) $aOptions['P'] = '?';
+    else $aOptions['P'] = substr( $options, strpos( $options, 'P') + 1, 1);
+    // Address Section
+    if (strpos( $options, 'a') === false) $aOptions['a'] = '+';
+    else $aOptions['a'] = substr( $options, strpos( $options, 'a') + 1, 1);
+    // IP Address in address section
+    if (strpos( $options, 'I') === false) $aOptions['I'] = '?';
+    else $aOptions['I'] = substr( $options, strpos( $options, 'I') + 1, 1);
+    // Port number
+    if (strpos( $options, 'p') === false) $aOptions['p'] = '?';
+    else $aOptions['p'] = substr( $options, strpos( $options, 'p') + 1, 1);
+    // File Path
+    if (strpos( $options, 'f') === false) $aOptions['f'] = '?';
+    else $aOptions['f'] = substr( $options, strpos( $options, 'f') + 1, 1);
+    // Query Section
+    if (strpos( $options, 'q') === false) $aOptions['q'] = '?';
+    else $aOptions['q'] = substr( $options, strpos( $options, 'q') + 1, 1);
+    // Fragment (Anchor)
+    if (strpos( $options, 'r') === false) $aOptions['r'] = '?';
+    else $aOptions['r'] = substr( $options, strpos( $options, 'r') + 1, 1);
+
+
+    // Loop through options array, to search for and replace &quot;-&quot; to &quot;{0}&quot; and &quot;+&quot; to &quot;&quot;
+    foreach($aOptions as $key =&gt; $value)
+    {
+        if ($value == '-')
+        {
+            $aOptions[$key] = '{0}';
+        }
+        if ($value == '+')
+        {
+            $aOptions[$key] = '';
+        }
+    }
+    
+    // DEBUGGING - Unescape following line to display to screen current option values
+    // echo '&lt;pre&gt;'; print_r($aOptions); echo '&lt;/pre&gt;';
+
+
+    // Preset Allowed Characters
+    $alphanum    = '[a-zA-Z0-9]';  // Alpha Numeric
+    $unreserved  = '[a-zA-Z0-9_.!~*' . '\'' . '()-]';
+    $escaped     = '(%[0-9a-fA-F]{2})'; // Escape sequence - In Hex - %6d would be a 'm'
+    $reserved    = '[;/?:@&amp;=+$,]'; // Special characters in the URI
+    
+    // Beginning Regular Expression
+                       // Scheme - Allows for '<A HREF="http://">http://</A>', '<A HREF="https://">https://</A>', 'mailto:', or '<A HREF="ftp://">ftp://</A>'
+    $scheme            = '(';
+    if     ($aOptions['H'] === '') { $scheme .= '<A HREF="http://">http://</A>'; }
+    elseif ($aOptions['S'] === '') { $scheme .= '<A HREF="https://">https://</A>'; }
+    elseif ($aOptions['E'] === '') { $scheme .= 'mailto:'; }
+    elseif ($aOptions['F'] === '') { $scheme .= '<A HREF="ftp://">ftp://</A>'; }
+    else
+    {
+        if ($aOptions['H'] === '?') { $scheme .= '|(<A HREF="http://">http://</A>)'; }
+        if ($aOptions['S'] === '?') { $scheme .= '|(<A HREF="https://">https://</A>)'; }
+        if ($aOptions['E'] === '?') { $scheme .= '|(mailto:)'; }
+        if ($aOptions['F'] === '?') { $scheme .= '|(<A HREF="ftp://">ftp://</A>)'; }
+        $scheme = str_replace('(|', '(', $scheme); // fix first pipe
+    }
+    $scheme            .= ')' . $aOptions['s'];
+    // End setting scheme
+    
+                       // User Info - Allows for 'username@' or 'username:password@'. Note: contrary to rfc, I removed ':' from username section, allowing it only in password.
+                       //   /---------------- Username -----------------------\  /-------------------------------- Password ------------------------------\
+    $userinfo          = '((' . $unreserved . '|' . $escaped . '|[;&amp;=+$,]' . ')+(:(' . $unreserved . '|' . $escaped . '|[;:&amp;=+$,]' . ')+)' . $aOptions['P'] . '@)' . $aOptions['u'];
+    
+                       // IP ADDRESS - Allows 0.0.0.0 to 255.255.255.255
+    $ipaddress         = '((((2(([0-4][0-9])|(5[0-5])))|([01]?[0-9]?[0-9]))\.){3}((2(([0-4][0-9])|(5[0-5])))|([01]?[0-9]?[0-9])))';
+    
+                       // Tertiary Domain(s) - Optional - Multi - Although some sites may use other characters, the RFC says tertiary domains have the same naming restrictions as second level domains
+    $domain_tertiary   = '(' . $alphanum . '(([a-zA-Z0-9-]{0,62})' . $alphanum . ')?\.)*';
+
+                       // Second Level Domain - Required - First and last characters must be Alpha-numeric. Hyphens are allowed inside.
+    $domain_secondary  = '(' . $alphanum . '(([a-zA-Z0-9-]{0,62})' . $alphanum . ')?\.)';
+    
+    /* // This regex is disabled on purpose in favour of the more exact version below
+                       // Top Level Domain - First character must be Alpha. Last character must be AlphaNumeric. Hyphens are allowed inside.
+    $domain_toplevel   = '([a-zA-Z](([a-zA-Z0-9-]*)[a-zA-Z0-9])?)';
+    */
+    
+                       // Top Level Domain - Required - Domain List Current As Of December 2004. Use above escaped line to be forgiving of possible future TLD's
+    $domain_toplevel   = '(aero|biz|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|post|pro|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|az|ax|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)';
+    
+
+                       // Address can be IP address or Domain
+    if ($aOptions['I'] === '{0}') {       // IP Address Not Allowed
+        $address       = '(' . $domain_tertiary . $domain_secondary . $domain_toplevel . ')';
+    } elseif ($aOptions['I'] === '') {  // IP Address Required
+        $address       = '(' . $ipaddress . ')';
+    } else {                            // IP Address Optional
+        $address       = '((' . $ipaddress . ')|(' . $domain_tertiary . $domain_secondary . $domain_toplevel . '))';
+    }
+    $address = $address . $aOptions['a'];
+    
+                       // Port Number - :80 or :8080 or :65534 Allows range of :0 to :65535
+                       //    (0-59999)         |(60000-64999)   |(65000-65499)    |(65500-65529)  |(65530-65535)
+    $port_number       = '(:(([0-5]?[0-9]{1,4})|(6[0-4][0-9]{3})|(65[0-4][0-9]{2})|(655[0-2][0-9])|(6553[0-5])))' . $aOptions['p'];
+    
+                       // Path - Can be as simple as '/' or have multiple folders and filenames
+    $path              = '(/((;)?(' . $unreserved . '|' . $escaped . '|' . '[:@&amp;=+$,]' . ')+(/)?)*)' . $aOptions['f'];
+    
+                       // Query Section - Accepts ?var1=value1&amp;var2=value2 or ?2393,1221 and much more
+    $querystring       = '(\?(' . $reserved . '|' . $unreserved . '|' . $escaped . ')*)' . $aOptions['q'];
+    
+                       // Fragment Section - Accepts anchors such as #top
+    $fragment          = '(#(' . $reserved . '|' . $unreserved . '|' . $escaped . ')*)' . $aOptions['r'];
+    
+    
+    // Building Regular Expression
+    $regexp = '^' . $scheme . $userinfo . $address . $port_number . $path . $querystring . $fragment . '$';
+    
+    // DEBUGGING - Uncomment Line Below To Display The Regular Expression Built
+    // echo '&lt;pre&gt;' . htmlentities(wordwrap($regexp,70,&quot;\n&quot;,1)) . '&lt;/pre&gt;';
+
+    // Running the regular expression
+    if (eregi( $regexp, $urladdr ))
+    {
+        return true; // The domain passed
+    }
+    else
+    {
+        return false; // The domain didn't pass the expression
+    }
+
+} // END Function validateUrlSyntax()
+
+
+
+/*
+About ValidateEmailSyntax():
+    This function uses the ValidateUrlSyntax() function to easily check the
+    syntax of an email address. It accepts the same options as ValidateURLSyntax
+    but defaults them for email addresses.
+
+
+Usage:
+    validateEmailSyntax( url_to_check[, options])
+
+    url_to_check - string - The url to check
+    
+    options - string - A optional string of options to set which parts of
+            the url are required, optional, or not allowed. Each option
+            must be followed by a &quot;+&quot; for required, &quot;?&quot; for optional, or
+            &quot;-&quot; for not allowed. See ValidateUrlSyntax() docs for option list.
+
+    The default options are changed to:
+        s-H-S-E+F-u+P-a+I-p-f-q-r-
+
+    This only allows an address of &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">name at domain</A>&quot;.
+
+Examples:
+    validateEmailSyntax('<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">george at fakemail.com</A>')
+    validateEmailSyntax('mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">george at fakemail.com</A>', 's+')
+    validateEmailSyntax('<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">george at fakemail.com</A>?subject=Hi%20George', 'q?')
+    validateEmailSyntax('<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">george at 212.198.33.12</A>', 'I?')
+    
+
+
+Author(s):
+    Rod Apeldoorn - rod(at)canowhoopass(dot)com
+
+    
+Homepage:
+    <A HREF="http://www.canowhoopass.com/">http://www.canowhoopass.com/</A>
+
+
+License:
+    Copyright 2004 - Rod Apeldoorn
+
+    Released under same license as validateUrlSyntax(). For details, contact me.
+
+
+*/
+
+function validateEmailSyntax( $emailaddr, $options=&quot;&quot; ){
+
+    // Check Options Parameter
+    if (!ereg( '^([sHSEFuPaIpfqr][+?-])*$', $options ))
+    {
+        trigger_error(&quot;Options attribute malformed&quot;, E_USER_ERROR);
+    }
+
+    // Set Options Array, set defaults if options are not specified
+    // Scheme
+    if (strpos( $options, 's') === false) $aOptions['s'] = '-';
+    else $aOptions['s'] = substr( $options, strpos( $options, 's') + 1, 1);
+    // <A HREF="http://">http://</A>
+    if (strpos( $options, 'H') === false) $aOptions['H'] = '-';
+    else $aOptions['H'] = substr( $options, strpos( $options, 'H') + 1, 1);
+    // <A HREF="https://">https://</A> (SSL)
+    if (strpos( $options, 'S') === false) $aOptions['S'] = '-';
+    else $aOptions['S'] = substr( $options, strpos( $options, 'S') + 1, 1);
+    // mailto: (email)
+    if (strpos( $options, 'E') === false) $aOptions['E'] = '?';
+    else $aOptions['E'] = substr( $options, strpos( $options, 'E') + 1, 1);
+    // <A HREF="ftp://">ftp://</A>
+    if (strpos( $options, 'F') === false) $aOptions['F'] = '-';
+    else $aOptions['F'] = substr( $options, strpos( $options, 'F') + 1, 1);
+    // User section
+    if (strpos( $options, 'u') === false) $aOptions['u'] = '+';
+    else $aOptions['u'] = substr( $options, strpos( $options, 'u') + 1, 1);
+    // Password in user section
+    if (strpos( $options, 'P') === false) $aOptions['P'] = '-';
+    else $aOptions['P'] = substr( $options, strpos( $options, 'P') + 1, 1);
+    // Address Section
+    if (strpos( $options, 'a') === false) $aOptions['a'] = '+';
+    else $aOptions['a'] = substr( $options, strpos( $options, 'a') + 1, 1);
+    // IP Address in address section
+    if (strpos( $options, 'I') === false) $aOptions['I'] = '-';
+    else $aOptions['I'] = substr( $options, strpos( $options, 'I') + 1, 1);
+    // Port number
+    if (strpos( $options, 'p') === false) $aOptions['p'] = '-';
+    else $aOptions['p'] = substr( $options, strpos( $options, 'p') + 1, 1);
+    // File Path
+    if (strpos( $options, 'f') === false) $aOptions['f'] = '-';
+    else $aOptions['f'] = substr( $options, strpos( $options, 'f') + 1, 1);
+    // Query Section
+    if (strpos( $options, 'q') === false) $aOptions['q'] = '-';
+    else $aOptions['q'] = substr( $options, strpos( $options, 'q') + 1, 1);
+    // Fragment (Anchor)
+    if (strpos( $options, 'r') === false) $aOptions['r'] = '-';
+    else $aOptions['r'] = substr( $options, strpos( $options, 'r') + 1, 1);
+
+    // Generate options
+    $newoptions = '';
+    foreach($aOptions as $key =&gt; $value)
+    {
+        $newoptions .= $key . $value;
+    }
+
+    // DEBUGGING - Uncomment line below to display generated options
+    // echo '&lt;pre&gt;' . $newoptions . '&lt;/pre&gt;';
+
+    // Send to validateUrlSyntax() and return result
+    return validateUrlSyntax( $emailaddr, $newoptions);
+
+} // END Function validateEmailSyntax()
+
+
+
+/*
+About ValidateFtpSyntax():
+    This function uses the ValidateUrlSyntax() function to easily check the
+    syntax of an FTP address. It accepts the same options as ValidateURLSyntax
+    but defaults them for FTP addresses.
+
+
+Usage:
+    validateFtpSyntax( url_to_check[, options])
+
+    url_to_check - string - The url to check
+    
+    options - string - A optional string of options to set which parts of
+            the url are required, optional, or not allowed. Each option
+            must be followed by a &quot;+&quot; for required, &quot;?&quot; for optional, or
+            &quot;-&quot; for not allowed. See ValidateUrlSyntax() docs for option list.
+
+    The default options are changed to:
+        s?H-S-E-F+u?P?a+I?p?f?q-r-
+
+Examples:
+    validateFtpSyntax('<A HREF="ftp://netscape.com">ftp://netscape.com</A>')
+    validateFtpSyntax('moz:<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">iesucks at netscape.com</A>')
+    validateFtpSyntax('<A HREF="ftp://netscape.com:2121/browsers/ns7/">ftp://netscape.com:2121/browsers/ns7/</A>', 'u-')
+
+
+Author(s):
+    Rod Apeldoorn - rod(at)canowhoopass(dot)com
+
+
+Homepage:
+    <A HREF="http://www.canowhoopass.com/">http://www.canowhoopass.com/</A>
+
+
+License:
+    Copyright 2004 - Rod Apeldoorn
+
+    Released under same license as validateUrlSyntax(). For details, contact me.
+*/
+
+function validateFtpSyntax( $ftpaddr, $options=&quot;&quot; ){
+
+    // Check Options Parameter
+    if (!ereg( '^([sHSEFuPaIpfqr][+?-])*$', $options ))
+    {
+        trigger_error(&quot;Options attribute malformed&quot;, E_USER_ERROR);
+    }
+
+    // Set Options Array, set defaults if options are not specified
+    // Scheme
+    if (strpos( $options, 's') === false) $aOptions['s'] = '?';
+    else $aOptions['s'] = substr( $options, strpos( $options, 's') + 1, 1);
+    // <A HREF="http://">http://</A>
+    if (strpos( $options, 'H') === false) $aOptions['H'] = '-';
+    else $aOptions['H'] = substr( $options, strpos( $options, 'H') + 1, 1);
+    // <A HREF="https://">https://</A> (SSL)
+    if (strpos( $options, 'S') === false) $aOptions['S'] = '-';
+    else $aOptions['S'] = substr( $options, strpos( $options, 'S') + 1, 1);
+    // mailto: (email)
+    if (strpos( $options, 'E') === false) $aOptions['E'] = '-';
+    else $aOptions['E'] = substr( $options, strpos( $options, 'E') + 1, 1);
+    // <A HREF="ftp://">ftp://</A>
+    if (strpos( $options, 'F') === false) $aOptions['F'] = '+';
+    else $aOptions['F'] = substr( $options, strpos( $options, 'F') + 1, 1);
+    // User section
+    if (strpos( $options, 'u') === false) $aOptions['u'] = '?';
+    else $aOptions['u'] = substr( $options, strpos( $options, 'u') + 1, 1);
+    // Password in user section
+    if (strpos( $options, 'P') === false) $aOptions['P'] = '?';
+    else $aOptions['P'] = substr( $options, strpos( $options, 'P') + 1, 1);
+    // Address Section
+    if (strpos( $options, 'a') === false) $aOptions['a'] = '+';
+    else $aOptions['a'] = substr( $options, strpos( $options, 'a') + 1, 1);
+    // IP Address in address section
+    if (strpos( $options, 'I') === false) $aOptions['I'] = '?';
+    else $aOptions['I'] = substr( $options, strpos( $options, 'I') + 1, 1);
+    // Port number
+    if (strpos( $options, 'p') === false) $aOptions['p'] = '?';
+    else $aOptions['p'] = substr( $options, strpos( $options, 'p') + 1, 1);
+    // File Path
+    if (strpos( $options, 'f') === false) $aOptions['f'] = '?';
+    else $aOptions['f'] = substr( $options, strpos( $options, 'f') + 1, 1);
+    // Query Section
+    if (strpos( $options, 'q') === false) $aOptions['q'] = '-';
+    else $aOptions['q'] = substr( $options, strpos( $options, 'q') + 1, 1);
+    // Fragment (Anchor)
+    if (strpos( $options, 'r') === false) $aOptions['r'] = '-';
+    else $aOptions['r'] = substr( $options, strpos( $options, 'r') + 1, 1);
+
+    // Generate options
+    $newoptions = '';
+    foreach($aOptions as $key =&gt; $value)
+    {
+        $newoptions .= $key . $value;
+    }
+
+    // DEBUGGING - Uncomment line below to display generated options
+    // echo '&lt;pre&gt;' . $newoptions . '&lt;/pre&gt;';
+
+    // Send to validateUrlSyntax() and return result
+    return validateUrlSyntax( $ftpaddr, $newoptions);
+
+} // END Function validateFtpSyntax()
+
+?&gt;

Added: trunk/inc/sm-lib-functions_backup2.php
===================================================================
--- trunk/inc/sm-lib-functions_backup2.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/sm-lib-functions_backup2.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,1296 @@
+&lt;?php
+require_once(&quot;class.phpmailer.php&quot;);
+
+/**
+*   make sure all input works as expected,
+*   by undoing the possible magic_quotes directive.
+*   Now every single variable will be free from slashed and needs to be
+*   manually escaped.
+*   code origin: <A HREF="http://nl3.php.net/manual/en/function.get-magic-quotes-gpc.php">http://nl3.php.net/manual/en/function.get-magic-quotes-gpc.php</A>
+*/
+if (get_magic_quotes_gpc()) {
+   function stripslashes_deep($value)
+   {
+       $value = is_array($value) ?
+                   array_map('stripslashes_deep', $value) :
+                   stripslashes($value);
+
+       return $value;
+   }
+
+   $_POST       = array_map('stripslashes_deep', $_POST);
+   $_GET         = array_map('stripslashes_deep', $_GET);
+   $_COOKIE   = array_map('stripslashes_deep', $_COOKIE);
+   $_REQUEST = array_map('stripslashes_deep', $_COOKIE);
+}
+
+
+
+/**
+*   check if input is valid according to a string of valid chars
+*/
+function CheckInputValid($str,$maxlength = &quot;&quot;)
+{
+    //making it case independent
+    $str = strtolower($str);
+    $validmask  =&quot;abcdefghijklmnopqrstuvwxyz0123456789_-.@ '&quot;;
+    if ($maxlength == &quot;&quot;) {
+        if (strspn($str, $validmask) == strlen($str)) {
+            return true;
+        } else {
+            return false;
+        }
+    } else {
+        $validlength = $maxlength;
+        if (strspn($str, $validmask) == strlen($str) &amp;&amp; $validlength &gt;= strlen($str)) {
+           return true;
+        } else {
+           return false;
+        }
+    }
+}
+
+
+function checkContainsAlfaNum($input) {
+	$output = eregi(&quot;[a-z0-9]&quot;, $input)? true : false;
+	return $output;
+}
+
+/**
+* A username consists of at least 4 and a maximum of 16 
+* alfanumeric chars. The first on may not be a number
+**/
+function checkUsernameValid($uname)
+{
+    $len = strlen($uname);
+    if($len &gt;= 4 &amp;&amp; $len &lt;= 16 ) {   
+        $uname = strtolower($uname);
+        $status = eregi(&quot;^[a-z][a-z0-9]&quot;, $uname)? true : false;
+        return $status;
+    } else {
+        return false; 
+    }    
+}
+
+function checkPasswordValid($pwd)
+{
+    $validmask=&quot;abcdefghijklmnopqrstuvwxyz0123456789_-@&quot;; 
+    $len = strlen($pwd);
+    
+    if($len &gt;= 6 &amp;&amp; $len &lt;= 16 ) {   
+        $pwd = strtolower($pwd);
+        if (strspn($pwd, $validmask) == strlen($pwd)) {
+            return true;
+        } else {
+            return false;
+        }
+    } else {
+        return false; 
+    }    
+}
+
+
+function sendFeedback($email_to, $subject, $message) {
+	//sent BCC to
+    $bcc = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">bjorn at waag.org</A>&quot;;
+    
+                                   
+	//insert succesfull, send email for confirmation
+	$mail = new PHPMailer();
+	$mail-&gt;IsSendmail();
+	$mail-&gt;AddAddress($email_to);
+	$mail-&gt;AddBCC($bcc);
+	$mail-&gt;FromName = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">simuzerobot at simuze.com</A>&quot;;
+	$mail-&gt;From = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">simuzerobot at simuze.com</A>&quot;;
+	$mail-&gt;Subject = $subject;
+	$mail-&gt;Body = $message;
+		
+	if(!$mail-&gt;Send())
+	{
+		return true;
+	}
+	else
+	{
+		return false;
+	}
+}
+
+
+
+
+
+
+/** encrypts the $value with the $alg */
+function CryptIt($alg, $value)
+{
+    switch($alg) {
+    
+        case &quot;md5&quot;:
+            $value = md5($value);
+            return $value;
+        break;    
+    }
+
+}
+
+
+/** creates a random string */
+function rndString($string_length = 6)
+{
+    // uses the decimal acsii numbers to produce a random string
+    //<A HREF="http://www.asciitable.com/">http://www.asciitable.com/</A> 
+    $min  = 48;
+    $max = 90;
+    
+    for($i = 0 ; $i &lt; $string_length; $i++){
+       $rand =  mt_rand($min,$max);
+       
+       if($rand &gt; 57 &amp;&amp; $rand &lt;= 63){
+           $rand = mt_rand(48,57);
+       }
+       $str .= chr($rand);
+    }
+    $str = strtolower($str);
+    return $str;
+}
+
+
+
+/**
+*
+* expects a timestamp(8) which
+* looks like YYYYMMDD and returns
+* an array like this this:
+* $arr['year'] = YYYY
+* $arr['month'] = MM
+* $arr['day'] = DD
+**/
+function extractTimestamp($timestamp)
+{
+    $birthdate = array();
+    //format is YYYYMMDD
+    if(strlen($timestamp) == 8) {
+        $tmp_yyyy_mmdd = chunk_split ( $timestamp , 4 ,&quot;-&quot; ); // YYYYMMDD becomes YYYY-MMDD
+        $tmp_arr =  explode(&quot;-&quot;, $tmp_yyyy_mmdd);
+        //we freed the year...YAHOO
+        $birthdate[&quot;year&quot;] = $tmp_arr[0];
+        //continue to process MMDD into MM-DD
+        $tmp_mm_dd = chunk_split ( $tmp_arr[1] , 2 ,&quot;-&quot; );
+        $tmp_arr2 =  explode(&quot;-&quot;, $tmp_mm_dd);
+        $birthdate[&quot;month&quot;] = $tmp_arr2[0];
+        $birthdate[&quot;day&quot;] = $tmp_arr2[1];
+        return $birthdate;
+    } else {
+        return false;
+    }
+}
+
+
+/**
+*   process a DATE YYYY-MM-DD
+*   into 
+* an array like this this:
+* $arr['year'] = YYYY
+* $arr['month'] = MM
+* $arr['day'] = DD
+**/
+function extractDate($date)
+{
+    if(strlen($date) == 10) {
+        $birthdate = array();
+        //format is YYYY-MM-DD
+        $tmp_arr =  explode(&quot;-&quot;, $date);
+        $birthdate[&quot;year&quot;]  = $tmp_arr[0];
+        $birthdate[&quot;month&quot;] = $tmp_arr[1];
+        $birthdate[&quot;day&quot;]   = $tmp_arr[2];
+        return $birthdate;
+    } else {
+        return false;
+    }
+}
+
+
+
+
+
+/**
+* creates a select box (selmonth)
+* with months. Options to be 
+* set in the param array:
+*
+* key:value (possibilities)
+*
+* selected:1 (1~12) default is none and this will trigger a text as default (lang specific)
+* lang:NL (NL, EN); default is EN
+* view:ftext (ftext, text,lnr) default is numeric months without leading zero
+**/
+function createSelectMonth($params)
+{
+    if(is_array($params)) { 
+        
+        $monthsNL = array(&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mrt&quot;, &quot;Apr&quot;, &quot;Mei&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sept&quot;, &quot;Okt&quot;, &quot;Nov&quot;, &quot;Dec&quot;);
+        $monthsEN = array(&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sept&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;);
+       
+        $monthsfullNL = array(&quot;Januari&quot;, &quot;Februari&quot;, &quot;Maart&quot;, &quot;April&quot;, &quot;Mei&quot;, &quot;Juni&quot;, &quot;Juli&quot;, &quot;Augustus&quot;, &quot;September&quot;, &quot;Oktober&quot;, &quot;November&quot;, &quot;December&quot;);
+        $monthsfullEN = array(&quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;, &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;, &quot;October&quot;, &quot;November&quot;, &quot;December&quot;);
+        $html .= '&lt;select name=&quot;selmonth&quot; id=&quot;selmonth&quot;&gt;'.&quot;\n&quot;;
+        
+        switch($params['lang']) {
+            case &quot;NL&quot;:
+                $msg = 'Maand';
+                switch($params['view']) {
+                    //shortext
+                    case &quot;text&quot;:
+                      if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                      } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                      }
+                      
+                      $j = 0;
+                      for($i = 1; $i &lt;= 12; $i++) {
+                          if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                          if($params['selected'] == $i &amp;&amp; !$selected) {
+                              $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$monthsNL[$j]&lt;/option&gt;\n&quot;;
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$monthsNL[$j]&lt;/option&gt;\n&quot;;
+                          }
+                          $j++;
+                      }
+                    break;
+                     //fullext
+                    case &quot;ftext&quot;:
+                        if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                      } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                      }
+                      $j = 0;
+                      for($i = 1; $i &lt;= 12; $i++) {
+                          
+                          if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                          if($params['selected'] == $i &amp;&amp; !$selected) {
+                              $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$monthsfullNL[$j]&lt;/option&gt;\n&quot;;
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$monthsfullNL[$j]&lt;/option&gt;\n&quot;;
+                          }
+                          $j++;
+                      }
+                    break;
+                    //default numeric months
+                    default:
+                          if(empty($params['selected'])) {
+                              $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                              $selected = true; 
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          }
+                        for($i = 1; $i &lt;= 12; $i++) {
+                            if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                            if($params['selected'] == $i &amp;&amp; !$selected) {
+                                $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                            } else {
+                                $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                            }
+                        }
+                    break;
+                }
+            break;
+            //default language is English
+            default:
+                $msg = 'Month';
+                switch($params['view']) {
+                    //shortext
+                    case &quot;text&quot;:
+                      if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                      } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                      }
+                      $j = 0;
+                      for($i = 1; $i &lt;= 12; $i++) {
+                          if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                          if($params['selected'] == $i &amp;&amp; !$selected) {
+                              $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$monthsEN[$j]&lt;/option&gt;\n&quot;;
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$monthsEN[$j]&lt;/option&gt;\n&quot;;
+                          }
+                          $j++;  
+                      }
+                    break;
+                     //fullext
+                    case &quot;ftext&quot;:
+                      if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                      } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                      }
+                      $j = 0;
+                      for($i = 1; $i &lt;= 12; $i++) {
+                          if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                          if($params['selected'] == $i &amp;&amp; !$selected) {
+                              $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$monthsfullEN[$j]&lt;/option&gt;\n&quot;;
+                          } else {
+                              $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$monthsfullEN[$j]&lt;/option&gt;\n&quot;;
+                          }
+                          $j++;
+                      }
+                    break;
+                    //default numeric months
+                    default:
+                       if(empty($params['selected'])) {
+                          $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                          $selected = true; 
+                        } else {
+                              $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                        }
+                        for($i = 1; $i &lt;= 12; $i++) {
+                            if($i &lt; 10) {
+                              $i = &quot;0&quot; .$i;
+                          }
+                            if($params['selected'] == $i &amp;&amp; !$selected) {
+                                $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                            } else {
+                                $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                            }
+                        }
+                    break;
+                }
+            break;  
+        }
+        $html .='&lt;/select&gt;';
+        return $html;
+    } else {
+        return false;
+    }     
+}
+
+
+/**
+* creates a select box (seldaymonth)
+* with days. Options to be 
+* set in the params array:
+*
+* key:value (possibilities)
+*
+* NOTE: currently we're not taking any
+* leap years into account. And we'll set all months
+* with 31 days. This will get fixed in the (near) future 
+* 
+* selected:12 (selected day of the month)
+* lang:NL (NL, EN); default is EN
+* 
+**/
+function createSelectDayMonth($params) {
+    if(is_array($params)) {    
+        $start = 1;
+        $end = 31;
+        $html  .= '&lt;select name=&quot;seldaymonth&quot; id=&quot;seldaymonth&quot;&gt;' .&quot;\n&quot;;
+        
+        switch($params['lang']) {
+            case &quot;NL&quot;:
+                $msg = 'Dag';
+                if(empty($params['selected'])) {
+                    $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                    $selected = true; 
+                } else {
+                    $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                }
+                for($i = $start; $i &lt;= $end; $i++ ) {
+                    if($i &lt; 10) {
+                        $i = &quot;0&quot; .$i;
+                    }
+                    if($params['selected'] == $i) {
+                        $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    } else {
+                        $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    }
+                }    
+            break;
+            //default language is English
+            default:
+                $msg = 'Day';
+                if(empty($params['selected'])) {
+                    $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                    $selected = true; 
+                } else {
+                    $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                }
+                for($i = $start; $i &lt;= $end; $i++ ) {
+                    if($i &lt; 10) {
+                        $i = &quot;0&quot; .$i;
+                    }
+                    if($params['selected'] == $i) {
+                        $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    } else {
+                        $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    }
+                }
+            break;
+        }
+        $html .= '&lt;/select&gt;';
+        return $html;
+    } else {
+        return false;
+    }
+}
+
+
+function createSelectGenre($name = 'undefined') {
+	if($name != 'undefined') {
+		$genre = null;
+		$genre .= &quot;&lt;label for=\&quot;$name\&quot;&gt;Kies een genre:&lt;/label&gt;\n&quot;;
+		$genre .= &quot;&lt;select class=\&quot;commentaar_input\&quot; name=\&quot;$name\&quot;&gt;\n&quot;;
+		$genre .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;::maak keuze::&lt;/option&gt;\n&quot;;
+		$genre_handle = qGetGenre();
+		$nr_genre = mysql_num_rows($genre_handle);
+		if($nr_genre &gt; 0) {
+			for($i = 0; $i &lt; $nr_genre; $i++) {
+				$g = mysql_fetch_array($genre_handle);
+				$genre .=&quot;&lt;option value=\&quot;$g[genre_id]\&quot;&gt;$g[genre_name]&lt;/option&gt;&quot;;        
+			}
+		$genre .=&quot;&lt;/select&gt;&lt;br /&gt;&quot;;
+		} else {
+			$genre .=&quot;&lt;option value=\&quot;problem\&quot;&gt;Genre db probleem&lt;/option&gt;&quot;; 
+		}
+	
+	} else {
+		$genre = null;
+		$genre .= &quot;&lt;label for=\&quot;genre\&quot;&gt;Kies een genre:&lt;/label&gt;\n&quot;;
+		$genre .= &quot;&lt;select class=\&quot;commentaar_input\&quot; name=\&quot;genre\&quot;&gt;\n&quot;;
+		$genre .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;::maak keuze::&lt;/option&gt;\n&quot;;
+		$genre_handle = qGetGenre();
+		$nr_genre = mysql_num_rows($genre_handle);
+		if($nr_genre &gt; 0) {
+			for($i = 0; $i &lt; $nr_genre; $i++) {
+				$g = mysql_fetch_array($genre_handle);
+				$genre .=&quot;&lt;option value=\&quot;$g[genre_id]\&quot;&gt;$g[genre_name]&lt;/option&gt;&quot;;        
+			}
+		$genre .=&quot;&lt;/select&gt;&lt;br /&gt;&quot;;
+		} else {
+			$genre .=&quot;&lt;option value=\&quot;problem\&quot;&gt;Genre db probleem&lt;/option&gt;&quot;; 
+		}
+	}
+	
+	return $genre;
+}
+
+function createMoodSearch() {
+$mood_handle = qGetMoods();
+$nr_mood = mysql_num_rows($mood_handle);
+$moodsearch .= &quot;&lt;table name=\&quot;moodsearch\&quot; width=\&quot;354\&quot; border=\&quot;0\&quot; bordercolor=\&quot;#000000\&quot; cellspacing=\&quot;4\&quot; cellpadding=\&quot;2\&quot;&gt;&quot;;
+	if($nr_mood &gt; 0) {
+		for($i=0;$i&lt;$nr_mood;$i++) {
+			$mood = mysql_fetch_array($mood_handle);
+			$moodname = $mood['mood_description_name'];
+			$mid = $mood['mood_description_id'];
+			$l1  = $mood['mood_description_label1'];
+			$l2  = $mood['mood_description_label2'];
+			$l3  = $mood['mood_description_label3'];
+			$l4  = $mood['mood_description_label4'];
+			$l5  = $mood['mood_description_label5'];
+			$v1  = $mood['mood_description_value1'];
+			$v2  = $mood['mood_description_value2'];
+			$v3  = $mood['mood_description_value3'];
+			$v4  = $mood['mood_description_value4'];
+			$v5  = $mood['mood_description_value5'];
+			$unique = $mid + $i; 
+			
+			$moodsearch .=&quot;&lt;tr bgcolor=\&quot;#F8E4B3\&quot;&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;td&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;b&gt;$moodname&lt;/b&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;ol&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;li&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; value=\&quot;$v1\&quot; /&gt; $l1&lt;/li&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;li&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; value=\&quot;$v2\&quot; /&gt; $l2&lt;/li&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;li&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; checked=\&quot;checked\&quot; value=\&quot;$v3\&quot; /&gt; $l3&lt;/li&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;li&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; value=\&quot;$v4\&quot; /&gt; $l4&lt;/li&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;li&gt;&lt;input type=\&quot;radio\&quot; name=\&quot;moods[$mid]\&quot; value=\&quot;$v5\&quot; /&gt; $l5&lt;/li&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;/ol&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;/td&gt;\n&quot;;
+			$moodsearch .=&quot;&lt;/tr&gt;\n&quot;;
+					
+			
+		}
+	$moodsearch .= &quot;&lt;/table&gt;&quot;;    
+	} else {
+		$moodsearch .= &quot;geen moods aanwezig&quot;;
+	}
+return $moodsearch;	
+}
+
+
+function createSelectTag($name = 'undefined') {
+	if($name != 'undefined') {
+		$tag = null;
+		$tag .= &quot;&lt;select class=\&quot;commentaar_input\&quot; name=\&quot;$name\&quot;&gt;\n&quot;;
+		$tag .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;::maak keuze::&lt;/option&gt;\n&quot;;
+		$tag_handle = qGetTagsIncUsage();
+		$nr_tag = mysql_num_rows($tag_handle);
+		if($nr_tag &gt; 0) {
+			for($i = 0; $i &lt; $nr_tag; $i++) {
+				$g = mysql_fetch_array($tag_handle);
+				$nrs = $g['COUNT(*)'];
+				$tag .=&quot;&lt;option value=\&quot;$g[tag_id]\&quot;&gt;$g[tag_name]      -- $nrs nummers gevonden&lt;/option&gt;&quot;;        
+			}
+		$tag .=&quot;&lt;/select&gt;&lt;br /&gt;&quot;;
+		} else {
+			$tag .=&quot;&lt;option value=\&quot;problem\&quot;&gt;Tag db probleem&lt;/option&gt;&quot;; 
+		}
+	
+	} else {
+		$tag = null;
+		$tag .= &quot;&lt;label for=\&quot;tag\&quot;&gt;Kies een tag:&lt;/label&gt;\n&quot;;
+		$tag .= &quot;&lt;select class=\&quot;commentaar_input\&quot; name=\&quot;tag\&quot;&gt;\n&quot;;
+		$tag .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;::maak keuze::&lt;/option&gt;\n&quot;;
+		$tag_handle = qGetTagsIncUsage();
+		$nr_tag = mysql_num_rows($tag_handle);
+		if($nr_tag &gt; 0) {
+			for($i = 0; $i &lt; $nr_tag; $i++) {
+				$g = mysql_fetch_array($tag_handle);
+				$nrs = $g['COUNT(*)'];
+				$tag .=&quot;&lt;option value=\&quot;$g[tag_id]\&quot;&gt;$g[tag_name] -- $nrs nummers gevonden&lt;/option&gt;&quot;;       
+			}
+		$tag .=&quot;&lt;/select&gt;&lt;br /&gt;&quot;;
+		} else {
+			$tag .=&quot;&lt;option value=\&quot;problem\&quot;&gt;Tag db probleem&lt;/option&gt;&quot;; 
+		}
+	}
+	
+	return $tag;
+}
+
+
+
+
+
+/**
+* creates a select box (selyear)
+* with months. Options to be 
+* set in the param array:
+*
+* key:value (possibilities)
+*
+* start:1900 (start year)
+* end:2005 (end year inclusive)
+* lang:NL (NL, EN); default is EN
+* selected:2003 (selected year)
+* 
+**/
+function createSelectYear($params) {
+    if(is_array($params)) {    
+        
+        $start  = $params['start'];
+        $end    = $params['end'];
+        $html  .= '&lt;select name=&quot;selyear&quot; id=&quot;selyear&quot;&gt;'.&quot;\n&quot;;
+        
+        switch($params['lang']) {
+            case &quot;NL&quot;:
+                $msg = 'Jaar';
+                if(empty($params['selected'])) {
+                    $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                    $selected = true; 
+                } else {
+                    $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                }
+                for($i = $start; $i &lt;= $end; $i++ ) {
+                    if($params['selected'] == $i) {
+                        $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    } else {
+                        $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    }
+                }    
+            break;
+            //default language is English
+            default:
+                $msg = 'Year';
+                if(empty($params['selected'])) {
+                    $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                    $selected = true; 
+                } else {
+                    $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+                }
+                for($i = $start; $i &lt;= $end; $i++ ) {
+                    if($params['selected'] == $i) {
+                        $html .= &quot;&lt;option selected value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    } else {
+                        $html .= &quot;&lt;option value=\&quot;$i\&quot;&gt;$i&lt;/option&gt;\n&quot;;
+                    }
+                }
+            break;
+        }
+        $html .= '&lt;/select&gt;';
+        return $html;
+    } else {
+        return false;
+    }
+}
+
+
+/**
+* creates a select box (selprovincie)
+* with Dutch provincies. 
+* sel (1~12) default is none is none and this will trigger a text as default
+*
+**/
+function createSelectProvincies($sel) {
+    $msg = 'Kies een provincie';
+    $html .= '&lt;select name=&quot;selprovincie&quot; id=&quot;selprovincie&quot;&gt;'.&quot;\n&quot;;
+    $provincies = array(&quot;Drenthe&quot;,&quot;Overijssel&quot;, &quot;Utrecht&quot;, &quot;Flevoland&quot;, &quot;Noord-Holland&quot;,&quot;Zuid-Holland&quot;, &quot;Limburg&quot;, &quot;Zeeland&quot;, &quot;Gelderland&quot;, &quot;Groningen&quot;, &quot;Friesland&quot;, &quot;Brabant&quot;);
+
+    //sort provincies into alphabetical order
+    sort($provincies);
+    reset($provincies);
+    if(empty($sel)){
+        $html .= &quot;&lt;option selected value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+        $selected = true;
+    } else {
+         $html .= &quot;&lt;option value=\&quot;default\&quot;&gt;$msg&lt;/option&gt;\n&quot;;
+    }
+    
+    for($i = 0; $i &lt; 12; $i++) {
+        if($sel == $provincies[$i] &amp;&amp; !$selected) {
+            $html .= &quot;&lt;option selected value=\&quot;$provincies[$i]\&quot;&gt;$provincies[$i]&lt;/option&gt;\n&quot;;
+        } else {
+            $html .= &quot;&lt;option value=\&quot;$provincies[$i]\&quot;&gt;$provincies[$i]&lt;/option&gt;\n&quot;;
+        }    
+    }
+    $html .= '&lt;/select&gt;'.&quot;\n&quot;;
+    return $html;
+}
+
+
+if (!function_exists('getmicrotime')) {
+	function getmicrotime() {
+		list($usec, $sec) = explode(' ', microtime());
+		return ((float) $usec + (float) $sec);
+	}
+}
+
+
+
+
+function checkFilename($str) {
+    $str = strtolower($str);
+    $validmask  =&quot;abcdefghijklmnopqrstuvwxyz0123456789_- .&quot;;
+    if (strspn($str, $validmask) == strlen($str)) {
+        return true;
+    } else {
+        return false;
+    }
+}
+
+
+
+/**
+*   check if input is valid according to a string of valid chars
+*/
+function checkTextValid($str,$maxlength = &quot;&quot;)
+{   //making it case independent
+    $str = strtolower($str);
+    
+    $apo = &quot;'&quot;;
+    $newlines = &quot;\n\r&quot;;
+    
+    $validmask .= $apo;
+    $validmask .= $newlines;
+    $validmask .='abcdefghijklmnopqrstuvwxyz0123456789_,-.@ +=#%&amp;*$!?():;&quot;';
+    
+    
+    if ($maxlength == &quot;&quot;) {
+        if (strspn($str, $validmask) == strlen($str)) {
+            return true;
+        } else {
+            return false;
+        }
+    
+    } else {
+        $validlength = $maxlength;
+        if (strspn($str, $validmask) == strlen($str) &amp;&amp; $validlength &gt;= strlen($str)) {
+           return true;
+        } else {
+           return false;
+        }
+    }
+}
+
+/**
+* Author: Roel Duysserinck
+* <A HREF="http://faq.web-con.nl/">http://faq.web-con.nl/</A>
+**/
+function checkPostcode($postcode)
+{
+    // Format: 1234 XX of 1234XX
+    $status = (eregi (&quot;[0-9]{4}[[:space:]]*[A-Za-z]{2}&quot;, $postcode))? true : false;
+    // true if postcode is correct
+    // false if postcode is correct
+    return $status;
+}
+
+
+/*
+Functions Included In This File:
+    validateUrlSyntax()
+    validateEmailSyntax()
+    validateFtpSyntax()
+*/
+
+/*
+About validateUrlSyntax():
+    This function will verify if a http URL is formatted properly, returning
+    either with true or false.
+    
+    I used rfc #2396 URI: Generic Syntax as my guide when creating the
+    regular expression. For all the details see the comments below.
+
+
+Usage:
+    validateUrlSyntax( url_to_check[, options])
+
+    url_to_check - string - The url to check
+    
+    options - string - A optional string of options to set which parts of
+            the url are required, optional, or not allowed. Each option
+            must be followed by a &quot;+&quot; for required, &quot;?&quot; for optional, or
+            &quot;-&quot; for not allowed.
+
+            s - Scheme. Allows &quot;+?-&quot;, defaults to &quot;s?&quot;
+                H - <A HREF="http://">http://</A> Allows &quot;+?-&quot;, defaults to &quot;H?&quot;
+                S - <A HREF="https://">https://</A> (SSL). Allows &quot;+?-&quot;, defaults to &quot;S?&quot;
+                E - mailto: (email). Allows &quot;+?-&quot;, defaults to &quot;E-&quot;
+                F - <A HREF="ftp://">ftp://</A> Allows &quot;+?-&quot;, defaults to &quot;F-&quot;
+                    Dependant on scheme being enabled
+            u - User section. Allows &quot;+?-&quot;, defaults to &quot;u?&quot;
+                P - Password in user section. Allows &quot;+?-&quot;, defaults to &quot;P?&quot;
+                    Dependant on user section being enabled
+            a - Address (ip or domain). Allows &quot;+?-&quot;, defaults to &quot;a+&quot;
+                I - Ip address. Allows &quot;+?-&quot;, defaults to &quot;I?&quot;
+                    If I+, then domains are disabled
+                    If I-, then domains are required
+                    Dependant on address being enabled
+            p - Port number. Allows &quot;+?-&quot;, defaults to &quot;p?&quot;
+            f - File path. Allows &quot;+?-&quot;, defaults to &quot;f?&quot;
+            q - Query section. Allows &quot;+?-&quot;, defaults to &quot;q?&quot;
+            r - Fragment (anchor). Allows &quot;+?-&quot;, defaults to &quot;r?&quot;
+
+    Paste the funtion code, or include_once() this template at the top of the page
+    you wish to use this function.
+
+
+Examples:
+    validateUrlSyntax('<A HREF="http://george@www.cnn.com/#top">http://george@www.cnn.com/#top</A>')
+
+    validateUrlSyntax('<A HREF="https://games.yahoo.com:8080/board/chess.htm?move=true">https://games.yahoo.com:8080/board/chess.htm?move=true</A>')
+
+    validateUrlSyntax('<A HREF="http://www.hotmail.com/">http://www.hotmail.com/</A>', 's+u-I-p-q-r-')
+
+    validateUrlSyntax('/directory/file.php#top', 's-u-a-p-f+')
+
+
+    if (validateUrlSyntax('<A HREF="http://www.canowhoopass.com/">http://www.canowhoopass.com/</A>', 'u-'))
+    {
+        echo 'URL SYNTAX IS VERIFIED';
+    } else {
+        echo 'URL SYNTAX IS ILLEGAL';
+    }
+
+
+Last Edited:
+    December 15th 2004
+
+
+Changelog:
+    December 15th 2004
+      -Added new TLD's - .jobs, .mobi, .post and .travel. They are official, but not yet active.
+
+    August 31th 2004
+      -Fixed bug allowing empty username even when it was required
+      -Changed and added a few options to add extra schemes
+      -Added mailto: <A HREF="ftp://">ftp://</A> and <A HREF="http://">http://</A> options
+      -https option was 'l' now it is 'S' (capital)
+      -Added password option. Now passwords can be disabled while usernames are ok (for email)
+      -IP Address option was 'i' now it is 'I' (capital)
+      -Options are now case sensitive
+      -Added validateEmailSyntax() and validateFtpSyntax() functions below&lt;br&gt;
+
+    August 27th, 2004
+      -IP group range is more specific. Used to allow 0-299. Now it is 0-255
+      -Port range more specific. Used to allow 0-69999. Now it is 0-65535&lt;br&gt;
+      -Fixed bug disallowing 'i-' option.&lt;br&gt;
+      -Changed license to GPL
+
+    July 8th, 2004
+      -Fixed bug disallowing 'l-' option. Thanks Dr. Cheap
+
+    June 15, 2004
+      -Added options parameter to make it easier for people to plug the function in
+       without needed to rework the code.
+      -Split the example application away from the function
+
+    June 1, 2004
+      -Complete rewrite
+      -Now more modular
+        -Easier to disable sections
+        -Easier to port to other languages
+        -Easier to port to verify email addresses
+      -Uses only simple regular expressions so it is more portable
+      -Follows RFC closer for domain names. Some &quot;play&quot; domains may break
+      -Renamed from 'verifyUrl()' to 'validateUrlSyntax()'
+      -Removed extra code which added '<A HREF="http://">http://</A>' and trailing '/' if it was missing
+        -That code was better suited for a massaging function, not verifying
+      -Bug fixes:
+        -Now splits up and forces '/path?query#fragment' order
+        -No longer requires a path when using a query or fragment
+
+    August 29, 2003
+      -Allowed port numbers above 9999. Now allows up to 69999
+             
+    Sometime, 2002
+      -Added new top level domains
+        -aero, coop, museum, name, info, biz, pro
+
+    October 5, 2000
+      -First Version
+
+
+Intentional Limitations:
+    -Does not verify url actually exists. Only validates the syntax
+    -Strictly follows the RFC standards. Some urls exist in the wild which will
+     not validate. Including ones with square brackets in the query section '[]'
+
+
+Known Problems:
+    -None at this time
+
+
+Author(s):
+    Rod Apeldoorn - rod(at)canowhoopass(dot)com
+
+    
+Homepage:
+    <A HREF="http://www.canowhoopass.com/">http://www.canowhoopass.com/</A>
+
+
+Thanks!:
+    -WEAV -Several members of Weav helped to test - <A HREF="http://weav.bc.ca/">http://weav.bc.ca/</A>
+    -There were also a number of emails from other developers expressing
+     thanks and suggestions. It is nice to be appreciated. Thanks!
+
+
+License:
+    Copyright 2004, Rod Apeldoorn
+    
+    This program is free software; you can redistribute it and/or modify
+    it under the terms of the GNU General Public License as published by
+    the Free Software Foundation; either version 2 of the License, or (at
+    your option) any later version.
+
+    This program is distributed in the hope that it will be useful, but
+    WITHOUT ANY WARRANTY; without even the implied warranty of
+    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+    General Public License for more details.
+
+    You should have received a copy of the GNU General Public License along
+    with this program; if not, write to the Free Software Foundation, Inc.,
+    59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
+
+    To view the license online, go to: <A HREF="http://www.gnu.org/copyleft/gpl.html">http://www.gnu.org/copyleft/gpl.html</A>
+
+
+Alternate Commercial Licenses:
+    For information in regards to alternate licensing, contact me.
+*/
+
+
+// BEGINNING OF validateUrlSyntax() function
+function validateUrlSyntax( $urladdr, $options=&quot;&quot; ){
+
+    // Force Options parameter to be lower case
+    // DISABLED PERMAMENTLY - OK to remove from code
+    //    $options = strtolower($options);
+
+    // Check Options Parameter
+    if (!ereg( '^([sHSEFuPaIpfqr][+?-])*$', $options ))
+    {
+        trigger_error(&quot;Options attribute malformed&quot;, E_USER_ERROR);
+    }
+
+    // Set Options Array, set defaults if options are not specified
+    // Scheme
+    if (strpos( $options, 's') === false) $aOptions['s'] = '?';
+    else $aOptions['s'] = substr( $options, strpos( $options, 's') + 1, 1);
+    // <A HREF="http://">http://</A>
+    if (strpos( $options, 'H') === false) $aOptions['H'] = '?';
+    else $aOptions['H'] = substr( $options, strpos( $options, 'H') + 1, 1);
+    // <A HREF="https://">https://</A> (SSL)
+    if (strpos( $options, 'S') === false) $aOptions['S'] = '?';
+    else $aOptions['S'] = substr( $options, strpos( $options, 'S') + 1, 1);
+    // mailto: (email)
+    if (strpos( $options, 'E') === false) $aOptions['E'] = '-';
+    else $aOptions['E'] = substr( $options, strpos( $options, 'E') + 1, 1);
+    // <A HREF="ftp://">ftp://</A>
+    if (strpos( $options, 'F') === false) $aOptions['F'] = '-';
+    else $aOptions['F'] = substr( $options, strpos( $options, 'F') + 1, 1);
+    // User section
+    if (strpos( $options, 'u') === false) $aOptions['u'] = '?';
+    else $aOptions['u'] = substr( $options, strpos( $options, 'u') + 1, 1);
+    // Password in user section
+    if (strpos( $options, 'P') === false) $aOptions['P'] = '?';
+    else $aOptions['P'] = substr( $options, strpos( $options, 'P') + 1, 1);
+    // Address Section
+    if (strpos( $options, 'a') === false) $aOptions['a'] = '+';
+    else $aOptions['a'] = substr( $options, strpos( $options, 'a') + 1, 1);
+    // IP Address in address section
+    if (strpos( $options, 'I') === false) $aOptions['I'] = '?';
+    else $aOptions['I'] = substr( $options, strpos( $options, 'I') + 1, 1);
+    // Port number
+    if (strpos( $options, 'p') === false) $aOptions['p'] = '?';
+    else $aOptions['p'] = substr( $options, strpos( $options, 'p') + 1, 1);
+    // File Path
+    if (strpos( $options, 'f') === false) $aOptions['f'] = '?';
+    else $aOptions['f'] = substr( $options, strpos( $options, 'f') + 1, 1);
+    // Query Section
+    if (strpos( $options, 'q') === false) $aOptions['q'] = '?';
+    else $aOptions['q'] = substr( $options, strpos( $options, 'q') + 1, 1);
+    // Fragment (Anchor)
+    if (strpos( $options, 'r') === false) $aOptions['r'] = '?';
+    else $aOptions['r'] = substr( $options, strpos( $options, 'r') + 1, 1);
+
+
+    // Loop through options array, to search for and replace &quot;-&quot; to &quot;{0}&quot; and &quot;+&quot; to &quot;&quot;
+    foreach($aOptions as $key =&gt; $value)
+    {
+        if ($value == '-')
+        {
+            $aOptions[$key] = '{0}';
+        }
+        if ($value == '+')
+        {
+            $aOptions[$key] = '';
+        }
+    }
+    
+    // DEBUGGING - Unescape following line to display to screen current option values
+    // echo '&lt;pre&gt;'; print_r($aOptions); echo '&lt;/pre&gt;';
+
+
+    // Preset Allowed Characters
+    $alphanum    = '[a-zA-Z0-9]';  // Alpha Numeric
+    $unreserved  = '[a-zA-Z0-9_.!~*' . '\'' . '()-]';
+    $escaped     = '(%[0-9a-fA-F]{2})'; // Escape sequence - In Hex - %6d would be a 'm'
+    $reserved    = '[;/?:@&amp;=+$,]'; // Special characters in the URI
+    
+    // Beginning Regular Expression
+                       // Scheme - Allows for '<A HREF="http://">http://</A>', '<A HREF="https://">https://</A>', 'mailto:', or '<A HREF="ftp://">ftp://</A>'
+    $scheme            = '(';
+    if     ($aOptions['H'] === '') { $scheme .= '<A HREF="http://">http://</A>'; }
+    elseif ($aOptions['S'] === '') { $scheme .= '<A HREF="https://">https://</A>'; }
+    elseif ($aOptions['E'] === '') { $scheme .= 'mailto:'; }
+    elseif ($aOptions['F'] === '') { $scheme .= '<A HREF="ftp://">ftp://</A>'; }
+    else
+    {
+        if ($aOptions['H'] === '?') { $scheme .= '|(<A HREF="http://">http://</A>)'; }
+        if ($aOptions['S'] === '?') { $scheme .= '|(<A HREF="https://">https://</A>)'; }
+        if ($aOptions['E'] === '?') { $scheme .= '|(mailto:)'; }
+        if ($aOptions['F'] === '?') { $scheme .= '|(<A HREF="ftp://">ftp://</A>)'; }
+        $scheme = str_replace('(|', '(', $scheme); // fix first pipe
+    }
+    $scheme            .= ')' . $aOptions['s'];
+    // End setting scheme
+    
+                       // User Info - Allows for 'username@' or 'username:password@'. Note: contrary to rfc, I removed ':' from username section, allowing it only in password.
+                       //   /---------------- Username -----------------------\  /-------------------------------- Password ------------------------------\
+    $userinfo          = '((' . $unreserved . '|' . $escaped . '|[;&amp;=+$,]' . ')+(:(' . $unreserved . '|' . $escaped . '|[;:&amp;=+$,]' . ')+)' . $aOptions['P'] . '@)' . $aOptions['u'];
+    
+                       // IP ADDRESS - Allows 0.0.0.0 to 255.255.255.255
+    $ipaddress         = '((((2(([0-4][0-9])|(5[0-5])))|([01]?[0-9]?[0-9]))\.){3}((2(([0-4][0-9])|(5[0-5])))|([01]?[0-9]?[0-9])))';
+    
+                       // Tertiary Domain(s) - Optional - Multi - Although some sites may use other characters, the RFC says tertiary domains have the same naming restrictions as second level domains
+    $domain_tertiary   = '(' . $alphanum . '(([a-zA-Z0-9-]{0,62})' . $alphanum . ')?\.)*';
+
+                       // Second Level Domain - Required - First and last characters must be Alpha-numeric. Hyphens are allowed inside.
+    $domain_secondary  = '(' . $alphanum . '(([a-zA-Z0-9-]{0,62})' . $alphanum . ')?\.)';
+    
+    /* // This regex is disabled on purpose in favour of the more exact version below
+                       // Top Level Domain - First character must be Alpha. Last character must be AlphaNumeric. Hyphens are allowed inside.
+    $domain_toplevel   = '([a-zA-Z](([a-zA-Z0-9-]*)[a-zA-Z0-9])?)';
+    */
+    
+                       // Top Level Domain - Required - Domain List Current As Of December 2004. Use above escaped line to be forgiving of possible future TLD's
+    $domain_toplevel   = '(aero|biz|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|post|pro|travel|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|az|ax|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cs|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|eh|er|es|et|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw)';
+    
+
+                       // Address can be IP address or Domain
+    if ($aOptions['I'] === '{0}') {       // IP Address Not Allowed
+        $address       = '(' . $domain_tertiary . $domain_secondary . $domain_toplevel . ')';
+    } elseif ($aOptions['I'] === '') {  // IP Address Required
+        $address       = '(' . $ipaddress . ')';
+    } else {                            // IP Address Optional
+        $address       = '((' . $ipaddress . ')|(' . $domain_tertiary . $domain_secondary . $domain_toplevel . '))';
+    }
+    $address = $address . $aOptions['a'];
+    
+                       // Port Number - :80 or :8080 or :65534 Allows range of :0 to :65535
+                       //    (0-59999)         |(60000-64999)   |(65000-65499)    |(65500-65529)  |(65530-65535)
+    $port_number       = '(:(([0-5]?[0-9]{1,4})|(6[0-4][0-9]{3})|(65[0-4][0-9]{2})|(655[0-2][0-9])|(6553[0-5])))' . $aOptions['p'];
+    
+                       // Path - Can be as simple as '/' or have multiple folders and filenames
+    $path              = '(/((;)?(' . $unreserved . '|' . $escaped . '|' . '[:@&amp;=+$,]' . ')+(/)?)*)' . $aOptions['f'];
+    
+                       // Query Section - Accepts ?var1=value1&amp;var2=value2 or ?2393,1221 and much more
+    $querystring       = '(\?(' . $reserved . '|' . $unreserved . '|' . $escaped . ')*)' . $aOptions['q'];
+    
+                       // Fragment Section - Accepts anchors such as #top
+    $fragment          = '(#(' . $reserved . '|' . $unreserved . '|' . $escaped . ')*)' . $aOptions['r'];
+    
+    
+    // Building Regular Expression
+    $regexp = '^' . $scheme . $userinfo . $address . $port_number . $path . $querystring . $fragment . '$';
+    
+    // DEBUGGING - Uncomment Line Below To Display The Regular Expression Built
+    // echo '&lt;pre&gt;' . htmlentities(wordwrap($regexp,70,&quot;\n&quot;,1)) . '&lt;/pre&gt;';
+
+    // Running the regular expression
+    if (eregi( $regexp, $urladdr ))
+    {
+        return true; // The domain passed
+    }
+    else
+    {
+        return false; // The domain didn't pass the expression
+    }
+
+} // END Function validateUrlSyntax()
+
+
+
+/*
+About ValidateEmailSyntax():
+    This function uses the ValidateUrlSyntax() function to easily check the
+    syntax of an email address. It accepts the same options as ValidateURLSyntax
+    but defaults them for email addresses.
+
+
+Usage:
+    validateEmailSyntax( url_to_check[, options])
+
+    url_to_check - string - The url to check
+    
+    options - string - A optional string of options to set which parts of
+            the url are required, optional, or not allowed. Each option
+            must be followed by a &quot;+&quot; for required, &quot;?&quot; for optional, or
+            &quot;-&quot; for not allowed. See ValidateUrlSyntax() docs for option list.
+
+    The default options are changed to:
+        s-H-S-E+F-u+P-a+I-p-f-q-r-
+
+    This only allows an address of &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">name at domain</A>&quot;.
+
+Examples:
+    validateEmailSyntax('<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">george at fakemail.com</A>')
+    validateEmailSyntax('mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">george at fakemail.com</A>', 's+')
+    validateEmailSyntax('<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">george at fakemail.com</A>?subject=Hi%20George', 'q?')
+    validateEmailSyntax('<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">george at 212.198.33.12</A>', 'I?')
+    
+
+
+Author(s):
+    Rod Apeldoorn - rod(at)canowhoopass(dot)com
+
+    
+Homepage:
+    <A HREF="http://www.canowhoopass.com/">http://www.canowhoopass.com/</A>
+
+
+License:
+    Copyright 2004 - Rod Apeldoorn
+
+    Released under same license as validateUrlSyntax(). For details, contact me.
+
+
+*/
+
+function validateEmailSyntax( $emailaddr, $options=&quot;&quot; ){
+
+    // Check Options Parameter
+    if (!ereg( '^([sHSEFuPaIpfqr][+?-])*$', $options ))
+    {
+        trigger_error(&quot;Options attribute malformed&quot;, E_USER_ERROR);
+    }
+
+    // Set Options Array, set defaults if options are not specified
+    // Scheme
+    if (strpos( $options, 's') === false) $aOptions['s'] = '-';
+    else $aOptions['s'] = substr( $options, strpos( $options, 's') + 1, 1);
+    // <A HREF="http://">http://</A>
+    if (strpos( $options, 'H') === false) $aOptions['H'] = '-';
+    else $aOptions['H'] = substr( $options, strpos( $options, 'H') + 1, 1);
+    // <A HREF="https://">https://</A> (SSL)
+    if (strpos( $options, 'S') === false) $aOptions['S'] = '-';
+    else $aOptions['S'] = substr( $options, strpos( $options, 'S') + 1, 1);
+    // mailto: (email)
+    if (strpos( $options, 'E') === false) $aOptions['E'] = '?';
+    else $aOptions['E'] = substr( $options, strpos( $options, 'E') + 1, 1);
+    // <A HREF="ftp://">ftp://</A>
+    if (strpos( $options, 'F') === false) $aOptions['F'] = '-';
+    else $aOptions['F'] = substr( $options, strpos( $options, 'F') + 1, 1);
+    // User section
+    if (strpos( $options, 'u') === false) $aOptions['u'] = '+';
+    else $aOptions['u'] = substr( $options, strpos( $options, 'u') + 1, 1);
+    // Password in user section
+    if (strpos( $options, 'P') === false) $aOptions['P'] = '-';
+    else $aOptions['P'] = substr( $options, strpos( $options, 'P') + 1, 1);
+    // Address Section
+    if (strpos( $options, 'a') === false) $aOptions['a'] = '+';
+    else $aOptions['a'] = substr( $options, strpos( $options, 'a') + 1, 1);
+    // IP Address in address section
+    if (strpos( $options, 'I') === false) $aOptions['I'] = '-';
+    else $aOptions['I'] = substr( $options, strpos( $options, 'I') + 1, 1);
+    // Port number
+    if (strpos( $options, 'p') === false) $aOptions['p'] = '-';
+    else $aOptions['p'] = substr( $options, strpos( $options, 'p') + 1, 1);
+    // File Path
+    if (strpos( $options, 'f') === false) $aOptions['f'] = '-';
+    else $aOptions['f'] = substr( $options, strpos( $options, 'f') + 1, 1);
+    // Query Section
+    if (strpos( $options, 'q') === false) $aOptions['q'] = '-';
+    else $aOptions['q'] = substr( $options, strpos( $options, 'q') + 1, 1);
+    // Fragment (Anchor)
+    if (strpos( $options, 'r') === false) $aOptions['r'] = '-';
+    else $aOptions['r'] = substr( $options, strpos( $options, 'r') + 1, 1);
+
+    // Generate options
+    $newoptions = '';
+    foreach($aOptions as $key =&gt; $value)
+    {
+        $newoptions .= $key . $value;
+    }
+
+    // DEBUGGING - Uncomment line below to display generated options
+    // echo '&lt;pre&gt;' . $newoptions . '&lt;/pre&gt;';
+
+    // Send to validateUrlSyntax() and return result
+    return validateUrlSyntax( $emailaddr, $newoptions);
+
+} // END Function validateEmailSyntax()
+
+
+
+/*
+About ValidateFtpSyntax():
+    This function uses the ValidateUrlSyntax() function to easily check the
+    syntax of an FTP address. It accepts the same options as ValidateURLSyntax
+    but defaults them for FTP addresses.
+
+
+Usage:
+    validateFtpSyntax( url_to_check[, options])
+
+    url_to_check - string - The url to check
+    
+    options - string - A optional string of options to set which parts of
+            the url are required, optional, or not allowed. Each option
+            must be followed by a &quot;+&quot; for required, &quot;?&quot; for optional, or
+            &quot;-&quot; for not allowed. See ValidateUrlSyntax() docs for option list.
+
+    The default options are changed to:
+        s?H-S-E-F+u?P?a+I?p?f?q-r-
+
+Examples:
+    validateFtpSyntax('<A HREF="ftp://netscape.com">ftp://netscape.com</A>')
+    validateFtpSyntax('moz:<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">iesucks at netscape.com</A>')
+    validateFtpSyntax('<A HREF="ftp://netscape.com:2121/browsers/ns7/">ftp://netscape.com:2121/browsers/ns7/</A>', 'u-')
+
+
+Author(s):
+    Rod Apeldoorn - rod(at)canowhoopass(dot)com
+
+
+Homepage:
+    <A HREF="http://www.canowhoopass.com/">http://www.canowhoopass.com/</A>
+
+
+License:
+    Copyright 2004 - Rod Apeldoorn
+
+    Released under same license as validateUrlSyntax(). For details, contact me.
+*/
+
+function validateFtpSyntax( $ftpaddr, $options=&quot;&quot; ){
+
+    // Check Options Parameter
+    if (!ereg( '^([sHSEFuPaIpfqr][+?-])*$', $options ))
+    {
+        trigger_error(&quot;Options attribute malformed&quot;, E_USER_ERROR);
+    }
+
+    // Set Options Array, set defaults if options are not specified
+    // Scheme
+    if (strpos( $options, 's') === false) $aOptions['s'] = '?';
+    else $aOptions['s'] = substr( $options, strpos( $options, 's') + 1, 1);
+    // <A HREF="http://">http://</A>
+    if (strpos( $options, 'H') === false) $aOptions['H'] = '-';
+    else $aOptions['H'] = substr( $options, strpos( $options, 'H') + 1, 1);
+    // <A HREF="https://">https://</A> (SSL)
+    if (strpos( $options, 'S') === false) $aOptions['S'] = '-';
+    else $aOptions['S'] = substr( $options, strpos( $options, 'S') + 1, 1);
+    // mailto: (email)
+    if (strpos( $options, 'E') === false) $aOptions['E'] = '-';
+    else $aOptions['E'] = substr( $options, strpos( $options, 'E') + 1, 1);
+    // <A HREF="ftp://">ftp://</A>
+    if (strpos( $options, 'F') === false) $aOptions['F'] = '+';
+    else $aOptions['F'] = substr( $options, strpos( $options, 'F') + 1, 1);
+    // User section
+    if (strpos( $options, 'u') === false) $aOptions['u'] = '?';
+    else $aOptions['u'] = substr( $options, strpos( $options, 'u') + 1, 1);
+    // Password in user section
+    if (strpos( $options, 'P') === false) $aOptions['P'] = '?';
+    else $aOptions['P'] = substr( $options, strpos( $options, 'P') + 1, 1);
+    // Address Section
+    if (strpos( $options, 'a') === false) $aOptions['a'] = '+';
+    else $aOptions['a'] = substr( $options, strpos( $options, 'a') + 1, 1);
+    // IP Address in address section
+    if (strpos( $options, 'I') === false) $aOptions['I'] = '?';
+    else $aOptions['I'] = substr( $options, strpos( $options, 'I') + 1, 1);
+    // Port number
+    if (strpos( $options, 'p') === false) $aOptions['p'] = '?';
+    else $aOptions['p'] = substr( $options, strpos( $options, 'p') + 1, 1);
+    // File Path
+    if (strpos( $options, 'f') === false) $aOptions['f'] = '?';
+    else $aOptions['f'] = substr( $options, strpos( $options, 'f') + 1, 1);
+    // Query Section
+    if (strpos( $options, 'q') === false) $aOptions['q'] = '-';
+    else $aOptions['q'] = substr( $options, strpos( $options, 'q') + 1, 1);
+    // Fragment (Anchor)
+    if (strpos( $options, 'r') === false) $aOptions['r'] = '-';
+    else $aOptions['r'] = substr( $options, strpos( $options, 'r') + 1, 1);
+
+    // Generate options
+    $newoptions = '';
+    foreach($aOptions as $key =&gt; $value)
+    {
+        $newoptions .= $key . $value;
+    }
+
+    // DEBUGGING - Uncomment line below to display generated options
+    // echo '&lt;pre&gt;' . $newoptions . '&lt;/pre&gt;';
+
+    // Send to validateUrlSyntax() and return result
+    return validateUrlSyntax( $ftpaddr, $newoptions);
+
+} // END Function validateFtpSyntax()
+
+?&gt;

Added: trunk/inc/sm-logout.php
===================================================================
--- trunk/inc/sm-logout.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/sm-logout.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,19 @@
+&lt;?php
+session_start();
+
+if(isset($_SESSION['logged_in']))
+{
+// Unset all of the session variables.
+$_SESSION = array();
+
+// If it's desired to kill the session, also delete the session cookie.
+// Note: This will destroy the session, and not just the session data!
+if (isset($_COOKIE[session_name()])) {
+   setcookie(session_name(), '', time()-42000, '/');
+}
+
+// Finally, destroy the session.
+session_destroy();
+header(&quot;Location: <A HREF="http://">http://</A>&quot; . $_SERVER['HTTP_HOST']);
+}
+?&gt;

Added: trunk/inc/sm-messages.php
===================================================================
--- trunk/inc/sm-messages.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/sm-messages.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,91 @@
+&lt;?php
+// +----------------------------------------------------------------------+
+// | Simuze                                                                              |
+// +----------------------------------------------------------------------+
+// | Copyright (c) 2004 Stichting Open Media or noted otherwise           |
+// +----------------------------------------------------------------------+
+// | License: See below code                                                        |
+// +----------------------------------------------------------------------+
+// | Author(s): Bjorn Wijers &lt;bwijers[AT]bdisfunctional[DOT]net&gt;        |
+// |                                                                                         |
+// +----------------------------------------------------------------------+
+//
+
+/** lookup table with all the messages used in Simuze
+* so we can easily change the language in the future
+* for now all F_MSG are feedback messages and 
+* all E_MSG are error messages. 
+*/
+
+//confirm email message
+//the ##HASH## will be substituted with the md5 hash
+//the ##NAME## will be substituted with the username
+$msg =  &quot;Beste ##NAME##, welkom bij Simuze!\n\n&quot;;
+$msg .= &quot;Klik op onderstaande link om je registratie bij Simuze te bevestigen.\n&quot;;
+$msg .= &quot;Mocht je mail programma dit niet ondersteunen, kopieer dan deze onderstaande link in je browserscherm\n&quot;; 
+$msg .= &quot;<A HREF="http://www.simuze.nl/live/confirm.php?confirm=##HASH##\n">http://www.simuze.nl/live/confirm.php?confirm=##HASH##\n</A>&quot;;
+$msg .= &quot;Bedankt voor je aanmelding!\n\n&quot;;
+$msg .= &quot;Het Simuze team&quot;;
+
+//extra messages
+define(&quot;REGISTER_EMAIL_MSG&quot;, $msg);
+
+//confirm email message
+//the ##HASH## will be substituted with the md5 hash
+//the ##NAME## will be substituted with the username
+$lostmsg =  &quot;Beste ##NAME##,\n\n&quot;;
+$lostmsg .= &quot;Je hebt aangegeven dat je je wachtwoord kwijt bent. Je wachtwoord is nu gewijzigd in:##PWD##\n&quot;;
+$lostmsg .= &quot;wijzig dit  wachtwoord zo snel mogelijk in een zelfgekozen wachtwoord. Het wijzigen van je wachtwoord&quot;; 
+$lostmsg .= &quot;kun je doen door in te loggen en op je profiel pagina te kiezen voor \&quot;wachtwoord wijzigen\&quot; \n&quot;; 
+$lostmsg .= &quot;Het Simuze team&quot;;
+
+//extra messages
+define(&quot;REGISTER_LOST_EMAIL_MSG&quot;, $lostmsg);
+define(&quot;PROFILE_EMPTY_MSG&quot;,&quot;Niet ingevuld&quot;);
+
+$commentmsg .= &quot;Music brought to you by Simuze (<A HREF="http://www.simuze.nl">http://www.simuze.nl</A>)\n&quot;; 
+
+define(&quot;MP3_TAG&quot;, $commentmsg);
+
+//changed settings message
+//the ##HASH## will be substituted with the md5 hash
+//the ##NAME## will be substituted with the username
+$settings_msg =  &quot;Beste ##NAME##, \n\n&quot;;
+$settings_msg .= &quot;Je instellingen zijn gewijzigd.\n\n&quot;;
+$settings_msg .= &quot;Het Simuze team&quot;;
+
+//extra messages
+define(&quot;CHANGE_SETTINGS_EMAIL_MSG&quot;, $settings_msg);
+
+
+// CONSTANTS
+define(&quot;QUOTA_FILES&quot;, &quot;9999&quot;);
+define(&quot;QUOTA_SIZE&quot;, &quot;75&quot;);
+define(&quot;HOMEDIR&quot;, &quot;/data/uploads/&quot;);
+define(&quot;HOMEDIR_CHECKED&quot;, &quot;/data/checked/&quot;);
+define(&quot;HOMEDIR_PUBLIC&quot;, &quot;/data/public/&quot;);
+define(&quot;LOGGED_IN_PAGE&quot;,&quot;users/hq.php&quot;);
+define(&quot;UPLOAD_DIR&quot;,&quot;uploads/premoderated/&quot;);
+define(&quot;AVATAR_MAX_SIZE&quot;, &quot;76800&quot;); //75 kilobytes in bytes
+define(&quot;AVATAR_UPLOAD_PATH&quot;, &quot;/var/www/simuze.nl/live/media/avatar/&quot;);
+define(&quot;MUSIC_MAX_SIZE&quot;, &quot;11534336&quot;); //11 megabytes in bytes
+define(&quot;MUSIC_UPLOAD_PATH&quot;, &quot;/data/uploads/&quot;); 
+define(&quot;HI_QUALITY_DIR&quot;, &quot;mp3hi/&quot;);
+define(&quot;LO_QUALITY_DIR&quot;, &quot;mp3lo/&quot;);
+define(&quot;ORIG_QUALITY_DIR&quot;, &quot;orig/&quot;);
+define(&quot;PLAYLIST_DIR&quot;,&quot;/var/www/simuze.nl/live/media/playlist/users/&quot;);
+define(&quot;PLAYLIST_TEMP_DIR&quot;,&quot;/var/www/simuze.nl/live/media/playlist/temp/&quot;);
+define(&quot;SIMUZE_URL&quot;, &quot;<A HREF="http://www.simuze.nl/live/">http://www.simuze.nl/live/</A>&quot;);
+
+
+
+
+
+
+
+
+
+
+
+
+?&gt;

Added: trunk/inc/sm-secure-level2.php
===================================================================
--- trunk/inc/sm-secure-level2.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/sm-secure-level2.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,18 @@
+&lt;?php
+require_once(&quot;inc/sm-secure.php&quot;);
+
+$name = $_SESSION['name'];
+$uhandle = qGetUser($name);
+
+if($nr_rows = mysql_num_rows($uhandle) == 1) {
+	$userrow = mysql_fetch_array($uhandle);
+	//userlevel 2 means music moderator
+	if($userrow['user_level'] &lt; 2){
+		header(&quot;Location: <A HREF="http://">http://</A>&quot; . $_SERVER['HTTP_HOST']);
+	}    
+
+} else {
+	header(&quot;Location: <A HREF="http://">http://</A>&quot; . $_SERVER['HTTP_HOST']);
+}
+
+?&gt;

Added: trunk/inc/sm-secure.php
===================================================================
--- trunk/inc/sm-secure.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/inc/sm-secure.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,28 @@
+&lt;?php
+session_start();
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+// quick test to see if someone is logged in or not, if the var is set we are checking if the user has access 
+    
+    if(!isset($_SESSION['logged_in'])) {
+       header(&quot;Location: <A HREF="http://">http://</A>&quot; . $_SERVER['HTTP_HOST']);
+    } else {
+        if(!empty($_SESSION['name']) &amp;&amp; checkUsernameValid($_SESSION['name'])) {
+            $the_name = $_SESSION['name'];
+            $sec_handle = qGetUser($the_name);
+            
+            if($sec_nr_rows = mysql_num_rows($sec_handle) == 1) {
+                $sec_user = mysql_fetch_array($sec_handle);
+                $uid  = CryptIt(&quot;md5&quot;,$sec_user['uid']);
+                if($uid != $_SESSION['uid']){
+                    header(&quot;Location: <A HREF="http://">http://</A>&quot; . $_SERVER['HTTP_HOST']);
+                }    
+            } else {
+                header(&quot;Location: <A HREF="http://">http://</A>&quot; . $_SERVER['HTTP_HOST']);
+            }
+        } else {
+                header(&quot;Location: <A HREF="http://">http://</A>&quot; . $_SERVER['HTTP_HOST']);
+        }
+    }
+
+?&gt;

Added: trunk/index.php
===================================================================
--- trunk/index.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/index.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,211 @@
+&lt;?php
+require_once('inc/sm-db-queries.php');
+require_once('inc/sm-messages.php');
+require_once('inc/sm-lib-functions.php');
+
+//flashplayer
+$flashplayer = '&lt;object classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; codebase=&quot;<A HREF="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0">http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0</A>&quot; width=&quot;17&quot; height=&quot;17&quot; id=&quot;musicplayer&quot; align=&quot;middle&quot;&gt;';
+$flashplayer.= '&lt;param name=&quot;allowScriptAccess&quot; value=&quot;sameDomain&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;movie&quot; value=&quot;/live/media/flash/musicplayer.swf&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;loop&quot; value=&quot;false&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;menu&quot; value=&quot;false&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;quality&quot; value=&quot;high&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;flashvars&quot; value=&quot;song_url=##URL##&quot;';
+$flashplayer.= '&lt;param name=&quot;wmode&quot; value=&quot;transparent&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;bgcolor&quot; value=&quot;#f7f3e7&quot; /&gt;';
+$flashplayer.= '&lt;embed src=&quot;/live/media/flash/musicplayer.swf&quot; flashvars=&quot;song_url=##URL##&quot; loop=&quot;false&quot; menu=&quot;false&quot; quality=&quot;high&quot; wmode=&quot;transparent&quot; bgcolor=&quot;#f7f3e7&quot; width=&quot;17&quot; height=&quot;17&quot; name=&quot;musicplayer&quot; align=&quot;middle&quot; allowScriptAccess=&quot;sameDomain&quot; type=&quot;application/x-shockwave-flash&quot; pluginspage=&quot;<A HREF="http://www.macromedia.com/go/getflashplayer">http://www.macromedia.com/go/getflashplayer</A>&quot; /&gt;';
+$flashplayer.= '&lt;/object&gt;';
+
+/* code voor het weergeven van de nummers */
+$handle2 = qGetLatestAudioAndInfo();
+$nr_rows2 = mysql_num_rows($handle2);
+for($i = 0; $i &lt; $nr_rows2; $i++) {
+	$nummer = mysql_fetch_array($handle2);
+	
+	$hi_path = rawurldecode($nummer['audio_hi_path']);
+	$the_hi_url = str_replace(&quot;/data/&quot;,&quot;<A HREF="http://www.simuze.nl/live/">http://www.simuze.nl/live/</A>&quot;,$hi_path);
+	$flash = str_replace(&quot;##URL##&quot;, $the_hi_url ,$flashplayer);
+	//echo &quot;$the_hi_url&quot;;
+	
+	
+	//get license imagepath
+	$licentie_nr = $nummer['cclicense_id'];
+	$licentie_path = $nummer['cclicense_image_path'];
+	$license_official = $nummer['cclicense_human_url'];
+	//decode url
+	$cc_path = rawurldecode($nummer['cclicense_human_url']);
+	$the_cc_url = str_replace(&quot;/data/&quot;,&quot;<A HREF="http://www.simuze.nl/live/">http://www.simuze.nl/live/</A>&quot;,$cc_path);
+	
+	
+	$licentie_img = &quot;&lt;a href=\&quot;$the_cc_url\&quot; target=\&quot;_blank\&quot;&gt;&lt;img src=\&quot;$licentie_path\&quot; border=\&quot;0\&quot;&gt;&lt;/a&gt;&quot;;
+	
+	//get genrename
+	$genre_name = $nummer['genre_name']; 
+	
+	//get audiosize
+	$audio_bytes = $nummer['audio_size'];
+	$audio_size = round($audio_bytes /1024/1024, 1); 
+	
+	$latest_audio .= &quot;&lt;tr bgcolor=\&quot;#EDD8BE\&quot;&gt;&quot;;
+	$latest_audio .= &quot;&lt;td&gt;$flash&lt;/td&gt;&quot;;
+	$latest_audio .= &quot;&lt;td&gt;&quot;;
+	$latest_audio .= &quot;&lt;a href=\&quot;$the_hi_url\&quot;&gt;&quot;;
+	$latest_audio .= $nummer['audio_title'];
+	$latest_audio .= &quot;&lt;/a&gt;&quot;;
+	$latest_audio .= &quot;&lt;/td&gt;&quot;;
+	$latest_audio .= &quot;&lt;td&gt;&quot;;
+	$latest_audio .= $genre_name;
+	$latest_audio .= &quot;&lt;/td&gt;&quot;;
+	$latest_audio .= &quot;&lt;td&gt;&quot;;
+	$latest_audio .= &quot;&lt;a href=\&quot;showprofile.php?username=$nummer[uname]\&quot; title=\&quot;bekijk het profiel van $nummer[uname]\&quot;&gt; $nummer[audio_artist]&lt;/a&gt;&quot;;
+	$latest_audio .= &quot;&lt;/td&gt;&quot;;
+	$latest_audio .= &quot;&lt;td&gt;&quot;;
+	$latest_audio .= $audio_size;
+	$latest_audio .= &quot; MB&quot;;
+	$latest_audio .= &quot;&lt;/td&gt;&quot;;
+	$latest_audio .= &quot;&lt;td&gt;&quot;;
+	$latest_audio .= $licentie_img;
+	$latest_audio .= &quot;&lt;/td&gt;&quot;;
+	$latest_audio .= &quot;&lt;/tr&gt;&quot;;
+}
+
+
+$h_latest = qGetLatestUsers(7);
+$nr_users = mysql_num_rows($h_latest);
+$latest_users = null;
+
+if( $nr_users &gt; 0) {
+	$latest_users = &quot;&lt;table border=\&quot;0\&quot; class=\&quot;ruler\&quot; id=\&quot;mytable\&quot;&gt;\n&quot;;
+	for($i = 0; $i &lt; $nr_users; $i++) {
+		$row = mysql_fetch_array($h_latest);
+		//prep path to avatar
+		$decoded_path = rawurldecode($row['avatar_path']);
+		$path = str_replace(&quot;/var/www/simuze.nl/live/&quot;,&quot;&quot;,$decoded_path); 
+        $imgsrc = $path . $row['avatar_filename_small'];
+		
+		
+		$latest_users .= &quot;&lt;tr&gt;\n&quot;;
+		$latest_users .= &quot;&lt;td&gt;&lt;a href=\&quot;showprofile.php?username=$row[uname]\&quot; title=\&quot;bekijk het profiel van $row[uname]\&quot;&gt; Bekijk het profiel van Simuze nieuwkomer: $row[uname]&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$latest_users .= &quot;&lt;td&gt;&lt;a href=\&quot;showprofile.php?username=$row[uname]\&quot; title=\&quot;bekijk het profiel van $row[uname]\&quot;&gt;&lt;img alt=\&quot;avatar\&quot; src=\&quot;$imgsrc\&quot; border=\&quot;0\&quot; /&gt;&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$latest_users .= &quot;&lt;/tr&gt;\n&quot;;
+	}
+$latest_users .= &quot;&lt;/table&gt;\n&quot;;
+	
+} else {
+	$latest_users = &quot;Er zijn op dit moment (nog) geen nieuwe gebruikers gevonden&quot;;
+}
+
+?&gt;
+&lt;?php require 'template_header.php'; ?&gt;	
+
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+					&lt;div id=&quot;uitleg&quot;&gt;
+                    	&lt;object classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; codebase=&quot;<A HREF="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0">http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0</A>&quot; width=&quot;295&quot; height=&quot;230&quot; id=&quot;Sites/simuze/live/media/flash/info_filmpje.swf&quot; align=&quot;middle&quot;&gt;
+						&lt;param name=&quot;allowScriptAccess&quot; value=&quot;sameDomain&quot; /&gt;
+						&lt;param name=&quot;movie&quot; value=&quot;media/flash/info_filmpje.swf&quot; /&gt;
+						&lt;param name=&quot;quality&quot; value=&quot;high&quot; /&gt;
+						&lt;param name=&quot;bgcolor&quot; value=&quot;#F7F3E7&quot; /&gt;
+						&lt;embed src=&quot;media/flash/info_filmpje.swf&quot; quality=&quot;high&quot; bgcolor=&quot;#F7F3E7&quot; width=&quot;295&quot; height=&quot;230&quot; name=&quot;info_filmpje&quot; align=&quot;middle&quot; allowScriptAccess=&quot;sameDomain&quot; type=&quot;application/x-shockwave-flash&quot; pluginspage=&quot;<A HREF="http://www.macromedia.com/go/getflashplayer">http://www.macromedia.com/go/getflashplayer</A>&quot; /&gt;
+						&lt;/object&gt;
+                   
+					&lt;/div&gt;
+					
+				&lt;div id=&quot;kolom1&quot;&gt;
+					&lt;div id=&quot;nieuwskopjes&quot;&gt;	
+					&lt;h1&gt;Welkom bij Simuze!&lt;/h1&gt;
+					&lt;!--&lt;p class=&quot;small&quot;&gt;Ontmoet anderen met dezelfde
+					muzieksmaak, en download of deel muziek
+					legaal, gratis en onbeperkt. &lt;a href=&quot;/live/register.php&quot;&gt;Wordt gratis lid&lt;/a&gt; en
+					ontdek nieuwe muziek via je eigen playlists!&lt;/p&gt;
+					&lt;br /&gt;
+					&lt;br /&gt; --&gt;
+					&lt;div id=&quot;upload_muzikanten&quot;&gt;
+					&lt;h2 class=&quot;white&quot;&gt;Muzikant?&lt;/h2&gt;
+					&lt;p class=&quot;uitleg&quot;&gt;&lt;a href=&quot;/live/faq.php#muzikant&quot; class=&quot;help&quot; style=&quot;margin:0px&quot;&gt;Upload gratis je eigen muziek onder&lt;br /&gt;
+					je eigen voorwaarden. &lt;/a&gt;&lt;/p&gt;
+					&lt;/div&gt;
+					
+					&lt;div id=&quot;download_liefhebbers&quot;&gt;
+					&lt;h2 class=&quot;white&quot;&gt;Muziekliefhebber?&lt;/h2&gt;
+					&lt;p class=&quot;uitleg&quot;&gt;&lt;a href=&quot;/live/faq.php#verspreiden&quot; class=&quot;help&quot; style=&quot;margin:0px&quot;&gt;Ontdek/download/deel gratis en&lt;br /&gt;
+					onbeperkt nieuwe muziek. &lt;/a&gt;
+					&lt;/p&gt;
+					&lt;br /&gt;
+					&lt;/div&gt;
+					
+					&lt;a href=&quot;/live/oversimuze.php&quot;&gt;&lt;h2&gt;meer weten?&lt;/h2&gt;&lt;/a&gt; 
+		
+					&lt;/div&gt;
+				&lt;/div&gt;
+				
+				&lt;div id=&quot;bar1&quot;&gt; 
+					&lt;div class=&quot;bar_links_groot&quot;&gt;
+						&lt;h1 class=&quot;bar1white&quot;&gt;Simuze radio &lt;img src=&quot;/live/img/images/pijltjes_wit_3.gif&quot; border=&quot;0&quot; /&gt;  &lt;a href=&quot;#&quot; class=&quot;help&quot;&gt;luister nu!&lt;/a&gt;&lt;/h1&gt;
+					&lt;/div&gt;
+				&lt;/div&gt;
+
+				&lt;div id=&quot;kolom2&quot;&gt;
+					
+					&lt;div class=&quot;kopjelinks_roundcont_rood&quot;&gt;
+						&lt;div id=&quot;uitgelicht_kopje&quot;&gt;&lt;/div&gt;
+						&lt;p class=&quot;small&quot;&gt;
+						&lt;a href=&quot;/live/nieuws/?p=24&quot;&gt;
+						&lt;b&gt;Gezocht!&lt;/b&gt;&lt;br /&gt;
+						&lt;img src=&quot;/live/img/images/beeldmerk_rood_klein.gif&quot; alt=&quot;simuze&quot; border=&quot;0&quot; class=&quot;alignright&quot; /&gt;
+						We zijn hard op zoek naar moderators, die beoordelen of een nummer wel of niet van de uploader is. Dit om de Madonna's en Eminen's van deze wereld te 'beschermen'. Vind je het leuk om muziek te beluisteren en ben je enigszins bekend in een genre, mail ons dan. Ook zijn we op zoek naar programmeurs en vormgevers, festivalgangers met schrijfvingers en flyerverspreiders!
+							 &lt;/a&gt;
+						&lt;/p&gt;
+						&lt;div class=&quot;onder_rood&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+				
+					&lt;div class=&quot;kopjerechts_roundcont_rood&quot;&gt;
+						&lt;div id=&quot;nieuwkomers_kopje&quot;&gt;&lt;/div&gt;
+						
+						&lt;?php echo &quot;$latest_users&quot;;?&gt;
+												
+						&lt;div class=&quot;onder_rood&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+					&lt;!-- ruimte voor extra text --&gt;&lt;br /&gt;&lt;br /&gt;
+				&lt;/div&gt;	
+				
+				&lt;div id=&quot;bar1_onder&quot;&gt; &lt;/div&gt;
+				
+				
+				
+				&lt;div id=&quot;kolom3&quot;&gt;
+					&lt;div class=&quot;downloads_roundcont&quot;&gt;
+						&lt;div id=&quot;nieuweuploads_main_kopje&quot;&gt;&lt;/div&gt;
+						
+						&lt;table id=&quot;playlist&quot; width=&quot;596&quot; cellpadding=&quot;4&quot; cellspacing=&quot;1&quot;&gt;
+							&lt;tr&gt;
+								&lt;td colspan=&quot;6&quot;&gt;&lt;p&gt;Dit zijn de laatst toegevoegde nummers op Simuze. Je kan ze direct downloaden of beluisteren. De licentie geeft aan aan welke voorwaarden je je moet houden.&lt;/p&gt;&lt;/td&gt;
+							&lt;/tr&gt;	
+							
+							&lt;tbody&gt;
+							&lt;tr&gt;
+								&lt;th width=&quot;20&quot;&gt; &lt;/th&gt;
+								&lt;th width=&quot;200&quot;&gt;Titel:&lt;/th&gt;
+								&lt;th width=&quot;50&quot;&gt;Genre:&lt;/th&gt;
+								&lt;th&gt;Artiest:&lt;/th&gt;
+								&lt;th&gt;MB&lt;/th&gt;
+								&lt;th&gt;Licentie:&lt;/th&gt;
+							&lt;/tr&gt;	
+							
+							&lt;?php echo $latest_audio; ?&gt;
+							&lt;/tbody&gt;
+						
+						&lt;/table&gt;
+						
+						
+
+							
+						&lt;div class=&quot;downloads_roundbottom&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;
+				&lt;/div&gt;				
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+		&lt;?php require 'template_sidebar_footer_main.php'; ?&gt;
+		
+	
\ No newline at end of file

Added: trunk/index_0.php
===================================================================
--- trunk/index_0.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/index_0.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,16 @@
+&lt;?php require 'template_header.php'; ?&gt;	
+
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+					&lt;div id=&quot;kolom1&quot;&gt;
+					&lt;h2&gt;Formulier sturen mislukt...&lt;/h2&gt;
+					&lt;p class=&quot;space&quot;&gt;
+					Helaas er is iets misgegaan. Probeer het &lt;a href=&quot;/live/simuze_helpen.php&quot;&gt;nog eens&lt;/a&gt;.
+					&lt;/p&gt;
+					&lt;/div&gt;
+				&lt;/div&gt;				
+		&lt;/div&gt;
+		
+&lt;?php require 'template_sidebar_footer_main.php'; ?&gt;
+		
+	
\ No newline at end of file

Added: trunk/index_1.php
===================================================================
--- trunk/index_1.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/index_1.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,16 @@
+&lt;?php require 'template_header.php'; ?&gt;	
+
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+					&lt;div id=&quot;kolom1&quot;&gt;
+					&lt;h1&gt;Formulier gestuurd!&lt;/h1&gt;
+					&lt;p class=&quot;space&quot;&gt;
+					Hartelijk dank voor je feedback. 
+					&lt;/p&gt;
+					&lt;/div&gt;
+				&lt;/div&gt;				
+		&lt;/div&gt;
+		
+&lt;?php require 'template_sidebar_footer_main.php'; ?&gt;
+		
+	
\ No newline at end of file

Added: trunk/info_filmpje2.swf
===================================================================
(Binary files differ)


Property changes on: trunk/info_filmpje2.swf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/js/lib.js
===================================================================
--- trunk/js/lib.js	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/js/lib.js	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,195 @@
+/*
+Description			:	validate an edit field
+Input parameters	:
+	szfield		: javascript form field, field to be checked
+	fieldname	: string, field name
+	emptyallowed: boolean, true indicates empty value allowed.
+Return value		:
+	true : ok
+	false : failed
+*/
+function validateEditfield(szfield, message, emptyallowed)
+{
+	
+	if (szfield.value == &quot;&quot; &amp;&amp; !emptyallowed)
+	{
+		alert(message);
+		szfield.focus();
+		szfield.style.borderColor=&quot;#FF0000&quot;;
+		return false;
+	}
+	else
+	{
+	    var error = false;
+        var illegal = &quot; &quot;;
+        //if(szfield.value.indexOf(&quot;,&quot;)!=-1) error = true;
+        //if(szfield.value.indexOf(&quot;:&quot;)!=-1) error = true;
+        //if(szfield.value.indexOf(&quot;!&quot;)!=-1) error = true;
+        if(szfield.value.indexOf(&quot;#&quot;)!=-1) illegal += &quot;#&quot; , error = true;
+        if(szfield.value.indexOf(&quot;$&quot;)!=-1) illegal += &quot;$&quot; , error = true;
+        //if(szfield.value.indexOf(&quot;%&quot;)!=-1) illegal += &quot;%&quot; , error = true;
+        if(szfield.value.indexOf(&quot;^&quot;)!=-1) illegal += &quot;^&quot; , error = true;
+        if(szfield.value.indexOf(&quot;&amp;&quot;)!=-1) illegal += &quot;&amp;&quot; , error = true;
+        //if(szfield.value.indexOf(&quot;*&quot;)!=-1) error = true;
+        //if(szfield.value.indexOf(&quot;(&quot;)!=-1) error = true;
+        //if(szfield.value.indexOf(&quot;)&quot;)!=-1) error = true;
+        if(szfield.value.indexOf(&quot;&lt;&quot;)!=-1) illegal += &quot;&lt;&quot; , error = true;
+        if(szfield.value.indexOf(&quot;&gt;&quot;)!=-1) illegal += &quot;&gt;&quot; , error = true;
+        if(szfield.value.indexOf(&quot;/&quot;)!=-1) illegal += &quot;/&quot; , error = true;
+        //if(szfield.value.indexOf(&quot;'&quot;)!=-1) error = true;
+        if(szfield.value.indexOf(&quot;\\&quot;)!=-1) error = true;
+        //if(szfield.value.indexOf(&quot;;&quot;)!=-1) error = true;
+        //if(szfield.value.indexOf(&quot;+&quot;)!=-1) error = true;
+        //if(szfield.value.indexOf(&quot;=&quot;)!=-1) error = true;
+        if(szfield.value.indexOf(&quot;{&quot;)!=-1) illegal += &quot;{&quot; , error = true;
+        if(szfield.value.indexOf(&quot;}&quot;)!=-1) illegal += &quot;}&quot; , error = true;
+        if(szfield.value.indexOf(&quot;[&quot;)!=-1) illegal += &quot;[&quot; , error = true;
+        if(szfield.value.indexOf(&quot;]&quot;)!=-1) illegal += &quot;]&quot; , error = true;
+      
+        if(error)
+		{
+            var chars = &quot;&quot;;
+            chars = chars + illegal;
+            message = &quot;Ongeldig(e) teken(s) gevonden: \n&quot; + chars + &quot;\n Gelieve deze niet te gebruiken.&quot;;
+            alert(message);
+			szfield.style.borderColor=&quot;#FF0000&quot;;
+            szfield.focus();
+            return false;
+        }
+	}
+
+	return true;
+}
+
+function textCounter(field, countfield, maxlimit) {
+    if (field.value.length &gt; maxlimit) {
+        field.value = field.value.substring(0, maxlimit);
+    } else { 
+        countfield.value = maxlimit - field.value.length;
+    }
+}
+
+function unmask_email(name,domain,subject) {
+    document.location.href = &quot;mailto:&quot;+name+&quot;@&quot;+domain+&quot;?subject=&quot;+subject;
+}
+
+/* inclusive length check */
+function checkLength(element, minLen, maxLen) {
+	if(element.length &lt;= maxLen &amp;&amp; element.length &gt;= minLen) {
+		return true;
+	} else {
+		return false;
+	}
+}
+
+
+/* 
+* compares the pwds inserted at the settings page
+*/
+function checkFieldsEqual(form){
+	if(!checkLength(form.password.value,6,16)) {
+		alert(&quot;Wachtwoord heeft een onjuiste lengte. Een wachtwoord moet uit minimaal 6 en maximaal 16 cijfers en/of letters bestaan&quot;);
+		return false;
+	} else if (form.password.value != form.password2.value){
+		alert(&quot;Wachtwoorden zijn niet gelijk. Waarschijnlijk heb je een tikfoutje gemaakt. Probeer het nogmaals&quot;);
+		return false;
+	}
+	return true;
+}
+
+function refresh(select) {
+	var playlist = select.options[select.selectedIndex].value;
+	var url = 'users/player.php?p=' + playlist;
+	if(url != 'default') {
+		NewWindow(url,'name','300','410','no');
+	}	
+
+}	
+
+
+
+/* check the register form */
+function checkRegister(form) {
+			
+	// set variables
+	var fieldNr = form.length; 	
+	var message = &quot;Je bent iets vergeten in te vullen. Je kunt dit zien aan de rode omranding&quot;;
+	var output  = true;
+	
+	// check all fields	
+	for(i=0;i&lt;fieldNr;i++)
+	{
+		//setting the initial state
+		form.elements[i].style.borderColor = &quot;&quot;;	
+		
+		//making sure the element property exists
+		if(form.elements[i].value != undefined)
+		{
+			// check none of the fields is empty or contains problematic chars
+			// NOTE: using the names of the password fields. i.e. password and password2 are fieldnames	
+			if(!validateEditfield(form.elements[i], message , false))
+			{
+				output = false;
+			} 
+		}
+	}
+	// if not false already check the rest
+	if(output) {
+		if(!checkLength(form.uname.value,4,16)) {
+			alert(&quot;Gebruikersnaam heeft een onjuiste lengte. Een gebruikersnaam moet uit minimaal 4 en maximaal 16 cijfers en/of letters bestaan&quot;);
+			return false;
+		} else if(!checkLength(form.password.value,6,16)) {
+			alert(&quot;Wachtwoord heeft een onjuiste lengte. Een wachtwoord moet uit minimaal 6 en maximaal 16 cijfers en/of letters bestaan&quot;);
+			return false;
+		} else if(form.password.value != form.password2.value) {
+			alert(&quot;Wachtwoorden zijn niet gelijk aan elkaar. Waarschijnlijk heb je een tikfoutje gemaakt. Probeer het nog eens&quot;);
+			return false;
+		} else if(!form.voorwaarden.checked) {
+			alert(&quot;Om lid te kunnen worden van Simuze dien je in te stemmen met de Simuze voorwaarden. Vink het vakje 'ik ben bekend met de voorwaarden van Simuze en stem hiermee in' af&quot;)
+			return false;
+			form.voorwaarden.style.borderColor = &quot;#FF0000&quot;;
+		}
+	}
+	return output;
+}
+
+function checkEditMusic(form){
+	var fieldNr = form.length; 	
+	var message = &quot;Enkele velden zijn verplicht om in te vullen en je bent iets vergeten in te vullen. Zou je dit als nog willen doen. Deze velden zijn rood omrand&quot;;
+	var output  = true;
+    
+	for(i=0;i&lt;fieldNr;i++)
+	{
+        var element = form.elements[i];
+        
+        //setting the initial state
+		element.style.borderColor = &quot;&quot;;	
+        var theName = new String(element.name);
+        
+        
+        //check for the fields that are required (note: these need a name starting with __ i.e. double underscore)
+        if(theName.charAt(0) == &quot;_&quot; &amp;&amp; theName.charAt(1) == &quot;_&quot;) {
+            if(element.value == undefined || element.value == &quot;&quot; )
+            {
+                alert(message);
+                output = false;
+                element.style.borderColor=&quot;#FF0000&quot;;
+                element.focus();
+			}
+		}
+    }
+	if(output) {
+		
+		var selectedOption = form.genre.options[form.genre.selectedIndex];
+		if(selectedOption.value == &quot;default&quot;) {
+			form.genre.focus();
+			alert(&quot;Je bent vergeten een genre te selecteren. Je dient een genre te kiezen wat zo goed mogelijk je muziek beschrijft zodat anderen je muziek kunnen vinden.&quot;);
+			return false;
+		}
+	}
+	
+    return output;
+
+
+}
+


Property changes on: trunk/js/lib.js
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/js/require.js
===================================================================
--- trunk/js/require.js	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/js/require.js	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,31 @@
+function requireSomeFields(form)
+{
+	var fieldNr = form.length; 	
+	var message = &quot;Enkele velden zijn verplicht om in te vullen en je bent iets vergeten in te vullen. Zou je dit als nog willen doen. Deze velden zijn rood omrand&quot;;
+	var output  = false;
+    
+	for(i=0;i&lt;fieldNr;i++)
+	{
+        var element = form.elements[i];
+        
+        //setting the initial state
+		element.style.borderColor = &quot;&quot;;	
+        var theName = new String(element.name);
+        
+        
+        //check for the fields that are required (note: these need a name starting with __ i.e. double underscore)
+        if(theName.charAt(0) == &quot;_&quot; &amp;&amp; theName.charAt(1) == &quot;_&quot;) {
+            if(element.value == undefined || element.value == &quot;&quot; )
+            {
+                alert(message);
+                output = false;
+                element.style.borderColor=&quot;#FF0000&quot;;
+                element.focus();
+                return false;
+            } else {
+                output = true;
+            }
+        }
+    }
+    return output;
+}

Added: trunk/js/sendit.js
===================================================================
--- trunk/js/sendit.js	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/js/sendit.js	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,22 @@
+function sendIt(form)
+{
+	var fieldNr = form.length; 	
+	var message = &quot;Je bent iets vergeten in te vullen. Je kunt dit zien aan de rode omranding&quot;;
+	var output  = true;
+
+	for(i=0;i&lt;fieldNr;i++)
+	{
+		//setting the initial state
+		form.elements[i].style.borderColor = &quot;&quot;;	
+		
+		//making sure the element property exists
+		if(form.elements[i].value != undefined)
+		{
+			if(!validateEditfield(form.elements[i], message , false))
+			{
+				output = false;
+			}
+		}
+	} 
+	return output;
+}


Property changes on: trunk/js/sendit.js
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/js/tableruler.js
===================================================================
--- trunk/js/tableruler.js	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/js/tableruler.js	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,29 @@
+/*
+	tableruler()
+	written by Chris Heilmann for alistapart.
+	enables a rollover of rows for each table with the classname &quot;hlrows&quot;
+*/
+
+function tableruler()
+{
+	if (document.getElementById &amp;&amp; document.createTextNode)
+	{
+		var tables=document.getElementsByTagName('table');
+		for (var i=0;i&lt;tables.length;i++)
+		{
+			if(tables[i].className=='ruler')
+			{
+				var trs=tables[i].getElementsByTagName('tr');
+				for(var j=0;j&lt;trs.length;j++)
+				{
+					if(trs[j].parentNode.nodeName=='TBODY')
+					{
+						trs[j].onmouseover=function(){this.className='ruled';return false}
+						trs[j].onmouseout=function(){this.className='';return false}
+					}
+				}
+			}
+		}
+	}
+}
+

Added: trunk/js/tcells.js
===================================================================
--- trunk/js/tcells.js	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/js/tcells.js	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,79 @@
+&lt;!--
+
+
+ 
+  // this function is need to work around 
+  // a bug in IE related to element attributes
+  function hasClass(obj) {
+     var result = false;
+     if (obj.getAttributeNode(&quot;class&quot;) != null) {
+         result = obj.getAttributeNode(&quot;class&quot;).value;
+     }
+     return result;
+  }   
+
+ function stripe(id) {
+
+    // the flag we'll use to keep track of 
+    // whether the current row is odd or even
+    var even = false;
+  
+    // if arguments are provided to specify the colours
+    // of the even &amp; odd rows, then use the them;
+    // otherwise use the following defaults:
+    var evenColor = arguments[1] ? arguments[1] : &quot;#F7F3E7&quot;;
+    var oddColor = arguments[2] ? arguments[2] : &quot;#EDD8BE&quot;;
+  
+    // obtain a reference to the desired table
+    // if no such table exists, abort
+    var table = document.getElementById(id);
+    if (! table) { return; }
+    
+    // by definition, tables can have more than one tbody
+    // element, so we'll have to get the list of child
+    // &lt;tbody&gt;s 
+    var tbodies = table.getElementsByTagName(&quot;tbody&quot;);
+
+    // and iterate through them...
+    for (var h = 0; h &lt; tbodies.length; h++) {
+    
+     // find all the &lt;tr&gt; elements... 
+      var trs = tbodies[h].getElementsByTagName(&quot;tr&quot;);
+      
+      // ... and iterate through them
+      for (var i = 0; i &lt; trs.length; i++) {
+
+	    // avoid rows that have a class attribute
+        // or backgroundColor style
+	    if (!hasClass(trs[i]) &amp;&amp; ! trs[i].style.backgroundColor) {
+ 
+         // get all the cells in this row...
+          var tds = trs[i].getElementsByTagName(&quot;td&quot;);
+        
+          // and iterate through them...
+          for (var j = 0; j &lt; tds.length; j++) {
+        
+            var mytd = tds[j];
+
+            // avoid cells that have a class attribute
+            // or backgroundColor style
+	        if (! hasClass(mytd) &amp;&amp; ! mytd.style.backgroundColor) {
+        
+		      mytd.style.backgroundColor = even ? evenColor : oddColor;
+              
+            }
+          }
+        }
+        // flip from odd to even, or vice-versa
+        even =  ! even;
+      }
+    }
+  }
+  
+  
+
+
+// --&gt;
+
+
+

Added: trunk/leesvoer.php
===================================================================
--- trunk/leesvoer.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/leesvoer.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,135 @@
+&lt;?php require 'template_header.php'; ?&gt;
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Leesvoer&lt;/h1&gt;
+				
+				&lt;p class=&quot;space&quot;&gt;
+				Simuze vindt het belangrijk dat men op de hoogte is van de werkwijze en ontwikkelingen in de muziekindustrie, en dat men hier een eigen mening over kan vormen. Simuze wil niemand een mening opleggen, hoewel haar eigen standpunt over de gang van zaken binnen de huidige muziekindustrie duidelijk moge zijn. Hieronder hebben we een aantal belangrijke artikelen en links gesorteerd. We doen ons best deze informatie objectief en compleet aan te bieden. Mocht je echter feitelijke onwaarheden tegenkomen, neem dan a.u.b. &lt;a href=&quot;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at simuze.nl</A>&quot;&gt;contact&lt;/a&gt; met ons op. 
+				&lt;/p&gt;
+				
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;!--  AUTEURSRECHT --&gt;
+				
+				&lt;h2&gt;Auteursrecht:&lt;/h2&gt;
+		
+					&lt;div class=&quot;kopjelinks_roundcont_donker_links&quot;&gt;
+						&lt;div class=&quot;artikelen_kopje&quot;&gt;&lt;/div&gt;
+						&lt;p class=&quot;small&quot;&gt;
+						&lt;ul&gt;
+						
+						&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.fourmilab.ch/documents/digital-imprimatur/">http://www.fourmilab.ch/documents/digital-imprimatur/</A>&quot;&gt;How big brother and big media can put the Internet genie back in the bottle -
+						John Walker&lt;/a&gt;&lt;/li&gt;
+						&lt;li&gt;&lt;a href=&quot;<A HREF="http://junk.haughey.com/doctorow-drm-ms.html">http://junk.haughey.com/doctorow-drm-ms.html</A>&quot;&gt;Microsoft Research DRM talk - Cory Doctorow &lt;/a&gt;&lt;/li&gt;
+						&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.firstmonday.org/issues/issue7_6/stalder/index.html">http://www.firstmonday.org/issues/issue7_6/stalder/index.html</A>&quot;&gt;Open Source Intelligence - Stalder, F. and Hirsh, J.&lt;/a&gt;&lt;/li&gt;
+						&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.legalaffairs.org/issues/July-August-2003/feature_zittrain_julaug03.html">http://www.legalaffairs.org/issues/July-August-2003/feature_zittrain_julaug03.html</A>&quot;&gt;The copyright cage - Jonathan Zittrain&lt;/a&gt;&lt;/li&gt;
+						&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.gnu.org/philosophy/right-to-read.html">http://www.gnu.org/philosophy/right-to-read.html</A>&quot;&gt;The Right to Read - Richard Stallman&lt;/a&gt;&lt;/li&gt;
+						
+						&lt;/ul&gt;
+						&lt;/p&gt;
+						
+						&lt;div class=&quot;kopjerechts_onder_donker&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+				
+					&lt;div class=&quot;kopjerechts_roundcont_donker&quot;&gt;
+						&lt;div class=&quot;links_kopje&quot;&gt;&lt;/div&gt;
+						&lt;p class=&quot;small&quot;&gt;
+						&lt;ul&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://free-culture.org">http://free-culture.org</A>&quot; title=&quot;externe link: ga naar <A HREF="http://free-culture.org">http://free-culture.org</A>&quot;&gt;Free culture -boek Lawrence Lessig-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.lessig.org/">http://www.lessig.org/</A>&quot;&gt;Lawrence Lessig -blog oprichter Creative Commons-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.freeculture.org/">http://www.freeculture.org/</A>&quot;&gt;Free culture -studenten organisatie naar aanleiding van boek Lawrence Lessig-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.nyu.edu/classes/siva/">http://www.nyu.edu/classes/siva/</A>&quot;&gt; Siva Vaidhyanathan -blog auteur van o.a. 'Copyrights and Copywrongs'-&lt;/a&gt;&lt;/li&gt; 
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://en.wikipedia.org/wiki/Copyleft">http://en.wikipedia.org/wiki/Copyleft</A>&quot;&gt;Copyleft Wikipedia (engels) -definitie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://nl.wikipedia.org/wiki/Copyleft">http://nl.wikipedia.org/wiki/Copyleft</A>&quot;&gt;Copyleft Wikipedia (nederlands) -definitie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://nl.wikipedia.org/wiki/Auteursrechten">http://nl.wikipedia.org/wiki/Auteursrechten</A>&quot;&gt;Auteursrechten Wikipedia (nederlands) -definitie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://en.wikipedia.org/wiki/Copyright">http://en.wikipedia.org/wiki/Copyright</A>&quot;&gt;Copyright Wikipedia (engels) -definitie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://nl.wikipedia.org/wiki/Open_content">http://nl.wikipedia.org/wiki/Open_content</A>&quot;&gt;Open Content Wikipedia (nederlands) -definitie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://en.wikipedia.org/wiki/Open_content">http://en.wikipedia.org/wiki/Open_content</A>&quot;&gt;Open Content Wikipedia (engels) -definitie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://nl.wikipedia.org/wiki/Digital_Rights_Management">http://nl.wikipedia.org/wiki/Digital_Rights_Management</A>&quot;&gt;Digital Rights Management Wikipedia (nederlands) -definitie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://en.wikipedia.org/wiki/Digital_Rights_Management">http://en.wikipedia.org/wiki/Digital_Rights_Management</A>&quot;&gt;Digital Rights Management Wikipedia (engels) -definitie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.ivir.nl/wetten/intellectuele-eigendom/nederland.html">http://www.ivir.nl/wetten/intellectuele-eigendom/nederland.html</A>&quot;&gt;Instituut voor Informatierecht -intellectueel eigendom links-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.recht.nl/alberdingkthijm/">http://www.recht.nl/alberdingkthijm/</A>&quot;&gt;Christiaan Alberdingk Thijm -publicaties van advocaat bekend van o.a. verdediging Kazaa-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://weten.overheid.nl/">http://weten.overheid.nl/</A>&quot;&gt;Nederlandse wetgeving -vul Auteurswet 1912 in bij zoek voor auteursrecht-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.wto.org/english/tratop_e/trips_e/trips_e.htm">http://www.wto.org/english/tratop_e/trips_e/trips_e.htm</A>&quot;&gt;World Trade Organisation -Trade Related aspects of Intellectual Property-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.auteursrecht.nl">http://www.auteursrecht.nl</A>&quot;&gt;Auteursrecht.nl -site ondersteunt door o.a Buma/Stemra-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://http://www.eff.org/">http://http://www.eff.org/</A>&quot;&gt;Electronic Freedom Frontier USA -digitale burgerechten organisatie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.altlawforum.org/">http://www.altlawforum.org/</A>&quot;&gt;Alternative Law Forum Bangalore -alternatieve advocaten organisatie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://pzwart.wdka.hro.nl/mdr/research/lliang/open_content_guide">http://pzwart.wdka.hro.nl/mdr/research/lliang/open_content_guide</A>&quot;&gt;Open Content Licentie handboekje -door advocaat Lawrence Liang van Alternative Law Forum-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.creativecommons.org">http://www.creativecommons.org</A>&quot;&gt;Creative Commons USA -flexibel auteursrecht-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.creativecommons.nl">http://www.creativecommons.nl</A>&quot;&gt;Creative Commons NL -Nederlandse afdeling-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.http://www.bof.nl">http://www.http://www.bof.nl</A>&quot;&gt;Bits of Freedom -digitale burgerrechtenorganisatie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.anti-piracy.nl">http://www.anti-piracy.nl</A>&quot;&gt;Stichting Brein -bescherm rechten entertainment industrie Nederland&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.stichtingnorma.nl">http://www.stichtingnorma.nl</A>&quot;&gt;Stichting Norma -naburige rechten uitvoerende kunstenaars-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.cedar.nl/">http://www.cedar.nl/</A>&quot;&gt;CEDAR -centrum voor dienstverlening auteurs- en aanverwanten rechten o.a Thuiskopie en Leenrecht-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.nvpi.nl/">http://www.nvpi.nl/</A>&quot;&gt;NVPI -nederlandse vereniging voor producenten en importeurs van beeld- en geluidsdragers-&lt;/a&gt;&lt;/li&gt;
+							
+						&lt;/ul&gt;	
+						&lt;/p&gt;
+						
+						&lt;div class=&quot;kopjerechts_onder_donker&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+					
+					&lt;/p&gt;
+					
+			
+				
+				&lt;!--  MUZIEKINDUSTRIE --&gt;	
+				
+				&lt;p class=&quot;space&quot;&gt;
+				
+				&lt;h2&gt;Muziekindustrie:&lt;/h2&gt;
+		
+				&lt;div class=&quot;kopjelinks_roundcont_donker_links&quot;&gt;
+						&lt;div class=&quot;artikelen_kopje&quot;&gt;&lt;/div&gt;
+						&lt;p class=&quot;small&quot;&gt;
+						&lt;ul&gt;
+						&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.wired.com/wired/archive/1.03/1.3_stallman.copyright.html">http://www.wired.com/wired/archive/1.03/1.3_stallman.copyright.html</A>&quot;&gt;Copywrong - Richard Stallman&lt;/a&gt;&lt;/li&gt;
+						&lt;li&gt;&lt;a href=&quot;<A HREF="http://dir.salon.com/tech/feature/2000/06/14/love/index.html">http://dir.salon.com/tech/feature/2000/06/14/love/index.html</A>&quot;&gt;Courtney Love does the math - Courtney Love&lt;/a&gt;&lt;/li&gt;
+						&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.business2.com/b2/web/articles/0,17863,608619-1,00.html">http://www.business2.com/b2/web/articles/0,17863,608619-1,00.html</A>&quot;&gt;Giving it away(for fun and profit) - Andy Raskin&lt;/a&gt;&lt;/li&gt;
+						&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.firstmonday.org/issues/issue6_8/pfahl/index.html">http://www.firstmonday.org/issues/issue6_8/pfahl/index.html</A>&quot;&gt;Giving away music to make money: Independent Musicians on the Internet - Michael Pfahl&lt;/a&gt;&lt;/li&gt;
+						&lt;li&gt;&lt;a href=&quot;/live/media/docs/mtiman_thesis.pdf&quot;&gt;Open Content and the Music Industry - Marten Timan&lt;/a&gt;&lt;/li&gt;
+						&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.wired.com/news/digiwood/0,1412,63026,00.html">http://www.wired.com/news/digiwood/0,1412,63026,00.html</A>&quot;&gt;RIAA singing the same old song - Associated Press&lt;/a&gt;&lt;/li&gt;
+						
+						&lt;/ul&gt;
+						&lt;/p&gt;
+						
+						&lt;div class=&quot;kopjerechts_onder_donker&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+				
+					&lt;div class=&quot;kopjerechts_roundcont_donker&quot;&gt;
+						&lt;div class=&quot;links_kopje&quot;&gt;&lt;/div&gt;
+						&lt;p class=&quot;small&quot;&gt;
+						&lt;ul&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.downhillbattle.org">http://www.downhillbattle.org</A>&quot;&gt;Downhillbattle -muziek activisme-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.http://www.bumastemra.nl">http://www.http://www.bumastemra.nl</A>&quot;&gt;Buma/Stemra -uitvoeringsrechten/mechanische reproduktierechten organisatie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.sena.nl/">http://www.sena.nl/</A>&quot;&gt;SENA -stichting ter exploitatie van naburige rechten -&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.popinstituut.nl/">http://www.popinstituut.nl/</A>&quot;&gt;Nederlands Pop Instituut -ontwikkeling en kwaliteit NL popmuziek-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.conamus.nl/">http://www.conamus.nl/</A>&quot;&gt;Conamus -ondersteunt door BUMA. promoot en ondersteunt NL muziek-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.ntb.net/">http://www.ntb.net/</A>&quot;&gt;Nederlandse Toonkunstenaars Bond -muzikanten vakbond-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.ifpi.com/">http://www.ifpi.com/</A>&quot;&gt;International Federation of the Phonographic Industry -branche organisatie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.riaa.com/">http://www.riaa.com/</A>&quot;&gt;Recording Industry Association of America -amerikaanse branche organisatie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.clearchannel.com/">http://www.clearchannel.com/</A>&quot;&gt;Clear Channel -amerikaanse media bedrijf met vrij veel invloed op radio, televisie en concerten-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.mojo.nl/">http://www.mojo.nl/</A>&quot;&gt;Mojo -nederlands concert/evenement organisatie. onderdeel van Clear Channel-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://en.wikipedia.org/wiki/MTV">http://en.wikipedia.org/wiki/MTV</A>&quot;&gt;MTV Wikipedia (engels) -definitie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://nl.wikipedia.org/wiki/MTV">http://nl.wikipedia.org/wiki/MTV</A>&quot;&gt;MTV Wikipedia (nederlands) -definitie-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.mtv.com/">http://www.mtv.com/</A>&quot;&gt;MTV USA -videoclip/jongeren lifestyle zender. onderdeel van media conglomeraat Viacom-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.mtv.nl/">http://www.mtv.nl/</A>&quot;&gt;MTV NL - clipzender NL. onderdeel van mtv networks-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.tmf.nl/">http://www.tmf.nl/</A>&quot;&gt;TMF -the music factory. clipzender NL. onderdeel van mtv networks-&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;<A HREF="http://www.thebox.nl/">http://www.thebox.nl/</A>&quot;&gt;The Box NL - clipzender/jonge vrouwen doelgroepen zender NL. onderdeel van mtv networks-&lt;/a&gt;&lt;/li&gt;
+						&lt;/ul&gt;	
+						&lt;/p&gt;
+						
+						&lt;div class=&quot;kopjerechts_onder_donker&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+					&lt;/p&gt;
+				
+				&lt;/div&gt;
+				
+					
+					
+					
+				
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/logged_in_menu.php
===================================================================
--- trunk/logged_in_menu.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/logged_in_menu.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,29 @@
+&lt;div id=&quot;login&quot;&gt;
+&lt;?php 
+$user = $_SESSION['name']; 
+?&gt;
+
+	&nbsp; - &lt;?php echo &quot;$user&quot;;?&gt; ingelogd&lt;br /&gt;
+	&nbsp; - &lt;a href=&quot;/live/inc/sm-logout.php&quot;&gt;Uitloggen&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;
+	
+	&lt;a href=&quot;/live/users/hq.php&quot;&gt;&lt;img alt=&quot;home&quot; src=&quot;/live/img/icons/home.gif&quot; border=&quot;0&quot; /&gt;&lt;/a&gt;
+	&lt;br /&gt;&lt;br /&gt;
+	&lt;div id=&quot;persmenu&quot;&gt;
+		&lt;ul&gt;
+			&lt;li id=&quot;yellowline&quot;&gt;&lt;img src=&quot;/live/img/images/yellowline.gif&quot;&gt;&lt;/li&gt;
+			&lt;li&gt;&lt;a href=&quot;/live/users/profile.php&quot; title=&quot;je eigen profiel wijzigen&quot;&gt;Profiel wijzigen&lt;/a&gt;&lt;/li&gt;    
+			&lt;li&gt;&lt;a href=&quot;/live/users/upload.php&quot; title=&quot;je eigen muziek uploaden&quot;&gt;Muziek uploaden&lt;/a&gt;&lt;/li&gt;
+			&lt;li&gt;&lt;a href=&quot;/live/users/overview_music.php&quot; title=&quot;je eigen geuploade muziek gegevens wijzigen&quot;&gt;Muziek gegevens&lt;/a&gt;&lt;/li&gt;
+			&lt;li&gt;&lt;a href=&quot;/live/users/playlist.php&quot; title=&quot;je eigen playlists aanmaken en bewerken&quot;&gt;Playlists&lt;/a&gt;&lt;/li&gt;
+			&lt;li&gt;&lt;a href=&quot;/live/users/change_settings.php&quot; title=&quot;je instellingen wijzigen&quot;&gt;instellingen wijzigen&lt;/a&gt;&lt;/li&gt;
+			
+			&lt;?php 
+				if($_SESSION['level'] &gt;= 2) {
+					echo '&lt;li&gt;&lt;a href=&quot;/live/admin/moderate.php&quot; title=&quot;muziek beoordelen&quot;&gt;Moderatie&lt;/a&gt;&lt;/li&gt;';
+				}
+			?&gt;
+		&lt;/ul&gt;
+	&lt;/div&gt;
+
+    &lt;br /&gt;
+&lt;/div&gt;

Added: trunk/lost.php
===================================================================
--- trunk/lost.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/lost.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,38 @@
+&lt;?php require 'template_header.php'; ?&gt;	
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1 class=&quot;wide&quot;&gt;Wachtwoord vergeten?&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;
+					
+				Vul hieronder je gebruikersnaam en je email adres in. Je krijgt automatisch een nieuw wachtwoord toegestuurd. Deze kun je wijzigen in iets wat je makkelijk kan onthouden&lt;/p&gt;
+				&lt;form action=&quot;sm-lost.php&quot; method=&quot;post&quot; name=&quot;register&quot; id=&quot;register&quot;&gt;
+				&lt;div class=&quot;roundcont&quot;&gt;
+					&lt;div class=&quot;roundtop&quot;&gt;&lt;/div&gt;
+					
+						&lt;p class=&quot;space&quot;&gt;&lt;/p&gt;
+						&lt;fieldset&gt;
+							
+							&lt;label for=&quot;uname&quot;&gt;gebruikersnaam:&lt;/label&gt; 
+							&lt;input type=&quot;text&quot; id=&quot;uname&quot; name=&quot;uname&quot; maxlength=&quot;250&quot; size=&quot;16&quot; class=&quot;form_tekstveld&quot; /&gt; 
+							&lt;label for=&quot;email&quot;&gt;email:&lt;/label&gt; 
+							&lt;input type=&quot;text&quot; id=&quot;email&quot; name=&quot;email&quot; maxlength=&quot;250&quot; size=&quot;16&quot; class=&quot;form_tekstveld&quot; /&gt; 
+							
+							&lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;true&quot; /&gt;
+						
+						&lt;/fieldset&gt;
+						&lt;p class=&quot;space&quot;&gt;&lt;/p&gt;
+					&lt;div class=&quot;roundbottom&quot;&gt;&lt;/div&gt;
+				&lt;/div&gt;	
+				
+				&lt;p&gt;&lt;input type=&quot;image&quot; class=&quot;btn&quot; src=&quot;img/images/versturen_btn.gif&quot; alt=&quot;wachtwoord opvragen&quot; value=&quot;true&quot;  /&gt;&lt;/p&gt;
+				
+				&lt;/form&gt;
+				&lt;/p&gt;
+			
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/main_sidebar.php
===================================================================
--- trunk/main_sidebar.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/main_sidebar.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,22 @@
+&lt;?php 
+    if($_SESSION['logged_in']) {
+        require_once(&quot;logged_in_menu.php&quot;);
+    } else {
+        require_once(&quot;not_logged_in_menu.php&quot;);
+    
+//the HTML below will only be shown when not logged in :)    
+?&gt;
+    &lt;br /&gt;
+    &lt;br /&gt;
+    &lt;div id=&quot;nieuwsbrief&quot;&gt;
+    &lt;p class=&quot;small&quot;&gt;Vul je email adres in voor de Simuze nieuwsbrief:&lt;/p&gt;
+    &lt;form name=&quot;nieuwsbrief&quot; action=&quot;sm-nieuwsbrief.php&quot; method=&quot;post&quot;&gt;
+    &lt;input type=&quot;text&quot; id=&quot;nbrief&quot; name=&quot;email&quot; class=&quot;input_sidebar&quot; maxlength=&quot;250&quot; size=&quot;16&quot; value=&quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">mailmij at simuze.nl</A>&quot; /&gt;
+    &lt;input type=&quot;hidden&quot; name=&quot;send_true_url&quot; value=&quot;<A HREF="http://www.simuze.nl/live/nbrief_true.php">http://www.simuze.nl/live/nbrief_true.php</A>&quot; /&gt;
+    &lt;input type=&quot;hidden&quot; name=&quot;send_false_url&quot; value=&quot;<A HREF="http://www.simuze.nl/live/nbrief_false.php">http://www.simuze.nl/live/nbrief_false.php</A>&quot; /&gt;
+    &lt;p class=&quot;small_white&quot;&gt;&lt;input type=&quot;image&quot; src=&quot;img/images/verstuur_btn.gif&quot; name=&quot;nbrief_verstuur&quot; alt=&quot;ontvang de simuze nieuwsbrief&quot; value=&quot;true&quot;  /&gt;&lt;/p&gt;
+    &lt;/form&gt;
+
+    &lt;/div&gt;
+&lt;?php }?&gt;
+&lt;div id=&quot;onderlogin&quot;&gt;&lt;/div&gt;

Added: trunk/mainstyle.css
===================================================================
--- trunk/mainstyle.css	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/mainstyle.css	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,2045 @@
+/*&lt;![CDATA[*/
+
+html,body 
+{ 
+	background: #81A3AB url(&quot;img/images/bg_pattern.gif&quot;);
+	margin: 0;
+	padding: 0;
+	height:100%;
+    font-family : 'Verdana','Trebuchet MS','Arial';
+    font-size : 11px;
+    text-decoration: none;
+    text-align: left;
+    color : #000000;
+}
+
+#introlist
+{
+	font-family : 'Trebuchet MS','Verdana','Times New Roman','Arial';
+	font-size : 12px;
+	font-weight : bold;
+	color	: #000;
+	margin: 0px 0px 0px 10px;	
+}
+
+#intro {
+	font-family : 'Trebuchet MS','Verdana','Times New Roman','Arial';
+	font-size : 12px;
+	font-weight : bold;
+	color	: #000;
+
+}
+
+
+p.space,pre 
+{
+	
+	margin:10px 10px 10px 10px;
+	padding:0px;
+	width: 550px;
+	text-align: justify;
+}
+
+p.spaceblue
+{
+	margin:10px 10px 10px 10px;
+	padding:0px;
+	width: 550px;
+	color: #6F8D95;
+	text-align: justify;
+}
+
+p.red
+{
+	margin: 5px 0px 0px 10px;
+	padding: 0px;
+	color: #990101;
+	text-align: left;
+}
+
+p.sponsors
+{
+	margin: 0px 0px 0px 50px;
+	padding: 0px;
+	color: #990101;
+	text-align: left;
+	height: 100px;
+}
+
+p.wide, h1.wide 
+{
+	width: 550px;
+	padding: 0px 0px 0px 10px;
+}
+
+p.small
+{
+	padding:0px;
+	margin: 10px 10px 5px 10px;
+}
+
+p.small_white
+{
+	padding:0px;
+	margin: 10px 10px 5px 10px;
+	color: #F7F3E7;
+}
+
+
+p.small_white2
+{
+	padding:0px;
+	margin: 0px 10px 5px 10px;
+	color: #F7F3E7;
+}
+
+p.sidebar
+{
+	padding:0px;
+	margin: 10px 10px 0px 10px;
+}
+
+p.form
+{
+	margin: 0px 0px 10px 0px;
+	padding: 0px;
+	width: 500px;
+}
+
+p.uitleg
+{
+	margin: 0px 0px 0px 10px;
+	padding: 0px;
+	font-family : 'Trebuchet MS','Verdana','Sans-serif';
+    font-size : 12px;
+    text-decoration: none;
+    text-align: left;
+    color : #fff;
+}
+
+h1 
+{
+	font-family : 'Trebuchet MS','Verdana','Times New Roman','Arial';
+	font-size : 18px;
+	font-weight : bold;
+	color : #000;
+	margin: 10px 10px 10px 10px;
+}
+
+
+h1.small 
+{
+	margin:0px 10px 10px 10px;
+	padding: 0px;
+	width: 375px;
+	font-family : 'Trebuchet MS','Verdana','Times New Roman','Arial';
+	font-size : 14px;
+	font-weight : bold;
+	color	: #000;
+}
+
+h1.small_red 
+{
+	margin:0px 10px 0px 10px;
+	padding: 0px;
+	font-family : 'Trebuchet MS','Verdana','Times New Roman','Arial';
+	font-size : 18px;
+	color: #990101;
+	font-weight : bold;
+	text-align: left;
+}
+
+h1.bar1white 
+{
+	margin: 0px 10px 0px 30px;
+	padding: 0px;
+	font-family : 'Trebuchet MS','Verdana','Times New Roman','Arial';
+	font-size : 18px;
+	font-weight : bold;
+	color	: #F7F3E7;
+}
+
+h2
+{
+	clear: both;
+	font-family : 'Trebuchet MS','Verdana','Times New Roman','Arial';
+	font-size : 16px;
+	font-weight : bold;
+	color	: #990101;
+	margin: 0px 0px 0px 10px;
+}
+	
+h2.bar1white
+{
+	font-family : 'Trebuchet MS','Verdana','Times New Roman','Arial';
+	font-size : 16px;
+	font-weight : bold;
+	margin: 45px 10px 0px 50px;
+	padding: 0px;
+	color: #F7F3E7;
+}
+
+h2.white
+{
+	font-family : 'Trebuchet MS','Verdana','Times New Roman','Arial';
+	font-size : 16px;
+	font-weight : bold;
+	margin: 10px 10px 0px 10px;
+	padding: 0px;
+	color: #FFF;
+}
+
+h2.yellow
+{
+	font-family : 'Trebuchet MS','Verdana','Times New Roman','Arial';
+	font-size : 16px;
+	font-weight : bold;
+	margin: 10px 10px 0px 10px;
+	padding: 0px;
+	color: #FF9C00;
+}
+
+
+.red
+{
+	color: #990101;
+}
+
+.nospace
+{
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+
+
+/* styles for IE 5 Mac article: <A HREF="http://www.hicksdesign.co.uk/journal/30/vertical-centering-with-css">http://www.hicksdesign.co.uk/journal/30/vertical-centering-with-css</A> */
+#horizon
+{
+	background-color: transparent;
+	position: absolute;
+	top: 0px;
+	left: 20px;
+}
+ 
+ /* following rules are invisible to IE 5 \*/
+#horizon
+{
+	top: 0px;
+	left: 0px;
+	width: 100%;
+	margin-top: 0px;
+	text-align: center;
+	min-width: 780px; 
+}
+ /* end IE 5 hack */ 
+	 
+ 
+#wrapper 
+{
+	background: #990101 url(&quot;img/images/bg_mid2_shadow.gif&quot;) repeat-y right;
+	margin: 0px auto;
+	padding: 0px;
+	width: 780px;
+}
+
+#header
+{
+	background-color: #F7F3E7;
+	width: 780px;
+	height:142px;
+	padding:0px;
+	margin:0px;
+}
+
+#hoofdbar
+{
+	background: #F7F3E7 url(&quot;img/images/header.gif&quot;);
+	width: 780px;
+	height: 69px;
+	padding: 0px;
+	margin: 0px;
+	text-align: right;
+}	
+
+
+/* zoekveld begint hier */
+#searchveld 
+{
+background:#F7F3E7 url(&quot;img/images/bg_zoek.gif&quot;);
+background-repeat: no-repeat;
+background-position: top right;
+margin: 0px;
+padding: 0px;
+width:365px;
+height: 18px;
+border:0px;
+float: left;
+}
+
+
+/* zoekveld einde */  
+
+
+/* hoofdmenu begint hier */
+
+#hoofdmenu 
+{
+	float:left;
+	background: #F7F3E7;
+	background-repeat: no-repeat;
+	background-position: top right;
+	margin: 0px;
+	padding: 0px;
+	width:415px;
+	height: 18px;
+	display: block; 
+	line-height: 18px;
+}
+  
+#hoofdmenu ul 
+{
+  margin:0px;
+  padding:0px;
+  list-style:none;
+}
+  
+#hoofdmenu li 
+{
+  display:inline;
+  margin:0px;
+  padding:0px;
+}
+  
+#hoofdmenu a 
+{
+  float:left;
+  background:url(&quot;img/movers/CSSleft.gif&quot;) no-repeat left top;
+  margin:0;
+  padding:0 0 0 6px;
+  border: 0px;
+  font-family: 'Trebuchet MS','Verdana','Times New Roman';
+  font-size:13px;
+  text-decoration: none;
+}
+  
+#hoofdmenu a span 
+{
+  float:left;
+  display:block;
+  background:url(&quot;img/movers/CSSright.gif&quot;) no-repeat right top;
+  padding:0px 6px 0px 0px;
+  padding-bottom:0px;
+  margin:0px;
+  font-weight: bold;
+  color:#990101;
+}
+  
+/* Commented Backslash Hack hides rule from IE5-Mac \*/
+#hoofdmenu a span 
+{
+	float:none;
+	padding-bottom:0px;
+}
+/* End IE5-Mac hack */
+
+#hoofdmenu a:hover span 
+{
+  color:#FFAD00;
+}
+  
+#hoofdmenu #current a 
+{  
+  background-position:0% -300px;
+  border: 0px solid #81A3AB;
+}
+  
+#hoofdmenu #current a span
+{
+  background-position:50% -300px ;
+  padding-bottom:0px;
+  color:#fff;
+}
+
+#hoofdmenu #current2 a 
+{  
+  background-position:0% -300px;
+  border: 0px solid #81A3AB;
+}
+  
+#hoofdmenu #current2 a span
+{
+  background-position:50% -300px ;
+  padding-bottom:0px;
+  color:#F7F3E7;
+}
+
+  
+#hoofdmenu a:hover 
+{
+  background-position:0% -150px;
+   border: 0px solid #fff;
+}
+  
+#hoofdmenu a:hover span 
+{
+  background-position:100% -150px;
+}
+	
+/* hoofdmenu eindigt hier */
+ 
+
+
+#submenu 
+{
+	float:left;
+	background: #81A3AB url(&quot;img/images/bg_pattern.gif&quot;);
+	background-repeat: repeat;
+	background-position: top right;
+	margin: 0px;
+	padding: 0px;
+	width:780px;
+	height: 18px;
+	display: block; 
+	line-height: 18px;
+}
+  
+  
+#submenu ul 
+{
+  margin:0px;
+  padding:0px;
+  list-style:none;
+}
+  
+#submenu li 
+{
+  display:inline;
+  margin:0px;
+  padding:0px;
+}
+  
+#submenu a 
+{
+  float:left;
+  background:url(&quot;img/movers/subCSSleft.gif&quot;) no-repeat left top;
+  margin:0;
+  padding:0 0 0 6px;
+  border: 0px;
+  font-family: 'Trebuchet MS','Verdana','Times New Roman';
+  font-size:11px;
+  text-decoration: none;
+  color:#F7F3E7;
+}
+  
+#submenu a  
+{
+  float:left;
+  display:block;
+  background:url(&quot;img/movers/subCSSright.gif&quot;) no-repeat right top;
+  padding:0px 6px 0px 6px;
+  padding-bottom:0px;
+  margin:0px;
+  font-weight: normal;
+  color:#F7F3E7;
+}
+  
+/* Commented Backslash Hack hides rule from IE5-Mac \*/
+#submenu a span 
+{
+	float:none;
+	padding-bottom:0px;
+}
+/* End IE5-Mac hack */
+
+#submenu a:hover span 
+{
+  color:#fff;
+}
+  
+#submenu #current a 
+{  
+
+  background-position:0% 0px;
+  border: 0px solid #81A3AB;
+  font-weight: bold;
+}
+  
+#submenu #current a span
+{
+  background-position:0% 0px ;
+  padding-bottom:0px;
+  color:#fff;
+}
+  
+#submenu a:hover 
+{
+  background-position:0% -150px;
+   border: 0px solid #fff;
+}
+  
+#submenu a:hover span 
+{
+  background-position:100% -150px;
+}
+	
+
+/* submenu eindigt hier */
+
+
+
+/* ondersubmenu (plaatje) begint hier */
+ #ondersubmenu 
+{     
+	float: left;
+	background: url(&quot;img/images/boven_blauwwit.gif&quot;);
+	background-color: #81A3AB;
+	background-repeat: no-repeat;
+	background-position: top left;
+	margin: 0px;
+	padding: 0px;
+	width:780px;
+	height: 37px;
+	display: block; 
+	font-family: 'Trebuchet MS','Verdana','Times New Roman';
+	font-size:65%;
+	line-height:normal;
+}
+/* ondersubmenu (plaatje) eindigt hier */
+
+/* ondersubmenu (plaatje) begint hier */
+ #ondersubmenu2 
+{
+	background: #81A3AB url(&quot;img/images/boven_blauwwitrood.gif&quot;);
+	background-color: #81A3AB;
+	background-repeat: no-repeat;
+	background-position: top left;
+	margin: 0px;
+	padding: 0px;
+	width:640px;
+	height: 37px;
+	display: block; 
+	font-family: 'Trebuchet MS','Verdana','Times New Roman';
+	font-size:65%;
+	line-height:normal;
+}
+
+#ondersubmenu_links {
+	float: left;
+	width: 275px;
+	background: transparent;
+	margin: 2px 0px 0px 0px;
+	padding: 10px 0px 0px 0px;
+	height: 25px;
+	text-align: left;
+}
+
+#ondersubmenu_rechts {
+	float: right;
+	width: 320px;
+	background: transparent;
+	margin: 2px 0px 0px 0px;
+	padding: 10px 140px 0px 0px;
+	height: 25px;
+	text-align: left;
+}
+
+/* ondersubmenu (plaatje) eindigt hier */
+
+
+#container 
+{
+	width: 100%;
+	background: transparent;
+	float: left;
+	margin-right: -200px;
+}
+
+#content 
+{
+	background: transparent;
+	padding: 0px 0px 0px 0px;
+	margin:  0px 0px 0px 7px;
+	margin-right: 200px;
+	width: 633px;
+	text-align: left;
+}
+
+#kolom1
+{
+	clear: both;
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_simuze.gif&quot;) no-repeat;
+}
+
+#kolom1 ul, #kolom1_artiesten ul, #uitleg ul, #kolom1_home ul, .kolom2_genres ul, #kolom1_muziekgegevens ul, #kolom1_playlists ul, #kolom2 ul
+{
+	list-style-image : url(&quot;img/images/pijltje_rood.gif&quot;);
+	margin: 0px 0px 0px 25px;
+	padding: 10px 0px 10px 0px;
+}
+
+#kolom1_home
+{
+	clear: both;
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_home.gif&quot;) no-repeat;
+}
+
+
+#kolom1_artiesten
+{
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_musica.gif&quot;) no-repeat;
+}
+
+#kolom1_wie
+{
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_wie.gif&quot;) no-repeat;
+}
+
+#kolom1_wie ul
+{
+	list-style: none;
+	margin: 0px 0px 0px 10px;
+	padding: 0px 0px 0px 0px;
+}
+
+#kolom1_wie li
+{
+	display: inline;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+
+#kolom1_playlists
+{
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_playlists.gif&quot;) no-repeat;
+}
+
+#kolom1_muziekoverzicht
+{
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_muziekoverzicht.gif&quot;) no-repeat;
+}
+
+#kolom1_muziekgegevens
+{
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_muziekgegevens.gif&quot;) no-repeat;
+}
+
+#kolom1_muziekuploaden
+{
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_muziekuploaden.gif&quot;) no-repeat;
+}
+
+#kolom1_profiel
+{
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_profiel.gif&quot;) no-repeat;
+}
+
+#kolom1_moderatie
+{
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_moderatie.gif&quot;) no-repeat;
+}
+
+#kolom2
+{
+	/*height:220px;*/
+	width: 599px;
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #69878E; /*url(&quot;img/images/zij_artiesten.gif&quot;) no-repeat;*/
+}
+
+#kolom2_artiesten
+{
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3DF url(&quot;img/images/zij_uitgelicht.gif&quot;) no-repeat;
+}
+
+#kolom2_muziek
+{
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 13px 10px 20px;
+	background: #FFA300 url(&quot;img/images/zij_muziek.gif&quot;) no-repeat;
+	min-height: 100px;
+}
+
+.kolom2_genres
+{
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_nieuw.gif&quot;) no-repeat;
+	min-height: 150px;
+}
+
+#kolom3
+{
+	float: left;
+	/*width:601px; kolommen geen width meegeven want dan snapt explorer 5.5 het niet meer*/
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_musica.gif&quot;) no-repeat;
+}
+
+#kolom3_hq
+{
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_meer.gif&quot;) no-repeat;
+}
+
+#kolom3_artiesten
+{
+	float: left;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 12px 10px 20px;
+	background: #F7F3E7 url(&quot;img/images/zij_concertagenda.gif&quot;) no-repeat;
+}
+
+/* div voor de nieuwkopjes. padding: 10px (boven) 0 0 0px (links)  */
+#nieuwskopjes
+{
+	float: left;
+	width:280px;
+	/*height:150px;*/
+	border: 0px;
+	padding: 0px 0px 0px 0px;	
+	background: transparent;
+}
+
+#nieuwsitems_sidebar
+{
+
+	width:120px;
+	border: 0px;
+	padding: 75px 0px 120px 10px;
+	margin: 10px 0px 0px 10px;
+	background: #990101;
+	color: #fff;
+	text-align: left;
+}
+
+#nieuwsitems_sidebar ul
+{
+	padding: 0px;
+	margin: 0px;
+	list-style-image : url(&quot;img/images/pijltje_wit.gif&quot;);
+}
+
+#nieuwsitems_sidebar li.item
+{
+	display: list-item;
+	padding: 0px 0px 0px 0px;
+	margin: 5px 0px 0px 0px;
+	color: #fff;
+	background: transparent;
+}
+
+
+#upload_muzikanten
+{
+	float: left;
+	width:280px;
+	height:85px;
+	border: 0px;
+	padding: 0px 0px 0px 0px;	
+	background: #F7F3E7 url(&quot;img/images/upload_muzikanten.gif&quot;) no-repeat;
+}
+
+#download_liefhebbers
+{
+	float: left;
+	width:280px;
+	height:110px;
+	border: 0px;
+	padding: 0px 0px 0px 0px;	
+	background: #F7F3E7 url(&quot;img/images/download_liefhebbers.gif&quot;) no-repeat;
+}
+
+.div_links
+{
+	float:left;
+	width:300px;
+	background: transparent;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+.div_rechts
+{
+	float: right;
+	width:250px;
+	background: transparent;
+	border: 0px;
+	margin: 0px 0px 0px 20px;
+	padding: 0px 0px 0px 0px;
+}
+
+.bar_links_groot
+{
+	float:left;
+	width:275px;
+	height:75px;
+	background: transparent;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+.bar_rechts_groot
+{
+	float:right;
+	width:315px;
+	height:75px;
+	background: transparent;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+/* div voor de uitleg. padding: 10px (boven) 0 0 25px (links)  */
+#uitleg
+{
+	position: absolute;
+	top:122px;
+	width:295px;
+	border: 0px;
+	margin: 0px 0px 0px 325px;
+	padding: 0px 0px 0px 0px;
+	background-color: transparent;	
+}
+
+
+#div_blue_musica
+{
+	float: left;
+	padding: 0px 12px 10px 20px;
+	margin: 0px 0px 0px 0px;
+	width: 599px;
+	background: #80A3AC url(&quot;img/images/zij_overzicht.gif&quot;) no-repeat;
+}
+
+#div_blue_musica ul
+{
+	list-style: none;
+	margin: 0px 0px 0px 27px;
+	padding: 0px;
+}
+
+#bar1
+{
+	clear: both;
+	float: left;
+	width:633px;
+	height:77px;
+	background:  #F7F3E7 url(&quot;img/images/bar1.gif&quot;) no-repeat;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+#bar1_onder
+{
+	clear: both;
+	float: left;
+	width:633px;
+	height:77px;
+	background:  #F7F3E7 url(&quot;img/images/bar1_onder.gif&quot;) no-repeat;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+#bar1_musica
+{
+	clear: both;
+	float: left;
+	width:633px;
+	height:77px;
+	background:  #F7F3E7 url(&quot;img/images/bigbalk_musica.gif&quot;) no-repeat;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+#bar2_musica
+{
+	clear: both;
+	float: left;
+	width:633px;
+	height:77px;
+	background:  #F7F3E7 url(&quot;img/images/bigbalk2_musica.gif&quot;) no-repeat;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+#bar1klein
+{
+	clear: both;
+	float: left;
+	width:633px;
+	height:77px;
+	background: #F7F3E7 url(&quot;img/images/bar1_showprofile.gif&quot;) no-repeat;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;	
+}
+
+.bar1_genres
+{
+	clear: both;
+	float: left;
+	width:633px;
+	height:77px;
+	background:  #F7F3E7 url(&quot;img/images/bar1_genres.gif&quot;) no-repeat;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+#bar2
+{
+	clear: both;
+	width:633px;
+	height:35px;
+	background: #F7F3E7 url(&quot;img/images/donkergeel_2.gif&quot;) no-repeat;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+#bar2_geel
+{
+	clear: both;
+	width:633px;
+	height:35px;
+	background: #F7F3E7 url(&quot;img/images/donkergeel_3.gif&quot;) no-repeat;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+
+#bar2_links
+{
+	float:left;
+	width:225px;
+	height:30px;
+	background: transparent;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 20px;
+}
+
+#bar2_rechts
+{
+	float:right;
+	width:315px;
+	height:30px;
+	background: transparent;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+
+/* -------------------------------------- begin showprofile divs -----------------------------------------*/
+
+.profile_container
+{
+	float: left;
+	width: 600px;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	margin-left: 0px;
+	margin-bottom: 0px;
+	padding: 0px 0px 0px 0px;	
+	background: transparent;
+}
+
+
+/* div voor de info over de persoon zelf  */
+#member_info
+{
+	float: left;
+	width:325px;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	margin-left: 0px;
+	margin-bottom: 0px;
+	padding: 0px 0px 0px 10px;	
+	background: transparent;
+}
+
+
+/* div voor de uitleg. padding: 10px (boven) 0 0 25px (links)  */
+#member_foto
+{
+	float: right;
+	width: 240px;
+	height: 180px;
+	padding: 0px 0px 0px 0px;
+	margin: 0px 0px 10px 10px;
+	border: 1px solid #990F07;
+}
+
+
+/* -------------- begin blauwe 240px velden voor o.a. SNEL ZOEKEN----------- */
+.blauw_240
+{
+	float: right;
+	width: 240px;
+	background: url(img/images/bg_blauw_240_mid.gif) repeat-y;
+	margin: 10px 0px 0px 0px;
+}
+
+.blauw_240 p 
+{
+	margin: 10px;
+}
+
+#snelzoeken_kopje 
+{ 
+	background: url(img/images/bg_snelzoeken.gif) no-repeat top right; 
+	height: 23px;
+}
+
+.blauw_240_onder 
+{
+	background: url(img/images/bg_blauw_240_onder.gif) no-repeat bottom right; 
+	height: 4px;
+}
+/* -------------- einde blauwe 240px velden----------- */
+
+/* -------------- gele info 325px velden----------- */
+.info_325
+{
+	width: 325px;
+	background: url(img/images/bg_blue_325_mid.gif) repeat-y;
+	margin: 0px 0px 0px 0px;
+}
+
+.info_325 p 
+{
+	margin: 10px;
+}
+
+
+.info_325top
+{ 
+	background: url(img/images/bg_blue_325_top.gif) no-repeat top; 
+	height: 4px;
+}
+
+.info_325bottom 
+{
+	background: url(img/images/bg_blue_325_onder.gif) no-repeat bottom; 
+	height: 4px;
+}
+/* -------------- einde gele info 325px velden----------- */
+
+
+.favorieten
+{
+	clear: both;
+	width: 200px;
+	border: 0px;
+	margin: 0px 0px 0px 0px;
+	padding: 10px 0px 0px 5px;	
+	background: #fff;
+}
+
+
+/* -------------------------------------- einde showprofile divs -----------------------------------------*/
+
+
+#login 
+{
+
+	width: 138px;
+	padding: 0px 0px 0px 0px;
+	margin: 0px 0px 0px 0px;
+	border: 0px;	
+}
+
+#not_logged_in
+{
+	float: left;
+	width: 138px;
+	background: #F5D081;
+	padding: 0px 0px 0px 0px;
+	margin: 0px 0px 0px 0px;
+}
+
+#login ul, li.loginmenu
+{
+	height: 23px;
+	width:138px;
+}
+
+
+#sidebar 
+{
+background: url(&quot;img/images/bg_login.gif&quot;) repeat-y; 	
+float: right;
+width:140px;
+background-position: top right;
+margin: 0px;
+padding: 0px;
+font-family: 'Trebuchet MS','Verdana','Times New Roman';
+text-align: left;
+font-size:8pt;
+line-height: 18px;
+}
+
+
+
+#sidebar h2
+{
+	margin: 0px;
+	padding: 0px;
+}
+
+
+
+/* End Entry Lists */
+
+/* links voor persoonlijke menu*/  
+
+#persmenu 
+{
+	background: #F8E4B3;
+	width: 138px;
+	padding: 0px 0px 0px 0px;
+	margin: 0px 0px 0px 0px;
+	border: 0px;	
+}
+
+#yellowline
+{
+	width:138px;
+	height: 1px;
+	background: transparent;
+	padding:0px 0px 0px 0px;
+	margin: 1px 0px 0px 0px;	
+}
+
+#persmenu a
+{
+float:left;	
+width: 5px;
+height: 20px;
+background:url(&quot;img/movers/menurechts.gif&quot;) no-repeat left top;
+margin: 0px 0px 0px 0px;
+padding: 0px 0px 0px 5px;
+border: 0px;
+color: #990101;
+text-decoration: none;
+}
+
+#persmenu a 
+{
+float:left;	
+width: 133px;
+height: 20px;
+background:url(&quot;img/movers/menurechts.gif&quot;) no-repeat left top;
+color: #990101;
+margin: 0px 0px 0px 0px;
+padding: 0px 0px 0px 5px;
+}
+
+
+/* Commented Backslash Hack hides rule from IE5-Mac \*/
+#persmenu a span {float:none;}
+/* End IE5-Mac hack */
+
+#persmenu a:hover  
+{
+color: #000;
+}
+
+#persmenu a:hover 
+{
+background-position:100% -20px;
+}
+
+#persmenu ul 
+{
+margin:0px;
+padding:0px;
+list-style:none;
+}
+
+#persmenu li 
+{
+display:inline;
+margin:0px;
+padding:0px;
+}
+
+#onderlogin
+{
+	float:left;	
+	width: 140px;
+	height:150px;
+	padding: 0px 0px 0px 0px;
+	margin: 0px 0px 0px 0px;
+	border: 0px;
+	background:#FAE4B3 url(&quot;img/movers/menurechts_onder.gif&quot;) no-repeat bottom;
+}
+
+#nieuwsbrief
+{
+	float:left;	
+	width: 140px;
+	padding: 0px 0px 0px 0px;
+	margin: 0px 0px 0px 0px;
+	border: 0px;
+	background: transparent;
+}
+
+
+#sponsors
+{
+	float: left;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+	background: #990101;
+	width:140px;
+	clear: both;
+}
+
+#footer 
+{
+	background: #81A3AB url(&quot;img/images/onder_blauwwit_shadow.gif&quot;) no-repeat bottom left;
+	width: 780px;
+	height: 47px;
+	padding: 0px 0px 0px 0px;
+	margin: 0px 0px 0px 0px;
+	text-align: right;
+	color:  #F7F3E7;
+}
+
+
+
+#footer2 
+{
+	background: #81A3AB url(&quot;img/images/onder_blauwwitrood_shadow.gif&quot;) no-repeat bottom left;
+	width: 780px;
+	height: 47px;
+	padding: 0px 0px 0px 0px;
+	margin: 0px 0px 0px 0px;
+	text-align: right;
+	color:  #F7F3E7;
+}
+
+#warning
+{
+	background: #F8F3DF;
+	border: dashed 1px #990101;
+	color: #990101;
+	padding: 2px;
+}
+
+h1 
+{
+	margin-top: 0px;
+}
+
+.last 
+{
+	margin-bottom: 0px;
+}
+
+.clearing 
+{
+	height: 0px;
+	clear: both;
+}
+
+a:link 
+{
+	font-family : 'Verdana','Trebuchet MS','Arial';
+	font-size : 8Pt;
+	font-weight : normal;
+	text-decoration: none;
+	color:  #990101;
+}
+
+a:active 
+{
+	font-family : 'Verdana','Trebuchet MS','Arial';
+	font-size : 8Pt;
+	font-weight : normal;
+	text-decoration: none;
+	color: #869277;
+}
+
+a:hover 
+{
+	font-family : 'Verdana','Trebuchet MS','Arial';
+	font-size : 8Pt;
+	font-weight : normal;
+	text-decoration: none;
+	color: #CC7E2C;
+}
+
+a:visited 
+{
+	font-family : 'Verdana','Trebuchet MS','Arial';
+	font-size : 8Pt;
+	font-weight : normal;
+	text-decoration: none;
+	color:  #990101;
+}
+
+/*.............headerlinks..................*/
+
+a.help:link 
+{
+	font-family : 'Trebuchet MS','Verdana','Arial';
+	font-size : 11px;
+	font-weight : bold;
+	text-decoration: none;
+	color:  #fff;
+	margin-left: 5px;
+	margin-right: 10px;
+}
+
+a.help:visited 
+{
+	font-family : 'Trebuchet MS','Verdana','Arial';
+	font-size : 11px;
+	font-weight : bold;
+	text-decoration: none;
+	color: #fff;
+	margin-left: 5px;
+	margin-right: 10px;
+}
+
+a.help:hover 
+{
+	font-family : 'Trebuchet MS','Verdana','Arial';
+	font-size : 11px;
+	color: #F8E4B3;
+	font-weight : bold;
+	text-decoration: none;
+	margin-left: 5px;
+	margin-right: 10px;
+}
+
+a.help:active 
+{	
+	font-family : 'Trebuchet MS','Verdana','Arial';
+	font-size : 11px;
+	color: #F8E4B3;
+	font-weight : bold;
+	text-decoration: none;
+	margin-left: 5px;
+	margin-right: 10px;
+}
+/* ..............................................*/
+
+a.voet:link 
+{
+	font-family : 'Trebuchet MS','Verdana','Arial';
+	font-size : 11px;
+	font-weight : normal;
+	text-decoration: none;
+	color:  #F7F3E7;
+	margin-left: 10px;
+	margin-right: 3px;
+}
+
+a.voet:visited 
+{
+	font-family : 'Trebuchet MS','Verdana','Arial';
+	font-size : 11px;
+	font-weight : normal;
+	text-decoration: none;
+	color: #F7F3E7;
+	margin-right: 3px;
+	margin-left: 10px;
+}
+
+a.voet:hover 
+{
+	font-family : 'Trebuchet MS','Verdana','Arial';
+	font-size : 11px;
+	color: #F8E4B3;
+	font-weight : normal;
+	text-decoration: none;
+	margin-left: 10px;
+	margin-right: 3px;
+}
+
+a.voet:active 
+{	
+	font-family : 'Trebuchet MS','Verdana','Arial';
+	font-size : 11px;
+	color: #990101;
+	font-weight : normal;
+	text-decoration: none;
+	margin-left: 10px;
+	margin-right: 3px;
+}
+
+/*--------------------------------------------------------------------*/
+
+a.rood:link 
+{
+margin: 0px 0px 0px 0px;
+padding: 0px 0px 0px 0px;
+border: 0px;
+font-family : 'Trebuchet MS',Sans-Serif,'Arial';
+font-size : 8Pt;
+font-weight : normal;
+text-decoration: none;
+color:  #990101;
+}
+
+a.rood:active 
+{
+font-family : 'Trebuchet MS',Sans-Serif,'Arial';
+font-size : 8Pt;
+font-weight : normal;
+text-decoration: none;
+color: #000;
+}
+
+a.rood:hover 
+{
+font-family : 'Trebuchet MS',Sans-Serif,'Arial';
+font-size : 8Pt;
+font-weight : normal;
+text-decoration: none;
+color: #000;
+}
+
+a.rood:visited 
+{
+font-family : 'Trebuchet MS',Sans-Serif,'Arial';
+font-size : 8Pt;
+font-weight : normal;
+text-decoration: none;
+color:  #990101;
+}
+
+/* -----------------------------------------------------*/
+
+a.wit:link 
+{
+	font-family : 'Trebuchet MS','Verdana','Arial';
+	font-size : 11px;
+	font-weight : normal;
+	text-decoration: none;
+	color:  #F7F3E7;
+	margin: 0px 0px 0px 0px;
+}
+
+a.wit:visited 
+{
+	font-family : 'Trebuchet MS','Verdana','Arial';
+	font-size : 11px;
+	font-weight : normal;
+	text-decoration: none;
+	color: #F7F3E7;
+	margin: 0px 0px 0px 0px;
+}
+
+a.wit:hover 
+{
+	font-family : 'Trebuchet MS','Verdana','Arial';
+	font-size : 11px;
+	color: #F8E4B3;
+	font-weight : normal;
+	text-decoration: none;
+	margin: 0px 0px 0px 0px;
+}
+
+a.wit:active 
+{	
+	font-family : 'Trebuchet MS','Verdana','Arial';
+	font-size : 11px;
+	color: #990101;
+	font-weight : normal;
+	text-decoration: none;
+	margin: 0px 0px 0px 0px;
+}
+
+/*--------------------------------------------------------------------*/
+
+/* ===================== begin rode items ==========================*/
+
+.kopjelinks_roundcont_rood 
+{
+	float: left;
+	width: 295px;
+	margin: 0px 0px 0px 0px;
+	background: url(img/images/bg_rood_295_mid.gif) repeat-y;
+}
+
+.kopjerechts_roundcont_rood
+{
+	float: right;
+	width: 295px;
+	margin: 0px 0px 0px 0px;
+	background: url(img/images/bg_rood_295_mid.gif) repeat-y;
+}
+
+.onder_rood
+{
+	background: url(img/images/bg_rood_295_onder.gif) no-repeat bottom left; 
+	height: 4px;
+}
+
+#uitgelicht_kopje
+{ 
+	background: url(img/images/bg_uitgelicht.gif) no-repeat top left; 
+	height: 23px;
+}
+
+#musica_uitgelicht_kopje
+{ 
+	background: url(img/images/bg_uitgelicht_musica.gif) no-repeat top left; 
+	height: 23px;
+}
+ 
+#nieuwkomers_kopje
+{ 
+	background: url(img/images/bg_nieuwkomers.gif) no-repeat top left; 
+	height: 23px;
+}
+
+/* =====================einde rode items ==========================*/
+
+/* -------------- begin kopjes links----------- */
+.kopjelinks_roundcont 
+{
+	float: left;
+	width: 295px;
+	background: url(img/images/bg_uitgelicht_mid.gif) repeat-y;
+}
+
+.kopjelinks_roundcont_donker_links 
+{
+	float: left;
+	width: 295px;
+	margin: 0px 0px 0px 0px;
+	background: url(img/images/bg_donkergeel_295_mid.gif) repeat-y;
+}
+
+.kopjelinks_roundcont p 
+{
+	margin: 10px;
+}
+
+
+
+
+/* -------------- einde kopjes links ----------- */
+
+/* -------------- begin kopjes rechts ----------- */
+.kopjerechts_roundcont 
+{
+	float: right;
+	width: 295px;
+	margin: 0px 0px 0px 0px;
+	background: url(img/images/bg_uitgelicht_mid.gif) repeat-y;
+}
+
+.kopjerechts_roundcont_donker 
+{
+	float: right;
+	width: 295px;
+	margin: 0px 0px 0px 0px;
+	background: url(img/images/bg_donkergeel_295_mid.gif) repeat-y;
+}
+
+.kopjerechts_roundcont p 
+{
+	margin: 10px;
+}
+
+.artikelen_kopje
+{ 
+	background: url(img/images/bg_artikelen.gif) no-repeat top left; 
+	height: 23px;
+}
+
+.overzicht_kopje
+{ 
+	background: url(img/images/bg_overzicht.gif) no-repeat top left; 
+	height: 23px;
+}
+
+.links_kopje
+{ 
+	background: url(img/images/bg_links.gif) no-repeat top left; 
+	height: 23px;
+}
+
+#nieuweuploads_kopje
+{ 
+	background: url(img/images/bg_nieuweuploads.gif) no-repeat top left; 
+	height: 23px;
+}
+
+
+.kopjerechts_onder
+{
+	background: url(img/images/bg_uitgelicht_onder.gif) no-repeat bottom left; 
+	height: 4px;
+}
+
+.kopjerechts_onder_donker
+{
+	background: url(img/images/bg_donkergeel_295_onder.gif) no-repeat bottom left; 
+	height: 4px;
+}
+/* -------------- einde kopjes rechts----------- */
+
+
+/* -------------- gele inputvelden----------- */
+
+#bestandsinfo_kopje
+{ 
+	background: url(img/images/bg_bestandsinfo_geel.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#licentiekiezen_kopje
+{ 
+	background: url(img/images/bg_licentiekiezen_geel.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#maakplaylistaan_kopje
+{ 
+	background: url(img/images/bg_maak_playlist_aan.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#referenties_kopje
+{ 
+	background: url(img/images/bg_referenties_geel.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#omschrijving_kopje
+{ 
+	background: url(img/images/bg_omschrijving_geel.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#contactinfo_kopje
+{ 
+	background: url(img/images/bg_contactinfo.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#overig_kopje
+{ 
+	background: url(img/images/bg_overig.gif) no-repeat top right; 
+	height: 23px;
+}
+
+.roundcont 
+{
+	width: 354px;
+	background: url(img/images/bg_formmid.gif) repeat-y;
+}
+
+.roundcont p, .kopjelinks_295_geel p, .kopjerechts_295_geel p  
+{
+	margin: 10px;
+}
+
+.roundcont ol
+{
+	margin:5px;
+	width: 150px;
+}
+
+
+
+.roundtop 
+{ 
+	background: url(img/images/bg_formtop.gif) no-repeat top right; 
+	height: 4px;
+}
+
+.roundbottom 
+{
+	background: url(img/images/bg_formbottom.gif) no-repeat bottom right; 
+	height: 4px;
+}
+
+
+.kopjelinks_295_geel
+{
+	float: left;
+	width: 295px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+	background: url(/live/img/images/bg_geel_295_mid.gif) repeat-y;
+}
+
+.kopjerechts_295_geel
+{
+	float: right;
+	width: 295px;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+	background: url(/live/img/images/bg_geel_295_mid.gif) repeat-y;
+}
+
+.onder_295_geel
+{
+	background: url(/live/img/images/bg_geel_295_onder.gif) no-repeat bottom left; 
+	height: 4px;
+}
+
+
+/* -------------- einde  gele inputvelden----------- */
+
+
+
+
+/* -------------- profiel inputvelden----------- */
+
+#dezeweek_kopje
+{ 
+	background: url(img/images/bg_dezeweek.gif) no-repeat top right; 
+	height: 23px;
+}
+
+
+#profiel_info 
+{ 
+	background: url(img/images/bg_profiel_info.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#profiel_bio 
+{ 
+	background: url(img/images/bg_profiel_bio.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#profiel_com 
+{ 
+	background: url(img/images/bg_profiel_com.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#profiel_links 
+{ 
+	background: url(img/images/bg_profiel_links.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#profiel_musica
+{ 
+	background: url(img/images/bg_profiel_musica.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#profiel_aanraders
+{ 
+	background: url(img/images/bg_profiel_aanraders.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#playlisttop10_kopje
+{ 
+	background: url(img/images/bg_playlisttop10.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#artiesten_kopje
+{ 
+	background: url(img/images/bg_artiesten.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#alleartiesten_kopje
+{ 
+	background: url(img/images/bg_alleartiesten.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#laatsttoegevoegd_kopje
+{ 
+	background: url(img/images/bg_laatsttoegevoegd.gif) no-repeat top right; 
+	height: 23px;
+}
+
+
+.profiel_roundcont 
+{
+	clear: both;
+	width: 600px;
+	background: url(img/images/bg_profiel_formmid.gif) repeat-y;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+.profiel_roundcont p 
+{
+	margin: 10px;
+	width: 550px;
+	text-align: justify;
+}
+
+.profiel_roundbottom 
+{
+	background: url(img/images/bg_profiel_formonder.gif) no-repeat bottom right; 
+	height: 4px;
+}
+/* -------------- einde profiel inputvelden----------- */
+
+/*-------------------------------------begin downloads----------------------------------------------------*/
+#topdownloads_kopje
+{ 
+	background: url(img/images/bg_topdownloads.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#nieuweuploads_main_kopje
+{ 
+	background: url(img/images/bg_nieuweuploads_main.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#simuzeleden_kopje
+{ 
+	background: url(img/images/bg_simuzeleden.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#audiobestanden_kopje
+{ 
+	background: url(img/images/bg_audiobestanden.gif) no-repeat top right; 
+	height: 23px;
+}
+
+.downloads_roundcont 
+{
+	clear: both;
+	width: 600px;
+	background: url(img/images/bg_rood_600_mid.gif) repeat-y;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+.downloads_roundcont p 
+{
+	margin: 10px;
+	width: 550px;
+	text-align: justify;
+}
+
+.downloads_roundbottom 
+{
+	background: url(img/images/bg_rood_600_onder.gif) no-repeat bottom right; 
+	height: 4px;
+}
+/*-------------------------------------einde downloads----------------------------------------------------*/
+
+/*------------------------------------- begin standaard uitleg div ----------------------------------------------*/
+#uitleg_kopje
+{ 
+	background: url(img/images/bg_uitleg_geel_top.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#wijzigplaylist_kopje
+{ 
+	background: url(img/images/bg_wijzig_playlist.gif) no-repeat top right; 
+	height: 23px;
+}
+
+.uitleg_top
+{ 
+	background: url(img/images/bg_uitleg_geel_boven.gif) no-repeat top right; 
+	height: 4px;
+}
+
+.uitleg_geeltop
+{ 
+	background: url(img/images/bg_uitleg_geel_boven2.gif) no-repeat top right; 
+	height: 4px;
+}
+
+#nieuw_kopje
+{ 
+	background: url(img/images/bg_nieuw_geel_top.gif) no-repeat top right; 
+	height: 23px;
+}
+
+#wachtrij_kopje
+{ 
+	background: url(img/images/bg_wachtrij_geel_top.gif) no-repeat top right; 
+	height: 23px;
+}
+
+
+.uitleg_roundcont 
+{
+	clear: both;
+	width: 600px;
+	background: url(img/images/bg_uitleg_geel_mid.gif) repeat-y;
+	margin: 0px 0px 0px 0px;
+	padding: 0px 0px 0px 0px;
+}
+
+.uitleg_roundcont p 
+{
+	margin: 10px;
+	width: 550px;
+	text-align: justify;
+}
+
+.uitleg_roundbottom 
+{
+	background: url(img/images/bg_uitleg_geel_onder.gif) no-repeat bottom right; 
+	height: 4px;
+}
+
+.uitleg_geelroundbottom
+{
+	background: url(img/images/bg_uitleg_geel_onder2.gif) no-repeat bottom right; 
+	height: 4px;
+}
+
+/*------------------------------------- einde standaard uitleg div ---------------------------------------------------*/
+
+img.shadow
+{
+	float:left;
+	margin: 0px;
+	padding: 0px 0px 0px 0px;
+	height: 18px;
+}
+    
+img.zoekknop
+{
+	margin: 0px;
+	padding: 0px 0px 0px 0px;
+	height: 15px;
+}
+   
+
+/* begin tabellen even en oneven */
+
+#playlist 
+{
+	border: 0px;
+	margin: 0px 0px 0px 2px;
+}
+
+#playlist tbody tr td 
+{
+	font-family: &quot;lucida grande&quot;, verdana, sans-serif;
+	font-size: 8pt;
+	border: 1px solid #F7F3DF;
+}
+	
+#playlist tbody tr.selected td 
+{
+	background-color: #FFAD00;
+	color: #ffffff;
+	font-weight: bold;
+	border-left: 1px solid #81A3AB;
+	border-bottom: 1px solid #7DAAEA;
+}
+
+#playlist tr.ruled
+{
+	color:#FFAD00;
+}
+	
+
+#mytable tr.ruled
+{
+	background:#FFAD00;
+	color:#990101;
+}
+		
+/* einde tabellen even en oneven */
+
+img.alignright 
+{
+	float: right;
+	padding: 4px;
+	margin: 0px 0px 2px 7px;
+	display: inline;
+}
+
+img.alignleft 
+{
+	float: left;
+	padding: 0px;
+	margin: 0px 10px 10px 0px;
+	display: inline;
+}
+
+
+
+/*]]&gt;*/
+

Added: trunk/maintemplate.php
===================================================================
--- trunk/maintemplate.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/maintemplate.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,91 @@
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
+        &quot;<A HREF="http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-transitional.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
+
+&lt;head&gt;
+&lt;title&gt;Simuze&lt;/title&gt;
+&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=ISO-8859-1&quot; /&gt; 
+
+&lt;style type=&quot;text/css&quot; media=&quot;all&quot;&gt;
+		@import &quot;mainstyle.css&quot;;
+		@import &quot;forms.css&quot;;
+	&lt;/style&gt;
+&lt;/head&gt;
+
+&lt;body&gt;
+
+&lt;div id=&quot;horizon&quot;&gt;
+	&lt;div id=&quot;wrapper&quot;&gt;
+		&lt;div id=&quot;header&quot;&gt;
+			&lt;div id=&quot;hoofdbar&quot;&gt;&lt;a href=&quot;help.php&quot; title=&quot;hulp nodig?&quot; class=&quot;help&quot;&gt;help?&lt;/a&gt;&lt;/div&gt;
+			&lt;div id=&quot;hoofdmenu&quot;&gt;
+			  &lt;ul&gt;  	
+			  	&lt;li&gt;&lt;img class=&quot;shadow&quot; src=&quot;img/images/shadow.gif&quot;&gt;&lt;/li&gt;
+				&lt;li id=&quot;current&quot;&gt;&lt;a href=&quot;index.html&quot;&gt;&lt;span&gt;start&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;nieuws/index.php&quot;&gt;&lt;span&gt;nieuws&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;artiesten/index.php&quot;&gt;&lt;span&gt;artiesten&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;charts/index..php&quot;&gt;&lt;span&gt;charts&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;backstage/index.php&quot;&gt;&lt;span&gt;backstage&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;forums/index.php&quot;&gt;&lt;span&gt;forums&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;chat/index.php&quot;&gt;&lt;span&gt;chat&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+			  &lt;/ul&gt;
+			  &lt;/div&gt;
+			  &lt;div id=&quot;searchveld&quot;&gt;&lt;?php include ('searchform.php'); ?&gt;&lt;/div&gt;
+			  &lt;div id=&quot;submenu&quot;&gt;
+			  &lt;ul&gt;  	
+			  	&lt;li&gt;&lt;img class=&quot;shadow&quot; src=&quot;img/images/shadow.gif&quot;&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;#&quot;&gt;&lt;span&gt;over simuze &lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;../nieuws/index.php&quot;&gt;&lt;span&gt;faq &lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;faq.php&quot;&gt;&lt;span&gt;tips n tools  &lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;faq.php&quot;&gt;&lt;span&gt;sponsors&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li&gt;&lt;a href=&quot;faq.php&quot;&gt;&lt;span&gt; contact&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+			  &lt;/ul&gt;
+			  &lt;/div&gt;
+			  &lt;div id=&quot;ondersubmenu&quot;&gt;&lt;/div&gt;
+		&lt;/div&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Main template&lt;/h1&gt;
+				&lt;p&gt;Lorem ipsum dolor sit amet, consectetuer adipiscing elit.  Phasellus varius eleifend tellus. Suspendisse potenti. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos hymenaeos. Nulla facilisi. Sed wisi lectus, placerat nec, mollis quis, posuere eget, arcu.&lt;/p&gt;
+				&lt;p class=&quot;last&quot;&gt;Donec euismod. Praesent mauris mi, adipiscing non, mollis eget, adipiscing ac, erat. Integer nonummy mauris sit amet metus. In adipiscing, ligula ultrices dictum vehicula, eros turpis lacinia libero, sed aliquet urna diam sed tellus. Etiam semper sapien eget metus.&lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+		&lt;div id=&quot;sidebar&quot;&gt;&lt;?php include (&quot;login.php&quot;); ?&gt;&lt;/div&gt;
+		&lt;div class=&quot;clearing&quot;&gt;&nbsp;&lt;/div&gt;
+		&lt;div id=&quot;footer&quot;&gt;
+		   &lt;br /&gt;&lt;a href=&quot;colofon.php#copyright&quot; class=&quot;voet&quot; title=&quot;Sommige rechten voorbehouden..&quot;&gt;&copy; StOM 2005&lt;/a&gt;
+		&lt;br /&gt;&lt;a href=&quot;colofon.php&quot; title=&quot;colofon&quot; class=&quot;voet&quot;&gt;colofon&lt;/a&gt; |&lt;a href=&quot;disclaimer.php&quot; title=&quot;disclaimer&quot; class=&quot;voet&quot;&gt;disclaimer&lt;/a&gt;
+     
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/div&gt;
+&lt;!--
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-sa/2.0/nl/">http://creativecommons.org/licenses/by-nc-sa/2.0/nl/</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-sa/2.0/nl/">http://creativecommons.org/licenses/by-nc-sa/2.0/nl/</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Notice">http://web.resource.org/cc/Notice</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Attribution">http://web.resource.org/cc/Attribution</A>&quot; /&gt;
+   &lt;prohibits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/CommercialUse">http://web.resource.org/cc/CommercialUse</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/ShareAlike">http://web.resource.org/cc/ShareAlike</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+
+&lt;/body&gt;
+&lt;/html&gt;
\ No newline at end of file

Added: trunk/media/avatar/default/default_avatar240x180.gif
===================================================================
(Binary files differ)


Property changes on: trunk/media/avatar/default/default_avatar240x180.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/media/avatar/default/default_avatar40x30.gif
===================================================================
(Binary files differ)


Property changes on: trunk/media/avatar/default/default_avatar40x30.gif
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/media/flash/musicplayer.swf
===================================================================
(Binary files differ)


Property changes on: trunk/media/flash/musicplayer.swf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/media/flash/simuze_playerv01.swf
===================================================================
(Binary files differ)


Property changes on: trunk/media/flash/simuze_playerv01.swf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/mustread.php
===================================================================
--- trunk/mustread.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/mustread.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,21 @@
+&lt;?php require 'template_header.php'; ?&gt;
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+                    &lt;h1&gt;Must Read&lt;/h1&gt;
+                    
+                    &lt;p class=&quot;space&quot;&gt;
+                        Hieronder staan een aantal links met informatie gerangschikt per onderwerp
+                        die je echt eens zou moeten lezen als je met muziek of andere vormenen van creativiteit bezig houdt. 
+                        Het merendeel van de links hieronder geeft je argumenten voor het feit dat het huidige auteursrecht niet goed werkt. 
+                    &lt;/p&gt;
+                    &lt;p class=&quot;space&quot;&gt;
+                        &lt;ul&gt;
+                            &lt;li&gt;&lt;a href=&quot;&quot; title=&quot;&quot; &gt;link&lt;/a&gt;&lt;/li&gt;
+                    &lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/mv_index.swf
===================================================================
(Binary files differ)


Property changes on: trunk/mv_index.swf
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: trunk/nbrief_false.php
===================================================================
--- trunk/nbrief_false.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/nbrief_false.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,16 @@
+&lt;?php require 'template_header.php'; ?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Nieuwsbrief&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;&lt;h2&gt;Ojee, er is wat fout gegaan!&lt;/h2&gt;
+				&lt;br /&gt;
+				Ga &lt;a href=&quot;index.php&quot;&gt;terug&lt;/a&gt; en probeer het nog eens... &lt;/p&gt;
+				
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/nbrief_true.php
===================================================================
--- trunk/nbrief_true.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/nbrief_true.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,14 @@
+&lt;?php require 'template_header.php'; ?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Nieuwsbrief&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;Bedankt! Je aanmelding voor de Simuze nieuwsbrief is ontvangen. Binnenkort krijg je de de eerste nieuwsbrief in je mailbox. &lt;!-- Wil je je afmelden? Stuur dan een mailtje naar --&gt; &lt;/p&gt;
+				
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/noprofile.php
===================================================================
--- trunk/noprofile.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/noprofile.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,7 @@
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;p class=&quot;space&quot;&gt;
+					Van de opgevraagde gebruiker is nog geen profiel aanwezig.
+				&lt;/p&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;

Added: trunk/not_logged_in_menu.php
===================================================================
--- trunk/not_logged_in_menu.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/not_logged_in_menu.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,17 @@
+&lt;div id=&quot;login&quot;&gt;
+&lt;img alt=&quot;simuze boven login image&quot; src=&quot;/live/img/images/boven_login.gif&quot; /&gt;&lt;div id=&quot;not_logged_in&quot;&gt;&lt;form action=&quot;/live/sm-login.php&quot; method=&quot;post&quot; name=&quot;login&quot; id=&quot;login&quot;&gt;
+        &lt;fieldset&gt;
+            &lt;label for=&quot;uname&quot;&gt;gebruikersnaam:&lt;/label&gt; 
+            &lt;input type=&quot;text&quot; id=&quot;uname&quot; name=&quot;uname&quot; maxlength=&quot;16&quot; size=&quot;16&quot; class=&quot;input_sidebar&quot; /&gt; 
+            &lt;label for=&quot;password&quot; class=&quot;wijd&quot;&gt;wachtwoord: &lt;a href=&quot;/live/lost.php&quot;&gt;vergeten?&lt;/a&gt;&lt;/label&gt; 
+            &lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; maxlength=&quot;16&quot; size=&quot;16&quot; class=&quot;input_sidebar&quot; /&gt;
+            &lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;true&quot; /&gt;
+        &lt;/fieldset&gt;  
+            &lt;p class=&quot;sidebar&quot; style=&quot;clear:both&quot;&gt;
+            &lt;input type=&quot;image&quot; src=&quot;/live/img/images/login_btn.gif&quot; alt=&quot;inloggen&quot; value=&quot;true&quot; border=&quot;0&quot; class=&quot;nospace&quot; /&gt;&lt;/p&gt;&lt;/div&gt;&lt;img alt=&quot;simuze onder login image&quot; src=&quot;/live/img/images/onder_login.gif&quot; class=&quot;nospace&quot; /&gt;&lt;/form&gt;&lt;/div&gt;
+&lt;br /&gt;
+&lt;br /&gt;
+&lt;br /&gt;
+&lt;br /&gt;
+&lt;br /&gt;
+&lt;a href=&quot;/live/register.php&quot;&gt;&lt;img src=&quot;/live/img/images/wordnulid.gif&quot; border=&quot;0&quot;&gt;&lt;/a&gt;                                           

Added: trunk/oversimuze.php
===================================================================
--- trunk/oversimuze.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/oversimuze.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,20 @@
+&lt;?php require 'template_header.php'; ?&gt;
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Over Simuze&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Simuze is ontstaan uit ontevredenheid met de wijze waarop de media en de muziekindustrie met muziek, muzikant en muziekliefhebber omgaan en het idee dat dit anders kan. Het is steeds lastiger voor muzikanten om hun muziek gehoord te krijgen en publiciteit te krijgen. Ondanks het feit dat er de afgelopen jaren meer kanalen op radio en televisie bij zijn gekomen is de diversiteit van het aanbod aan muziek via deze bekende mediakanalen verschraald. De remix cultuur (zoals we die bijvoorbeeld kennen uit de hiphop en dance) wordt actief tegen gegaan en in de illegaliteit geplaatst in plaats van deze te omarmen. 
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Simuze draait om muziek (geluid) in alle vormen. Het is een muziek community waarbij muzikanten en muziekliefhebbers elkaar ontmoeten en muziek uitwisselen, remixen of verder bewerken. Muzikanten kunnen hun muziek uploaden onder een Creative Commons licentie naar eigen keuze. Zo beschermt de muzikant zijn muziek en geeft tegelijkertijd anderen meer vrijheid het te gebruiken. Ook als je geen muzikant bent kun je je aanmelden en nieuwe muziek ontdekken bij Simuze. Een eerste opzet werd gemaakt in 2004 door Marten Timan voor zijn afstudeerproject aan het EMMA. 
+				
+				
+				&lt;/p&gt;
+				
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/profile_view.php
===================================================================
--- trunk/profile_view.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/profile_view.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,29 @@
+&lt;?php
+//require_once('inc/sm-secure.php');
+require_once(&quot;inc/sm-messages.php&quot;);
+//require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+
+
+
+
+	require 'template_header.php'; 
+	
+//	if ($nr_rows == &quot;0&quot;){
+//		$div_class = &quot;hidden&quot;;
+//	} else {
+//		$div_class = &quot;visible&quot;;
+//	}
+	
+
+	// if there is no profile available, than say so :)
+	if ($nr_rows == &quot;0&quot;){
+		require 'profilenormal_view.php';
+	} else {	
+		require 'profilemusic_view.php';	
+	}
+	
+	require 'template_sidebar_footer.php';
+?&gt;
+		
+  

Added: trunk/profilemusic_view.php
===================================================================
--- trunk/profilemusic_view.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/profilemusic_view.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,126 @@
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				
+			&lt;?php
+				if ($checked_data['url_3'] == &quot;Niet ingevuld&quot;) {
+					$view = &quot;hidden&quot;;
+				} else {
+					$view = &quot;visible&quot;;
+				}
+			?&gt;
+			
+				&lt;div id=&quot;kolom1_wie&quot;&gt;
+				&lt;div&gt;&lt;h1&gt;&lt;?php echo &quot;$checked_data[artistname]&quot;;?&gt;&lt;/h1&gt;
+				
+					&lt;div class=&quot;uitleg_roundcont&quot;&gt;
+						&lt;div class=&quot;uitleg_top&quot;&gt;&lt;/div&gt;&lt;ul&gt;&lt;li&gt;&lt;b class=&quot;red&quot;&gt;Genre: &lt;/b&gt;&lt;/li&gt;&lt;?php echo $genre_result; ?&gt;&lt;/ul&gt;
+						&lt;ul&gt;&lt;li&gt;&lt;b class=&quot;red&quot;&gt;Trefwoorden:&lt;/b&gt; &lt;/li&gt;&lt;?php echo $tag_string; ?&gt;&lt;/ul&gt;	
+						&lt;div class=&quot;uitleg_roundbottom&quot;&gt;&lt;/div&gt;	
+					&lt;/div&gt;		
+					&lt;br /&gt;&lt;br /&gt;
+				&lt;/div&gt;
+					
+					
+					&lt;div class=&quot;profile_container&quot;&gt;
+			
+							&lt;div id=&quot;member_foto&quot;&gt;&lt;img alt=&quot;standaard foto&quot; src=&quot;&lt;?php echo $imgsrc; ?&gt;&quot; /&gt;&lt;/div&gt;
+							&lt;?php echo &quot;$checked_data[bio]&quot;;?&gt;
+								
+				
+							
+						
+					&lt;/div&gt;
+	
+				&lt;/div&gt;
+				
+			&lt;!-- begin muziek div --&gt;	
+		
+				&lt;div id=&quot;bar1klein&quot;&gt;&lt;/div&gt;
+	
+				&lt;div id=&quot;kolom2_muziek&quot;&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;div class=&quot;uitleg_roundcont&quot;&gt;
+						&lt;div class=&quot;uitleg_geeltop&quot;&gt;&lt;/div&gt;	
+							&lt;table border=&quot;0&quot; bordercolor=&quot;#000&quot; shadowcolor=&quot;#000&quot; cellpadding=&quot;1&quot; cellspacing=&quot;2&quot;&gt;
+							&lt;tr&gt;
+								&lt;th width=&quot;20&quot;&gt;&lt;/th&gt;
+								&lt;th width=&quot;265&quot;&gt;Titel&lt;/th&gt;
+								&lt;th width=&quot;200&quot;&gt;Album&lt;/th&gt;
+								&lt;th width=&quot;100&quot;&gt;Grootte&lt;/th&gt;
+								&lt;th width=&quot;100&quot;&gt;Licentie&lt;/th&gt;
+							&lt;/tr&gt;
+							
+							&lt;?php echo &quot;$muziek&quot;; ?&gt;
+							
+							&lt;/table&gt;
+						&lt;div class=&quot;uitleg_geelroundbottom&quot;&gt;&lt;/div&gt;	
+					&lt;/div&gt;	
+				&lt;/p&gt;	
+				&lt;/div&gt;	
+				
+				&lt;div id=&quot;bar2_geel&quot;&gt;
+					&lt;div id=&quot;bar2_links&quot;&gt;&lt;!--&lt;img src=&quot;/live/img/images/btn_beluister_alle.gif&quot; alt=&quot;beluister alle nummers&quot; border=&quot;0&quot; /&gt;--&gt;&lt;/div&gt;
+					&lt;div id=&quot;bar2_rechts&quot;&gt;&lt;p class=&quot;red&quot;&gt;&lt;/p&gt;
+					&lt;/div&gt;
+				&lt;/div&gt;
+		
+		&lt;!-- einde muziek div  --&gt;		
+				
+				&lt;div id=&quot;kolom3_hq&quot;&gt;
+		
+								&lt;!-- box links voor standaard contactgegevens --&gt;
+							&lt;div class=&quot;kopjelinks_295_geel&quot;&gt;
+								&lt;div id=&quot;contactinfo_kopje&quot;&gt;&lt;/div&gt;
+								&lt;p&gt;&lt;b&gt;naam:&lt;/b&gt; &lt;?php echo &quot;$checked_data[firstname]&quot;;?&gt; &lt;?php echo &quot;$checked_data[lastname]&quot;;?&gt;&lt;br /&gt;
+									&lt;b&gt;woonplaats:&lt;/b&gt; &lt;?php echo &quot;$checked_data[location]&quot;;?&gt;&lt;br /&gt;
+									provincie &lt;?php echo &quot;$checked_data[state]&quot;;?&gt;&lt;br /&gt;
+									geboortedatum &lt;?php echo $bdmy ?&gt; &lt;/p&gt;
+									
+									
+									&lt;p&gt;
+									&lt;a href=&quot;<A HREF="http://www.imagine-msn.com">http://www.imagine-msn.com</A>&quot;&gt;MSN:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_msn]&quot;;?&gt;&lt;br /&gt;
+									&lt;a href=&quot;<A HREF="http://www.icq.com/download">http://www.icq.com/download</A>&quot;&gt;ICQ:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_icq]&quot;;?&gt;&lt;br /&gt;
+									&lt;a href=&quot;<A HREF="http://www.skype.com/download">http://www.skype.com/download</A>&quot;&gt;Skype:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_skype]&quot;;?&gt;&lt;br /&gt;
+									&lt;a href=&quot;<A HREF="http://www.aim.com">http://www.aim.com</A>&quot;&gt;AIM:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_aim]&quot;;?&gt;&lt;br /&gt;
+									&lt;a href=&quot;<A HREF="http://messenger.yahoo.com">http://messenger.yahoo.com</A>&quot;&gt;Yahoo:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_yahoo]&quot;;?&gt;&lt;br /&gt; 
+									&lt;a href=&quot;<A HREF="http://www.apple.com/ichat">http://www.apple.com/ichat</A>&quot;&gt;iChat:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_ichat]&quot;;?&gt;&lt;br /&gt;&lt;a href=&quot;<A HREF="http://www.jabber.org/">http://www.jabber.org/</A>&quot;&gt;Jabber:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_jabber]&quot;;?&gt;&lt;br /&gt;
+									&lt;/p&gt;
+									
+									
+								&lt;div class=&quot;onder_295_geel&quot;&gt;&lt;/div&gt;
+								&lt;!-- einde box links voor standaard contactgegevens --&gt;
+							&lt;/div&gt;	
+
+			
+							&lt;div class=&quot;kopjerechts_295_geel&quot;&gt;
+								&lt;div id=&quot;overig_kopje&quot;&gt;&lt;/div&gt;
+								&lt;p&gt;&lt;b&gt;bekijk ook eens de volgende sites:&lt;/b&gt;&lt;/p&gt;
+								&lt;p&gt;&lt;a href=&quot;&lt;?php echo &quot;$checked_data[url_1]&quot;;?&gt;&quot;&gt;&lt;?php echo &quot;$checked_data[url_1]&quot;;?&gt;&lt;/a&gt;&lt;br /&gt;
+								&lt;a href=&quot;&lt;?php echo &quot;$checked_data[url_2]&quot;;?&gt;&quot;&gt;&lt;?php echo &quot;$checked_data[url_2]&quot;;?&gt;&lt;/a&gt;&lt;br /&gt;
+								&lt;a class=&quot;&lt;?php echo &quot;$view&quot;; ?&gt;&quot; href=&quot;&lt;?php echo &quot;$checked_data[url_3]&quot;;?&gt;&quot;&gt;&lt;?php echo &quot;$checked_data[url_3]&quot;;?&gt;&lt;/a&gt;&lt;/p&gt;
+								
+								&lt;p&gt;&lt;b&gt;favorieten:&lt;/b&gt;&lt;/p&gt;
+								&lt;p&gt;
+								&lt;b&gt;1:&lt;/b&gt; &lt;?php echo &quot;$checked_data[musica_1]&quot;;?&gt;, 
+								&lt;b&gt;2:&lt;/b&gt; &lt;?php echo &quot;$checked_data[musica_2]&quot;;?&gt;,
+								&lt;b&gt;3:&lt;/b&gt; &lt;?php echo &quot;$checked_data[musica_3]&quot;;?&gt;
+								&lt;/p&gt;
+						
+								&lt;p&gt;&lt;b&gt;andere aanraders:&lt;/b&gt;&lt;/p&gt;
+								&lt;p&gt;
+								&lt;?php echo &quot;$checked_data[must_read]&quot;;?&gt;&lt;br /&gt;
+								&lt;?php echo &quot;$checked_data[must_see]&quot;;?&gt;&lt;br /&gt;
+								&lt;?php echo &quot;$checked_data[must_listen]&quot;;?&gt;&lt;br /&gt;
+								&lt;?php echo &quot;$checked_data[must_visit]&quot;;?&gt;&lt;br /&gt;
+								&lt;/p&gt;
+								
+								&lt;div class=&quot;onder_295_geel&quot;&gt;&lt;/div&gt;
+								&lt;!-- einde box rechts voor overige gegevens --&gt;
+							&lt;/div&gt;	
+				
+					
+				&lt;/div&gt;
+				
+				
+			&lt;/div&gt;
+		&lt;/div&gt;

Added: trunk/profilenormal_view.php
===================================================================
--- trunk/profilenormal_view.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/profilenormal_view.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,97 @@
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+			&lt;?php 
+			
+			if ($checked_data == &quot;Niet ingevuld&quot;) {
+				$view = &quot;hidden&quot;;
+			} else {
+				$view = &quot;visible&quot;;
+			}
+			?&gt;
+			
+				&lt;div id=&quot;kolom1_wie&quot;&gt;
+				&lt;div&gt;&lt;h1&gt;&lt;?php echo &quot;$checked_data[artistname]&quot;;?&gt; &lt;/h1&gt;
+     
+				&lt;/div&gt;
+					
+					
+					&lt;div class=&quot;profile_container&quot;&gt;
+						&lt;div id=&quot;showprofile_rechts&quot;&gt;
+							&lt;div id=&quot;member_foto&quot;&gt;&lt;img alt=&quot;standaard foto&quot; src=&quot;&lt;?php echo $imgsrc; ?&gt;&quot; /&gt;&lt;/div&gt;
+						
+						&lt;/div&gt;
+						
+						&lt;div id=&quot;member_info&quot;&gt;		
+							&lt;?php echo &quot;$checked_data[bio]&quot;;?&gt;
+								&lt;!-- begin van de overige informatie, aanraders, etc. --&gt;
+								&lt;p&gt;
+									
+									
+										
+										
+								
+								&lt;/p&gt;	
+							&lt;!-- einde van de overige informatie, aanraders, etc. --&gt;
+						&lt;/div&gt;
+					&lt;/div&gt;
+	
+				&lt;/div&gt;
+				
+			
+				
+				&lt;div id=&quot;kolom3_hq&quot;&gt;
+					
+								&lt;!-- box links voor standaard contactgegevens --&gt;
+							&lt;div class=&quot;kopjelinks_295_geel&quot;&gt;
+								&lt;div id=&quot;contactinfo_kopje&quot;&gt;&lt;/div&gt;
+								&lt;p&gt;&lt;b&gt;naam:&lt;/b&gt; &lt;?php echo &quot;$checked_data[firstname]&quot;;?&gt; &lt;?php echo &quot;$checked_data[lastname]&quot;;?&gt;&lt;br /&gt;
+									&lt;b&gt;woonplaats:&lt;/b&gt; &lt;?php echo &quot;$checked_data[location]&quot;;?&gt;&lt;br /&gt;
+									provincie &lt;?php echo &quot;$checked_data[state]&quot;;?&gt;&lt;br /&gt;
+									geboortedatum &lt;?php echo $bdmy ?&gt; &lt;/p&gt;
+									
+									
+									&lt;p&gt;
+									&lt;a href=&quot;<A HREF="http://www.imagine-msn.com">http://www.imagine-msn.com</A>&quot;&gt;MSN:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_msn]&quot;;?&gt;&lt;br /&gt;
+									&lt;a href=&quot;<A HREF="http://www.icq.com/download">http://www.icq.com/download</A>&quot;&gt;ICQ:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_icq]&quot;;?&gt;&lt;br /&gt;
+									&lt;a href=&quot;<A HREF="http://www.skype.com/download">http://www.skype.com/download</A>&quot;&gt;Skype:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_skype]&quot;;?&gt;&lt;br /&gt;
+									&lt;a href=&quot;<A HREF="http://www.aim.com">http://www.aim.com</A>&quot;&gt;AIM:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_aim]&quot;;?&gt;&lt;br /&gt;
+									&lt;a href=&quot;<A HREF="http://messenger.yahoo.com">http://messenger.yahoo.com</A>&quot;&gt;Yahoo:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_yahoo]&quot;;?&gt;&lt;br /&gt; 
+									&lt;a href=&quot;<A HREF="http://www.apple.com/ichat">http://www.apple.com/ichat</A>&quot;&gt;iChat:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_ichat]&quot;;?&gt;&lt;br /&gt;&lt;a href=&quot;<A HREF="http://www.jabber.org/">http://www.jabber.org/</A>&quot;&gt;Jabber:&lt;/a&gt; &lt;?php echo &quot;$checked_data[im_jabber]&quot;;?&gt;&lt;br /&gt;
+									&lt;/p&gt;
+									
+									
+								&lt;div class=&quot;onder_295_geel&quot;&gt;&lt;/div&gt;
+								&lt;!-- einde box links voor standaard contactgegevens --&gt;
+							&lt;/div&gt;	
+						
+						&lt;div class=&quot;kopjerechts_295_geel&quot;&gt;
+								&lt;div id=&quot;overig_kopje&quot;&gt;&lt;/div&gt;
+								&lt;p&gt;&lt;b&gt;bekijk ook eens de volgende sites:&lt;/b&gt;&lt;/p&gt;
+								&lt;p&gt;&lt;a href=&quot;&lt;?php echo &quot;$checked_data[url_1]&quot;;?&gt;&quot;&gt;&lt;?php echo &quot;$checked_data[url_1]&quot;;?&gt;&lt;/a&gt;&lt;br /&gt;
+								&lt;a href=&quot;&lt;?php echo &quot;$checked_data[url_2]&quot;;?&gt;&quot;&gt;&lt;?php echo &quot;$checked_data[url_2]&quot;;?&gt;&lt;/a&gt;&lt;br /&gt;
+								&lt;a class=&quot;&lt;?php echo &quot;$view&quot;; ?&gt;&quot; href=&quot;&lt;?php echo &quot;$checked_data[url_3]&quot;;?&gt;&quot;&gt;&lt;?php echo &quot;$checked_data[url_3]&quot;;?&gt;&lt;/a&gt;&lt;/p&gt;
+								
+								&lt;p&gt;&lt;b&gt;favorieten:&lt;/b&gt;&lt;/p&gt;
+								&lt;p&gt;
+								&lt;b&gt;1:&lt;/b&gt; &lt;?php echo &quot;$checked_data[musica_1]&quot;;?&gt;, 
+								&lt;b&gt;2:&lt;/b&gt; &lt;?php echo &quot;$checked_data[musica_2]&quot;;?&gt;,
+								&lt;b&gt;3:&lt;/b&gt; &lt;?php echo &quot;$checked_data[musica_3]&quot;;?&gt;
+								&lt;/p&gt;
+						
+								&lt;p&gt;&lt;b&gt;andere aanraders:&lt;/b&gt;&lt;/p&gt;
+								&lt;p&gt;
+								&lt;?php echo &quot;$checked_data[must_read]&quot;;?&gt;&lt;br /&gt;
+								&lt;?php echo &quot;$checked_data[must_see]&quot;;?&gt;&lt;br /&gt;
+								&lt;?php echo &quot;$checked_data[must_listen]&quot;;?&gt;&lt;br /&gt;
+								&lt;?php echo &quot;$checked_data[must_visit]&quot;;?&gt;&lt;br /&gt;
+								&lt;/p&gt;
+								
+								&lt;div class=&quot;onder_295_geel&quot;&gt;&lt;/div&gt;
+								&lt;!-- einde box rechts voor overige gegevens --&gt;
+							&lt;/div&gt;	
+					
+				&lt;/div&gt;
+				
+				
+			&lt;/div&gt;
+		&lt;/div&gt;

Added: trunk/register.php
===================================================================
--- trunk/register.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/register.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,57 @@
+&lt;?php require 'template_header.php'; ?&gt;	
+
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Word lid!&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;
+					Om volledig gebruik te kunnen maken van Simuze dien je ingeschreven te staan als gebruiker.
+                    Deze gegevens dienen alleen voor de werking van enkele onderdelen van de site en zullen nooit of te nimmer doorverkocht of weggeven worden.  
+				&lt;/p&gt;
+				&lt;p class=&quot;space&quot;&gt;
+					Alle velden zijn verplicht.	Kies een gebruikersnaam (NIET mogelijk om deze later te wijzigen!) bestaande uit 
+					minimaal 4 en maximaal 16 letters en/of cijfers, waarbij het eerste teken een letter moet zijn.
+					Kies een wachtwoord van minimaal 6 en maximaal 16 tekens, vul je email adres in en als alles goed 
+					gaat ontvang je zo snel mogelijk een emailtje met verdere aanwijzigingen.
+				&lt;/p&gt;
+				
+				&lt;p&gt;
+				&lt;form action=&quot;sm-register.php&quot; method=&quot;post&quot; name=&quot;register&quot; id=&quot;register&quot; onSubmit=&quot;return checkRegister(this)&quot;&gt;
+				&lt;div class=&quot;roundcont&quot;&gt;
+					&lt;div class=&quot;roundtop&quot;&gt;&lt;/div&gt;
+					&lt;fieldset&gt;
+					
+						&lt;p&gt;Vul hieronder je gegevens in:&lt;/p&gt;&lt;br /&gt;
+						&lt;label for=&quot;uname&quot;&gt;gebruikersnaam:&lt;/label&gt; 
+						&lt;input type=&quot;text&quot; id=&quot;uname&quot; name=&quot;uname&quot; maxlength=&quot;16&quot; size=&quot;25&quot; class=&quot;form_tekstveld&quot; /&gt; 
+						&lt;label for=&quot;email&quot;&gt;e-mail:&lt;/label&gt; 
+						&lt;input type=&quot;text&quot; id=&quot;email&quot; name=&quot;email&quot; maxlength=&quot;250&quot; size=&quot;25&quot; class=&quot;form_tekstveld&quot; /&gt;
+						&lt;label for=&quot;password&quot;&gt;wachtwoord:&lt;/label&gt; 
+						&lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; maxlength=&quot;16&quot; size=&quot;16&quot; class=&quot;form_tekstveld&quot; /&gt;
+						&lt;label for=&quot;password2&quot;&gt;wachtwoord (nogmaals):&lt;/label&gt; 
+						&lt;input type=&quot;password&quot; id=&quot;password2&quot; name=&quot;password2&quot; maxlength=&quot;16&quot; size=&quot;16&quot; class=&quot;form_tekstveld&quot; /&gt;
+						
+						&lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;true&quot; class=&quot;hidden&quot; /&gt;&lt;br /&gt;
+						&lt;/fieldset&gt;
+					
+					&lt;table border=&quot;0&quot; class=&quot;nospace&quot; cellpadding=&quot;4&quot; cellspacing=&quot;0&quot; &gt;
+						&lt;tr&gt;
+							&lt;td width=&quot;100&quot;&gt;&nbsp;&lt;/td&gt;
+							&lt;td&gt;&lt;input type=&quot;checkbox&quot; class=&quot;form_checkbox&quot; /&gt;: Ik ben bekend met de &lt;a href=&quot;voorwaarden.php&quot; title=&quot;lees de Simuze voorwaarden in een nieuw scherm&quot; target=&quot;new&quot;&gt;voorwaarden&lt;/a&gt; van Simuze en stem hiermee in.&lt;/td&gt;
+						&lt;/tr&gt;
+					&lt;/table&gt;
+					
+					&lt;div class=&quot;roundbottom&quot;&gt;&lt;/div&gt;
+						
+				&lt;/div&gt;	
+				
+				&lt;p&gt;&lt;input type=&quot;image&quot; class=&quot;btn&quot; src=&quot;img/images/registreer_btn.gif&quot; alt=&quot;registreer&quot; value=&quot;true&quot;  /&gt;&lt;/p&gt;
+				
+				&lt;/form&gt;
+				&lt;/p&gt;
+			
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+	
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/searchform.php
===================================================================
--- trunk/searchform.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/searchform.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,6 @@
+&lt;form method=&quot;POST&quot; id=&quot;searchform&quot; action=&quot;/live/sm-search.php&quot;&gt;
+	&lt;div id=&quot;zoekdiv&quot;&gt;
+	&lt;input type=&quot;text&quot; name=&quot;s&quot; id=&quot;s&quot; /&gt;&lt;input type=&quot;image&quot; id=&quot;searchsubmit&quot; src=&quot;/live/img/images/zoekknop.gif&quot; alt=&quot;zoek&quot; value=&quot;true&quot; /&gt;
+	&lt;/div&gt;
+&lt;/form&gt;
+

Added: trunk/showprofile.php
===================================================================
--- trunk/showprofile.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/showprofile.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,122 @@
+&lt;?php
+//require_once('inc/sm-secure.php');
+require_once(&quot;inc/sm-messages.php&quot;);
+//require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once('inc/marten_kweeries.php');
+if(!empty($_GET['username'])) {
+    $user = $_GET['username'];
+	
+    require_once(&quot;inc/sm-getprofile.php&quot;);
+    $bdmy = $checked_data['birthdate']['day'] .&quot;-&quot; . $checked_data['birthdate']['month'] .&quot;-&quot; . $checked_data['birthdate']['year'];
+	$user_id = $checked_data['uid'];
+}
+
+//flashplayer
+$flashplayer = '&lt;object classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; codebase=&quot;<A HREF="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0">http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0</A>&quot; width=&quot;17&quot; height=&quot;17&quot; id=&quot;musicplayer&quot; align=&quot;middle&quot;&gt;';
+$flashplayer.= '&lt;param name=&quot;allowScriptAccess&quot; value=&quot;sameDomain&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;movie&quot; value=&quot;/live/media/flash/musicplayer.swf&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;loop&quot; value=&quot;false&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;menu&quot; value=&quot;false&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;quality&quot; value=&quot;high&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;flashvars&quot; value=&quot;song_url=##URL##&quot;';
+$flashplayer.= '&lt;param name=&quot;wmode&quot; value=&quot;transparent&quot; /&gt;';
+$flashplayer.= '&lt;param name=&quot;bgcolor&quot; value=&quot;#f7f3e7&quot; /&gt;';
+$flashplayer.= '&lt;embed src=&quot;/live/media/flash/musicplayer.swf&quot; flashvars=&quot;song_url=##URL##&quot; loop=&quot;false&quot; menu=&quot;false&quot; quality=&quot;high&quot; wmode=&quot;transparent&quot; bgcolor=&quot;#f7f3e7&quot; width=&quot;17&quot; height=&quot;17&quot; name=&quot;musicplayer&quot; align=&quot;middle&quot; allowScriptAccess=&quot;sameDomain&quot; type=&quot;application/x-shockwave-flash&quot; pluginspage=&quot;<A HREF="http://www.macromedia.com/go/getflashplayer">http://www.macromedia.com/go/getflashplayer</A>&quot; /&gt;';
+$flashplayer.= '&lt;/object&gt;';
+
+
+/* code voor het weergeven van de nummers */
+$handle = qGetPublicAudioByUID($user_id);
+$nr_rows = mysql_num_rows($handle);
+
+
+
+// tmp array
+$tmp_tags = array();
+$tmp_genres = array();
+
+/* code voor het aanpassen van de path van het audiobestand */
+	
+	for ($i = 0; $i &lt; $nr_rows; $i++) {
+		$nummer 		= mysql_fetch_array($handle);
+		
+		$hi_path 		= rawurldecode($nummer['audio_hi_path']);
+		$the_hi_url 	= str_replace(&quot;/data/&quot;,&quot;<A HREF="http://www.simuze.nl/live/">http://www.simuze.nl/live/</A>&quot;,$hi_path);
+		$flash 			= str_replace(&quot;##URL##&quot;, $the_hi_url ,$flashplayer);
+		$licentie_nr 	= $nummer['cclicense_id'];
+		$licentie_path 	= $nummer['cclicense_image_path'];
+		$grootte_bytes 	= $nummer['audio_size'];
+		$grootte 		= round($grootte_bytes/1024/1024, 1); 
+		$licentie_img 	= &quot;&lt;img src=\&quot;$licentie_path\&quot;&gt;&quot;;
+		
+		// create the HTML string		
+		$muziek .= &quot;&lt;tr bgcolor=\&quot;#EDD8BE\&quot;&gt;&quot;;
+		$muziek .= &quot;&lt;td&gt;$flash&lt;/td&gt;&quot;;
+		$muziek .= &quot;&lt;td&gt;&quot;;
+		$muziek .= &quot;&lt;a href=\&quot;$the_hi_url\&quot;&gt;&quot;;
+		$muziek .= $nummer['audio_title'];
+		$muziek .= &quot;&lt;/a&gt;&quot;;
+		$muziek .= &quot;&lt;/td&gt;&quot;;
+		$muziek .= &quot;&lt;td&gt;&quot;;
+		$muziek .= $nummer['audio_album'];
+		$muziek .= &quot;&lt;/td&gt;&quot;;
+		$muziek .= &quot;&lt;td&gt;&quot;;
+		$muziek .= $grootte;
+		$muziek .= &quot; MB&quot;;
+		$muziek .= &quot;&lt;/td&gt;&quot;;
+		$muziek .= &quot;&lt;td&gt;&quot;;
+		$muziek .= $licentie_img;
+		$muziek .= &quot;&lt;/td&gt;&quot;;
+		$muziek .= &quot;&lt;/tr&gt;&quot;;
+		
+		$audio_id = $nummer['audio_id'];
+
+		// get tag corresponding with current number 
+		$handle_tag = qGetTagByAudioID($audio_id);
+		$nr_tags = mysql_num_rows($handle_tag);
+		for($j = 0 ; $j &lt; $nr_tags; $j++) {
+			$tag = mysql_fetch_array($handle_tag);
+			array_push($tmp_tags,$tag['tag_name']); 	 
+		}
+		
+		// get genre corresponding with current number
+		$handle_genre = qGetGenreByAudioID($audio_id);
+		$nr_genres = mysql_num_rows($handle_genre);
+		for($k = 0 ; $k &lt; $nr_genres; $k++) {
+			$genre = mysql_fetch_array($handle_genre);	
+			$tmp_genres[$genre['genre_id']] = $genre['genre_name'];
+		}
+	}
+	
+	
+	// making sure we're having only unique tags
+	$tags = array_unique($tmp_tags);
+	
+	// prepare html string with the unique tags for this user	
+	foreach($tags as $key=&gt;$val) {
+		$tag_string .= &quot;&lt;li&gt;&lt;a href=\&quot;artiesten/tag.php?tag=$val\&quot; title='bekijk meer nummers met trefwoord $val'&gt;$val&lt;/a&gt; &lt;/li&gt;&quot;;
+	}
+	
+	// making sure we're having only unique genres
+	$genres = array_unique($tmp_genres);
+	
+	// prepare html string with the unique tags for this user
+	foreach($genres as $key=&gt;$val) {
+		$genre_result .= &quot;&lt;li&gt;&lt;a href=\&quot;artiesten/genre.php?genre_id=$key\&quot; title='bekijk nummmers in het genre $val'&gt;$val&lt;/a&gt; &lt;/li&gt;&quot;;
+	}
+	
+			
+	
+
+	// if there is no profile available, than say so :)
+	if($showprofile) {
+		require 'profile_view.php';
+	} else {	
+		require 'noprofile.php';	
+	}
+	
+
+?&gt;
+		
+  

Added: trunk/sidebar.php
===================================================================
--- trunk/sidebar.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/sidebar.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,8 @@
+&lt;?php 
+    if(!$_SESSION['logged_in']) {
+        require_once(&quot;not_logged_in_menu.php&quot;);
+    } else {
+        require_once(&quot;logged_in_menu.php&quot;);
+    }
+?&gt;
+&lt;div id=&quot;onderlogin&quot;&gt;&lt;/div&gt;

Added: trunk/simTESTER.php
===================================================================
--- trunk/simTESTER.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/simTESTER.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,320 @@
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
+        &quot;<A HREF="http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-transitional.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
+
+&lt;head&gt;
+&lt;title&gt;Simuze&lt;/title&gt;
+&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=ISO-8859-1&quot; /&gt; 
+&lt;base href=&quot;<A HREF="http://simuze.nl/live/">http://simuze.nl/live/</A>&quot;&gt;&lt;/base&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/lib.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/sendit.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/tcells.js&quot;&gt;&lt;/script&gt;
+
+
+&lt;style type=&quot;text/css&quot; media=&quot;all&quot;&gt;
+		@import &quot;mainstyle.css&quot;;
+		@import &quot;forms.css&quot;;
+	&lt;/style&gt;
+
+&lt;/head&gt;
+
+&lt;body onload=&quot;stripe('playlist', '#F7F3DF', '#EDD8BE');&quot;&gt;
+	
+
+&lt;div id=&quot;horizon&quot;&gt;
+	&lt;div id=&quot;wrapper&quot;&gt;
+		&lt;div id=&quot;header&quot;&gt;
+			&lt;div id=&quot;hoofdbar&quot;&gt;&lt;a href=&quot;help.php&quot; title=&quot;hulp nodig?&quot; class=&quot;help&quot;&gt;help?&lt;/a&gt;&lt;/div&gt;
+			&lt;div id=&quot;hoofdmenu&quot;&gt;
+			  &lt;ul&gt;  	
+			  	&lt;li&gt;&lt;img class=&quot;shadow&quot; src=&quot;img/images/shadow.gif&quot; /&gt;&lt;/li&gt;
+
+				&lt;li id=&quot;current&quot;&gt;&lt;a href=&quot;index.php&quot;&gt;&lt;span&gt;start&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li id=&quot;&quot;&gt;&lt;a href=&quot;nieuws/index.php&quot;&gt;&lt;span&gt;nieuws&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li id=&quot;&quot;&gt;&lt;a href=&quot;artiesten/index.php&quot;&gt;&lt;span&gt;artiesten&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;!--&lt;li id=&quot;&quot;&gt;&lt;a href=&quot;hits/index.php&quot;&gt;&lt;span&gt;charts&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li id=&quot;&quot;&gt;&lt;a href=&quot;backstage/index.php&quot;&gt;&lt;span&gt;backstage&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;--&gt;
+			  &lt;/ul&gt;
+			  &lt;/div&gt;
+			  &lt;div id=&quot;searchveld&quot;&gt;
+				  &lt;form method=&quot;get&quot; id=&quot;searchform&quot; action=&quot;/live/index.php&quot;&gt;
+	
+				  &lt;div id=&quot;zoekdiv&quot;&gt;
+					&lt;input type=&quot;text&quot; name=&quot;s&quot; id=&quot;s&quot; /&gt;&lt;input type=&quot;image&quot; id=&quot;searchsubmit&quot; src=&quot;/live/img/images/zoekknop.gif&quot; alt=&quot;zoek&quot; value=&quot;true&quot;  /&gt;
+				&lt;/div&gt;
+					
+				&lt;/form&gt;
+
+			 &lt;/div&gt;
+			 
+			  &lt;div id=&quot;submenu&quot;&gt;
+				  &lt;ul&gt;  	
+					&lt;li&gt;&lt;img class=&quot;shadow&quot; src=&quot;img/images/shadow.gif&quot; /&gt;&lt;/li&gt;
+					&lt;li id=&quot;&quot;&gt;&lt;a href=&quot;oversimuze.php&quot;&gt;&lt;span&gt;over simuze&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&lt;li id=&quot;&quot;&gt;&lt;a href=&quot;faq.php&quot;&gt;&lt;span&gt;faq&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&lt;li id=&quot;&quot;&gt;&lt;a href=&quot;tips.php&quot;&gt;&lt;span&gt;tips en tools&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				  &lt;/ul&gt;
+			  &lt;/div&gt;
+
+			  &lt;div id=&quot;ondersubmenu&quot;&gt;&lt;/div&gt;
+		&lt;/div&gt;
+	
+
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				
+					&lt;div id=&quot;uitleg&quot;&gt;
+                        uitleg div
+                    &lt;/div&gt;
+					
+				&lt;div id=&quot;kolom1&quot;&gt;
+					&lt;div id=&quot;nieuwskopjes&quot;&gt;	
+					&lt;h1&gt;Welkom bij Simuze!&lt;/h1&gt;
+					&lt;p class=&quot;small&quot;&gt;
+					Muzikant of muziekliefhebber? Ontdek nieuwe muziek en ontmoet anderen met dezelfe muzieksmaak! Je kunt de muziek op Simuze gratis uitwisselen, of remixen en verder bewerken. 
+					
+					&lt;/p&gt;
+
+					
+					&lt;p class=&quot;small&quot;&gt;
+						&lt;ul&gt;
+&lt;li&gt;&lt;a href=&quot;<A HREF="http://nl.creativecommons.org/nieuws/?p=49">http://nl.creativecommons.org/nieuws/?p=49</A>&quot;&gt;Yahoo! en Creative Commons&lt;/a&gt;&lt;/li&gt;
+&lt;li&gt;&lt;a href=&quot;<A HREF="http://nl.creativecommons.org/nieuws/?p=48">http://nl.creativecommons.org/nieuws/?p=48</A>&quot;&gt;Creative Commons Europe Meeting&lt;/a&gt;&lt;/li&gt;
+&lt;li&gt;&lt;a href=&quot;<A HREF="http://nl.creativecommons.org/nieuws/?p=47">http://nl.creativecommons.org/nieuws/?p=47</A>&quot;&gt;Green Pepper Magazine onder CC licentie.&lt;/a&gt;&lt;/li&gt;
+&lt;li&gt;&lt;a href=&quot;<A HREF="http://nl.creativecommons.org/nieuws/?p=46">http://nl.creativecommons.org/nieuws/?p=46</A>&quot;&gt;1st European Creative Commons meeting&lt;/a&gt;&lt;/li&gt;
+&lt;li&gt;&lt;a href=&quot;<A HREF="http://nl.creativecommons.org/nieuws/?p=44">http://nl.creativecommons.org/nieuws/?p=44</A>&quot;&gt;Stageplaats bij Creative Commons Nederland&lt;/a&gt;&lt;/li&gt;
+&lt;/ul&gt;
+					&lt;/p&gt;
+
+					&lt;/div&gt;
+				&lt;/div&gt;
+				
+				&lt;div id=&quot;bar1&quot;&gt;&lt;!-- &lt;img src=&quot;img/images/meerweten.gif&quot; /&gt; --&gt;&lt;/div&gt;
+	
+				&lt;div id=&quot;kolom2&quot;&gt;
+					
+					&lt;div class=&quot;kopjelinks_roundcont&quot;&gt;
+						&lt;div id=&quot;uitgelicht_kopje&quot;&gt;&lt;/div&gt;
+						
+						hier komt nog wat leuks
+						
+						&lt;div class=&quot;kopjelinks_onder&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+				
+					&lt;div class=&quot;kopjerechts_roundcont&quot;&gt;
+
+						&lt;div id=&quot;nieuwkomers_kopje&quot;&gt;&lt;/div&gt;
+							
+						&lt;table border=&quot;0&quot;&gt;
+						
+						&lt;tr&gt;
+							&lt;td&gt;Omschrijving over een persoon of een nummer of een album?&lt;/td&gt;
+							&lt;td&gt;&lt;img alt=&quot;default&quot; src=&quot;media/avatar/default/default_avatar40x30.gif&quot; /&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+						
+						&lt;tr&gt;
+							&lt;td&gt;Omschrijving over een persoon of een nummer of een album?&lt;/td&gt;
+
+							&lt;td&gt;&lt;img alt=&quot;default&quot; src=&quot;media/avatar/default/default_avatar40x30.gif&quot; /&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;tr&gt;
+							&lt;td&gt;Omschrijving over een persoon of een nummer of een album?&lt;/td&gt;
+							&lt;td&gt;&lt;img alt=&quot;default&quot; src=&quot;media/avatar/default/default_avatar40x30.gif&quot; /&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;tr&gt;
+							&lt;td&gt;Omschrijving over een persoon of een nummer of een album?&lt;/td&gt;
+
+							&lt;td&gt;&lt;img alt=&quot;default&quot; src=&quot;media/avatar/default/default_avatar40x30.gif&quot; /&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+						&lt;tr&gt;
+							&lt;td&gt;Omschrijving over een persoon of een nummer of een album?&lt;/td&gt;
+							&lt;td&gt;&lt;img alt=&quot;default&quot; src=&quot;media/avatar/default/default_avatar40x30.gif&quot; /&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+						
+						&lt;/table&gt;
+						
+						&lt;div class=&quot;kopjerechts_onder&quot;&gt;&lt;/div&gt;
+
+					&lt;/div&gt;	
+					extra text gewoon voor de show &lt;br /&gt;&lt;br /&gt;
+				&lt;/div&gt;	
+				
+				&lt;div id=&quot;bar2&quot;&gt;
+					&lt;div id=&quot;bar2_links&quot;&gt;div links&lt;/div&gt;
+					&lt;div id=&quot;bar2_rechts&quot;&gt;&lt;p class=&quot;red&quot;&gt;Klik op de &lt;b&gt;Artiest&lt;/b&gt; voor meer informatie over de desbetreffende artiest.&lt;/p&gt;&lt;/div&gt;
+				&lt;/div&gt;
+
+				
+				&lt;div id=&quot;kolom3&quot;&gt;
+					&lt;div class=&quot;downloads_roundcont&quot;&gt;
+						&lt;div id=&quot;topdownloads_kopje&quot;&gt;&lt;/div&gt;
+						&lt;p&gt;Hieronder vind je de top downloads van Simuze. &lt;/p&gt;
+						&lt;table id=&quot;playlist&quot; cellspacing=&quot;0&quot;&gt;
+								&lt;tr&gt;
+									&lt;td&gt; &lt;/td&gt;
+									&lt;td&gt;&lt;b&gt;Song&lt;/b&gt;&lt;/td&gt;
+									&lt;td&gt;&lt;b&gt;Artiest:&lt;/b&gt;&lt;/td&gt;
+									&lt;td&gt;&lt;b&gt;Licentie&lt;/b&gt;&lt;/td&gt;
+									&lt;td&gt;&lt;b&gt;Grootte&lt;/b&gt;&lt;/td&gt;
+									&lt;td&gt;&lt;b&gt;Actie&lt;/b&gt;&lt;/td&gt;
+								&lt;tr/&gt;
+							&lt;tbody&gt;
+								&lt;tr&gt;
+
+									&lt;td&gt;1&lt;/td&gt;
+									&lt;td&gt;Lost In The Plot&lt;/td&gt;
+									&lt;td&gt;&lt;a href=&quot;#&quot;&gt;The Dears&lt;/a&gt;&lt;/td&gt;
+									&lt;td&gt;Licentie&lt;/td&gt;
+									&lt;td&gt;5.3 MB&lt;/td&gt;
+									&lt;td&gt;&lt;img alt=&quot;download&quot; src=&quot;img/icons/dl.gif&quot; /&gt;&lt;img alt=&quot;stream&quot; src=&quot;img/icons/speaker.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan playlist&quot; src=&quot;img/icons/plus.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan ban-list&quot; src=&quot;img/icons/min.gif&quot; /&gt;&lt;/td&gt;
+
+								&lt;/tr&gt;
+								&lt;tr&gt;
+									&lt;td&gt;2&lt;/td&gt;
+									&lt;td&gt;Poison&lt;/td&gt;
+									&lt;td&gt;&lt;a href=&quot;#&quot;&gt;The Constantines&lt;/a&gt;&lt;/td&gt;
+									&lt;td&gt;Licentie&lt;/td&gt;
+									&lt;td&gt;5.3 MB&lt;/td&gt;
+
+									&lt;td&gt;&lt;img alt=&quot;download&quot; src=&quot;img/icons/dl.gif&quot; /&gt;&lt;img alt=&quot;stream&quot; src=&quot;img/icons/speaker.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan playlist&quot; src=&quot;img/icons/plus.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan ban-list&quot; src=&quot;img/icons/min.gif&quot; /&gt;&lt;/td&gt;
+								&lt;/tr&gt;
+								&lt;tr&gt;
+									&lt;td&gt;3&lt;/td&gt;
+									&lt;td&gt;Plea From A Cat Named Virtute&lt;/td&gt;
+									&lt;td&gt;&lt;a href=&quot;#&quot;&gt;The Weakerthans&lt;/a&gt;&lt;/td&gt;
+									&lt;td&gt;&lt;img alt=&quot;download&quot; src=&quot;img/icons/by.gif&quot; /&gt;&lt;img alt=&quot;download&quot; src=&quot;img/icons/nc.gif&quot; /&gt;&lt;img alt=&quot;download&quot; src=&quot;img/icons/sa.gif&quot; /&gt;&lt;/td&gt;
+
+									&lt;td&gt;5.3 MB&lt;/td&gt;
+									&lt;td&gt;&lt;img alt=&quot;download&quot; src=&quot;img/icons/dl.gif&quot; /&gt;&lt;img alt=&quot;stream&quot; src=&quot;img/icons/speaker.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan playlist&quot; src=&quot;img/icons/plus.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan ban-list&quot; src=&quot;img/icons/min.gif&quot; /&gt;&lt;/td&gt;
+								&lt;/tr&gt;
+								&lt;tr&gt;
+									&lt;td&gt;4&lt;/td&gt;
+									&lt;td&gt;Melissa Louise&lt;/td&gt;
+									&lt;td&gt;Chixdiggit!&lt;/td&gt;
+
+									&lt;td&gt;Licentie&lt;/td&gt;
+									&lt;td&gt;5.3 MB&lt;/td&gt;
+									&lt;td&gt;&lt;img alt=&quot;download&quot; src=&quot;img/icons/dl.gif&quot; /&gt;&lt;img alt=&quot;stream&quot; src=&quot;img/icons/speaker.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan playlist&quot; src=&quot;img/icons/plus.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan ban-list&quot; src=&quot;img/icons/min.gif&quot; /&gt;&lt;/td&gt;
+								&lt;/tr&gt;
+
+								&lt;tr&gt;
+									&lt;td&gt;5&lt;/td&gt;
+									&lt;td&gt;Living Room&lt;/td&gt;
+
+									&lt;td&gt;Tegan And Sara&lt;/td&gt;
+									&lt;td&gt;Licentie&lt;/td&gt;
+									&lt;td&gt;5.3 MB&lt;/td&gt;
+									&lt;td&gt;&lt;img alt=&quot;download&quot; src=&quot;img/icons/dl.gif&quot; /&gt;&lt;img alt=&quot;stream&quot; src=&quot;img/icons/speaker.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan playlist&quot; src=&quot;img/icons/plus.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan ban-list&quot; src=&quot;img/icons/min.gif&quot; /&gt;&lt;/td&gt;
+								&lt;/tr&gt;
+								&lt;tr&gt;
+									&lt;td&gt;6&lt;/td&gt;
+
+									&lt;td&gt;Speed&lt;/td&gt;
+									&lt;td&gt;Bran Van 3000&lt;/td&gt;
+									&lt;td&gt;Licentie&lt;/td&gt;
+									&lt;td&gt;5.3 MB&lt;/td&gt;
+									&lt;td&gt;&lt;img alt=&quot;download&quot; src=&quot;img/icons/dl.gif&quot; /&gt;&lt;img alt=&quot;stream&quot; src=&quot;img/icons/speaker.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan playlist&quot; src=&quot;img/icons/plus.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan ban-list&quot; src=&quot;img/icons/min.gif&quot; /&gt;&lt;/td&gt;
+								&lt;/tr&gt;
+								&lt;tr&gt;
+
+									&lt;td&gt;7&lt;/td&gt;
+									&lt;td&gt;Fast Money Blessing&lt;/td&gt;
+									&lt;td&gt;King Cobb Steelie&lt;/td&gt;
+									&lt;td&gt;Licentie&lt;/td&gt;
+									&lt;td&gt;5.3 MB&lt;/td&gt;
+									&lt;td&gt;&lt;img alt=&quot;download&quot; src=&quot;img/icons/dl.gif&quot; /&gt;&lt;img alt=&quot;stream&quot; src=&quot;img/icons/speaker.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan playlist&quot; src=&quot;img/icons/plus.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan ban-list&quot; src=&quot;img/icons/min.gif&quot; /&gt;&lt;/td&gt;
+
+								&lt;/tr&gt;
+						
+								&lt;tr&gt;
+									&lt;td&gt;8&lt;/td&gt;
+									&lt;td&gt;Sore&lt;/td&gt;
+									&lt;td&gt;Buck 65&lt;/td&gt;
+									&lt;td&gt;Licentie&lt;/td&gt;
+									&lt;td&gt;5.3 MB&lt;/td&gt;
+
+									&lt;td&gt;&lt;img alt=&quot;download&quot; src=&quot;img/icons/dl.gif&quot; /&gt;&lt;img alt=&quot;stream&quot; src=&quot;img/icons/speaker.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan playlist&quot; src=&quot;img/icons/plus.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan ban-list&quot; src=&quot;img/icons/min.gif&quot; /&gt;&lt;/td&gt;
+								&lt;/tr&gt;
+								&lt;tr&gt;
+									&lt;td&gt;9&lt;/td&gt;
+									&lt;td&gt;Love Travel&lt;/td&gt;
+									&lt;td&gt;Danko Jones&lt;/td&gt;
+									&lt;td&gt;Licentie&lt;/td&gt;
+
+									&lt;td&gt;5.3 MB&lt;/td&gt;
+									&lt;td&gt;&lt;img alt=&quot;download&quot; src=&quot;img/icons/dl.gif&quot; /&gt;&lt;img alt=&quot;stream&quot; src=&quot;img/icons/speaker.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan playlist&quot; src=&quot;img/icons/plus.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan ban-list&quot; src=&quot;img/icons/min.gif&quot; /&gt;&lt;/td&gt;
+									&lt;/tr&gt;
+								&lt;tr&gt;
+									&lt;td&gt;10&lt;/td&gt;
+									&lt;td&gt;You Never Let Me Down&lt;/td&gt;
+									&lt;td&gt;Furnaceface&lt;/td&gt;
+									&lt;td&gt;Licentie&lt;/td&gt;
+
+									&lt;td&gt;5.3 MB&lt;/td&gt;
+									&lt;td&gt;&lt;img alt=&quot;download&quot; src=&quot;img/icons/dl.gif&quot; /&gt;&lt;img alt=&quot;stream&quot; src=&quot;img/icons/speaker.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan playlist&quot; src=&quot;img/icons/plus.gif&quot; /&gt;&lt;img alt=&quot;voeg toe aan ban-list&quot; src=&quot;img/icons/min.gif&quot; /&gt;&lt;/td&gt;
+								&lt;/tr&gt;	
+							&lt;/tbody&gt;
+							
+						&lt;/table&gt;
+							
+						&lt;div class=&quot;downloads_roundbottom&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;
+				&lt;/div&gt;				
+			&lt;/div&gt;
+
+		&lt;/div&gt;
+		
+&lt;div id=&quot;sidebar&quot;&gt;
+	&lt;div id=&quot;login&quot;&gt;
+    
+	&lt;p class=&quot;small_white&quot;&gt;
+    	&lt;a href=&quot;/live/lost.php&quot; class=&quot;rood&quot;&gt;wachtwoord vergeten?&lt;/a&gt;
+	&lt;/p&gt;
+    &lt;br /&gt;
+
+    &lt;p class=&quot;small&quot;&gt;
+        Nieuw bij Simuze?	
+    &lt;/p&gt;
+    &lt;a href=&quot;/live/register.php&quot;&gt;&lt;h1 class=&quot;small_red&quot;&gt;Wordt lid!&lt;/h1&gt;&lt;/a&gt;
+&lt;/div&gt;
+&lt;div id=&quot;onderlogin&quot;&gt;&lt;/div&gt;
+
+
+
+
+
+&lt;/div&gt;
+		&lt;div class=&quot;clearing&quot;&gt;&nbsp;&lt;/div&gt;
+
+		&lt;div id=&quot;footer&quot;&gt;
+		   &lt;br /&gt;&lt;a href=&quot;colofon.php#copyright&quot; class=&quot;voet&quot; title=&quot;Sommige rechten voorbehouden..&quot;&gt;&copy; StOM 2005&lt;/a&gt;
+		&lt;br /&gt;&lt;a href=&quot;colofon.php&quot; title=&quot;colofon&quot; class=&quot;voet&quot;&gt;colofon&lt;/a&gt; |&lt;a href=&quot;disclaimer.php&quot; title=&quot;disclaimer&quot; class=&quot;voet&quot;&gt;disclaimer&lt;/a&gt;
+     
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/div&gt;
+
+&lt;!--
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-sa/2.0/nl/">http://creativecommons.org/licenses/by-nc-sa/2.0/nl/</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-sa/2.0/nl/">http://creativecommons.org/licenses/by-nc-sa/2.0/nl/</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Notice">http://web.resource.org/cc/Notice</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Attribution">http://web.resource.org/cc/Attribution</A>&quot; /&gt;
+   &lt;prohibits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/CommercialUse">http://web.resource.org/cc/CommercialUse</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/ShareAlike">http://web.resource.org/cc/ShareAlike</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+
+&lt;/body&gt;
+&lt;/html&gt;
+

Added: trunk/simplemailer.php
===================================================================
--- trunk/simplemailer.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/simplemailer.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,38 @@
+&lt;?php
+require_once(&quot;inc/class.phpmailer.php&quot;);
+
+/* CHANGE ME!! */
+$mailinglist = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at simuze.nl</A>&quot;; /* subscribtion address, NOTE mailinglistname DASH REQUEST
+
+/* DO NOT EDIT ANYTHING BELOW THIS LINE!! */
+if($_POST['email'] !=&quot;&quot; &amp;&amp; $_POST['send_true_url'] !=&quot;&quot; &amp;&amp; $_POST['send_false_url'] !=&quot;&quot; )
+{
+    
+    $send_true_url      =    $_POST['send_true_url'];
+    $send_false_url     =    $_POST['send_false_url'];
+    $subname            =    $_POST['email'];
+    $comments           =    $_POST['comments'];	
+    
+    $mail = new PHPMailer();
+    $mail-&gt;IsSendmail();
+    $mail-&gt;AddAddress($mailinglist);
+    $mail-&gt;FromName = $subname;
+    $mail-&gt;From = $subname;
+    $mail-&gt;Subject = &quot;via de site&quot;;
+    $mail-&gt;Body = $comments;
+    $mail-&gt;WordWrap = 100;
+    
+    if(!$mail-&gt;Send())
+    {
+        //redirect in case of problems with sending the mail
+       header(&quot;Location: $send_false_url&quot;);
+    }
+    else
+    {
+        //redirect in case of succesfull sending the mail
+        header(&quot;Location: $send_true_url&quot;);
+   }
+
+}
+
+?&gt;

Added: trunk/simuze_helpen.php
===================================================================
--- trunk/simuze_helpen.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/simuze_helpen.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,84 @@
+&lt;?php require_once(&quot;template_header.php&quot;);?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Simuze helpen?&lt;/h1&gt;
+				
+				&lt;p class=&quot;space&quot;&gt; 
+					Simuze heeft in haar korte bestaan al heel wat transformaties meegemaakt. Van relatief klein afstudeerproject in de stoppenkast 
+					naar een eigen server bij XSALL met een semi geautmatiseerd muziek upload systeem. Van presentaties op school tot presentaties in India.
+					We willen heel graag dat Simuze zo door blijft gaan en steeds beter wordt. Met zoveel mogelijk verschillende soorten muziek. 
+					Van salsa tot aan death metal. Alle muziek heeft een bestaansrecht op Simuze. 
+					Simuze moet de plek worden waar je muziek kan ontdekken. Simuze moet de plek worden waar muzikanten elkaar ontmoeten, samenwerken en elkaar's werk remixen.
+					Simuze wil de rol van de bekende massamedia als promotiekanaal overnemen. Simuze zal festivals organiseren om meer promotie en inkomsten voor artiesten te genereren. 
+					Bij Simuze heb je de mogelijkheid een donatie te doen aan de artiesten die je goed vindt. Dit zijn een greep uit
+					de ide&euml;en die we hebben over de toekomst van Simuze. Om dit en meer te kunnen bereiken hebben we jouw hulp nodig. 
+				&lt;/p&gt;
+					&lt;h1 class=&quot;small&quot;&gt;Hoe kan ik helpen dan?&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt; 
+					Je kan Simuze op heel veel verschillende manieren helpen. Om je een idee te geven:
+					Je &lt;a href=&quot;simuze_helpen.php#feedback&quot; title=&quot;op- en aanmerkingen geven&quot;&gt;op- en aanmerkingen door te sturen&lt;/a&gt; om het nog leuker of beter te maken.
+					Zelf meehelpen met &lt;a href=&quot;simuze_helpen.php#bouwen&quot; title=&quot;bouwen aan Simuze&quot;&gt;bouwen aan Simuze&lt;/a&gt;. 
+					&lt;a href=&quot;simuze_helpen.php#schrijven&quot; title=&quot;schrijven voor Simuze&quot;&gt;Leuke stukjes schrijven&lt;/a&gt; over bijvoorbeeld muziek, Auteursrecht
+					optredens, cds/dvds/downloads en de muziekindustrie. &lt;a href=&quot;simuze_helpen.php#promoten&quot; title=&quot;Simuze promoten&quot;&gt;Gaan flyeren&lt;/a&gt; bij concerten
+					en festivals of &lt;a href=&quot;simuze_helpen.php#promoten&quot; title=&quot;Simuze promoten&quot;&gt;het plaatsen van buttons op je website&lt;/a&gt; 
+					om aan te geven dat je Simuze een goed initatief vindt. Uiteraard, je eigen muziek onder Creative Commons licentie op Simuze plaatsen.
+					Je favoriete artiesten en bands wijzen op Simuze en Creative Commons. &lt;a href=&quot;simuze_helpen.php#doneren&quot; title=&quot;Donaties geven aan Simuze&quot;&gt;
+					De bak met geld waar je niet weet wat je ermee aanmoet&lt;/a&gt; en je wilt een goed initatief zoals Simuze steunen of je zoekt een initatief 
+					om je wat geld wit te wassen ;). Je begrijpt er zijn enorm veel dingen die jij kan doen om Simuze beter te maken.
+					Het een kost wat meer moeite dan het andere maar alle kleine beetjes helpen. 
+				&lt;/p&gt;
+				
+				&lt;a name=&quot;feedback&quot;&gt;&lt;/a&gt;
+				&lt;h2&gt;Feedback geven&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt; 
+					Je kan feedback geven door een emailtje te sturen aan: feedback AT simuze PUNT nl te sturen of maak gebruik van het formulier hieronder:&lt;br /&gt;
+					&lt;form action=&quot;simplemailer.php&quot; method=&quot;post&quot;&gt;
+						je email:&lt;br/&gt; &lt;input type=&quot;text&quot; name=&quot;email&quot; class=&quot;form_tekstveld&quot; /&gt;&lt;br /&gt;
+						Je op- en aanmerkingen:&lt;br/&gt; 
+						&lt;textarea cols=&quot;30&quot; rows=&quot;8&quot; name=&quot;comments&quot;&gt;&lt;/textarea&gt;&lt;br /&gt;
+						&lt;input type=&quot;hidden&quot; name=&quot;send_true_url&quot; value=&quot;<A HREF="http://www.simuze.nl/live/index_1.php">http://www.simuze.nl/live/index_1.php</A>&quot;&gt;
+						&lt;input type=&quot;hidden&quot; name=&quot;send_false_url&quot; value=&quot;<A HREF="http://www.simuze.nl/live/index_0.php">http://www.simuze.nl/live/index_0.php</A>&quot;&gt;
+						&lt;input type=&quot;submit&quot; value=&quot;Verstuur je feedback&quot; class=&quot;form_tekstveld&quot; /&gt;
+					&lt;/form&gt;
+					
+				&lt;/p&gt;
+				&lt;br /&gt;&lt;br /&gt;
+				&lt;a name=&quot;bouwen&quot;&gt;&lt;/a&gt;
+				&lt;h2&gt;Bouwen aan Simuze&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt; 
+					Als je handig bent met code of vormgeving kun je aanmelden op de 
+					&lt;a href=&quot;<A HREF="http://www.simuze.nl/cgi-bin/mailman/listinfo/tech">http://www.simuze.nl/cgi-bin/mailman/listinfo/tech</A>&quot; title=&quot;aanmelden bij de techlijst&quot;&gt;techlijst&lt;/a&gt;. 
+					Stel je even voor en dan kun je daar overleggen wat je kan doen. 
+					Hou er rekening mee dat er  nerd talk overheen gaat. 
+					Laat dat je vooral niet afschrikken.
+				
+				&lt;/p&gt;
+				
+				&lt;a name=&quot;schrijven&quot;&gt;&lt;/a&gt;
+				&lt;h2&gt;Schrijven voor Simuze&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt; 
+					Iedereen kan stukjes schijven voor Simuze. Dat kan een interview zijn met een band of muzikanten, een review over een CD of een muziekstuk, of een column. Dit kan je allemaal doen bij &quot;&lt;a href=&quot;/live/backstage/index.php&quot;&gt;backstage&lt;/a&gt;&quot;. Er zijn een paar moderatoren die de boel in de gaten houden en dus jouw stuk moeten goedkeuren. Qua onderwerp ben je volledig vrij; als het maar enigszins relevant is aan muziek. Als je schrijven ZO leuk vind dat je graag ook een moderator zou willen worden en regelmatig iets zou willen schrijven voor Simuze, stuur dan even een mailtje naar &lt;a href=&quot;mailto:<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at simuze.nl</A>&quot;&gt;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">info at simuze.nl</A>&lt;/a&gt; en vertel wat over jezelf. 
+				&lt;/p&gt;
+				
+				
+				&lt;h2&gt;&lt;a name=&quot;promotie&quot;&gt;Simuze promoten&lt;/a&gt;&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt; 
+					Wil je graag meehelpen met het promoten van Simuze? Dat kan op verschillende manieren; Je kan Simuze &quot;buttons&quot; op je site plaatsen (die ook weer doorlinken naar Simuze). Of als je graag wat meer analoge arbeid wilt verrichten kan je natuurlijk helpen met het verspreiden van de Simuze flyers! Elke hulp is welkom: hoe meer zielen.... :)
+				
+				&lt;/p&gt;
+				
+				&lt;h2&gt;&lt;a name=&quot;doneren&quot;&gt;Geld doneren&lt;/a&gt;&lt;/h2&gt;
+				&lt;p class=&quot;space&quot;&gt;
+					&quot;Maar waar LEVEN jullie dan van?&quot;, horen we regelmatig... We willen Simuze boven alles een open en gratis community laten blijven. Maar om Simuze ook verder te kunnen onderhouden en ontwikkelen hebben we helaas ook geld nodig. Mocht je ons in die zin financieel willen ondersteunen dan kan je geld storten op girorek. 1691494 tnv Stichting Open Media te Nieuwegein. Als je meer dan 50 euro overmaakt sturen wij (zolang de voorraad strekt) je een t-shirt toe. Dus vergeet niet je adresgegevens en maat te vermelden bij de overmaking. Bedankt! 
+				
+				&lt;/p&gt;
+				
+				
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require_once(&quot;template_sidebar_footer.php&quot;);?&gt;
\ No newline at end of file

Added: trunk/sm-confirm.php
===================================================================
--- trunk/sm-confirm.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/sm-confirm.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,95 @@
+&lt;?php
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+
+$feedback = array();
+$log = array();
+$continue = false;
+//get input
+if($_POST['confirm_code']) {
+    //set vars
+    $uname        = strtolower(trim($_POST['uname']));
+    $pwd          = strtolower(trim($_POST['password']));
+    $confirm_code = strtolower(trim($_POST['confirm_code']));
+
+    //check input
+    if (!empty($uname) &amp;&amp; checkUsernameValid($uname)) {
+        if (!empty($pwd)&amp;&amp; checkPasswordValid($pwd)) {
+            if (!empty($confirm_code) &amp;&amp; CheckInputValid($confirm_code)) {
+                
+                //prepare b4 insert
+                $uname        = addslashes($uname);
+                $pwd          = addslashes($pwd);
+                $confirm_code = addslashes($confirm_code);
+                
+                //crypt pwd
+                $pwd = CryptIt(&quot;md5&quot;,$pwd);
+                
+                
+                //check code existence  
+                $handle = qCheckCode($uname, $pwd, $confirm_code); 
+                //code exists, now copy signuop data from signup to user table
+                if($nr_rows = mysql_num_rows($handle) === 1) {
+                     $row = mysql_fetch_assoc($handle);
+                     $homedir = HOMEDIR . $row['uname'].&quot;/&quot;;
+                     $homedir_checked = HOMEDIR_CHECKED . $row['uname'].&quot;/&quot;;
+                     $homedir_public = HOMEDIR_PUBLIC . $row['uname'].&quot;/&quot;;
+                     $id = qInsertUser($row['uname'], $row['pwd'], $row['email'], $homedir, $homedir_checked, $homedir_public, QUOTA_SIZE, QUOTA_FILES, $row['signupdate']);
+                     if($id &gt; 0) {
+                         array_push($feedback, &quot;Bevestigen gelukt! Je kunt nu inloggen. Veel plezier met Simuze&quot;);
+                         $continue = true;
+                         //remove signup
+                         $del = qRemoveSignup($uname, $pwd);
+                         if($del == 1) {
+                             //signup removal succesfull
+                               
+                         }else {
+                             //signup removal failed
+                         }
+                     }else {
+                         array_push($log, &quot;Bevestigen mislukt! Niet toegevoegd aan database&quot;);
+                     }
+                 }else {
+                     array_push($log, &quot;Bevestigen mislukt! Database probleem&quot;);
+                 }
+            }else {
+                array_push($log, &quot;Bevestigen mislukt! De gebruikte code is ongeldig. Heb je de volledige link uit je email in de adresbalk staan?&quot;);
+            }
+        }else {
+            array_push($log, &quot;Bevestigen mislukt! Het wachtwoord die je hebt ingevuld is onjuist. Controleer of je misschien een typefout heb gemaakt?&quot;);
+        }
+    }else {
+        array_push($log, &quot;Bevestigen mislukt! De gebruikersnaam die je hebt ingevuld is onjuist. Controleer of je misschien een typefout heb gemaakt?&quot;);    
+    }
+} else {
+    array_push($log, &quot;Bevestigen mislukt! De gebruikte code is ongeldig of leeg. Heb je de volledige link uit je email in de adresbalk staan?&quot;);
+}
+?&gt;
+
+&lt;?php require_once(&quot;template_header.php&quot;);?&gt;
+&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Bevestiging&lt;/h1&gt;
+                    &lt;p class=&quot;space&quot;&gt;
+                    &lt;?php
+                    if($continue) {
+                        foreach($feedback as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        }
+                    } else {
+                         foreach($log as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        }
+                    }
+                    ?&gt;                
+                    &lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require_once(&quot;template_sidebar_footer.php&quot;);?&gt;
+
+
+

Added: trunk/sm-login.php
===================================================================
--- trunk/sm-login.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/sm-login.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,70 @@
+&lt;?php
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+
+
+//init feedback &amp; log var
+$feedback = array();
+$log = array();
+
+if($_POST['submit']) {
+    //process input
+    $uname = trim(strtolower($_POST['uname']));
+    $pwd   = trim(strtolower($_POST['password']));
+    
+    //check input
+    if (!empty($uname) &amp;&amp; checkUsernameValid($uname)) {
+        if (!empty($pwd) &amp;&amp; CheckPasswordValid($pwd)) {
+            
+            //prepare vars for checking against DB
+            $uname = addslashes($uname);
+            $pwd   = addslashes($pwd);
+            
+            $pwd = CryptIt(&quot;md5&quot;,$pwd);
+            
+            $handle = qGetUser($uname,$pwd);
+            if($nr_rows = mysql_num_rows($handle) == 1) {
+                $user = mysql_fetch_array($handle);
+                $uid  = CryptIt(&quot;md5&quot;,$user['uid']);
+                $name = $user['uname'];
+                //user found create a session and redirect
+                session_start();
+                $_SESSION['logged_in'] = true;
+                $_SESSION['name'] = $name;
+                $_SESSION['uid'] = $uid;
+				$_SESSION['level'] = $user['user_level'];
+                session_write_close();
+                header(&quot;Location: <A HREF="http://">http://</A>&quot; . $_SERVER['HTTP_HOST']. dirname($_SERVER['PHP_SELF']). &quot;/&quot; . LOGGED_IN_PAGE);
+            }else {
+                array_push($log, &quot;Login mislukt! Gebruikersnaam bestaat niet.&quot;);
+            }
+        } else {
+            array_push($log, &quot;Login mislukt! Wachtwoord is onjuist. Weet je het wachtwoord niet meer? Klik dan &lt;a href=\&quot;lost.php\&quot;&gt;hier&lt;/a&gt;&quot;);
+        }
+    } else {
+        array_push($log, &quot;Login mislukt! Gebruikersnaam is onjuist.&quot;); 
+    }
+}
+?&gt;
+
+&lt;?php require_once(&quot;template_header.php&quot;);?&gt;
+&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Login&lt;/h1&gt;
+                    &lt;p class=&quot;space&quot;&gt;
+                    &lt;?php
+                        foreach($log as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        }
+                    
+                    ?&gt;                
+                    &lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require_once(&quot;template_sidebar_footer.php&quot;);?&gt;
+
+

Added: trunk/sm-lost.php
===================================================================
--- trunk/sm-lost.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/sm-lost.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,97 @@
+&lt;?php
+require_once(&quot;template_header.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/class.phpmailer.php&quot;);
+
+//init feedback var
+$feedback = array();
+$log = array();
+$continue = false;
+
+//process input
+$uname = trim(strtolower($_POST['uname']));
+$email   = trim(strtolower($_POST['email']));
+
+
+//check input
+if (!empty($uname) &amp;&amp; CheckInputValid($uname)) {
+    if (!empty($email) &amp;&amp; CheckInputValid($email)) {
+         //prepare vars for checking against DB
+        $uname = addslashes($uname);
+        $email     = addslashes($email);
+     
+        //create a random pwd to be used as a new password
+        $nw_pwd = rndString();
+        $nw_pwd_enc = CryptIt(&quot;md5&quot;, $nw_pwd);
+        $handle = qUpdatePwd($uname,$email, $nw_pwd_enc);
+        
+        if(mysql_affected_rows() &gt; 0){
+               
+             //setting up the email body message
+            $msg = REGISTER_LOST_EMAIL_MSG;
+            $msg = str_replace( &quot;##NAME##&quot;, $uname, $msg);
+            $msg = str_replace( &quot;##PWD##&quot;, $nw_pwd, $msg);
+            
+            //sent BCC to
+            $bcc = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">bjorn at waag.org</A>&quot;;
+                           
+            //insert succesfull, send email for confirmation
+            $mail = new PHPMailer();
+            $mail-&gt;IsSendmail();
+            $mail-&gt;AddAddress($email);
+            $mail-&gt;AddBCC($bcc);
+            $mail-&gt;FromName = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">simuzerobot at simuze.com</A>&quot;;
+            $mail-&gt;From = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">simuzerobot at simuze.com</A>&quot;;
+            $mail-&gt;Subject = &quot;Simuze wachtwoord gewijzigd&quot;;
+            $mail-&gt;Body = $msg;
+            //$mail-&gt;WordWrap = 80;
+                
+            if(!$mail-&gt;Send())
+            {
+                array_push($log, 'email kon niet worden verzonden');
+            } else {
+                    //redirect in case of succesfull sending the mail
+                   // header(&quot;Location: $send_true_url&quot;);
+                array_push($feedback, 'wachtwoord is gewijzigd en wordt zo spoedig mogelijk naar je toegezonden');
+                $continue = true;
+            }
+        } else{
+            array_push($log, 'wachtwoord kon niet worden gewijzigd. Gebruikersnaam en/of emailadres is niet gevonden');
+        }
+    } else {
+        array_push($log, 'email vergeten in te vullen');
+    }
+} else {
+    array_push($log, 'gebruikersnaam vergeten in te vullen');
+
+}
+        
+
+?&gt;
+
+
+&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Wachtwoord vergeten?&lt;/h1&gt;
+                    &lt;p class=&quot;space&quot;&gt;
+                    &lt;?php
+                        if($continue) {
+                            foreach($feedback as $key=&gt;$val) {
+                                echo &quot;$val&quot;;
+                            }
+                        } else {
+                             foreach($log as $key=&gt;$val) {
+                                echo &quot;$val&quot;;
+                            }
+                        }
+                    ?&gt;  
+                    &lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require_once(&quot;template_sidebar_footer.php&quot;);?&gt;
+

Added: trunk/sm-nieuwsbrief.php
===================================================================
--- trunk/sm-nieuwsbrief.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/sm-nieuwsbrief.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,37 @@
+&lt;?php
+require(&quot;inc/class.phpmailer.php&quot;);
+
+/* CHANGE ME!! */
+$mailinglist = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">nieuwsbrief-request at simuze.nl</A>&quot;; /* subscribtion address, NOTE mailinglistname DASH REQUEST
+
+/* DO NOT EDIT ANYTHING BELOW THIS LINE!! */
+if(!empty($_POST['email'])&amp;&amp; !empty($_POST['send_true_url']) &amp;&amp; !empty($_POST['send_false_url']))
+{
+    
+    $send_true_url      =    $_POST['send_true_url'];
+    $send_false_url     =    $_POST['send_false_url'];
+    $subname            =    $_POST['email'];
+        
+    $mail = new PHPMailer();
+    $mail-&gt;IsSendmail();
+    $mail-&gt;AddAddress($mailinglist);
+    $mail-&gt;FromName = $subname;
+    $mail-&gt;From = $subname;
+    $mail-&gt;Subject = &quot;subscribe&quot;;
+    $mail-&gt;Body = &quot; &quot;;
+    $mail-&gt;WordWrap = 50;
+    
+    if(!$mail-&gt;Send())
+    {
+        //redirect in case of problems with sending the mail
+       header(&quot;Location: $send_false_url&quot;);
+    }
+    else
+    {
+        //redirect in case of succesfull sending the mail
+        header(&quot;Location: $send_true_url&quot;);
+   }
+
+}
+
+?&gt;


Property changes on: trunk/sm-nieuwsbrief.php
___________________________________________________________________
Name: svn:executable
   + 

Added: trunk/sm-register.php
===================================================================
--- trunk/sm-register.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/sm-register.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,146 @@
+&lt;?php
+// +----------------------------------------------------------------------+
+// | Simuze                                                               |
+// +----------------------------------------------------------------------+
+// | Copyright (c) 2005 Stichting Open Media or noted otherwise           |
+// +----------------------------------------------------------------------+
+// | License: See below code                                              |
+// +----------------------------------------------------------------------+
+// | Author(s): Bjorn Wijers &lt;bwijers[AT]bdisfunctional[DOT]net&gt;          |
+// |                                                                      |
+// +----------------------------------------------------------------------+
+//
+
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/class.phpmailer.php&quot;);
+
+//init 
+$continue = false;
+
+//init feedback var
+$feedback = array();
+
+//init log var
+$log = array();
+
+//process input
+$uname   = trim(strtolower($_POST['uname']));
+$email   = trim(strtolower($_POST['email']));
+$pwd     = trim(strtolower($_POST['password']));
+$pwd2    = trim(strtolower($_POST['password2']));
+
+
+//check if both passwords are the same, type and content
+//therefor the triple =!
+if($pwd === $pwd2){
+    if (!empty($uname) &amp;&amp; checkUsernameValid($uname)) {
+        if (!empty($email) &amp;&amp; CheckInputValid($email)) {
+            if (!empty($pwd) &amp;&amp; checkPasswordValid($pwd)) {
+                //all valid and checked
+              
+                //addslashes b4 insertion
+                $uname   = addslashes($uname);
+                $email   = addslashes($email);
+                $pwd    = addslashes($pwd);
+                //check if doubles exists          
+                $shandle   = qGetSignup($uname);
+                $uhandle   = qGetUser($uname,''); //check if username exists
+                if(($nr_rows = mysql_num_rows($shandle) &lt;= 0) &amp;&amp; ($nr_users = mysql_num_rows($uhandle) &lt;=0)) {
+                    //no double usernames, prepare user registration
+                    //encrypt pwd with md5 hash
+                    $pwd = CryptIt(&quot;md5&quot;,$pwd);
+                    //create confirm code
+                    srand(microtime() * 1000000);
+                    $code = $uname . time() . rand(1, 1000000);
+                    $confirm_code = CryptIt(&quot;md5&quot;,$code);
+                    //echo &quot;$confimr_code&quot;;
+                    //insert into db
+                    $id = qInsertSignup($uname,$email,$pwd,$confirm_code);
+                    //setting up the email body message
+                    $msg = REGISTER_EMAIL_MSG;
+                    $msg = str_replace( &quot;##NAME##&quot;, $uname, $msg);
+                    $msg = str_replace( &quot;##HASH##&quot;, $confirm_code, $msg);
+                    
+                    //sent BCC to
+                    $bcc = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">bjorn at waag.org</A>&quot;;
+    
+                                   
+                    if($id &gt; 0) {
+                        //insert succesfull, send email for confirmation
+                        $mail = new PHPMailer();
+                        $mail-&gt;IsSendmail();
+                        $mail-&gt;AddAddress($email);
+                        $mail-&gt;AddBCC($bcc);
+                        $mail-&gt;FromName = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">simuzerobot at simuze.com</A>&quot;;
+                        $mail-&gt;From = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">simuzerobot at simuze.com</A>&quot;;
+                        $mail-&gt;Subject = &quot;Registratie Simuze.nl&quot;;
+                        $mail-&gt;Body = $msg;
+                        //$mail-&gt;WordWrap = 72;
+                        
+                        if(!$mail-&gt;Send())
+                        {
+                            //redirect in case of problems with sending the mail
+                           //header(&quot;Location: $send_false_url&quot;);
+                           array_push($log, &quot;Registratie mislukt! Email is niet verzonden&quot;);
+                        }
+                        else
+                        {
+                            //redirect in case of succesfull sending the mail
+                           // header(&quot;Location: $send_true_url&quot;);
+                           $continue = true;
+                           array_push($feedback, &quot;Registratie geslaagd! Er wordt zo spoedig mogelijk een email met verdere aanwijzingen naar $email gestuurd.&quot;);
+                        }
+                               
+                    } else {
+                        //insert failed
+                        array_push($log, &quot;Registratie mislukt! Registratie is niet niet aan database toegevoegd&quot;);
+                    }
+                    
+                } else {
+                    //double found
+                    array_push($log, &quot;Registratie mislukt! De gebruikersnaam die je hebt ingevoerd is niet meer vrij. Probeer een variatie.&quot;);
+                }   
+            } else {
+             //pwd invalid
+             array_push($log, &quot;Registratie mislukt! Het wachtwoord wat je hebt ingevuld is tekort of bevat ongeldige tekens. Geldige tekens zijn cijfers, letters en: <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">-_ at .</A> Minimale lengte is 6 tekens&quot;);
+            }
+        } else {
+        //email invalid
+        array_push($log, &quot;Registratie mislukt! Het emailadres wat je hebt ingevuld bevat ongeldige tekens. Een email adres bestaat meestal uit: <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">gebruikersnaam at domein.extensie</A>&quot;);
+        }
+    } else {
+    //uname invalid
+    array_push($log, &quot;Registratie mislukt! De gebruikersnaam die je hebt ingevuld is tekort of bevat ongeldige tekens. Geldige tekens zijn cijfers en letters. Minimale lengte is 4 tekens. Gebruikersnaam moet beginnen met een letter&quot;);
+    }
+} else {
+    array_push($log, &quot;Registratie mislukt! Wachtwoorden zijn niet gelijk&quot;);
+}
+?&gt;
+
+&lt;?php require_once(&quot;template_header.php&quot;);?&gt;
+&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Registratie&lt;/h1&gt;
+                    &lt;p class=&quot;space&quot;&gt;
+                    &lt;?php
+                    if($continue) {
+                        foreach($feedback as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        }
+                    } else {
+                         foreach($log as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        }
+                    }
+                    ?&gt;                
+                    &lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require_once(&quot;template_sidebar_footer.php&quot;);?&gt;
+
+

Added: trunk/sm-search.php
===================================================================
--- trunk/sm-search.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/sm-search.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,27 @@
+&lt;?php 
+	$query = $_POST['s'];
+?&gt;
+&lt;?php require 'template_header_search.php'; ?&gt;
+&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Zoeken&lt;/h1&gt;
+				&lt;p&gt; Op dit moment doorzoeken we dmv Google in de site.&lt;/p&gt;
+					&lt;!-- SiteSearch Google --&gt;
+					&lt;form method=get action=&quot;<A HREF="http://www.google.com/search">http://www.google.com/search</A>&quot; name=&quot;Google&quot;&gt;
+						&lt;img src=&quot;<A HREF="http://www.google.com/logos/Logo_40wht.gif">http://www.google.com/logos/Logo_40wht.gif</A>&quot; /&gt;  
+						&lt;input type=&quot;hidden&quot; name=&quot;ie&quot; value=&quot;UTF-8&quot;&gt;
+						&lt;input type=&quot;hidden&quot; name=&quot;oe&quot; value=&quot;UTF-8&quot;&gt;
+						&lt;input type=&quot;text&quot; name=&quot;q&quot; size=&quot;15&quot; maxlength=&quot;255&quot; value=&quot;&lt;?php echo $query?&gt;&quot;&gt;
+						&lt;input type=&quot;submit&quot; name=&quot;btng&quot; value=&quot;Zoeken&quot;&gt;
+						&lt;input type=&quot;hidden&quot; name=&quot;domains&quot; value=&quot;<A HREF="http://www.simuze.nl">http://www.simuze.nl</A>&quot;&gt;
+						&lt;input type=&quot;radio&quot; name=&quot;sitesearch&quot; value=&quot;<A HREF="http://www.simuze.nl">http://www.simuze.nl</A>&quot; checked class=&quot;hidden&quot;&gt;
+					&lt;/form&gt;
+					&lt;!-- SiteSearch Google --&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+
+
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;

Added: trunk/sql/sm_system.sql
===================================================================
--- trunk/sql/sm_system.sql	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/sql/sm_system.sql	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,329 @@
+-- phpMyAdmin SQL Dump
+-- version 2.6.2
+-- <A HREF="http://www.phpmyadmin.net">http://www.phpmyadmin.net</A>
+-- 
+-- Host: localhost
+-- Generation Time: Oct 09, 2005 at 08:33 PM
+-- Server version: 4.0.24
+-- PHP Version: 4.3.10-16
+-- 
+-- Database: `sm_system`
+-- 
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `audio`
+-- 
+
+CREATE TABLE `audio` (
+  `audio_id` int(20) unsigned NOT NULL auto_increment,
+  `genre_id` int(11) unsigned NOT NULL default '0',
+  `cclicense_id` int(3) NOT NULL default '0',
+  `audio_type` enum('mp3','ogg') NOT NULL default 'mp3',
+  `audio_hi_path` varchar(255) NOT NULL default '',
+  `audio_lo_path` varchar(255) NOT NULL default '',
+  `audio_filename` varchar(255) NOT NULL default '',
+  `audio_title` varchar(255) NOT NULL default '',
+  `audio_artist` varchar(255) NOT NULL default '',
+  `audio_album` varchar(255) NOT NULL default '',
+  `audio_playtime` varchar(24) NOT NULL default '',
+  `audio_size` int(11) unsigned NOT NULL default '0',
+  `audio_status` enum('undefined','info_available','public','reject','return') NOT NULL default 'undefined',
+  `uid` int(11) unsigned NOT NULL default '0',
+  PRIMARY KEY  (`audio_id`)
+) TYPE=MyISAM AUTO_INCREMENT=509 ;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `audio_mood`
+-- 
+
+CREATE TABLE `audio_mood` (
+  `mood_selection_id` int(11) unsigned NOT NULL default '0',
+  `audio_id` int(11) unsigned NOT NULL default '0',
+  PRIMARY KEY  (`mood_selection_id`)
+) TYPE=MyISAM;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `audio_reference`
+-- 
+
+CREATE TABLE `audio_reference` (
+  `audio_id` int(11) NOT NULL default '0',
+  `reference_id` int(11) NOT NULL default '0',
+  KEY `audio_id` (`audio_id`)
+) TYPE=MyISAM;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `audio_tag`
+-- 
+
+CREATE TABLE `audio_tag` (
+  `audio_id` int(11) unsigned NOT NULL default '0',
+  `tag_id` int(11) unsigned NOT NULL default '0',
+  KEY `audio_id` (`audio_id`)
+) TYPE=MyISAM;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `cclicense`
+-- 
+
+CREATE TABLE `cclicense` (
+  `cclicense_id` int(3) NOT NULL auto_increment,
+  `cclicense_name` varchar(255) NOT NULL default '',
+  `cclicense_description` varchar(255) NOT NULL default '',
+  `cclicense_image_path` varchar(255) NOT NULL default '',
+  `cclicense_legal_url` varchar(255) NOT NULL default '',
+  `cclicense_human_url` varchar(255) NOT NULL default '',
+  `cclicense_lang` varchar(32) NOT NULL default 'nl',
+  `cclicense_by` enum('1','0') NOT NULL default '1',
+  `cclicense_commercial` enum('0','1') NOT NULL default '0',
+  `cclicense_derative` enum('0','1','2') NOT NULL default '0',
+  `cclicense_rdf` text NOT NULL,
+  PRIMARY KEY  (`cclicense_id`)
+) TYPE=MyISAM AUTO_INCREMENT=7 ;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `genre`
+-- 
+
+CREATE TABLE `genre` (
+  `genre_id` int(11) unsigned NOT NULL auto_increment,
+  `genre_name` varchar(255) NOT NULL default '',
+  `genre_omschrijving` text NOT NULL,
+  `genre_img` varchar(255) NOT NULL default '/live/img/images/live_musica.jpg',
+  PRIMARY KEY  (`genre_id`)
+) TYPE=MyISAM AUTO_INCREMENT=17 ;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `moderation_history`
+-- 
+
+CREATE TABLE `moderation_history` (
+  `audio_id` int(11) unsigned NOT NULL default '0',
+  `uid` int(11) unsigned NOT NULL default '0',
+  `moderation_id` int(11) unsigned NOT NULL auto_increment,
+  `moderation_date` timestamp(14) NOT NULL,
+  `moderation_status` enum('undefined','public','return','reject') NOT NULL default 'undefined',
+  `moderation_description` text NOT NULL,
+  PRIMARY KEY  (`moderation_id`)
+) TYPE=MyISAM AUTO_INCREMENT=398 ;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `moderation_queue`
+-- 
+
+CREATE TABLE `moderation_queue` (
+  `audio_id` int(11) unsigned NOT NULL default '0',
+  `moderation_queue_date` timestamp(14) NOT NULL
+) TYPE=MyISAM;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `moderator`
+-- 
+
+CREATE TABLE `moderator` (
+  `moderator_id` int(11) unsigned NOT NULL auto_increment,
+  `uid` int(11) unsigned NOT NULL default '0',
+  `genre_id` int(11) unsigned NOT NULL default '0',
+  `moderator_date` timestamp(14) NOT NULL,
+  PRIMARY KEY  (`moderator_id`)
+) TYPE=MyISAM AUTO_INCREMENT=17 ;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `mood_description`
+-- 
+
+CREATE TABLE `mood_description` (
+  `mood_description_id` int(11) unsigned NOT NULL auto_increment,
+  `mood_description_name` varchar(255) NOT NULL default '',
+  `mood_description_label1` varchar(255) NOT NULL default '',
+  `mood_description_label2` varchar(255) NOT NULL default '',
+  `mood_description_label3` varchar(255) NOT NULL default '',
+  `mood_description_label4` varchar(255) NOT NULL default '',
+  `mood_description_label5` varchar(255) NOT NULL default '',
+  `mood_description_value1` enum('0','1','2','-1','-2') NOT NULL default '0',
+  `mood_description_value2` enum('0','1','2','-1','-2') NOT NULL default '0',
+  `mood_description_value3` enum('0','1','2','-1','-2') NOT NULL default '0',
+  `mood_description_value4` enum('0','1','2','-1','-2') NOT NULL default '0',
+  `mood_description_value5` enum('0','1','2','-1','-2') NOT NULL default '0',
+  PRIMARY KEY  (`mood_description_id`)
+) TYPE=MyISAM AUTO_INCREMENT=6 ;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `mood_selection`
+-- 
+
+CREATE TABLE `mood_selection` (
+  `mood_selection_id` int(11) unsigned NOT NULL auto_increment,
+  `mood_description_id` int(11) unsigned NOT NULL default '0',
+  `mood_selection_value` enum('0','1','2','-1','-2') NOT NULL default '0',
+  PRIMARY KEY  (`mood_selection_id`)
+) TYPE=MyISAM AUTO_INCREMENT=2366 ;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `playlist`
+-- 
+
+CREATE TABLE `playlist` (
+  `user_ID` int(11) unsigned NOT NULL default '0',
+  `playlist_ID` int(11) unsigned NOT NULL auto_increment,
+  `playlist_title` varchar(255) NOT NULL default '',
+  `playlist_description` varchar(255) NOT NULL default '',
+  `playlist_path` varchar(255) NOT NULL default '',
+  `playlist_updatedate` timestamp(14) NOT NULL,
+  `playlist_creationdate` timestamp(14) NOT NULL default '00000000000000',
+  PRIMARY KEY  (`playlist_ID`)
+) TYPE=MyISAM AUTO_INCREMENT=63 ;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `playlist_audio`
+-- 
+
+CREATE TABLE `playlist_audio` (
+  `playlist_id` int(11) unsigned NOT NULL default '0',
+  `audio_id` int(11) unsigned NOT NULL default '0',
+  KEY `playlist_id` (`playlist_id`),
+  KEY `audio_id` (`audio_id`)
+) TYPE=MyISAM;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `playlist_blacklist`
+-- 
+
+CREATE TABLE `playlist_blacklist` (
+  `user_ID` int(11) unsigned NOT NULL default '0',
+  `audio_id` int(11) unsigned NOT NULL default '0'
+) TYPE=MyISAM;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `reference`
+-- 
+
+CREATE TABLE `reference` (
+  `reference_id` int(11) unsigned NOT NULL auto_increment,
+  `reference_name` varchar(255) NOT NULL default '',
+  `reference_index` varchar(255) NOT NULL default '',
+  PRIMARY KEY  (`reference_id`),
+  KEY `reference_name` (`reference_name`),
+  KEY `reference_index` (`reference_index`)
+) TYPE=MyISAM AUTO_INCREMENT=224 ;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `signup`
+-- 
+
+CREATE TABLE `signup` (
+  `signupID` int(25) NOT NULL auto_increment,
+  `uname` varchar(25) NOT NULL default '',
+  `pwd` varchar(32) NOT NULL default '',
+  `email` varchar(250) NOT NULL default '',
+  `confirmcode` varchar(32) NOT NULL default '',
+  `signupdate` timestamp(14) NOT NULL,
+  PRIMARY KEY  (`signupID`)
+) TYPE=MyISAM AUTO_INCREMENT=482 ;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `tag`
+-- 
+
+CREATE TABLE `tag` (
+  `tag_id` int(11) unsigned NOT NULL auto_increment,
+  `tag_name` varchar(255) NOT NULL default '',
+  PRIMARY KEY  (`tag_id`),
+  KEY `tag_name` (`tag_name`)
+) TYPE=MyISAM AUTO_INCREMENT=95 ;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `user`
+-- 
+
+CREATE TABLE `user` (
+  `uid` int(20) unsigned NOT NULL auto_increment,
+  `uname` varchar(25) NOT NULL default '',
+  `pwd` varchar(32) NOT NULL default '',
+  `email` varchar(250) NOT NULL default '',
+  `user_level` enum('1','2','3','4','5','6','7','8','9','10') NOT NULL default '1',
+  `homedir` varchar(255) NOT NULL default '',
+  `homedir_checked` varchar(255) NOT NULL default '',
+  `homedir_public` varchar(255) NOT NULL default '',
+  `quotasize` varchar(50) NOT NULL default '',
+  `quotafiles` varchar(50) NOT NULL default '',
+  `userdate` timestamp(14) NOT NULL,
+  `signupdate` timestamp(14) NOT NULL default '00000000000000',
+  PRIMARY KEY  (`uid`)
+) TYPE=MyISAM AUTO_INCREMENT=2411 ;
+
+-- --------------------------------------------------------
+
+-- 
+-- Table structure for table `user_profile`
+-- 
+
+CREATE TABLE `user_profile` (
+  `profileid` int(20) NOT NULL auto_increment,
+  `uid` int(20) NOT NULL default '0',
+  `firstname` varchar(50) NOT NULL default '',
+  `lastname` varchar(50) NOT NULL default '',
+  `artistname` varchar(50) NOT NULL default '',
+  `birthdate` date default NULL,
+  `zipcode` varchar(10) NOT NULL default '',
+  `location` varchar(50) NOT NULL default '',
+  `state` varchar(50) NOT NULL default '',
+  `bio` text NOT NULL,
+  `im_aim` varchar(255) NOT NULL default '',
+  `im_ichat` varchar(255) NOT NULL default '',
+  `im_icq` varchar(255) NOT NULL default '',
+  `im_jabber` varchar(255) NOT NULL default '',
+  `im_msn` varchar(255) NOT NULL default '',
+  `im_skype` varchar(255) NOT NULL default '',
+  `im_yahoo` varchar(255) NOT NULL default '',
+  `url_1` varchar(255) NOT NULL default '',
+  `url_2` varchar(255) NOT NULL default '',
+  `url_3` varchar(255) NOT NULL default '',
+  `musica_1` varchar(255) NOT NULL default '',
+  `musica_2` varchar(255) NOT NULL default '',
+  `musica_3` varchar(255) NOT NULL default '',
+  `must_listen` varchar(255) NOT NULL default '',
+  `must_read` varchar(255) NOT NULL default '',
+  `must_see` varchar(255) NOT NULL default '',
+  `must_visit` varchar(255) NOT NULL default '',
+  `avatar_filename` varchar(255) NOT NULL default '',
+  `avatar_filename_small` varchar(255) NOT NULL default '',
+  `avatar_path` varchar(255) NOT NULL default '',
+  PRIMARY KEY  (`profileid`)
+) TYPE=MyISAM AUTO_INCREMENT=171 ;

Added: trunk/submenu.php
===================================================================
--- trunk/submenu.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/submenu.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,75 @@
+&lt;?php
+
+$submenu_id = explode(&quot;/&quot;, trim($_SERVER['PHP_SELF']));
+
+//print_r($submenu_id);
+
+foreach($submenu_id as $key =&gt; $value)
+{
+$subtab = $submenu_id[2] ;
+$subtab2 = $submenu_id[3] ;
+
+	if (is_file(&quot;$subtab&quot;)) 
+	{
+		if($subtab == &quot;oversimuze.php&quot;)
+		{
+		$submenu_id1 = &quot;current&quot;; 
+		}
+		if($subtab == &quot;faq.php&quot;)
+		{
+		$submenu_id2 = &quot;current&quot;; 
+		}
+		if($subtab == &quot;leesvoer.php&quot;)
+		{
+		$submenu_id3 = &quot;current&quot;; 
+		}
+		if($subtab == &quot;allusers.php&quot;)
+		{
+		$submenu_id4 = &quot;current&quot;; 
+		}
+		if($subtab == &quot;simuze_helpen.php&quot;)
+		{
+		$submenu_id5 = &quot;current&quot;; 
+		}
+	} else if ($subtab == &quot;artiesten&quot;){
+			
+		if($subtab2 == &quot;overzicht.php&quot;)
+		{
+		$submenu_id5 = &quot;current&quot;; 
+		}
+		if($subtab2 == &quot;tag_overzicht.php&quot; || $subtab2 == &quot;tag.php&quot;)
+		{
+		$submenu_id6 = &quot;current&quot;; 
+		}
+		if($subtab2 == &quot;top.php&quot;)
+		{
+		$submenu_id7 = &quot;current&quot;; 
+		}
+	}
+	
+}	
+
+
+
+	if ($hoofdmenu_id1 == &quot;current&quot; || $hoofdmenu_id1 == &quot;current2&quot;  )
+	{
+		echo &quot;&lt;li id=\&quot;$submenu_id1\&quot;&gt;&lt;a href=\&quot;oversimuze.php\&quot;&gt;&lt;span&gt;over simuze&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;;
+		echo &quot;&lt;li id=\&quot;$submenu_id2\&quot;&gt;&lt;a href=\&quot;faq.php\&quot;&gt;&lt;span&gt;faq&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;;
+		echo &quot;&lt;li id=\&quot;$submenu_id3\&quot;&gt;&lt;a href=\&quot;leesvoer.php\&quot;&gt;&lt;span&gt;leesvoer&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;;
+		echo &quot;&lt;li id=\&quot;$submenu_id4\&quot;&gt;&lt;a href=\&quot;allusers.php\&quot;&gt;&lt;span&gt;leden overzicht&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;;
+		echo &quot;&lt;li id=\&quot;$submenu_id5\&quot;&gt;&lt;a href=\&quot;simuze_helpen.php\&quot;&gt;&lt;span&gt;simuze helpen?&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;;
+	}
+	
+	if ($hoofdmenu_id2 == &quot;current&quot; || $hoofdmenu_id2 == &quot;current2&quot;)
+	{
+		echo &quot;&lt;li&gt;&lt;a href=\&quot;nieuws/simuze.php\&quot;&gt;&lt;span&gt;over simuze&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;;
+	}
+	
+	if ($hoofdmenu_id3 == &quot;current&quot; || $hoofdmenu_id3 == &quot;current2&quot;)
+	{
+		echo&quot;&lt;li id=\&quot;$submenu_id5\&quot;&gt;&lt;a href=\&quot;artiesten/overzicht.php\&quot;&gt;&lt;span&gt;artiesten&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;;
+		echo&quot;&lt;li id=\&quot;$submenu_id6\&quot;&gt;&lt;a href=\&quot;artiesten/tag_overzicht.php\&quot;&gt;&lt;span&gt;trefwoorden&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;;
+		//echo&quot;&lt;li id=\&quot;$submenu_id7\&quot;&gt;&lt;a href=\&quot;artiesten/top.php\&quot;&gt;&lt;span&gt;top downloads&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;;
+	}
+?&gt;
+

Added: trunk/tableruler.html
===================================================================
--- trunk/tableruler.html	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/tableruler.html	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,62 @@
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; 
+&quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</A>&quot;&gt;
+&lt;html dir=&quot;ltr&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
+&lt;head&gt;
+	&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot; /&gt; 
+	&lt;title&gt;Row Rollover table demo&lt;/title&gt;
+	
+	&lt;style type=&quot;text/css&quot; media=&quot;all&quot;&gt;
+		@import &quot;mainstyle.css&quot;;
+		@import &quot;forms.css&quot;;
+	&lt;/style&gt;
+	&lt;script type=&quot;text/javascript&quot; src=&quot;js/tableruler.js&quot;&gt;&lt;/script&gt;
+	&lt;script type=&quot;text/javascript&quot;&gt;
+		window.onload=function(){tableruler();} 
+    &lt;/script&gt;
+&lt;/head&gt;
+&lt;body&gt;
+&lt;h1&gt;Tableruler Demos&lt;/h1&gt;
+
+
+
+&lt;h2&gt;Example with own ID&lt;/h2&gt;
+
+&lt;table class=&quot;ruler&quot; id=&quot;mytable&quot;&gt;
+
+
+&lt;tbody&gt;
+	&lt;tr&gt;
+		&lt;td&gt;Ladytron&lt;/td&gt;
+		&lt;td&gt;604&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td&gt;Ladytron&lt;/td&gt;
+		&lt;td&gt;Light and Magic&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td&gt;Fat Truckers&lt;/td&gt;
+		&lt;td&gt;Superbike (Maxi)&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td&gt;Kraftwerk&lt;/td&gt;
+		&lt;td&gt;Die Mensch-Maschine&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td&gt;Dopplereffekt&lt;/td&gt;
+		&lt;td&gt;Gesamtkunstwerk&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td&gt;Console&lt;/td&gt;
+		&lt;td&gt;14 Zero, Zero&lt;/td&gt;
+	&lt;/tr&gt;
+&lt;/tbody&gt;
+&lt;tfoot&gt;
+	&lt;tr&gt;
+		&lt;td colspan=&quot;2&quot;&gt;Last updated: 17.03.2004&lt;/td&gt;
+	&lt;/tr&gt;
+&lt;/tfoot&gt;
+&lt;/table&gt;
+
+
+&lt;/body&gt;
+&lt;/html&gt;

Added: trunk/template.php
===================================================================
--- trunk/template.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/template.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,14 @@
+&lt;?php require 'template_header.php'; ?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Standaard template nummer 1&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;Lorem ipsum dolor sit amet, consectetuer adipiscing elit.  Phasellus varius eleifend tellus. Suspendisse potenti. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos hymenaeos. Nulla facilisi. Sed wisi lectus, placerat nec, mollis quis, posuere eget, arcu.&lt;/p&gt;
+				
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/template_header.php
===================================================================
--- trunk/template_header.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/template_header.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,136 @@
+&lt;?php
+if(empty($_SESSION)) {
+	session_start();
+}
+$hoofdmenu_id = explode(&quot;/&quot;, trim($_SERVER['PHP_SELF']));
+
+foreach($hoofdmenu_id as $key =&gt; $value)
+{
+	$tab = $hoofdmenu_id[2];
+	$tab2 = $hoofdmenu_id[3];
+	
+	if (is_file(&quot;$tab&quot;)) 
+	{
+		if($tab !== &quot;index.php&quot;){
+			$hoofdmenu_id1 = &quot;current2&quot;; 
+			$class = &quot;visible&quot;;
+			$link = &quot;&lt;a href=\&quot;index.php\&quot; class=\&quot;$class\&quot;&gt;&lt;img src=\&quot;img/images/pijltje_links.gif\&quot; border=\&quot;0\&quot; /&gt; startpagina&lt;/a&gt;&quot;;
+		}
+		else {
+			$hoofdmenu_id1 = &quot;current&quot;;
+			$class = &quot;hidden&quot;;
+		}
+	}
+	
+	if ($tab == &quot;nieuws&quot;)
+	{
+		$hoofdmenu_id2 = &quot;current&quot;; 
+	}
+	if ($tab == &quot;artiesten&quot;)
+	{
+		if($tab2 !== &quot;index.php&quot;){
+			
+			if($tab2 == &quot;tag.php&quot;){
+				$hoofdmenu_id3 = &quot;current2&quot;; 
+				$class = &quot;visible&quot;;
+				$link = &quot;&lt;a href=\&quot;/live/artiesten/index.php\&quot; class=\&quot;$class\&quot;&gt;&lt;img src=\&quot;img/images/pijltje_links.gif\&quot; border=\&quot;0\&quot; /&gt; musica &lt;/a&gt;  &lt;a href=\&quot;/live/artiesten/tag_overzicht.php\&quot; class=\&quot;$class\&quot;&gt;&lt; trefwoorden&lt;/a&gt;&quot;;
+				
+			} else {
+				$hoofdmenu_id3 = &quot;current2&quot;; 
+				$class = &quot;visible&quot;;
+				$link = &quot;&lt;a href=\&quot;/live/artiesten/index.php\&quot; class=\&quot;$class\&quot;&gt;&lt;img src=\&quot;img/images/pijltje_links.gif\&quot; border=\&quot;0\&quot; /&gt; musica&lt;/a&gt;&quot;;
+			}
+		}
+		else {
+			$hoofdmenu_id3 = &quot;current&quot;; 
+			$class = &quot;hidden&quot;;
+		}
+	}
+	if ($tab == &quot;hits&quot;)
+	{
+		$hoofdmenu_id4 = &quot;current&quot;; 
+	}
+	if ($tab == &quot;backstage&quot;)
+	{
+		$hoofdmenu_id5 = &quot;current&quot;; 
+	}
+	if ($tab == &quot;help&quot;)
+	{
+		if($tab2 !== &quot;index.php&quot;){
+			$class = &quot;visible&quot;;
+			$link = &quot;&lt;a href=\&quot;/live/help/index.php\&quot; class=\&quot;$class\&quot;&gt;&lt;img src=\&quot;img/images/pijltje_links.gif\&quot; border=\&quot;0\&quot; /&gt; terug naar help&lt;/a&gt;&quot;;
+		}
+		else {
+			$class = &quot;hidden&quot;;
+		}
+	}
+
+	
+
+	
+}
+?&gt;
+
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
+        &quot;<A HREF="http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-transitional.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
+
+&lt;head&gt;
+&lt;title&gt;Simuze&lt;/title&gt;
+&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=ISO-8859-1&quot; /&gt; 
+&lt;base href=&quot;<A HREF="http://simuze.nl/live/">http://simuze.nl/live/</A>&quot;&gt;&lt;/base&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/lib.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/sendit.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/tcells.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/tableruler.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/require.js&quot;&gt;&lt;/script&gt;
+&lt;script language=&quot;javascript&quot;&gt;
+	var win = null;
+	function NewWindow(mypage,myname,w,h,scroll){
+	LeftPosition = (screen.width) ? (screen.width-w)/2 : 0;
+	TopPosition = (screen.height) ? (screen.height-h)/2 : 0;
+	settings = 'height='+h+',width='+w+',top='+TopPosition+',left='+LeftPosition+',scrollbars='+scroll+',noresize'
+	win = window.open(mypage,myname,settings)
+	}
+	
+&lt;/script&gt;
+
+&lt;script type=&quot;text/javascript&quot;&gt;
+		window.onload=function(){
+		tableruler();
+		stripe('playlist', '#F7F3E7', '#EDD8BE');
+		} 
+&lt;/script&gt;
+	
+&lt;style type=&quot;text/css&quot; media=&quot;all&quot;&gt;
+		@import &quot;mainstyle.css&quot;;
+		@import &quot;forms.css&quot;;
+	&lt;/style&gt;
+&lt;/head&gt;
+
+&lt;body&gt;
+&lt;div id=&quot;horizon&quot;&gt;
+	&lt;div id=&quot;wrapper&quot;&gt;
+		&lt;div id=&quot;header&quot;&gt;
+			&lt;div id=&quot;hoofdbar&quot;&gt;&lt;a href=&quot;help/index.php&quot; title=&quot;hulp nodig?&quot; class=&quot;help&quot;&gt;help?&lt;/a&gt;&lt;/div&gt;
+			&lt;div id=&quot;hoofdmenu&quot;&gt;
+			  &lt;ul&gt;  	
+			  	&lt;li&gt;&lt;img class=&quot;shadow&quot; src=&quot;img/images/shadow.gif&quot; /&gt;&lt;/li&gt;
+				&lt;li id=&quot;&lt;?php echo $hoofdmenu_id1; ?&gt;&quot;&gt;&lt;a href=&quot;index.php&quot;&gt;&lt;span&gt;start&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li id=&quot;&lt;?php echo $hoofdmenu_id2; ?&gt;&quot;&gt;&lt;a href=&quot;nieuws/index.php&quot;&gt;&lt;span&gt;nieuws&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li id=&quot;&lt;?php echo $hoofdmenu_id3; ?&gt;&quot;&gt;&lt;a href=&quot;artiesten/index.php&quot;&gt;&lt;span&gt;musica&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li id=&quot;&lt;?php echo $hoofdmenu_id5; ?&gt;&quot;&gt;&lt;a href=&quot;backstage/index.php&quot;&gt;&lt;span&gt;backstage&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+			  &lt;/ul&gt;
+			  &lt;/div&gt;
+			  &lt;div id=&quot;searchveld&quot;&gt;&lt;?php include ('searchform.php'); ?&gt;&lt;/div&gt;
+			  &lt;div id=&quot;submenu&quot;&gt;
+			  &lt;ul&gt;  	
+			  	&lt;li&gt;&lt;img class=&quot;shadow&quot; src=&quot;img/images/shadow.gif&quot; /&gt;&lt;/li&gt;
+				&lt;?php include ('submenu.php'); ?&gt;
+			  &lt;/ul&gt;
+			  &lt;/div&gt;
+			  &lt;div id=&quot;ondersubmenu&quot;&gt;
+				  &lt;div id=&quot;ondersubmenu_links&quot;&gt;&lt;/div&gt;
+				  &lt;div id=&quot;ondersubmenu_rechts&quot;&gt;&lt;?php echo $link ?&gt;&lt;/div&gt;
+			  &lt;/div&gt;
+		&lt;/div&gt;

Added: trunk/template_header_search.php
===================================================================
--- trunk/template_header_search.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/template_header_search.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,87 @@
+&lt;?php
+session_start();
+$hoofdmenu_id = explode(&quot;/&quot;, trim($_SERVER['PHP_SELF']));
+
+foreach($hoofdmenu_id as $key =&gt; $value)
+{
+	$tab = $hoofdmenu_id[2] ;
+	
+	if (is_file(&quot;$tab&quot;)) 
+	{
+		if($tab !== &quot;index.php&quot;){
+		$hoofdmenu_id1 = &quot;current2&quot;; 
+		}
+		else {
+			$hoofdmenu_id1 = &quot;current&quot;;
+		}
+	}
+	
+	if ($tab == &quot;nieuws&quot;)
+	{
+		$hoofdmenu_id2 = &quot;current&quot;; 
+	}
+	if ($tab == &quot;artiesten&quot;)
+	{
+		$hoofdmenu_id3 = &quot;current&quot;; 
+	}
+	if ($tab == &quot;hits&quot;)
+	{
+		$hoofdmenu_id4 = &quot;current&quot;; 
+	}
+	if ($tab == &quot;backstage&quot;)
+	{
+		$hoofdmenu_id5 = &quot;current&quot;; 
+	}
+	
+}
+?&gt;
+
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
+        &quot;<A HREF="http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-transitional.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
+
+&lt;head&gt;
+&lt;title&gt;Simuze&lt;/title&gt;
+&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=ISO-8859-1&quot; /&gt; 
+&lt;base href=&quot;<A HREF="http://simuze.nl/live/">http://simuze.nl/live/</A>&quot;&gt;&lt;/base&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/lib.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/sendit.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/tcells.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/tableruler.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot;&gt;
+		window.onload=function(){
+		tableruler();
+		stripe('playlist', '#F7F3DF', '#EDD8BE');
+		document.Google.submit();
+		} 
+&lt;/script&gt;
+	
+&lt;style type=&quot;text/css&quot; media=&quot;all&quot;&gt;
+		@import &quot;mainstyle.css&quot;;
+		@import &quot;forms.css&quot;;
+	&lt;/style&gt;
+&lt;/head&gt;
+
+&lt;body&gt;
+&lt;div id=&quot;horizon&quot;&gt;
+	&lt;div id=&quot;wrapper&quot;&gt;
+		&lt;div id=&quot;header&quot;&gt;
+			&lt;div id=&quot;hoofdbar&quot;&gt;&lt;a href=&quot;help/index.php&quot; title=&quot;hulp nodig?&quot; class=&quot;help&quot;&gt;help?&lt;/a&gt;&lt;/div&gt;
+			&lt;div id=&quot;hoofdmenu&quot;&gt;
+			  &lt;ul&gt;  	
+			  	&lt;li&gt;&lt;img class=&quot;shadow&quot; src=&quot;img/images/shadow.gif&quot; /&gt;&lt;/li&gt;
+				&lt;li id=&quot;&lt;?php echo $hoofdmenu_id1; ?&gt;&quot;&gt;&lt;a href=&quot;index.php&quot;&gt;&lt;span&gt;start&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li id=&quot;&lt;?php echo $hoofdmenu_id2; ?&gt;&quot;&gt;&lt;a href=&quot;nieuws/index.php&quot;&gt;&lt;span&gt;nieuws&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li id=&quot;&lt;?php echo $hoofdmenu_id3; ?&gt;&quot;&gt;&lt;a href=&quot;artiesten/index.php&quot;&gt;&lt;span&gt;artiesten&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li id=&quot;&lt;?php echo $hoofdmenu_id5; ?&gt;&quot;&gt;&lt;a href=&quot;backstage/index.php&quot;&gt;&lt;span&gt;backstage&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+			  &lt;/ul&gt;
+			  &lt;/div&gt;
+			  &lt;div id=&quot;searchveld&quot;&gt;&lt;?php include ('searchform.php'); ?&gt;&lt;/div&gt;
+			  &lt;div id=&quot;submenu&quot;&gt;
+			  &lt;ul&gt;  	
+			  	&lt;li&gt;&lt;img class=&quot;shadow&quot; src=&quot;img/images/shadow.gif&quot; /&gt;&lt;/li&gt;
+				&lt;?php include ('submenu.php'); ?&gt;
+			  &lt;/ul&gt;
+			  &lt;/div&gt;
+			  &lt;div id=&quot;ondersubmenu&quot;&gt;&lt;/div&gt;
+		&lt;/div&gt;

Added: trunk/template_sidebar_footer.php
===================================================================
--- trunk/template_sidebar_footer.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/template_sidebar_footer.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,32 @@
+		&lt;div id=&quot;sidebar&quot;&gt;&lt;?php require_once(&quot;sidebar.php&quot;); ?&gt;&lt;/div&gt;
+		&lt;div class=&quot;clearing&quot;&gt;&nbsp;&lt;/div&gt;
+		&lt;div id=&quot;footer&quot;&gt;
+		   &lt;br /&gt;&lt;a href=&quot;colofon.php#copyright&quot; class=&quot;voet&quot; title=&quot;Sommige rechten voorbehouden..&quot;&gt;&copy; StOM 2005&lt;/a&gt;
+		&lt;br /&gt;&lt;a href=&quot;colofon.php&quot; title=&quot;colofon&quot; class=&quot;voet&quot;&gt;colofon&lt;/a&gt; |&lt;a href=&quot;disclaimer.php&quot; title=&quot;disclaimer&quot; class=&quot;voet&quot;&gt;disclaimer&lt;/a&gt;
+     
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/div&gt;
+&lt;!--
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-nd/2.0/">http://creativecommons.org/licenses/by-nc-nd/2.0/</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-nd/2.0/">http://creativecommons.org/licenses/by-nc-nd/2.0/</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Notice">http://web.resource.org/cc/Notice</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Attribution">http://web.resource.org/cc/Attribution</A>&quot; /&gt;
+   &lt;prohibits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/CommercialUse">http://web.resource.org/cc/CommercialUse</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+
+&lt;/body&gt;
+&lt;/html&gt;

Added: trunk/template_sidebar_footer_main.php
===================================================================
--- trunk/template_sidebar_footer_main.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/template_sidebar_footer_main.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,52 @@
+		&lt;div id=&quot;sidebar&quot;&gt;&lt;?php include (&quot;main_sidebar.php&quot;); ?&gt;
+		&lt;br /&gt;
+			&lt;div id=&quot;sponsors&quot;&gt;
+				
+				&lt;div id=&quot;nieuwsitems_sidebar&quot;&gt;
+				&lt;h2 class=&quot;bar1white&quot;&gt;CC nieuws:&lt;/h2&gt;
+				&lt;br /&gt;
+				&lt;?php require_once(&quot;inc/sm-fetchnews.php&quot;);?&gt;
+				&lt;/div&gt;
+				
+			   &lt;p class=&quot;small_white&quot;&gt;met dank aan:&lt;/p&gt;
+				&lt;p class=&quot;small_white&quot;&gt;
+				&lt;a href=&quot;<A HREF="http://www.xs4all.nl">http://www.xs4all.nl</A>&quot;&gt;&lt;img alt=&quot;XS4all&quot; src=&quot;img/images/xs4all_30mm.gif&quot; border=&quot;0&quot; /&gt;&lt;/a&gt;
+				&lt;br /&gt;
+				&lt;a href=&quot;<A HREF="http://www.digitalepioniers.nl">http://www.digitalepioniers.nl</A>&quot;&gt;&lt;img alt=&quot;Digitale pioniers&quot; src=&quot;img/images/digitalepioniers.gif&quot; border=&quot;0&quot; /&gt;&lt;/a&gt;
+				&lt;/p&gt;
+				&lt;br /&gt;
+				&lt;br /&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+
+		&lt;div class=&quot;clearing&quot;&gt;&nbsp;&lt;/div&gt;
+		&lt;div id=&quot;footer&quot;&gt;
+		   &lt;br /&gt;&lt;a href=&quot;colofon.php#copyright&quot; class=&quot;voet&quot; title=&quot;Sommige rechten voorbehouden..&quot;&gt;&copy; StOM 2005&lt;/a&gt;
+		&lt;br /&gt;&lt;a href=&quot;colofon.php&quot; title=&quot;colofon&quot; class=&quot;voet&quot;&gt;colofon&lt;/a&gt; |&lt;a href=&quot;disclaimer.php&quot; title=&quot;disclaimer&quot; class=&quot;voet&quot;&gt;disclaimer&lt;/a&gt;
+     
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/div&gt;
+&lt;!--
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-nd/2.0/">http://creativecommons.org/licenses/by-nc-nd/2.0/</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-nd/2.0/">http://creativecommons.org/licenses/by-nc-nd/2.0/</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Notice">http://web.resource.org/cc/Notice</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Attribution">http://web.resource.org/cc/Attribution</A>&quot; /&gt;
+   &lt;prohibits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/CommercialUse">http://web.resource.org/cc/CommercialUse</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+
+&lt;/body&gt;
+&lt;/html&gt;

Added: trunk/templates/submenu.php
===================================================================
--- trunk/templates/submenu.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/templates/submenu.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,48 @@
+&lt;?php
+
+$submenu_id = explode(&quot;/&quot;, trim($_SERVER['PHP_SELF']));
+
+//print_r($submenu_id);
+
+foreach($submenu_id as $key =&gt; $value)
+{
+$subtab = $submenu_id[2] ;
+
+	if (is_file(&quot;$subtab&quot;)) 
+	{
+		if($subtab == &quot;oversimuze.php&quot;)
+		{
+		$submenu_id1 = &quot;current&quot;; 
+		}
+		if($subtab == &quot;faq.php&quot;)
+		{
+		$submenu_id2 = &quot;current&quot;; 
+		}
+		if($subtab == &quot;tips.php&quot;)
+		{
+		$submenu_id3 = &quot;current&quot;; 
+		}
+	}
+}	
+
+
+
+	if ($hoofdmenu_id1 == &quot;current&quot; || $hoofdmenu_id1 == &quot;current2&quot;  )
+	{
+		echo &quot;&lt;li id=\&quot;$submenu_id1\&quot;&gt;&lt;a href=\&quot;oversimuze.php\&quot;&gt;&lt;span&gt;over simuze&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;;
+		echo &quot;&lt;li id=\&quot;$submenu_id2\&quot;&gt;&lt;a href=\&quot;faq.php\&quot;&gt;&lt;span&gt;faq&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;;
+		echo &quot;&lt;li id=\&quot;$submenu_id3\&quot;&gt;&lt;a href=\&quot;tips.php\&quot;&gt;&lt;span&gt;tips en tools&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;&quot;;
+
+	}
+	
+	if ($hoofdmenu_id2 == &quot;current&quot; || $hoofdmenu_id2 == &quot;current2&quot;)
+	{
+		print('&lt;li&gt;&lt;a href=&quot;nieuws/simuze.php&quot;&gt;&lt;span&gt;over simuze&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;');
+	}
+	
+	if ($hoofdmenu_id3 == &quot;current&quot; || $hoofdmenu_id3 == &quot;current2&quot;)
+	{
+		print('&lt;li&gt;&lt;a href=&quot;artiesten/overzicht.php&quot;&gt;&lt;span&gt;overzicht&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;');
+	}
+?&gt;
+

Added: trunk/templates/template.php
===================================================================
--- trunk/templates/template.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/templates/template.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,14 @@
+&lt;?php require 'template_header.php'; ?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Standaard template nummer 1&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;Lorem ipsum dolor sit amet, consectetuer adipiscing elit.  Phasellus varius eleifend tellus. Suspendisse potenti. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos hymenaeos. Nulla facilisi. Sed wisi lectus, placerat nec, mollis quis, posuere eget, arcu.&lt;/p&gt;
+				
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/templates/template2.php
===================================================================
--- trunk/templates/template2.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/templates/template2.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,14 @@
+&lt;?php require '../template_header.php'; ?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Standaard template numero 2&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;Lorem ipsum dolor sit amet, consectetuer adipiscing elit.  Phasellus varius eleifend tellus. Suspendisse potenti. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos hymenaeos. Nulla facilisi. Sed wisi lectus, placerat nec, mollis quis, posuere eget, arcu.&lt;/p&gt;
+				
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require '../template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/templates/template_header.php
===================================================================
--- trunk/templates/template_header.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/templates/template_header.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,85 @@
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
+        &quot;<A HREF="http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/2000/REC-xhtml1-20000126/DTD/xhtml1-transitional.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
+
+&lt;head&gt;
+&lt;title&gt;Simuze&lt;/title&gt;
+&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=ISO-8859-1&quot; /&gt; 
+&lt;base href=&quot;<A HREF="http://simuze.nl/live/">http://simuze.nl/live/</A>&quot;&gt;&lt;/base&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/lib.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/sendit.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/tcells.js&quot;&gt;&lt;/script&gt;
+&lt;script type=&quot;text/javascript&quot; language=&quot;javascript&quot; src=&quot;js/tableruler.js&quot;&gt;&lt;/script&gt;
+
+&lt;style type=&quot;text/css&quot; media=&quot;all&quot;&gt;
+		@import &quot;mainstyle.css&quot;;
+		@import &quot;forms.css&quot;;
+	&lt;/style&gt;
+&lt;/head&gt;
+
+&lt;body onload=&quot;stripe('playlist', '#F7F3DF', '#EDD8BE');&quot;&gt;
+	
+&lt;?php
+$hoofdmenu_id = explode(&quot;/&quot;, trim($_SERVER['PHP_SELF']));
+
+foreach($hoofdmenu_id as $key =&gt; $value)
+{
+	$tab = $hoofdmenu_id[2] ;
+	
+	if (is_file(&quot;$tab&quot;)) 
+	{
+		if($tab !== &quot;index.php&quot;){
+		$hoofdmenu_id1 = &quot;current2&quot;; 
+		}
+		else {
+			$hoofdmenu_id1 = &quot;current&quot;;
+		}
+	}
+	
+	if ($tab == &quot;nieuws&quot;)
+	{
+		$hoofdmenu_id2 = &quot;current&quot;; 
+	}
+	if ($tab == &quot;artiesten&quot;)
+	{
+		$hoofdmenu_id3 = &quot;current&quot;; 
+	}
+	if ($tab == &quot;hits&quot;)
+	{
+		$hoofdmenu_id4 = &quot;current&quot;; 
+	}
+	if ($tab == &quot;backstage&quot;)
+	{
+		$hoofdmenu_id5 = &quot;current&quot;; 
+	}
+	
+}
+?&gt;
+
+&lt;div id=&quot;horizon&quot;&gt;
+	&lt;div id=&quot;wrapper&quot;&gt;
+		&lt;div id=&quot;header&quot;&gt;
+			&lt;div id=&quot;hoofdbar&quot;&gt;&lt;a href=&quot;help/help.php&quot; title=&quot;hulp nodig?&quot; class=&quot;help&quot;&gt;help?&lt;/a&gt;&lt;/div&gt;
+			&lt;div id=&quot;hoofdmenu&quot;&gt;
+			  &lt;ul&gt;  	
+			  	&lt;li&gt;&lt;img class=&quot;shadow&quot; src=&quot;img/images/shadow.gif&quot; /&gt;&lt;/li&gt;
+				&lt;li id=&quot;&lt;?php echo $hoofdmenu_id1; ?&gt;&quot;&gt;&lt;a href=&quot;index.php&quot;&gt;&lt;span&gt;start&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li id=&quot;&lt;?php echo $hoofdmenu_id2; ?&gt;&quot;&gt;&lt;a href=&quot;nieuws/index.php&quot;&gt;&lt;span&gt;nieuws&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li id=&quot;&lt;?php echo $hoofdmenu_id3; ?&gt;&quot;&gt;&lt;a href=&quot;artiesten/index.php&quot;&gt;&lt;span&gt;artiesten&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;!--&lt;li id=&quot;&lt;?php echo $hoofdmenu_id4; ?&gt;&quot;&gt;&lt;a href=&quot;hits/index.php&quot;&gt;&lt;span&gt;charts&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
+				&lt;li id=&quot;&lt;?php echo $hoofdmenu_id5; ?&gt;&quot;&gt;&lt;a href=&quot;backstage/index.php&quot;&gt;&lt;span&gt;backstage&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;--&gt;
+			  &lt;/ul&gt;
+			  &lt;/div&gt;
+			  
+			  &lt;div id=&quot;searchveld&quot;&gt;
+			 	 &lt;?php include ('searchform.php'); ?&gt;
+			  &lt;/div&gt;
+			  
+			  &lt;div id=&quot;submenu&quot;&gt;
+				  &lt;ul&gt;  	
+					&lt;li&gt;&lt;img class=&quot;shadow&quot; src=&quot;img/images/shadow.gif&quot; /&gt;&lt;/li&gt;
+					&lt;?php include ('submenu.php'); ?&gt;
+				  &lt;/ul&gt;
+			  &lt;/div&gt;
+			  &lt;div id=&quot;ondersubmenu&quot;&gt;&lt;/div&gt;
+		&lt;/div&gt;

Added: trunk/templates/template_sidebar_footer.php
===================================================================
--- trunk/templates/template_sidebar_footer.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/templates/template_sidebar_footer.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,34 @@
+		&lt;div id=&quot;sidebar&quot;&gt;&lt;?php require_once(&quot;sidebar.php&quot;); ?&gt;&lt;/div&gt;
+		&lt;div class=&quot;clearing&quot;&gt;&nbsp;&lt;/div&gt;
+		&lt;div id=&quot;footer&quot;&gt;
+		   &lt;br /&gt;&lt;a href=&quot;colofon.php#copyright&quot; class=&quot;voet&quot; title=&quot;Sommige rechten voorbehouden..&quot;&gt;&copy; StOM 2005&lt;/a&gt;
+		&lt;br /&gt;&lt;a href=&quot;colofon.php&quot; title=&quot;colofon&quot; class=&quot;voet&quot;&gt;colofon&lt;/a&gt; |&lt;a href=&quot;disclaimer.php&quot; title=&quot;disclaimer&quot; class=&quot;voet&quot;&gt;disclaimer&lt;/a&gt;
+     
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/div&gt;
+&lt;!--
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-sa/2.0/nl/">http://creativecommons.org/licenses/by-nc-sa/2.0/nl/</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-sa/2.0/nl/">http://creativecommons.org/licenses/by-nc-sa/2.0/nl/</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Notice">http://web.resource.org/cc/Notice</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Attribution">http://web.resource.org/cc/Attribution</A>&quot; /&gt;
+   &lt;prohibits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/CommercialUse">http://web.resource.org/cc/CommercialUse</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/ShareAlike">http://web.resource.org/cc/ShareAlike</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+
+&lt;/body&gt;
+&lt;/html&gt;

Added: trunk/templates/template_sidebar_footer_main.php
===================================================================
--- trunk/templates/template_sidebar_footer_main.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/templates/template_sidebar_footer_main.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,47 @@
+		&lt;div id=&quot;sidebar&quot;&gt;&lt;?php include (&quot;main_sidebar.php&quot;); ?&gt;
+		&lt;br /&gt;
+			&lt;div id=&quot;sponsors&quot;&gt;
+			   &lt;p class=&quot;small_white&quot;&gt;met dank aan:&lt;/p&gt;
+				&lt;p class=&quot;small_white&quot;&gt;
+				&lt;a href=&quot;<A HREF="http://www.xs4all.nl">http://www.xs4all.nl</A>&quot;&gt;&lt;img alt=&quot;XS4all&quot; src=&quot;img/images/xs4all_30mm.gif&quot; border=&quot;0&quot; /&gt;&lt;/a&gt;
+				&lt;br /&gt;
+				&lt;a href=&quot;<A HREF="http://www.digitalepioniers.nl">http://www.digitalepioniers.nl</A>&quot; class=&quot;help&quot;&gt;Digitale Pioniers&lt;/a&gt;
+				&lt;/p&gt;
+				&lt;br /&gt;
+				&lt;br /&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+
+		&lt;div class=&quot;clearing&quot;&gt;&nbsp;&lt;/div&gt;
+		&lt;div id=&quot;footer&quot;&gt;
+		   &lt;br /&gt;&lt;a href=&quot;colofon.php#copyright&quot; class=&quot;voet&quot; title=&quot;Sommige rechten voorbehouden..&quot;&gt;&copy; StOM 2005&lt;/a&gt;
+		&lt;br /&gt;&lt;a href=&quot;colofon.php&quot; title=&quot;colofon&quot; class=&quot;voet&quot;&gt;colofon&lt;/a&gt; |&lt;a href=&quot;disclaimer.php&quot; title=&quot;disclaimer&quot; class=&quot;voet&quot;&gt;disclaimer&lt;/a&gt;
+     
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/div&gt;
+&lt;!--
+
+&lt;rdf:RDF xmlns=&quot;<A HREF="http://web.resource.org/cc/">http://web.resource.org/cc/</A>&quot;
+    xmlns:dc=&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;
+    xmlns:rdf=&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;&gt;
+&lt;Work rdf:about=&quot;&quot;&gt;
+   &lt;license rdf:resource=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-sa/2.0/nl/">http://creativecommons.org/licenses/by-nc-sa/2.0/nl/</A>&quot; /&gt;
+&lt;/Work&gt;
+
+&lt;License rdf:about=&quot;<A HREF="http://creativecommons.org/licenses/by-nc-sa/2.0/nl/">http://creativecommons.org/licenses/by-nc-sa/2.0/nl/</A>&quot;&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Reproduction">http://web.resource.org/cc/Reproduction</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Distribution">http://web.resource.org/cc/Distribution</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Notice">http://web.resource.org/cc/Notice</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/Attribution">http://web.resource.org/cc/Attribution</A>&quot; /&gt;
+   &lt;prohibits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/CommercialUse">http://web.resource.org/cc/CommercialUse</A>&quot; /&gt;
+   &lt;permits rdf:resource=&quot;<A HREF="http://web.resource.org/cc/DerivativeWorks">http://web.resource.org/cc/DerivativeWorks</A>&quot; /&gt;
+   &lt;requires rdf:resource=&quot;<A HREF="http://web.resource.org/cc/ShareAlike">http://web.resource.org/cc/ShareAlike</A>&quot; /&gt;
+&lt;/License&gt;
+
+&lt;/rdf:RDF&gt;
+
+--&gt;
+
+&lt;/body&gt;
+&lt;/html&gt;

Added: trunk/test.xspf
===================================================================
--- trunk/test.xspf	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/test.xspf	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,85 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
+&lt;playlist version=&quot;0&quot; xmlns=&quot;<A HREF="http://xspf.org/ns/0/">http://xspf.org/ns/0/</A>&quot;&gt;
+  &lt;title&gt;zuardi05&lt;/title&gt;
+  &lt;annotation&gt;&lt;/annotation&gt;
+  &lt;creator&gt;hideout&lt;/creator&gt;
+  &lt;info&gt;<A HREF="http://webjay.org/by/hideout/zuardi05&lt;/info">http://webjay.org/by/hideout/zuardi05&lt;/info</A>&gt;
+  &lt;location&gt;<A HREF="http://webjay.org/by/hideout/zuardi05.xspf&lt;/location">http://webjay.org/by/hideout/zuardi05.xspf&lt;/location</A>&gt;
+  &lt;license&gt;<A HREF="http://creativecommons.org/licenses/by-sa/1.0/&lt;/license">http://creativecommons.org/licenses/by-sa/1.0/&lt;/license</A>&gt;
+
+  &lt;trackList&gt;    
+&lt;track&gt;
+&lt;location&gt;<A HREF="http://mp301.epitonic.com/files/reg/songs/mp3/Cornershop-Lessons_Learned_From_Rocky_I_To_Rocky_III.mp3&lt;/location">http://mp301.epitonic.com/files/reg/songs/mp3/Cornershop-Lessons_Learned_From_Rocky_I_To_Rocky_III.mp3&lt;/location</A>&gt;
+&lt;image&gt;<A HREF="http://images.amazon.com/images/P/B0000649MW.01._SCMZZZZZZZ_.jpg&lt;/image">http://images.amazon.com/images/P/B0000649MW.01._SCMZZZZZZZ_.jpg&lt;/image</A>&gt;
+&lt;annotation&gt;Cornershop - Lessons Learned From Rocky I To Rocky III&lt;/annotation&gt;
+&lt;info&gt;<A HREF="http://www.epitonic.com/artists/cornershop.html&lt;/info">http://www.epitonic.com/artists/cornershop.html&lt;/info</A>&gt;
+
+&lt;/track&gt;			  
+&lt;track&gt;
+&lt;location&gt;<A HREF="http://webjay.org/audio/webjay44.mp3&lt;/location">http://webjay.org/audio/webjay44.mp3&lt;/location</A>&gt;
+&lt;image&gt;<A HREF="http://webjay.org/img/webjay.jpg&lt;/image">http://webjay.org/img/webjay.jpg&lt;/image</A>&gt;
+
+&lt;annotation&gt;playlist courtesy of Webjay.org&lt;/annotation&gt;
+
+&lt;/track&gt;			  
+&lt;track&gt;
+&lt;location&gt;<A HREF="http://200.199.201.188/trama/tramavirtual/musicas/m_3/19105.mp3&lt;/location">http://200.199.201.188/trama/tramavirtual/musicas/m_3/19105.mp3&lt;/location</A>&gt;
+&lt;image&gt;<A HREF="http://www.tramavirtual.com.br/foto/22717.jpg&lt;/image">http://www.tramavirtual.com.br/foto/22717.jpg&lt;/image</A>&gt;
+&lt;annotation&gt;Eletrofan - Medicine&lt;/annotation&gt;
+&lt;info&gt;<A HREF="http://www.tramavirtual.com.br/eletrofan&lt;/info">http://www.tramavirtual.com.br/eletrofan&lt;/info</A>&gt;
+
+&lt;/track&gt;			  
+&lt;track&gt;
+&lt;location&gt;<A HREF="http://www.dkeithrobinson.com/asterisk/sow/killers.mp3&lt;/location">http://www.dkeithrobinson.com/asterisk/sow/killers.mp3&lt;/location</A>&gt;
+
+&lt;image&gt;<A HREF="http://images.amazon.com/images/P/B0002858YS.01._SCMZZZZZZZ_.jpg&lt;/image">http://images.amazon.com/images/P/B0002858YS.01._SCMZZZZZZZ_.jpg&lt;/image</A>&gt;
+&lt;annotation&gt;The Killers - Somebody Told Me&lt;/annotation&gt;
+&lt;info&gt;<A HREF="http://www.dkeithrobinson.com/asterisk/&lt;/info">http://www.dkeithrobinson.com/asterisk/&lt;/info</A>&gt;
+
+&lt;/track&gt;			  
+&lt;track&gt;
+&lt;location&gt;<A HREF="http://thefeatures.com/mp3/features--the_beginning.mp3&lt;/location">http://thefeatures.com/mp3/features--the_beginning.mp3&lt;/location</A>&gt;
+&lt;image&gt;<A HREF="http://images.amazon.com/images/P/B0002XEDU8.01._SCMZZZZZZZ_.jpg&lt;/image">http://images.amazon.com/images/P/B0002XEDU8.01._SCMZZZZZZZ_.jpg&lt;/image</A>&gt;
+&lt;annotation&gt;The Features - The Beginning&lt;/annotation&gt;
+&lt;info&gt;<A HREF="http://thefeatures.com&lt;/info">http://thefeatures.com&lt;/info</A>&gt;
+
+&lt;/track&gt;			  
+&lt;track&gt;
+&lt;location&gt;<A HREF="http://www.weezernation.com/media/mp3/Weezer%20-%201999%20Demo%20-%20Island%20In%20The%20Sun.mp3&lt;/location">http://www.weezernation.com/media/mp3/Weezer%20-%201999%20Demo%20-%20Island%20In%20The%20Sun.mp3&lt;/location</A>&gt;
+&lt;image&gt;<A HREF="http://images.amazon.com/images/P/B00005ICAW.01._SCMZZZZZZZ_.jpg&lt;/image">http://images.amazon.com/images/P/B00005ICAW.01._SCMZZZZZZZ_.jpg&lt;/image</A>&gt;
+&lt;annotation&gt;Weezer - Island in the Sun&lt;/annotation&gt;
+&lt;info&gt;<A HREF="http://www.weezernation.com&lt;/info">http://www.weezernation.com&lt;/info</A>&gt;
+
+&lt;/track&gt;			  
+&lt;track&gt;
+&lt;location&gt;<A HREF="http://www.flamingmoe.com.br/barulho/demo/Flaming%20Moe%20-%2006%20-%20Go%2C%20Baby%20Go.mp3&lt;/location">http://www.flamingmoe.com.br/barulho/demo/Flaming%20Moe%20-%2006%20-%20Go%2C%20Baby%20Go.mp3&lt;/location</A>&gt;
+&lt;image&gt;<A HREF="http://www.flamingmoe.com.br/imagens/faixa01.jpg&lt;/image">http://www.flamingmoe.com.br/imagens/faixa01.jpg&lt;/image</A>&gt;
+
+&lt;annotation&gt;Flaming Moe - Go, Baby Go&lt;/annotation&gt;
+&lt;info&gt;<A HREF="http://www.flamingmoe.com.br/barulho.html&lt;/info">http://www.flamingmoe.com.br/barulho.html&lt;/info</A>&gt;
+
+&lt;/track&gt;			  
+&lt;track&gt;
+&lt;location&gt;<A HREF="http://www.knife-skills.com/mp3s/teenagelust.mp3&lt;/location">http://www.knife-skills.com/mp3s/teenagelust.mp3&lt;/location</A>&gt;
+&lt;annotation&gt;Knife Skills - Teenage Lust&lt;/annotation&gt;
+&lt;info&gt;<A HREF="http://www.knife-skills.com&lt;/info">http://www.knife-skills.com&lt;/info</A>&gt;
+
+&lt;/track&gt;			  
+&lt;track&gt;
+&lt;location&gt;<A HREF="http://www.yeahyeahyeahs.com/bang.mp3&lt;/location">http://www.yeahyeahyeahs.com/bang.mp3&lt;/location</A>&gt;
+
+&lt;image&gt;<A HREF="http://images.amazon.com/images/P/B0000683N4.01._SCMZZZZZZZ_.jpg&lt;/image">http://images.amazon.com/images/P/B0000683N4.01._SCMZZZZZZZ_.jpg&lt;/image</A>&gt;
+&lt;annotation&gt;Yeah Yeah Yeahs - Bang&lt;/annotation&gt;
+&lt;info&gt;<A HREF="http://www.radio.plus.com/index2001.html&lt;/info">http://www.radio.plus.com/index2001.html&lt;/info</A>&gt;
+
+&lt;/track&gt;			  
+&lt;track&gt;
+&lt;location&gt;<A HREF="http://www.peekaboorecords.com/sounds/mp3/Black_Lipstick__Count_Your_Blessings.mp3&lt;/location">http://www.peekaboorecords.com/sounds/mp3/Black_Lipstick__Count_Your_Blessings.mp3&lt;/location</A>&gt;
+&lt;image&gt;<A HREF="http://images.amazon.com/images/P/B00005OAFG.01._SCMZZZZZZZ_.jpg&lt;/image">http://images.amazon.com/images/P/B00005OAFG.01._SCMZZZZZZZ_.jpg&lt;/image</A>&gt;
+&lt;annotation&gt;Black Lipstick - Count Your Blessings.mp3&lt;/annotation&gt;
+&lt;info&gt;<A HREF="http://www.peekaboorecords.com/sounds/index.htm&lt;/info">http://www.peekaboorecords.com/sounds/index.htm&lt;/info</A>&gt;
+
+&lt;/track&gt;			  
+
+  &lt;/trackList&gt;
+&lt;/playlist&gt;

Added: trunk/users/.htaccess.bak
===================================================================
--- trunk/users/.htaccess.bak	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/.htaccess.bak	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,26 @@
+AuthName &quot;Alleen voor Simuze leden&quot;
+AuthType Basic
+
+# Auth_MySQL_Info [server] [user] [pass]
+Auth_MySQL_Username script
+Auth_MySQL_Password <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">php at db</A>!
+Auth_MySQL_DB sm_system
+Auth_MySQL_Password_Table user
+Auth_MySQL_Username_Field uname
+Auth_MySQL_Password_Field pwd
+Auth_MySQL_Encrypted_Passwords On
+Auth_MySQL_Encryption_Types PHP_MD5 Crypt
+# turn the above to &quot;On&quot; if you used crypt() on users'
+# passwords before storing them
+Auth_MySQL_Non_Persistent On
+Auth_MYSQL On
+# turn the above to &quot;Off&quot; if you want
+# other authentication to take over in case the visitor
+# fails mysql authentication
+Auth_MySQL_Empty_Passwords Off
+# turn the above to &quot;On&quot; if you want to allow authenticate
+# just a correct username and no password
+
+# End mod_auth_mysql specific directives
+
+require valid-user

Added: trunk/users/change_settings.php
===================================================================
--- trunk/users/change_settings.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/change_settings.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,56 @@
+&lt;?php 
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once('inc/sm-secure.php');
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+$user = $_SESSION['name'];
+
+$h_user = qGetUserInfo($user);
+$nr_rows = mysql_num_rows($h_user);
+if($nr_rows == 1) {
+	$u_data = mysql_fetch_array($h_user);
+}
+require_once 'template_header.php'; 	
+?&gt;
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Instellingen wijzigen&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;
+					Je kunt hier je e-mail adres en je wachtwoord wijzigen. Je gebruikersnaam (&lt;b&gt;&lt;?php echo&quot;$user&quot;?&gt;&lt;/b&gt;) kan je niet wijzigen. Als je je wachtwoord niet wilt wijzigen laat dan de wachtwoord velden leeg.&lt;/p&gt;
+				
+				
+				&lt;p&gt;
+				&lt;form action=&quot;/live/users/sm-change_settings.php&quot; method=&quot;post&quot; name=&quot;register&quot; id=&quot;register&quot; onSubmit=&quot;return checkFieldsEqual(this)&quot;&gt;
+				&lt;div class=&quot;roundcont&quot;&gt;
+					&lt;div class=&quot;roundtop&quot;&gt;&lt;/div&gt;
+					&lt;fieldset&gt;
+						&lt;p&gt;Hieronder kan je je gegevens wijzigen:&lt;/p&gt;&lt;br /&gt;
+						
+						&lt;label for=&quot;email&quot;&gt;e-mail:&lt;/label&gt; 
+						&lt;input type=&quot;text&quot; id=&quot;email&quot; name=&quot;email&quot; maxlength=&quot;250&quot; size=&quot;25&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$u_data[email]&quot;;?&gt;&quot; /&gt;
+						&lt;label for=&quot;password&quot;&gt;wachtwoord:&lt;/label&gt; 
+						&lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; maxlength=&quot;16&quot; size=&quot;16&quot; class=&quot;form_tekstveld&quot; /&gt;
+						&lt;label for=&quot;password2&quot;&gt;wachtwoord (nogmaals):&lt;/label&gt; 
+						&lt;input type=&quot;password&quot; id=&quot;password2&quot; name=&quot;password2&quot; maxlength=&quot;16&quot; size=&quot;16&quot; class=&quot;form_tekstveld&quot; /&gt;
+						&lt;input type=&quot;hidden&quot; name=&quot;uname&quot; value=&quot;&lt;?php echo&quot;$user&quot;?&gt;&quot; class=&quot;hidden&quot; /&gt;&lt;br /&gt;
+						&lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;true&quot; class=&quot;hidden&quot; /&gt;&lt;br /&gt;
+					&lt;/fieldset&gt;
+					&lt;div class=&quot;roundbottom&quot;&gt;&lt;/div&gt;
+						
+				&lt;/div&gt;	
+				
+				&lt;p&gt;
+				&lt;input type=&quot;image&quot; title=&quot;wijzig je instellingen&quot; class=&quot;profile_btn&quot; src=&quot;img/images/wijzigen_btn.gif&quot; alt=&quot;wijzig je instellingen&quot; value=&quot;true&quot; /&gt;
+				
+				&lt;/p&gt;
+				
+				&lt;/form&gt;
+				&lt;/p&gt;
+			
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+	
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/users/edit_music.php
===================================================================
--- trunk/users/edit_music.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/edit_music.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,226 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-secure.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;template_header.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/external/getid3/getid3.php&quot;);
+
+//get username from the session
+$username = $_SESSION['name'];
+
+// Initialize getID3 engine
+$getID3 = new getID3;
+
+
+$filename = trim($_GET['f']);
+
+
+//get the users dir with audio
+$dir_handle = qGetUserInfo($username);
+
+//push all the files found in the userhomedir into the $files array
+if($nr_rows = mysql_num_rows ($dir_handle) == 1) {
+    $row = mysql_fetch_array($dir_handle);
+    $user_dir = $row['homedir_checked'];
+    
+    $the_dir = $user_dir . HI_QUALITY_DIR;
+    $userid = $row['uid'];
+    
+    if(!empty($userid)) {
+        $profile_handle = qGetProfileByUID($userid);
+        if($nr_profile = mysql_num_rows($profile_handle) == 1){
+            $profile = mysql_fetch_array($profile_handle);
+        } else {
+            array_push($log, &quot;profile db niet aanwezig&quot;);
+        }
+        //get all files from $the_dir    
+        if(is_dir($the_dir)) {
+            if($dh = opendir($the_dir)) {
+                while (($file = readdir($dh)) !== false) {
+                    if($file != &quot;..&quot; &amp;&amp; $file !=&quot;.&quot;) {
+                        $path = $the_dir . $file;
+                        if($file == $filename) {
+                            $id3_info = $getID3-&gt;analyze($path);
+                        }
+                        
+                    }
+                } 
+                closedir($dh);
+            }
+        } else {
+            array_push($log, &quot;$the_dir is geen directory&quot;);
+        }
+    } else {
+        array_push($log, &quot;Geen userid aanwezig&quot;);
+    }
+} else {
+    array_push($log, &quot;Geen unieke gebruiker&quot;);
+}
+
+$tmp = explode(&quot;.&quot;, $id3_info['filename']);
+$filename_no_ext = $tmp[0];
+
+
+
+//prepare moodsearch
+$moodsearch = createMoodSearch();
+
+//prepare genre
+$genre = createSelectGenre();
+
+?&gt;
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_muziekgegevens&quot;&gt;
+				    &lt;div&gt;&lt;a href=&quot;users/overview_music.php&quot;&gt;&lt;img src=&quot;img/images/pijltje_links.gif&quot; alt=&quot;pijltje terug naar overzicht&quot; border=&quot;0&quot;&gt; Terug naar je muziekoverzicht&lt;/a&gt;&lt;br /&gt;&lt;br /&gt;
+					&lt;h1&gt;Details van het bestand: &lt;?php echo &quot;$filename&quot;;?&gt;&lt;/h1&gt;&lt;/div&gt;
+                        &lt;?php 
+                            //echo &quot;LOG:&lt;pre&gt;&quot;;
+                            //print_r($log);
+                            //echo &quot;&lt;/pre&gt;&quot;;
+                            //echo &quot;FILES NIET IN DB&lt;pre&gt;&quot;;
+                            //print_r($files);
+                            //echo &quot;&lt;/pre&gt;&quot;;
+                            //echo &quot;FILES IN DB&lt;pre&gt;&quot;;
+                            //print_r($db_files);
+                            //echo &quot;&lt;/pre&gt;&quot;;
+                            
+                            //print_r($id3_info);
+                        ?&gt;
+                        &lt;p class=&quot;space&quot;&gt;
+                        &lt;/p&gt;
+                        	&lt;form action=&quot;users/sm-edit-music.php&quot; method=&quot;post&quot; name=&quot;edit_music&quot; id=&quot;edit_music&quot; onSubmit=&quot;return checkEditMusic(this)&quot;&gt;
+                                &lt;fieldset&gt;
+                                    &lt;p class=&quot;space&quot;&gt;
+                                        Onderstaande info is noodzakelijk voordat je nummer online te beluisteren of te downloaden is. 
+                                        Hoe duidelijker en serieuzer je alles invult des te makkelijker 
+                                        wordt het voor mensen om je muziek te vinden.
+                                    &lt;/p&gt;
+                                                                        
+									&lt;h2&gt;Stap 1:&lt;/h2&gt;
+								&lt;div class=&quot;roundcont&quot;&gt;
+								&lt;div id=&quot;bestandsinfo_kopje&quot;&gt;&lt;/div&gt;
+								
+								&lt;p&gt;&lt;/p&gt;
+								&lt;fieldset&gt;
+								
+                                    &lt;ul&gt;
+                                        &lt;?php
+										  echo &quot;&lt;li&gt;Bestandsnaam: $filename_no_ext&lt;/li&gt;\n&quot;;
+                                          echo &quot;&lt;li&gt;Tijdsduur: $id3_info[playtime_string]&lt;/li&gt;\n&quot;;
+                                          echo &quot;&lt;li&gt;Bestands grootte: $id3_info[filesize] bytes&lt;/li&gt;\n&quot;;
+                                          echo &quot;&lt;li&gt;Bitrate:&quot; .($id3_info['bitrate'])/1000 .&quot; kbps&lt;/li&gt;\n&quot;;
+                                        ?&gt;
+                                    &lt;/ul&gt;
+                                    
+                                    &lt;p class=&quot;space&quot;&gt;
+                                    &lt;!-- artiest naam --&gt; 
+                                    &lt;label for=&quot;aname&quot;&gt;Artiest:&lt;/label&gt;
+                                    &lt;input type=&quot;text&quot; class=&quot;commentaar_input&quot; id=&quot;&quot; name=&quot;__aname&quot; maxlength=&quot;250&quot; size=&quot;25&quot; value=&quot;&lt;?php echo &quot;$profile[artistname]&quot;;?&gt;&quot; /&gt;&lt;br /&gt;
+                                   
+                                     &lt;!-- song titel --&gt; 
+                                    &lt;label for=&quot;songtitle&quot;&gt;Titel:&lt;/label&gt;
+                                    &lt;input type=&quot;text&quot; class=&quot;commentaar_input&quot; id=&quot;&quot; name=&quot;__stitle&quot; maxlength=&quot;250&quot; size=&quot;25&quot; /&gt;&lt;br /&gt;
+                                   
+                                    
+                                    &lt;!-- album naam --&gt; 
+                                    &lt;label for=&quot;album&quot;&gt;Album:&lt;/label&gt;
+                                    &lt;input type=&quot;text&quot; class=&quot;commentaar_input&quot; id=&quot;&quot; name=&quot;album&quot; maxlength=&quot;250&quot; size=&quot;25&quot; /&gt;&lt;br /&gt;
+                                                                       
+                                    
+                                    &lt;!-- genre kiezen --&gt;
+                                    &lt;?php echo &quot;$genre&quot;; ?&gt;    
+                                   &lt;/p&gt;
+								   
+								&lt;/fieldset&gt;
+							&lt;div class=&quot;roundbottom&quot;&gt;&lt;/div&gt;
+							&lt;/div&gt;	
+							
+							&lt;br /&gt;
+							&lt;h2&gt;Stap 2:&lt;/h2&gt;
+							&lt;div class=&quot;roundcont&quot;&gt;
+								&lt;div id=&quot;licentiekiezen_kopje&quot;&gt;&lt;/div&gt;
+								&lt;p&gt;&lt;/p&gt;
+								&lt;fieldset&gt;
+										
+                                     &lt;!--license kiezen  --&gt; 
+									 &lt;p class=&quot;red&quot;&gt;Let op: deze licentie blijft aan je muziek verbonden, en is niet meer te wijzigen. &lt;a href=&quot;/live/help/licenties.php&quot; target=&quot;_blank&quot;&gt;klik hier voor meer info&lt;/a&gt;&lt;/p&gt;
+                                   &lt;p class=&quot;small&quot;&gt; Mogen anderen gebruik maken van je muziek voor commerci&#235;le doeleinden? &lt;a href=&quot;help/ccinfo.php&quot;&gt;Meer info&lt;/a&gt;
+								   &lt;/p&gt;
+								   
+                                    &lt;p class=&quot;small&quot;&gt;
+									&lt;input type=&quot;radio&quot; value=&quot;1&quot; name=&quot;cclicense[commercial]&quot; /&gt; Ja &lt;br /&gt;
+                                    &lt;input type=&quot;radio&quot; value=&quot;0&quot; checked=&quot;checked&quot; name=&quot;cclicense[commercial]&quot; /&gt; Nee &lt;br /&gt;
+									&lt;/p&gt;
+									
+									&lt;p class=&quot;small&quot;&gt;
+                                    Mogen anderen je muziek bewerken? &lt;a href=&quot;help/ccinfo.php&quot;&gt;Meer info&lt;/a&gt;
+									&lt;/p&gt;
+									&lt;p class=&quot;small&quot;&gt;
+                                    &lt;input type=&quot;radio&quot; value=&quot;1&quot; name=&quot;cclicense[derative]&quot; /&gt; Ja &lt;br /&gt;
+                                    &lt;input type=&quot;radio&quot; value=&quot;2&quot; name=&quot;cclicense[derative]&quot; /&gt; Ja, zolang anderen ook gelijk delen &lt;a href=&quot;help/ccinfo.php&quot;&gt;Meer info&lt;/a&gt;&lt;br /&gt;
+                                    &lt;input type=&quot;radio&quot; checked=&quot;checked&quot; value=&quot;0&quot; name=&quot;cclicense[derative]&quot; /&gt; Nee &lt;br /&gt;
+                                    &lt;/p&gt;
+							&lt;/fieldset&gt;
+							&lt;div class=&quot;roundbottom&quot;&gt;&lt;/div&gt;
+							&lt;/div&gt;	
+							
+							&lt;br /&gt;
+							&lt;h2&gt;Stap 3:&lt;/h2&gt;
+							&lt;div class=&quot;roundcont&quot;&gt;
+								&lt;div id=&quot;referenties_kopje&quot;&gt;&lt;/div&gt;
+								&lt;p&gt;Welke bands of artiesten hebben je geinspireerd? Waar komt je muziek bij in de buurt?&lt;/p&gt;
+								&lt;fieldset&gt;
+								
+								&lt;p class=&quot;small&quot;&gt;
+                                    &lt;!-- referenties geven --&gt;
+                                    &lt;label for=&quot;ref[r0]&quot;&gt;Referentie 1:&lt;/label&gt;
+                                    &lt;input type=&quot;text&quot; class=&quot;commentaar_input&quot; id=&quot;ref&quot; name=&quot;ref[]&quot; maxlength=&quot;150&quot; size=&quot;25&quot; /&gt;&lt;br /&gt;
+                                    &lt;label for=&quot;ref[r1]&quot;&gt;Referentie 2:&lt;/label&gt;
+                                    &lt;input type=&quot;text&quot; class=&quot;commentaar_input&quot; id=&quot;ref&quot; name=&quot;ref[]&quot; maxlength=&quot;150&quot; size=&quot;25&quot; /&gt;&lt;br /&gt;
+                                    &lt;label for=&quot;ref[r2]&quot;&gt;Referentie 3:&lt;/label&gt;
+                                    &lt;input type=&quot;text&quot; class=&quot;commentaar_input&quot; id=&quot;ref&quot; name=&quot;ref[]&quot; maxlength=&quot;150&quot; size=&quot;25&quot; /&gt;&lt;br /&gt;
+								&lt;/p&gt;        
+                                    &lt;!-- steekwoorden geven --&gt;
+								&lt;p class=&quot;space&quot;&gt;
+                                    &lt;label for=&quot;tag&quot;&gt;Trefwoorden:&lt;/label&gt;
+                                    &lt;input type=&quot;text&quot; class=&quot;commentaar_input&quot; id=&quot;ref&quot; name=&quot;tag&quot; maxlength=&quot;250&quot; size=&quot;25&quot; /&gt;
+								&lt;/p&gt;
+								
+								&lt;/fieldset&gt;
+							&lt;div class=&quot;roundbottom&quot;&gt;&lt;/div&gt;
+							&lt;/div&gt;		
+							&lt;br /&gt;
+							&lt;h2&gt;Stap 4:&lt;/h2&gt;
+							&lt;div class=&quot;roundcont&quot;&gt;
+							
+							&lt;div id=&quot;omschrijving_kopje&quot;&gt;&lt;/div&gt;
+							&lt;p&gt;Als er iets moeilijk is, dan is het wel je eigen muziek omschrijven. Met behulp van categorieen als emotie, tempo, en dynamiek denken we dat je makkelijker je muziek kunt categoriseren. Geef hier aan (met waardes van 1 - 5) hoe jij denkt dat jouw muziekstuk kan worden omschreven: &lt;/p&gt;
+								&lt;fieldset&gt;
+									
+                                    &lt;!-- MOODS --&gt;
+                                    &lt;?php echo $moodsearch;?&gt;
+                                    
+								&lt;/fieldset&gt;
+							&lt;div class=&quot;roundbottom&quot;&gt;&lt;/div&gt;
+							&lt;/div&gt;
+                                    &lt;!-- some vars--&gt;
+                                    &lt;input type=&quot;hidden&quot; name=&quot;filepath&quot; value=&quot;&lt;?php echo &quot;$id3_info[filenamepath]&quot;?&gt;&quot; /&gt;
+                                    &lt;input type=&quot;hidden&quot; name=&quot;playtime&quot; value=&quot;&lt;?php echo &quot;$id3_info[playtime_seconds]&quot;?&gt;&quot; /&gt;
+                                    &lt;input type=&quot;hidden&quot; name=&quot;filesize&quot; value=&quot;&lt;?php echo &quot;$id3_info[filesize]&quot;?&gt;&quot; /&gt;
+                                    &lt;input type=&quot;hidden&quot; name=&quot;format&quot; value=&quot;&lt;?php echo &quot;$id3_info[fileformat]&quot;?&gt;&quot; /&gt;
+									&lt;input type=&quot;hidden&quot; name=&quot;filename&quot; value=&quot;&lt;?php echo &quot;$filename&quot;;?&gt;&quot; /&gt;
+                                    
+                                    &lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;true&quot; class=&quot;hidden&quot; /&gt;&lt;br /&gt;&lt;br /&gt;
+                                    &lt;input type=&quot;image&quot; src=&quot;img/images/wijzig_nummer.gif&quot; alt=&quot;Wijzig nummer&quot; value=&quot;true&quot;  /&gt;
+                                 
+							&lt;/fieldset&gt;
+                            &lt;/form&gt;
+ 				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
+
+

Added: trunk/users/edit_playlist.php
===================================================================
--- trunk/users/edit_playlist.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/edit_playlist.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,21 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+
+require_once(&quot;template_header.php&quot;); 
+?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_artiesten&quot;&gt;
+					&lt;h1&gt;Wijzig playlist&lt;/h1&gt;
+					&lt;p&gt;
+					Helaas functionaliteit ontbreekt nog...
+					&lt;/p&gt;	
+					
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require_once(&quot;../template_sidebar_footer.php&quot;); ?&gt;

Added: trunk/users/hq.php
===================================================================
--- trunk/users/hq.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/hq.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,108 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once('inc/sm-secure.php');
+require (&quot;template_header.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+$user = $_SESSION['name'];
+require_once(&quot;inc/sm-getprofile.php&quot;);
+//require_once(&quot;inc/marten_kweeries.php&quot;);
+
+
+$info_handle = qGetUserInfo($user);
+$nr_info_rows = mysql_num_rows($info_handle);
+
+$u_row = mysql_fetch_array($info_handle);
+$user_dir = $u_row['homedir_checked'];
+$the_dir = $user_dir . HI_QUALITY_DIR;
+$user_id = $u_row['uid'];
+
+//echo $user_id;
+
+$checked =  qGetCheckedAudioByUID($user_id);
+$nr_checked_songs = mysql_num_rows($checked);
+$audio1_row = mysql_fetch_array($checked);  
+
+//echo $nr_checked_songs;
+
+$wachtrij =  qGetWaitingAudioByUID($user_id);
+$nr_waiting_songs = mysql_num_rows($wachtrij);
+$audio2_row = mysql_fetch_array($wachtrij);  
+
+//get all playlists from this user
+
+$h_playlist = qGetPlaylistByUID($user_id);
+$nr_playlists = mysql_num_rows($h_playlist);
+$playlist_html = null;
+if($nr_playlists &gt; 0) {
+	for($i = 0; $i &lt; $nr_playlists; $i++) {
+		$p = mysql_fetch_array($h_playlist);
+		$playlist_path = str_replace(&quot;/var/www/&quot;, &quot;<A HREF="http://www.">http://www.</A>&quot;, rawurldecode($p['playlist_path']));
+		$playlist_html .= &quot;&lt;li&gt;&lt;a href='users/player.php?p=$playlist_path' title='Beluister playlist: $p[playlist_title]' onclick=\&quot;NewWindow(this.href,'name','300','410','no');return false\&quot;&gt;$p[playlist_title]&lt;/a&gt;&lt;/li&gt;\n&quot;; 
+	}
+} else {
+	$playlist_html .= &quot;Je hebt nog geen playlists aangemaakt. Kies voor 'playlist' in het menu aan de rechterzijde om een playlist aan te maken&quot;;
+}
+
+
+
+
+
+
+?&gt;
+
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_home&quot;&gt;
+					&lt;div&gt;&lt;h1&gt;Welkom &lt;?php echo &quot;$user&quot;;?&gt;&lt;/h1&gt;&lt;/div&gt;
+					
+					&lt;div class=&quot;profile_container&quot;&gt;
+						&lt;div id=&quot;member_foto&quot;&gt;
+							&lt;img alt=&quot;standaard foto&quot; src=&quot;&lt;?php echo $imgsrc; ?&gt;&quot; /&gt;
+						&lt;!-- box links voor standaard contactgegevens --&gt;
+							
+						&lt;/div&gt;
+						
+						&lt;div id=&quot;member_info&quot;&gt;		
+							Dit is je eigen pagina binnen Simuze. Rechts vind je een menu. Je kan jouw eigen muziek uploaden, wat meer over jezelf vertellen en je instellingen wijzigen. Hoe meer je vertelt over jezelf hoe makkelijker het wordt voor anderen om je te vinden. 
+							&lt;br /&gt;&lt;br /&gt;
+							Je kan je eigen playlists samen stellen van de muziek op Simuze. Deze playlists worden weer vergeleken met andere gebruikers, waar je ook mee in contact kan komen. Zo vind je snel en makkelijk nieuwe muziek. Veel plezier! 
+						&lt;/div&gt;
+					&lt;/div&gt;
+					
+					&lt;div class=&quot;kopjelinks_roundcont_donker_links&quot;&gt;
+						&lt;div class=&quot;overzicht_kopje&quot;&gt;&lt;/div&gt;
+						&lt;p class=&quot;small&quot;&gt;
+						&lt;h2&gt;Profiel:&lt;/h2&gt;
+						&lt;ul&gt;
+						&lt;li&gt;&lt;a href=&quot;/live/showprofile.php?username=&lt;?php echo &quot;$user&quot;;?&gt;&quot; title=&quot;bekijk je persoonlijke profiel&quot;&gt;bekijk je persoonlijke profiel &lt;/a&gt;&lt;/li&gt;
+						&lt;/ul&gt;
+						
+						&lt;h2&gt;Jouw eigen muziek (uploads):&lt;/h2&gt;
+						&lt;ul&gt;
+						&lt;li&gt;nieuw geupload en gechecked: &lt;?php echo $nr_checked_songs; ?&gt; &lt;/li&gt;
+						&lt;li&gt;aantal nummers in de wachtrij: &lt;?php echo $nr_waiting_songs; ?&gt; &lt;/li&gt;
+						&lt;/ul&gt;
+						
+						&lt;h2&gt;Jouw playlists&lt;/h2&gt;
+						&lt;ul&gt;
+							&lt;?php echo &quot;$playlist_html&quot;; ?&gt; 
+						&lt;/ul&gt;
+						&lt;/p&gt;
+						
+						&lt;div class=&quot;kopjerechts_onder_donker&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+			
+				&lt;/div&gt;&lt;!-- einde kolom1 div--&gt;
+		
+				
+					
+					
+			
+			
+		&lt;/div&gt;
+	&lt;/div&gt;
+		
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
+		

Added: trunk/users/hq_backup.php
===================================================================
--- trunk/users/hq_backup.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/hq_backup.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,108 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once('inc/sm-secure.php');
+require (&quot;template_header.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+$user = $_SESSION['name'];
+require_once(&quot;inc/sm-getprofile.php&quot;);
+//require_once(&quot;inc/marten_kweeries.php&quot;);
+
+
+$info_handle = qGetUserInfo($user);
+$nr_info_rows = mysql_num_rows($info_handle);
+
+$u_row = mysql_fetch_array($info_handle);
+$user_dir = $u_row['homedir_checked'];
+$the_dir = $user_dir . HI_QUALITY_DIR;
+$user_id = $u_row['uid'];
+
+//echo $user_id;
+
+$checked =  qGetCheckedAudioByUID($user_id);
+$nr_checked_songs = mysql_num_rows($checked);
+$audio1_row = mysql_fetch_array($checked);  
+
+//echo $nr_checked_songs;
+
+$wachtrij =  qGetWaitingAudioByUID($user_id);
+$nr_waiting_songs = mysql_num_rows($wachtrij);
+$audio2_row = mysql_fetch_array($wachtrij);  
+
+//get all playlists from this user
+
+$h_playlist = qGetPlaylistByUID($user_id);
+$nr_playlists = mysql_num_rows($h_playlist);
+$playlist_html = null;
+if($nr_playlists &gt; 0) {
+	for($i = 0; $i &lt; $nr_playlists; $i++) {
+		$p = mysql_fetch_array($h_playlist);
+		$playlist_path = str_replace(&quot;/var/www/&quot;, &quot;<A HREF="http://www.">http://www.</A>&quot;, rawurldecode($p['playlist_path']));
+		$playlist_html .= &quot;&lt;li&gt;&lt;a href='users/player.php?p=$playlist_path' title='Beluister playlist: $p[playlist_title]' onclick=\&quot;NewWindow(this.href,'name','300','410','no');return false\&quot;&gt;$p[playlist_title]&lt;/a&gt;&lt;/li&gt;\n&quot;; 
+	}
+} else {
+	$playlist_html .= &quot;Je hebt nog geen playlists aangemaakt. Kies voor 'playlist' in het menu aan de rechterzijde om een playlist aan te maken&quot;;
+}
+
+
+
+
+
+
+?&gt;
+
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_home&quot;&gt;
+					&lt;div&gt;&lt;h1&gt;Welkom &lt;?php echo &quot;$user&quot;;?&gt;&lt;/h1&gt;&lt;/div&gt;
+					
+					&lt;div class=&quot;profile_container&quot;&gt;
+						&lt;div id=&quot;member_foto&quot;&gt;
+							&lt;img alt=&quot;standaard foto&quot; src=&quot;&lt;?php echo $imgsrc; ?&gt;&quot; /&gt;
+						&lt;!-- box links voor standaard contactgegevens --&gt;
+							
+						&lt;/div&gt;
+						
+						&lt;div id=&quot;member_info&quot;&gt;		
+							Dit is je eigen pagina binnen Simuze. Rechts vind je een menu. Je kan jouw eigen muziek uploaden, wat meer over jezelf vertellen en je instellingen wijzigen. Hoe meer je vertelt over jezelf hoe makkelijker het wordt voor anderen om je te vinden. 
+							&lt;br /&gt;&lt;br /&gt;
+							Je kan je eigen playlists samen stellen van de muziek op Simuze. Deze playlists worden weer vergeleken met andere gebruikers, waar je ook mee in contact kan komen. Zo vind je snel en makkelijk nieuwe muziek. Veel plezier! 
+						&lt;/div&gt;
+					&lt;/div&gt;
+					
+					&lt;div class=&quot;kopjelinks_roundcont_donker_links&quot;&gt;
+						&lt;div class=&quot;overzicht_kopje&quot;&gt;&lt;/div&gt;
+						&lt;p class=&quot;small&quot;&gt;
+						&lt;h2&gt;Profiel:&lt;/h2&gt;
+						&lt;ul&gt;
+						&lt;li&gt;&lt;a href=&quot;/live/showprofile.php?username=&lt;?php echo &quot;$user&quot;;?&gt;&quot; title=&quot;bekijk je persoonlijke profiel&quot;&gt;bekijk je persoonlijke profiel &lt;/a&gt;&lt;/li&gt;
+						&lt;/ul&gt;
+						
+						&lt;h2&gt;Jouw eigen muziek (uploads):&lt;/h2&gt;
+						&lt;ul&gt;
+						&lt;li&gt;aantal nummers online: &lt;?php echo $nr_checked_songs; ?&gt; &lt;/li&gt;
+						&lt;li&gt;aantal nummers in de wachtrij: &lt;?php echo $nr_waiting_songs; ?&gt; &lt;/li&gt;
+						&lt;/ul&gt;
+						
+						&lt;h2&gt;Jouw playlists&lt;/h2&gt;
+						&lt;ul&gt;
+							&lt;?php echo &quot;$playlist_html&quot;; ?&gt; 
+						&lt;/ul&gt;
+						&lt;/p&gt;
+						
+						&lt;div class=&quot;kopjerechts_onder_donker&quot;&gt;&lt;/div&gt;
+					&lt;/div&gt;	
+			
+				&lt;/div&gt;&lt;!-- einde kolom1 div--&gt;
+		
+				
+					
+					
+			
+			
+		&lt;/div&gt;
+	&lt;/div&gt;
+		
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
+		

Added: trunk/users/menurechts.php
===================================================================
--- trunk/users/menurechts.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/menurechts.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1 @@
+&lt;div id=&quot;persmenu&quot;&gt;&lt;img src=&quot;/live/img/images/yellowline.gif&quot;&gt;&lt;a href=&quot;/live/users/profile.php&quot;&gt;profiel&lt;/a&gt;&lt;/div&gt;

Added: trunk/users/overview_music.php
===================================================================
--- trunk/users/overview_music.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/overview_music.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,169 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once('inc/sm-secure.php');
+require_once(&quot;template_header.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+
+//get username from the session
+$username = $_SESSION['name'];
+
+//init some vars
+$log = array();
+$feedback = array();
+$files = array();
+$dir = array();
+$db_files = array();
+$db_rows = array();
+$file_info = array();
+
+//get the users dir with audio
+$dir_handle = qGetUserInfo($username);
+
+//push all the files found in the userhomedir into the $files array
+if($nr_rows = mysql_num_rows ($dir_handle) == 1) {
+    $row = mysql_fetch_array($dir_handle);
+    $user_dir = $row['homedir_checked'];
+    $the_dir = $user_dir . HI_QUALITY_DIR;
+    $userid = $row['uid'];
+    
+    //get all audio info from db
+    if(!empty($userid)) {
+        $audio_handle = qGetAudioByUID($userid);
+        $nr_audio = mysql_num_rows($audio_handle);
+        for($i = 0; $i &lt; $nr_audio; $i++) {
+            $audio_row = mysql_fetch_array($audio_handle);  
+            array_push($db_rows, $audio_row);
+        }
+		if(is_dir($the_dir)) {
+            if($dh = opendir($the_dir)) {
+				//get all files from $the_dir    
+                while (($file = readdir($dh)) !== false) {
+                    if($file != &quot;..&quot; &amp;&amp; $file !=&quot;.&quot;) {
+                        $path = $the_dir . $file;
+                        $file_info['path'] = $path;
+                        $file_info['filename'] = $file;
+                        if($nr_audio &gt; 0) {
+							
+                            foreach($db_rows as $key=&gt;$val) {
+								if($val['audio_filename'] == $file) {
+									$file_info['path'] = $val['audio_path'];
+									$file_info['filename'] = $val['audio_filename'];
+									array_push($db_files, $file_info);
+                                }
+							}
+                        }
+						array_push($files, $file_info);
+                    }
+                } 
+                closedir($dh);
+            }
+        } else {
+            array_push($log, &quot;$the_dir is geen directory&quot;);
+        }
+    } else {
+        array_push($log, &quot;Geen userid aanwezig&quot;);
+    }
+} else {
+    array_push($log, &quot;Geen unieke gebruiker&quot;);
+}
+
+//check for doubles 
+if(is_array($db_files)) {
+	for($i=0;$i &lt; sizeof($files);$i++) {
+		for($j=0;$j &lt; sizeof($db_files);$j++) {
+			$fname = $files[$i]['filename'];
+			$db_name = $db_files[$j]['filename'];
+			if($fname == $db_name) {
+				$files[$i] = 'double';
+			}
+		}
+	}
+}			
+
+//creating the visualisation
+
+//new files table
+$view = null;
+$view .= &quot;&lt;table border=\&quot;0\&quot; cellpadding=\&quot;2\&quot; cellspacing=\&quot;2\&quot;&gt;\n&quot;;
+$view .= &quot;&lt;tr&gt;\n&quot;;                        
+$view .= &quot;&lt;td colspan=\&quot;2\&quot;&gt;De bestanden hieronder zijn gecontroleerd op virussen. Je kunt nu een licentie kiezen en meer informatie meegeven aan het nummer door op &lt;b&gt;Voeg gegevens toe&lt;/b&gt; te klikken rechts van de bestandsnaam.&lt;/td&gt;\n&quot;;
+$view .= &quot;&lt;/tr&gt;&quot;;
+$view .= &quot;&lt;tr&gt;\n&quot;;                        
+$view .= &quot;&lt;th width=\&quot;475\&quot;&gt;Bestandsnaam&lt;/th&gt;\n&quot;;
+$view .= &quot;&lt;th&gt;Actie&lt;/th&gt;\n&quot;;
+$view .= &quot;&lt;/tr&gt;&quot;;
+for($i=0;$i &lt; sizeof($files);$i++) {
+	if($files[$i] != 'double') {
+		$fname = $files[$i]['filename'];
+		$view .= &quot;&lt;tr&gt;\n&quot;;
+		$view .= &quot;&lt;td bgcolor=\&quot;#F8E4B3\&quot;&gt;$fname&lt;/td&gt;\n&quot;;
+		$view .= &quot;&lt;td bgcolor=\&quot;#FED573\&quot;&gt;&lt;a href=\&quot;users/edit_music.php?f=$fname\&quot;&gt;Voeg gegevens toe&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$view .= &quot;&lt;/tr&gt;\n&quot;;
+	}
+}
+$view .= &quot;&lt;/table&gt;\n&quot;;
+
+//files in db table
+$view2 .= &quot;&lt;table border=\&quot;0\&quot; cellpadding=\&quot;2\&quot; cellspacing=\&quot;2\&quot;&gt;\n&quot;;
+$view2 .= &quot;&lt;tr&gt;\n&quot;;                        
+$view2 .= &quot;&lt;td colspan=\&quot;2\&quot;&gt;Deze bestanden zijn klaar voor moderatie. Zolang ze nog in deze lijst staan kun je de gegevens van het bestand nog wijzigen. Dit is echter tijdelijk.&lt;/td&gt;\n&quot;;
+$view2 .= &quot;&lt;/tr&gt;&quot;;
+$view2 .= &quot;&lt;tr&gt;\n&quot;;                        
+$view2 .= &quot;&lt;th width=\&quot;475\&quot;&gt;Bestandsnaam&lt;/th&gt;\n&quot;;
+$view2 .= &quot;&lt;th&gt;Actie&lt;/th&gt;\n&quot;;
+$view2 .= &quot;&lt;/tr&gt;&quot;;
+for($i=0;$i &lt; sizeof($db_files);$i++) {
+		$fname = $db_files[$i]['filename'];
+		$view2 .= &quot;&lt;tr&gt;\n&quot;;
+		$view2 .= &quot;&lt;td bgcolor=\&quot;#F8E4B3\&quot;&gt;$fname&lt;/td&gt;\n&quot;;
+		$view2 .= &quot;&lt;td bgcolor=\&quot;#FED573\&quot;&gt;&lt;a href=\&quot;users/edit_music.php?f=$fname\&quot;&gt;Wijzig gegevens&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$view2 .= &quot;&lt;/tr&gt;\n&quot;;
+}
+$view2 .= &quot;&lt;/table&gt;\n&quot;;
+
+//TODO CREATE TABLE WITH PUBLIC FILES
+
+
+
+?&gt;
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_muziekoverzicht&quot;&gt;
+				    &lt;div&gt;&lt;h1&gt;Muziekoverzicht van: &lt;?php echo &quot;$username&quot;;?&gt;&lt;/h1&gt;&lt;/div&gt;
+                        &lt;p class=&quot;space&quot;&gt;
+						&lt;ol&gt;
+                        	&lt;li&gt;De bestanden in de tabel &lt;b&gt;nieuw&lt;/b&gt; zijn gechecked op virussen en goedgekeurd. Zodra je meer informatie hebt toegevoegd aan deze bestanden (zoals een licentie, titel en referenties) wordt deze in de &lt;b&gt;wachtrij&lt;/b&gt; geplaatst.&lt;/li&gt;
+							&lt;li&gt;Moderators beluisteren je muziek en keuren het goed of af. Hierbij wordt je muziek op geen enkele wijze gekeurd op kwaliteit, maar wordt er gekeken of je muziek aan de algemene regelementen van Simuze voldoet.&lt;/li&gt;
+							&lt;li&gt;Je muziek is goedgekeurd en voor iedereen beschikbaar! Het nummer wordt automatisch in je muziek-lijst gezet op je persoonlijke pagina.&lt;/li&gt;
+						&lt;/ol&gt;	
+                        &lt;/p&gt;
+						&lt;!-- begin nieuwe bestanden tabel --&gt;
+						&lt;div class=&quot;uitleg_roundcont&quot;&gt;
+							&lt;div id=&quot;nieuw_kopje&quot;&gt;&lt;/div&gt;
+							
+								&lt;?php echo $view;?&gt;	
+							
+							&lt;div class=&quot;uitleg_roundbottom&quot;&gt;&lt;/div&gt;
+						&lt;/div&gt;		
+						&lt;!-- begin wachtrij tabel --&gt;
+						&lt;br /&gt;
+						&lt;br /&gt;
+						&lt;div class=&quot;uitleg_roundcont&quot;&gt;
+							&lt;div id=&quot;wachtrij_kopje&quot;&gt;&lt;/div&gt;
+							
+								&lt;?php echo $view2;?&gt;	
+							
+							&lt;div class=&quot;uitleg_roundbottom&quot;&gt;&lt;/div&gt;
+						&lt;/div&gt;		
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
+
+
+
+
+
+

Added: trunk/users/player.php
===================================================================
--- trunk/users/player.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/player.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,28 @@
+&lt;?php
+
+// grab url
+$url = $_GET['p']; 
+
+
+?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</A>&quot;&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
+&lt;head&gt;
+&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=iso-8859-1&quot; /&gt;
+&lt;title&gt;Simuze Player v0.1&lt;/title&gt;
+&lt;/head&gt;
+&lt;body bgcolor=&quot;#7d9fa6&quot; topmargin=&quot;0&quot; leftmargin=&quot;0&quot;&gt;
+
+
+
+&lt;object classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; codebase=&quot;<A HREF="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0">http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0</A>&quot; width=&quot;282&quot; height=&quot;400&quot; id=&quot;simuze_playerv01.swf&quot; align=&quot;left&quot;&gt;
+&lt;param name=&quot;allowScriptAccess&quot; value=&quot;sameDomain&quot; /&gt;
+&lt;param name=&quot;movie&quot; value=&quot;<A HREF="http://www.simuze.nl/live/media/flash/simuze_playerv01.swf?playlist_url=&lt;?php">http://www.simuze.nl/live/media/flash/simuze_playerv01.swf?playlist_url=&lt;?php</A> echo $url; ?&gt;&quot;
+&lt;param name=&quot;quality&quot; value=&quot;high&quot; /&gt;
+&lt;param name=&quot;bgcolor&quot; value=&quot;#7d9fa6&quot; /&gt;
+&lt;embed src=&quot;<A HREF="http://www.simuze.nl/live/media/flash/simuze_playerv01.swf?playlist_url=&lt;?php">http://www.simuze.nl/live/media/flash/simuze_playerv01.swf?playlist_url=&lt;?php</A> echo $url; ?&gt;&quot; quality=&quot;high&quot; bgcolor=&quot;#7d9fa6&quot; width=&quot;282&quot; height=&quot;400&quot; name=&quot;simuze_playerv01.swf&quot; align=&quot;left&quot; allowScriptAccess=&quot;sameDomain&quot; type=&quot;application/x-shockwave-flash&quot; pluginspage=&quot;<A HREF="http://www.macromedia.com/go/getflashplayer">http://www.macromedia.com/go/getflashplayer</A>&quot; /&gt;
+&lt;/object&gt;
+&lt;/body&gt;
+&lt;/html&gt;
+
+

Added: trunk/users/playlist.php
===================================================================
--- trunk/users/playlist.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/playlist.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,141 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-secure.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;template_header.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+//require_once(&quot;inc/external/xspf/class.XSPF.php&quot;);
+
+$user = $_SESSION['name'];
+
+$info_handle = qGetUserInfo($user);
+$nr_info_rows = mysql_num_rows($info_handle);
+if($nr_info_rows == 1) {
+	$u_row = mysql_fetch_array($info_handle);
+	$user_id = $u_row['uid'];
+}
+
+
+
+$h_playlist = qGetPlaylistByUID($user_id);
+$nr_playlists = mysql_num_rows($h_playlist);
+$playlist_html = null;
+if($nr_playlists &gt; 0) {
+	for($i = 0; $i &lt; $nr_playlists; $i++) {
+		$p = mysql_fetch_array($h_playlist);
+		$playlist_path = str_replace(&quot;/var/www/&quot;, &quot;<A HREF="http://www.">http://www.</A>&quot;, rawurldecode($p['playlist_path']));
+		$d = $p['playlist_creationdate'];
+		$the_date = $d{6}.$d{7}.&quot;-&quot;.$d{4}.$d{5}.&quot;-&quot;.$d{0}.$d{1}.$d{2}.$d{3};
+		$playlist_html .= &quot;&lt;tr bgcolor='#EDD8BE'&gt;\n&quot;;
+		$playlist_html .= &quot;&lt;td&gt;&lt;a href='users/player.php?p=$playlist_path' title='Beluister playlist: $p[playlist_title]' onclick=\&quot;NewWindow(this.href,'name','300','410','no');return false\&quot;&gt;$p[playlist_title]&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$playlist_html .= &quot;&lt;td&gt;$p[playlist_description]&lt;/td&gt;\n&quot;;
+		$playlist_html .= &quot;&lt;td&gt;$the_date&lt;/td&gt;\n&quot;;
+		$playlist_html .= &quot;&lt;td&gt;&lt;a href='users/edit_playlist.php?plid=$p[playlist_ID]&amp;action=edit' title='Wijzig playlist'&gt;Wijzig&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$playlist_html .= &quot;&lt;td&gt;&lt;a href='users/edit_playlist.php?plid=$p[playlist_ID]&amp;action=del' title='Verwijder playlist'&gt;Verwijder&lt;/a&gt;&lt;/td&gt;\n&quot;;
+		$playlist_html .= &quot;&lt;/tr&gt;\n&quot;; 
+	}
+} else {
+	$playlist_html .= &quot;Je hebt nog geen playlists aangemaakt. Kies voor 'playlist' in het menu aan de rechterzijde om een playlist aan te maken&quot;;
+}
+
+
+$handle_all = qGetAllPlaylists();
+$nr_allplaylists = mysql_num_rows($handle_all);
+$playlist_select = null;
+if($nr_allplaylists &gt; 0) {
+	$playlist_select = &quot;&lt;label for='play_playlist'&gt;playlists&lt;/label&gt;\n&quot;; 
+	$playlist_select .=&quot;&lt;select id='play_playlist' name='play_playlist' onChange=\&quot;refresh(this);\&quot; /&gt;\n&quot;; 
+	$playlist_select .=&quot;&lt;option value='default'&gt;::beluister zomaar een playlist::&lt;/option&gt;\n&quot;;
+	$done = false;	
+	for($j = 0; $j &lt; $nr_allplaylists; $j++) {
+		$all = mysql_fetch_array($handle_all);
+		$all_path = str_replace(&quot;/var/www/&quot;, &quot;<A HREF="http://www.">http://www.</A>&quot;, rawurldecode($all['playlist_path']));
+		$playlist_select .=&quot;&lt;option value='$all_path'&gt;$all[playlist_title]&lt;/option&gt;\n&quot;;
+		if((rand(0,$nr_allplaylists) % 2) &amp;&amp; !$done) {
+			$rnd_playlist = &quot;&lt;li&gt;&lt;a href='users/player.php?p=$all_path' title='Beluister playlist: $all[playlist_title]' onclick=\&quot;NewWindow(this.href,'name','300','410','no');return false\&quot;&gt;$all[playlist_title]&lt;/a&gt;&lt;/li&gt;&quot;;
+			$done = true;
+		}
+		
+	}
+}else {
+	$playlist_select .= &quot;Er zijn nog geen playlists aangemaakt. Kies voor 'playlist' in het menu aan de rechterzijde om een playlist aan te maken&quot;;
+}
+$playlist_select .=	&quot;&lt;/select&gt;\n&quot;;
+?&gt;
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_playlists&quot;&gt;
+					&lt;h1&gt;Playlist menu&lt;/h1&gt;
+					&lt;p class=&quot;space&quot;&gt;
+						Maak een keuze uit wat je met playlists wilt gaan doen. Meer uitleg over playlists vind je &lt;a href=&quot;/help/playlist.php&quot;&gt;hier&lt;/a&gt;
+					&lt;/p&gt;
+					
+					&lt;form action=&quot;users/playlist_create.php&quot; method=&quot;post&quot; name=&quot;playlist_generate&quot; id=&quot;playlist_generate&quot;&gt;
+					
+						&lt;div class=&quot;roundcont&quot;&gt;
+						&lt;div id=&quot;maakplaylistaan_kopje&quot;&gt;&lt;/div&gt;
+						&lt;p&gt;
+						
+						
+							&lt;fieldset&gt;
+							&lt;label for=&quot;playlist_title&quot;&gt;playlist titel:&lt;/label&gt; 
+							&lt;input type=&quot;text&quot; id=&quot;playlist_title&quot; name=&quot;playlist_title&quot; class=&quot;form_tekstveld&quot; maxlength=&quot;255&quot; size=&quot;25&quot; /&gt;
+							&lt;label for=&quot;playlist_description&quot;&gt;playlist (korte) omschrijving:&lt;/label&gt; 
+							&lt;input type=&quot;text&quot; id=&quot;playlist_description&quot;  class=&quot;form_tekstveld&quot; name=&quot;playlist_description&quot; maxlength=&quot;255&quot; size=&quot;25&quot; /&gt; 
+							&lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;true&quot; /&gt;&lt;br /&gt;&lt;br /&gt;						
+							
+							&lt;/fieldset&gt;
+							
+						&lt;/p&gt;	
+						&lt;div class=&quot;roundbottom&quot;&gt;&lt;/div&gt;
+							
+					&lt;/div&gt;	
+					&lt;br /&gt;
+					&lt;input type=&quot;image&quot; name=&quot;submit&quot; src=&quot;/live/img/images/btn_maak_playlist_aan.gif&quot; value=&quot;maak playlist aan&quot; /&gt;
+				
+				&lt;/form&gt;
+				
+				&lt;br /&gt;&lt;br /&gt;
+					&lt;div class=&quot;uitleg_roundcont&quot;&gt;
+					&lt;div id=&quot;wijzigplaylist_kopje&quot;&gt;&lt;/div&gt;
+					
+
+						&lt;table border=&quot;0&quot; cellpadding=&quot;4&quot; cellspacing=&quot;2&quot;&gt;
+							&lt;tr bgcolor=&quot;#EDD8BE&quot;&gt;
+								&lt;th&gt;Playlist naam&lt;/th&gt;
+								&lt;th&gt;Playlist omschrijving&lt;/th&gt;
+								&lt;th&gt;Datum aangemaakt&lt;/th&gt;
+								&lt;th colspan=&quot;2&quot;&gt;Actie&lt;/th&gt;
+							&lt;/tr&gt;
+							&lt;?php echo $playlist_html ?&gt;
+						&lt;/table&gt;
+					&lt;div class=&quot;uitleg_roundbottom&quot;&gt;&lt;/div&gt;
+				&lt;/div&gt;		
+				&lt;br /&gt;&lt;br /&gt;
+					&lt;h2&gt;Ontdek en beluister playlists&lt;/h2&gt;
+					&lt;div class=&quot;roundcont&quot;&gt;
+						&lt;div class=&quot;roundtop&quot;&gt;&lt;/div&gt;
+						
+							&lt;form action=&quot;users/player.php&quot; method=&quot;post&quot; name=&quot;play&quot; id=&quot;play&quot;&gt;
+								&lt;fieldset&gt;
+									&lt;?php echo $playlist_select ?&gt;	
+								&lt;/fieldset&gt;
+							&lt;/form&gt;	
+						&lt;div class=&quot;roundbottom&quot;&gt;&lt;/div&gt;	
+					&lt;/div&gt;
+								&lt;!--&lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;true&quot; /&gt;	&lt;br /&gt;	--&gt;
+								&lt;!--&lt;input type=&quot;image&quot; name=&quot;submit&quot; src=&quot;/live/img/images/btn_zoek_vergelijkbare.gif&quot; value=&quot;zoek vergelijkbare muziek&quot; /&gt;--&gt;
+							
+						&lt;ul&gt;
+							&lt;?php //echo $rnd_playlist ?&gt;
+							&lt;!--&lt;li&gt;&lt;a href=&quot;&quot; title=&quot;Doe eens gek.&quot;&gt;Meest beluisterde playlist&lt;/a&gt;&lt;/li&gt;--&gt;
+						&lt;/ul&gt;
+						
+					&lt;/ul&gt;
+ 				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
+
+	

Added: trunk/users/playlist_backup.php
===================================================================
--- trunk/users/playlist_backup.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/playlist_backup.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,92 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-secure.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;template_header.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+//require_once(&quot;inc/external/xspf/class.XSPF.php&quot;);
+
+?&gt;
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div&gt;
+					&lt;h1&gt;Playlist menu&lt;/h1&gt;
+					&lt;p&gt;
+						Maak een keuze uit wat je met playlists wilt gaan doen. Meer uitleg over playlists vind je &lt;a href=&quot;/help/playlist.php&quot;&gt;hier&lt;/a&gt;
+					&lt;/p&gt;
+					&lt;h3&gt;Maak playlist aan&lt;/h3&gt;	
+						&lt;form action=&quot;users/playlist_create.php&quot; method=&quot;post&quot; name=&quot;playlist_generate&quot; id=&quot;playlist_generate&quot;&gt;
+						&lt;fieldset&gt;
+						&lt;label for=&quot;playlist_title&quot;&gt;playlist titel:&lt;/label&gt; 
+						&lt;input type=&quot;text&quot; id=&quot;playlist_title&quot; name=&quot;playlist_title&quot; maxlength=&quot;255&quot; size=&quot;15&quot; /&gt;
+						&lt;label for=&quot;playlist_description&quot;&gt;playlist (korte) omschrijving:&lt;/label&gt; 
+						&lt;input type=&quot;text&quot; id=&quot;playlist_description&quot; name=&quot;playlist_description&quot; maxlength=&quot;255&quot; size=&quot;15&quot; /&gt; 
+						&lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;true&quot; /&gt;&lt;br /&gt;&lt;br /&gt;						
+						&lt;input type=&quot;image&quot; name=&quot;submit&quot; value=&quot;maak playlist aan&quot; /&gt;
+						&lt;/fieldset&gt;
+					&lt;/form&gt;	
+					&lt;h3&gt; Wijzig playlist&lt;/h3&gt;
+						&lt;table border=&quot;1&quot;&gt;
+							&lt;tr&gt;
+								&lt;td&gt;Playlist naam&lt;/td&gt;
+								&lt;td&gt;Playlist omschrijving&lt;/td&gt;
+								&lt;td&gt;Aantal nrs&lt;/td&gt;
+								&lt;td&gt;Aantal keren beluisterd&lt;/td&gt;
+								&lt;td&gt;Datum aangemaakt&lt;/td&gt;
+								&lt;td colspan=&quot;2&quot;&gt;Actie&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;&lt;a href=&quot;#&quot; title=&quot;Beluister playlist&quot;&gt;malle ouk&lt;/a&gt;&lt;/td&gt;
+								&lt;td&gt;Vette gave electro shit met trefwoord stoer&lt;/td&gt;
+								&lt;td&gt;154&lt;/td&gt;
+								&lt;td&gt;18&lt;/td&gt;
+								&lt;td&gt;06-06-2005&lt;/td&gt;
+								&lt;td&gt;&lt;a href=&quot;#&quot; title=&quot;wijzig playlist&quot;&gt;Wijzig&lt;/a&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;a href=&quot;#&quot; title=&quot;Verwijder playlist&quot;&gt;Verwijder&lt;/a&gt;&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;&lt;a href=&quot;#&quot; title=&quot;Beluister playlist&quot;&gt;Acid&lt;/a&gt;&lt;/td&gt;
+								&lt;td&gt;Stuiter stuiter ACIEEEEEEEEEED!&lt;/td&gt;
+								&lt;td&gt;14&lt;/td&gt;
+								&lt;td&gt;0&lt;/td&gt;
+								&lt;td&gt;06-06-2005&lt;/td&gt;
+								&lt;td&gt;&lt;a href=&quot;#&quot; title=&quot;wijzig playlist&quot;&gt;Wijzig&lt;/a&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;a href=&quot;#&quot; title=&quot;Verwijder playlist&quot;&gt;Verwijder&lt;/a&gt;&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;&lt;a href=&quot;#&quot; title=&quot;Beluister playlist&quot;&gt;Nederlandstalige Metal&lt;/a&gt;&lt;/td&gt;
+								&lt;td&gt;Brute metal in je moerstaal&lt;/td&gt;
+								&lt;td&gt;11&lt;/td&gt;
+								&lt;td&gt;55&lt;/td&gt;
+								&lt;td&gt;15-06-2005&lt;/td&gt;
+								&lt;td&gt;&lt;a href=&quot;#&quot; title=&quot;wijzig playlist&quot;&gt;Wijzig&lt;/a&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;a href=&quot;#&quot; title=&quot;Verwijder playlist&quot;&gt;Verwijder&lt;/a&gt;&lt;/td&gt;
+							&lt;/tr&gt;
+						&lt;/table&gt;
+					&lt;h3&gt;Ontdek en beluister playlists&lt;/h3&gt;
+						&lt;form action=&quot;users/playlist_generate.php&quot; method=&quot;post&quot; name=&quot;playlist_generate&quot; id=&quot;playlist_generate&quot;&gt;
+							&lt;fieldset&gt;
+								&lt;label for=&quot;playlists&quot;&gt;playlists&lt;/label&gt; 
+								&lt;select id=&quot;playlists&quot; name=&quot;playlists&quot; /&gt; 
+									&lt;option value=&quot;playlist_id&quot;&gt;Playlist 1&lt;/option&gt; 
+									&lt;option value=&quot;playlist_id&quot;&gt;Playlist 2&lt;/option&gt; 
+									&lt;option value=&quot;playlist_id&quot;&gt;Playlist 3&lt;/option&gt; 
+									&lt;option value=&quot;playlist_id&quot;&gt;Playlist 4&lt;/option&gt; 
+									&lt;option value=&quot;playlist_id&quot;&gt;Playlist 5&lt;/option&gt;
+								&lt;/select&gt;	
+								&lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;true&quot; /&gt;						
+								&lt;input type=&quot;image&quot; name=&quot;submit&quot; value=&quot;zoek vergelijkbare muziek&quot; /&gt;
+							&lt;/fieldset&gt;
+						&lt;ul&gt;
+							&lt;li&gt;&lt;a href=&quot;&quot; title=&quot;Doe eens gek.&quot;&gt;Random playlist&lt;/a&gt;&lt;/li&gt;
+							&lt;li&gt;&lt;a href=&quot;&quot; title=&quot;Doe eens gek.&quot;&gt;Meest beluisterde playlist&lt;/a&gt;&lt;/li&gt;
+						&lt;/ul&gt;
+						
+					&lt;/ul&gt;
+ 				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
+
+	

Added: trunk/users/playlist_create.php
===================================================================
--- trunk/users/playlist_create.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/playlist_create.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,107 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-secure.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;template_header.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+
+$log = array();
+$feedback = array();
+
+$show = false;
+
+if(!empty($_POST['playlist_title']) &amp;&amp; checkContainsAlfaNum($_POST['playlist_title'])) {
+	$playlist_title = $_POST['playlist_title'];
+	if(!empty($_POST['playlist_description']) &amp;&amp; checkContainsAlfaNum($_POST['playlist_description'])) {
+		$playlist_description = $_POST['playlist_description'];
+		$show = true;
+	} else {
+		array_push($feedback, &quot;geen playlist beschrijving, kan geen playlist genereren&quot;);
+	}
+} else {
+	array_push($feedback, &quot;geen playlist naam, kan geen playlist genereren&quot;);
+}
+
+// create moodsearch
+$moodsearch = createMoodSearch();
+
+// create genre select
+$genre = createSelectGenre();
+
+// create tag select 
+$tag = createSelectTag();
+
+?&gt;
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_playlists&quot;&gt;
+					&lt;?php 
+						if(!$show) {
+							foreach($feedback as $key=&gt;$val) {
+								echo &quot;$val&quot;;
+							}
+						} else {
+					?&gt;
+				
+					&lt;h1&gt;Playlist menu&lt;/h1&gt;
+					&lt;p class=&quot;space&quot;&gt;
+						&lt;!--Genereer een playlist. Je kan kiezen uit verschillende varianten of een lege playlist die je met de hand kunt vullen.
+						Meer uitleg over playlists vind je &lt;a href=&quot;/help/playlist.php&quot;&gt;hier&lt;/a&gt;.--&gt;
+						
+						Voorlopig kan je alleen nog een random playlist genereren, maar binnenkort kan je hier ook een lege playlist aanmaken (die je dan zelf kan vullen) en ook een playlist genereren aan de hand van moods, omschrijving en licentie. De titel en een beschrijving voor de playlist heb je al
+						gekozen en staat hieronder nogmaals vermeldt. Je kan dit later altijd nog wijzigen. 
+					&lt;/p&gt;
+					&lt;h2&gt;Playlist titel en beschrijving&lt;/h2&gt;
+					&lt;ul&gt;
+						&lt;li&gt;Playlist titel:&lt;b&gt; &lt;?php echo $playlist_title; ?&gt; &lt;/b&gt;&lt;/li&gt;
+						&lt;li&gt;Playlist omschrijving: &lt;b&gt; &lt;?php echo $playlist_description; ?&gt; &lt;/b&gt; &lt;/li&gt;
+					&lt;/ul&gt;
+					&lt;br /&gt;
+					&lt;br /&gt;
+					&lt;!-- create empty playlist with a name and description --&gt;
+					&lt;!--
+					&lt;form action=&quot;users/sm-playlist_generate.php&quot; method=&quot;post&quot; name=&quot;playlist_empty&quot; id=&quot;playlist_empty&quot;&gt;
+						&lt;h2&gt;Lege playlist&lt;/h2&gt;
+						&lt;p class=&quot;space&quot;&gt;Je kan hier een lege playlist genereren voor als je een playlist zelf wilt vullen.&lt;/p&gt;
+						&lt;fieldset&gt;
+							&lt;p class=&quot;small&quot;&gt;
+								&lt;label for=&quot;empty_playlist&quot;&gt;&lt;a href=&quot;#&quot; title=&quot;meer informatie&quot;&gt;meer informatie?&lt;/a&gt;&lt;/label&gt; 
+								&lt;input type=&quot;hidden&quot; name=&quot;type_playlist&quot; value=&quot;empty_playlist&quot;/&gt;&lt;br /&gt;
+								&lt;input type=&quot;hidden&quot; name=&quot;playlist_title&quot; value=&quot;&lt;?php echo $playlist_title?&gt;&quot;/&gt;&lt;br /&gt;
+								&lt;input type=&quot;hidden&quot; name=&quot;playlist_description&quot; value=&quot;&lt;?php echo $playlist_description?&gt;&quot;/&gt;
+								&lt;input type=&quot;image&quot; src=&quot;/live/img/images/btn_maak_lege_playlist.gif&quot; value=&quot;Lege playlist genereren&quot;/&gt;&lt;br /&gt;
+							&lt;/p&gt;
+						&lt;/fieldset&gt;
+					&lt;/form&gt;
+					&lt;br /&gt;
+					&lt;br /&gt;
+					--&gt;
+					&lt;!-- generate random playlist --&gt;		
+					
+					&lt;h2&gt;Willekeurige playlist&lt;/h2&gt;
+					&lt;p class=&quot;space&quot;&gt;Doe eens gek..laat het systeem voor je een playlist genereren. Laat je verrassen.&lt;/p&gt; 
+					&lt;form action=&quot;users/sm-playlist_generate.php&quot; method=&quot;post&quot; name=&quot;playlist_empty&quot; id=&quot;playlist_empty&quot;&gt;
+						&lt;fieldset&gt;
+							&lt;!-- random playlist aanmaken --&gt;
+							&lt;p class=&quot;small&quot;&gt;
+								&lt;label for=&quot;rnd_playlist&quot;&gt;&lt;a href=&quot;#&quot; title=&quot;meer informatie&quot;&gt;meer informatie?&lt;/a&gt;&lt;/label&gt; 
+								&lt;input type=&quot;hidden&quot; name=&quot;type_playlist&quot; value=&quot;random_playlist&quot;/&gt;&lt;br /&gt;
+								&lt;input type=&quot;hidden&quot; name=&quot;playlist_title&quot; value=&quot;&lt;?php echo $playlist_title?&gt;&quot;/&gt;&lt;br /&gt;
+								&lt;input type=&quot;hidden&quot; name=&quot;playlist_description&quot; value=&quot;&lt;?php echo $playlist_description?&gt;&quot;/&gt;
+								&lt;input type=&quot;image&quot; src=&quot;/live/img/images/btn_verras_me.gif&quot; name=&quot;submit&quot; value=&quot;Verras me! Genereer willekeurige playlist&quot;/&gt;&lt;br /&gt;
+							&lt;/p&gt;
+						&lt;/fieldset&gt;
+					&lt;/form&gt;	
+					&lt;br /&gt;
+					&lt;br /&gt;
+					&lt;!-- generate a specific playlist --&gt;
+					
+					&lt;!-- de rest van de opties heb staan voorlopig even in playlist_create_meeropties.php --&gt; 
+						&lt;?php }?&gt;
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
+
+

Added: trunk/users/profile.php
===================================================================
--- trunk/users/profile.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/profile.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,146 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once('inc/sm-secure.php');
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+$user = $_SESSION['name'];
+require_once(&quot;inc/sm-getprofile.php&quot;);
+?&gt;
+
+&lt;?php require '../template_header.php'; ?&gt;	
+
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_profiel&quot;&gt;
+				&lt;h1&gt;Profiel pagina&lt;/h1&gt;
+                &lt;p class=&quot;space&quot;&gt;Beste &lt;?php echo&quot;$user&quot;?&gt;,&lt;/p&gt;
+                &lt;p class=&quot;space&quot;&gt;Als je wilt kun je hier meer info over jezelf kwijt. Als je goed gebruik van Simuze wilt maken is het handig
+                om dit profiel zo volledig mogelijk in te vullen. Alles wat hier staat is optioneel en via je instellingen kun je evt
+                nog duidelijk aangeven wat zichtbaar is en voor wie.&lt;/p&gt;
+				&lt;form action=&quot;users/sm-profile.php&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot; name=&quot;register&quot; id=&quot;register&quot;&gt;
+				
+				&lt;div class=&quot;profiel_roundcont&quot;&gt;
+					&lt;div id=&quot;profiel_info&quot;&gt;&lt;/div&gt;
+					&lt;p&gt;Hier kun je jouw persoonlijke info kwijt. &lt;/p&gt;
+					&lt;fieldset&gt;
+					&lt;!-- Leukigheidjes --&gt;
+					&lt;label for=&quot;fname&quot; class=&quot;profiel&quot;&gt;voornaam:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;fname&quot; name=&quot;fname&quot; maxlength=&quot;50&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[firstname]&quot;;?&gt;&quot; /&gt; 
+					&lt;label for=&quot;sname&quot; class=&quot;profiel&quot;&gt;achternaam:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;sname&quot; name=&quot;sname&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[lastname]&quot;;?&gt;&quot; /&gt; 
+					&lt;label for=&quot;artistname&quot; class=&quot;profiel&quot;&gt;artiestennaam:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;artistname&quot; name=&quot;artistname&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[artistname]&quot;;?&gt;&quot; /&gt; 
+					&lt;label for=&quot;selyear&quot; class=&quot;profiel&quot;&gt;geboortedatum:&lt;/label&gt;
+					&lt;?php 
+						echo &quot;$day&quot;;
+						echo &quot;$month&quot;;    
+						echo &quot;$year&quot;; ?&gt;
+						&lt;br /&gt;
+					&lt;label for=&quot;zipcode&quot; class=&quot;profiel&quot;&gt;postcode:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;zipcode&quot; name=&quot;zipcode&quot; maxlength=&quot;6&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[zipcode]&quot;;?&gt;&quot; /&gt;
+                    &lt;label for=&quot;location&quot; class=&quot;profiel&quot;&gt;woonplaats:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;location&quot; name=&quot;location&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[location]&quot;;?&gt;&quot; /&gt; 
+                    &lt;label for=&quot;selprovincie&quot; class=&quot;profiel&quot;&gt;provincie:&lt;/label&gt;
+					&lt;?php echo &quot;$provincies&quot;; ?&gt;
+					&lt;/fieldset&gt;
+					&lt;div class=&quot;profiel_roundbottom&quot;&gt;&lt;/div&gt;
+				&lt;/div&gt;
+				
+				&lt;p&gt;&lt;/p&gt;
+				&lt;div class=&quot;profiel_roundcont&quot;&gt;
+					&lt;div id=&quot;profiel_bio&quot;&gt;&lt;/div&gt;
+					&lt;p&gt;Wie ben je en wat wil je kwijt aan deze wereld? Vertel je levensverhaal, maar hou het wel kort want je hebt maar 1500 letters. &lt;/p&gt;
+					&lt;fieldset&gt;
+					&lt;label for=&quot;bio&quot; class=&quot;profiel&quot;&gt;Bio :&lt;/label&gt;&lt;input type=&quot;text&quot; size=&quot;4&quot; readonly disabled=&quot;disabled&quot; maxlength=&quot;4&quot; name=&quot;maxChars&quot; value=&quot;1500&quot; /&gt;tekens over&lt;br /&gt;&lt;br /&gt;
+					&lt;textarea name=&quot;bio&quot; class=&quot;bio&quot; cols=&quot;40&quot; rows=&quot;15&quot; onKeyDown=&quot;textCounter(this.form.bio,this.form.maxChars,1500);&quot; onKeyUp=&quot;textCounter(this.form.bio,this.form.maxChars,1500);&quot;&gt;&lt;?php echo &quot;$checked_data[bio]&quot;;?&gt;&lt;/textarea&gt;
+					&lt;p class=&quot;space&quot;&gt;&lt;/p&gt;
+					&lt;p&gt;Upload hier je vakantie kiekje, je pasfoto of natuurlijk je bandfoto. Je plaatje mag een maximale grootte hebben van &lt;b&gt;75kb&lt;/b&gt;, en wordt automatisch geschaald naar een formaat van &lt;b&gt;240 x 180 &lt;/b&gt;pixels.&lt;/p&gt;
+					&lt;label for=&quot;avatar&quot; class=&quot;profiel&quot;&gt;plaatje:&lt;/label&gt;
+					&lt;img alt=&quot;standaard foto&quot; src=&quot;&lt;?php echo $imgsrc; ?&gt;&quot; /&gt;
+					&lt;input type=&quot;file&quot; name=&quot;avatar&quot; class=&quot;bio&quot; /&gt;
+					
+				
+					&lt;/fieldset&gt;
+					&lt;div class=&quot;profiel_roundbottom&quot;&gt;&lt;/div&gt;
+				&lt;/div&gt;
+				&lt;p&gt;&lt;/p&gt;
+				&lt;div class=&quot;profiel_roundcont&quot;&gt;
+					&lt;div id=&quot;profiel_com&quot;&gt;&lt;/div&gt;
+					&lt;p&gt;Mocht je nog de intentie hebben om met andere mensen te communiceren, maak ze het dan meteen even wat makkelijker door deze lijst in te vullen.&lt;/p&gt;
+					&lt;fieldset&gt;
+					&lt;label for=&quot;IM_msn&quot; class=&quot;profiel&quot;&gt;&lt;a href=&quot;<A HREF="http://www.imagine-msn.com">http://www.imagine-msn.com</A>&quot;&gt;MSN:&lt;/a&gt;&lt;/label&gt;  
+					&lt;input type=&quot;text&quot; id=&quot;IM_msn&quot; name=&quot;IM[im_msn]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[im_msn]&quot;;?&gt;&quot; /&gt; 
+					&lt;label for=&quot;IM_icq&quot; class=&quot;profiel&quot;&gt;&lt;a href=&quot;<A HREF="http://www.icq.com/download">http://www.icq.com/download</A>&quot;&gt;ICQ:&lt;/a&gt;&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;IM_icq&quot; name=&quot;IM[im_icq]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[im_icq]&quot;;?&gt;&quot; /&gt; 
+					&lt;label for=&quot;IM_skype&quot; class=&quot;profiel&quot;&gt;&lt;a href=&quot;<A HREF="http://www.skype.com/download">http://www.skype.com/download</A>&quot;&gt;Skype:&lt;/a&gt;&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;IM_skype&quot; name=&quot;IM[im_skype]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[im_skype]&quot;;?&gt;&quot; /&gt; 
+					&lt;label for=&quot;IM_aim&quot; class=&quot;profiel&quot;&gt;&lt;a href=&quot;<A HREF="http://www.aim.com">http://www.aim.com</A>&quot;&gt;AIM:&lt;/a&gt;&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;IM_aim&quot; name=&quot;IM[im_aim]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[im_aim]&quot;;?&gt;&quot; /&gt; 
+					&lt;label for=&quot;IM_yahoo&quot; class=&quot;profiel&quot;&gt;&lt;a href=&quot;<A HREF="http://messenger.yahoo.com">http://messenger.yahoo.com</A>&quot;&gt;Yahoo:&lt;/a&gt;&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;IM_yahoo&quot; name=&quot;IM[im_yahoo]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[im_yahoo]&quot;;?&gt;&quot; /&gt; 
+					&lt;label for=&quot;IM_ichat&quot; class=&quot;profiel&quot;&gt;&lt;a href=&quot;<A HREF="http://www.apple.com/ichat">http://www.apple.com/ichat</A>&quot;&gt;iChat:&lt;/a&gt;&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;IM_ichat&quot; name=&quot;IM[im_ichat]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[im_ichat]&quot;;?&gt;&quot; /&gt;
+					&lt;label for=&quot;IM_jabber&quot; class=&quot;profiel&quot;&gt;&lt;a href=&quot;<A HREF="http://www.jabber.org/">http://www.jabber.org/</A>&quot;&gt;Jabber:&lt;/a&gt;&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;IM_jabber&quot; name=&quot;IM[im_jabber]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[im_jabber]&quot;;?&gt;&quot; /&gt;
+					&lt;/fieldset&gt;
+					&lt;div class=&quot;profiel_roundbottom&quot;&gt;&lt;/div&gt;
+				&lt;/div&gt;
+				&lt;p&gt;&lt;/p&gt;	
+				&lt;!-- Links  --&gt;
+				&lt;div class=&quot;profiel_roundcont&quot;&gt;
+					&lt;div id=&quot;profiel_links&quot;&gt;&lt;/div&gt;
+					&lt;p&gt;Post hier je linkjes. Eigen site? Leuk forum? Laat de rest van de wereld zien welke sites je volgens jou moet bezoeken.&lt;/p&gt;
+					&lt;fieldset&gt;
+					&lt;label for=&quot;link1&quot; class=&quot;profiel&quot;&gt;Link 1:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;link1&quot; name=&quot;link[url_1]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[url_1]&quot;;?&gt;&quot; /&gt;
+					&lt;label for=&quot;link2&quot; class=&quot;profiel&quot;&gt;Link 2:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;link2&quot; name=&quot;link[url_2]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[url_2]&quot;;?&gt;&quot; /&gt;
+					&lt;label for=&quot;link3&quot; class=&quot;profiel&quot;&gt;Link 3:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;link3&quot; name=&quot;link[url_3]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[url_3]&quot;;?&gt;&quot; /&gt;
+					&lt;/fieldset&gt;
+					&lt;div class=&quot;profiel_roundbottom&quot;&gt;&lt;/div&gt;
+				&lt;/div&gt;
+				&lt;p&gt;&lt;/p&gt;
+					&lt;!-- Bands --&gt;
+				&lt;div class=&quot;profiel_roundcont&quot;&gt;
+					&lt;div id=&quot;profiel_musica&quot;&gt;&lt;/div&gt;
+					&lt;p&gt;Wat is je favoriete band/producer/dj/artiest? Hieronder kun je je top 3 kwijt:&lt;/p&gt;
+					&lt;fieldset&gt;
+					&lt;label for=&quot;favo_music1&quot; class=&quot;profiel&quot;&gt;met stip nr. 1:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;favo_music1&quot; name=&quot;musica[musica_1]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[musica_1]&quot;;?&gt;&quot; /&gt;
+					&lt;label for=&quot;favo_music2&quot; class=&quot;profiel&quot;&gt;een goede 2e:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;favo_music2&quot; name=&quot;musica[musica_2]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[musica_2]&quot;;?&gt;&quot; /&gt;
+					&lt;label for=&quot;favo_music3&quot; class=&quot;profiel&quot;&gt;een dikke 3:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;favo_music3&quot; name=&quot;musica[musica_3]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[musica_3]&quot;;?&gt;&quot; /&gt;
+					&lt;/fieldset&gt;
+					&lt;div class=&quot;profiel_roundbottom&quot;&gt;&lt;/div&gt;
+				&lt;/div&gt;	
+				&lt;p&gt;&lt;/p&gt;
+				&lt;div class=&quot;profiel_roundcont&quot;&gt;
+					&lt;div id=&quot;profiel_aanraders&quot;&gt;&lt;/div&gt;
+					&lt;p&gt;Wat is je favoriete boek? Welke film moet je hebben gezien voordat je deze aarde verlaat? Welke plaat kan je zeker 6x per dag opzetten zonder gek te worden? Welke kroeg, discotheek, theater, of paintball gelegenheid bevalt je het best? Vul hier je aanraders in:&lt;/p&gt;
+					&lt;fieldset&gt;
+					&lt;label for=&quot;must_read&quot; class=&quot;profiel&quot;&gt;lezen:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;must_read&quot; name=&quot;must[must_read]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[must_read]&quot;;?&gt;&quot; /&gt;
+					&lt;label for=&quot;must_see&quot; class=&quot;profiel&quot;&gt;kijken:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;must_see&quot; name=&quot;must[must_see]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[must_see]&quot;;?&gt;&quot; /&gt;
+					&lt;label for=&quot;must_listen&quot; class=&quot;profiel&quot;&gt;luisteren:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;must_listen&quot; name=&quot;must[must_listen]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[must_listen]&quot;;?&gt;&quot; /&gt;
+					&lt;label for=&quot;must_goto&quot; class=&quot;profiel&quot;&gt;bezoeken:&lt;/label&gt; 
+					&lt;input type=&quot;text&quot; id=&quot;must_goto&quot; name=&quot;must[must_visit]&quot; maxlength=&quot;250&quot; size=&quot;35&quot; class=&quot;form_tekstveld&quot; value=&quot;&lt;?php echo &quot;$checked_data[must_visit]&quot;;?&gt;&quot; /&gt;
+					&lt;input type=&quot;hidden&quot; name=&quot;pid&quot; value=&quot;&lt;?php echo $pid?&gt;&quot; class=&quot;hidden&quot; /&gt;
+                    &lt;input type=&quot;hidden&quot; name=&quot;uid&quot; value=&quot;&lt;?php echo $uid?&gt;&quot; class=&quot;hidden&quot; /&gt;
+                    &lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;true&quot; class=&quot;hidden&quot; /&gt;
+                    &lt;input type=&quot;hidden&quot; name=&quot;MAX_FILE_SIZE&quot; value=&quot;&lt;?php echo AVATAR_MAX_SIZE; ?&gt;&quot; /&gt;
+					&lt;/fieldset&gt;
+					&lt;div class=&quot;profiel_roundbottom&quot;&gt;&lt;/div&gt;
+				&lt;/div&gt;
+				&lt;p&gt;&lt;input type=&quot;image&quot; title=&quot;wijzig je profiel&quot; class=&quot;profile_btn&quot; src=&quot;img/images/wijzigen_btn.gif&quot; alt=&quot;wijzig je profiel&quot; value=&quot;true&quot; /&gt;
+				&lt;/p&gt;
+			&lt;/form&gt;			
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+		&lt;?php require '../template_sidebar_footer.php'; ?&gt;
\ No newline at end of file

Added: trunk/users/sm-change_settings.php
===================================================================
--- trunk/users/sm-change_settings.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/sm-change_settings.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,120 @@
+&lt;?php
+// +----------------------------------------------------------------------+
+// | Simuze                                                               |
+// +----------------------------------------------------------------------+
+// | Copyright (c) 2005 Stichting Open Media or noted otherwise           |
+// +----------------------------------------------------------------------+
+// | License: See below code                                              |
+// +----------------------------------------------------------------------+
+// | Author(s): Bjorn Wijers &lt;bwijers[AT]bdisfunctional[DOT]net&gt;          |
+// |                                                                      |
+// +----------------------------------------------------------------------+
+//
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/class.phpmailer.php&quot;);
+
+
+
+//init 
+$continue = false;
+
+//init feedback var
+$feedback = array();
+
+//init log var
+$log = array();
+
+//process input
+$uname   = trim(strtolower($_POST['uname']));
+$email   = trim(strtolower($_POST['email']));
+$pwd     = trim(strtolower($_POST['password']));
+$pwd2    = trim(strtolower($_POST['password2']));
+
+
+//check if both passwords are the same, type and content
+//therefor the triple =!
+if($pwd === $pwd2){
+	if (!empty($email) &amp;&amp; CheckInputValid($email)) {
+		//addslashes b4 insertion
+		$uname   = addslashes($uname);
+		$email   = addslashes($email);
+		$pwd    = addslashes($pwd);
+		
+		//encrypt pwd with md5 hash
+		$pwd = CryptIt(&quot;md5&quot;,$pwd);
+		$values = array ('uname'=&gt;$uname,'email'=&gt;$email,'pwd'=&gt;$pwd);	
+			
+		//insert into db
+		$id = qUpdateUserSettings($values);
+				
+		//setting up the email body message
+		$settings_msg = CHANGE_SETTINGS_EMAIL_MSG;
+		$settings_msg = str_replace( &quot;##NAME##&quot;, $uname, $settings_msg);
+		// $settings_msg = str_replace( &quot;##HASH##&quot;, $settings_msg);
+				
+		//sent BCC to
+		$bcc = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">bjorn at waag.org</A>&quot;;
+
+							   
+		if($id &gt; 0) {
+			//insert succesfull, send email for confirmation
+			$mail = new PHPMailer();
+			$mail-&gt;IsSendmail();
+			$mail-&gt;AddAddress($email);
+			$mail-&gt;AddBCC($bcc);
+			$mail-&gt;FromName = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">simuzerobot at simuze.com</A>&quot;;
+			$mail-&gt;From = &quot;<A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">simuzerobot at simuze.com</A>&quot;;
+			$mail-&gt;Subject = &quot;instellingen gewijzigd van Simuze.nl&quot;;
+			$mail-&gt;Body = $settings_msg;
+			//$mail-&gt;WordWrap = 72;
+			
+			if(!$mail-&gt;Send()) {
+				//redirect in case of problems with sending the mail
+			   //header(&quot;Location: $send_false_url&quot;);
+			   array_push($log, &quot;Instellingen wijzigen mislukt! Email is niet verzonden&quot;);
+			} else {
+				//redirect in case of succesfull sending the mail
+			   // header(&quot;Location: $send_true_url&quot;);
+			   $continue = true;
+			   array_push($feedback, &quot;Instellingen wijzigen geslaagd! Er wordt zo spoedig mogelijk een email met verdere aanwijzingen naar $email gestuurd.&quot;);
+			}
+		} else {
+			//insert failed
+			array_push($log, &quot;Instellingen wijzigen mislukt! Registratie is niet niet aan database toegevoegd&quot;);
+		}
+	} else {
+		//email invalid
+		array_push($log, &quot;Instellingen wijzigen mislukt! Het emailadres wat je hebt ingevuld bevat ongeldige tekens. Een email adres bestaat meestal uit: <A HREF="https://lists.berlios.de/mailman/listinfo/simuze-svn">gebruikersnaam at domein.extensie</A>&quot;);
+	}
+} else {
+    array_push($log, &quot;Registratie mislukt! Wachtwoorden zijn niet gelijk&quot;);
+}
+?&gt;
+&lt;?php require_once(&quot;template_header.php&quot;);?&gt;
+&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Instellingen wijzigen&lt;/h1&gt;
+                    &lt;p class=&quot;space&quot;&gt;
+                    &lt;?php
+                    if($continue) {
+                        foreach($feedback as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        }
+                    } else {
+                         foreach($log as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        }
+                    }
+                    ?&gt;                
+                    &lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require_once(&quot;template_sidebar_footer.php&quot;);?&gt;
+
+

Added: trunk/users/sm-edit-music.php
===================================================================
--- trunk/users/sm-edit-music.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/sm-edit-music.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,269 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-secure.php&quot;);
+require_once(&quot;template_header.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/external/getid3/getid3.php&quot;);
+
+/**
+*   Creative Commons license:
+*   
+*   cclicense[nc]   
+*   cclicense[derative]
+*
+*   nc: 1 [no commericial use]
+*   nc: 0 [commercial use]
+*
+*   derative: 1 [derative us]
+*   derative: 2 [derative under same license]
+*   derative: 0 [no derative]
+*/
+
+$log = array();
+$feedback = array();
+$continue = false;
+
+
+//get userid
+$user = $_SESSION['name'];
+$uhandle = qGetUser($user);
+if($nr_user = mysql_num_rows($uhandle) == 1) {
+    $urow = mysql_fetch_array($uhandle);
+    $uid = $urow['uid']; 
+    if(!empty($_POST['filename']) &amp;&amp; checkFileName($_POST['filename'])) {
+        if(!empty($_POST['__aname']) &amp;&amp; checkTextValid($_POST['__aname'])){
+            if(!empty($_POST['__stitle']) &amp;&amp; checkTextValid($_POST['__stitle'])){
+                if(is_numeric($_POST['genre'])) {
+                    if(!empty($_POST['filepath'])) {
+                        
+                        // do stuff NOTE: TO prepare for db insert!!    
+                        $fname = addslashes(strtr($_POST['filename'], &quot; &quot;, &quot;_&quot;)); //replace spaces by _
+                        $aname = addslashes($_POST['__aname']);
+                        $genre_id = addslashes($_POST['genre']);
+                        $filepath_hi = $_POST['filepath'];
+                        echo &quot;$filepath_hi&lt;br /&gt;&quot;;
+                        $filepath_lo = str_replace(HI_QUALITY_DIR, LO_QUALITY_DIR, $filepath_hi); //make sure we know where to get the low quality mp3 as welll
+                        echo &quot;$filepath_lo&lt;br /&gt;&quot;;
+                        $filepath_hi = rawurlencode($filepath_hi);
+                        $filepath_lo = rawurlencode($filepath_lo);
+                        // NOTE: Sun Apr 17 22:59:41 CEST 2005 BW fix the time string with the hours and days. Check getId3
+
+                        $playtime = addslashes($_POST['playtime']); //in sec
+						
+						
+                        $filesize = addslashes($_POST['filesize']); //in bytes
+                        $fileformat = addslashes($_POST['format']);
+                        $songtitle = addslashes($_POST['__stitle']);
+                        
+                        
+                        // do album [OPTIONAL]
+                        if(!empty($_POST['album']) &amp;&amp; checkTextValid($_POST['album'])) {
+                            $album = addslashes($_POST['album']);
+                        } else {
+                            array_push($log, &quot;Albumveld is leeg of bevat ongeldige tekens&quot;);
+                        }
+                        
+        
+                        // do license stuff [see info at top of file]
+                        if(is_numeric($_POST['cclicense']['commercial'])) {
+                            if(is_numeric($_POST['cclicense']['derative'])) {
+                                $commercial = $_POST['cclicense']['commercial'];
+                                $derative = $_POST['cclicense']['derative'];
+                                
+                                // do reference stuff [OPTIONAL]
+                                if(!empty($_POST['ref']) &amp;&amp; is_array($_POST['ref'])) {
+                                    $ref_ok = array();
+                                    foreach($_POST['ref'] as $kref=&gt;$vref) {
+                                        if(!empty($vref) &amp;&amp; checkTextValid($vref)) {
+                                            array_push($ref_ok, $vref);        
+                                        } else {
+                                            array_push($log, &quot;Referentie $kref: is leeg of ongeldig&quot;);
+                                        }
+                                    }
+                                }
+                                // do tag stuff [OPTIONAL]
+                                if(!empty($_POST['tag']) &amp;&amp; checkFileName($_POST['tag'])) { //not a filename, but just as limited
+									$tags = explode(&quot; &quot;, strtolower(trim($_POST['tag'])));
+                                } else {
+                                    array_push($log, &quot;Trefwoordenveld: is leeg of bevat ongeldige tekens&quot;);
+                                }
+                                
+                                // do mood search [OPTIONAL]
+                                if(!empty($_POST['moods']) &amp;&amp; is_array($_POST['moods'])) {
+                                    $moods_ok = array();
+                                    foreach($_POST['moods'] as $kmood=&gt;$vmood) {
+                                        if(is_numeric($vmood)){
+                                            $moods_ok[$kmood] = $vmood;
+                                        } else {
+                                            array_push($log, &quot;Mood $kmood: is ongeldig&quot;);
+                                        }
+                                    }
+                                } else {
+								            array_push($log, &quot;Mood is geen array&quot;);
+								}
+								
+								
+                                // do db stuff. get license id
+                                $handle_license = qGetLicenseByOption($commercial, $derative);
+								echo (&quot;De niet_commercieel is: $commercial&lt;br /&gt;&quot;);
+								echo (&quot;De gelijk_delen is: $derative&lt;br /&gt;&quot;);
+                                if($nr_license = mysql_num_rows($handle_license) == 1) {
+                                    $row_license = mysql_fetch_array($handle_license);
+                                    $license_id = $row_license['cclicense_id'];
+                                    
+                                    //audio insert
+                                   
+                                    $audioID = qInsertAudio($genre_id, $license_id, $fileformat, $filepath_hi, $filepath_lo, $fname, $songtitle, $aname, $album, $playtime, $filesize, $uid);
+                                    if($audioID &gt; 0) {
+										//insert optionals
+										
+										//first check if reference already exists
+										foreach($ref_ok as $kr=&gt;$vr) {
+											$handle_ref = qGetRefByName($vr,true); //query case-sensitive
+											if($refnr = mysql_num_rows($handle_ref) &gt; 0) {
+												//get the existing id and put this in the db
+												$dbref = mysql_fetch_array($handle_ref);
+												qInsertAudioRef($audioID, $dbref['reference_id']); 
+											} else {
+												$ref_id = qInsertRef($vr);
+												qInsertAudioRef($audioID, $ref_id);
+											}
+										}
+																				
+										//do the tags
+										foreach($tags as $tagkey=&gt;$tagvalue) {
+											if(checkContainsAlfaNum($tagvalue)){ 
+												$tag_handle = qGetTagByName($tagvalue, true); //query case-sensitive
+												if($tagnr = mysql_num_rows($tag_handle) &gt; 0) {
+													//get the existing id and put this in the db
+													$dbtag = mysql_fetch_array($tag_handle);
+													qInsertAudioTag($audioID, $dbtag['tag_id']); 
+												} else {
+													$tag_id = qInsertTag($tagvalue);
+													qInsertAudioTag($audioID, $tag_id);
+												}
+											}	
+										}
+										
+										//do the mood search
+										foreach($moods_ok as $mood_id=&gt;$mood_value) {
+											$mood_sel_id = qInsertMood($mood_id, $mood_value);
+											qInsertAudioMood($audioID, $mood_sel_id);
+										}
+										
+										
+										//prepare comment
+										$comment .= MP3_TAG;
+										$comment .= &quot;More on Simuze: <A HREF="http://simuze.nl/live/showprofile.php?username=$user\n">http://simuze.nl/live/showprofile.php?username=$user\n</A>&quot;;
+										$comment .= &quot;License: &quot;.rawurldecode($row_license['cclicense_human_url']);
+										
+										
+																			
+										//do id3 writing hi quality
+										$getID3 = new getID3;
+										getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'write.php', __FILE__);
+										$tagwriter = new getid3_writetags;
+										$tagwriter-&gt;filename   = rawurldecode($filepath_hi); // absolute path
+										$tagwriter-&gt;tagformats = array('id3v2.3', 'id3v1');
+										$tagdata['title'][]  = $songtitle;
+										$tagdata['artist'][] = $aname;
+										$tagdata['album'][]  = $album;
+										$tagdata['year'][]   = date(&quot;Y&quot;);
+										$tagdata['comment'][] = $comment;
+										$tagwriter-&gt;tag_data = $tagdata;
+										if ($tagwriter-&gt;WriteTags()) {
+											array_push($log,$tagwriter-&gt;warnings);
+										} else {
+											array_push($log,$tagwriter-&gt;warnings);
+											array_push($log,$tagwriter-&gt;errors);
+										}
+										
+										echo &quot;FILEPATHLOW $filepath_lo&quot;;
+										//do id3 writing lo quality
+										$getID3 = new getID3;
+										getid3_lib::IncludeDependency(GETID3_INCLUDEPATH.'write.php', __FILE__);
+										$tagwriterlo = new getid3_writetags;
+										$tagwriterlo-&gt;filename   = rawurldecode($filepath_lo); // absolute path
+										$tagwriterlo-&gt;tagformats = array('id3v2.3', 'id3v1');
+										$tagdatalo['title'][]  = $songtitle;
+										$tagdatalo['artist'][] = $aname;
+										$tagdatalo['album'][]  = $album;
+										$tagdatalo['year'][]   = date(&quot;Y&quot;);
+										$tagdatalo['comment'][] = $comment;
+										$tagwriterlo-&gt;tag_data = $tagdatalo;
+										if ($tagwriterlo-&gt;WriteTags()) {
+											echo &quot;LOW written&quot;;
+											array_push($log,$tagwriterlo-&gt;warnings);
+										} else {
+											print_r($tagwriterlo-&gt;warnings);
+											print_r($tagwriterlo-&gt;errors);
+											array_push($log,$tagwriterlo-&gt;warnings);
+											array_push($log,$tagwriterlo-&gt;errors);
+										}
+										
+										//set the flag that all info should be available
+										$status = 'info_available';
+										if($info_id = qUpdateAudioStatus($status,$audioID) &gt; 0) {
+											$continue = true;
+										}
+										
+									} else {
+										array_push($log, &quot;Db problemen: audio bestand kon niet aan db worden toegevoegd&quot;);
+									}
+                                } else {
+                                    array_push($log, &quot;Db problemen: Geen licentie gevonden&quot;);
+                                }
+                            } else {
+                                array_push($log, &quot;Licentie: afgeleide is ongeldige&quot;);
+                            }
+                        } else {
+                            array_push($log, &quot;Licentie: commercieel is ongeldige&quot;);
+                        }
+                    } else {
+                        array_push($log, &quot;Geen file meegegeven&quot;);
+                    }
+                    
+                } else {
+                    array_push($log, &quot;Genre is ongeldige&quot;);
+                } 
+            } else {
+                array_push($log, &quot;Titel is leeg of bevat ongeldige tekens&quot;);
+            }
+        } else {
+            array_push($log, &quot;De artiestnaam is leeg of bevat ongeldige tekens&quot;);
+        }
+    } else {
+        array_push($log, &quot;De bestandsnaam is leeg of bevat ongeldige tekens&quot;);
+    }
+} else {
+     array_push($log, &quot;Geen gebruiker ingelogd&quot;);
+}
+?&gt;
+
+
+&lt;?php require '../template_header.php'; ?&gt;	
+	&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Muziek gegevens gewijzigd&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				Je muziek bevat de gegevens die je hebt aangegeven. Nu wordt er door een moderator gecontroleerd of de muziek 
+				niet in strijd is met de Simuze &lt;a href=&quot;voorwaarden.php&quot;&gt;voorwaarden&lt;/a&gt;. Als de moderatie voltooid is dan ontvang je
+				een emailtje met de links waar je je muziek kunt downloaden.				
+				&lt;?php
+                 /*   if($continue &amp;&amp; sizeof($log) &lt; 1) {
+                        echo &quot;Bestand gewijzigd&quot;;
+                    } else {
+                         foreach($log as $key=&gt;$val) {
+                            echo &quot;$val&lt;br /&gt;&quot;;
+                        }
+                    }*/
+                    ?&gt;         
+				&lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require 'template_sidebar_footer.php'; ?&gt;
+

Added: trunk/users/sm-playlist_generate.php
===================================================================
--- trunk/users/sm-playlist_generate.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/sm-playlist_generate.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,225 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-secure.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;template_header.php&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/external/xspf/class.XSPF.php&quot;);
+
+print_r($_POST);
+
+//get userid
+$user = $_SESSION['name'];
+$uhandle = qGetUser($user);
+if($nr_user = mysql_num_rows($uhandle) == 1) {
+    $urow = mysql_fetch_array($uhandle);
+    $uid = $urow['uid']; 
+	if(!empty($_POST['playlist_title']) &amp;&amp; checkContainsAlfaNum($_POST['playlist_title'])) {
+		if(!empty($_POST['playlist_description']) &amp;&amp; checkContainsAlfaNum($_POST['playlist_description'])) {
+			if(!empty($_POST['type_playlist'])) {
+				
+				// set all the vars
+				$dir 					= PLAYLIST_DIR .$user;
+				$playlist_description 	= $_POST['playlist_description'];		
+				$playlist_title 		= $_POST['playlist_title'];		
+				$playlist_fname 		= strtr($playlist_title,&quot; &quot;,&quot;_&quot;) .&quot;.xspf&quot;;
+				$path 					= $dir .&quot;/&quot; .$playlist_fname;
+				$playlist_path			= rawurlencode($path);
+				$creation_date 			= date(&quot;YmdHis&quot;); // format: 2005 05 15 23 05 43 (YYYYMMDDHHMMSS)
+			
+				// if the dir doesn't exists yet create the dir
+				if(!is_dir($dir)) {
+					if(!mkdir($dir)) {
+						array_push($feedback, &quot;kon directory niet aanmaken&quot;);
+					}
+				}
+			
+								
+				/* empty playlist */
+				if($_POST['type_playlist'] == 'empty_playlist') {
+					$xspf = new XSPF();
+
+					$xspf-&gt;setPlaylistTitle($playlist_title);
+					$xspf-&gt;setPlaylistCreator($user);
+					$xspf-&gt;setPlaylistDate();
+					$xspf-&gt;setPlaylistAnnotation($playlist_description);
+					//$xspf-&gt;setPlaylistImage(&quot;<A HREF="http://pear.php.net/gifs/pearsmall.gif">http://pear.php.net/gifs/pearsmall.gif</A>&quot;);
+					//$xspf-&gt;setPlaylistIdentifier(md5(&quot;test&quot;));
+					$xspf-&gt;setPlaylistLocation(&quot;<A HREF="http://www.simuze.nl/live/media/playlist/users/$user/$playlist_fname">http://www.simuze.nl/live/media/playlist/users/$user/$playlist_fname</A>&quot;);
+					$xspf-&gt;setPlaylistInfo(&quot;<A HREF="http://www.simuze.nl/live">http://www.simuze.nl/live</A>&quot;);
+					//$xspf-&gt;setPlaylistLicense(&quot;<A HREF="http://www.license.info">http://www.license.info</A>&quot;);
+					
+					if($playlist = $xspf-&gt;getPlaylistXML()) {
+						
+						if(!$file_handle = fopen($path,&quot;w+&quot;)) {
+							array_push($feedback, &quot;kon playlist niet wegschrijven&quot;);
+							exit;
+						}
+						
+						// Write $playlist to our opened file.
+						if (fwrite($file_handle, $playlist) === FALSE) {
+							array_push($feedback, &quot;kon inhoud playlist niet wegschrijven&quot;);
+							exit;
+						}
+						
+						fclose($file_handle);
+					} else {
+						echo &quot;geen playist&quot;;
+					}
+					
+					// prepare data 4 inserting
+					$dbvalues = array(
+										'user_ID'=&gt;$uid,
+										'playlist_title'=&gt;$playlist_title,
+										'playlist_description'=&gt;$playlist_description,
+										'playlist_path'=&gt;$playlist_path,
+										'playlist_creationdate'=&gt;$creation_date
+								);
+					
+					qInsertPlaylist($dbvalues);
+				}
+				/* end empty playlist */
+				
+				
+				/* generate random playlist */ 
+				if($_POST['type_playlist'] == 'random_playlist') {
+					
+					$xspf = new XSPF();
+
+					$xspf-&gt;setPlaylistTitle($playlist_title);
+					$xspf-&gt;setPlaylistCreator($user);
+					$xspf-&gt;setPlaylistDate();
+					$xspf-&gt;setPlaylistAnnotation($playlist_description);
+					//$xspf-&gt;setPlaylistImage(&quot;<A HREF="http://pear.php.net/gifs/pearsmall.gif">http://pear.php.net/gifs/pearsmall.gif</A>&quot;);
+					//$xspf-&gt;setPlaylistIdentifier(md5(&quot;test&quot;));
+					$xspf-&gt;setPlaylistLocation(&quot;<A HREF="http://www.simuze.nl/live/media/playlist/users/$user/$playlist_fname">http://www.simuze.nl/live/media/playlist/users/$user/$playlist_fname</A>&quot;);
+					$xspf-&gt;setPlaylistInfo(&quot;<A HREF="http://www.simuze.nl/live">http://www.simuze.nl/live</A>&quot;);
+					//$xspf-&gt;setPlaylistLicense(&quot;<A HREF="http://www.license.info">http://www.license.info</A>&quot;);
+					
+					
+					// get the data
+					$audio_ids = array();
+					$handle_rnd = qGenerateRndPlaylist();
+					$nr_rnd_rows = mysql_num_rows($handle_rnd);
+					for($i = 0; $i &lt; $nr_rnd_rows; $i++) {
+						$track 		= array();
+						$locations 	= array();
+						$rnd_row 	= mysql_fetch_array($handle_rnd);
+						$extension 	= array('_content'=&gt;array(
+															'cclicense_by'=&gt;$rnd_row['cclicense_by'],
+															'cclicense_commercial'=&gt;$rnd_row['cclicense_commercial'],
+															'cclicense_derative'=&gt;$rnd_row['cclicense_derative']
+															)
+										  );
+						$meta 		= array(0=&gt;$rnd_row['cclicense_name']);
+						
+						$hi_path 	= rawurldecode($rnd_row['audio_hi_path']);
+						$hi_url 	= str_replace(&quot;/data/&quot;,SIMUZE_URL,$hi_path);
+						array_push($locations, $hi_url);
+						
+						$image_path = rawurldecode($rnd_row['avatar_path'] . $rnd_row['avatar_filename_small']);
+						$image_url 	= str_replace(&quot;/var/www/simuze.nl/live/&quot;,SIMUZE_URL,$image_path);
+						
+						
+						$track['track_title'] = $rnd_row['audio_title'];
+						$track['track_creator'] = $rnd_row['audio_artist'];
+						$track['track_annotation'] = &quot;&quot;;
+						//$track['track_info'] = $rnd_row['uid'];
+						$track['track_identifier'] = array(0=&gt;$rnd_row['audio_id']);
+						$track['track_duration'] = floor(1000*($rnd_row['audio_playtime']));
+						$track['track_image'] = $image_url;
+						//$track['track_album'] = &quot;Album of track$i&quot;;
+						$track['track_nr'] = $i;
+						$track['track_location'] = $locations;
+						$track['track_extension_application'] = &quot;<A HREF="http://www.simuze.nl">http://www.simuze.nl</A>&quot;;
+						$track['track_meta_rel'] = rawurldecode($rnd_row['cclicense_human_url']);
+						$track['track_meta'] = $meta;
+						$track['track_extension'] = $extension;
+						$xspf-&gt;addTrack($track);
+						array_push($audio_ids,$rnd_row['audio_id']);
+					}
+					if($playlist = $xspf-&gt;getPlaylistXML()) {
+						
+						if(!$file_handle = fopen($path,&quot;w+&quot;)) {
+							array_push($feedback, &quot;kon playlist niet wegschrijven&quot;);
+							exit;
+						}
+						
+						// Write $playlist to our opened file.
+						if (fwrite($file_handle, $playlist) === FALSE) {
+							array_push($feedback, &quot;kon inhoud playlist niet wegschrijven&quot;);
+							exit;
+						}
+						
+						fclose($file_handle);
+					} else {
+						echo &quot;geen playist&quot;;
+					}
+					
+				}
+				
+				// prepare data 4 inserting
+				$dbvalues = array(
+									'user_ID'=&gt;$uid,
+									'playlist_title'=&gt;$playlist_title,
+									'playlist_description'=&gt;$playlist_description,
+									'playlist_path'=&gt;$playlist_path,
+									'playlist_creationdate'=&gt;$creation_date
+								);
+					
+				$playlist_id = qInsertPlaylist($dbvalues);
+				
+				foreach($audio_ids as $k=&gt;$v){
+					qInsertAudioInPlaylist($playlist_id, $v);
+				}
+				
+				
+				/* generate specific playlist with music! */
+				if($_POST['type_playlist'] == 'specific_playlist') {
+					$commercial = ($_POST['commericial_ok'] == &quot;on&quot;) ? 1 : 0;
+					$deratives 	= ($_POST['derative_ok'] == &quot;on&quot;) ? 1 : 0;
+				
+				}
+				
+				
+				
+				
+				
+				
+				
+				
+			}
+		} else {
+			array_push($feedback, &quot;geen playlist beschrijving, kan geen playlist genereren&quot;);
+		}
+	} else {
+		array_push($feedback, &quot;geen playlist naam, kan geen playlist genereren&quot;);
+	}
+}
+
+
+
+
+
+?&gt;
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div&gt;
+				
+				&lt;?php
+					foreach($feedback as $key=&gt;$val) {
+						echo &quot;$val&quot;;
+					}
+				?&gt;
+ 				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+
+&lt;?php
+	// needs to set path again, due to the different path in which PEAR XML resides
+	ini_set(&quot;include_path&quot;, &quot;../&quot;); 
+	require_once (&quot;template_sidebar_footer.php&quot;); 
+?&gt;
+
+	

Added: trunk/users/sm-profile.php
===================================================================
--- trunk/users/sm-profile.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/sm-profile.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,343 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once('inc/sm-secure.php');
+require_once('inc/sm-db-queries.php');
+require_once('inc/sm-messages.php');
+require_once('inc/sm-lib-functions.php');
+
+/**
+* validate and check all before adding it to profiledata. 
+* Make sure the keys of profiledata match the db fields!!
+*
+**/
+$action = null;
+$profiledata = array();
+$log = array();    
+$feedback = array();
+$continue = false;
+
+
+if($_POST['submit']) {
+    if(is_numeric($_POST['uid'])) {
+        
+        if($_POST['pid'] == &quot;update&quot;) {
+            $action = &quot;update&quot;;
+        } else if (is_numeric($_POST['pid'])) {
+            $action = &quot;insert&quot;; 
+        } else {
+            $action = false;
+        }
+        $profiledata['uid'] = $_POST['uid'];
+        //play nice and use local vars :)
+        $firstname      = trim($_POST['fname']);
+        $lastname       = trim($_POST['sname']);
+        $artistname     = trim($_POST['artistname']);
+        $year           = $_POST['selyear']; //select box needs no trim or addslashes
+        $month          = $_POST['selmonth']; //select box needs no trim or addslashes
+        $day            = $_POST['seldaymonth']; //select box needs no trim or addslashes
+        $zipcode        = trim($_POST['zipcode']);
+        $location       = trim($_POST['location']);
+        $provincie      = $_POST['selprovincie'];
+        $bio            = trim($_POST['bio']);
+        $im_arr         = $_POST['IM']; //array with all the IM communication possibilities
+        $link_arr       = $_POST['link']; //array with all the link possibilities, currently 3.
+        $music_arr     = $_POST['musica']; //array with all the musica possibilities, currently 3.
+        $must_arr       = $_POST['must']; //array with all the musica possibilities, currently 4.
+        //firstname
+        if(!empty($firstname)) {
+            if(CheckInputValid($firstname)) {
+                $profiledata['firstname'] = addslashes($firstname); 
+            } else {
+                array_push($log, &quot;Voornaam bevat ongeldige tekens en is NIET gewijzigd&quot;);
+            }
+        } else {
+        //its empty and so we make sure you know :)
+            $profiledata['firstname'] = PROFILE_EMPTY_MSG;
+        }
+        
+        
+        
+        //lastname
+        if(!empty($lastname)) {
+            if(CheckInputValid($lastname)) {
+                $profiledata['lastname'] = addslashes($lastname); 
+            } else {
+                array_push($log, &quot;Achternaam bevat ongeldige tekens en is NIET gewijzigd&quot;);
+            }
+        } else {
+            $profiledata['lastname'] = PROFILE_EMPTY_MSG;
+        }
+        
+        
+        //artistname
+        if(!empty($artistname)) {
+            if(CheckInputValid($artistname)) {
+                $profiledata['artistname'] = addslashes($artistname); 
+            } else {
+                array_push($log, &quot;Artiestnaam bevat ongeldige tekens en is NIET gewijzigd&quot;);
+            }
+        } else {
+            $profiledata['artistname'] = PROFILE_EMPTY_MSG;
+        }
+        /**
+        * Using DATE YYYY-MM-DD
+        * for the birthdate. NEVER USE a TIMESTAMP for this...its limited from 1979 to 2037!
+        **/
+        if($day != 'default') {
+            if($month != 'default') {
+                if($year !='default') {
+                    $birthdate = $year .&quot;-&quot;. $month .&quot;-&quot;. $day;
+                    $profiledata['birthdate'] = $birthdate; 
+                } else {
+                    array_push($log, &quot;Geboortedatum staat op default en is NIET gewijzigd&quot;);
+                }
+            } else {
+                array_push($log, &quot;Geboortedatum staat op default en is NIET gewijzigd&quot;);
+            }
+        } else {
+            array_push($log, &quot;Geboortedatum staat op default en is NIET gewijzigd&quot;);
+        }
+        
+        //zipcode
+        if(!empty($zipcode)) {
+            $zipcode = strtoupper($zipcode);
+            if(checkPostcode($zipcode)) {
+                $profiledata['zipcode'] = $zipcode;
+            } else {
+                array_push($log, &quot;Postcode is incorrect, correct: 1234AB en is NIET gewijzigd&quot;);
+            }
+        } else {
+            $zipcode = PROFILE_EMPTY_MSG;
+        }
+        
+        
+        //location
+        if(!empty($location)) {
+            if(CheckInputValid($location)) {
+                $profiledata['location'] = addslashes($location);
+            } else {
+                array_push($log, &quot;Woonplaats bevat ongeldige tekens en is NIET gewijzigd&quot;);
+            }
+        } else {
+            $profiledata['location'] = PROFILE_EMPTY_MSG;
+        }
+        
+        //provincie
+        if($provincie != 'default') {
+            $profiledata['state'] = $provincie;
+        } else {
+                array_push($log, &quot;Provincie staat op default en is NIET gewijzigd&quot;);
+        }
+        
+        //bio CHECK FOR XSS
+        if(!empty($bio)) {
+            if(CheckTextValid($bio)) {
+                $bio = htmlentities($bio);
+                $profiledata['bio'] = addslashes($bio);   
+            } else {
+                array_push($log, &quot;Bio bevat ongeldige tekens en is NIET gewijzigd&quot;);
+            }
+            
+        } else {
+            $profiledata['bio'] = PROFILE_EMPTY_MSG;
+        }
+        
+        //validate IM communications array
+        foreach ($im_arr as $im_key =&gt; $im_value) {
+            $im_value = trim($im_value);
+            if(!empty($im_value))
+            {
+                if(CheckInputValid($im_value)) {
+                    $profiledata[$im_key] = addslashes($im_value);   
+                } else {
+                    $im_key = strtoupper($im_key);
+                    array_push($log, &quot;$im_key bevat ongeldige tekens en is NIET gewijzigd&quot;);
+                }
+            } else {
+                $profiledata[$im_key] = PROFILE_EMPTY_MSG;
+            } 
+        }
+        
+        //validate links NOTE: encoded with url encoding
+        foreach ($link_arr as $link_key =&gt; $link_value) {
+            $link_value = trim($link_value);
+            if(!empty($link_value) &amp;&amp; $link_value != &quot;<A HREF="http://">http://</A>&quot;) //check if url is NOT empty  and contains NOT just <A HREF="http://">http://</A>
+            {
+                if(validateUrlSyntax($link_value) || $link_value == PROFILE_EMPTY_MSG) {
+                    $profiledata[$link_key] = rawurlencode($link_value);   
+                } else {
+                    $link_key = strtoupper($link_key);
+                    array_push($log, &quot;$link_key bevat ongeldige tekens en is NIET gewijzigd&quot;);
+                }
+            } else {
+                $profiledata[$link_key] = PROFILE_EMPTY_MSG;
+            } 
+        }
+        
+        //validate musica 
+        foreach ($music_arr as $music_key =&gt; $music_value) {
+            $music_value = trim($music_value);
+            if(!empty($music_value))
+            {
+                if(CheckInputValid($music_value)) {
+                    $profiledata[$music_key] = addslashes($music_value);   
+                } else {
+                    $music_key = strtoupper($music_key);
+                    array_push($log, &quot;$music_key bevat ongeldige tekens en is NIET gewijzigd&quot;);
+                }
+            } else {
+                $profiledata[$music_key] = PROFILE_EMPTY_MSG;
+            } 
+        }
+        
+        //validate must 
+        foreach ($must_arr as $must_key =&gt; $must_value) {
+            $must_value = trim($must_value);
+            if(!empty($must_value))
+            {
+                if(CheckTextValid($must_value)) {
+                    $must_value = htmlentities($must_value);
+                    $profiledata[$must_key] = addslashes($must_value);
+                } else {
+                    array_push($log, &quot;$must_key bevat ongeldige tekens en is NIET gewijzigd&quot;);
+                }
+            } else {
+                $profiledata[$must_key] = PROFILE_EMPTY_MSG;
+            } 
+        }
+        
+        //handle the upload of the picture
+        
+        $types = array(&quot;jpg&quot;,&quot;jpeg&quot;,&quot;gif&quot;,&quot;png&quot;,&quot;JPG&quot;,&quot;JPEG&quot;,&quot;PNG&quot;,&quot;GIF&quot;);
+        
+        
+        if($_FILES['avatar']['error'] === 0) { //upload ok!
+            if($_FILES['avatar']['size'] &lt;= AVATAR_MAX_SIZE) {
+                $filetype = explode(&quot;/&quot;, $_FILES['avatar']['type']);
+                
+                $mime = false;              
+                foreach($types as $tkey =&gt;$tval) {
+                    if($filetype[1] == $tval) {
+                        $mime = true;
+                        break;
+                    }
+                }                
+                if($mime) {
+                    //create the dir if dir doesn't exists
+                    $dir = AVATAR_UPLOAD_PATH . md5($profiledata['uid']);
+                    
+                    if(!is_dir($dir)) {
+                        mkdir($dir);
+                    } 
+                    //get the suffix and create the name.
+                    //this will make sure that any older avatar file will be overwritten
+                    $suffix = explode(&quot;.&quot;, $_FILES['avatar']['name']);
+                    $suffix[1] = strtolower($suffix[1]); 
+                    $name = 'avatar';
+                    $fname = $name .&quot;.&quot; . $suffix[1];
+                    
+                    $uploadfile = $dir . &quot;/&quot; . $fname;
+                    $avatar = $dir . &quot;/avatar&quot;;
+                    
+                    if(move_uploaded_file($_FILES['avatar']['tmp_name'], $uploadfile)) {
+                        array_push($log, &quot;Upload is succesvol!&quot;);
+                        
+                        $normal_size = &quot;240x180&quot;;
+                        $small_size = &quot;40x30&quot;; 
+                        
+                        //use an exclamation mark to overide preserve ratio
+                        $avatar240x180  = &quot;convert -size &quot;.$normal_size .&quot; &quot; .$uploadfile .&quot; -resize &quot; .$normal_size .&quot;! &quot; .$avatar .$normal_size .&quot;.&quot;.$suffix[1]; 
+                        $avatar40x30    = &quot;convert -size &quot;.$small_size .&quot; &quot; .$uploadfile .&quot; -resize &quot; .$small_size .&quot;! &quot; .$avatar .$small_size .&quot;.&quot;.$suffix[1];
+                                      
+                        exec($avatar240x180);
+                        exec($avatar40x30);
+                        $profiledata['avatar_filename'] = $name .$normal_size .&quot;.&quot;.$suffix[1];
+                        $profiledata['avatar_filename_small'] = $name .$small_size .&quot;.&quot;.$suffix[1];
+                        $path = $dir .&quot;/&quot;;
+                        $profiledata['avatar_path'] = rawurlencode($path);
+                        
+                    } else {
+                        array_push($log, &quot;Plaatje uploaden is mislukt! Er ging iets mis&quot;);
+                    }
+                } else {
+                    array_push($log, &quot;Plaatje uploaden is mislukt! Plaatje is niet van het type: jpg, gif of png&quot;);
+                }
+            } else {
+                array_push($log, &quot;Plaatje uploaden is mislukt. Plaatje is groter dan 75 kilobytes&quot;);
+            }
+        } else {
+            if($_FILES['avatar']['error'] === 4) { 
+                array_push($log, &quot;Je hebt geen (nieuw) plaatje toegevoegd. Het standaard (oude) plaatje wordt gebruikt&quot;);
+				$encode_path = rawurlencode(AVATAR_UPLOAD_PATH .&quot;default/&quot;);
+				$profiledata['avatar_path'] = $encode_path; 
+                $profiledata['avatar_filename'] = &quot;default_avatar240x180.gif&quot;;
+				$profiledata['avatar_filename_small'] = &quot;default_avatar40x30.gif&quot;;
+            } else {
+                switch ($_FILES['avatar']['error']) {
+                    case 1:
+                        array_push($log, &quot;Plaatje uploaden is mislukt! Plaatje is groter dan 75kb&quot;); //The uploaded file exceeds the upload_max_filesize directive in php.ini.
+                        break;
+                    case 2:
+                        array_push($log, &quot;Plaatje uploaden is mislukt! Plaatje is groter dan 75kb&quot;); //The uploaded file exceeds the MAX_FILE_SIZE directive that was specified in the HTML form.
+                        break;
+                    case 3:
+                        array_push($log, &quot;Plaatje uploaden is mislukt! Het plaatje is maar gedeeltelijk geupload. Probeer het nogmaals&quot;); //The uploaded file was only partially uploaded.
+                        break;
+                    case 6:
+                        array_push($log, &quot;Plaatje uploaden is mislukt! Er is geen directory waar het plaatje mag staan&quot;); //Missing a temporary folder. Introduced in PHP 4.3.10 and PHP 5.0.3
+                        break;
+                }
+            }
+        }
+       
+        if($action == &quot;insert&quot;){
+             if(qInsertProfile($profiledata))
+             {
+                 array_push($feedback, &quot;Profiel info toegevoegd.&quot;);
+                 $continue = true;
+             } else {
+                 array_push($log, &quot;Toevoegen profiel aan database is mislukt! Database problemen&quot;);
+             }
+        } else if ($action = &quot;update&quot;) {
+             if(qUpdateProfile($profiledata))
+             {
+                 array_push($feedback, &quot;Profiel info gewijzigd.&quot;);
+                 $continue = true;
+             } else {
+                 array_push($log, &quot;Wijzigen profiel mislukt! Database problemen&quot;);
+             }
+        } else {
+            array_push($log, &quot;Ongeldige bewerking&quot;);;
+        }
+    }
+    else {
+        array_push($log, &quot;Gebruiker bestaat niet.&quot;);;
+    }
+}
+?&gt;
+
+
+&lt;?php require '../template_header.php'; ?&gt;	
+	&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Profiel wijzigingen:&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt;
+				&lt;?php
+                    if($continue &amp;&amp; sizeof($log) &lt; 1) {
+                        foreach($feedback as $key=&gt;$val) {
+                            echo &quot;$val&lt;br /&gt;&quot;;
+                        }
+                    } else {
+                         foreach($log as $key=&gt;$val) {
+                            echo &quot;$val&lt;br /&gt;&quot;;
+                        }
+                    }
+                    ?&gt;         
+				&lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+
+&lt;?php require '../template_sidebar_footer.php'; ?&gt;

Added: trunk/users/sm-upload.php
===================================================================
--- trunk/users/sm-upload.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/sm-upload.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,98 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once('inc/sm-secure.php');
+require_once('inc/sm-messages.php');
+require_once('inc/sm-lib-functions.php');
+require_once('inc/sm-db-queries.php');
+require_once('inc/external/getid3/getid3.php');
+//print_r($_FILES);
+//print_r($_POST);
+
+//doe een check op een spatie en vervang deze door een underscore
+
+
+
+$user = $_SESSION['name'];
+
+$valid_suffix = array(&quot;mp3&quot;,&quot;ogg&quot;);
+
+$profiledata = array();
+$log = array();   
+
+if($_POST['submit']) {
+    if($_FILES['upload']['error'] === 0) { //upload ok!
+        if($_FILES['upload']['size'] &lt;= MUSIC_MAX_SIZE) { //size ok!
+            $file_arr = explode(&quot;.&quot;,$_FILES['upload']['name']); //get the suffix. Only ogg and mp3 allowed. Lame 'security' check
+            $suffix = false;
+            foreach($valid_suffix as $key=&gt;$val) {
+                if($file_arr[1] === $val) {
+                    $suffix = true;
+                    break;
+                }
+            }
+            if($suffix) { //suffix is one of the valid suffixes i.e. mp3 or ogg
+                //check if filename is correct i.e. just alfanumeric, spaces, dashes and underscores
+                if(checkFilename($file_arr[0])){
+                    //replace all spaces in the name by underscores
+                    $file_arr[0] = strtr($file_arr[0],&quot; &quot;, &quot;_&quot;);
+                    
+                    //now first get the uid
+                    //create the dir if dir doesn't exists
+                    $dir = MUSIC_UPLOAD_PATH . $user;
+                    if(!is_dir($dir)) {
+                        mkdir($dir);
+                    }
+                    
+                    $name = $file_arr[0] .&quot;.&quot; .$file_arr[1];
+                    $path = $dir . &quot;/&quot;;
+                    $uploadfile = $path .$name;
+                    if(move_uploaded_file($_FILES['upload']['tmp_name'], $uploadfile)) {
+						 array_push($log, &quot;Je bestand is geupload! Deze wordt nu gecontroleerd op virussen. Zodra dit is gebeurd kan je de gegevens van je bestand aanpassen.&quot;);
+                        
+                    } else {
+                        array_push($log, &quot;&lt;h2&gt;Upload mislukt&lt;/h2&gt; Er ging iets mis&quot;);
+                    }
+                } else {
+                    array_push($log, &quot;&lt;h2&gt;Upload mislukt&lt;/h2&gt; Bestandsnaam bestaat uit ongeldige tekens. Geldige tekens zijn letters, nummers, liggend streepje en streepje&quot;);
+                }
+                
+            } else {
+                array_push($log, &quot;&lt;h2&gt;Upload mislukt&lt;/h2&gt; Bestand is geen ogg of mp3 bestand &quot;);
+            }
+        } else {
+            $err = &quot;&lt;h2&gt;Upload mislukt&lt;/h2&gt; Bestand is groter dan &quot;. MUSIC_MAX_SIZE;
+            array_push($log, $err);
+        }
+    } else {
+        array_push($log, &quot;&lt;h2&gt;Upload mislukt&lt;/h2&gt; Error: $_FILES[upload][error]&quot;);
+    }
+}
+
+//print_r($log);
+
+?&gt;
+
+
+&lt;?php require_once(&quot;../template_header.php&quot;);?&gt;
+&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Upload status&lt;/h1&gt;
+                    &lt;p class=&quot;space&quot;&gt;
+                     &lt;?php
+                    if($continue) {
+                        foreach($feedback as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        }
+                    } else {
+                         foreach($log as $key=&gt;$val) {
+                            echo &quot;$val&quot;;
+                        }
+                    }
+                    ?&gt;                           
+                    &lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require_once(&quot;../template_sidebar_footer.php&quot;);?&gt;

Added: trunk/users/tag.php
===================================================================
--- trunk/users/tag.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/tag.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,51 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once(&quot;inc/sm-messages.php&quot;);
+require_once(&quot;inc/sm-db-queries.php&quot;);
+require_once(&quot;inc/sm-lib-functions.php&quot;);
+
+require_once(&quot;template_header.php&quot;); 
+
+if(!empty($_GET['tag']) &amp;&amp; checkContainsAlfaNum($_GET['tag'])) {
+	$tag_name = $_GET['tag'];
+	echo &quot;hier&quot;;
+}
+
+$handle_tag = qGetTagByName($tag_name);
+if($nr_tags = mysql_num_rows($handle_tag) == 1) {
+	$tag = mysql_fetch_array($handle_tag);
+	$handle_audio_id = qGetAudioIDByTagID($tag['tag_id']);
+	$nr_audio_id = mysql_num_rows($handle_audio_id);
+	for($i = 0; $i &lt; $nr_audio_id ; $i++) {
+		$audio = mysql_fetch_array($handle_audio_id);
+		$audio_handle = qGetAudiobyID($audio['audio_id']);
+		$nr_audio = mysql_num_rows($audio_handle);
+		for($j = 0; $j &lt; $nr_audio ; $j++) {
+			$track = mysql_fetch_array($audio_handle);
+			$string .= &quot;&lt;li&gt;&lt;a href='$track[audio_title]'&gt;&quot;;
+		
+		}
+	}
+}
+
+
+
+
+?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_artiesten&quot;&gt;
+					&lt;h1&gt;Nummers met het trefwoord: &lt;?php echo &quot;$trefwoord&quot;; ?&gt;&lt;/h1&gt;
+					&lt;p&gt;
+					 test
+					&lt;/p&gt;	
+					&lt;p class=&quot;space&quot;&gt;
+						&lt;?php echo &quot;$string&quot;; ?&gt;
+					&lt;p&gt;
+					
+					&lt;p&gt; &nbsp;&lt;/p&gt;
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+&lt;?php require_once(&quot;../template_sidebar_footer.php&quot;); ?&gt;

Added: trunk/users/upload.php
===================================================================
--- trunk/users/upload.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/users/upload.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,55 @@
+&lt;?php
+ini_set(&quot;include_path&quot;, &quot;../&quot;);
+require_once('inc/sm-secure.php');
+require_once(&quot;inc/sm-messages.php&quot;);
+?&gt;
+
+&lt;?php require '../template_header.php'; ?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1_muziekuploaden&quot;&gt;
+				&lt;h1&gt;Upload jouw muziek!&lt;/h1&gt;
+				&lt;p class=&quot;space&quot;&gt; 
+				Je kan hier 1 audiobestand per keer uploaden van &lt;b&gt;maximaal 10MB&lt;/b&gt;. Wil je meerdere bestanden in 1 keer uploaden dan raden wij je aan om een &lt;a href=&quot;/live/help/uploaden.php#ftp&quot;&gt;FTP programma&lt;/a&gt; te gebruiken. De muziek die je upload moet jouw eigen werk zijn of je hebt toestemming verkregen van de oorspronkelijke auteur om zijn/haar werk te mogen uploaden. 
+				&lt;form action=&quot;users/sm-upload.php&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot; name=&quot;upload&quot; id=&quot;upload&quot;&gt;
+				
+				&lt;div class=&quot;uitleg_roundcont&quot;&gt;
+					&lt;div id=&quot;uitleg_kopje&quot;&gt;&lt;/div&gt;
+					&lt;ol type=&quot;1&quot;&gt;
+						&lt;li&gt;
+							Kies een muziekstuk:
+							&lt;br /&gt;
+							&lt;input type=&quot;file&quot; class=&quot;upload&quot; name=&quot;upload&quot; /&gt;
+							&lt;input type=&quot;hidden&quot; name=&quot;submit&quot; value=&quot;true&quot; class=&quot;hidden&quot; /&gt;
+							&lt;input type=&quot;hidden&quot; name=&quot;MAX_FILE_SIZE&quot; value=&quot;&lt;?php echo MUSIC_MAX_SIZE; ?&gt;&quot; /&gt;
+							&lt;br /&gt;
+						&lt;/li&gt;
+						&lt;li&gt;Het bestand wordt gefiltert op virussen en klaar gemaakt om gestreamed te kunnen worden. &lt;/li&gt; 
+						&lt;li&gt;Daarna voeg je een &lt;a href=&quot;/help/licenties.php&quot;&gt;Creative Commons licentie&lt;/a&gt; en eventueel wat meer informatie over je geuploade muziek toe en dan wordt je muziek publiekelijk beschikbaar op Simuze!&lt;/li&gt;
+					&lt;/ol&gt;
+					
+					
+				
+						
+			
+					
+					&lt;div class=&quot;uitleg_roundbottom&quot;&gt;&lt;/div&gt;
+				&lt;/div&gt;		
+				
+				&lt;p&gt;&lt;input type=&quot;image&quot; name=&quot;submit&quot; src=&quot;img/images/versturen_btn.gif&quot; value=&quot;Verstuur&quot;&gt;&lt;/p&gt;
+					
+					&lt;/form&gt;
+					
+				&lt;/p&gt;
+				&lt;div id=&quot;warning&quot;&gt;Een bestandsnaam mag alleen bestaan uit letters,cijfers, streepje (-), liggend streepje (_) en een punt met extensie mp3 of ogg (.mp3 of .ogg). Spaties worden automatisch omgezet naar een liggend streepje.  Alle andere tekens zijn ongeldige en je bestand wordt dan niet geupload.
+				&lt;/div&gt;
+				
+					
+					
+				&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+&lt;?php require '../template_sidebar_footer.php'; ?&gt;
+

Added: trunk/voorwaarden.php
===================================================================
--- trunk/voorwaarden.php	2005-09-14 23:28:28 UTC (rev 0)
+++ trunk/voorwaarden.php	2005-10-09 18:44:56 UTC (rev 1)
@@ -0,0 +1,71 @@
+&lt;?php require_once(&quot;template_header.php&quot;);?&gt;
+	
+		&lt;div id=&quot;container&quot;&gt;
+			&lt;div id=&quot;content&quot;&gt;
+				&lt;div id=&quot;kolom1&quot;&gt;
+				&lt;h1&gt;Voorwaarden&lt;/h1&gt;
+				&lt;h2&gt;Overeenkomst tussen gebruiker en Stichting Open Media&lt;/h2&gt;
+				&lt;p class=&quot;wide&quot;&gt;
+					Voor deze site (Simuze) van Stichting Open Media te vinden 
+					via &lt;a href=&quot;<A HREF="http://www.simuze.nl">http://www.simuze.nl</A>&quot; title=&quot;naar Simuze&quot;&gt;www.simuze.nl&lt;/a&gt;,
+					&lt;a href=&quot;<A HREF="http://www.simuze.org">http://www.simuze.org</A>&quot; title=&quot;naar Simuze&quot;&gt;simuze.org&lt;/a&gt;, 
+					&lt;a href=&quot;<A HREF="http://www.simuze.com">http://www.simuze.com</A>&quot; title=&quot;naar Simuze&quot;&gt;simuze.com&lt;/a&gt; 
+					geldt dat je hierop materiaal (in de vorm van tekst, beeldmateriaal en muziekbestanden),
+					hierna te noemen: Content, mag publiceren mits je de hierna weergegeven bepalingen en voorwaarden aanvaardt.
+					Door Content op deze site te plaatsen geef je aan hiermee in te stemmen. 
+				&lt;/p&gt;
+				&lt;h2&gt;Gebruik van deze site door gebruiker&lt;/h2&gt;
+				&lt;p class=&quot;wide&quot;&gt;
+					Wanneer je deze site gebruikt, stem je ermee in dat je je onthoudtvan (let wel: het betreft een niet-limitatieve opsomming): 
+					
+					&lt;ul&gt;
+						&lt;li&gt;Het uploaden en downloaden van bestanden die software of ander materiaal bevatten die onder 
+						de bescherming vallen van het intellectuele eigendomsrecht, tenzij je hiervoor toestemming van de rechthebbende heeft verkregen
+						of tenzij je zelf de rechthebbende bent. Je zult je onthouden van enige inbreuk op het intellectuele eigendomsrecht;&lt;/li&gt;
+						
+						&lt;li&gt;Het schenden en/of bedreigen van en/of inbreuk maken op de persoonlijke rechten van anderen;&lt;/li&gt;
+						&lt;li&gt;Het openbaarmaken, verspreiden, uploaden van ongepaste, lasterlijke, inbreukmakende, onbehoorlijke of
+						onrechtmatige onderwerpen, namen, materialen of informatie;&lt;/li&gt;
+						&lt;li&gt;Het uploaden van bestanden die virussen bevatten of andere software die de werking van de computer,
+						de site Simuze kunnen beschadigen;&lt;/li&gt;
+						&lt;li&gt;Het beperken of hinderen van andere gebruikers in hun gebruik en genot van deze site;&lt;/li&gt;
+						&lt;li&gt;Het plaatsen van berichten onder iemand anders zijn naam;&lt;/li&gt;
+					&lt;/ul&gt;
+					Voorts verklaar je doordat je deze site gebruikt dat je ermee bekend bent dat:
+					&lt;ul&gt;
+						 &lt;li&gt;De door jou op deze site gepubliceerde Content door een ieder vrijelijk gedownload en beluisterd kan worden en gebruikt
+						 mag worden op die wijze(n) die vrijgegeven zijn 
+						 onder Creative Commons Naamsvermelding-GeenAfgeleideWerken-NietCommercieel License Nederland 
+						 (&lt;a href=&quot;<A HREF="http://creativecommons.org/licenses/by-nd-nc/1.0/nl/">http://creativecommons.org/licenses/by-nd-nc/1.0/nl/</A>&quot;&gt;<A HREF="http://creativecommons.org/licenses/by-nd-nc/1.0/nl/&lt;/a">http://creativecommons.org/licenses/by-nd-nc/1.0/nl/&lt;/a</A>&gt;),
+						 behalve waar anders vermeld;&lt;/li&gt; 
+						 
+						 &lt;li&gt;Stichting Open Media geen enkele aansprakelijkheid accepteert voor schade, welke ook, die je eventueel zal lijden als gevolg
+						 van (onrechtmatig) gebruik door derden van de door jouw op deze site gepubliceerde Content;&lt;/li&gt;
+						 &lt;li&gt;Je ten alle tijde gerechtigd bent de door jou geplaatste Content van deze site te verwijderen.
+						 &lt;/li&gt;
+					&lt;/ul&gt;	
+				&lt;/p&gt;
+				&lt;h2&gt;Rechten Stichting Open Media Stichting&lt;/h2&gt;
+				&lt;p class=&quot;wide&quot;&gt;
+					Open Media behoudt zich het recht voor om je de toegang tot deze site zonder 
+					voorafgaande kennisgeving te bee?indigen; Stichting Open Media behoudt zich 
+					het recht voor om naar eigen goeddunken en zonder voorafgaande toestemming, 
+					informatie geheel of gedeeltelijk te bewerken, niet openbaar te maken of te 
+					verwijderen van de site; 
+				&lt;/p&gt;	
+				&lt;p class=&quot;wide&quot;&gt;
+					Stichting Open Media is onherroepelijk gerechtigd de Content die op deze site staat of heeft gestaan,
+					openbaar te maken en/of te verveelvoudigen door middel van vastlegging en/of publicatie op internet, 
+					radio, televisie en gedrukte media (omroepbladen, boeken, dag-, nieuws- en weekbladen).
+					In geen geval ontstaat door dit gebruik enige aanspraak op vergoeding. 
+					Stichting Open Media neemt bij deze bepalingen de door de gebruiker gekozen 
+					Creative Commons licentie in acht, behalve waar anders vermeldt. Stichting Open Media behoudt zich 
+					het recht voor deze voorwaarden te wijzigen.
+				
+				&lt;/p&gt;
+				&lt;/div&gt;
+	
+			&lt;/div&gt;
+		&lt;/div&gt;
+		
+	&lt;?php require_once(&quot;template_sidebar_footer.php&quot;);?&gt;
\ No newline at end of file


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="000001.html">[Simuze-svn] r2 - in trunk: . conf db db/revprops db/revs hooks locks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#0">[ date ]</a>
              <a href="thread.html#0">[ thread ]</a>
              <a href="subject.html#0">[ subject ]</a>
              <a href="author.html#0">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/simuze-svn">More information about the Simuze-svn
mailing list</a><br>
</body></html>
